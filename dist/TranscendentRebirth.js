/*! For license information please see TranscendentRebirth.js.LICENSE.txt */
(()=>{var e={31:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},40:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.toast-container[data-v-3b7b835b] {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  z-index: 20000;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 16px;\n}\n.toast[data-v-3b7b835b] {\n  display: flex;\n  align-items: center;\n  padding: 12px 20px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.95), rgba(10, 14, 39, 0.95));\n  border: 2px solid;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);\n  color: var(--tech-primary);\n  min-width: 250px;\n  max-width: 400px;\n  margin-bottom: 8px;\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  animation: toast-slide-in-3b7b835b 0.3s ease-out;\n}\n@keyframes toast-slide-in-3b7b835b {\nfrom {\n    opacity: 0;\n    transform: translateX(100px);\n}\nto {\n    opacity: 1;\n    transform: translateX(0);\n}\n}\n.toast-icon[data-v-3b7b835b] {\n  margin-right: 12px;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n}\n.toast-message[data-v-3b7b835b] {\n  word-break: break-word;\n  font-size: 0.95rem;\n  line-height: 1.4;\n  font-weight: 500;\n}\n\n/* Toast Types */\n.toast-success[data-v-3b7b835b] {\n  border-color: var(--tech-success);\n  box-shadow: 0 0 20px rgba(0, 255, 170, 0.3);\n}\n.toast-success .toast-icon[data-v-3b7b835b]::before {\n  content: '✓';\n  color: var(--tech-success);\n}\n.toast-error[data-v-3b7b835b] {\n  border-color: var(--tech-danger);\n  box-shadow: 0 0 20px rgba(255, 0, 85, 0.3);\n}\n.toast-error .toast-icon[data-v-3b7b835b]::before {\n  content: '✕';\n  color: var(--tech-danger);\n}\n.toast-warning[data-v-3b7b835b] {\n  border-color: var(--tech-warning);\n  box-shadow: 0 0 20px rgba(255, 107, 0, 0.3);\n}\n.toast-warning .toast-icon[data-v-3b7b835b]::before {\n  content: '⚠';\n  color: var(--tech-warning);\n}\n.toast-info[data-v-3b7b835b] {\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);\n}\n.toast-info .toast-icon[data-v-3b7b835b]::before {\n  content: 'ℹ';\n  color: var(--tech-primary);\n}\n.toast-loading[data-v-3b7b835b] {\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);\n}\n\n/* Spinner for loading */\n.spinner[data-v-3b7b835b] {\n  width: 20px;\n  height: 20px;\n  border: 3px solid rgba(0, 217, 255, 0.2);\n  border-top-color: var(--tech-primary);\n  border-radius: 50%;\n  animation: spin-3b7b835b 1s linear infinite;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);\n}\n@keyframes spin-3b7b835b {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Transitions */\n.toast-fade-enter-active[data-v-3b7b835b],\n.toast-fade-leave-active[data-v-3b7b835b] {\n  transition: all 0.5s ease;\n}\n.toast-fade-enter-from[data-v-3b7b835b],\n.toast-fade-leave-to[data-v-3b7b835b] {\n  opacity: 0;\n  transform: translateX(100%);\n}\n@media (max-width: 768px) {\n.toast-container[data-v-3b7b835b] {\n    top: 12px;\n    right: 12px;\n    gap: 12px;\n}\n.toast[data-v-3b7b835b] {\n    min-width: 220px;\n    max-width: 85vw;\n}\n}\n",""]);const s=i},76:e=>{"use strict";e.exports=Function.prototype.call},100:(e,t,n)=>{"use strict";n.r(t),n.d(t,{useAPIManagementStore:()=>s});var a=n(810),r=n(4061),o=n(9333),i=n(8546);const s=(0,a.nY)("apiManagement",()=>{const e=[{type:"main",apiId:"default"},{type:"memory_summary",apiId:"default"},{type:"embedding",apiId:"default"},{type:"text_optimization",apiId:"default"},{type:"cot",apiId:"default"},{type:"instruction_generation",apiId:"default"},{type:"world_generation",apiId:"default"},{type:"event_generation",apiId:"default"},{type:"sect_generation",apiId:"default"}],t=[{type:"memory_summary",mode:"raw"},{type:"text_optimization",mode:"raw"},{type:"world_generation",mode:"raw"},{type:"event_generation",mode:"raw"},{type:"sect_generation",mode:"raw"}],n=[{type:"memory_summary",enabled:!0},{type:"text_optimization",enabled:!1},{type:"world_generation",enabled:!0},{type:"event_generation",enabled:!0},{type:"sect_generation",enabled:!0},{type:"cot",enabled:!1}],a=(0,r.ref)([{id:"default",name:"默认API",provider:"openai",url:"https://api.openai.com",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0}]),s=(0,r.ref)([...e]),l=(0,r.ref)([...t]),c=(0,r.ref)([...n]),d=(0,r.ref)({enableSystemCoT:!1}),u=(0,r.computed)(()=>a.value.filter(e=>e.enabled)),m=(0,r.computed)(()=>{const e=s.value.find(e=>"cot"===e.type),t=s.value.find(e=>"main"===e.type),n=s.value.find(e=>"instruction_generation"===e.type);return e?.apiId&&"default"!==e.apiId||t?.apiId&&"default"!==t.apiId||n?.apiId&&"default"!==n.apiId}),p=()=>{a.value=[{id:"default",name:"默认API",provider:"openai",url:"https://api.openai.com",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0}],s.value=[...e],l.value=[...t],c.value=[...n],d.value={enableSystemCoT:!1}},g=r=>{r?.aiGenerationSettings&&(d.value={...d.value,...r.aiGenerationSettings}),a.value=Array.isArray(r?.apiConfigs)?r.apiConfigs:[];const o=new Set(e.map(e=>e.type)),i=new Map;e.forEach(e=>i.set(e.type,{...e}));const u=Array.isArray(r?.apiAssignments)?r.apiAssignments:[];for(const e of u){const t=e?.type,n="string"==typeof e?.apiId?e.apiId:"default";t&&o.has(t)&&i.set(t,{type:t,apiId:n})}const m=new Set((a.value||[]).map(e=>e?.id).filter(Boolean)),p=e.map(e=>{const t=i.get(e.type)||e,n=m.has(t.apiId)?t.apiId:"default";return{type:e.type,apiId:n}});s.value=p;const g=new Set(t.map(e=>e.type)),h=new Map;t.forEach(e=>h.set(e.type,{...e}));const f=Array.isArray(r?.functionModes)?r.functionModes:[];for(const e of f){const t=e?.type,n="standard"===e?.mode?"standard":"raw";t&&g.has(t)&&h.set(t,{type:t,mode:n})}l.value=t.map(e=>h.get(e.type)||e);const v=new Set(n.map(e=>e.type)),b=new Map;n.forEach(e=>b.set(e.type,{...e}));const y=Array.isArray(r?.functionEnabled)?r.functionEnabled:[];for(const e of y){const t=e?.type,n=!0===e?.enabled;t&&v.has(t)&&b.set(t,{type:t,enabled:n})}c.value=n.map(e=>b.get(e.type)||e),0===a.value.length&&a.value.push({id:"default",name:"默认API",provider:"openai",url:"https://api.openai.com",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0})},h=()=>({apiConfigs:a.value,apiAssignments:s.value,functionModes:l.value,functionEnabled:c.value,aiGenerationSettings:d.value}),f=e=>{try{if(!localStorage.getItem("access_token"))return void localStorage.removeItem("api_management_config");const t=h();localStorage.setItem("api_management_config",JSON.stringify(t)),e?.skipRemote||v(t)}catch(e){console.error("[API管理] 保存配置失败:",e)}},v=async e=>{if(localStorage.getItem("access_token")&&(0,i.isBackendConfigured)())try{const t=e??h();await o.Em.put("/api/v1/user/api-config",{config:t})}catch(e){console.error("[API管理] 保存到后端失败:",e)}};return{apiConfigs:a,apiAssignments:s,functionModes:l,functionEnabled:c,aiGenerationSettings:d,enabledAPIs:u,shouldEnableSplitGeneration:m,loadFromStorage:()=>{try{const e=localStorage.getItem("api_management_config");if(e){const t=JSON.parse(e);g(t)}else p()}catch(e){console.error("[API管理] 加载配置失败:",e),p()}},loadFromBackend:async()=>{if(!localStorage.getItem("access_token")||!(0,i.isBackendConfigured)())return p(),!1;try{const e=await o.Em.get("/api/v1/user/api-config");return e?.config?g(e.config):p(),f({skipRemote:!0}),!0}catch(e){return console.error("[API管理] 从后端加载配置失败:",e),p(),!1}},saveToStorage:f,saveToBackend:v,clearAll:async e=>{p(),localStorage.removeItem("api_management_config");const t=localStorage.getItem("access_token");if(e?.clearRemote&&t&&(0,i.isBackendConfigured)())try{await o.Em.delete("/api/v1/user/api-config")}catch(e){console.error("[API管理] 清空后端配置失败:",e)}},addAPI:e=>{const t={...e,id:`api_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return a.value.push(t),f(),t.id},updateAPI:(e,t)=>{const n=a.value.findIndex(t=>t.id===e);-1!==n&&(a.value[n]={...a.value[n],...t},f())},deleteAPI:e=>{if("default"===e)throw new Error("不能删除默认API配置");s.value.forEach(t=>{t.apiId===e&&(t.apiId="default")}),a.value=a.value.filter(t=>t.id!==e),f()},assignAPI:(e,t)=>{const n=s.value.find(t=>t.type===e);n?n.apiId=t:s.value.push({type:e,apiId:t}),f()},getAPIForType:e=>{const t=s.value.find(t=>t.type===e);if(!t)return null;return a.value.find(e=>e.id===t.apiId&&e.enabled)||a.value.find(e=>"default"===e.id)||null},toggleAPI:e=>{const t=a.value.find(t=>t.id===e);t&&(t.enabled=!t.enabled,f())},setFunctionMode:(e,t)=>{const n=l.value.find(t=>t.type===e);n?n.mode=t:l.value.push({type:e,mode:t}),f()},getFunctionMode:e=>{const t=l.value.find(t=>t.type===e);return t?.mode||"raw"},setFunctionEnabled:(e,t)=>{const n=c.value.find(t=>t.type===e);n?n.enabled=t:c.value.push({type:e,enabled:t}),f()},isFunctionEnabled:e=>{const t=c.value.find(t=>t.type===e);return t?.enabled??!0},updateAIGenerationSettings:e=>{d.value={...d.value,...e},f()},exportConfig:()=>({apiConfigs:a.value,apiAssignments:s.value,functionModes:l.value,functionEnabled:c.value,aiGenerationSettings:d.value,exportTime:(new Date).toISOString()}),importConfig:e=>{try{e.apiConfigs&&Array.isArray(e.apiConfigs)&&(a.value=e.apiConfigs),e.apiAssignments&&Array.isArray(e.apiAssignments)&&(s.value=e.apiAssignments),e.functionModes&&Array.isArray(e.functionModes)&&(l.value=e.functionModes),e.functionEnabled&&Array.isArray(e.functionEnabled)&&(c.value=e.functionEnabled),e.aiGenerationSettings&&(d.value={...d.value,...e.aiGenerationSettings}),f()}catch(e){throw console.error("[API管理] 导入配置失败:",e),e}}}})},112:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.action-menu[data-v-7abf98f0] {\n  position: fixed;\n  z-index: 120;\n}\n.overlay[data-v-7abf98f0] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(2px);\n  z-index: 0;\n}\n.fab[data-v-7abf98f0] {\n  width: 48px;\n  height: 48px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.08));\n  backdrop-filter: blur(10px);\n  border: 2px solid var(--tech-primary);\n  color: var(--tech-primary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n  position: relative;\n  z-index: 2;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1);\n}\n.fab[data-v-7abf98f0]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.12));\n  color: var(--tech-primary);\n  border-color: var(--tech-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.5), inset 0 0 15px rgba(0, 217, 255, 0.15);\n}\n.menu[data-v-7abf98f0] {\n  position: absolute;\n  right: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 10px;\n  border-radius: 4px;\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.98), rgba(10, 14, 39, 0.98));\n  border: 2px solid var(--tech-primary);\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4), inset 0 0 20px rgba(0, 217, 255, 0.1);\n  backdrop-filter: blur(14px);\n  -webkit-backdrop-filter: blur(14px);\n  z-index: 2;\n  min-width: 180px;\n  white-space: nowrap;\n}\n[data-v-7abf98f0] .action-menu-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border-radius: 4px;\n  border: 1px solid var(--tech-border);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05), rgba(157, 0, 255, 0.03));\n  color: var(--tech-primary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  width: 100%;\n  text-decoration: none;\n  font-family: inherit;\n  font-size: 0.95rem;\n  box-sizing: border-box;\n  font-weight: 500;\n}\n\n/* 确保 <a> 标签作为菜单项时样式一致 */\n[data-v-7abf98f0] a.action-menu-item {\n  display: flex;\n}\n[data-v-7abf98f0] .action-menu-item:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  border-color: var(--tech-primary);\n  color: var(--tech-primary);\n  transform: translateX(-2px);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);\n}\n[data-v-7abf98f0] .action-menu-item.is-disabled {\n  opacity: 0.45;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n[data-v-7abf98f0] .action-menu-item span {\n  font-size: 0.95rem;\n  letter-spacing: 0.05em;\n}\n[data-v-7abf98f0] .action-menu-item.is-danger {\n  border-color: var(--tech-danger);\n  color: var(--tech-danger);\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.08), rgba(255, 0, 85, 0.03));\n}\n[data-v-7abf98f0] .action-menu-item.is-danger:hover {\n  border-color: var(--tech-danger);\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.15), rgba(255, 0, 85, 0.08));\n  box-shadow: 0 0 15px rgba(255, 0, 85, 0.3);\n}\n.pos-bottom-right .menu[data-v-7abf98f0] {\n  bottom: 62px;\n}\n.pos-top-right .menu[data-v-7abf98f0] {\n  top: 62px;\n}\n.menu-fade-enter-active[data-v-7abf98f0],\n.menu-fade-leave-active[data-v-7abf98f0] {\n  transition: opacity 0.18s ease;\n}\n.menu-fade-enter-from[data-v-7abf98f0],\n.menu-fade-leave-to[data-v-7abf98f0] {\n  opacity: 0;\n}\n.menu-pop-enter-active[data-v-7abf98f0],\n.menu-pop-leave-active[data-v-7abf98f0] {\n  transition: transform 0.18s ease, opacity 0.18s ease;\n}\n.menu-pop-enter-from[data-v-7abf98f0],\n.menu-pop-leave-to[data-v-7abf98f0] {\n  opacity: 0;\n  transform: translateY(6px) scale(0.98);\n}\n@media (max-width: 600px) {\n.action-menu[data-v-7abf98f0] {\n    bottom: 12px;\n    right: 12px;\n    top: auto;\n}\n.pos-top-right[data-v-7abf98f0] {\n    top: 12px;\n    bottom: auto;\n}\n.fab[data-v-7abf98f0] {\n    width: 40px;\n    height: 40px;\n    border-radius: 10px;\n}\n.pos-bottom-right .menu[data-v-7abf98f0] {\n    bottom: 52px;\n    min-width: 150px;\n}\n.pos-top-right .menu[data-v-7abf98f0] {\n    top: 52px;\n    min-width: 150px;\n}\n}\n",""]);const s=i},193:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.game-view[data-v-2c3d1126] {\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  font-size: 14px;\n  display: grid;\n  grid-template-rows: auto 1fr;\n  overflow: hidden;\n}\n.game-content[data-v-2c3d1126] {\n  flex: 1;\n  display: flex;\n  align-items: stretch;\n  gap: 0;\n  padding: 0;\n  position: relative;\n  min-height: 0;\n  background: var(--color-background);\n}\n.left-sidebar[data-v-2c3d1126] {\n  width: 260px;\n  min-width: 260px;\n  background: var(--color-surface);\n  transition: all 0.3s ease;\n  z-index: 10;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.left-sidebar.collapsed[data-v-2c3d1126] {\n  width: 0;\n  min-width: 0;\n  overflow: hidden;\n}\n.right-panel-area[data-v-2c3d1126] {\n  width: 280px;\n  background: var(--color-surface);\n  transition: all 0.3s ease;\n  border-left: 1px solid var(--color-border);\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: column;\n}\n.right-panel-area.collapsed[data-v-2c3d1126] {\n  width: 0;\n  overflow: hidden;\n}\n.sidebar-wrapper[data-v-2c3d1126] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.main-content[data-v-2c3d1126] {\n  flex: 1;\n  background: var(--color-background);\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  position: relative;\n}\n\n/* 收缩按钮样式 */\n.collapse-btn[data-v-2c3d1126] {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 24px;\n  height: 48px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  transition: all 0.3s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 20;\n  color: var(--color-text-secondary);\n}\n.collapse-btn[data-v-2c3d1126]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n/* 左侧收缩按钮 */\n.collapse-btn.left[data-v-2c3d1126] {\n  left: 260px;\n  border-radius: 0 8px 8px 0;\n  transition: left 0.3s ease, background 0.2s ease;\n}\n\n/* 左侧栏收缩时，按钮移动到最左侧 */\n.collapse-btn.left.collapsed[data-v-2c3d1126] {\n  left: 0;\n}\n\n/* 右侧收缩按钮 */\n.collapse-btn.right[data-v-2c3d1126] {\n  right: 280px;\n  border-radius: 8px 0 0 8px;\n  transition: right 0.3s ease, background 0.2s ease;\n}\n\n/* 右侧栏收缩时，按钮移动到最右侧 */\n.right-panel-area.collapsed ~ .collapse-btn.right[data-v-2c3d1126],\n.collapse-btn.right.collapsed[data-v-2c3d1126] {\n  right: 0;\n}\n\n/* 面板覆盖模式样式 - 只隐藏右侧栏，保留左侧栏 */\n.game-content.panel-mode .right-panel-area[data-v-2c3d1126] {\n  display: none;\n}\n.game-content.panel-mode .collapse-btn.right[data-v-2c3d1126] {\n  display: none;\n}\n.panel-overlay[data-v-2c3d1126] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  z-index: 100;\n}\n.panel-header[data-v-2c3d1126] { position: relative; display: flex; align-items: center; gap: 8px; padding: 6px 12px; min-height: 30px; height: auto; background: transparent; border-bottom: none; flex-shrink: 0;\n}\n.panel-header[data-v-2c3d1126]::after { content: \'\'; position: absolute; left: 8px; right: 8px; bottom: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(var(--color-primary-rgb,46,92,184), .35), transparent);\n}\n.panel-header.compact[data-v-2c3d1126]::after {\n  content: \'\';\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 2px;\n  background: linear-gradient(90deg, transparent, var(--color-primary), transparent);\n  opacity: 0.25;\n}\n.panel-title-icon[data-v-2c3d1126] { color: var(--color-primary); flex-shrink: 0;\n}\n.panel-title-compact[data-v-2c3d1126] { display: flex; align-items: center; gap: 8px; min-width: 0; flex: 1; justify-content: center;\n}\n.panel-title-compact .title-text[data-v-2c3d1126] { font-size: 0.92rem; font-weight: 600; color: var(--color-text); letter-spacing: 0.2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\n}\n.back-btn[data-v-2c3d1126] { background: transparent; border: none; padding: 2px 6px; border-radius: 4px; color: var(--color-text-secondary); cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center;\n}\n.back-btn[data-v-2c3d1126]:hover { background: var(--color-surface-hover); color: var(--color-text);\n}\n.panel-actions[data-v-2c3d1126] { margin-left: auto; display: flex; align-items: center; gap: 4px;\n}\n.action-btn-compact[data-v-2c3d1126] { background: transparent; border: none; width: 26px; height: 26px; border-radius: 4px; color: var(--color-text-secondary); display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-fast);\n}\n.action-btn-compact[data-v-2c3d1126]:hover { background: var(--color-surface-hover); color: var(--color-text);\n}\n.panel-content[data-v-2c3d1126] {\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.panel-header.compact[data-v-2c3d1126] { padding: 6px 10px; position: sticky; top: 0; z-index: 2; background: var(--color-background);\n}\n.panel-content.compact[data-v-2c3d1126] { padding: 6px 10px 10px 10px;\n}\n\n/* 数据加载提示样式 */\n.data-loading[data-v-2c3d1126] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, var(--color-background) 0%, var(--color-surface) 100%);\n  position: relative;\n  overflow: hidden;\n}\n.data-loading[data-v-2c3d1126]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: radial-gradient(circle at 50% 50%, rgba(var(--color-primary-rgb, 46, 92, 184), 0.05) 0%, transparent 70%);\n  animation: pulse-2c3d1126 3s ease-in-out infinite;\n}\n.loading-content[data-v-2c3d1126] {\n  text-align: center;\n  padding: 60px 40px;\n  max-width: 500px;\n  position: relative;\n  z-index: 1;\n}\n.loading-spinner-wrapper[data-v-2c3d1126] {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  margin: 0 auto 32px;\n}\n.loading-spinner[data-v-2c3d1126] {\n  width: 80px;\n  height: 80px;\n  border: 3px solid transparent;\n  border-top: 3px solid var(--color-primary);\n  border-right: 3px solid var(--color-primary);\n  border-radius: 50%;\n  animation: spin-2c3d1126 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;\n  position: relative;\n}\n.spinner-glow[data-v-2c3d1126] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(var(--color-primary-rgb, 46, 92, 184), 0.3) 0%, transparent 70%);\n  animation: glow-2c3d1126 2s ease-in-out infinite;\n}\n@keyframes spin-2c3d1126 {\n0% { transform: rotate(0deg);\n}\n100% { transform: rotate(360deg);\n}\n}\n@keyframes glow-2c3d1126 {\n0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.9);\n}\n50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1);\n}\n}\n@keyframes pulse-2c3d1126 {\n0%, 100% { opacity: 0.5;\n}\n50% { opacity: 1;\n}\n}\n.loading-title[data-v-2c3d1126] {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin: 0 0 12px 0;\n  letter-spacing: 2px;\n  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n.loading-message[data-v-2c3d1126] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 32px 0;\n  font-weight: 500;\n}\n.loading-steps[data-v-2c3d1126] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  margin-bottom: 32px;\n  text-align: left;\n}\n.loading-step[data-v-2c3d1126] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 10px 16px;\n  background: var(--color-background);\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  transition: all 0.3s ease;\n}\n.loading-step.active[data-v-2c3d1126] {\n  background: rgba(var(--color-primary-rgb, 46, 92, 184), 0.1);\n  border-color: var(--color-primary);\n}\n.step-icon[data-v-2c3d1126] {\n  font-size: 1.2rem;\n  font-weight: bold;\n  color: var(--color-success);\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.loading-step.active .step-icon[data-v-2c3d1126] {\n  color: var(--color-primary);\n  animation: bounce-2c3d1126 1s ease-in-out infinite;\n}\n@keyframes bounce-2c3d1126 {\n0%, 100% { transform: translateY(0);\n}\n50% { transform: translateY(-4px);\n}\n}\n.step-text[data-v-2c3d1126] {\n  font-size: 0.95rem;\n  color: var(--color-text);\n  font-weight: 500;\n}\n.loading-hint[data-v-2c3d1126] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  margin: 0;\n  padding: 12px 20px;\n  background: var(--color-background);\n  border-radius: 8px;\n  border-left: 3px solid var(--color-primary);\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.game-view[data-v-2c3d1126] {\n    font-size: 13px;\n}\n\n  /* 移动端侧边栏浮动显示，不占用主内容空间 */\n.left-sidebar[data-v-2c3d1126] {\n    position: fixed;\n    top: 0; /* 从顶部开始 */\n    left: 0;\n    bottom: 0;\n    height: 100%;\n    width: 280px;\n    z-index: 1000;\n    transform: translateX(-100%);\n    transition: transform 0.3s ease;\n    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);\n    overflow: hidden;\n    background: var(--color-surface); /* 和右侧栏一样的背景色 */\n}\n.left-sidebar[data-v-2c3d1126]:not(.collapsed) {\n    transform: translateX(0);\n}\n.left-sidebar .sidebar-wrapper[data-v-2c3d1126] {\n    overflow-y: auto;\n    overflow-x: hidden;\n    height: 100%;\n    -webkit-overflow-scrolling: touch;\n    box-sizing: border-box;\n}\n.right-panel-area[data-v-2c3d1126] {\n    position: fixed;\n    top: 0; /* 从顶部开始 */\n    right: 0;\n    bottom: 0;\n    height: 100%;\n    width: 260px;\n    z-index: 1000;\n    transform: translateX(100%);\n    transition: transform 0.3s ease;\n    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);\n    overflow: hidden;\n    background: var(--color-surface); /* 和左侧栏一样的背景色 */\n}\n.right-panel-area[data-v-2c3d1126]:not(.collapsed) {\n    transform: translateX(0);\n}\n.right-panel-area .sidebar-wrapper[data-v-2c3d1126] {\n    overflow-y: auto;\n    overflow-x: hidden;\n    height: 100%;\n    -webkit-overflow-scrolling: touch;\n    box-sizing: border-box;\n}\n\n  /* 移动端背景遮罩层 */\n.mobile-sidebar-overlay[data-v-2c3d1126] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999; /* Below sidebars (1000) but above everything else */\n}\n\n  /* 移动端收缩按钮样式 - 参考电脑版样式 */\n.collapse-btn[data-v-2c3d1126] {\n    position: fixed;\n    z-index: 1001;\n    width: 20px;\n    height: 44px;\n    background: var(--color-surface);\n    border: 1px solid var(--color-border);\n    color: var(--color-text-secondary);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    touch-action: manipulation;\n    top: 50%;\n    transform: translateY(-50%);\n    transition: all 0.3s ease;\n}\n.collapse-btn svg[data-v-2c3d1126] {\n    width: 14px;\n    height: 14px;\n}\n.collapse-btn[data-v-2c3d1126]:active {\n    background: var(--color-surface-light);\n    color: var(--color-text);\n}\n\n  /* 左侧按钮：默认在左边缘，跟随侧边栏一起移动 */\n.collapse-btn.left[data-v-2c3d1126] {\n    left: 0;\n    border-radius: 0 8px 8px 0;\n    border-left: none;\n    transform: translateX(0) translateY(-50%);\n    transition: transform 0.3s ease, background 0.2s ease;\n}\n\n  /* 左侧栏展开时，按钮跟随移动 260px */\n.left-sidebar:not(.collapsed) ~ .collapse-btn.left[data-v-2c3d1126] {\n    transform: translateX(260px) translateY(-50%);\n}\n\n  /* 右侧按钮：默认在右边缘，跟随侧边栏一起移动 */\n.collapse-btn.right[data-v-2c3d1126] {\n    right: 0;\n    border-radius: 8px 0 0 8px;\n    border-right: none;\n    transform: translateX(0) translateY(-50%);\n    transition: transform 0.3s ease, background 0.2s ease;\n}\n\n  /* 右侧栏展开时（按钮没有 collapsed 类），按钮跟随移动 -260px */\n.collapse-btn.right[data-v-2c3d1126]:not(.collapsed) {\n    transform: translateX(-260px) translateY(-50%);\n}\n\n  /* 主内容区域占满屏幕 */\n.main-content[data-v-2c3d1126] {\n    width: 100%;\n    max-width: 100vw;\n    margin: 0;\n    padding: 0;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    box-sizing: border-box;\n}\n.game-content[data-v-2c3d1126] {\n    gap: 0;\n    margin-top: 0;\n    max-width: 100vw;\n    overflow-x: hidden;\n    box-sizing: border-box;\n}\n.game-view[data-v-2c3d1126] {\n    max-width: 100vw;\n    overflow-x: hidden;\n}\n\n  /* 移动端面板全屏优化 */\n.panel-overlay[data-v-2c3d1126] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 999;\n    overflow: hidden;\n}\n\n  /* 面板头部移动端优化 */\n.panel-header[data-v-2c3d1126] {\n    padding: 4px 8px;\n    min-height: 36px;\n    flex-wrap: nowrap;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n.panel-header.compact[data-v-2c3d1126] {\n    padding: 4px 8px;\n}\n.panel-title-compact .title-text[data-v-2c3d1126] {\n    font-size: 0.85rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n  /* 头部按钮触摸优化 */\n.back-btn[data-v-2c3d1126],\n  .action-btn-compact[data-v-2c3d1126] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    min-width: 32px;\n    min-height: 32px;\n}\n\n  /* 面板内容移动端优化 - 确保文本区域能够收缩 */\n.panel-content[data-v-2c3d1126] {\n    padding: 8px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n}\n.panel-content.compact[data-v-2c3d1126] {\n    padding: 6px 8px 8px 8px;\n}\n\n  /* 确保面板内所有文本元素自动换行 */\n.panel-content[data-v-2c3d1126] *,\n  .panel-overlay[data-v-2c3d1126] * {\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    max-width: 100%;\n}\n\n  /* 数据加载提示移动端优化 */\n.data-loading[data-v-2c3d1126] {\n    padding: 8px;\n}\n.loading-content[data-v-2c3d1126] {\n    padding: 40px 20px;\n    max-width: 100%;\n}\n.loading-title[data-v-2c3d1126] {\n    font-size: 1.2rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-message[data-v-2c3d1126] {\n    font-size: 0.9rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-steps[data-v-2c3d1126] {\n    gap: 8px;\n}\n.loading-step[data-v-2c3d1126] {\n    padding: 8px 12px;\n}\n.step-text[data-v-2c3d1126] {\n    font-size: 0.85rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n.loading-hint[data-v-2c3d1126] {\n    font-size: 0.8rem;\n    white-space: normal;\n    word-wrap: break-word;\n}\n}\n\n/* ========== 深色玻璃拟态风格适配 ========== */\n[data-theme="dark"] .game-view[data-v-2c3d1126] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .game-content[data-v-2c3d1126] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .left-sidebar[data-v-2c3d1126],\n[data-theme="dark"] .right-panel-area[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme="dark"] .main-content[data-v-2c3d1126] {\n  background: rgb(30, 41, 59);\n}\n[data-theme="dark"] .collapse-btn[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme="dark"] .collapse-btn[data-v-2c3d1126]:hover {\n  background: rgba(51, 65, 85, 0.95);\n  color: #f1f5f9;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme="dark"] .panel-overlay[data-v-2c3d1126] {\n  background: var(--color-background);\n  backdrop-filter: blur(20px);\n}\n[data-theme="dark"] .panel-header[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.8);\n}\n[data-theme="dark"] .panel-header[data-v-2c3d1126]::after {\n  background: linear-gradient(90deg, transparent, rgba(147, 197, 253, 0.4), transparent);\n}\n[data-theme="dark"] .back-btn[data-v-2c3d1126] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .back-btn[data-v-2c3d1126]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .panel-title-compact .title-text[data-v-2c3d1126] {\n  color: #f1f5f9;\n}\n[data-theme="dark"] .panel-title-icon[data-v-2c3d1126] {\n  color: #93c5fd;\n}\n[data-theme="dark"] .action-btn-compact[data-v-2c3d1126] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .action-btn-compact[data-v-2c3d1126]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .data-loading[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.95);\n}\n[data-theme="dark"] .data-loading[data-v-2c3d1126]::before {\n  background: radial-gradient(circle at 50% 50%, rgba(147, 197, 253, 0.08) 0%, transparent 70%);\n}\n[data-theme="dark"] .loading-title[data-v-2c3d1126] {\n  background: linear-gradient(135deg, #93c5fd 0%, #c0caf5 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n[data-theme="dark"] .loading-message[data-v-2c3d1126] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .loading-step[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme="dark"] .loading-step.active[data-v-2c3d1126] {\n  background: rgba(59, 130, 246, 0.15);\n  border-color: rgba(147, 197, 253, 0.4);\n}\n[data-theme="dark"] .step-icon[data-v-2c3d1126] {\n  color: #9ece6a;\n}\n[data-theme="dark"] .loading-step.active .step-icon[data-v-2c3d1126] {\n  color: #93c5fd;\n}\n[data-theme="dark"] .step-text[data-v-2c3d1126] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .loading-hint[data-v-2c3d1126] {\n  background: rgba(30, 41, 59, 0.6);\n  border-left-color: #93c5fd;\n  color: #94a3b8;\n}\n[data-theme="dark"] .spinner-glow[data-v-2c3d1126] {\n  background: radial-gradient(circle, rgba(147, 197, 253, 0.4) 0%, transparent 70%);\n}\n[data-theme="dark"] .loading-spinner[data-v-2c3d1126] {\n  border-top-color: #93c5fd;\n  border-right-color: #93c5fd;\n}\n\n/* 超小屏幕适配 */\n@media (max-width: 480px) {\n.game-view[data-v-2c3d1126] {\n    font-size: 12px;\n}\n.left-sidebar[data-v-2c3d1126] {\n    width: 260px;\n}\n\n  /* 左侧栏展开时，按钮跟随移动 260px（匹配侧边栏宽度） */\n.left-sidebar:not(.collapsed) ~ .collapse-btn.left[data-v-2c3d1126] {\n    transform: translateX(260px) translateY(-50%);\n}\n.right-panel-area[data-v-2c3d1126] {\n    width: 220px;\n}\n\n  /* 右侧栏展开时，按钮跟随移动 -220px（匹配侧边栏宽度） */\n.collapse-btn.right[data-v-2c3d1126]:not(.collapsed) {\n    transform: translateX(-220px) translateY(-50%);\n}\n\n  /* 小屏幕上面板全屏显示 */\n.panel-overlay[data-v-2c3d1126] {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 999;\n}\n.panel-header[data-v-2c3d1126] {\n    padding: 3px 6px;\n    min-height: 32px;\n}\n.panel-title-compact .title-text[data-v-2c3d1126] {\n    font-size: 0.8rem;\n}\n.panel-content[data-v-2c3d1126] {\n    padding: 6px;\n    font-size: 0.9em;\n}\n.loading-title[data-v-2c3d1126] {\n    font-size: 1rem;\n}\n.loading-message[data-v-2c3d1126] {\n    font-size: 0.85rem;\n}\n.step-text[data-v-2c3d1126] {\n    font-size: 0.8rem;\n}\n.loading-hint[data-v-2c3d1126] {\n    font-size: 0.75rem;\n}\n}\n',""]);const s=i},228:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function a(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,a,o,i){if("function"!=typeof a)throw new TypeError("The listener must be a function");var s=new r(a,o||e,i),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function i(e,t){0===--e._eventsCount?e._events=new a:delete e._events[t]}function s(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,a,r=[];if(0===this._eventsCount)return r;for(a in e=this._events)t.call(e,a)&&r.push(n?a.slice(1):a);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,i=new Array(o);r<o;r++)i[r]=a[r].fn;return i},s.prototype.listenerCount=function(e){var t=n?n+e:e,a=this._events[t];return a?a.fn?1:a.length:0},s.prototype.emit=function(e,t,a,r,o,i){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,d=this._events[s],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,a),!0;case 4:return d.fn.call(d.context,t,a,r),!0;case 5:return d.fn.call(d.context,t,a,r,o),!0;case 6:return d.fn.call(d.context,t,a,r,o,i),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var m,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,a);break;case 4:d[c].fn.call(d[c].context,t,a,r);break;default:if(!l)for(m=1,l=new Array(u-1);m<u;m++)l[m-1]=arguments[m];d[c].fn.apply(d[c].context,l)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,a,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||a&&s.context!==a||i(this,o);else{for(var l=0,c=[],d=s.length;l<d;l++)(s[l].fn!==t||r&&!s[l].once||a&&s[l].context!==a)&&c.push(s[l]);c.length?this._events[o]=1===c.length?c[0]:c:i(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new a,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},236:(e,t,n)=>{"use strict";n.d(t,{e:()=>r});var a=n(7445);async function r(e,t,n=!1,r){try{const o=await a.aiService.generateRaw({ordered_prompts:[{role:"user",content:t},{role:"user",content:e},{role:"user",content:"开始任务"}],should_stream:n,usageType:r,overrides:{world_info_before:"",world_info_after:""}});return o&&"object"==typeof o&&"text"in o?o.text:"string"==typeof o?o:String(o)}catch(e){throw console.error("[TavernCore] 生成响应失败:",e),e}}},272:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.video-background-container[data-v-49aadee8] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: -10;\n  pointer-events: none;\n  background-color: #1a1b26; /* 简单的暗色背景作为备用 */\n}\n.video-background[data-v-49aadee8] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: translate(-50%, -50%);\n  z-index: -2;\n  filter: brightness(1.15) saturate(1.1);\n}\n.video-overlay[data-v-49aadee8] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(10, 15, 24, 0);\n  z-index: -1;\n}\n",""]);const s=i},274:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.spirit-root-selection-container[data-v-5fa92edb] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n/* ========== 深色玻璃拟态风格 ========== */\n.loading-state[data-v-5fa92edb], .error-state[data-v-5fa92edb], .placeholder[data-v-5fa92edb] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.spirit-root-layout[data-v-5fa92edb] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.spirit-root-left-panel[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n/* 预设模式样式 */\n.preset-mode[data-v-5fa92edb] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n.spirit-root-list-container[data-v-5fa92edb] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.spirit-root-list-container[data-v-5fa92edb]::-webkit-scrollbar { width: 6px;\n}\n.spirit-root-list-container[data-v-5fa92edb]::-webkit-scrollbar-track { background: transparent;\n}\n.spirit-root-list-container[data-v-5fa92edb]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.spirit-root-list-container[data-v-5fa92edb]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式 ========== */\n.spirit-root-item[data-v-5fa92edb] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.item-content[data-v-5fa92edb] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-5fa92edb] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.spirit-root-item:hover .action-buttons[data-v-5fa92edb] {\n  opacity: 1;\n}\n.edit-btn[data-v-5fa92edb], .delete-btn[data-v-5fa92edb] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-5fa92edb]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.1);\n}\n.delete-btn[data-v-5fa92edb]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.1);\n}\n.spirit-root-name-container[data-v-5fa92edb] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex: 1;\n}\n.spirit-root-tier[data-v-5fa92edb] {\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  text-align: center;\n  min-width: 28px;\n  flex-shrink: 0;\n}\n.spirit-root-tier.tier-下品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #8B5CF6, #A78BFA);\n  color: white;\n}\n.spirit-root-tier.tier-中品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #3B82F6, #60A5FA);\n  color: white;\n}\n.spirit-root-tier.tier-上品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #10B981, #34D399);\n  color: white;\n}\n.spirit-root-tier.tier-极品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #F59E0B, #FBBF24);\n  color: white;\n}\n.spirit-root-tier.tier-天品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #EF4444, #F87171);\n  color: white;\n}\n.spirit-root-tier.tier-神品[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #DC2626, #F87171);\n  color: white;\n}\n.spirit-root-tier.tier-特殊[data-v-5fa92edb] {\n  background: linear-gradient(135deg, #7C3AED, #A78BFA);\n  color: white;\n  border: 1px solid #A78BFA;\n}\n.spirit-root-tier.tier-凡品[data-v-5fa92edb] {\n  background: rgba(156, 163, 175, 0.2);\n  color: #6B7280;\n  border: 1px solid #9CA3AF;\n}\n.spirit-root-item[data-v-5fa92edb]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.spirit-root-item.selected[data-v-5fa92edb] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.spirit-root-item.disabled[data-v-5fa92edb] {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.spirit-root-item.disabled[data-v-5fa92edb]:hover {\n  background: rgba(30, 41, 59, 0.4);\n  border-color: transparent;\n}\n.spirit-root-name[data-v-5fa92edb] {\n  font-weight: 500;\n  color: #f1f5f9;\n}\n.spirit-root-item.selected .spirit-root-name[data-v-5fa92edb] {\n  color: #bfdbfe;\n}\n.spirit-root-cost[data-v-5fa92edb] {\n  color: #fbbf24;\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n.divider[data-v-5fa92edb] {\n  height: 1px;\n  background: linear-gradient(to right, transparent, rgba(147, 197, 253, 0.2), transparent);\n  margin: 0.5rem 0;\n}\n.single-actions-container[data-v-5fa92edb] {\n  border-top: 1px solid var(--color-border);\n  background: rgba(0, 0, 0, 0.3);\n  padding: 0.5rem;\n  display: flex;\n  gap: 0.5rem;\n}\n.action-item[data-v-5fa92edb] {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0.8rem 1rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 1rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n.action-item[data-v-5fa92edb]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-name[data-v-5fa92edb] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.spirit-root-details-container[data-v-5fa92edb] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.spirit-root-details[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.spirit-root-details h2[data-v-5fa92edb] {\n  margin: 0 0 1rem 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.description-scroll[data-v-5fa92edb] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  padding-right: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll p[data-v-5fa92edb] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.description-scroll[data-v-5fa92edb]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-5fa92edb]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-5fa92edb]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.cost-display[data-v-5fa92edb] {\n  text-align: right;\n  font-weight: 600;\n  color: #fbbf24;\n  flex-shrink: 0;\n  margin-top: 1rem;\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.spirit-root-layout[data-v-5fa92edb] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.spirit-root-layout[data-v-5fa92edb] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.spirit-root-details h2[data-v-5fa92edb] {\n    font-size: 1.6rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-5fa92edb] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-5fa92edb] {\n    flex-grow: 1;\n    text-align: center;\n}\n.spirit-root-layout[data-v-5fa92edb] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.spirit-root-left-panel[data-v-5fa92edb] {\n    order: 1;\n    /* 移除max-height限制，让flex布局正常工作 */\n}\n.spirit-root-details-container[data-v-5fa92edb] {\n    order: 2;\n    min-height: 300px;\n}\n.spirit-root-list-container[data-v-5fa92edb] {\n    /* 移除max-height限制，让flex布局正常工作 */\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.spirit-root-item[data-v-5fa92edb],\n  .action-item[data-v-5fa92edb] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.spirit-root-layout[data-v-5fa92edb] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.spirit-root-list-container[data-v-5fa92edb] {\n    padding: 0.5rem;\n}\n.spirit-root-item[data-v-5fa92edb] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-5fa92edb] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-5fa92edb] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.spirit-root-details-container[data-v-5fa92edb] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.spirit-root-details h2[data-v-5fa92edb] {\n    font-size: 1.4rem;\n    margin-bottom: 0.8rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-5fa92edb] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.spirit-root-selection-container[data-v-5fa92edb] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.spirit-root-layout[data-v-5fa92edb] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.spirit-root-left-panel[data-v-5fa92edb] {\n    border-radius: 6px;\n}\n.spirit-root-list-container[data-v-5fa92edb] {\n    padding: 0.4rem;\n}\n.spirit-root-item[data-v-5fa92edb] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.spirit-root-name[data-v-5fa92edb] {\n    font-size: 0.9rem;\n}\n.spirit-root-cost[data-v-5fa92edb] {\n    font-size: 0.8rem;\n}\n.divider[data-v-5fa92edb] {\n    margin: 0.3rem 0;\n}\n.single-actions-container[data-v-5fa92edb] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-5fa92edb] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.spirit-root-details-container[data-v-5fa92edb] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.spirit-root-details h2[data-v-5fa92edb] {\n    font-size: 1.3rem;\n    margin-bottom: 0.6rem;\n}\n.description-scroll[data-v-5fa92edb] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n}\n.cost-display[data-v-5fa92edb] {\n    font-size: 1rem;\n    text-align: center;\n    margin-top: 0.8rem;\n}\n.placeholder[data-v-5fa92edb] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-5fa92edb] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-5fa92edb] {\n    text-align: center;\n}\n}\n@media (max-width: 360px) {\n.spirit-root-selection-container[data-v-5fa92edb] {\n    padding: 0.3rem;\n}\n.spirit-root-layout[data-v-5fa92edb] {\n    gap: 0.4rem;\n}\n.spirit-root-list-container[data-v-5fa92edb] {\n    padding: 0.3rem;\n}\n.spirit-root-item[data-v-5fa92edb] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.spirit-root-name[data-v-5fa92edb] {\n    font-size: 0.8rem;\n}\n.spirit-root-cost[data-v-5fa92edb] {\n    font-size: 0.75rem;\n}\n.spirit-root-details-container[data-v-5fa92edb] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.spirit-root-details h2[data-v-5fa92edb] {\n    font-size: 1.1rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-5fa92edb] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n}\n.cost-display[data-v-5fa92edb] {\n    font-size: 0.9rem;\n    margin-top: 0.6rem;\n}\n.action-item[data-v-5fa92edb] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-5fa92edb] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n\n/* 自定义模式样式 */\n.stats-display[data-v-5fa92edb] {\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.stat-item[data-v-5fa92edb] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.stat-label[data-v-5fa92edb] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.stat-value[data-v-5fa92edb] {\n  color: var(--color-accent);\n  font-weight: 600;\n}\n\n/* 顶部功能按钮 - 深色玻璃拟态风格 */\n.top-actions-container[data-v-5fa92edb] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-5fa92edb] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-5fa92edb]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n\n/* 亮色主题顶部按钮 */\n[data-theme="light"] .top-actions-container[data-v-5fa92edb] {\n  background: rgba(241, 245, 249, 0.6);\n  border-bottom-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-5fa92edb] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-5fa92edb]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n\n/* 选择模式标签页 */\n.selection-mode-tabs[data-v-5fa92edb] {\n  display: flex;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.mode-tab[data-v-5fa92edb] {\n  flex: 1;\n  padding: 0.8rem 1rem;\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-weight: 500;\n}\n.mode-tab.active[data-v-5fa92edb] {\n  color: var(--color-primary);\n  background: var(--color-surface);\n  border-bottom: 2px solid var(--color-primary);\n}\n.mode-tab[data-v-5fa92edb]:hover:not(.active) {\n  background: rgba(136, 192, 208, 0.1);\n  color: var(--color-text);\n}\n\n/* 自定义模式样式 */\n.custom-mode[data-v-5fa92edb] {\n  flex: 1;\n  padding: 1rem;\n  overflow-y: auto;\n}\n.custom-selection-container[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.selection-group[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.8rem;\n}\n.selection-label[data-v-5fa92edb] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.spirit-type-grid[data-v-5fa92edb] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n  gap: 0.5rem;\n}\n.type-button[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.8rem 0.5rem;\n  border: 2px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-height: 70px;\n}\n.type-button[data-v-5fa92edb]:hover {\n  border-color: var(--element-color, var(--color-primary));\n  background: rgba(136, 192, 208, 0.1);\n}\n.type-button.selected[data-v-5fa92edb] {\n  border-color: var(--element-color, var(--color-primary));\n  background: var(--element-color, var(--color-primary));\n  color: white;\n}\n.type-icon[data-v-5fa92edb] {\n  font-size: 1.2rem;\n}\n.type-name[data-v-5fa92edb] {\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n.tier-selection[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.tier-button[data-v-5fa92edb] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.8rem 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tier-button[data-v-5fa92edb]:hover {\n  border-color: var(--color-primary);\n  background: rgba(136, 192, 208, 0.1);\n}\n.tier-button.selected[data-v-5fa92edb] {\n  border-color: var(--color-primary);\n  background: var(--color-primary);\n  color: white;\n}\n.tier-button.tier-common[data-v-5fa92edb] {\n  border-color: #9CA3AF;\n}\n.tier-button.tier-low[data-v-5fa92edb] {\n  border-color: #8B5CF6;\n}\n.tier-button.tier-middle[data-v-5fa92edb] {\n  border-color: #3B82F6;\n}\n.tier-button.tier-high[data-v-5fa92edb] {\n  border-color: #10B981;\n}\n.tier-button.tier-supreme[data-v-5fa92edb] {\n  border-color: #F59E0B;\n}\n.tier-button.tier-heaven[data-v-5fa92edb] {\n  border-color: #FF6B35;\n}\n.tier-button.tier-divine[data-v-5fa92edb] {\n  border-color: #DC2626;\n}\n.tier-button.tier-special[data-v-5fa92edb] {\n  border-color: #7C3AED;\n}\n.tier-name[data-v-5fa92edb] {\n  font-weight: 600;\n}\n.tier-multiplier[data-v-5fa92edb] {\n  color: var(--color-accent);\n  font-size: 0.9rem;\n}\n.tier-cost[data-v-5fa92edb] {\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n}\n.custom-preview[data-v-5fa92edb] {\n  padding: 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n}\n.preview-title[data-v-5fa92edb] {\n  font-weight: 600;\n  margin-bottom: 0.8rem;\n  color: var(--color-text);\n}\n.preview-content[data-v-5fa92edb] {\n  margin-bottom: 1rem;\n}\n.preview-name[data-v-5fa92edb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.8rem;\n  font-weight: 600;\n  color: var(--color-primary);\n}\n.preview-tier[data-v-5fa92edb] {\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  background: var(--color-accent);\n  color: white;\n}\n.preview-stats[data-v-5fa92edb] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.preview-stats .stat[data-v-5fa92edb] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.confirm-custom-button[data-v-5fa92edb] {\n  width: 100%;\n  padding: 0.8rem;\n  border: none;\n  border-radius: 6px;\n  background: var(--color-primary);\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.confirm-custom-button[data-v-5fa92edb]:hover:not(:disabled) {\n  background: var(--color-primary-dark);\n}\n.confirm-custom-button[data-v-5fa92edb]:disabled {\n  background: var(--color-border);\n  color: var(--color-text-disabled);\n  cursor: not-allowed;\n}\n.actions-container[data-v-5fa92edb] {\n  border-top: 1px solid var(--color-border);\n  background: rgba(0, 0, 0, 0.3);\n  padding: 0.5rem;\n  display: flex;\n  gap: 0.5rem;\n}\n\n/* 兼容新等级名称"仙品" */\n.spirit-root-tier.tier-仙品[data-v-5fa92edb] { background: linear-gradient(135deg, #EF4444, #F87171); color: white;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .spirit-root-left-panel[data-v-5fa92edb],\n[data-theme="light"] .spirit-root-details-container[data-v-5fa92edb] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .spirit-root-item[data-v-5fa92edb] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .spirit-root-item[data-v-5fa92edb]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .spirit-root-item.selected[data-v-5fa92edb] {\n  background: rgba(219, 234, 254, 0.8);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .spirit-root-name[data-v-5fa92edb] {\n  color: #1e293b;\n}\n[data-theme="light"] .spirit-root-item.selected .spirit-root-name[data-v-5fa92edb] {\n  color: #1e40af;\n}\n[data-theme="light"] .spirit-root-details h2[data-v-5fa92edb] {\n  color: #2563eb;\n}\n[data-theme="light"] .description-scroll p[data-v-5fa92edb] {\n  color: #475569;\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-5fa92edb],\n[data-theme="light"] .delete-btn[data-v-5fa92edb] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-5fa92edb]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-5fa92edb]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n',""]);const s=i},295:(e,t,n)=>{"use strict";n.d(t,{A:()=>g});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(660),n.b),d=new URL(n(1530),n.b),u=i()(r()),m=l()(c),p=l()(d);u.push([e.id,`\n.settings-panel[data-v-2a5ea289] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 头部 */\n.panel-header[data-v-2a5ea289] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.header-left[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.header-icon[data-v-2a5ea289] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-2a5ea289] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-2a5ea289] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1e293b;\n}\n.settings-subtitle[data-v-2a5ea289] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.header-actions[data-v-2a5ea289] {\n  display: flex;\n  gap: 0.5rem;\n}\n.action-btn[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n.action-btn[data-v-2a5ea289]:hover {\n  background: #f1f5f9;\n  border-color: #94a3b8;\n}\n.action-btn.primary[data-v-2a5ea289] {\n  background: #3b82f6;\n  border-color: #3b82f6;\n  color: white;\n}\n.action-btn.primary[data-v-2a5ea289]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 设置容器 */\n.settings-container[data-v-2a5ea289] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n\n  /* 滚动条样式 */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.settings-container[data-v-2a5ea289]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-container[data-v-2a5ea289]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-container[data-v-2a5ea289]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.settings-container[data-v-2a5ea289]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n\n/* 设置区块 */\n.settings-section[data-v-2a5ea289] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #e2e8f0;\n  overflow: hidden;\n}\n.section-header[data-v-2a5ea289] {\n  padding: 1rem 1.25rem;\n  background: #f8fafc;\n  border-bottom: 1px solid #e2e8f0;\n}\n.section-title[data-v-2a5ea289] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1e293b;\n}\n.settings-list[data-v-2a5ea289] {\n  padding: 0.5rem;\n}\n\n/* 设置项 */\n.setting-item[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-2a5ea289]:hover {\n  background: #f8fafc;\n}\n.setting-info[data-v-2a5ea289] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-2a5ea289] {\n  font-weight: 500;\n  color: #1e293b;\n  cursor: pointer;\n}\n.setting-desc[data-v-2a5ea289] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.setting-control[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n}\n.model-control[data-v-2a5ea289] {\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.5rem;\n}\n.model-select-row[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.model-search[data-v-2a5ea289] {\n  width: 100%;\n}\n\n/* 控件样式 */\n.setting-select[data-v-2a5ea289] {\n  padding: 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  background: white;\n  color: #374151;\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.setting-select[data-v-2a5ea289]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.range-container[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.setting-range[data-v-2a5ea289] {\n  width: 100px;\n}\n.range-value[data-v-2a5ea289] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n  min-width: 40px;\n}\n\n/* 下拉选择框样式 */\n.setting-select[data-v-2a5ea289] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background-color: white;\n  background-image: url(${m});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: #374151;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: border-color 0.2s ease;\n  appearance: none;\n  min-width: 120px;\n}\n.setting-select[data-v-2a5ea289]:hover {\n  border-color: #94a3b8;\n}\n.setting-select[data-v-2a5ea289]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n[data-theme='dark'] .setting-select[data-v-2a5ea289] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n  background-image: url(${p});\n}\n[data-theme='dark'] .setting-select[data-v-2a5ea289]:hover {\n  border-color: #6b7280;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-2a5ea289] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-2a5ea289] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-2a5ea289] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-2a5ea289]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-2a5ea289] {\n  background-color: #3b82f6;\n}\ninput:checked + .switch-slider[data-v-2a5ea289]:before {\n  transform: translateX(20px);\n}\n\n/* 全宽设置项 */\n.setting-item-full[data-v-2a5ea289] {\n  flex-direction: column;\n  align-items: flex-start;\n}\n.setting-control-full[data-v-2a5ea289] {\n  width: 100%;\n  margin-top: 0.5rem;\n}\n.setting-textarea[data-v-2a5ea289] {\n  width: 100%;\n  padding: 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  background: white;\n  color: #374151;\n  font-size: 0.875rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n}\n.setting-textarea[data-v-2a5ea289]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n.setting-textarea[data-v-2a5ea289]::placeholder {\n  color: #9ca3af;\n}\n[data-theme='dark'] .setting-textarea[data-v-2a5ea289] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .setting-textarea[data-v-2a5ea289]::placeholder {\n  color: #6b7280;\n}\n\n/* 工具按钮 */\n.utility-btn[data-v-2a5ea289] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  background: white;\n  color: #374151;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n.utility-btn[data-v-2a5ea289]:hover {\n  background: #f9fafb;\n  border-color: #9ca3af;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.setting-item[data-v-2a5ea289] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.75rem;\n}\n.setting-control[data-v-2a5ea289] {\n    width: 100%;\n    justify-content: flex-end;\n}\n.model-control[data-v-2a5ea289] {\n    justify-content: flex-start;\n}\n.model-select-row[data-v-2a5ea289] {\n    width: 100%;\n    flex-direction: column;\n    align-items: stretch;\n}\n.model-select-row .setting-select[data-v-2a5ea289],\n  .model-select-row .utility-btn[data-v-2a5ea289] {\n    width: 100%;\n    justify-content: center;\n}\n.range-container[data-v-2a5ea289] {\n    width: 100%;\n    justify-content: space-between;\n}\n.header-actions .btn-text[data-v-2a5ea289] {\n    display: none;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .settings-panel[data-v-2a5ea289] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-2a5ea289],\n[data-theme='dark'] .settings-section[data-v-2a5ea289] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .section-header[data-v-2a5ea289] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-2a5ea289],\n[data-theme='dark'] .section-title[data-v-2a5ea289],\n[data-theme='dark'] .setting-name[data-v-2a5ea289] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .settings-subtitle[data-v-2a5ea289],\n[data-theme='dark'] .setting-desc[data-v-2a5ea289] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .setting-item[data-v-2a5ea289]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .action-btn[data-v-2a5ea289],\n[data-theme='dark'] .setting-select[data-v-2a5ea289],\n[data-theme='dark'] .utility-btn[data-v-2a5ea289] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .action-btn[data-v-2a5ea289]:hover,\n[data-theme='dark'] .utility-btn[data-v-2a5ea289]:hover {\n  background: #4b5563;\n  border-color: #6b7280;\n}\n[data-theme='dark'] .switch-slider[data-v-2a5ea289] {\n  background-color: #4b5563;\n}\n\n/* 授权验证相关样式 */\n.form-input-inline[data-v-2a5ea289] {\n  padding: 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background: white;\n  color: #374151;\n  font-size: 0.875rem;\n  min-width: 200px;\n  transition: all 0.2s ease;\n}\n.form-input-inline[data-v-2a5ea289]:focus {\n  outline: none;\n  border-color: #667eea;\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n}\n.auth-status[data-v-2a5ea289] {\n  padding: 0.5rem 1rem;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n}\n.auth-status.verified[data-v-2a5ea289] {\n  background: #d1fae5;\n  color: #059669;\n  border: 1px solid #a7f3d0;\n}\n.auth-status.unverified[data-v-2a5ea289] {\n  background: #fee2e2;\n  color: #dc2626;\n  border: 1px solid #fecaca;\n}\n.utility-btn.primary[data-v-2a5ea289] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.utility-btn.primary[data-v-2a5ea289]:hover {\n  background: var(--color-primary-dark, #2563eb);\n  border-color: var(--color-primary-dark, #2563eb);\n}\n[data-theme='dark'] .form-input-inline[data-v-2a5ea289] {\n  background: #334155;\n  border-color: #475569;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .auth-status.verified[data-v-2a5ea289] {\n  background: rgba(5, 150, 105, 0.2);\n  color: #6ee7b7;\n  border-color: rgba(5, 150, 105, 0.3);\n}\n[data-theme='dark'] .auth-status.unverified[data-v-2a5ea289] {\n  background: rgba(220, 38, 38, 0.2);\n  color: #fca5a5;\n  border-color: rgba(220, 38, 38, 0.3);\n}\n\n/* 加载脉冲动画 */\n.loading-pulse[data-v-2a5ea289] {\n  animation: pulse-2a5ea289 1.5s ease-in-out infinite;\n}\n@keyframes pulse-2a5ea289 {\n0%,\n  100% {\n    opacity: 1;\n}\n50% {\n    opacity: 0.4;\n}\n}\n\n`,""]);const g=u},406:(e,t,n)=>{"use strict";n.d(t,{Ps:()=>a,lS:()=>o,qh:()=>r});const a='\n# 【数据结构定义】完整SaveData结构\n\n## 1. 角色（V3：角色.*）\n\n### 1.1 身份（Mostly Read-only，路径：`角色.身份`）\n- 名字: string (只读)\n- 性别: "男"|"女"|"其他" (只读)\n- 年龄: number (自动计算，禁改)\n- 出生日期: {年, 月, 日, 小时?, 分钟?} (只读)\n- 世界: string (只读)\n- 种族: string (默认"人族")\n- 天资: string (只读)\n- 出生: string|{名称, 描述} (只读)\n- 灵根: string|{名称, 品级, 描述, 属性[], 修炼加成} (只读)\n- 天赋: [{名称, 描述}] (只读)\n- 先天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (只读，1-10，对修炼/战斗加成占比70%)\n- 后天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (可修改，用add，每项上限20，单次增加1-3点，对加成占比30%)\n  - 获取方式：装备增幅、天赋效果、服用丹药、机缘奇遇(最多+5)、大道感悟、境界突破\n  - 等价原则：先天1点 ≈ 后天2.33点效果\n\n### 1.2 属性（Modifiable，路径：`角色.属性`）\n- 境界: {名称, 阶段, 当前进度, 下一级所需, 突破描述} (用set更新整个对象，突破时必须更新突破描述)\n- 声望: number (用add)\n- 气血: {当前, 上限} (当前用add，上限突破时用add)\n- 灵气: {当前, 上限} (当前用add，上限突破时用add)\n- 神识: {当前, 上限} (当前用add，上限突破时用add)\n- 寿命: {当前, 上限} (当前自动增加，上限突破时用add)\n\n### 1.3 位置（路径：`角色.位置`）\n- 位置: {描述:"大陆·地点", x, y, 灵气浓度} (用set更新整个对象)\n  - 描述: string (必填，格式"大陆·区域·地点")\n  - x: number (横坐标，范围 0-10000)\n  - y: number (纵坐标，范围 0-10000)\n  - 灵气浓度: number (必填，1-100，影响修炼速度)\n    - 1-20: 灵气稀薄（凡间城镇、荒野）\n    - 21-40: 灵气普通（普通修炼场所）\n    - 41-60: 灵气充沛（宗门福地、灵脉附近）\n    - 61-80: 灵气浓郁（秘境、洞府核心）\n    - 81-100: 灵气极盛（仙迹、上古遗址）\n\n### 1.4 效果（buff/debuff，数组；路径：`角色.效果`）\n- 效果: [{状态名称, 类型:"buff"|"debuff", 生成时间, 持续时间分钟, 状态描述, 强度?, 来源?}]\n  - 只能用 push 添加；过期由系统清理\n  - **生成时间字段必填**：使用当前 `元数据.时间` 的完整对象，格式：{年, 月, 日, 小时, 分钟}\n  - 示例：{"action":"push","key":"角色.效果","value":{"状态名称":"灵气充盈","类型":"buff","生成时间":{"年":1000,"月":3,"日":15,"小时":10,"分钟":30},"持续时间分钟":120,"状态描述":"灵气恢复速度提升50%","强度":50}}\n\n### 1.5 装备（Equipment，路径：`角色.装备`）\n- 装备1: string|null (装备ID或null)\n- 装备2: string|null\n- 装备3: string|null\n- 装备4: string|null\n- 装备5: string|null\n- 装备6: string|null\n\n\n## 2. 大道（Modifiable，路径：`角色.大道`）\n- 大道列表: {道名: DaoData对象}\n\n### DaoData对象必需字段\n- 道名: string (如"剑道"、"丹道")\n- 描述: string (大道描述)\n- 阶段列表: DaoStage[] (大道的所有阶段定义，数组)\n- 是否解锁: boolean (是否已解锁此道)\n- 当前阶段: number (阶段索引，0为"入门")\n- 当前经验: number (当前经验值)\n- 总经验: number (总累计经验)\n\n### DaoStage对象字段\n- 阶段名: string (如"入门"、"小成"、"大成"等)\n- 需求经验: number\n- 感悟条目?: string[] (阶段感悟)\n- 突破需求?: string (突破条件描述)\n\n路径示例：\n- set `角色.大道.大道列表.剑道` {"道名":"剑道","描述":"以剑入道","阶段列表":[{"阶段名":"入门","需求经验":100}],"是否解锁":true,"当前阶段":0,"当前经验":0,"总经验":0}\n- add `角色.大道.大道列表.剑道.当前经验` 100\n\n\n## 3. 背包与物品 (Inventory & Items - Modifiable，路径：`角色.背包`)\n\n### 3.1 背包 (Inventory)\n- 灵石: {下品:number, 中品:number, 上品:number, 极品:number} (用add增减)\n- 物品: {物品ID: Item对象} (用set添加完整物品对象，用delete删除)\n\n**【物品操作方式】**\n- 添加新物品: {"action":"set", "key":"角色.背包.物品.{物品ID}", "value":{完整物品对象}}\n- 删除物品: {"action":"delete", "key":"角色.背包.物品.{物品ID}"}\n- 修改物品数量: {"action":"add", "key":"角色.背包.物品.{物品ID}.数量", "value":增减值}\n- 修改物品属性: {"action":"set", "key":"角色.背包.物品.{物品ID}.属性名", "value":"新值"}\n\n示例：\n- 添加物品: {"action":"set", "key":"角色.背包.物品.item_jade_001", "value":{"物品ID":"item_jade_001","名称":"血玉","类型":"其他","品质":{"quality":"玄","grade":5},"数量":1,"描述":"一块染血的玉佩"}}\n- 修改描述: {"action":"set", "key":"角色.背包.物品.item_jade_001.描述", "value":"玉佩上的血渍已被灵气净化"}\n- 修改使用效果: {"action":"set", "key":"角色.背包.物品.item_jade_001.使用效果", "value":"可以注入灵气激活"}\n- 增加数量: {"action":"add", "key":"角色.背包.物品.item_jade_001.数量", "value":1}\n\n### 3.2 物品类型 (Item Types)\n\n#### 3.2.1 装备物品\n完整结构: {物品ID:string, 名称:string, 类型:"装备", 品质:{quality:"凡"|"黄"|"玄"|"地"|"天"|"仙"|"神", grade:0-10}, 数量:number, 描述:string, 装备增幅?:object, 特殊效果?:string, 已装备:boolean}\n\n字段说明:\n- 物品ID: string (必填，唯一标识，格式: equip_时间戳_随机数)\n- 名称: string (必填，装备名称)\n- 类型: "装备" (必填，固定值)\n- 品质: object (必填)\n  - quality: "凡"|"黄"|"玄"|"地"|"天"|"仙"|"神" (品质等级)\n  - grade: number (品级，0-10，0=残缺，1-3=下品，4-6=中品，7-9=上品，10=极品)\n- 数量: number (必填，通常为1，装备不可叠加)\n- 描述: string (必填，装备描述)\n- 装备增幅: object (可选，属性加成对象)\n  - 格式: {"后天六司": {"根骨": 2, "灵性": 1}, "气血上限": 50, "灵气上限": 30}\n  - 后天六司: object (可选，六司加成)\n  - 气血上限: number (可选)\n  - 灵气上限: number (可选)\n  - 神识上限: number (可选)\n- 特殊效果: string (可选，描述装备的特殊能力)\n  - 示例: "攻击时有10%几率触发火焰伤害"\n- 已装备: boolean (必填，true=已装备，false=未装备)\n\n#### 3.2.2 功法物品\n完整结构: {物品ID:string, 名称:string, 类型:"功法", 品质:{quality:"凡"|"黄"|"玄"|"地"|"天"|"仙"|"神", grade:0-10}, 数量:number, 描述:string, 功法效果:string, 功法技能:array, 修炼进度:number, 已解锁技能:array, 已装备:boolean}\n\n字段说明:\n- 物品ID: string (必填，唯一标识，格式: gongfa_时间戳_随机数)\n- 名称: string (必填，功法名称)\n- 类型: "功法" (必填，固定值)\n- 品质: object (必填，同装备)\n- 数量: number (必填，通常为1，功法不可叠加)\n- 描述: string (必填，功法描述)\n- 功法效果: string (必填，描述功法的效果)\n  - 示例: "修炼速度提升300%，对魅惑类术法完全免疫，并能反向掌控施术者心神"\n- 功法技能: array (必填，技能列表，不可为空；至少1个，且第1个技能熟练度要求=0)\n  - 元素格式: {技能名称:string, 技能描述:string, 熟练度要求:number, 消耗?:string}\n  - 消耗格式：只允许 灵气/神识/气血/寿元 四种资源，必须用百分比；寿元用时长描述如"寿元5年"\n  - 可组合消耗：如"灵气20%+神识10%"、"气血30%+灵气15%"\n  - 示例: [{"技能名称":"引气入体","技能描述":"引导天地灵气沿任脉入丹田，凝聚灵力护体","熟练度要求":0,"消耗":"灵气5%"},{"技能名称":"御剑诀","技能描述":"以神识驭剑，剑随心动，可攻敌于十丈之外","熟练度要求":30,"消耗":"灵气12%+神识8%"},{"技能名称":"剑意斩神","技能描述":"凝聚剑意外放，直攻敌人神魂，无视肉身防御","熟练度要求":70,"消耗":"神识30%"}]\n- 修炼进度: number (必填，0-100，表示修炼百分比)\n- 已解锁技能: array (必填，已解锁的技能名称列表，可以为空数组[])\n  - 示例: ["基础剑气", "御剑术"]\n- 已装备: boolean (必填，true=正在修炼，false=未修炼)\n\n重要: 修炼进度和已解锁技能存储在背包物品中，用add/set修改\n示例: {"action":"add", "key":"角色.背包.物品.gongfa_001.修炼进度", "value":10}\n\n#### 3.2.3 消耗品与材料\n完整结构: {物品ID:string, 名称:string, 类型:"丹药"|"材料"|"其他", 品质:{quality:"凡"|"黄"|"玄"|"地"|"天"|"仙"|"神", grade:0-10}, 数量:number, 描述:string, 使用效果?:string}\n\n字段说明:\n- 物品ID: string (必填，唯一标识，格式: item_时间戳_随机数)\n- 名称: string (必填，物品名称)\n- 类型: "丹药"|"材料"|"其他" (必填)\n  - 丹药: 可直接使用的消耗品，如回复丹、增益丹等\n  - 材料: 用于炼丹、炼器等的原材料\n  - 其他: 任务物品、收藏品等杂项\n- 品质: object (必填，同装备)\n- 数量: number (必填，可叠加)\n- 描述: string (必填，物品描述)\n- 使用效果: string (可选，描述物品的使用效果；丹药类建议填写，材料类通常没有)\n  - 示例: "恢复500点气血，并在1小时内提升气血恢复速度50%"\n\n### 3.3 角色.修炼.修炼功法（当前修炼引用）\n**【严禁修改】此字段只存储引用，不存储任何数据！**\n- 物品ID: string (指向背包中的功法ID)\n- 名称: string\n\n**【关键规则】修炼功法的位置和修改方式：**\n- [错误] 错误：修改"角色.背包.物品.{功法ID}"以外的位置来“伪造进度”\n- [正确] 正确：修改"角色.背包.物品.{功法ID}"字段\n- 修炼进度存储位置：角色.背包.物品.{功法ID}.修炼进度\n- 已解锁技能存储位置：角色.背包.物品.{功法ID}.已解锁技能\n- 功法技能列表存储位置：角色.背包.物品.{功法ID}.功法技能\n\n示例操作：\n- 增加修炼进度: {"action":"add", "key":"角色.背包.物品.gongfa_001.修炼进度", "value":10}\n- 解锁新技能: {"action":"push", "key":"角色.背包.物品.gongfa_001.已解锁技能", "value":"御剑术"}\n\n### 3.4 角色.技能.掌握技能（只读）\n**【完全只读】此字段由系统自动计算，AI严禁通过tavern_commands修改！**\n- [{技能名称, 技能描述, 来源, 消耗, 熟练度, 使用次数}]\n\n**【关键规则】掌握技能的位置和来源：**\n- [错误] 错误：直接 set/push "角色.技能.掌握技能" 数组\n- [错误] 错误：修改 "角色.技能.掌握技能" 中的技能名称/描述/来源/消耗\n\n**【数据来源】掌握技能从哪里来：**\n- 系统自动从"角色.背包.物品.{功法ID}.已解锁技能"中提取\n- 当功法装备后，已解锁的技能会自动出现在"角色.技能.掌握技能"中\n- 技能的基础信息（名称、描述、消耗）来自"角色.背包.物品.{功法ID}.功法技能"数组\n\n\n## 4. 关系（NPC档案字典，可修改，路径：`社交.关系`）\n\n### 🚨 【最高优先级】NPC 创建规则 🚨\n**新增 NPC 必须一次性创建完整对象，不能分步添加！**\n\n- **[正确]** 使用 set 操作创建完整的 NPC 对象，包含所有必需字段\n- **[错误]** 先创建空对象，再逐个添加字段\n- **[错误]** 只添加部分字段，缺少必需字段\n- **[强制]** NPC对象里必须包含 `名字` 字段，且与路径中的NPC名一致\n\n### ✅ 【NPC数量很多时的"最小可用字段"】\n当关系数据很多、上下文紧张时，允许精简描述性字段，但 **以下字段绝不能缺失**（否则前端可能无法展示/系统会清理为无效数据）：\n- `名字`、`性别`、`出生日期`、`境界`、`与玩家关系`、`好感度`\n- `当前位置.描述`、`当前外貌状态`、`当前内心想法`\n- `记忆`（数组，可为空数组）、`背包`、`实时关注`\n\n**示例 - 正确做法：**\n```json\n{"action":"set", "key":"社交.关系.张三", "value":{"名字":"张三","性别":"男","年龄":25,"出生日期":{"年":975,"月":3,"日":15},"种族":"人族","出生":"散修","外貌描述":"...","性格特征":["..."],"境界":{"名称":"筑基","阶段":"初期"},"灵根":{"名称":"火灵根","品级":"中品"},"天赋":[],"先天六司":{"根骨":5,"灵性":6,"悟性":5,"气运":4,"魅力":5,"心性":6},"与玩家关系":"陌生人","好感度":0,"人格底线":["..."],"记忆":[],"记忆总结":[],"当前位置":{"描述":"...","x":5000,"y":5000},"势力归属":"无","当前外貌状态":"...","当前内心想法":"...","背包":{"灵石":{"下品":0,"中品":0,"上品":0,"极品":0},"物品":{}},"实时关注":false}}\n```\n\n**示例 - 错误做法（严禁）：**\n```\n❌ 错误：先创建空对象\n{"action":"set", "key":"社交.关系.张三", "value":{}}\n❌ 错误：再添加字段\n{"action":"set", "key":"社交.关系.张三.名字", "value":"张三"}\n```\n\n---\n\n### NPC 数据结构\n- {NPC名字: NPC档案对象}\n  - 名字: string\n  - 性别: "男"|"女"|"其他"\n  - 年龄: number (自动计算)\n  - 出生日期: {年, 月, 日}\n  - 种族: string\n  - 出生: string\n  - 外貌描述: string\n  - 性格特征: [string]\n  - 境界: {名称, 阶段, 当前进度?, 下一级所需?, 突破描述?} (用set更新整个对象)\n  - 灵根: {名称, 品级}\n  - 天赋: [{名称, 描述}]\n  - 先天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性}\n  - 与玩家关系: string\n  - 好感度: number (-100~100，用add)\n  - 人格底线: [string]\n  - 记忆: [string] (用push添加。遵循【记忆生成铁律】：简洁、不重复、结构化摘要)\n  - 记忆总结: [string]\n  - 当前位置: {描述, x, y}\n  - 势力归属: string\n  - 当前外貌状态: string (用set实时更新)\n  - 当前内心想法: string (用set实时更新)\n  - 背包: {灵石, 物品}\n  - 私密信息?: PrivacyProfile (NSFW；仅当 系统.nsfwMode=true 且 性别符合 系统.nsfwGenderFilter 才生成；路径：社交.关系.{NPC名字}.私密信息)\n  - 实时关注: boolean\n\n### NSFW：PrivacyProfile（私密信息模块，路径：社交.关系.{NPC名字}.私密信息）\n- 是否为处女: boolean\n- 身体部位: [BodyPartDevelopment] (数组；每个元素都是对象)\n- 性格倾向: string\n- 性取向: string\n- 性癖好: [string]\n- 性渴望程度: number (0-100)\n- 当前性状态: string\n- 体液分泌状态: string\n- 性交总次数: number\n- 性伴侣名单: [string]\n- 最近一次性行为时间: string\n- 特殊体质: [string]\n\n**重要：修改NPC私密信息时必须使用完整路径**\n示例：\n- 修改NPC身体部位（错误）：❌ {"action":"set","key":"身体.部位开发.阴道.敏感度","value":80}\n- 修改NPC身体部位（正确）：✅ {"action":"set","key":"社交.关系.李媚娘.私密信息.身体部位[0].敏感度","value":80}\n- 添加NPC身体部位：✅ {"action":"push","key":"社交.关系.李媚娘.私密信息.身体部位","value":{"部位名称":"阴道","敏感度":70,"开发度":60,"特征描述":"..."}}\n\n### NSFW：BodyPartDevelopment（身体部位开发条目）\n- 部位名称: string (如：胸部/小穴/菊穴/嘴唇/耳朵等)\n- 敏感度: number (0-100)\n- 开发度: number (0-100；统一使用"开发度"字段名)\n- 特殊印记?: string\n- 特征描述: string\n\n\n## 5. 记忆 (Player Memory - Read-only, DO NOT MODIFY)\n**核心规则**: AI严禁通过 `tavern_commands` 修改任何记忆字段。记忆由系统根据响应JSON中的 `mid_term_memory` 字段自动处理。\n\n**数据结构 (仅供参考)**:\n- 短期记忆: [string]\n- 中期记忆: [string]\n- 长期记忆: [string]\n\n\n## 6. 世界（World - Modifiable；联机模式通常只读）\n- 地图: {continents[], factions[], features[]}\n- 大陆信息: [{名称, 描述, 地理特征, ...}] (只读,由世界生成器创建)\n- 势力信息: [{...}] (可修改,世界中的宗门、世家等)\n  - id: string|number (可选)\n  - 名称: string\n  - 类型: "修仙宗门"|"魔道宗门"|"修仙世家"|...\n  - 等级: "超级"|"一流"|"二流"|"三流"\n  - 位置: string | {x, y}\n  - 描述: string\n  - 特色: [string]\n  - 与玩家关系: "敌对"|"中立"|"友好" (用set修改)\n  - 声望值: number (用add修改)\n  - 可否加入: boolean\n  - 加入条件: [string]\n  - 加入好处: [string]\n  - 成员数量: { 总数, 按境界, 按职位 } (用set修改整个对象)\n    - 总数: number\n    - 按境界: { "练气": number, "筑基": number, ... }\n    - 按职位: { "外门弟子": number, "内门弟子": number, ... }\n  - 领导层: { 宗主, 宗主修为, 副宗主?, 长老数量?, 最强修为, 综合战力? } (用set修改)\n    - 宗主: string (可能因为剧情更换)\n    - 宗主修为: string (例如: "元婴后期",可能突破)\n    - 综合战力: number (1-100)\n  - 势力范围详情: { 控制区域, 影响范围, 战略价值 } (用set修改)\n    - 控制区域: [string]\n    - 影响范围: string\n    - 战略价值: number (1-10)\n\n  重要：修改势力信息时使用路径: 世界.信息.势力信息[索引].字段名\n  示例-修改宗主: {"action":"set", "key":"世界.信息.势力信息[0].领导层.宗主", "value":"新宗主名字"}\n  示例-增加声望: {"action":"add", "key":"世界.信息.势力信息[2].声望值", "value":50}\n  示例-改变关系: {"action":"set", "key":"世界.信息.势力信息[1].与玩家关系", "value":"友好"}\n  示例-更新成员: {"action":"set", "key":"世界.信息.势力信息[0].成员数量", "value":{"总数":500,"按境界":{"练气":300,"筑基":150},"按职位":{"外门弟子":400,"内门弟子":100}}}\n\n- 地点信息: [{名称, 类型, 位置, coordinates, ...}] (可修改,用于添加新发现的地点)\n  重要：添加新地点使用push操作\n  示例-添加地点: {"action":"push", "key":"世界.信息.地点信息", "value":{"名称":"xx秘境","类型":"秘境","位置":"东玄大陆·北部","coordinates":{"x":7500,"y":3000},"描述":"...","安全等级":"危险","开放状态":"未发现"}}\n\n\n## 7. 时间（GameTime，路径：元数据.时间）\n\n### 7.1 时间\n- 年: number\n- 月: number (1-12)\n- 日: number (1-30)\n- 小时: number (0-23)\n- 分钟: number (0-59) (用add推进，自动进位)\n\n### 7.2 宗门系统（路径：社交.宗门）\n**注意**: 社交.宗门 是 V3 结构的宗门系统，开局时玩家未加入宗门时应为 null（不要设置为空对象 {}）。\nAI 开局初始化时**不要修改** 社交.宗门，保持为 null 即可。玩家加入宗门后由系统自动填充。\n\n\n## 8. 事件（Event System - Modifiable，路径：社交.事件）\n- 配置: {启用随机事件, 最小间隔年, 最大间隔年, 事件提示词}\n- 下次事件时间: GameTime|null（由系统调度写入；AI只读）\n- 事件记录: [事件对象]（用push添加新事件，按时间顺序追加）\n\n### 8.1 事件对象结构 (GameEvent)\n- 事件ID: string (唯一ID, 格式: event_时间戳_随机数)\n- 事件名称: string\n- 事件类型: string (例: "宗门大战"/"世界变革"/"异宝降世"/"秘境现世"/"人物风波")\n- 事件描述: string（尽量包含地点、涉及势力/人物、直接后果）\n- 影响等级?: "轻微"|"中等"|"重大"|"灾难"\n- 影响范围?: string（例: "东玄大陆北境"）\n- 相关人物?: string[]\n- 相关势力?: string[]\n- 事件来源: "随机"|"玩家影响"|"系统"\n- 发生时间: {年, 月, 日, 小时, 分钟}（必填；使用当前 元数据.时间）\n\n指令示例：\n- push 社交.事件.事件记录 {事件对象}\n\n\n## 9. 系统配置 (System Config - Read-only)\n- nsfwMode: boolean\n- nsfwGenderFilter: "all"|"female"|"male"\n\n'.trim();function r(e){return e.split("\n").filter(e=>!/nsfw|私密信息|身体部位开发|privacy/i.test(e)).join("\n").trim()}function o(e){return e?a:r(a)}},414:e=>{"use strict";e.exports=Math.round},453:(e,t,n)=>{"use strict";var a,r=n(9612),o=n(9383),i=n(1237),s=n(9290),l=n(9538),c=n(8068),d=n(9675),u=n(5345),m=n(1514),p=n(8968),g=n(6188),h=n(8002),f=n(5880),v=n(414),b=n(3093),y=Function,x=function(e){try{return y('"use strict"; return ('+e+").constructor;")()}catch(e){}},k=n(5795),w=n(655),E=function(){throw new d},N=k?function(){try{return E}catch(e){try{return k(arguments,"callee").get}catch(e){return E}}}():E,S=n(4039)(),V=n(3628),_=n(1064),C=n(8648),A=n(1002),D=n(76),T={},B="undefined"!=typeof Uint8Array&&V?V(Uint8Array):a,I={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?a:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?a:ArrayBuffer,"%ArrayIteratorPrototype%":S&&V?V([][Symbol.iterator]()):a,"%AsyncFromSyncIteratorPrototype%":a,"%AsyncFunction%":T,"%AsyncGenerator%":T,"%AsyncGeneratorFunction%":T,"%AsyncIteratorPrototype%":T,"%Atomics%":"undefined"==typeof Atomics?a:Atomics,"%BigInt%":"undefined"==typeof BigInt?a:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?a:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?a:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?a:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":o,"%eval%":eval,"%EvalError%":i,"%Float16Array%":"undefined"==typeof Float16Array?a:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?a:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?a:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?a:FinalizationRegistry,"%Function%":y,"%GeneratorFunction%":T,"%Int8Array%":"undefined"==typeof Int8Array?a:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?a:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?a:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":S&&V?V(V([][Symbol.iterator]())):a,"%JSON%":"object"==typeof JSON?JSON:a,"%Map%":"undefined"==typeof Map?a:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&S&&V?V((new Map)[Symbol.iterator]()):a,"%Math%":Math,"%Number%":Number,"%Object%":r,"%Object.getOwnPropertyDescriptor%":k,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?a:Promise,"%Proxy%":"undefined"==typeof Proxy?a:Proxy,"%RangeError%":s,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?a:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?a:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&S&&V?V((new Set)[Symbol.iterator]()):a,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?a:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":S&&V?V(""[Symbol.iterator]()):a,"%Symbol%":S?Symbol:a,"%SyntaxError%":c,"%ThrowTypeError%":N,"%TypedArray%":B,"%TypeError%":d,"%Uint8Array%":"undefined"==typeof Uint8Array?a:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?a:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?a:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?a:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?a:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?a:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?a:WeakSet,"%Function.prototype.call%":D,"%Function.prototype.apply%":A,"%Object.defineProperty%":w,"%Object.getPrototypeOf%":_,"%Math.abs%":m,"%Math.floor%":p,"%Math.max%":g,"%Math.min%":h,"%Math.pow%":f,"%Math.round%":v,"%Math.sign%":b,"%Reflect.getPrototypeOf%":C};if(V)try{null.error}catch(e){var z=V(V(e));I["%Error.prototype%"]=z}var M=function e(t){var n;if("%AsyncFunction%"===t)n=x("async function () {}");else if("%GeneratorFunction%"===t)n=x("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=x("async function* () {}");else if("%AsyncGenerator%"===t){var a=e("%AsyncGeneratorFunction%");a&&(n=a.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&V&&(n=V(r.prototype))}return I[t]=n,n},P={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},R=n(6743),$=n(9957),O=R.call(D,Array.prototype.concat),L=R.call(A,Array.prototype.splice),F=R.call(D,String.prototype.replace),j=R.call(D,String.prototype.slice),U=R.call(D,RegExp.prototype.exec),q=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,G=/\\(\\)?/g,H=function(e,t){var n,a=e;if($(P,a)&&(a="%"+(n=P[a])[0]+"%"),$(I,a)){var r=I[a];if(r===T&&(r=M(a)),void 0===r&&!t)throw new d("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:a,value:r}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new d("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new d('"allowMissing" argument must be a boolean');if(null===U(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=j(e,0,1),n=j(e,-1);if("%"===t&&"%"!==n)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var a=[];return F(e,q,function(e,t,n,r){a[a.length]=n?F(r,G,"$1"):t||e}),a}(e),a=n.length>0?n[0]:"",r=H("%"+a+"%",t),o=r.name,i=r.value,s=!1,l=r.alias;l&&(a=l[0],L(n,O([0,1],l)));for(var u=1,m=!0;u<n.length;u+=1){var p=n[u],g=j(p,0,1),h=j(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===h||"'"===h||"`"===h)&&g!==h)throw new c("property names with quotes must have matching quotes");if("constructor"!==p&&m||(s=!0),$(I,o="%"+(a+="."+p)+"%"))i=I[o];else if(null!=i){if(!(p in i)){if(!t)throw new d("base intrinsic for "+e+" exists, but the property is not available.");return}if(k&&u+1>=n.length){var f=k(i,p);i=(m=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:i[p]}else m=$(i,p),i=i[p];m&&!s&&(I[o]=i)}}return i}},507:(e,t,n)=>{"use strict";var a=n(453),r=n(6556),o=n(8859),i=n(9675),s=a("%Map%",!0),l=r("Map.prototype.get",!0),c=r("Map.prototype.set",!0),d=r("Map.prototype.has",!0),u=r("Map.prototype.delete",!0),m=r("Map.prototype.size",!0);e.exports=!!s&&function(){var e,t={assert:function(e){if(!t.has(e))throw new i("Side channel does not contain "+o(e))},delete:function(t){if(e){var n=u(e,t);return 0===m(e)&&(e=void 0),n}return!1},get:function(t){if(e)return l(e,t)},has:function(t){return!!e&&d(e,t)},set:function(t,n){e||(e=new s),c(e,t,n)}};return t}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},602:(e,t,n)=>{"use strict";n.d(t,{P2:()=>g});const a=(e,t)=>t.some(t=>e instanceof t);let r,o;const i=new WeakMap,s=new WeakMap,l=new WeakMap;let c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){c=e(c)}function u(e){return"function"==typeof e?(t=e,(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),m(this.request)}:function(...e){return m(t.apply(p(this),e))}):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const a=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{t(),a()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)});i.set(e,t)}(e),a(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,c):e);var t}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const a=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{t(m(e.result)),a()},o=()=>{n(e.error),a()};e.addEventListener("success",r),e.addEventListener("error",o)});return l.set(t,e),t}(e);if(s.has(e))return s.get(e);const t=u(e);return t!==e&&(s.set(e,t),l.set(t,e)),t}const p=e=>l.get(e);function g(e,t,{blocked:n,upgrade:a,blocking:r,terminated:o}={}){const i=indexedDB.open(e,t),s=m(i);return a&&i.addEventListener("upgradeneeded",e=>{a(m(i.result),e.oldVersion,e.newVersion,m(i.transaction),e)}),n&&i.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}const h=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],v=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const n=t.replace(/FromIndex$/,""),a=t!==n,r=f.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!r&&!h.includes(n))return;const o=async function(e,...t){const o=this.transaction(e,r?"readwrite":"readonly");let i=o.store;return a&&(i=i.index(t.shift())),(await Promise.all([i[n](...t),r&&o.done]))[0]};return v.set(t,o),o}d(e=>({...e,get:(t,n,a)=>b(t,n)||e.get(t,n,a),has:(t,n)=>!!b(t,n)||e.has(t,n)}));const y=["continue","continuePrimaryKey","advance"],x={},k=new WeakMap,w=new WeakMap,E={get(e,t){if(!y.includes(t))return e[t];let n=x[t];return n||(n=x[t]=function(...e){k.set(this,w.get(this)[t](...e))}),n}};async function*N(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,E);for(w.set(n,t),l.set(n,p(t));t;)yield n,t=await(k.get(n)||t.continue()),k.delete(n)}function S(e,t){return t===Symbol.asyncIterator&&a(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&a(e,[IDBIndex,IDBObjectStore])}d(e=>({...e,get:(t,n,a)=>S(t,n)?N:e.get(t,n,a),has:(t,n)=>S(t,n)||e.has(t,n)}))},651:(e,t,n)=>{"use strict";n.d(t,{applyEquipmentBonus:()=>i,removeEquipmentBonus:()=>s});var a=n(2224);function r(e){const t=e;return t.角色?.属性&&"object"==typeof t.角色.属性||(t.角色=t.角色&&"object"==typeof t.角色?t.角色:{},t.角色.属性={境界:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:""},声望:0,气血:{当前:100,上限:100},灵气:{当前:50,上限:50},神识:{当前:10,上限:10},寿命:{当前:18,上限:80}}),t.角色.属性}function o(e){const t=e;return t.角色?.身份&&"object"==typeof t.角色.身份||(t.角色=t.角色&&"object"==typeof t.角色?t.角色:{},t.角色.身份={后天六司:{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}}),{character:t.角色.身份}}function i(e,t){try{const n=r(e),{character:i}=o(e),s=e?.角色?.背包?.物品,l=s?.[t];if(!l||"装备"!==l.类型)return console.warn(`[装备增幅] 物品 ${t} 不是装备类型`),!1;const c=l.装备增幅;if(!c)return console.log(`[装备增幅] 装备 ${l.名称} 没有属性加成`),!0;if(console.log(`[装备增幅] 开始应用装备 ${l.名称} 的属性加成:`,c),c.气血上限&&"number"==typeof c.气血上限){const e=(0,a.get)(n,"气血",{当前:100,上限:100}),t=e.上限+c.气血上限;(0,a.set)(n,"气血.上限",t),console.log(`[装备增幅] 气血上限: ${e.上限} -> ${t} (+${c.气血上限})`)}if(c.灵气上限&&"number"==typeof c.灵气上限){const e=(0,a.get)(n,"灵气",{当前:100,上限:100}),t=e.上限+c.灵气上限;(0,a.set)(n,"灵气.上限",t),console.log(`[装备增幅] 灵气上限: ${e.上限} -> ${t} (+${c.灵气上限})`)}if(c.神识上限&&"number"==typeof c.神识上限){const e=(0,a.get)(n,"神识",{当前:100,上限:100}),t=e.上限+c.神识上限;(0,a.set)(n,"神识.上限",t),console.log(`[装备增幅] 神识上限: ${e.上限} -> ${t} (+${c.神识上限})`)}return c.后天六司&&["根骨","灵性","悟性","气运","魅力","心性"].forEach(e=>{const t=c.后天六司?.[e];if(t&&"number"==typeof t){const n=(0,a.get)(i,`后天六司.${e}`,0),r=n+t;(0,a.set)(i,`后天六司.${e}`,r),console.log(`[装备增幅] 后天六司.${e}: ${n} -> ${r} (+${t})`)}}),console.log(`[装备增幅] ✅ 成功应用装备 ${l.名称} 的属性加成`),!0}catch(e){return console.error("[装备增幅] 应用装备加成失败:",e),!1}}function s(e,t){try{const n=r(e),{character:i}=o(e),s=e?.角色?.背包?.物品,l=s?.[t];if(!l||"装备"!==l.类型)return console.warn(`[装备增幅] 物品 ${t} 不是装备类型`),!1;const c=l.装备增幅;if(!c)return console.log(`[装备增幅] 装备 ${l.名称} 没有属性加成`),!0;if(console.log(`[装备增幅] 开始移除装备 ${l.名称} 的属性加成:`,c),c.气血上限&&"number"==typeof c.气血上限){const e=(0,a.get)(n,"气血",{当前:100,上限:100}),t=Math.max(1,e.上限-c.气血上限);(0,a.set)(n,"气血.上限",t),e.当前>t&&((0,a.set)(n,"气血.当前",t),console.log(`[装备增幅] 气血当前值超过新上限，已调整: ${e.当前} -> ${t}`)),console.log(`[装备增幅] 气血上限: ${e.上限} -> ${t} (-${c.气血上限})`)}if(c.灵气上限&&"number"==typeof c.灵气上限){const e=(0,a.get)(n,"灵气",{当前:100,上限:100}),t=Math.max(1,e.上限-c.灵气上限);(0,a.set)(n,"灵气.上限",t),e.当前>t&&((0,a.set)(n,"灵气.当前",t),console.log(`[装备增幅] 灵气当前值超过新上限，已调整: ${e.当前} -> ${t}`)),console.log(`[装备增幅] 灵气上限: ${e.上限} -> ${t} (-${c.灵气上限})`)}if(c.神识上限&&"number"==typeof c.神识上限){const e=(0,a.get)(n,"神识",{当前:100,上限:100}),t=Math.max(1,e.上限-c.神识上限);(0,a.set)(n,"神识.上限",t),e.当前>t&&((0,a.set)(n,"神识.当前",t),console.log(`[装备增幅] 神识当前值超过新上限，已调整: ${e.当前} -> ${t}`)),console.log(`[装备增幅] 神识上限: ${e.上限} -> ${t} (-${c.神识上限})`)}return c.后天六司&&["根骨","灵性","悟性","气运","魅力","心性"].forEach(e=>{const t=c.后天六司?.[e];if(t&&"number"==typeof t){const n=(0,a.get)(i,`后天六司.${e}`,0),r=Math.max(0,n-t);(0,a.set)(i,`后天六司.${e}`,r),console.log(`[装备增幅] 后天六司.${e}: ${n} -> ${r} (-${t})`)}}),console.log(`[装备增幅] ✅ 成功移除装备 ${l.名称} 的属性加成`),!0}catch(e){return console.error("[装备增幅] 移除装备加成失败:",e),!1}}},655:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},660:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23374151%27 d=%27M6 9L1 4h10z%27/%3E%3C/svg%3E"},758:(e,t,n)=>{"use strict";function a(e,t,n,a){const r=[a];let o=!1,i=!1;for(let n=t;n<e.length;n++){const a=e[n];if(o){if(i){i=!1;continue}if("\\"===a){i=!0;continue}'"'===a&&(o=!1)}else if('"'!==a){if("{"===a)r.push("}");else if("["===a)r.push("]");else if("}"===a||"]"===a){if(a!==r[r.length-1])return null;if(r.pop(),0===r.length)return e.slice(t,n+1).trim()}}else o=!0}return null}function r(e){const t=function(e){if(!e)return null;const t=/```(?:json)?\s*([\s\S]*?)\s*```/gi;for(const n of e.matchAll(t)){const e=(n[1]||"").trim();if(e&&(e.includes("{")||e.includes("[")))return e}const n=[];for(let t=0;t<e.length;t++){const a=e[t];"{"===a&&n.push({index:t,opener:"{",closer:"}"}),"["===a&&n.push({index:t,opener:"[",closer:"]"})}for(const t of n){const n=a(e,t.index,t.opener,t.closer);if(n)return n}return null}(e);if(!t)throw new Error("未找到可解析的 JSON 片段");return JSON.parse(t)}n.d(t,{p:()=>r})},805:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.right-sidebar[data-v-6b21266e] {\n  width: 100%;\n  height: 100%;\n  padding: 16px;\n  box-sizing: border-box;\n  font-family: var(--font-family-sans-serif);\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n}\n.sidebar-header[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding-bottom: 6px;\n  border-bottom: 1px solid var(--color-border);\n  background: transparent;\n}\n.sidebar-title[data-v-6b21266e] {\n  margin: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  text-align: center;\n}\n.title-icon[data-v-6b21266e] {\n  color: var(--color-primary);\n  flex-shrink: 0;\n}\n.title-badge[data-v-6b21266e] {\n  display: inline-block;\n  padding: 2px 8px;\n  border-radius: 9999px;\n  background: var(--color-primary);\n  color: #fff;\n  font-weight: 600;\n  font-size: 12px;\n  letter-spacing: 0.2px;\n}\n\n/* 移除深色主题硬编码，使用CSS变量自动适配 */\n.sidebar-content[data-v-6b21266e] {\n  flex: 1;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.sidebar-content[data-v-6b21266e]::-webkit-scrollbar {\n  width: 4px;\n}\n.sidebar-content[data-v-6b21266e]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.sidebar-content[data-v-6b21266e]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 2px;\n}\n[data-theme=\"dark\"] .sidebar-content[data-v-6b21266e]::-webkit-scrollbar-thumb {\n  background: transparent;\n}\n\n/* 角色基本信息样式 */\n.character-info-section[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.character-basic[data-v-6b21266e] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n}\n.character-basic .detail-item[data-v-6b21266e] {\n  background: var(--color-surface-hover);\n  border-radius: 6px;\n  padding: 8px;\n  font-size: 0.75rem;\n}\n.character-basic .detail-label[data-v-6b21266e] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.character-basic .detail-value[data-v-6b21266e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 角色状态区域样式 */\n.character-state-section[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.character-states[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.state-item[data-v-6b21266e] {\n  background: var(--color-surface-hover);\n  border-radius: 6px;\n  padding: 8px;\n}\n.state-label[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  margin-bottom: 4px;\n  display: block;\n}\n.state-content[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.state-text[data-v-6b21266e] {\n  font-size: 0.7rem;\n  color: var(--color-text-muted);\n  text-align: center;\n}\n.progress-fill.cultivation[data-v-6b21266e] {\n  background: linear-gradient(90deg, #8b5cf6, #a78bfa);\n}\n\n/* 境界进度条 - 冲刺状态（90-99%）黄色 */\n.progress-fill.cultivation.realm-sprint[data-v-6b21266e] {\n  background: linear-gradient(90deg, #f59e0b, #fbbf24);\n  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);\n}\n\n/* 境界进度条 - 突破状态（100%）红色 */\n.progress-fill.cultivation.realm-breakthrough[data-v-6b21266e] {\n  background: linear-gradient(90deg, #ef4444, #f87171);\n  box-shadow: 0 0 12px rgba(239, 68, 68, 0.5);\n  animation: breakthrough-pulse-6b21266e 1.5s ease-in-out infinite;\n}\n@keyframes breakthrough-pulse-6b21266e {\n0%, 100% {\n    box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);\n}\n50% {\n    box-shadow: 0 0 16px rgba(239, 68, 68, 0.7);\n}\n}\n\n/* 进度文本颜色变化 */\n.progress-text.realm-sprint[data-v-6b21266e] {\n  color: #f59e0b;\n  font-weight: 600;\n}\n.progress-text.realm-breakthrough[data-v-6b21266e] {\n  color: #ef4444;\n  font-weight: 700;\n}\n\n/* 突破和冲刺提示 */\n.breakthrough-hint[data-v-6b21266e] {\n  font-size: 0.6rem;\n  color: #ef4444;\n  font-weight: 700;\n  margin-left: 4px;\n  animation: hint-blink-6b21266e 1s ease-in-out infinite;\n}\n.sprint-hint[data-v-6b21266e] {\n  font-size: 0.6rem;\n  color: #f59e0b;\n  font-weight: 600;\n  margin-left: 4px;\n}\n@keyframes hint-blink-6b21266e {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.5;\n}\n}\n\n/* 收缩区域通用样式 */\n.collapsible-section[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding: 0;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.section-header[data-v-6b21266e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n  border-radius: 8px 8px 0 0;\n}\n.section-header[data-v-6b21266e]:hover {\n  background: var(--color-surface-hover);\n}\n.collapse-toggle[data-v-6b21266e] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.collapse-toggle[data-v-6b21266e]:hover {\n  color: var(--color-text);\n  background: var(--color-surface-hover);\n}\n.collapse-toggle svg[data-v-6b21266e] {\n  transform: rotate(0deg);\n  transition: transform 0.2s ease;\n}\n.collapse-toggle.collapsed svg[data-v-6b21266e] {\n  transform: rotate(-90deg);\n}\n.status-details[data-v-6b21266e] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  margin-top: 8px;\n}\n.current-status[data-v-6b21266e] {\n  margin-top: 8px;\n  padding-top: 8px;\n  border-top: 1px solid var(--color-border);\n}\n.current-status .status-details[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  margin-top: 0;\n}\n.detail-item[data-v-6b21266e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n  padding: 6px 8px;\n  background: var(--color-surface-hover);\n  border-radius: 4px;\n  font-size: 0.75rem;\n}\n.detail-label[data-v-6b21266e] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.detail-value[data-v-6b21266e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 六维灵根区域样式 */\n.attributes-section[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.attributes-grid[data-v-6b21266e] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n  margin-bottom: 12px;\n}\n.attribute-item[data-v-6b21266e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.attribute-item[data-v-6b21266e]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.attr-info[data-v-6b21266e] {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.attr-name[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.attr-value[data-v-6b21266e] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  font-weight: 700;\n}\n.attr-quality[data-v-6b21266e] {\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-weight: 600;\n  border: 1px solid;\n}\n\n/* 属性品质颜色 */\n.quality-purple .attr-quality[data-v-6b21266e] {\n  background: #8b5cf6;\n  color: white;\n  border-color: #8b5cf6;\n}\n.quality-orange .attr-quality[data-v-6b21266e] {\n  background: #f59e0b;\n  color: white;\n  border-color: #f59e0b;\n}\n.quality-blue .attr-quality[data-v-6b21266e] {\n  background: #3b82f6;\n  color: white;\n  border-color: #3b82f6;\n}\n.quality-green .attr-quality[data-v-6b21266e] {\n  background: #10b981;\n  color: white;\n  border-color: #10b981;\n}\n.quality-gray .attr-quality[data-v-6b21266e] {\n  background: #6b7280;\n  color: white;\n  border-color: #6b7280;\n}\n\n/* 灵根和声望信息 */\n.spiritual-info[data-v-6b21266e] {\n  border-top: 1px solid var(--color-border);\n  padding-top: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.info-row[data-v-6b21266e] {\n  display: flex;\n}\n.info-item[data-v-6b21266e] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 6px 8px;\n  background: var(--color-surface);\n  border-radius: 4px;\n  font-size: 0.75rem;\n}\n.info-label[data-v-6b21266e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-icon[data-v-6b21266e] {\n  flex-shrink: 0;\n}\n.info-icon.spiritual[data-v-6b21266e] {\n  color: var(--color-accent);\n}\n.info-icon.reputation[data-v-6b21266e] {\n  color: var(--color-warning);\n}\n.info-value[data-v-6b21266e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 图标颜色 */\n.section-icon.attributes[data-v-6b21266e] {\n  color: var(--color-accent);\n}\n\n/* 通用区块样式 */\n.ai-chat-section[data-v-6b21266e],\n.info-section[data-v-6b21266e],\n.cultivation-section[data-v-6b21266e],\n.vitals-section[data-v-6b21266e],\n.attributes-section[data-v-6b21266e],\n.location-section[data-v-6b21266e],\n.wealth-section[data-v-6b21266e] {\n  margin-bottom: 16px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n\n/* 天赋神通特定样式 */\n.talents-list[data-v-6b21266e] {\n  padding: 0 16px 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n/* 空状态样式 */\n.empty-talents[data-v-6b21266e],\n.empty-status[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  text-align: center;\n  gap: 0.5rem;\n}\n.empty-text[data-v-6b21266e] {\n  color: var(--color-text-secondary);\n  font-size: 0.95rem;\n  font-weight: 500;\n  margin-bottom: 0.25rem;\n}\n\n/* 状态效果特定样式 */\n.status-effects[data-v-6b21266e] {\n  padding: 0 16px 16px;\n}\n\n/* 新的标签式状态效果样式 - 紧凑且美观 */\n.status-tags-container[data-v-6b21266e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  padding: 16px;\n}\n.status-tag[data-v-6b21266e] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  border-radius: 20px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border: 1px solid;\n  backdrop-filter: blur(4px);\n  white-space: nowrap;\n  max-width: 100%;\n  overflow: hidden;\n}\n.status-tag.buff[data-v-6b21266e] {\n  background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.2), rgba(var(--color-success-rgb), 0.1));\n  border-color: rgba(var(--color-success-rgb), 0.4);\n  color: var(--color-success);\n}\n.status-tag.debuff[data-v-6b21266e] {\n  background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.2), rgba(var(--color-error-rgb), 0.1));\n  border-color: rgba(var(--color-error-rgb), 0.4);\n  color: var(--color-danger);\n}\n.status-tag[data-v-6b21266e]:hover {\n  transform: translateY(-1px) scale(1.05);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n}\n.status-tag.buff[data-v-6b21266e]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.3), rgba(var(--color-success-rgb), 0.15));\n  border-color: rgba(var(--color-success-rgb), 0.6);\n  box-shadow: 0 4px 12px rgba(var(--color-success-rgb), 0.3);\n}\n.status-tag.debuff[data-v-6b21266e]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.3), rgba(var(--color-error-rgb), 0.15));\n  border-color: rgba(var(--color-error-rgb), 0.6);\n  box-shadow: 0 4px 12px rgba(var(--color-error-rgb), 0.3);\n}\n.tag-icon[data-v-6b21266e] {\n  font-size: 0.8rem;\n  flex-shrink: 0;\n}\n.tag-name[data-v-6b21266e] {\n  font-weight: 600;\n  flex-shrink: 0;\n}\n.tag-intensity[data-v-6b21266e] {\n  font-size: 0.65rem;\n  background: rgba(var(--color-warning-rgb), 0.8);\n  color: var(--color-text);\n  padding: 1px 4px;\n  border-radius: 8px;\n  font-weight: 600;\n  flex-shrink: 0;\n}\n.tag-time[data-v-6b21266e] {\n  font-size: 0.65rem;\n  opacity: 0.8;\n  font-weight: 400;\n  flex-shrink: 0;\n}\n/* 标题样式 - 图标和文字在一行 */\n.section-title[data-v-6b21266e] {\n  margin: 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 6px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.section-title span[data-v-6b21266e] {\n  flex: 1;\n}\n.section-icon[data-v-6b21266e] {\n  color: var(--color-primary);\n  opacity: 0.8;\n  flex-shrink: 0;\n}\n.section-icon.gold[data-v-6b21266e] {\n  color: var(--color-warning);\n}\n.vital-icon[data-v-6b21266e] {\n  flex-shrink: 0;\n}\n.vital-icon.blood[data-v-6b21266e] { color: var(--vital-health);\n}\n.vital-icon.mana[data-v-6b21266e] { color: var(--vital-lingqi);\n}\n.vital-icon.spirit[data-v-6b21266e] { color: var(--vital-spirit);\n}\n.vital-icon.lifespan[data-v-6b21266e] { color: var(--vital-lifespan);\n}\n.vital-icon.reputation[data-v-6b21266e] { color: var(--color-warning);\n}\n\n/* 声望显示样式 */\n.reputation-display[data-v-6b21266e] {\n  margin-top: 8px;\n  border-top: 1px solid var(--color-border);\n  padding-top: 8px;\n}\n.reputation-item[data-v-6b21266e] {\n  background: var(--color-surface);\n  border-radius: 6px;\n  padding: 8px;\n  border: 1px solid var(--color-border);\n  transition: all 0.2s ease;\n}\n.reputation-item[data-v-6b21266e]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.reputation-info[data-v-6b21266e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.reputation-label[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n.reputation-value[data-v-6b21266e] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  padding: 2px 6px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  transition: all 0.3s ease;\n}\n\n/* 声望等级配色 */\n.reputation-neutral[data-v-6b21266e] {\n  color: var(--color-text-secondary);\n  background: rgba(128, 128, 128, 0.1);\n  border: 1px solid rgba(128, 128, 128, 0.3);\n}\n\n/* 正面声望 */\n.reputation-minor[data-v-6b21266e] {\n  color: #10b981;\n  background: rgba(16, 185, 129, 0.1);\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.reputation-known[data-v-6b21266e] {\n  color: #3b82f6;\n  background: rgba(59, 130, 246, 0.1);\n  border: 1px solid rgba(59, 130, 246, 0.3);\n}\n.reputation-notable[data-v-6b21266e] {\n  color: #8b5cf6;\n  background: rgba(139, 92, 246, 0.1);\n  border: 1px solid rgba(139, 92, 246, 0.3);\n}\n.reputation-renowned[data-v-6b21266e] {\n  color: #f59e0b;\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.3);\n}\n.reputation-famous[data-v-6b21266e] {\n  color: #f97316;\n  background: rgba(249, 115, 22, 0.1);\n  border: 1px solid rgba(249, 115, 22, 0.3);\n}\n.reputation-legendary[data-v-6b21266e] {\n  color: #dc2626;\n  background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(239, 68, 68, 0.1));\n  border: 1px solid rgba(220, 38, 38, 0.4);\n  box-shadow: 0 0 8px rgba(220, 38, 38, 0.3);\n}\n\n/* 负面声望（恶名） */\n.reputation-evil-minor[data-v-6b21266e] {\n  color: #6b7280;\n  background: rgba(107, 114, 128, 0.1);\n  border: 1px solid rgba(107, 114, 128, 0.3);\n}\n.reputation-evil-low[data-v-6b21266e] {\n  color: #ef4444;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n}\n.reputation-evil-medium[data-v-6b21266e] {\n  color: #dc2626;\n  background: rgba(220, 38, 38, 0.1);\n  border: 1px solid rgba(220, 38, 38, 0.3);\n}\n.reputation-evil-high[data-v-6b21266e] {\n  color: #991b1b;\n  background: rgba(153, 27, 27, 0.1);\n  border: 1px solid rgba(153, 27, 27, 0.3);\n}\n.reputation-evil-legendary[data-v-6b21266e] {\n  color: #7f1d1d;\n  background: linear-gradient(135deg, rgba(127, 29, 29, 0.2), rgba(153, 27, 27, 0.1));\n  border: 1px solid rgba(127, 29, 29, 0.4);\n  box-shadow: 0 0 8px rgba(127, 29, 29, 0.4);\n}\n.reputation-number[data-v-6b21266e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n}\n\n/* 点击提示样式 */\n.clickable[data-v-6b21266e] {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.clickable[data-v-6b21266e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n  border-color: rgba(var(--color-accent-rgb), 0.5);\n}\n\n/* 天赋卡片样式 - 增强美观性 */\n.talent-card[data-v-6b21266e] {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.15), rgba(var(--color-accent-rgb), 0.1));\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n  border-left: 4px solid var(--color-accent);\n  border-radius: 12px;\n  padding: 16px;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  backdrop-filter: blur(8px);\n  position: relative;\n  overflow: hidden;\n}\n.talent-card[data-v-6b21266e]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg,\n    rgba(var(--color-accent-rgb), 0.1) 0%,\n    rgba(var(--color-accent-rgb), 0.05) 50%,\n    rgba(var(--color-accent-rgb), 0.1) 100%);\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  pointer-events: none;\n}\n.talent-card[data-v-6b21266e]:hover::before {\n  opacity: 1;\n}\n.talent-card[data-v-6b21266e]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.2), rgba(var(--color-accent-rgb), 0.15));\n  border-color: rgba(var(--color-accent-rgb), 0.5);\n  transform: translateX(6px) translateY(-2px);\n  box-shadow: 0 8px 32px rgba(var(--color-accent-rgb), 0.25), 0 0 0 1px rgba(var(--color-accent-rgb), 0.2);\n}\n.talent-header[data-v-6b21266e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: relative;\n  z-index: 1;\n}\n.talent-name[data-v-6b21266e] {\n  font-size: 0.9rem;\n  font-weight: 700;\n  color: var(--color-accent);\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n.talent-level[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  background: linear-gradient(135deg, rgba(var(--color-warning-rgb), 0.2), rgba(var(--color-warning-rgb), 0.1));\n  padding: 4px 10px;\n  border-radius: 12px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.3);\n  backdrop-filter: blur(4px);\n}\n.talent-progress[data-v-6b21266e] {\n  margin-top: 10px;\n  position: relative;\n  z-index: 1;\n}\n.progress-fill.talent[data-v-6b21266e] {\n  background: linear-gradient(90deg, var(--color-accent), var(--color-accent-hover), rgba(var(--color-accent-rgb), 0.9));\n  box-shadow: 0 2px 8px rgba(var(--color-accent-rgb), 0.3);\n}\n\n/* 生命体征样式 */\n.vitals-list[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.vital-item[data-v-6b21266e] {\n  background: var(--color-surface);\n  border-radius: 8px;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  transition: all 0.2s ease;\n}\n.vital-item[data-v-6b21266e]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.vital-info[data-v-6b21266e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.vital-name[data-v-6b21266e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n.vital-text[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.progress-bar[data-v-6b21266e] {\n  height: 6px;\n  background: var(--color-surface-light);\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n}\n.progress-fill[data-v-6b21266e] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n}\n.progress-fill.health[data-v-6b21266e] { background: var(--vital-health);\n}\n.progress-fill.mana[data-v-6b21266e] { background: var(--vital-lingqi);\n}\n.progress-fill.spirit[data-v-6b21266e] { background: var(--vital-spirit);\n}\n/* 寿元进度条统一紫色 */\n.progress-fill.lifespan[data-v-6b21266e] { background: var(--vital-lifespan);\n}\n\n/* 修为状态样式 */\n.realm-display[data-v-6b21266e] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 10px;\n}\n.realm-info[data-v-6b21266e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 8px;\n  flex-direction: column;\n  gap: 4px;\n}\n.realm-name[data-v-6b21266e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-accent);\n}\n.realm-breakthrough[data-v-6b21266e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n  opacity: 0.8;\n}\n.realm-level[data-v-6b21266e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* 凡人境界特殊样式 */\n.realm-mortal[data-v-6b21266e] {\n  padding: 8px;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 4px;\n  text-align: center;\n  border: 1px dashed rgba(var(--color-primary-rgb), 0.3);\n}\n.mortal-text[data-v-6b21266e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  opacity: 0.8;\n}\n.realm-progress[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.progress-text[data-v-6b21266e] {\n  font-size: 0.65rem;\n  color: var(--color-text-muted);\n  text-align: center;\n}\n\n/* 状态效果样式 */\n.status-effects[data-v-6b21266e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.status-effect[data-v-6b21266e] {\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 0.7rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2px;\n}\n.status-effect.buff[data-v-6b21266e] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  color: white;\n  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);\n}\n.status-effect.debuff[data-v-6b21266e] {\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n  color: white;\n  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);\n}\n.status-effect[data-v-6b21266e]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n}\n.effect-name[data-v-6b21266e] {\n  font-size: 0.65rem;\n}\n.effect-time[data-v-6b21266e] {\n  font-size: 0.6rem;\n  opacity: 0.8;\n}\n\n/* 无角色数据样式 */\n.no-character[data-v-6b21266e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  gap: 10px;\n}\n.no-char-text[data-v-6b21266e] {\n  font-size: 0.9rem;\n  color: var(--color-text-muted);\n  font-style: italic;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.right-sidebar[data-v-6b21266e] {\n    padding: 12px;\n}\n.sidebar-title[data-v-6b21266e] {\n    font-size: 0.9rem;\n}\n.section-title[data-v-6b21266e] {\n    font-size: 0.8rem;\n}\n.vitals-list[data-v-6b21266e] {\n    gap: 8px;\n}\n.vital-item[data-v-6b21266e] {\n    padding: 6px;\n}\n.vital-name[data-v-6b21266e] {\n    font-size: 0.7rem;\n}\n.vital-text[data-v-6b21266e] {\n    font-size: 0.65rem;\n}\n.talent-card[data-v-6b21266e] {\n    padding: 10px;\n}\n.talent-name[data-v-6b21266e] {\n    font-size: 0.8rem;\n}\n.status-effect-card[data-v-6b21266e] {\n    padding: 8px 10px;\n}\n.effect-name[data-v-6b21266e] {\n    font-size: 0.75rem;\n}\n.status-tags-container[data-v-6b21266e] {\n    gap: 6px;\n    padding: 8px;\n}\n.status-tag[data-v-6b21266e] {\n    font-size: 0.7rem;\n    padding: 4px 8px;\n    gap: 4px;\n}\n.tag-intensity[data-v-6b21266e] {\n    font-size: 0.6rem;\n    padding: 1px 3px;\n}\n.tag-time[data-v-6b21266e] {\n    font-size: 0.6rem;\n}\n.detail-item[data-v-6b21266e] {\n    padding: 5px 6px;\n    font-size: 0.7rem;\n}\n.attributes-grid[data-v-6b21266e] {\n    gap: 6px;\n}\n.attribute-item[data-v-6b21266e] {\n    padding: 6px;\n}\n.attr-name[data-v-6b21266e] {\n    font-size: 0.7rem;\n}\n.attr-value[data-v-6b21266e] {\n    font-size: 0.8rem;\n}\n.attr-quality[data-v-6b21266e] {\n    font-size: 0.6rem;\n    padding: 1px 4px;\n}\n.info-item[data-v-6b21266e] {\n    padding: 5px 6px;\n    font-size: 0.7rem;\n}\n.realm-name[data-v-6b21266e] {\n    font-size: 0.8rem;\n}\n.progress-bar[data-v-6b21266e] {\n    height: 5px;\n}\n}\n@media (max-width: 480px) {\n.right-sidebar[data-v-6b21266e] {\n    padding: 8px;\n}\n.sidebar-header[data-v-6b21266e] {\n    margin-bottom: 12px;\n    padding-bottom: 8px;\n}\n.vitals-section[data-v-6b21266e],\n  .cultivation-section[data-v-6b21266e],\n  .collapsible-section[data-v-6b21266e] {\n    margin-bottom: 12px;\n    padding: 10px;\n}\n.attributes-section[data-v-6b21266e] {\n    margin-bottom: 12px;\n    padding: 10px;\n}\n.attributes-grid[data-v-6b21266e] {\n    gap: 4px;\n}\n.attribute-item[data-v-6b21266e] {\n    padding: 5px;\n}\n.attr-name[data-v-6b21266e] {\n    font-size: 0.65rem;\n}\n.attr-value[data-v-6b21266e] {\n    font-size: 0.75rem;\n}\n.attr-quality[data-v-6b21266e] {\n    font-size: 0.55rem;\n    padding: 1px 3px;\n}\n.status-details[data-v-6b21266e] {\n    grid-template-columns: 1fr;\n}\n.talents-list[data-v-6b21266e] {\n    padding: 0 12px 12px;\n}\n.status-effects[data-v-6b21266e] {\n    padding: 0 12px 12px;\n}\n.status-tags-container[data-v-6b21266e] {\n    gap: 4px;\n    padding: 6px;\n}\n.status-tag[data-v-6b21266e] {\n    font-size: 0.65rem;\n    padding: 3px 6px;\n    gap: 3px;\n}\n.tag-intensity[data-v-6b21266e] {\n    font-size: 0.55rem;\n    padding: 1px 2px;\n}\n.tag-time[data-v-6b21266e] {\n    font-size: 0.55rem;\n}\n}\n\n/* 平板设备优化 */\n@media (min-width: 769px) and (max-width: 1024px) {\n.right-sidebar[data-v-6b21266e] {\n    padding: 14px;\n}\n.vital-item[data-v-6b21266e] {\n    padding: 7px;\n}\n.talent-card[data-v-6b21266e] {\n    padding: 11px;\n}\n}\n\n/* 大屏幕优化 */\n@media (min-width: 1440px) {\n.right-sidebar[data-v-6b21266e] {\n    padding: 20px;\n}\n.sidebar-title[data-v-6b21266e] {\n    font-size: 1.1rem;\n}\n.section-title[data-v-6b21266e] {\n    font-size: 0.9rem;\n}\n.vital-name[data-v-6b21266e] {\n    font-size: 0.8rem;\n}\n.talent-name[data-v-6b21266e] {\n    font-size: 0.9rem;\n}\n.effect-name[data-v-6b21266e] {\n    font-size: 0.85rem;\n}\n.status-tags-container[data-v-6b21266e] {\n    gap: 10px;\n    padding: 16px;\n}\n.status-tag[data-v-6b21266e] {\n    font-size: 0.8rem;\n    padding: 8px 12px;\n}\n}\n\n/* 深色主题适配：使用CSS变量自动适配 */\n@media (prefers-color-scheme: dark) {\n.right-sidebar[data-v-6b21266e] {\n    background: var(--color-surface);\n}\n.vitals-section[data-v-6b21266e],\n  .cultivation-section[data-v-6b21266e],\n  .collapsible-section[data-v-6b21266e] {\n    background: var(--color-surface-light);\n}\n.status-tag.buff[data-v-6b21266e] {\n    background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.15), rgba(var(--color-success-rgb), 0.08));\n    border-color: rgba(var(--color-success-rgb), 0.3);\n    color: var(--color-success);\n}\n.status-tag.debuff[data-v-6b21266e] {\n    background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.15), rgba(var(--color-error-rgb), 0.08));\n    border-color: rgba(var(--color-error-rgb), 0.3);\n    color: var(--color-danger);\n}\n.status-tag.buff[data-v-6b21266e]:hover {\n    background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.25), rgba(var(--color-success-rgb), 0.12));\n    border-color: rgba(var(--color-success-rgb), 0.5);\n    color: var(--color-success);\n    box-shadow: 0 4px 12px rgba(var(--color-success-rgb), 0.2);\n}\n.status-tag.debuff[data-v-6b21266e]:hover {\n    background: linear-gradient(135deg, rgba(var(--color-error-rgb), 0.25), rgba(var(--color-error-rgb), 0.12));\n    border-color: rgba(var(--color-error-rgb), 0.5);\n    color: var(--color-danger);\n    box-shadow: 0 4px 12px rgba(var(--color-error-rgb), 0.2);\n}\n.tag-intensity[data-v-6b21266e] {\n    background: rgba(var(--color-warning-rgb), 0.9);\n    color: var(--color-text);\n}\n}\n",""]);const s=i},810:(e,t,n)=>{"use strict";n.d(t,{Ey:()=>b,nY:()=>T});var a=n(4061);const r="undefined"!=typeof window;let o;const i=e=>o=e,s=Symbol();function l(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var c;!function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"}(c||(c={}));const d=(()=>"object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:"object"==typeof globalThis?globalThis:{HTMLElement:null})();function u(e,t,n){const a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){f(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function m(e){const t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function p(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,detail:0,screenX:80,screenY:20,clientX:80,clientY:20,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.dispatchEvent(n)}}const g="object"==typeof navigator?navigator:{userAgent:""},h=(()=>/Macintosh/.test(g.userAgent)&&/AppleWebKit/.test(g.userAgent)&&!/Safari/.test(g.userAgent))(),f=r?"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype&&!h?function(e,t="download",n){const a=document.createElement("a");a.download=t,a.rel="noopener","string"==typeof e?(a.href=e,a.origin!==location.origin?m(a.href)?u(e,t,n):(a.target="_blank",p(a)):p(a)):(a.href=URL.createObjectURL(e),setTimeout(function(){URL.revokeObjectURL(a.href)},4e4),setTimeout(function(){p(a)},0))}:"msSaveOrOpenBlob"in g?function(e,t="download",n){if("string"==typeof e)if(m(e))u(e,t,n);else{const t=document.createElement("a");t.href=e,t.target="_blank",setTimeout(function(){p(t)})}else navigator.msSaveOrOpenBlob(function(e,{autoBom:t=!1}={}){return t&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return u(e,t,n);const r="application/octet-stream"===e.type,o=/constructor/i.test(String(d.HTMLElement))||"safari"in d,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||r&&o||h)&&"undefined"!=typeof FileReader){const t=new FileReader;t.onloadend=function(){let e=t.result;if("string"!=typeof e)throw a=null,new Error("Wrong reader.result type");e=i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location.assign(e),a=null},t.readAsDataURL(e)}else{const t=URL.createObjectURL(e);a?a.location.assign(t):location.href=t,a=null,setTimeout(function(){URL.revokeObjectURL(t)},4e4)}}:()=>{},{assign:v}=Object;function b(){const e=(0,a.effectScope)(!0),t=e.run(()=>(0,a.ref)({}));let n=[],r=[];const o=(0,a.markRaw)({install(e){i(o),o._a=e,e.provide(s,o),e.config.globalProperties.$pinia=o,r.forEach(e=>n.push(e)),r=[]},use(e){return this._a?n.push(e):r.push(e),this},_p:n,_a:null,_e:e,_s:new Map,state:t});return o}const y=()=>{};function x(e,t,n,r=y){e.add(t);const o=()=>{e.delete(t)&&r()};return!n&&(0,a.getCurrentScope)()&&(0,a.onScopeDispose)(o),o}function k(e,...t){e.forEach(e=>{e(...t)})}const w=e=>e(),E=Symbol(),N=Symbol();function S(e,t){e instanceof Map&&t instanceof Map?t.forEach((t,n)=>e.set(n,t)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const n in t){if(!t.hasOwnProperty(n))continue;const r=t[n],o=e[n];l(o)&&l(r)&&e.hasOwnProperty(n)&&!(0,a.isRef)(r)&&!(0,a.isReactive)(r)?e[n]=S(o,r):e[n]=r}return e}const V=Symbol();function _(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,V)}const{assign:C}=Object;function A(e){return!(!(0,a.isRef)(e)||!e.effect)}function D(e,t,n={},r,o,s){let l;const d=C({actions:{}},n),u={deep:!0};let m,p,g,h=new Set,f=new Set;const v=r.state.value[e];let b;function V(t){let n;m=p=!1,"function"==typeof t?(t(r.state.value[e]),n={type:c.patchFunction,storeId:e,events:g}):(S(r.state.value[e],t),n={type:c.patchObject,payload:t,storeId:e,events:g});const o=b=Symbol();(0,a.nextTick)().then(()=>{b===o&&(m=!0)}),p=!0,k(h,n,r.state.value[e])}s||v||(r.state.value[e]={}),(0,a.ref)({});const D=s?function(){const{state:e}=n,t=e?e():{};this.$patch(e=>{C(e,t)})}:y,T=(t,n="")=>{if(E in t)return t[N]=n,t;const a=function(){i(r);const n=Array.from(arguments),o=new Set,s=new Set;let l;k(f,{args:n,name:a[N],store:I,after:function(e){o.add(e)},onError:function(e){s.add(e)}});try{l=t.apply(this&&this.$id===e?this:I,n)}catch(e){throw k(s,e),e}return l instanceof Promise?l.then(e=>(k(o,e),e)).catch(e=>(k(s,e),Promise.reject(e))):(k(o,l),l)};return a[E]=!0,a[N]=n,a},B={_p:r,$id:e,$onAction:x.bind(null,f),$patch:V,$reset:D,$subscribe(t,n={}){const o=x(h,t,n.detached,()=>i()),i=l.run(()=>(0,a.watch)(()=>r.state.value[e],a=>{("sync"===n.flush?p:m)&&t({storeId:e,type:c.direct,events:g},a)},C({},u,n)));return o},$dispose:function(){l.stop(),h.clear(),f.clear(),r._s.delete(e)}},I=(0,a.reactive)(B);r._s.set(e,I);const z=(r._a&&r._a.runWithContext||w)(()=>r._e.run(()=>(l=(0,a.effectScope)()).run(()=>t({action:T}))));for(const t in z){const n=z[t];if((0,a.isRef)(n)&&!A(n)||(0,a.isReactive)(n))s||(v&&_(n)&&((0,a.isRef)(n)?n.value=v[t]:S(n,v[t])),r.state.value[e][t]=n);else if("function"==typeof n){const e=T(n,t);z[t]=e,d.actions[t]=n}}return C(I,z),C((0,a.toRaw)(I),z),Object.defineProperty(I,"$state",{get:()=>r.state.value[e],set:e=>{V(t=>{C(t,e)})}}),r._p.forEach(e=>{C(I,l.run(()=>e({store:I,app:r._a,pinia:r,options:d})))}),v&&s&&n.hydrate&&n.hydrate(I.$state,v),m=!0,p=!0,I}function T(e,t,n){let r;const l="function"==typeof t;function c(n,c){const d=(0,a.hasInjectionContext)();return(n=n||(d?(0,a.inject)(s,null):null))&&i(n),(n=o)._s.has(e)||(l?D(e,t,r,n):function(e,t,n){const{state:r,actions:o,getters:s}=t,l=n.state.value[e];let c;c=D(e,function(){l||(n.state.value[e]=r?r():{});const t=(0,a.toRefs)(n.state.value[e]);return C(t,o,Object.keys(s||{}).reduce((t,r)=>(t[r]=(0,a.markRaw)((0,a.computed)(()=>{i(n);const t=n._s.get(e);return s[r].call(t,t)})),t),{}))},t,n,0,!0)}(e,r,n)),n._s.get(e)}return r=l?n:t,c.$id=e,c}},840:(e,t,n)=>{"use strict";n.d(t,{IJ:()=>p,p$:()=>m,q5:()=>u});var a=n(406),r=n(1513),o=n(8651);const i='\n## 输出格式（最高优先级）\n\n仅输出一个 JSON 对象（可用 ```json 代码围栏包裹）；不要输出任何解释性文字/标签。\n\nJSON结构：\n```json\n{\n  "text": "1200-2500字开局叙事（沉浸式、禁止包含任何游戏数据/JSON/标签）",\n  "mid_term_memory": "50-100字摘要（必填，不能为空）",\n  "tavern_commands": [\n    {"action":"set","key":"元数据.时间","value":{"年":1050,"月":1,"日":1,"小时":8,"分钟":0}},\n    {"action":"set","key":"角色.位置","value":{"描述":"大陆·地点","x":5000,"y":5000}},\n    {"action":"set","key":"角色.背包.灵石","value":{"下品":100,"中品":0,"上品":0,"极品":0}}\n  ],\n  "action_options": ["选项1","选项2","选项3","选项4","选项5"]\n}\n```\n\n要求：\n- text 只写故事正文；不要夹带命令、数据、变量名\n- tavern_commands 必须是数组；用 {action,key,value} 格式\n- action_options 必须输出5个且不能为空\n- 严禁输出 `<thinking>` / 思维链 / 推理过程\n'.trim(),s='\n## 初始化命令（tavern_commands）\n\n按顺序执行：\n\n1. **时间** - 设置 `元数据.时间`；并设置 `角色.身份.出生日期`（出生年 = 元数据.时间.年 - 开局年龄）\n2. **位置** - 设置 `角色.位置`，必须包含 {描述, x, y}，从可用地点选择\n3. **声望** - 设置 `角色.属性.声望`（普通0-10, 宗门10-50, 名门50-100）\n4. **随机项** - 若灵根/出身为"随机"，用 `set` 写入 `角色.身份.灵根` / `角色.身份.出生` 的具体内容\n5. **资源** - 设置 `角色.背包.灵石` 与 `角色.背包.物品.{物品ID}`；功法只作为“物品.类型=功法”进入背包\n6. **NPC** - 仅创建文本中明确提到的重要人物（0-3个），写入 `社交.关系.{npcKey}`（npcKey 用 npc_姓名 拼音/英文均可，但要稳定）\n7. **大道** - 若天赋/功法影响大道，写入 `角色.大道.大道列表.{道名}`，必须包含完整对象：{道名,描述,阶段列表:[{阶段名,需求经验}],是否解锁:true,当前阶段:0,当前经验:0,总经验:0}\n\n约束：\n- 所有 key 必须以 `元数据/角色/社交/世界/系统` 开头（短路径）\n'.trim(),l='\n## 叙事要求与文风设定\n\n### 文风基调\n- **修仙正剧风**: 语言要古朴凝练，富有画面感。严禁使用现代白话、网络用语或轻浮的表达。\n- **沉浸式体验**: 侧重描写环境氛围、角色的内心感悟、灵气的流动通过身体的触感，而非单纯罗列数据。\n- **禁止游戏术语**: 文本中严禁出现"玩家"、"获得"、"装备了"、"等级提升"等出戏词汇。\n\n### 修仙逻辑与难度\n- **成仙之难**: 必须体现修仙是"逆天而行"，每一步都充满艰辛。严禁出现"看一眼就学会"、"模仿一下就突破"、"瞬间踏入练气期"等过于随意和容易的描述（即使是天才，也要体现出感悟的深度，而非过程的廉价）。\n- **时间感知**: 修仙无岁月，要体现出时间的流逝感（如"寒来暑往"、"枯坐数日"）。\n- **境界严谨**: 只有拥有功法并经过长时间修炼才能进入练气期。凡人开局绝不可能在此次生成中直接突破。\n\n### 角色塑造\n- **年龄**: 严格从玩家选择的年龄开始，行为举止要符合该年龄段的认知（不要让几岁的孩童说话像老怪）。\n- **一致性**: 出身决定了角色的眼界和起点，必须与玩家选择完全匹配。\n'.trim(),c='\n## 初始资源控制（严格执行）\n\n### 灵石 (基于出身)\n- **贫困/流浪**: 0-10 灵石\n- **凡人/普通**: 10-50 灵石\n- **修仙世家/宗门**: 100-300 灵石\n- **富裕/商贾**: 300-800 灵石\n\n### 物品与装备\n- **数量限制**: 1-5件，宁缺毋滥。\n- **品质限制**: 初始物品必须以**凡品**为主。严禁开局直接给予"地品"、"天品"甚至"神品"宝物（除非选择了顶级"天选之人"类出身，且必须有剧情铺垫）。\n- **功法**: 0-2部。大多数凡人开局不应自带功法，需在剧情中获取或加入宗门后获得。\n\n### NPC与关系\n- **数量**: 0-3个（必须是剧情中产生深刻羁绊的重要人物，路人甲不要生成关系）。\n- **关系**: 初始好感度不宜过高（除非是血亲），体现人情冷暖。\n\n### 境界判定\n- **凡人**: 绝大多数开局应为凡人（境界进度0）。\n- **练气**: 仅当出身为"修仙家族"且年龄较大，或有特殊奇遇背景时，才允许设定为练气初期。\n'.trim(),d=`\n# 角色初始化任务\n\n${i}\n\n---\n\n${s}\n\n---\n\n${l}\n\n---\n\n${c}\n\n---\n\n# 数据结构\n${a.Ps}\n`.trim();function u(e){return e?d:(0,a.qh)(d)}function m(e,t){const{name:n,gender:a,race:r,age:o,world:i,talentTier:s,origin:l,spiritRoot:c,talents:d,attributes:u,difficultyPrompt:m}=e,p="object"==typeof l&&null!==l,g="object"==typeof c&&null!==c,h=d.length>0?d.map(e=>`- ${e.name}: ${e.description}`).join("\n"):"无",f=Object.entries(u).map(([e,t])=>`${e}:${t}`).join(", "),v=t?.availableContinents?.map(e=>`- ${e.name||e.名称}`).join("\n")||"(未生成)",b=t?.availableLocations?.slice(0,8).map(e=>`- ${e.name||e.名称} (${e.type||e.类型})`).join("\n")||"(未生成)";return`\n# 玩家角色数据\n\n## 基础信息\n姓名: ${n} | 性别: ${a} | 种族: ${r} | 年龄: ${o}岁\n\n## 世界\n${i.name} (${i.era})\n${i.description}\n\n## 天资\n${s.name}: ${s.description}\n\n## 出身\n${p?l.name:l}: ${p?l.description:"(随机，需AI生成)"}\n\n## 灵根\n${g?`${c.name} (${c.tier})`:c}: ${g?c.description:"(随机，需AI生成)"}\n\n## 天赋\n${h}\n\n## 先天六司\n${f}\n\n---\n\n## 可用地点\n**大陆**:\n${v}\n\n**地点**:\n${b}\n\n⚠️ 位置必须从上述地点选择，坐标范围: x:0-10000, y:0-10000\n\n---\n\n## 难度设置\n${m||"【难度模式：普通】\n- 世界遵循正常修仙规则，机缘与危险并存"}\n\n---\n\n## 系统设置\n${t?.systemSettings?.nsfwMode?`- **NSFW模式**: 已开启\n- **私密信息生成范围**: ${"all"===t?.systemSettings?.nsfwGenderFilter?"所有NPC":"female"===t?.systemSettings?.nsfwGenderFilter?"仅女性NPC":"仅男性NPC"}\n⚠️ 创建NPC时，若NPC性别符合上述范围，必须生成完整的"私密信息(PrivacyProfile)"字段`:"- **NSFW模式**: 已关闭（不生成私密信息）"}\n\n---\n\n## 输出要求\n严格遵循系统的JSON输出规则：\n- 不要输出 \`<thinking>\` / 思维链 / 任何推理过程标签\n- 正文写入 JSON 的 "text" 字段（不要再输出 "<narrative>" 等标签）\n- 行动选项写入 JSON 的 "action_options" 字段（5个）\n`.trim()}async function p(){const e=`${await(0,r.q)([])}\n\n---\n\n# 当前任务：角色初始化\n\n你现在需要执行角色初始化任务。用户将提供角色的基础信息（姓名、性别、年龄、天赋、灵根、出身等），你需要：\n1. 根据用户选择生成1200-2500字的开局叙事\n2. 通过tavern_commands设置初始数据（时间、位置、资源、NPC等）\n3. 输出5个行动选项\n\n**立即执行任务，输出JSON格式的角色初始化数据。**\n\n---\n\n${i}\n\n---\n\n${s}\n\n---\n\n${l}\n\n---\n\n${c}\n`.trim();return(0,o.isTavernEnv)()?e:(0,a.qh)(e)}'\n# 任务：生成层级地点名\n\n输入: INPUT_PLACEHOLDER\n输出: {"location_name": "区域·建筑·场所"}\n\n要求:\n1. 2-3层级，用"·"分隔\n2. 体现世界特点\n3. 只返回JSON\n'.trim()},876:(e,t,n)=>{"use strict";n.d(t,{s:()=>l});var a=n(4061);const r=localStorage.getItem("language"),o="zh"===r||"en"===r?r:"zh";r||localStorage.setItem("language","zh");const i=(0,a.ref)(o),s={新增:"Add",确认:"Confirm",取消:"Cancel",保存:"Save",删除:"Delete",编辑:"Edit",关闭:"Close",搜索:"Search",加载中:"Loading",重置:"Reset",返回:"Back",下一步:"Next",上一步:"Previous",完成:"Finish",设置:"Settings",提交:"Submit",刷新:"Refresh",导出:"Export",导入:"Import",清空:"Clear",添加:"Add",移除:"Remove",更新:"Update",查看:"View",下载:"Download",上传:"Upload",复制:"Copy",粘贴:"Paste",剪切:"Cut",全选:"Select All",展开:"Expand",收起:"Collapse",详情:"Details",帮助:"Help",关于:"About",跳过:"Skip",重试:"Retry",世界信息:"World Info",用户名:"Username",密码:"Password",确认密码:"Confirm Password",请输入您的用户名:"Enter username",请输入您的身份密码:"Enter password",请再次输入密码:"Re-enter password",注册账号:"Register","登录/注册":"Login",注册:"Register",登入:"Login","已有用户名？立即登入":"Have account? Login","没有账号？立即注册":"New? Register","注册新用户名，踏入修仙之路。":"Register to begin cultivation","登录账户，以便同步云端数据。":"Login to sync progress",正式版:"Release","仙路漫漫 · 逆行九天":"Path to Immortality",单机闭关:"Offline",避世清修·心无旁骛:"Solo Cultivation","独居洞府，专心致志炼就大道根基":"Cultivate alone","所有进度本地存储，断网亦可修行":"All progress saved locally",联机共修:"Online",未开放:"Coming Soon","功能研发中，敬请期待":"Under development","当前版本已封锁联机入口，不影响单机闭关体验":"Online locked",已授权:"Authorized",未授权:"Unauthorized",角色状态:"Character",修行状态:"Cultivation",核心数值:"Vitals",气血:"Qi",灵气:"Spiritual",神识:"Consciousness",寿元:"Lifespan",境界状态:"Realm",境界进度:"Progress",声望:"Reputation",天赋神通:"Talents",状态效果:"Effects",籍籍无名:"Unknown","等待仙缘，引气入体":"Awaiting fate, drawing qi",暂无天赋神通:"No talents yet",清净无为:"Clear and tranquil",增:"Buff",减:"Debuff",请选择角色开启修仙之旅:"Select character to begin",时:"h",分:"m",分钟:"min",自定义天赋:"Custom Talent","天赋《":'Talent "',"》的详细描述暂未开放，请期待后续更新。":'" details coming soon.',恶名昭彰:"Notorious",臭名远扬:"Infamous",声名狼藉:"Disreputable",恶名在外:"Bad Reputation",小有恶名:"Slightly Notorious",传说人物:"Legendary",名满天下:"World-Renowned",威震四方:"Awe-Inspiring",名动一方:"Locally Famous",声名远播:"Well-Known",小有名气:"Slightly Famous",游戏功能:"Functions",修行管理:"Cultivation",背包物品:"Inventory",查看道具装备:"Items",人物详情:"Character",查看修为境界:"View realm",修炼功法:"Techniques",功法修炼技能:"Methods",三千大道:"Three Thousand Dao",修炼万法道途:"Myriad paths",红尘俗事:"Worldly Affairs",人物关系:"Relationships",人情世故网络:"Social network",宗门信息:"Sect",门派势力详情:"Faction",任务日志:"Quests",当前任务进度:"Current quests",世界探索:"Exploration",世界地图:"World Map",事件探索:"Events",世界事件:"World Events",世界变革与危机:"World upheavals",坤舆图志:"Explore",记忆中心:"Memory",重要事件回顾:"Events",游戏变量:"Variables",查看游戏数据:"Game data",系统设置:"Settings",偏好设置:"Preferences",保存游戏:"Save",保存当前进度:"Save progress",退出游戏:"Exit",返回主菜单:"Menu",论道交友:"Online Play",与道友论道:"Chat with friends",退出当前游戏:"Exit current game","联机功能开发中...":"Online feature is under development...","您想如何退出当前游戏？":"How would you like to exit the current game?",保存并退出:"Save and Exit",不保存直接退出:"Exit Without Saving",游戏已保存:"Game Saved","游戏保存失败，但仍会继续退出。":"Save failed, but will still exit.",游戏进度未保存:"Game progress not saved.",characterStatus:"Character Status",cultivationStatus:"Cultivation Status",qi:"Qi",spiritual:"Spiritual",consciousness:"Consciousness",lifespan:"Lifespan",realmStatus:"Realm Status",游戏设置:"Settings",自定义您的游戏体验:"Customize experience",显示设置:"Display",语言设置:"Language",选择界面语言:"Select language",主题模式:"Theme",选择明亮或暗黑主题:"Choose theme",明亮:"Light",暗黑:"Dark",跟随系统:"Auto",界面缩放:"UI Scale",调整UI界面大小:"Adjust size",文字大小:"Font Size",调整游戏文字显示大小:"Adjust text",小:"Small",中:"Medium",大:"Large",快速动画:"Fast Animations",加速界面动画和过渡效果:"Speed up transitions",显示提示:"Show Hints",显示游戏操作提示:"Display hints",高级设置:"Advanced",调试模式:"Debug Mode",开启开发者调试功能:"Dev tools",数据管理:"Data",导出数据:"Export",导出游戏存档:"Export save",导入数据:"Import",导入游戏存档:"Import save",清空数据:"Clear Data",清空所有游戏数据:"Clear all",清理缓存:"Clear Cache",清除游戏临时数据和缓存:"Clear cache",清理:"Clear",导出设置:"Export Settings",备份当前设置配置:"Backup settings",中文:"Chinese",显示操作提示和帮助信息:"Display operation hints and help",行动选项:"Action Options",AI生成可选的行动建议:"AI-generated action suggestions",游戏时间推进时自动发生影响世界的事件:"World events occur as time passes","事件间隔年（最小）":"Min interval (years)","随机事件最短间隔（年）":"Shortest interval (years)","事件间隔年（最大）":"Max interval (years)","随机事件最长间隔（年）":"Longest interval (years)",自定义事件提示词:"Custom Event Prompt","为世界事件生成添加自定义指令（可选）":"Add custom event instructions (optional)","例如：更偏向宗门大战、秘境现世、好友遭遇，并尽量让事件影响玩家...":"e.g.: Focus on sect wars, secret realms, friends, and impact the player...",下次事件:"Next Event",重新抽取下一次世界事件的触发时间:"Resample next world event time",重新抽取:"Resample",系统任务类型:"System Quest Type",选择AI生成任务的风格类型:"Select AI quest style",修仙辅助系统:"Cultivation System",道侣养成系统:"Dao Companion System",宗门发展系统:"Sect Development System",探索冒险系统:"Exploration System",战斗挑战系统:"Combat System",资源收集系统:"Resource Collection System",自定义任务提示词:"Custom Quest Prompt","为AI任务生成添加自定义指令（可选，留空使用默认）":"Add custom instructions (optional)","例如：生成更多战斗类任务，奖励偏向灵石...":"e.g.: More combat quests, spirit stone rewards...",自定义行动选项提示词:"Custom Action Prompt","指导AI生成特定风格的行动选项（可选，留空使用默认）":"Guide AI action style (optional)","例如：多生成修炼和探索类选项，减少战斗选项...":"e.g.: More cultivation options, less combat...","🔞 启用成人内容（私密信息）":"🔞 Enable Adult Content","生成和显示NPC的私密信息模块（包含成人向内容，默认开启）":"Generate NPC private info (adult content)","👥 私密信息生成范围":"👥 Private Info Scope",选择为哪些性别的NPC生成私密信息:"Select NPC gender for private info",所有NPC:"All NPCs","🔧 高级设置":"🔧 Advanced",启用开发者调试信息和详细日志:"Enable debug logs",控制台调试:"Console Debug",在浏览器控制台显示详细调试信息:"Show console debug info",性能监控:"Performance Monitor",监控组件性能和加载时间:"Monitor performance",导入设置:"Import Settings",从文件恢复设置配置:"Restore from file",语言设置已更新:"Language updated",设置面板:"Settings Panel","加载设置失败，将使用默认设置":"Failed to load settings, using defaults",设置已保存并应用:"Settings saved",保存设置失败:"Failed to save settings",设置验证失败:"Settings validation failed",重置设置:"Reset Settings","确定要重置所有设置为默认值吗？这将清除所有自定义配置。":"Reset all settings to default?",确认重置:"Confirm Reset",设置已重置为默认值:"Settings reset to default","确定要清理缓存吗？这将删除临时数据但不会影响存档。":"Clear cache? Temporary data only.",确认清理:"Confirm Clear",已清理:"Cleared",项缓存数据:" cache items",清理缓存失败:"Failed to clear cache","超凡新生 v1.0.0":"Transcendent Rebirth v1.0.0","超凡新生-设置备份-":"TranscendentRebirth-Settings-",设置已导出:"Settings exported",导出设置失败:"Export failed",设置导入成功并应用:"Settings imported",无效的设置文件格式:"Invalid settings file","导入设置失败，请检查文件格式":"Import failed, check format",授权验证成功:"Authorization verified",清除授权验证:"Clear Authorization","确定要清除当前的授权验证信息吗？清除后需要重新验证。":"Clear authorization? Re-verification required.",授权验证信息已清除:"Authorization cleared",请先完成授权验证:"Complete authorization first",角色创建:"Character Creation",创建新角色:"Create Character",角色名称:"Name",请输入角色名称:"Enter name",选择世界:"Select World",选择出身:"Select Origin",选择天赋:"Select Talent",选择灵根:"Select Spirit Root",分配属性:"Allocate Attributes",预览:"Preview",开始修仙之旅:"Begin Journey",世界选择:"World",天赋选择:"Talent",出身选择:"Origin",灵根选择:"Spirit Root",属性分配:"Attributes",角色预览:"Preview",单机模式:"Offline",联机模式:"Online",返回:"Back to Menu",开启超凡新生:"Begin",剩余技能点:"Points",进入超凡新生:"Begin Cultivation","📂 加载预设":"📂 Load Preset","🗑️ 清除自定义":"🗑️ Clear Custom","☁️ 清除云端":"☁️ Clear Cloud",次元选择:"Select World",初始人设:"Choose Talent Tier",出身设置:"Select Origin",基础设定:"Select Spirit Root",天赋选择:"Select Talents",属性加点:"Allocate Attributes",最终预览:"Preview Character","正在推演诸天万界...":"Loading worlds...",致命错误:"Error",自定义世界:"Custom World",AI推演:"AI Generate",暂无本地世界数据:"No local worlds",暂无云端世界数据:"No cloud worlds",请检查网络连接或联系管理员:"Check network","请择一个世界，以开启你的故事。":"Select a world",世界名称:"World Name",时代背景:"Era",世界描述:"Description","例如：九霄界":"e.g.: Nine Heavens","例如：仙道昌隆":"e.g.: Immortal Era","描述这个世界的背景故事、修炼体系特点等...":"Describe the world...",世界名称不可为空:"World name required",'自定义世界 "{0}" 已成功保存！':'World "{0}" saved!',"世界推演中，请稍候...":"AI generating...",AI推演失败:"AI failed","AI推演结果格式错误，无法解析":"Invalid AI response",AI推演结果缺少世界名称:"Missing world name",'AI推演完成！世界 "{0}" 已生成':'World "{0}" generated!',"AI推演失败: {0}":"AI failed: {0}",世界规模配置:"World Config",主要势力:"Major Factions",地点总数:"Total Locations",秘境数量:"Secret Realms",大陆数量:"Continents","推荐: 3-8":"Recommended: 3-8","推荐: 8-15":"Recommended: 8-15","推荐: 3-10":"Recommended: 3-10","范围: 3-7":"Range: 3-7","高级选项（地图技术参数）":"Advanced Options",地图宽度:"Map Width",地图高度:"Map Height","推荐: 3600":"Recommended: 3600","推荐: 2400":"Recommended: 2400",经度范围:"Longitude Range",纬度范围:"Latitude Range",最小经度:"Min Lng",最大经度:"Max Lng",最小纬度:"Min Lat",最大纬度:"Max Lat",随机:"Random",已随机生成世界配置:"Config randomized",已重置为默认配置:"Config reset",配置过高警告:"Config Warning","当前配置可能导致生成失败，建议调整至合理范围":"Config too high",编辑此项:"Edit",删除此项:"Delete",编辑世界:"Edit World",'世界 "{0}" 已更新！':'World "{0}" updated!',"更新世界失败！":"Update failed!","感应天道，测算天资...":"Loading talent tiers...",天机混沌:"Error",自定义天资:"Custom Tier",天资名称:"Tier Name",天资描述:"Description",技能点:"Points",辉光颜色:"Glow Color","例如：凡人":"e.g.: Mortal","描述此天资的特点...":"Describe this tier...","例如：10":"e.g.: 10","例如：#808080":"e.g.: #808080",天资名称不可为空:"Tier name required",技能点必须是非负数:"Points must be non-negative",'自定义天资 "{0}" 已保存！':'Tier "{0}" saved!',"保存自定义天资失败！":"Save failed!",'AI推演完成！天资 "{0}" 已生成':'Tier "{0}" generated!',"请选择你的天资等级，这将决定你的起点。":"Select your talent tier",编辑天资:"Edit Tier",'天资 "{0}" 已更新！':'Tier "{0}" updated!',"更新天资失败！":"Update failed!","追溯过往，探寻出身...":"Loading origins...",因果不明:"Error",自定义出身:"Custom Origin",随机出身:"Random Origin","0 点":"0 pts",出身名称:"Origin Name",出身描述:"Description","例如：山野遗孤":"e.g.: Orphan","描述此出身的背景故事和成长经历...":"Describe this origin...",出身名称不可为空:"Origin name required",出身描述不可为空:"Description required",'自定义出身 "{0}" 已保存！':'Origin "{0}" saved!',"保存自定义出身失败！":"Save failed!","请先选择一方大千世界，方可推演出身。":"Select world first",'AI推演完成！出身 "{0}" 已生成':'Origin "{0}" generated!',"天道无常，造化弄人。选择此项，你的出身将完全随机生成。是生于帝王之家，或为山野遗孤，皆在天道一念之间。":"Random origin description","身世如谜，过往一片空白。":"Unknown origin","消耗技能点: {0}":"Cost: {0} pts","请选择一处出身，或听天由命。":"Select an origin","技能点不足，无法选择此出身。":"Insufficient points",编辑出身:"Edit Origin",'出身 "{0}" 已更新！':'Origin "{0}" updated!',"更新出身失败！":"Update failed!","天地玄黄，探查灵根...":"Loading spirit roots...",高级自定义:"Advanced Custom",预设灵根:"Preset Roots",组合选择:"Custom Combo",随机灵根:"Random Root",灵根名称:"Root Name",品级:"Grade",灵根描述:"Description",修炼倍率:"Multiplier",消耗技能点:"Cost",特殊效果:"Special Effects","例如：混沌灵根":"e.g.: Chaos Root","描述这个灵根的特性和背景故事...":"Describe this root...","例如：1.5":"e.g.: 1.5","效果描述，如：雷系法术威力+80%":"e.g.: Thunder +80%",灵根名称不可为空:"Root name required",请选择品级:"Select grade",灵根描述不可为空:"Description required",修炼倍率必须为数字:"Multiplier must be number",消耗点数必须为数字:"Cost must be number",'自定义灵根 "{0}" 已保存！':'Root "{0}" saved!',"保存自定义灵根失败！":"Save failed!",'AI推演完成！灵根 "{0}" 已生成':'Root "{0}" generated!',灵根类型:"Root Type",灵根品级:"Grade",火:"Fire",水:"Water",木:"Wood",金:"Metal",土:"Earth",风:"Wind",雷:"Thunder",冰:"Ice",光:"Light",暗:"Dark",空间:"Space",时间:"Time",凡品:"Common",下品:"Low",中品:"Middle",上品:"High",极品:"Supreme",仙品:"Heaven",神品:"Divine",特殊:"Special",请选择灵根类型:"Select root type",请选择灵根品级:"Select grade",确认选择:"Confirm",请完整选择灵根类型和品级:"Complete selection",选择的灵根配置无效:"Invalid config",'自定义灵根 "{0}" 已创建！':'Root "{0}" created!',"修炼倍率:":"Multiplier:","消耗技能点:":"Cost:","请选择一种灵根，或听天由命。":"Select a spirit root","大道五十，天衍四九，人遁其一。选择此项，你的灵根将完全随机生成，可能一步登天，亦可能平庸无奇。":"Random root description","灵根信息不明。":"Unknown root","技能点不足，无法选择此灵根。":"Insufficient points",编辑灵根:"Edit Root",'灵根 "{0}" 已更新！':'Root "{0}" updated!',"更新灵根失败！":"Update failed!","于时光长河中搜寻天赋...":"Loading talents...",天赋名称:"Talent Name",天赋描述:"Description",技能点消耗:"Cost","例如：道心天成":"e.g.: Dao Heart","描述此天赋的本质...":"Describe this talent...",天赋名称不可为空:"Talent name required",天赋描述不可为空:"Description required",技能点消耗必须填写:"Cost required",技能点消耗不能为负数:"Cost cannot be negative",'自定义天赋 "{0}" 已保存！':'Talent "{0}" saved!',"保存自定义天赋失败！":"Save failed!",'AI推演完成！天赋 "{0}" 已生成':'Talent "{0}" generated!',"请选择天赋。":"Select talents","此天赋之玄妙，需自行领悟。":"Unknown talent",编辑天赋:"Edit Talent",'天赋 "{0}" 已更新！':'Talent "{0}" updated!',先天六命分配:"Attribute Allocation","剩余技能点:":"Remaining Points:",根骨:"Root Bone",灵性:"Spirituality",悟性:"Comprehension",气运:"Fortune",魅力:"Charm",心性:"Temperament","决定气血上限、恢复速度、寿命上限。影响炼体修行、抗打击能力。":"Affects vitality and lifespan","决定灵气上限、吸收效率。影响修炼速度、法术威力。":"Affects spiritual power","决定神识上限、学习效率。影响功法领悟、技能掌握速度。":"Affects learning speed","决定各种概率、物品掉落品质。影响天材地宝获取、贵人相助。":"Affects luck and drops","决定初始好感度、社交加成。影响NPC互动、门派声望获取。":"Affects social interactions","决定心魔抗性、意志力。影响走火入魔抵抗、关键抉择。":"Affects willpower","🎲 随机":"🎲 Random","⚖️ 均衡":"⚖️ Balance",最终预览:"Final Preview","请确认你的选择，此为踏入超凡新生的最后一步。":"Confirm your choices","用户名:":"Name:","正在从酒馆获取...":"Loading from tavern...","种族:":"Race:",人族:"Human",性别:"Gender",男:"Male",女:"Female",双性:"Hermaphrodite",初始年龄:"Starting Age",开局模式:"Start Mode",流式开局:"Streaming Start",非流式开局:"Non-Streaming Start","流式开局：更快，可能被中断":"Streaming: Faster, may be interrupted","非流式开局：一次性生成完整内容，更稳定可靠":"Non-Streaming: Complete generation, more stable",岁:" years old",所选世界:"Selected World",未选择:"Not selected",暂无描述:"No description",未选择任何天赋:"No talents selected",命格天定:"Fate Determined","联机模式下，角色的初始命格将由所选世界的天道法则在云端生成，以确保公平与平衡。":"Online mode description",加载存档:"Continue Journey",选择一个存档进入:"Select a character",角色列表:"Characters",个角色:" characters",存档管理:"Save Management",导出存档:"Export Saves",导入存档:"Import Saves",导出选中角色的存档:"Export saves",向选中角色导入存档:"Import saves",未找到任何存档:"No Characters","尚未创建任何存档，请返回主页开启你的冒险之旅":"Create a character first",踏入超凡新生:"Begin Journey",导入角色:"Import Character",请选择左侧角色查看存档详情:"Select a character","正在加载存档...":"Loading saves...",手动存档:"Manual Saves",存档通过游戏内保存功能创建:"Created via in-game save",空存档槽:"Empty Slot",通过游戏内保存创建:"Create via in-game save",重命名:"Rename","上次对话存档不可删除（用于回滚）":"Cannot delete last save","时间点存档不可删除（定时自动覆盖）":"Cannot delete time save","无法删除：至少需要保留一个手动存档":"Must keep one save",删除存档:"Delete Save",云端存档:"Cloud Save",待同步:"Pending",已同步:"Synced",进入游戏:"Enter Game",同步云端:"Sync Cloud",尚未开始修行:"Not started",开始游戏:"Start Game",删除角色:"Delete Character",'确定要彻底删除角色"{0}"及其所有修行记录吗？此操作不可恢复。':'Delete character "{0}"?',无法删除存档:"Cannot Delete","无法删除该存档：角色至少需要保留一个存档。如需删除，请先创建其他存档或删除整个角色。":"Must keep one save",'确定要删除角色"{0}"的"{1}"吗？此操作不可恢复。':'Delete save "{1}"?',重命名存档:"Rename Save","请输入新的存档名称：":"Enter new name:",重命名失败:"Rename Failed","存档名称已存在，请使用其他名称。":"Name exists",需要登录:"Login Required",请先登录以管理联机角色存档:"Login to manage online saves",登入道籍:"Login",创建新存档:"Create Save","是否在【{0}】位置创建新的存档开始游戏？":'Create save at "{0}"?',开启新征程:"New Journey",'是否在存档位 "{0}" 开始一段新的修行？':'Start at "{0}"?','角色 "{0}" 已导出':'Character "{0}" exported',导出角色失败:"Export failed",请先选择一个角色:"Select a character first",该角色没有可导出的存档:"No saves to export",存档已导出:"Saves exported",请先选择一个角色以导入存档:"Select character first","文件格式无效，请选择一个存档文件。":"Invalid save file",'确定要将 {0} 个存档导入到角色 "{1}" 吗？同名存档将被覆盖。':'Import {0} saves to "{1}"?','成功为角色 "{0}" 导入 {1} 个存档':"Imported {0} saves","导入存档失败: {0}":"Import failed: {0}","文件格式无效，请选择一个角色文件。":"Invalid character file",'确定要导入角色 "{0}" 吗？':'Import character "{0}"?','成功导入角色 "{0}"':'Character "{0}" imported',"导入角色失败: {0}":"Import failed: {0}","处理导入文件失败: {0}":"File processing failed: {0}",基础信息:"Basic Info",暂无天赋:"No talents","请描述你想生成什么内容：":"Describe what to generate:","例如：生成一个火属性的天赋，适合剑修...":"e.g.: Fire talent for sword cultivator...","请输入兑换码以创建联机世界进行AI推演。":"Enter redemption code for AI generation",请输入兑换码:"Enter code","验证中...":"Verifying...","兑换码不可为空。":"Code required","兑换码验证失败，请检查后重试。":"Verification failed",自定义AI推演:"Custom AI Generation",'描述你希望的世界风格、时代背景或特色设定（可含对话，使用中文引号""，每句仅一对）':"Describe world style","提示词 (可选)":"Prompt (optional)","例如：现代都市修仙世界，灵气复苏，科技与修真并存...":"e.g.: Modern cultivation world...",建议提示词:"Suggested Prompts","本联机谨遵天道法则：不存储任何对话记录":"No chat logs stored","仅保留法身属性、境界进度等修行要素，确保道友隐私清净无染":"Only cultivation data saved",仅女性:"Female Only",仅男性:"Male Only",所有性别:"All Genders","道法自然，天地初开":"Dao of Nature, Heaven and Earth Begin","正在加载修仙世界...":"Loading cultivation world...",连接天道:"Connecting to Heavenly Dao",加载角色数据:"Loading character data",读取存档信息:"Reading save data","提示：请在左侧菜单选择角色并加载存档":"Tip: Select character and load save from left menu",成功:"Success",失败:"Failed",错误:"Error",警告:"Warning",信息:"Info",进行中:"In Progress",已完成:"Completed",未开始:"Not Started",已取消:"Cancelled",全部:"All",无:"None",空:"Empty",暂无数据:"No Data",暂无:"None",请输入:"Enter",请选择:"Select",确定要:"Confirm",操作成功:"Success",操作失败:"Failed",保存成功:"Saved",保存失败:"Save Failed",删除成功:"Deleted",删除失败:"Delete Failed",加载失败:"Load Failed",网络错误:"Network Error",未知错误:"Unknown Error",超凡新生:"Transcendent Rebirth",凡人:"Mortal",初始地:"Starting Point",仙道:"Immortal Dao",年:"Year",月:"Month",日:"Day",元年:"Year 1",任务:"Quests",寻找机缘:"Seek Opportunity","推演中...":"Generating...",宗门:"Sect",奇遇:"Adventure",日常:"Daily",系统任务:"System Quest",道侣培养:"Companion",修为提升:"Cultivation",收集资源:"Collect",战斗挑战:"Combat",任务系统配置:"Quest Config",默认任务数量:"Default Quest Count",自动刷新:"Auto Refresh",自动刷新任务:"Auto refresh quests",完成任务后自动生成新任务:"Auto generate after completion",任务池中保持的未完成任务数量:"Unfinished quest count in pool",保存配置:"Save Config",删除任务:"Delete Quest","为AI任务生成添加自定义指令（可选）":"Add custom instructions (optional)",势力宗门:"Factions","搜索宗门...":"Search sects...","正在读取宗门信息...":"Loading sects...",暂无宗门信息:"No sect info",世界信息将由AI根据游戏进程生成:"World info generated by AI",调试信息:"Debug Info",从酒馆同步数据:"Sync from Tavern",强制刷新:"Force Refresh",成员统计:"Member Stats",总人数:"Total Members",人:" members",境界分布:"Realm Distribution",职位分布:"Position Distribution",宗门类型:"Sect Type",宗门等级:"Sect Level",所在大洲:"Continent",主要资源:"Main Resources",宗门领导:"Leadership",宗主:"Sect Master",副宗主:"Vice Master",最强修为:"Peak Power",综合战力:"Overall Power",宗门描述:"Description",宗门特色:"Specialties",关系状态:"Relations",与你的关系:"Your Relation",声望值:"Reputation",势力范围:"Territory",影响范围:"Influence",控制区域:"Controlled Areas",战略价值:"Strategic Value",加入条件:"Join Requirements",加入好处:"Benefits",申请加入:"Apply",我的宗门身份:"My Sect Status",职位:"Position",贡献点:"Contribution",加入时间:"Join Date",宗门势力:"Sect Actions",宗门任务:"Sect Quests",贡献兑换:"Contribution Exchange",宗门藏书:"Sect Library",同门师兄弟:"Fellow Disciples","搜索人物...":"Search people...","正在读取人际关系...":"Loading relationships...",尚未建立人际关系:"No relationships yet",在游戏中与更多人物互动建立关系:"Interact to build relationships",取消关注:"Unfollow",添加关注:"Follow",删除人物:"Delete NPC","境界:":"Realm:",好感:"Favor",基础档案:"Profile",外貌与性格:"Appearance",性格特征:"Personality",天赋能力:"Talents",最近记忆:"Recent Memories",人格底线:"Bottom Line","触犯人格底线将导致好感度断崖式下跌（-30 ~ -60），关系破裂且极难修复":"Violating bottom line causes severe favor loss","当前状态（实时）":"Current Status",外貌状态:"Appearance",内心想法:"Thoughts",私密信息:"Private Info",状态与欲望:"Status & Desire",性状态:"Sexual Status",性渴望:"Desire",贞洁:"Virginity",处女:"Virgin",非处:"Non-virgin",处男:"Virgin",性格倾向:"Personality",性取向:"Orientation",异性恋:"Heterosexual",性伴侣名单:"Partners",性经验统计:"Experience",性交总次数:"Total Times",次:" times",性伴侣数量:"Partner Count","最近一次：":"Last Time:",身体部位开发:"Body Development",部位名称:"Part",特殊标记:"Mark",特征描述:"Description",敏感度:"Sensitivity",开发度:"Development",体液状态:"Fluid Status",癖好与体质:"Fetishes & Traits",性癖好:"Fetishes",特殊体质:"Special Traits",记忆档案:"Memory Archive",记忆:"Memory",条:" items","总结中...":"Summarizing...",上一页:"Previous",下一页:"Next",此人暂无记忆:"No memories","原始数据 (JSON)":"Raw Data (JSON)",背包:"Inventory",下品灵石:"Low Spirit Stone",中品灵石:"Mid Spirit Stone",上品灵石:"High Spirit Stone",极品灵石:"Top Spirit Stone",交易:"Trade",索要:"Request",偷窃:"Steal",已移除图片:"Image removed",本次对话无变更记录:"No changes in this conversation",切换功法:"Switch Technique",当前正在修炼:"Currently cultivating",确定要切换到:"Switch to",吗:"",卸下功法:"Unequip Technique",确定要卸下:"Confirm unequip",确定卸下:"Confirm",存档:"Saves",当前进度:"Current Progress",上次对话:"Last Conversation",时间点存档:"Time Save","每次对话前自动备份，可用于回退到上次对话前的状态":"Auto backup before conversation","按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失":"Auto save at intervals",创建时间:"Created",最后保存:"Last Saved",存档列表:"Save List",新建存档:"New Save","修仙路上尚未留存，创建存档记录道途":"No saves yet, create one",开始游戏后可以创建存档:"You can create saves after starting the game",读取存档:"Load",回滚:"Rollback",覆盖:"Overwrite",自动存档设置:"Auto Save Settings",对话前自动备份:"Backup Before Chat",存档间隔:"Save Interval",存档操作:"Save Operations",备份所有存档到文件:"Backup all saves",从文件恢复存档:"Restore from file",清空存档:"Clear Saves",删除所有存档数据:"Delete all saves","加载三千大道数据中...":"Loading Dao data...",已解锁大道:"Unlocked Dao",总感悟经验:"Total Experience",高阶段大道:"High Stage Dao",尚未解锁任何大道:"No Dao unlocked","通过机缘、顿悟和修行来解锁新的大道":"Unlock through cultivation",大道感悟:"Dao Insight","无量大道，由心而生":"Infinite Dao from heart",感悟统计:"Stats",突破所需:"Required",深入感悟此道:"Deepen insight",定位到玩家位置:"Locate Player",全屏显示:"Fullscreen",调试地图数据:"Debug Map",图例:"Legend",城镇坊市:"Towns",洞天福地:"Blessed Lands",奇珍异地:"Treasure Lands",凶险之地:"Dangerous Areas",其他特殊:"Special",大洲:"Continent",安全等级:"Safety Level",气候类型:"Climate",地形特征:"Terrain",天然屏障:"Barriers",短期记忆:"Short-term Memory","脑海中一片清净，尚未留下修行痕迹...":"Mind is clear, no cultivation traces yet...","API连接中...":"Sensing the Heavenly Dao...",字:"chars","如果长时间无响应，点击此处重置状态":"If no response for a long time, click here to reset state",回滚到上次对话前的状态:"Rollback to state before last conversation",查看本次对话的变更日志:"View change log for this conversation","静待世界变化...":"Awaiting the changes of fate...",最近操作:"Recent Actions",清空记录:"Clear records",撤回并恢复:"Undo and restore",删除此动作:"Delete this action","请输入您的选择或行动...":"Enter your choice or action...","请先选择角色...":"Please select a character first...",流式:"Stream",快捷行动:"Quick Actions",修炼时间:"Cultivation Time","自定义：":"Custom:",天:"days",选项:"Options",上传图片:"Upload image",移除图片:"Remove image","加载角色数据..":"Loading character data...",无法加载角色数据:"Unable to load character data",点击查看详情:"Click for details",修为进度:"Cultivation Progress",等待仙缘:"Waiting for Destiny",生命状态:"Vitals",角色背景:"Background",年龄:"Age",天赋与灵根:"Talents & Spirit Root",天资等级:"Talent Tier",灵根属性:"Spirit Root Attributes",天赋特质:"Talents",六司属性:"Six Attributes",最终六司:"Final Attributes",后天六司:"Acquired Attributes",尚未修炼功法:"No technique being cultivated",品:"Grade",阶:"Rank","此功法奥妙无穷，随修炼加深方可领悟其真意。":"This technique is profound. Its true meaning can only be understood with deeper cultivation.",功法效果:"Technique Effects","修炼加成：":"Cultivation Bonus:","属性提升：":"Attribute Boost:",此功法无特殊效果:"This technique has no special effects",已掌握技能:"Mastered Skills",个:"",所有技能:"All Skills",熟练度:"Proficiency",未解锁技能:"Locked Skills",尚未解锁大道:"No Dao unlocked",已解:"Unlocked",条大道:" Dao",第:"Stage ",阶段:"",还有:" and ","条大道..":" more Dao...",当前经验:"Current EXP",总经验:"Total EXP",人际关系:"Relationships",暂无人际关系:"No relationships yet",平均好感:"Avg. Favorability",背包概览:"Inventory Overview",物品总数:"Total Items",法宝数量:"Artifacts",功法数量:"Techniques",灵石储备:"Spirit Stones",贡献值:"Contribution",关系:"Relation",已解锁:"Unlocked",解锁条件:"Unlock Condition",技能来源:"Skill Source",技能描述:"Description",当前阶段:"Current Stage",修炼感悟:"Insights",修炼速度:"Cultivation Speed",详细信息:"Detailed Info","基础倍率:":"Base Multiplier:",野性本能:"Wild Instinct",自然状态:"Natural State",等待觉醒:"Awaiting Awakening",自动解锁:"Auto Unlock",需要熟练度:"Requires Proficiency",功法技能:"Technique Skill",功法:"Technique",通过功法修炼掌握:"Mastered through cultivation",掌握技能:"Mastered Skill",未知天赋:"Unknown Talent",'确定要移除状态效果"{0}"吗？':'Are you sure you want to remove the status effect "{0}"?',角色详情面板:"Character Details Panel",存档数据不存在:"Save data does not exist","已移除状态效果: {0}":"Removed status effect: {0}","未找到状态效果: {0}":"Status effect not found: {0}","移除状态效果失败:":"Failed to remove status effect:",初始阶段:"Initial Stage","此大道已解锁，但尚未开始修炼":"This Dao is unlocked, but cultivation has not yet begun",未门:"Uninitiated","第{0}阶段":"Stage {0}","此道深奥玄妙，需持之以恒方能有所成就":"This Dao is profound and requires perseverance to achieve mastery",已掌握:"Mastered",修炼完成:"Cultivation Complete",通过修炼功法获得的技能:"Skill obtained through technique cultivation",功法修炼:"Technique Cultivation",未解锁:"Locked",功法传承:"Technique Inheritance","已同步最新数据到 gameStateStore":"Synced latest data to gameStateStore",刷新数据失败:"Failed to refresh data","组件挂载，同步数据":"Component mounted, syncing data",面板激活:"Panel activated",待定:"Undetermined","出身背景: {0}":"Origin: {0}",同步中:"Syncing",已获取:"Synced",暂不可用:"Unavailable",云端功能暂未开放:"Cloud feature not available yet",获取更新:"Fetch Cloud","正在同步云端数据...":"Syncing cloud data...",云端数据已获取:"Cloud data synced",获取更新数据:"Fetch cloud data","云端数据已获取，无需重复操作":"Cloud data already synced","正在获取更新数据...":"Fetching cloud data...","同步成功！新增 {0} 项云端数据":"Sync successful! Added {0} cloud items",所有云端数据已是最新:"All cloud data is up to date",同步成功:"Sync successful",同步失败:"Sync failed","同步失败: {0}":"Sync failed: {0}",存储中:"Storing",已存储:"Stored",存储预设:"Store Preset",请完成所有步骤后再保存预设:"Complete all steps before saving preset","正在存储预设...":"Storing preset...",预设已存储:"Preset stored",保存当前选择为预设:"Save current selection as preset","预设已存储，无需重复操作":"Preset already stored","正在保存预设...":"Saving preset...","预设「{0}」保存成功！":'Preset "{0}" saved successfully!',预设保存成功:"Preset saved successfully","存储失败: {0}":"Storage failed: {0}",已加载:"Loaded",加载预设:"Load Preset","正在加载预设...":"Loading preset...",预设已加载:"Preset loaded","预设已加载，无需重复操作":"Preset already loaded","预设「{0}」加载成功！":'Preset "{0}" loaded successfully!',加载成功:"Load successful","加载失败: {0}":"Load failed: {0}",存档数据异常:"Save Data Error","系统检测到您的存档文件存在严重结构问题，可能导致游戏无法正常运行。这通常是由于版本更新或数据损坏导致的。":"System detected serious structural issues in your save file that may prevent the game from running properly. This is usually caused by version updates or data corruption.","具体问题如下：":"Specific issues:","我们建议您立即修复此问题。修复过程将尝试在保留您核心进度的前提下，修正存档的数据结构。":"We recommend fixing this issue immediately. The repair process will attempt to correct the save data structure while preserving your core progress.","注意：修复主要针对结构性问题，无法恢复已损坏或丢失的数据。建议您在修复前备份存档。":"Note: Repair mainly targets structural issues and cannot recover corrupted or lost data. It is recommended to backup your save before repair.",修复存档并继续:"Repair Save and Continue","我们建议您立即修复此问题。修复过程将根据您现有的角色基础信息，重新生成一份健康的初始存档数据。":"We recommend fixing this issue immediately. The repair process will regenerate healthy initial save data based on your existing character information.","注意：这将会重置您的游戏进度（如修为、背包物品等），但角色核心设定（如姓名、天赋、灵根）将保留。":"Note: This will reset your game progress (such as cultivation, inventory items, etc.), but character core settings (such as name, talents, spirit root) will be retained.",重新初始化并修复:"Reinitialize and Repair",深度修炼:"Deep Cultivation",当前修炼进度:"Current Progress","修炼速度: +{0}%":"Cultivation Speed: +{0}%",选择修炼天数:"Select Cultivation Days",AI将根据修炼天数生成详细的修炼过程和结果:"AI will generate detailed cultivation process and results based on days",输入天数:"Enter days","1天":"1 day","7天":"7 days","30天":"30 days","90天":"90 days","180天":"180 days","365天":"365 days",开始修炼:"Begin Cultivation",授权验证:"Authorization","欢迎使用授权系统快速入门功能。请输入您的兑换码和机器码进行验证。":"Welcome to the authorization system. Please enter your redemption code and machine code for verification.","应用 ID":"App ID",请输入应用ID:"Enter App ID",兑换码:"Redemption Code",机器码:"Machine Code",自动生成或手动输入:"Auto-generate or manual input",生成机器码:"Generate machine code",使用统一机器码系统自动生成:"Auto-generate using unified machine code system",绑定类型:"Binding Type",仅机器码:"Machine Code Only",仅IP:"IP Only",双重绑定:"Dual Binding",验证授权:"Verify Authorization","验证成功！授权已激活":"Verification successful! Authorization activated","验证失败，请检查输入信息":"Verification failed, please check input","网络请求失败，请检查服务器连接":"Network request failed, please check server connection",机器码生成失败:"Machine code generation failed",AI生成失败:"AI Generation Failed",生成过程遇到问题:"Problem encountered during generation",取消创建:"Cancel Creation",继续重试:"Retry",选择数量:"Select Quantity","可用数量：{0}":"Available: {0}","1个":"1 item","5个":"5 items","10个":"10 items",输入数值:"Enter Value",数值:"Value",清除自定义:"Clear Custom",清除云端:"Clear Cloud",清除自定义和AI生成的数据:"Clear custom and AI-generated data",清除从云端获取的数据:"Clear cloud data",清除自定义数据:"Clear Custom Data","确定要清除自定义数据吗？这将清除所有自定义和AI生成的数据，保留本地基础数据和云端数据。此操作不可撤销！":"Are you sure you want to clear custom data? This will clear all custom and AI-generated data, keeping local base data and cloud data. This action cannot be undone!",确认清除:"Confirm Clear","已清除{0} 项自定义数据，保留本地基础数据和云端数据":"Cleared {0} custom items, keeping local base data and cloud data",清除云端数据:"Clear Cloud Data","确定要清除云端数据吗？这将清除从云端获取的数据，保留本地基础数据和自定义数据。此操作不可撤销！":"Are you sure you want to clear cloud data? This will clear data fetched from cloud, keeping local base data and custom data. This action cannot be undone!","已清除{0} 项云端数据，保留本地数据和自定义数据":"Cleared {0} cloud items, keeping local data and custom data",保存预设:"Save Preset",预设名称:"Preset Name","请输入预设名称（如：剑修预设、治愈系预设等）":"Enter preset name (e.g., Sword Cultivator Preset, Healer Preset, etc.)",预设描述:"Preset Description","输入此预设的描述信息...":"Enter preset description...","保存时间：":"Save Time:","保存中...":"Saving...",导出预设:"Export Presets","正在加载预设列表...":"Loading preset list...",暂无可导出的预设:"No presets to export",请先保存一些预设后再进行导出:"Please save some presets before exporting",导出全部预设:"Export All Presets","导出所有 {0} 个预设":"Export all {0} presets",导出选中预设:"Export Selected Presets",选择要导出的预设:"Select presets to export","全选/取消全选":"Select All/Deselect All","已选择 {0} 个":"Selected {0}",未命名预设:"Unnamed Preset",今天:"Today",昨天:"Yesterday","{0}天前":"{0} days ago","导出数量：":"Export Count:","{0} 个预设":"{0} presets","文件格式：":"File Format:",JSON:"JSON","导出时间：":"Export Time:","导出中...":"Exporting...","成功导出 {0} 个预设！":"Successfully exported {0} presets!","导出失败: {0}":"Export failed: {0}",导入预设:"Import Presets","拖放JSON文件到此处，或点击选择文件":"Drag and drop JSON file here, or click to select",选择文件:"Select File",仅支持通过本应用导出的预设JSON文件:"Only supports preset JSON files exported by this app",请选择JSON格式的文件:"Please select a JSON file","文件大小超过限制（最大10MB）":"File size exceeds limit (max 10MB)",合并模式:"Merge Mode","将导入的预设添加到现有预设中（推荐）":"Add imported presets to existing presets (recommended)",替换模式:"Replace Mode","将清除所有现有预设，仅保留导入的预设":"Clear all existing presets and keep only imported presets","替换模式将删除所有现有预设！\n\n此操作不可撤销，确定要继续吗？":"Replace mode will delete all existing presets!\n\nThis action cannot be undone, are you sure you want to continue?","正在导入预设...":"Importing presets...","成功导入 {0} 个预设！":"Successfully imported {0} presets!",部分预设导入成功:"Some presets imported successfully","成功: {0} 个，失败: {1} 个":"Success: {0}, Failed: {1}",预设导入失败:"Preset import failed","导入失败: {0}":"Import failed: {0}",开始导入:"Start Import",暂无保存的预设:"No saved presets","完成角色创建后,可以保存为预设以便快速开始新游戏":"After completing character creation, you can save as preset for quick new game start","确定要删除这个预设吗？此操作不可撤销。":"Are you sure you want to delete this preset? This action cannot be undone.",预设已删除:"Preset deleted","搜索...":"Search...","搜索物品...":"Search items...",全部物品:"All Items",默认排序:"Default Sort",品质排序:"Sort by Quality",名称排序:"Sort by Name",从酒馆同步最新数据:"Sync latest data from Tavern","装备增幅:":"Equipment Bonus:","特殊效果:":"Special Effects:",卸下:"Unequip",丢弃:"Discard",停止修炼:"Stop Cultivating",修炼:"Cultivate",使用:"Use",空空如也:"Empty",暂无装备:"No Equipment",暂无功法:"No Techniques",暂无其他物品:"No Other Items","暂无{0}":"No {0}",可以试试搜索其他分类:"Try searching other categories","功法效果:":"Technique Effects:","修炼速度:":"Cultivation Speed:","属性加成:":"Attribute Bonus:","特殊能力:":"Special Abilities:","功法技能:":"Technique Skills:","需要:":"Requires:","消耗:":"Cost:",选择物品查看详情:"Select an item to view details",物品:"Items",装备:"Equipment",灵石:"Spirit Stones",装备1:"Equipment 1",装备2:"Equipment 2",装备3:"Equipment 3",装备4:"Equipment 4",装备5:"Equipment 5",装备6:"Equipment 6",卸下装备:"Unequip",装备数据缺失:"Equipment data missing",空槽位:"Empty Slot",可装备装备:"Equipment can be worn","增幅效果：":"Bonus Effects:","特殊效果：":"Special Effects:","兑换为{0}灵石 (100:1)":"Exchange for {0} Spirit Stone (100:1)","↑ 兑换":"↑ Exchange","分解为{0}灵石 (1:100)":"Decompose into {0} Spirit Stone (1:100)","↓ 分解":"↓ Decompose",使用物品:"Use Item",使用数量:"Quantity to Use",确定使用:"Confirm Use",暂无特殊效果:"No special effects",该物品无法直接使用:"This item cannot be used directly",使用物品成功:"Item used successfully",使用物品失败:"Failed to use item",丢弃物品:"Discard Item",丢弃数量:"Quantity to Discard",确定丢弃:"Confirm Discard","此操作不可撤销！":"This action cannot be undone!","确定要丢弃 {0}{1} 吗？\n\n此操作不可撤销！":"Are you sure you want to discard {0}{1}?\n\nThis action cannot be undone!","已丢弃《{0}》":'Discarded "{0}"',"已丢弃 {0} 个《{1}》":'Discarded {0} of "{1}"',丢弃物品失败:"Failed to discard item",只有装备才能穿戴:"Only equipment can be worn","装备操作失败，请稍后重试":"Equipment operation failed, please try again later",只有功法才能修炼:"Only techniques can be cultivated",残缺:"Broken",背包数据不存在或格式不正确:"Inventory data does not exist or is in the wrong format",背包面板:"Inventory Panel",物品移除成功:"Item removed successfully","尝试更新一个不存在于背包的物品: {0}":"Attempting to update an item that does not exist in the inventory: {0}",物品更新成功:"Item updated successfully",装备栏数据不存在:"Equipment data does not exist",背包数据不存在:"Inventory data does not exist","卸下了《{0}》装备":'Unequipped "{0}"',"已卸下《{0}》":'Unequipped "{0}"',装备卸下成功:"Unequip successful",卸下装备失败:"Failed to unequip","[背包面板-警告] 物品缺少品质数据:":"[InventoryPanel-Warning] Item is missing quality data:",手动刷新酒馆数据:"Manually refresh Tavern data","存档数据 (SaveData)":"Save Data",玩家角色状态:"Player Status",装备栏:"Equipment",游戏时间:"Game Time",任务系统:"Quest System",系统:"System",叙事历史:"Narrative History",角色数据:"Character Data",记忆数据:"Memory Data",游戏版本:"Game Version",架构模式:"Architecture","Pinia内存 + DB持久化":"Pinia Memory + DB Persistence","存档数据(修改游戏数据)":"Save Data (Modify Game Data)",核心数据:"Core Data",自定义选项:"Custom Options",原始数据:"Raw Data",请先加载游戏存档:"Please load a game save first","数据已从Pinia Store刷新":"Data refreshed from Pinia Store","数据刷新失败: ":"Data refresh failed: ",数据导出成功:"Data exported successfully",数据导出失败:"Data export failed","新架构下不支持直接添加变量，请通过游戏操作修改数据":"Directly adding variables is not supported in the new architecture. Please modify data through game actions.",已复制到剪贴板:"Copied to clipboard",复制失败:"Copy failed","新架构下不支持直接删除变量，请通过游戏操作修改数据":"Directly deleting variables is not supported in the new architecture. Please modify data through game actions.",没有要保存的数据:"No data to save","✅ 已成功更新 ":"✅ Successfully updated ","保存失败: ":"Save failed: ","基本统计:":"Basic Stats:",游戏已加载:"Game Loaded",角色名:"Character Name","核心数据键名:":"Core Data Keys:","自定义选项键名:":"Custom Option Keys:","完整SaveData:":"Full SaveData:",调试信息已输出到控制台:"Debug info has been output to the console","AI处理中，请稍候...":"AI is processing, please wait...","角色已死亡，无法继续。":"Character has died, cannot continue.","角色因气血耗尽而死亡。":"Character has died due to Qi exhaustion.","角色因寿元耗尽而死亡。":"Character has died due to lifespan depletion.",天机已显:"Heavenly secrets revealed","AI响应格式不正确，正在重试...":"AI response format is incorrect, retrying...","AI响应格式错误，多次重试失败":"AI response format error, and multiple retries failed",AI处理失败:"AI processing failed",AI处理状态已重置:"AI processing state has been reset",'存档 "{0}" 成功':'Save "{0}" successful',存档失败:"Save failed",'已备份到"上次对话"':'Backed up to "Last Conversation"',备份失败:"Backup failed",基础修炼:"Basic Cultivation",炼体:"Body Tempering",打坐:"Meditation",探索荒野:"Explore Wilderness",城中闲逛:"Stroll in Town",拜访友人:"Visit Friend",结交新友:"Make New Friend",休息:"Rest",查看状态:"Check Status",探索:"Exploration",社交:"Social",其他:"Other","吸收灵气，提升修为。":"Absorb spiritual energy to enhance cultivation.","锤炼肉身，强化体魄。":"Temper the body to strengthen physique.","静心打坐，稳固心境，提升神识。":"Meditate to stabilize mind and enhance spirit.","探索荒野，寻找机缘。":"Explore the wilderness to find opportunities.",附近区域:"Nearby Area",远方区域:"Far Area",危险区域:"Dangerous Area","在城中游荡，打探消息。":"Wander in town to gather information.",坊市:"Market",酒楼:"Tavern",商铺:"Shop","拜访一位熟人。":"Visit an acquaintance.",随机拜访:"Random Visit",亲密好友:"Close Friend","主动结交新朋友。":"Actively make new friends.","休息恢复精力。":"Rest to recover energy.","查看当前详细状态。":"Check current detailed status.",其他记录:"Other Records",记忆系统设置:"Memory System Settings","📖 导出为小说":"📖 Export as Novel","将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。":"Export complete game dialogue history (based on narrative history) as novel format for easy reading and sharing.","⚙️ 记忆系统配置":"⚙️ Memory System Configuration","🧪 测试":"🧪 Test",添加测试中期记忆:"Add Test Medium-Term Memory",测试:"Test",功法库:"Technique Library","短期记忆上限（条）：":"Short-Term Memory Limit (items):",默认:"Default","中期记忆转化阈值（条）：":"Medium-Term Memory Conversion Threshold (items):","中期记忆达到此数量时，转化为长期记忆。默认：25":"When medium-term memories reach this amount, they are converted to long-term memories. Default: 25","中期记忆保留数量（条）：":"Medium-Term Memory Retention Count (items):","转化为长期记忆时，保留最新的这么多条中期记忆。默认：8":"When converting to long-term memory, retain this many of the latest medium-term memories. Default: 8",启用自动记忆转化:"Enable Automatic Memory Conversion","启用后，自动将中期记忆转化为长期记忆。禁用则不转化。":"When enabled, automatically converts medium-term memories to long-term memories. If disabled, no conversion occurs.","自定义中期记忆格式：":"Custom Medium-Term Memory Format:","留空使用默认格式。可自定义AI提示词来控制记忆的生成格式...":"Leave blank for default format. You can customize the AI prompt to control the generation format of memories...","自定义中期记忆的AI提示词格式。留空使用系统默认。":"Customize the AI prompt format for medium-term memories. Leave blank to use the system default.","自定义长期记忆格式：":"Custom Long-Term Memory Format:","自定义长期记忆的AI提示词格式。留空使用系统默认。":"Customize the AI prompt format for long-term memories. Leave blank to use the system default.","💾 保存配置":"💾 Save Configuration",重置为默认:"Reset to Default","当前中期记忆：":"Current Medium-Term Memories:","达到{count}条时将自动触发总结":"(Summary will be triggered automatically upon reaching {count} items)",manualSummaryRequirement:"At least {count} medium-term memories are required to summarize",手动触发AI总结:"Manually trigger AI summary","📝 手动总结中期记忆":"📝 Manually Summarize Medium-Term Memories","正在读取记忆...":"Reading memories...","第 {currentPage} / {totalPages} 页，共 {total} 条记忆":"Page {currentPage} / {totalPages}, {total} memories in total",firstPage:"First Page",previousPage:"Previous Page",nextPage:"Next Page",lastPage:"Last Page",page:"Page",go:"Go",deleteThisMemory:"Delete this memory",all:"All",shortTerm:"Short-Term",mediumTerm:"Medium-Term",longTerm:"Long-Term",noCultivationInsights:"Mind is as clear as a mirror, no cultivation insights recorded yet","暂无{type}记忆":"No {type} memories yet",mediumTermMemory:"Medium-Term Memory",longTermMemory:"Long-Term Memory",unknown:"Unknown",convertedAt:"Converted at {time}",archivedAt:"Archived at {time}",memoriesReorganized:"Memories have been reorganized, old memories have been converted",clearMemories:"Clear Memories",confirmClearMemories:"Are you sure you want to clear all memories? This action cannot be undone and will also clear the tavern data.",confirmClear:"Confirm Clear",memoriesCleared:"Memories have been cleared and synced to the tavern",clearMemoriesFailed:"Failed to clear memories, please try again",insufficientMemoriesForSummary:"Insufficient medium-term memories, at least {minRequired} items are required to summarize",deleteMemory:"Delete Memory",confirmDeleteMemory:"Are you sure you want to delete this {type}? This action cannot be undone.\n\nContent: {content}...",delete:"Delete",memoryNotFound:"Could not find the memory to delete",memoryDeleted:"Deleted {type}",deleteFailed:"Delete failed: {error}",cultivator:"Cultivator",cultivationWorld:"Cultivation World",noNarrativeHistoryToExport:"No narrative history to export",novelTitle:"《The Cultivation Path of {characterName}》",worldArchive:"World Archive",exportTime:"Export Time",totalParagraphs:"Total Paragraphs",iSaid:"I said",chapter:"Chapter",narrativeHistoryExported:"Successfully exported {count} narrative history entries",exportFailed:"Export failed, please check the console",testMemoryAdded:"✅ Test memory added! Current medium-term memories: {count} items",addTestMemoryFailed:"Failed to add test memory",道法受阻:"Dao Obstructed",隐藏详情:"Hide Details",变更日志:"Change Log","本次操作没有产生可见的状态变更。":"No visible state changes from this operation.",判定规则说明:"Judgement Rules",判定计算公式:"Judgement Formula",判定值:"Judgement Value",判定结果:"Judgement Results",判定规则:"Judgement Rules","判定值 ≥ 难度+30":"Value ≥ Difficulty+30","判定值 ≥ 难度+15，超额完成":"Value ≥ Difficulty+15, exceeded","判定值 ≥ 难度，达成目标":"Value ≥ Difficulty, achieved","判定值 < 难度，未达成":"Value < Difficulty, failed","判定值远低于难度（难度-15以下）":"Value far below difficulty (below difficulty-15)",判定类型与属性配比:"Judgement Types & Attributes",战斗判定:"Combat Judgement","根骨50% + 灵性30% + 气运20%":"Root Bone 50% + Spirituality 30% + Fortune 20%",修炼判定:"Cultivation Judgement","悟性50% + 灵性30% + 心性20%":"Comprehension 50% + Spirituality 30% + Temperament 20%",技艺判定:"Skill Judgement","悟性50% + 根骨30% + 灵性20%":"Comprehension 50% + Root Bone 30% + Spirituality 20%",社交判定:"Social Judgement","魅力50% + 悟性30% + 心性20%":"Charm 50% + Comprehension 30% + Temperament 20%",探索判定:"Exploration Judgement","气运50% + 灵性30% + 悟性20%":"Fortune 50% + Spirituality 30% + Comprehension 20%",六司属性说明:"Six Attributes",提升判定成功率:"Improve Success Rate","先天六司：天赋决定上限，无法改变但影响最大":"Innate Attributes: Talent determines limits, unchangeable but most impactful","提升境界：境界越高，判定基础加成越大（炼气+5，筑基+12...）":"Raise Realm: Higher realm gives greater base bonus (Qi Refining +5, Foundation +12...)","修炼后天：后天六司可提升，但权重仅20%":"Cultivate Acquired: Can be improved, but only 20% weight","学习功法：高品质功法和技能熟练度提供显著加成":"Learn Techniques: High-quality techniques and proficiency provide significant bonuses","装备法器：合适的装备能大幅提升判定值":"Equip Artifacts: Proper equipment greatly increases judgement value","状态效果：buff增强判定，注意避免debuff":"Status Effects: Buffs enhance judgement, avoid debuffs","境界压制：高境界对低境界有明显优势，但不是绝对":"Realm Suppression: Higher realm has advantage, but not absolute",造成伤害:"Damage Dealt",剩余气血:"Remaining Qi",系统提示:"System Notice","根据判定类型加权（战斗：根骨50%+灵性30%+气运20%，修炼：悟性50%+灵性30%+心性20%）":"Weighted by judgement type (Combat: Root Bone 50%+Spirituality 30%+Fortune 20%, Cultivation: Comprehension 50%+Spirituality 30%+Temperament 20%)","对应后天六司加权 ÷ 5":"Corresponding acquired attributes weighted ÷ 5","炼气5 | 筑基12 | 金丹20 | 元婴30...（阶段：初期+0，中期+2，后期+4，圆满+6）":"Qi Refining 5 | Foundation 12 | Golden Core 20 | Nascent Soul 30... (Stage: Early +0, Mid +2, Late +4, Perfect +6)",装备提供的加成:"Equipment bonuses","功法品质+熟练度":"Technique quality + proficiency","buff/debuff效果":"Buff/debuff effects","判定值与难度对比，完全基于属性、境界和加成":"Judgement value vs difficulty, based on attributes, realm and bonuses"};function l(){return{t:(e,t)=>{let n="zh"===i.value?e:s[e]||e;if(t)for(const e in t)n=n.replace(`{${e}}`,String(t[e]));return n},currentLanguage:i,setLanguage:e=>{i.value=e,localStorage.setItem("language",e)}}}},920:(e,t,n)=>{"use strict";var a=n(9675),r=n(8859),o=n(4803),i=n(507),s=n(2271)||i||o;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new a("Side channel does not contain "+r(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,n){e||(e=s()),e.set(t,n)}};return t}},952:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.top-bar[data-v-4be6bb59] {\n  width: 100%;\n  height: 56px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 16px;\n  box-sizing: border-box;\n  background: var(--color-surface, #f8f9fa);\n  border-bottom: 1px solid var(--color-border, #e2e8f0);\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  flex-shrink: 0;\n  min-height: 56px;\n}\n.left-section[data-v-4be6bb59] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  flex: 1;\n}\n.game-title[data-v-4be6bb59] {\n  font-size: 1.2rem;\n  font-weight: 800;\n  color: var(--color-text);\n  margin: 0;\n  letter-spacing: 1px;\n  white-space: nowrap;\n}\n.title-xian[data-v-4be6bb59] {\n  color: var(--color-primary);\n  text-shadow: 0 0 12px rgba(var(--color-primary-rgb), 0.4);\n}\n.title-tu[data-v-4be6bb59] {\n  color: var(--color-text);\n}\n.character-quick-info[data-v-4be6bb59] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 10px;\n  background: var(--color-surface-light);\n  border-radius: 14px;\n  border: 1px solid var(--color-border);\n}\n.character-name[data-v-4be6bb59] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.character-realm[data-v-4be6bb59] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  font-weight: 500;\n  padding: 2px 6px;\n  background: var(--color-accent-light);\n  border-radius: 10px;\n}\n.center-section[data-v-4be6bb59] {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n}\n.location-time-info[data-v-4be6bb59] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  white-space: nowrap;\n}\n.location-text[data-v-4be6bb59] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-success);\n}\n.spirit-density[data-v-4be6bb59] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 197, 253, 0.12) 100%);\n  border: 1px solid rgba(59, 130, 246, 0.25);\n  border-radius: 12px;\n  margin-left: 8px;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n.spirit-density[data-v-4be6bb59]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n.spirit-icon-wrapper[data-v-4be6bb59] {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 18px;\n  height: 18px;\n}\n.spirit-icon[data-v-4be6bb59] {\n  font-size: 0.9rem;\n  color: #3b82f6;\n  position: relative;\n  z-index: 2;\n  animation: spirit-pulse-4be6bb59 2s ease-in-out infinite;\n  filter: drop-shadow(0 0 3px rgba(59, 130, 246, 0.6));\n}\n.spirit-glow[data-v-4be6bb59] {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, transparent 70%);\n  border-radius: 50%;\n  animation: spirit-glow-pulse-4be6bb59 2s ease-in-out infinite;\n}\n.spirit-label[data-v-4be6bb59] {\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: #1e40af;\n  letter-spacing: 0.5px;\n  text-transform: uppercase;\n}\n.spirit-value[data-v-4be6bb59] {\n  font-size: 0.85rem;\n  font-weight: 700;\n  color: #1e40af;\n  font-family: 'Courier New', monospace;\n  min-width: 24px;\n  text-align: right;\n}\n.spirit-bar[data-v-4be6bb59] {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 3px;\n  background: rgba(59, 130, 246, 0.15);\n  overflow: hidden;\n}\n.spirit-bar-fill[data-v-4be6bb59] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);\n  transition: width 0.5s ease;\n  box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);\n}\n\n/* 灵气浓度等级样式 */\n.spirit-density.density-very-high[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.12) 0%, rgba(192, 132, 252, 0.16) 100%);\n  border-color: rgba(168, 85, 247, 0.35);\n}\n.spirit-density.density-very-high .spirit-icon[data-v-4be6bb59],\n.spirit-density.density-very-high .spirit-label[data-v-4be6bb59],\n.spirit-density.density-very-high .spirit-value[data-v-4be6bb59] {\n  color: #7c3aed;\n}\n.spirit-density.density-very-high .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);\n  box-shadow: 0 0 10px rgba(124, 58, 237, 0.8);\n}\n.spirit-density.density-very-high .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(168, 85, 247, 0.5) 0%, transparent 70%);\n}\n.spirit-density.density-high[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(74, 222, 128, 0.14) 100%);\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.spirit-density.density-high .spirit-icon[data-v-4be6bb59],\n.spirit-density.density-high .spirit-label[data-v-4be6bb59],\n.spirit-density.density-high .spirit-value[data-v-4be6bb59] {\n  color: #15803d;\n}\n.spirit-density.density-high .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #22c55e 0%, #4ade80 100%);\n  box-shadow: 0 0 8px rgba(34, 197, 94, 0.7);\n}\n.spirit-density.density-high .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(34, 197, 94, 0.4) 0%, transparent 70%);\n}\n.spirit-density.density-medium[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 197, 253, 0.12) 100%);\n  border-color: rgba(59, 130, 246, 0.25);\n}\n.spirit-density.density-low[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(251, 146, 60, 0.08) 0%, rgba(253, 186, 116, 0.12) 100%);\n  border-color: rgba(251, 146, 60, 0.25);\n}\n.spirit-density.density-low .spirit-icon[data-v-4be6bb59],\n.spirit-density.density-low .spirit-label[data-v-4be6bb59],\n.spirit-density.density-low .spirit-value[data-v-4be6bb59] {\n  color: #c2410c;\n}\n.spirit-density.density-low .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #f97316 0%, #fb923c 100%);\n  box-shadow: 0 0 6px rgba(249, 115, 22, 0.6);\n}\n.spirit-density.density-low .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(251, 146, 60, 0.3) 0%, transparent 70%);\n}\n.spirit-density.density-very-low[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(248, 113, 113, 0.12) 100%);\n  border-color: rgba(239, 68, 68, 0.25);\n}\n.spirit-density.density-very-low .spirit-icon[data-v-4be6bb59],\n.spirit-density.density-very-low .spirit-label[data-v-4be6bb59],\n.spirit-density.density-very-low .spirit-value[data-v-4be6bb59] {\n  color: #b91c1c;\n}\n.spirit-density.density-very-low .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);\n  box-shadow: 0 0 6px rgba(220, 38, 38, 0.6);\n}\n.spirit-density.density-very-low .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(239, 68, 68, 0.3) 0%, transparent 70%);\n}\n@keyframes spirit-pulse-4be6bb59 {\n0%, 100% {\n    opacity: 0.8;\n    transform: scale(1);\n}\n50% {\n    opacity: 1;\n    transform: scale(1.1);\n}\n}\n@keyframes spirit-glow-pulse-4be6bb59 {\n0%, 100% {\n    opacity: 0.4;\n    transform: scale(0.9);\n}\n50% {\n    opacity: 0.7;\n    transform: scale(1.2);\n}\n}\n.separator[data-v-4be6bb59] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.time-value[data-v-4be6bb59] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  font-family: 'Courier New', monospace;\n}\n.right-section[data-v-4be6bb59] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex: 1;\n  justify-content: flex-end;\n}\n.fullscreen-btn[data-v-4be6bb59] {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 16px;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.fullscreen-btn[data-v-4be6bb59]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n  color: var(--color-text);\n}\n\n/* 手机端适配 */\n@media (max-width: 767px) {\n.top-bar[data-v-4be6bb59] {\n    padding: 0 8px;\n    height: 50px;\n    min-height: 50px;\n    flex-wrap: nowrap;\n}\n.game-title[data-v-4be6bb59] {\n    font-size: 0.9rem;\n    white-space: nowrap;\n    writing-mode: horizontal-tb;\n}\n.character-quick-info[data-v-4be6bb59] {\n    gap: 4px;\n    padding: 2px 6px;\n    flex-shrink: 1;\n    min-width: 0;\n}\n.character-name[data-v-4be6bb59] {\n    font-size: 0.7rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 60px;\n}\n.character-realm[data-v-4be6bb59] {\n    font-size: 0.6rem;\n    padding: 1px 3px;\n    white-space: nowrap;\n}\n.center-section[data-v-4be6bb59] {\n    flex: 1;\n    min-width: 0;\n    overflow: hidden;\n}\n.location-time-info[data-v-4be6bb59] {\n    padding: 3px 6px;\n    gap: 4px;\n    flex-wrap: wrap;\n    justify-content: center;\n    max-width: 100%;\n}\n.location-text[data-v-4be6bb59] {\n    font-size: 0.7rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 80px;\n}\n.spirit-density[data-v-4be6bb59] {\n    padding: 3px 6px;\n    margin-left: 4px;\n    gap: 4px;\n}\n.spirit-icon-wrapper[data-v-4be6bb59] {\n    width: 14px;\n    height: 14px;\n}\n.spirit-icon[data-v-4be6bb59] {\n    font-size: 0.7rem;\n}\n.spirit-label[data-v-4be6bb59] {\n    font-size: 0.6rem;\n}\n.spirit-value[data-v-4be6bb59] {\n    font-size: 0.65rem;\n    min-width: 18px;\n}\n.spirit-bar[data-v-4be6bb59] {\n    height: 2px;\n}\n.separator[data-v-4be6bb59] {\n    font-size: 0.65rem;\n}\n.time-value[data-v-4be6bb59] {\n    font-size: 0.65rem;\n    white-space: nowrap;\n}\n.fullscreen-btn[data-v-4be6bb59] {\n    width: 26px;\n    height: 26px;\n    font-size: 14px;\n    flex-shrink: 0;\n}\n.left-section[data-v-4be6bb59] {\n    gap: 6px;\n    flex: 0 1 auto;\n    min-width: 0;\n}\n.right-section[data-v-4be6bb59] {\n    gap: 6px;\n    flex: 0 0 auto;\n}\n}\n\n/* 超小屏幕适配 */\n@media (max-width: 375px) {\n.top-bar[data-v-4be6bb59] {\n    padding: 0 4px;\n}\n.game-title[data-v-4be6bb59] {\n    font-size: 0.8rem;\n}\n.character-quick-info[data-v-4be6bb59] {\n    gap: 3px;\n    padding: 2px 4px;\n}\n.character-name[data-v-4be6bb59] {\n    font-size: 0.65rem;\n    max-width: 50px;\n}\n.location-text[data-v-4be6bb59] {\n    font-size: 0.65rem;\n    max-width: 60px;\n}\n.time-value[data-v-4be6bb59] {\n    font-size: 0.6rem;\n}\n}\n\n/* 平板适配 */\n@media (min-width: 641px) and (max-width: 1024px) {\n.top-bar[data-v-4be6bb59] {\n    padding: 0 16px;\n}\n.game-title[data-v-4be6bb59] {\n    font-size: 1.1rem;\n}\n.left-section[data-v-4be6bb59] {\n    gap: 12px;\n}\n.right-section[data-v-4be6bb59] {\n    gap: 10px;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .top-bar[data-v-4be6bb59] {\n  background: #1e293b;\n  border-bottom-color: #334155;\n}\n[data-theme='dark'] .game-title[data-v-4be6bb59] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .character-quick-info[data-v-4be6bb59] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .character-name[data-v-4be6bb59] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .character-realm[data-v-4be6bb59] {\n  background: rgba(167, 139, 250, 0.2);\n  color: #a78bfa;\n}\n[data-theme='dark'] .location-time-info[data-v-4be6bb59] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .location-text[data-v-4be6bb59] {\n  color: #34d399;\n}\n[data-theme='dark'] .spirit-density[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(147, 197, 253, 0.2) 100%);\n  border-color: rgba(96, 165, 250, 0.3);\n}\n[data-theme='dark'] .spirit-density[data-v-4be6bb59]:hover {\n  box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);\n  border-color: rgba(96, 165, 250, 0.5);\n}\n[data-theme='dark'] .spirit-icon[data-v-4be6bb59] {\n  color: #60a5fa;\n  filter: drop-shadow(0 0 4px rgba(96, 165, 250, 0.7));\n}\n[data-theme='dark'] .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(96, 165, 250, 0.5) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-label[data-v-4be6bb59] {\n  color: #93c5fd;\n}\n[data-theme='dark'] .spirit-value[data-v-4be6bb59] {\n  color: #dbeafe;\n}\n[data-theme='dark'] .spirit-bar[data-v-4be6bb59] {\n  background: rgba(96, 165, 250, 0.2);\n}\n[data-theme='dark'] .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #60a5fa 0%, #93c5fd 100%);\n  box-shadow: 0 0 10px rgba(96, 165, 250, 0.8);\n}\n\n/* Dark theme - density levels */\n[data-theme='dark'] .spirit-density.density-very-high[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(192, 132, 252, 0.15) 0%, rgba(216, 180, 254, 0.2) 100%);\n  border-color: rgba(192, 132, 252, 0.35);\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-icon[data-v-4be6bb59],\n[data-theme='dark'] .spirit-density.density-very-high .spirit-label[data-v-4be6bb59] {\n  color: #c084fc;\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-value[data-v-4be6bb59] {\n  color: #e9d5ff;\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #a78bfa 0%, #c084fc 100%);\n  box-shadow: 0 0 12px rgba(168, 85, 247, 0.9);\n}\n[data-theme='dark'] .spirit-density.density-very-high .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(192, 132, 252, 0.6) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-high[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(74, 222, 128, 0.12) 0%, rgba(134, 239, 172, 0.18) 100%);\n  border-color: rgba(74, 222, 128, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-icon[data-v-4be6bb59],\n[data-theme='dark'] .spirit-density.density-high .spirit-label[data-v-4be6bb59] {\n  color: #4ade80;\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-value[data-v-4be6bb59] {\n  color: #d1fae5;\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #34d399 0%, #6ee7b7 100%);\n  box-shadow: 0 0 10px rgba(52, 211, 153, 0.8);\n}\n[data-theme='dark'] .spirit-density.density-high .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(74, 222, 128, 0.5) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-low[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(251, 146, 60, 0.12) 0%, rgba(253, 186, 116, 0.18) 100%);\n  border-color: rgba(251, 146, 60, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-icon[data-v-4be6bb59],\n[data-theme='dark'] .spirit-density.density-low .spirit-label[data-v-4be6bb59] {\n  color: #fb923c;\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-value[data-v-4be6bb59] {\n  color: #fed7aa;\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #f97316 0%, #fb923c 100%);\n  box-shadow: 0 0 8px rgba(249, 115, 22, 0.7);\n}\n[data-theme='dark'] .spirit-density.density-low .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(251, 146, 60, 0.4) 0%, transparent 70%);\n}\n[data-theme='dark'] .spirit-density.density-very-low[data-v-4be6bb59] {\n  background: linear-gradient(135deg, rgba(248, 113, 113, 0.12) 0%, rgba(252, 165, 165, 0.18) 100%);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-icon[data-v-4be6bb59],\n[data-theme='dark'] .spirit-density.density-very-low .spirit-label[data-v-4be6bb59] {\n  color: #f87171;\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-value[data-v-4be6bb59] {\n  color: #fecaca;\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-bar-fill[data-v-4be6bb59] {\n  background: linear-gradient(90deg, #ef4444 0%, #f87171 100%);\n  box-shadow: 0 0 8px rgba(239, 68, 68, 0.7);\n}\n[data-theme='dark'] .spirit-density.density-very-low .spirit-glow[data-v-4be6bb59] {\n  background: radial-gradient(circle, rgba(248, 113, 113, 0.4) 0%, transparent 70%);\n}\n[data-theme='dark'] .separator[data-v-4be6bb59] {\n  color: #64748b;\n}\n[data-theme='dark'] .time-value[data-v-4be6bb59] {\n  color: #cbd5e1;\n}\n[data-theme='dark'] .fullscreen-btn[data-v-4be6bb59] {\n  background: transparent;\n  border-color: #475569;\n  color: #94a3b8;\n}\n[data-theme='dark'] .fullscreen-btn[data-v-4be6bb59]:hover {\n  background: #334155;\n  border-color: #64748b;\n  color: #e2e8f0;\n}\n",""]);const s=i},1002:e=>{"use strict";e.exports=Function.prototype.apply},1021:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.raw-data-section[data-v-2cab0dce] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-2cab0dce] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-2cab0dce] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.raw-data-content[data-v-2cab0dce] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-2cab0dce] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-2cab0dce] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-2cab0dce] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.raw-data-section[data-v-2cab0dce] {\n    padding: 0.75rem;\n}\n.section-title[data-v-2cab0dce] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-2cab0dce] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-2cab0dce] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.raw-data-section[data-v-2cab0dce] {\n    padding: 0.5rem;\n}\n.section-title[data-v-2cab0dce] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-2cab0dce] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},1040:(e,t,n)=>{"use strict";function a(){const e=document;return document.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||null}function r(){try{return window.self!==window.top}catch{return!0}}async function o(e){const t=e||document.documentElement;if(!t)throw new Error("No element to request fullscreen.");if("function"!=typeof t.requestFullscreen)if("function"!=typeof t.webkitRequestFullscreen)if("function"!=typeof t.mozRequestFullScreen){if("function"!=typeof t.msRequestFullscreen)throw new Error("Fullscreen API not supported in this browser/environment.");await t.msRequestFullscreen()}else await t.mozRequestFullScreen();else await t.webkitRequestFullscreen();else await t.requestFullscreen()}async function i(){const e=document;if("function"!=typeof document.exitFullscreen)if("function"!=typeof e.webkitExitFullscreen)if("function"!=typeof e.mozCancelFullScreen){if("function"!=typeof e.msExitFullscreen)throw new Error("Exit fullscreen not supported in this browser/environment.");await e.msExitFullscreen()}else await e.mozCancelFullScreen();else await e.webkitExitFullscreen();else await document.exitFullscreen()}function s(e){const t=e,n=String(t?.name||""),a=String(t?.message||""),o=("undefined"!=typeof navigator?navigator.userAgent:"").toLowerCase(),i=/iphone|ipad|ipod/.test(o),s=o.includes("safari")&&!o.includes("crios")&&!o.includes("fxios")&&!o.includes("edgios");return"TypeError"===n?"当前浏览器/环境不支持全屏 API（iOS Safari 网页通常无法全屏；嵌入式WebView也可能禁用）。":a.toLowerCase().includes("not supported")||a.toLowerCase().includes("not supported in this browser")?r()?'嵌入环境可能不支持或未允许全屏（需要 allowfullscreen / allow="fullscreen"）。建议在浏览器新标签打开再全屏。':i&&s?"iOS Safari 网页通常无法进入全屏（除视频播放器）。建议使用其他浏览器或以“添加到主屏幕/PWA”方式打开。":"当前浏览器/环境不支持全屏 API。":"NotAllowedError"===n||"SecurityError"===n?r()?'当前为嵌入环境，iframe 可能未允许全屏（需要 allowfullscreen / allow="fullscreen"）。建议在浏览器新标签打开再全屏。':"浏览器阻止进入全屏：需要用户手势触发，或站点权限策略禁止。":a.toLowerCase().includes("fullscreen")?`全屏失败：${a}`:"无法进入全屏模式（可能被浏览器或嵌入环境限制）。"}n.d(t,{Eh:()=>i,Kn:()=>a,lh:()=>o,zp:()=>s})},1064:(e,t,n)=>{"use strict";var a=n(9612);e.exports=a.getPrototypeOf||null},1083:(e,t,n)=>{"use strict";n.d(t,{A:()=>yt});var a={};function r(e,t){return function(){return e.apply(t,arguments)}}n.r(a),n.d(a,{hasBrowserEnv:()=>pe,hasStandardBrowserEnv:()=>he,hasStandardBrowserWebWorkerEnv:()=>fe,navigator:()=>ge,origin:()=>ve});const{toString:o}=Object.prototype,{getPrototypeOf:i}=Object,{iterator:s,toStringTag:l}=Symbol,c=(d=Object.create(null),e=>{const t=o.call(e);return d[t]||(d[t]=t.slice(8,-1).toLowerCase())});var d;const u=e=>(e=e.toLowerCase(),t=>c(t)===e),m=e=>t=>typeof t===e,{isArray:p}=Array,g=m("undefined");function h(e){return null!==e&&!g(e)&&null!==e.constructor&&!g(e.constructor)&&b(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const f=u("ArrayBuffer"),v=m("string"),b=m("function"),y=m("number"),x=e=>null!==e&&"object"==typeof e,k=e=>{if("object"!==c(e))return!1;const t=i(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||l in e||s in e)},w=u("Date"),E=u("File"),N=u("Blob"),S=u("FileList"),V=u("URLSearchParams"),[_,C,A,D]=["ReadableStream","Request","Response","Headers"].map(u);function T(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let a,r;if("object"!=typeof e&&(e=[e]),p(e))for(a=0,r=e.length;a<r;a++)t.call(null,e[a],a,e);else{if(h(e))return;const r=n?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let i;for(a=0;a<o;a++)i=r[a],t.call(null,e[i],i,e)}}function B(e,t){if(h(e))return null;t=t.toLowerCase();const n=Object.keys(e);let a,r=n.length;for(;r-- >0;)if(a=n[r],t===a.toLowerCase())return a;return null}const I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,z=e=>!g(e)&&e!==I,M=(P="undefined"!=typeof Uint8Array&&i(Uint8Array),e=>P&&e instanceof P);var P;const R=u("HTMLFormElement"),$=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),O=u("RegExp"),L=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),a={};T(n,(n,r)=>{let o;!1!==(o=t(n,r,e))&&(a[r]=o||n)}),Object.defineProperties(e,a)},F=u("AsyncFunction"),j=(U="function"==typeof setImmediate,q=b(I.postMessage),U?setImmediate:q?(G=`axios@${Math.random()}`,H=[],I.addEventListener("message",({source:e,data:t})=>{e===I&&t===G&&H.length&&H.shift()()},!1),e=>{H.push(e),I.postMessage(G,"*")}):e=>setTimeout(e));var U,q,G,H;const Y="undefined"!=typeof queueMicrotask?queueMicrotask.bind(I):"undefined"!=typeof process&&process.nextTick||j,W={isArray:p,isArrayBuffer:f,isBuffer:h,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||b(e.append)&&("formdata"===(t=c(e))||"object"===t&&b(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&f(e.buffer),t},isString:v,isNumber:y,isBoolean:e=>!0===e||!1===e,isObject:x,isPlainObject:k,isEmptyObject:e=>{if(!x(e)||h(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(e){return!1}},isReadableStream:_,isRequest:C,isResponse:A,isHeaders:D,isUndefined:g,isDate:w,isFile:E,isBlob:N,isRegExp:O,isFunction:b,isStream:e=>x(e)&&b(e.pipe),isURLSearchParams:V,isTypedArray:M,isFileList:S,forEach:T,merge:function e(){const{caseless:t,skipUndefined:n}=z(this)&&this||{},a={},r=(r,o)=>{const i=t&&B(a,o)||o;k(a[i])&&k(r)?a[i]=e(a[i],r):k(r)?a[i]=e({},r):p(r)?a[i]=r.slice():n&&g(r)||(a[i]=r)};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&T(arguments[e],r);return a},extend:(e,t,n,{allOwnKeys:a}={})=>(T(t,(t,a)=>{n&&b(t)?e[a]=r(t,n):e[a]=t},{allOwnKeys:a}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,a)=>{let r,o,s;const l={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)s=r[o],a&&!a(s,e,t)||l[s]||(t[s]=e[s],l[s]=!0);e=!1!==n&&i(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:c,kindOfTest:u,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const a=e.indexOf(t,n);return-1!==a&&a===n},toArray:e=>{if(!e)return null;if(p(e))return e;let t=e.length;if(!y(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[s]).call(e);let a;for(;(a=n.next())&&!a.done;){const n=a.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const a=[];for(;null!==(n=e.exec(t));)a.push(n);return a},isHTMLForm:R,hasOwnProperty:$,hasOwnProp:$,reduceDescriptors:L,freezeMethods:e=>{L(e,(t,n)=>{if(b(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const a=e[n];b(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},a=e=>{e.forEach(e=>{n[e]=!0})};return p(e)?a(e):a(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:B,global:I,isContextDefined:z,isSpecCompliantForm:function(e){return!!(e&&b(e.append)&&"FormData"===e[l]&&e[s])},toJSONObject:e=>{const t=new Array(10),n=(e,a)=>{if(x(e)){if(t.indexOf(e)>=0)return;if(h(e))return e;if(!("toJSON"in e)){t[a]=e;const r=p(e)?[]:{};return T(e,(e,t)=>{const o=n(e,a+1);!g(o)&&(r[t]=o)}),t[a]=void 0,r}}return e};return n(e,0)},isAsyncFn:F,isThenable:e=>e&&(x(e)||b(e))&&b(e.then)&&b(e.catch),setImmediate:j,asap:Y,isIterable:e=>null!=e&&b(e[s])};function X(e,t,n,a,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),a&&(this.request=a),r&&(this.response=r,this.status=r.status?r.status:null)}W.inherits(X,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:W.toJSONObject(this.config),code:this.code,status:this.status}}});const J=X.prototype,K={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{K[e]={value:e}}),Object.defineProperties(X,K),Object.defineProperty(J,"isAxiosError",{value:!0}),X.from=(e,t,n,a,r,o)=>{const i=Object.create(J);W.toFlatObject(e,i,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const s=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return X.call(i,s,l,n,a,r),e&&null==i.cause&&Object.defineProperty(i,"cause",{value:e,configurable:!0}),i.name=e&&e.name||"Error",o&&Object.assign(i,o),i};const Z=X;function Q(e){return W.isPlainObject(e)||W.isArray(e)}function ee(e){return W.endsWith(e,"[]")?e.slice(0,-2):e}function te(e,t,n){return e?e.concat(t).map(function(e,t){return e=ee(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const ne=W.toFlatObject(W,{},null,function(e){return/^is[A-Z]/.test(e)}),ae=function(e,t,n){if(!W.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(n=W.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!W.isUndefined(t[e])})).metaTokens,r=n.visitor||c,o=n.dots,i=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&W.isSpecCompliantForm(t);if(!W.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(W.isDate(e))return e.toISOString();if(W.isBoolean(e))return e.toString();if(!s&&W.isBlob(e))throw new Z("Blob is not supported. Use a Buffer instead.");return W.isArrayBuffer(e)||W.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,r){let s=e;if(e&&!r&&"object"==typeof e)if(W.endsWith(n,"{}"))n=a?n:n.slice(0,-2),e=JSON.stringify(e);else if(W.isArray(e)&&function(e){return W.isArray(e)&&!e.some(Q)}(e)||(W.isFileList(e)||W.endsWith(n,"[]"))&&(s=W.toArray(e)))return n=ee(n),s.forEach(function(e,a){!W.isUndefined(e)&&null!==e&&t.append(!0===i?te([n],a,o):null===i?n:n+"[]",l(e))}),!1;return!!Q(e)||(t.append(te(r,n,o),l(e)),!1)}const d=[],u=Object.assign(ne,{defaultVisitor:c,convertValue:l,isVisitable:Q});if(!W.isObject(e))throw new TypeError("data must be an object");return function e(n,a){if(!W.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+a.join("."));d.push(n),W.forEach(n,function(n,o){!0===(!(W.isUndefined(n)||null===n)&&r.call(t,n,W.isString(o)?o.trim():o,a,u))&&e(n,a?a.concat(o):[o])}),d.pop()}}(e),t};function re(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function oe(e,t){this._pairs=[],e&&ae(e,this,t)}const ie=oe.prototype;ie.append=function(e,t){this._pairs.push([e,t])},ie.toString=function(e){const t=e?function(t){return e.call(this,t,re)}:re;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const se=oe;function le(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ce(e,t,n){if(!t)return e;const a=n&&n.encode||le;W.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(o=r?r(t,n):W.isURLSearchParams(t)?t.toString():new se(t,n).toString(a),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const de=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){W.forEach(this.handlers,function(t){null!==t&&e(t)})}},ue={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},me={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:se,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},pe="undefined"!=typeof window&&"undefined"!=typeof document,ge="object"==typeof navigator&&navigator||void 0,he=pe&&(!ge||["ReactNative","NativeScript","NS"].indexOf(ge.product)<0),fe="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ve=pe&&window.location.href||"http://localhost",be={...a,...me},ye=function(e){function t(e,n,a,r){let o=e[r++];if("__proto__"===o)return!0;const i=Number.isFinite(+o),s=r>=e.length;return o=!o&&W.isArray(a)?a.length:o,s?(W.hasOwnProp(a,o)?a[o]=[a[o],n]:a[o]=n,!i):(a[o]&&W.isObject(a[o])||(a[o]=[]),t(e,n,a[o],r)&&W.isArray(a[o])&&(a[o]=function(e){const t={},n=Object.keys(e);let a;const r=n.length;let o;for(a=0;a<r;a++)o=n[a],t[o]=e[o];return t}(a[o])),!i)}if(W.isFormData(e)&&W.isFunction(e.entries)){const n={};return W.forEachEntry(e,(e,a)=>{t(function(e){return W.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),a,n,0)}),n}return null},xe={transitional:ue,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",a=n.indexOf("application/json")>-1,r=W.isObject(e);if(r&&W.isHTMLForm(e)&&(e=new FormData(e)),W.isFormData(e))return a?JSON.stringify(ye(e)):e;if(W.isArrayBuffer(e)||W.isBuffer(e)||W.isStream(e)||W.isFile(e)||W.isBlob(e)||W.isReadableStream(e))return e;if(W.isArrayBufferView(e))return e.buffer;if(W.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ae(e,new be.classes.URLSearchParams,{visitor:function(e,t,n,a){return be.isNode&&W.isBuffer(e)?(this.append(t,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((o=W.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ae(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||a?(t.setContentType("application/json",!1),function(e){if(W.isString(e))try{return(0,JSON.parse)(e),W.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||xe.transitional,n=t&&t.forcedJSONParsing,a="json"===this.responseType;if(W.isResponse(e)||W.isReadableStream(e))return e;if(e&&W.isString(e)&&(n&&!this.responseType||a)){const n=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(e){if(n){if("SyntaxError"===e.name)throw Z.from(e,Z.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};W.forEach(["delete","get","head","post","put","patch"],e=>{xe.headers[e]={}});const ke=xe,we=W.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ee=Symbol("internals");function Ne(e){return e&&String(e).trim().toLowerCase()}function Se(e){return!1===e||null==e?e:W.isArray(e)?e.map(Se):String(e)}function Ve(e,t,n,a,r){return W.isFunction(a)?a.call(this,t,n):(r&&(t=n),W.isString(t)?W.isString(a)?-1!==t.indexOf(a):W.isRegExp(a)?a.test(t):void 0:void 0)}class _e{constructor(e){e&&this.set(e)}set(e,t,n){const a=this;function r(e,t,n){const r=Ne(t);if(!r)throw new Error("header name must be a non-empty string");const o=W.findKey(a,r);(!o||void 0===a[o]||!0===n||void 0===n&&!1!==a[o])&&(a[o||t]=Se(e))}const o=(e,t)=>W.forEach(e,(e,n)=>r(e,n,t));if(W.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(W.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let n,a,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),a=e.substring(r+1).trim(),!n||t[n]&&we[n]||("set-cookie"===n?t[n]?t[n].push(a):t[n]=[a]:t[n]=t[n]?t[n]+", "+a:a)}),t})(e),t);else if(W.isObject(e)&&W.isIterable(e)){let n,a,r={};for(const t of e){if(!W.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[a=t[0]]=(n=r[a])?W.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}o(r,t)}else null!=e&&r(t,e,n);return this}get(e,t){if(e=Ne(e)){const n=W.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=n.exec(e);)t[a[1]]=a[2];return t}(e);if(W.isFunction(t))return t.call(this,e,n);if(W.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ne(e)){const n=W.findKey(this,e);return!(!n||void 0===this[n]||t&&!Ve(0,this[n],n,t))}return!1}delete(e,t){const n=this;let a=!1;function r(e){if(e=Ne(e)){const r=W.findKey(n,e);!r||t&&!Ve(0,n[r],r,t)||(delete n[r],a=!0)}}return W.isArray(e)?e.forEach(r):r(e),a}clear(e){const t=Object.keys(this);let n=t.length,a=!1;for(;n--;){const r=t[n];e&&!Ve(0,this[r],r,e,!0)||(delete this[r],a=!0)}return a}normalize(e){const t=this,n={};return W.forEach(this,(a,r)=>{const o=W.findKey(n,r);if(o)return t[o]=Se(a),void delete t[r];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(r):String(r).trim();i!==r&&delete t[r],t[i]=Se(a),n[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return W.forEach(this,(n,a)=>{null!=n&&!1!==n&&(t[a]=e&&W.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){const t=(this[Ee]=this[Ee]={accessors:{}}).accessors,n=this.prototype;function a(e){const a=Ne(e);t[a]||(function(e,t){const n=W.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(e,a+n,{value:function(e,n,r){return this[a].call(this,t,e,n,r)},configurable:!0})})}(n,e),t[a]=!0)}return W.isArray(e)?e.forEach(a):a(e),this}}_e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),W.reduceDescriptors(_e.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),W.freezeMethods(_e);const Ce=_e;function Ae(e,t){const n=this||ke,a=t||n,r=Ce.from(a.headers);let o=a.data;return W.forEach(e,function(e){o=e.call(n,o,r.normalize(),t?t.status:void 0)}),r.normalize(),o}function De(e){return!(!e||!e.__CANCEL__)}function Te(e,t,n){Z.call(this,null==e?"canceled":e,Z.ERR_CANCELED,t,n),this.name="CanceledError"}W.inherits(Te,Z,{__CANCEL__:!0});const Be=Te;function Ie(e,t,n){const a=n.config.validateStatus;n.status&&a&&!a(n.status)?t(new Z("Request failed with status code "+n.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const ze=(e,t,n=3)=>{let a=0;const r=function(e,t){e=e||10;const n=new Array(e),a=new Array(e);let r,o=0,i=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=a[i];r||(r=l),n[o]=s,a[o]=l;let d=i,u=0;for(;d!==o;)u+=n[d++],d%=e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),l-r<t)return;const m=c&&l-c;return m?Math.round(1e3*u/m):void 0}}(50,250);return function(e,t){let n,a,r=0,o=1e3/t;const i=(t,o=Date.now())=>{r=o,n=null,a&&(clearTimeout(a),a=null),e(...t)};return[(...e)=>{const t=Date.now(),s=t-r;s>=o?i(e,t):(n=e,a||(a=setTimeout(()=>{a=null,i(n)},o-s)))},()=>n&&i(n)]}(n=>{const o=n.loaded,i=n.lengthComputable?n.total:void 0,s=o-a,l=r(s);a=o,e({loaded:o,total:i,progress:i?o/i:void 0,bytes:s,rate:l||void 0,estimated:l&&i&&o<=i?(i-o)/l:void 0,event:n,lengthComputable:null!=i,[t?"download":"upload"]:!0})},n)},Me=(e,t)=>{const n=null!=e;return[a=>t[0]({lengthComputable:n,total:e,loaded:a}),t[1]]},Pe=e=>(...t)=>W.asap(()=>e(...t)),Re=be.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,be.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,$e=be.hasStandardBrowserEnv?{write(e,t,n,a,r,o){const i=[e+"="+encodeURIComponent(t)];W.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),W.isString(a)&&i.push("path="+a),W.isString(r)&&i.push("domain="+r),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Oe(e,t,n){let a=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(a||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Le=e=>e instanceof Ce?{...e}:e;function Fe(e,t){t=t||{};const n={};function a(e,t,n,a){return W.isPlainObject(e)&&W.isPlainObject(t)?W.merge.call({caseless:a},e,t):W.isPlainObject(t)?W.merge({},t):W.isArray(t)?t.slice():t}function r(e,t,n,r){return W.isUndefined(t)?W.isUndefined(e)?void 0:a(void 0,e,0,r):a(e,t,0,r)}function o(e,t){if(!W.isUndefined(t))return a(void 0,t)}function i(e,t){return W.isUndefined(t)?W.isUndefined(e)?void 0:a(void 0,e):a(void 0,t)}function s(n,r,o){return o in t?a(n,r):o in e?a(void 0,n):void 0}const l={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t,n)=>r(Le(e),Le(t),0,!0)};return W.forEach(Object.keys({...e,...t}),function(a){const o=l[a]||r,i=o(e[a],t[a],a);W.isUndefined(i)&&o!==s||(n[a]=i)}),n}const je=e=>{const t=Fe({},e);let{data:n,withXSRFToken:a,xsrfHeaderName:r,xsrfCookieName:o,headers:i,auth:s}=t;if(t.headers=i=Ce.from(i),t.url=ce(Oe(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&i.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),W.isFormData(n))if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(W.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,n])=>{t.includes(e.toLowerCase())&&i.set(e,n)})}if(be.hasStandardBrowserEnv&&(a&&W.isFunction(a)&&(a=a(t)),a||!1!==a&&Re(t.url))){const e=r&&o&&$e.read(o);e&&i.set(r,e)}return t},Ue="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const a=je(e);let r=a.data;const o=Ce.from(a.headers).normalize();let i,s,l,c,d,{responseType:u,onUploadProgress:m,onDownloadProgress:p}=a;function g(){c&&c(),d&&d(),a.cancelToken&&a.cancelToken.unsubscribe(i),a.signal&&a.signal.removeEventListener("abort",i)}let h=new XMLHttpRequest;function f(){if(!h)return;const a=Ce.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());Ie(function(e){t(e),g()},function(e){n(e),g()},{data:u&&"text"!==u&&"json"!==u?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:a,config:e,request:h}),h=null}h.open(a.method.toUpperCase(),a.url,!0),h.timeout=a.timeout,"onloadend"in h?h.onloadend=f:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(f)},h.onabort=function(){h&&(n(new Z("Request aborted",Z.ECONNABORTED,e,h)),h=null)},h.onerror=function(t){const a=t&&t.message?t.message:"Network Error",r=new Z(a,Z.ERR_NETWORK,e,h);r.event=t||null,n(r),h=null},h.ontimeout=function(){let t=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const r=a.transitional||ue;a.timeoutErrorMessage&&(t=a.timeoutErrorMessage),n(new Z(t,r.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,e,h)),h=null},void 0===r&&o.setContentType(null),"setRequestHeader"in h&&W.forEach(o.toJSON(),function(e,t){h.setRequestHeader(t,e)}),W.isUndefined(a.withCredentials)||(h.withCredentials=!!a.withCredentials),u&&"json"!==u&&(h.responseType=a.responseType),p&&([l,d]=ze(p,!0),h.addEventListener("progress",l)),m&&h.upload&&([s,c]=ze(m),h.upload.addEventListener("progress",s),h.upload.addEventListener("loadend",c)),(a.cancelToken||a.signal)&&(i=t=>{h&&(n(!t||t.type?new Be(null,e,h):t),h.abort(),h=null)},a.cancelToken&&a.cancelToken.subscribe(i),a.signal&&(a.signal.aborted?i():a.signal.addEventListener("abort",i)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(a.url);v&&-1===be.protocols.indexOf(v)?n(new Z("Unsupported protocol "+v+":",Z.ERR_BAD_REQUEST,e)):h.send(r||null)})},qe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,a=new AbortController;const r=function(e){if(!n){n=!0,i();const t=e instanceof Error?e:this.reason;a.abort(t instanceof Z?t:new Be(t instanceof Error?t.message:t))}};let o=t&&setTimeout(()=>{o=null,r(new Z(`timeout ${t} of ms exceeded`,Z.ETIMEDOUT))},t);const i=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:s}=a;return s.unsubscribe=()=>W.asap(i),s}},Ge=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let a,r=0;for(;r<n;)a=r+t,yield e.slice(r,a),r=a},He=(e,t,n,a)=>{const r=async function*(e,t){for await(const n of async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}}(e))yield*Ge(n,t)}(e,t);let o,i=0,s=e=>{o||(o=!0,a&&a(e))};return new ReadableStream({async pull(e){try{const{done:t,value:a}=await r.next();if(t)return s(),void e.close();let o=a.byteLength;if(n){let e=i+=o;n(e)}e.enqueue(new Uint8Array(a))}catch(e){throw s(e),e}},cancel:e=>(s(e),r.return())},{highWaterMark:2})},{isFunction:Ye}=W,We=(({Request:e,Response:t})=>({Request:e,Response:t}))(W.global),{ReadableStream:Xe,TextEncoder:Je}=W.global,Ke=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},Ze=e=>{e=W.merge.call({skipUndefined:!0},We,e);const{fetch:t,Request:n,Response:a}=e,r=t?Ye(t):"function"==typeof fetch,o=Ye(n),i=Ye(a);if(!r)return!1;const s=r&&Ye(Xe),l=r&&("function"==typeof Je?(c=new Je,e=>c.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var c;const d=o&&s&&Ke(()=>{let e=!1;const t=new n(be.origin,{body:new Xe,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),u=i&&s&&Ke(()=>W.isReadableStream(new a("").body)),m={stream:u&&(e=>e.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!m[e]&&(m[e]=(t,n)=>{let a=t&&t[e];if(a)return a.call(t);throw new Z(`Response type '${e}' is not supported`,Z.ERR_NOT_SUPPORT,n)})});return async e=>{let{url:r,method:i,data:s,signal:c,cancelToken:p,timeout:g,onDownloadProgress:h,onUploadProgress:f,responseType:v,headers:b,withCredentials:y="same-origin",fetchOptions:x}=je(e),k=t||fetch;v=v?(v+"").toLowerCase():"text";let w=qe([c,p&&p.toAbortSignal()],g),E=null;const N=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let S;try{if(f&&d&&"get"!==i&&"head"!==i&&0!==(S=await(async(e,t)=>{const a=W.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(W.isBlob(e))return e.size;if(W.isSpecCompliantForm(e)){const t=new n(be.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return W.isArrayBufferView(e)||W.isArrayBuffer(e)?e.byteLength:(W.isURLSearchParams(e)&&(e+=""),W.isString(e)?(await l(e)).byteLength:void 0)})(t):a})(b,s))){let e,t=new n(r,{method:"POST",body:s,duplex:"half"});if(W.isFormData(s)&&(e=t.headers.get("content-type"))&&b.setContentType(e),t.body){const[e,n]=Me(S,ze(Pe(f)));s=He(t.body,65536,e,n)}}W.isString(y)||(y=y?"include":"omit");const t=o&&"credentials"in n.prototype,c={...x,signal:w,method:i.toUpperCase(),headers:b.normalize().toJSON(),body:s,duplex:"half",credentials:t?y:void 0};E=o&&new n(r,c);let p=await(o?k(E,x):k(r,c));const g=u&&("stream"===v||"response"===v);if(u&&(h||g&&N)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=p[t]});const t=W.toFiniteNumber(p.headers.get("content-length")),[n,r]=h&&Me(t,ze(Pe(h),!0))||[];p=new a(He(p.body,65536,n,()=>{r&&r(),N&&N()}),e)}v=v||"text";let V=await m[W.findKey(m,v)||"text"](p,e);return!g&&N&&N(),await new Promise((t,n)=>{Ie(t,n,{data:V,headers:Ce.from(p.headers),status:p.status,statusText:p.statusText,config:e,request:E})})}catch(t){if(N&&N(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new Z("Network Error",Z.ERR_NETWORK,e,E),{cause:t.cause||t});throw Z.from(t,t&&t.code,e,E)}}},Qe=new Map,et=e=>{let t=e?e.env:{};const{fetch:n,Request:a,Response:r}=t,o=[a,r,n];let i,s,l=o.length,c=Qe;for(;l--;)i=o[l],s=c.get(i),void 0===s&&c.set(i,s=l?new Map:Ze(t)),c=s;return s},tt=(et(),{http:null,xhr:Ue,fetch:{get:et}});W.forEach(tt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const nt=e=>`- ${e}`,at=e=>W.isFunction(e)||null===e||!1===e,rt=(e,t)=>{e=W.isArray(e)?e:[e];const{length:n}=e;let a,r;const o={};for(let i=0;i<n;i++){let n;if(a=e[i],r=a,!at(a)&&(r=tt[(n=String(a)).toLowerCase()],void 0===r))throw new Z(`Unknown adapter '${n}'`);if(r&&(W.isFunction(r)||(r=r.get(t))))break;o[n||"#"+i]=r}if(!r){const e=Object.entries(o).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));let t=n?e.length>1?"since :\n"+e.map(nt).join("\n"):" "+nt(e[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return r};function ot(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Be(null,e)}function it(e){return ot(e),e.headers=Ce.from(e.headers),e.data=Ae.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),rt(e.adapter||ke.adapter,e)(e).then(function(t){return ot(e),t.data=Ae.call(e,e.transformResponse,t),t.headers=Ce.from(t.headers),t},function(t){return De(t)||(ot(e),t&&t.response&&(t.response.data=Ae.call(e,e.transformResponse,t.response),t.response.headers=Ce.from(t.response.headers))),Promise.reject(t)})}const st="1.12.2",lt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{lt[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ct={};lt.transitional=function(e,t,n){function a(e,t){return"[Axios v"+st+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,o)=>{if(!1===e)throw new Z(a(r," has been removed"+(t?" in "+t:"")),Z.ERR_DEPRECATED);return t&&!ct[r]&&(ct[r]=!0,console.warn(a(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,o)}},lt.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};const dt={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let r=a.length;for(;r-- >0;){const o=a[r],i=t[o];if(i){const t=e[o],n=void 0===t||i(t,o,e);if(!0!==n)throw new Z("option "+o+" must be "+n,Z.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Z("Unknown option "+o,Z.ERR_BAD_OPTION)}},validators:lt},ut=dt.validators;class mt{constructor(e){this.defaults=e||{},this.interceptors={request:new de,response:new de}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Fe(this.defaults,t);const{transitional:n,paramsSerializer:a,headers:r}=t;void 0!==n&&dt.assertOptions(n,{silentJSONParsing:ut.transitional(ut.boolean),forcedJSONParsing:ut.transitional(ut.boolean),clarifyTimeoutError:ut.transitional(ut.boolean)},!1),null!=a&&(W.isFunction(a)?t.paramsSerializer={serialize:a}:dt.assertOptions(a,{encode:ut.function,serialize:ut.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),dt.assertOptions(t,{baseUrl:ut.spelling("baseURL"),withXsrfToken:ut.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&W.merge(r.common,r[t.method]);r&&W.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=Ce.concat(o,r);const i=[];let s=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!s){const e=[it.bind(this),void 0];for(e.unshift(...i),e.push(...l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=i.length;let m=t;for(;u<d;){const e=i[u++],t=i[u++];try{m=e(m)}catch(e){t.call(this,e);break}}try{c=it.call(this,m)}catch(e){return Promise.reject(e)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return ce(Oe((e=Fe(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}W.forEach(["delete","get","head","options"],function(e){mt.prototype[e]=function(t,n){return this.request(Fe(n||{},{method:e,url:t,data:(n||{}).data}))}}),W.forEach(["post","put","patch"],function(e){function t(t){return function(n,a,r){return this.request(Fe(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:a}))}}mt.prototype[e]=t(),mt.prototype[e+"Form"]=t(!0)});const pt=mt;class gt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const a=new Promise(e=>{n.subscribe(e),t=e}).then(e);return a.cancel=function(){n.unsubscribe(t)},a},e(function(e,a,r){n.reason||(n.reason=new Be(e,a,r),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new gt(function(t){e=t}),cancel:e}}}const ht=gt,ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ft).forEach(([e,t])=>{ft[t]=e});const vt=ft,bt=function e(t){const n=new pt(t),a=r(pt.prototype.request,n);return W.extend(a,pt.prototype,n,{allOwnKeys:!0}),W.extend(a,n,null,{allOwnKeys:!0}),a.create=function(n){return e(Fe(t,n))},a}(ke);bt.Axios=pt,bt.CanceledError=Be,bt.CancelToken=ht,bt.isCancel=De,bt.VERSION=st,bt.toFormData=ae,bt.AxiosError=Z,bt.Cancel=bt.CanceledError,bt.all=function(e){return Promise.all(e)},bt.spread=function(e){return function(t){return e.apply(null,t)}},bt.isAxiosError=function(e){return W.isObject(e)&&!0===e.isAxiosError},bt.mergeConfig=Fe,bt.AxiosHeaders=Ce,bt.formToJSON=e=>ye(W.isHTMLForm(e)?new FormData(e):e),bt.getAdapter=rt,bt.HttpStatusCode=vt,bt.default=bt;const yt=bt},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1153:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.overlay[data-v-a2196f8c] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  z-index: 2000;\n}\n.modal[data-v-a2196f8c] {\n  width: min(980px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  background: rgba(15, 23, 42, 0.92);\n  box-shadow: 0 25px 60px rgba(0, 0, 0, 0.55);\n  color: #e2e8f0;\n  display: flex;\n  flex-direction: column;\n}\n.header[data-v-a2196f8c] {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  gap: 1rem;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n.title h3[data-v-a2196f8c] {\n  margin: 0;\n  font-size: 1.2rem;\n}\n.subtitle[data-v-a2196f8c] {\n  margin: 0.35rem 0 0;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.92rem;\n}\n.icon-btn[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  width: 34px;\n  height: 34px;\n  border-radius: 10px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.1rem;\n}\n.body[data-v-a2196f8c] {\n  display: grid;\n  grid-template-columns: 340px 1fr;\n  gap: 0;\n  min-height: 0;\n  flex: 1;\n}\n.left[data-v-a2196f8c] {\n  border-right: 1px solid rgba(255, 255, 255, 0.08);\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n.left-actions[data-v-a2196f8c] {\n  padding: 0.9rem 0.9rem 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n.rule-list[data-v-a2196f8c] {\n  padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  overflow: auto;\n  min-height: 0;\n}\n.rule-item[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.10);\n  background: rgba(30, 41, 59, 0.40);\n  border-radius: 12px;\n  padding: 10px 10px;\n  cursor: pointer;\n  text-align: left;\n  color: inherit;\n}\n.rule-item.active[data-v-a2196f8c] {\n  border-color: rgba(147, 197, 253, 0.28);\n  background: rgba(51, 65, 85, 0.45);\n}\n.rule-row[data-v-a2196f8c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  margin-bottom: 6px;\n}\n.rule-badge[data-v-a2196f8c] {\n  font-size: 0.75rem;\n  padding: 2px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(34, 197, 94, 0.30);\n  color: rgba(34, 197, 94, 0.95);\n}\n.rule-badge.off[data-v-a2196f8c] {\n  border-color: rgba(148, 163, 184, 0.25);\n  color: rgba(148, 163, 184, 0.95);\n}\n.rule-mode[data-v-a2196f8c] {\n  font-size: 0.75rem;\n  color: rgba(148, 163, 184, 0.95);\n}\n.rule-pattern[data-v-a2196f8c] {\n  font-size: 0.9rem;\n  color: #e2e8f0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.rule-repl[data-v-a2196f8c] {\n  margin-top: 4px;\n  font-size: 0.82rem;\n  color: rgba(148, 163, 184, 0.95);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.right[data-v-a2196f8c] {\n  padding: 1rem 1.25rem;\n  overflow: auto;\n  min-height: 0;\n}\n.editor[data-v-a2196f8c] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.editor-row[data-v-a2196f8c] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.editor-row-vertical[data-v-a2196f8c] {\n  align-items: flex-start;\n  flex-direction: column;\n}\n.label[data-v-a2196f8c] {\n  width: 90px;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.9rem;\n}\n.select[data-v-a2196f8c] {\n  width: 220px;\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  padding: 10px 12px;\n}\n.textarea[data-v-a2196f8c] {\n  width: 100%;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.40);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  resize: vertical;\n}\n.hint[data-v-a2196f8c] {\n  margin-top: 8px;\n  color: rgba(148, 163, 184, 0.95);\n  font-size: 0.9rem;\n}\n.hint code[data-v-a2196f8c] {\n  padding: 1px 6px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  border-radius: 6px;\n  background: rgba(30, 41, 59, 0.6);\n}\n.options[data-v-a2196f8c] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px 16px;\n  padding: 0.5rem 0;\n}\n.opt[data-v-a2196f8c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  color: rgba(226, 232, 240, 0.95);\n}\n.opt.disabled[data-v-a2196f8c] {\n  opacity: 0.6;\n}\n.error[data-v-a2196f8c] {\n  padding: 10px 12px;\n  border-radius: 12px;\n  border: 1px solid rgba(239, 68, 68, 0.25);\n  background: rgba(127, 29, 29, 0.25);\n  color: rgba(254, 202, 202, 0.95);\n}\n.editor-actions[data-v-a2196f8c] {\n  display: flex;\n  gap: 10px;\n  padding-top: 6px;\n}\n.footer[data-v-a2196f8c] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.08);\n}\n.btn[data-v-a2196f8c] {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(30, 41, 59, 0.55);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  border-radius: 12px;\n  cursor: pointer;\n}\n.btn[data-v-a2196f8c]:hover {\n  background: rgba(51, 65, 85, 0.75);\n}\n.btn[data-v-a2196f8c]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.btn-secondary[data-v-a2196f8c] {\n  background: rgba(30, 41, 59, 0.40);\n}\n.btn-danger[data-v-a2196f8c] {\n  border-color: rgba(239, 68, 68, 0.25);\n}\n.btn-danger[data-v-a2196f8c]:hover {\n  background: rgba(127, 29, 29, 0.35);\n  border-color: rgba(239, 68, 68, 0.45);\n}\n.empty[data-v-a2196f8c] {\n  color: rgba(148, 163, 184, 0.95);\n  padding: 2rem 1rem;\n}\n@media (max-width: 900px) {\n.body[data-v-a2196f8c] {\n    grid-template-columns: 1fr;\n}\n.left[data-v-a2196f8c] {\n    border-right: none;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n}\n}\n",""]);const s=i},1156:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>xne});var a=n(3992),r=n(4061),o=n(602);const i="videos",s=(0,o.P2)("video-cache-db",1,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i)}}),l={class:"video-background-container"},c=(0,r.defineComponent)({__name:"VideoBackground",props:{src:{default:"https://raw.githubusercontent.com/BlcaCola/Transcendent-Rebirth/main/video/video.mp4"}},setup(e){const t=e,n=(0,r.ref)(),a=async e=>{if(!n.value&&(console.warn("[VideoBackground] video元素未准备好，延迟重试"),await new Promise(e=>setTimeout(e,100)),!n.value))return void console.error("[VideoBackground] video元素仍未准备好，放弃加载");n.value.src&&n.value.src.startsWith("blob:")&&(console.log(`[VideoBackground] 释放旧的 Object URL: ${n.value.src}`),URL.revokeObjectURL(n.value.src));try{const t=await async function(e){try{const t=await s;return await t.get(i,e)}catch(t){return void console.error(`[videoCache] Error getting video for key ${e}:`,t)}}(e);if(t){console.log(`[VideoBackground] 从IndexedDB加载视频: ${e}`);const a=URL.createObjectURL(t);console.log(`[VideoBackground] 创建新的 Object URL: ${a}`),n.value&&(n.value.src=a)}else{console.log(`[VideoBackground] 尝试从网络加载视频: ${e}`);const t=await fetch(e);if(!t.ok)throw new Error(`网络响应错误: ${t.statusText}`);const a=await t.blob();await async function(e,t){try{const n=(await s).transaction(i,"readwrite");await n.store.put(t,e),await n.done}catch(t){throw console.error(`[videoCache] Error setting video for key ${e}:`,t),t}}(e,a),console.log(`[VideoBackground] 视频已成功存入缓存: ${e}`);const r=URL.createObjectURL(a);console.log(`[VideoBackground] 创建新的 Object URL: ${r}`),n.value&&(n.value.src=r)}n.value&&n.value.load()}catch(t){console.warn("[VideoBackground] 加载或缓存视频失败:",t),console.log("[VideoBackground] 可能是跨域（CORS）问题，无法缓存。正在回退到直接播放模式..."),n.value&&(n.value.src=e,n.value.load())}const t=async()=>{if(n.value)try{await n.value.play(),console.log("[VideoBackground] 视频播放成功")}catch{console.log("[VideoBackground] 自动播放失败，等待用户交互");const e=async()=>{if(n.value)try{await n.value.play(),console.log("[VideoBackground] 用户交互后视频播放成功"),document.removeEventListener("click",e),document.removeEventListener("keydown",e),document.removeEventListener("touchstart",e)}catch(e){console.warn("[VideoBackground] 即使用户交互后仍无法播放:",e)}};document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}};n.value&&n.value.readyState>=3?await t():n.value&&n.value.addEventListener("canplay",t,{once:!0})};(0,r.onMounted)(async()=>{await a(t.src)}),(0,r.watch)(()=>t.src,async e=>{e&&await a(e)}),(0,r.onUnmounted)(()=>{n.value&&(n.value.pause(),n.value.src.startsWith("blob:")&&(console.log(`[VideoBackground] 组件卸载，释放 Object URL: ${n.value.src}`),URL.revokeObjectURL(n.value.src)))});const o=()=>{console.log("[VideoBackground] 开始加载视频")},c=()=>{console.log("[VideoBackground] 视频可以流畅播放")},d=e=>{console.error("[VideoBackground] 视频播放错误:",e)};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",l,[(0,r.createElementVNode)("video",{ref_key:"videoRef",ref:n,autoplay:"",muted:"",loop:"",playsinline:"",class:"video-background",onLoadstart:o,onCanplaythrough:c,onError:d},null,544),t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"video-overlay"},null,-1))]))}});var d=n(5072),u=n.n(d),m=n(7825),p=n.n(m),g=n(7659),h=n.n(g),f=n(5056),v=n.n(f),b=n(540),y=n.n(b),x=n(1113),k=n.n(x),w=n(272),E={};E.styleTagTransform=k(),E.setAttributes=v(),E.insert=h().bind(null,"head"),E.domAPI=p(),E.insertStyleElement=y(),u()(w.A,E),w.A&&w.A.locals&&w.A.locals;var N=n(6262);const S=(0,N.A)(c,[["__scopeId","data-v-49aadee8"]]);var V=n(9596);const _=(0,V.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),C=(0,V.A)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var A=n(9173),D=n(8546),T=n(9333);const B={class:"mode-selection-container"},I={class:"bottom-left-section"},z={class:"left-bottom-content"},M={class:"info-group"},P={class:"version-tag"},R={class:"bottom-right-section"},$={class:"gate-container"},O={class:"gate-icon"},L={class:"gate-info"},F={class:"gate-title"},j={class:"gate-icon"},U={class:"gate-info"},q={class:"gate-title"},G=(0,r.defineComponent)({__name:"ModeSelection",emits:["start-creation","show-character-list","go-to-login"],setup(e,{emit:t}){const n=(0,r.ref)(!1),a=(0,r.ref)(null),o=(0,r.computed)(()=>n.value?a.value??"同步中":"");(0,r.onMounted)(async()=>{if((0,D.isBackendConfigured)()){const e=await(0,D.d9)();e&&(n.value=!0,a.value=e)}});const i=t,s=(0,A.useUIStore)(),l=async()=>{await(0,T.verifyStoredToken)()?i("start-creation","single"):s.showRetryDialog({title:"请先登录",message:"开始游戏需要先登录账号，是否前往登录？",confirmText:"前往登录",cancelText:"取消",onConfirm:()=>{i("go-to-login")},onCancel:()=>{}})},c=async()=>{i("show-character-list")};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",B,[(0,r.createVNode)(S),(0,r.createCommentVNode)(" 左上角：标题 "),t[4]||(t[4]=(0,r.createElementVNode)("div",{class:"top-left-section"},[(0,r.createElementVNode)("h1",{class:"main-title"},"超凡新生"),(0,r.createElementVNode)("p",{class:"sub-title"},"关于我穿越到异世界开启第二人生的故事")],-1)),(0,r.createCommentVNode)(" 左下角：功能按钮、已连接、版本号 "),(0,r.createElementVNode)("div",I,[(0,r.createElementVNode)("div",z,[(0,r.createElementVNode)("div",M,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["status-indicator",n.value?"online":"offline"])},[t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"status-dot"},null,-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(n.value?"已连接":"离线"),1)],2),(0,r.createElementVNode)("div",P,"V"+(0,r.toDisplayString)(o.value),1)])])]),(0,r.createCommentVNode)(" 右下角：模式选择卡片 "),(0,r.createElementVNode)("div",R,[(0,r.createElementVNode)("div",$,[(0,r.createCommentVNode)(" 单机模式 "),(0,r.createElementVNode)("div",{class:"gate-card",onClick:l},[(0,r.createElementVNode)("div",O,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"icon-bg"},null,-1)),(0,r.createVNode)((0,r.unref)(_),{size:36,"stroke-width":1.5})]),(0,r.createElementVNode)("div",L,[(0,r.createElementVNode)("h2",F,(0,r.toDisplayString)(e.$t("开始游戏")),1),t[2]||(t[2]=(0,r.createElementVNode)("div",{class:"gate-tags"},[(0,r.createElementVNode)("span",{class:"tag-local"},"安全存储"),(0,r.createElementVNode)("span",{class:"tag-offline"},"隐私保障")],-1))])]),(0,r.createCommentVNode)(" 联机模式已移除 "),(0,r.createCommentVNode)(" 加载存档 "),(0,r.createElementVNode)("div",{class:"gate-card load-archive",onClick:c},[(0,r.createElementVNode)("div",j,[t[3]||(t[3]=(0,r.createElementVNode)("div",{class:"icon-bg"},null,-1)),(0,r.createVNode)((0,r.unref)(C),{size:36,"stroke-width":1.5})]),(0,r.createElementVNode)("div",U,[(0,r.createElementVNode)("h2",q,(0,r.toDisplayString)(e.$t("加载存档")),1)])])])])]))}});var H=n(9433),Y={};Y.styleTagTransform=k(),Y.setAttributes=v(),Y.insert=h().bind(null,"head"),Y.domAPI=p(),Y.insertStyleElement=y(),u()(H.A,Y),H.A&&H.A.locals&&H.A.locals;const W=(0,N.A)(G,[["__scopeId","data-v-2f096032"]]);var X=n(4270),J=n(1211),K=n(876);const Z=["disabled","title"],Q={key:0,class:"sync-icon"},ee={key:1,class:"sync-icon"},te={key:2,class:"sync-icon"},ne={class:"sync-text"},ae=(0,r.defineComponent)({__name:"CloudDataSync",props:{size:{},variant:{}},emits:["syncCompleted","syncStarted"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,A.useUIStore)(),{t:i}=(0,K.s)(),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.computed)(()=>!o.isBackendConfiguredComputed);async function d(){if(s.value||l.value)return void(l.value&&X.o.info(i("云端数据已获取，无需重复操作")));s.value=!0,n("syncStarted");const e="cloud-sync-toast";X.o.loading(i("正在获取更新数据..."),{id:e});try{const t=await a.fetchAllCloudData();t>0?(X.o.success(i("同步成功！新增 {0} 项云端数据").replace("{0}",String(t)),{id:e}),l.value=!0):(X.o.info(i("所有云端数据已是最新"),{id:e}),l.value=!0),n("syncCompleted",{success:!0,newItemsCount:t,message:i("同步成功")})}catch(t){console.error("[云端同步组件] 同步云端数据失败:",t);const a=t instanceof Error?t.message:i("同步失败");X.o.error(i("同步失败: {0}").replace("{0}",a),{id:e}),n("syncCompleted",{success:!1,newItemsCount:0,message:a})}finally{s.value=!1}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{onClick:d,class:(0,r.normalizeClass)(["cloud-sync-button",{synced:l.value,disabled:c.value}]),disabled:c.value||s.value,title:c.value?i("云端功能暂未开放"):s.value?i("正在同步云端数据..."):l.value?i("云端数据已获取"):i("获取更新数据")},[s.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Q,"⏳")):l.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",ee,"✅")):((0,r.openBlock)(),(0,r.createElementBlock)("span",te,"☁️")),(0,r.createElementVNode)("span",ne,(0,r.toDisplayString)(c.value?i("暂不可用"):s.value?i("同步中"):l.value?i("已获取"):i("获取更新")),1)],10,Z))}});var re=n(7631),oe={};oe.styleTagTransform=k(),oe.setAttributes=v(),oe.insert=h().bind(null,"head"),oe.domAPI=p(),oe.insertStyleElement=y(),u()(re.A,oe),re.A&&re.A.locals&&re.A.locals;const ie=(0,N.A)(ae,[["__scopeId","data-v-e5d5209c"]]);var se=n(8651),le=n(7527);const ce={class:"data-clear-container"},de={class:"clear-buttons"},ue=["disabled"],me=(0,r.defineComponent)({__name:"DataClearButtons",props:{variant:{},size:{}},emits:["dataCleared"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,A.useUIStore)(),i=(0,r.computed)(()=>{const e=Math.max(...le.eQ.map(e=>e.id)),t=Math.max(...le.VQ.map(e=>e.id)),n=Math.max(...le.yM.map(e=>e.id)),r=Math.max(...le.Gr.map(e=>e.id)),o=Math.max(...le.qS.map(e=>e.id));return a.creationData.worlds.some(t=>"cloud"===t.source||t.id>e)||a.creationData.talentTiers.some(e=>"cloud"===e.source||e.id>t)||a.creationData.origins.some(e=>"cloud"===e.source||e.id>n)||a.creationData.spiritRoots.some(e=>"cloud"===e.source||e.id>r)||a.creationData.talents.some(e=>"cloud"===e.source||e.id>o)});async function s(){i.value&&o.showRetryDialog({title:"清除自定义数据",message:"确定要清除自定义数据吗？这将清除所有自定义和AI生成的数据，保留本地基础数据和云端数据。此操作不可撤销！",confirmText:"确认清除",cancelText:"取消",onConfirm:async()=>{const e=a.creationData.worlds.length,t=a.creationData.talentTiers.length,r=a.creationData.origins.length,o=a.creationData.spiritRoots.length,i=a.creationData.talents.length,s=Math.max(...le.eQ.map(e=>e.id)),l=Math.max(...le.VQ.map(e=>e.id)),c=Math.max(...le.yM.map(e=>e.id)),d=Math.max(...le.Gr.map(e=>e.id)),u=Math.max(...le.qS.map(e=>e.id));a.creationData.worlds=a.creationData.worlds.filter(e=>"local"===e.source||e.id<=s),a.creationData.talentTiers=a.creationData.talentTiers.filter(e=>"local"===e.source||e.id<=l),a.creationData.origins=a.creationData.origins.filter(e=>"local"===e.source||e.id<=c),a.creationData.spiritRoots=a.creationData.spiritRoots.filter(e=>"local"===e.source||e.id<=d),a.creationData.talents=a.creationData.talents.filter(e=>"local"===e.source||e.id<=u);const m=e-a.creationData.worlds.length+(t-a.creationData.talentTiers.length)+(r-a.creationData.origins.length)+(o-a.creationData.spiritRoots.length)+(i-a.creationData.talents.length);a.resetCharacter(),await async function(){try{const e=(0,se.getTavernHelper)();if(!e)return void console.warn("酒馆助手不可用，跳过清理酒馆自定义数据");await e.deleteVariable("DAD_creationData",{type:"global"}),console.log("已清理酒馆全局变量 DAD_creationData");const t=await e.getVariables({type:"global"}),n=Object.keys(t).filter(e=>e.includes("DAD_")||e.includes("custom")||e.includes("自定义"));n.length>0&&(await Promise.all(n.map(t=>e.deleteVariable(t,{type:"global"}))),console.log(`已清理 ${n.length} 个自定义数据相关的酒馆变量:`,n))}catch(e){console.error("清理酒馆自定义数据时出错:",e)}}(),await a.persistCustomData(),X.o.success(`已清除${m} 项自定义数据，保留本地基础数据和云端数据`),n("dataCleared","custom",m)},onCancel:()=>{}})}return(0,r.computed)(()=>a.creationData.worlds.some(e=>"cloud"===e.source)||a.creationData.talentTiers.some(e=>"cloud"===e.source)||a.creationData.origins.some(e=>"cloud"===e.source)||a.creationData.spiritRoots.some(e=>"cloud"===e.source)||a.creationData.talents.some(e=>"cloud"===e.source)),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",ce,[(0,r.createElementVNode)("div",de,[(0,r.createCommentVNode)(" 清除自定义数据（自定义+AI生成），保留本地基础+云端数据 "),(0,r.createElementVNode)("button",{onClick:s,class:"clear-button custom",disabled:!i.value,title:"清除自定义和AI生成的数据"},t[0]||(t[0]=[(0,r.createElementVNode)("span",{class:"clear-icon"},"🗑️",-1),(0,r.createElementVNode)("span",{class:"clear-text"},"清除自定义",-1)]),8,ue),(0,r.createCommentVNode)(" 清除云端数据，保留本地基础+自定义数据 "),(0,r.createCommentVNode)(" 🔥 暂时隐藏：后端未上线 "),(0,r.createCommentVNode)("v-if",!0)])]))}});var pe=n(1393),ge={};ge.styleTagTransform=k(),ge.setAttributes=v(),ge.insert=h().bind(null,"head"),ge.domAPI=p(),ge.insertStyleElement=y(),u()(pe.A,ge),pe.A&&pe.A.locals&&pe.A.locals;const he=(0,N.A)(me,[["__scopeId","data-v-5b396b26"]]),fe={class:"modal-container"},ve={class:"modal-content"},be={class:"form-group"},ye={class:"char-count"},xe={class:"form-group"},ke={class:"char-count"},we={key:0,class:"preset-preview"},Ee={class:"preview-tags"},Ne={key:0,class:"info-tag"},Se={key:1,class:"info-tag"},Ve={key:2,class:"info-tag"},_e={key:3,class:"info-tag"},Ce={key:4,class:"info-tag talent-tag"},Ae={class:"preset-info"},De={class:"info-item"},Te={class:"info-value"},Be={class:"modal-footer"},Ie=["disabled"],ze={key:0},Me={key:1},Pe=(0,r.defineComponent)({__name:"PresetSaveModal",props:{visible:{type:Boolean},characterData:{}},emits:["close","submit"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)(""),i=(0,r.ref)(""),s=(0,r.ref)(""),l=(0,r.ref)(!1);let c=null;function d(){const e=new Date;s.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function u(){l.value||a("close")}function m(){o.value.trim()&&!l.value&&(l.value=!0,setTimeout(()=>{a("submit",{presetName:o.value.trim(),presetDescription:i.value.trim(),characterData:n.characterData}),l.value=!1},300))}return(0,r.onMounted)(()=>{d(),c=window.setInterval(d,1e3)}),(0,r.onUnmounted)(()=>{null!==c&&clearInterval(c)}),(0,r.watch)(()=>n.visible,e=>{e&&(o.value="",i.value="",d(),setTimeout(()=>{const e=document.querySelector(".form-input");e?.focus()},100))}),(e,t)=>e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(u,["self"])},[(0,r.createElementVNode)("div",fe,[(0,r.createCommentVNode)(" Header "),(0,r.createElementVNode)("div",{class:"modal-header"},[t[2]||(t[2]=(0,r.createElementVNode)("h2",{class:"modal-title"},"💾 保存预设",-1)),(0,r.createElementVNode)("button",{class:"modal-close",onClick:u},"×")]),(0,r.createCommentVNode)(" Content "),(0,r.createElementVNode)("div",ve,[(0,r.createElementVNode)("div",be,[t[3]||(t[3]=(0,r.createElementVNode)("label",{class:"form-label"},[(0,r.createTextVNode)("预设名称 "),(0,r.createElementVNode)("span",{class:"required"},"*")],-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),type:"text",class:"form-input",placeholder:"请输入预设名称（如：剑修预设、治愈系预设等）",onKeyup:(0,r.withKeys)(m,["enter"]),maxlength:"50",autofocus:""},null,544),[[r.vModelText,o.value]]),(0,r.createElementVNode)("div",ye,(0,r.toDisplayString)(o.value.length)+"/50",1)]),(0,r.createElementVNode)("div",xe,[t[4]||(t[4]=(0,r.createElementVNode)("label",{class:"form-label"},[(0,r.createTextVNode)("预设描述 "),(0,r.createElementVNode)("span",{class:"optional"},"（可选）")],-1)),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"form-textarea",placeholder:"输入此预设的描述信息...",maxlength:"200",rows:"4"},null,512),[[r.vModelText,i.value]]),(0,r.createElementVNode)("div",ke,(0,r.toDisplayString)(i.value.length)+"/200",1)]),(0,r.createCommentVNode)(" 预设内容预览 "),e.characterData?((0,r.openBlock)(),(0,r.createElementBlock)("div",we,[t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"preview-header"},"📋 预设内容预览",-1)),(0,r.createElementVNode)("div",Ee,[e.characterData.world?((0,r.openBlock)(),(0,r.createElementBlock)("span",Ne,(0,r.toDisplayString)(e.characterData.world.name),1)):(0,r.createCommentVNode)("v-if",!0),e.characterData.talentTier?((0,r.openBlock)(),(0,r.createElementBlock)("span",Se,(0,r.toDisplayString)(e.characterData.talentTier.name),1)):(0,r.createCommentVNode)("v-if",!0),e.characterData.origin?((0,r.openBlock)(),(0,r.createElementBlock)("span",Ve,(0,r.toDisplayString)(e.characterData.origin.name),1)):(0,r.createCommentVNode)("v-if",!0),e.characterData.spiritRoot?((0,r.openBlock)(),(0,r.createElementBlock)("span",_e,(0,r.toDisplayString)(e.characterData.spiritRoot.name),1)):(0,r.createCommentVNode)("v-if",!0),e.characterData.talents&&e.characterData.talents.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",Ce,(0,r.toDisplayString)(e.characterData.talents.length)+" 个天赋 ",1)):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Ae,[(0,r.createElementVNode)("div",De,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"info-label"},"📅 保存时间：",-1)),(0,r.createElementVNode)("span",Te,(0,r.toDisplayString)(s.value),1)])])]),(0,r.createCommentVNode)(" Footer "),(0,r.createElementVNode)("div",Be,[(0,r.createElementVNode)("button",{class:"btn btn-cancel",onClick:u},"取消"),(0,r.createElementVNode)("button",{class:"btn btn-confirm",onClick:m,disabled:!o.value.trim()||l.value},[l.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",ze,"💫 保存中...")):((0,r.openBlock)(),(0,r.createElementBlock)("span",Me,"✨ 保存预设"))],8,Ie)])])])):(0,r.createCommentVNode)("v-if",!0)}});var Re=n(4178),$e={};$e.styleTagTransform=k(),$e.setAttributes=v(),$e.insert=h().bind(null,"head"),$e.domAPI=p(),$e.insertStyleElement=y(),u()(Re.A,$e),Re.A&&Re.A.locals&&Re.A.locals;const Oe=(0,N.A)(Pe,[["__scopeId","data-v-431f1334"]]),Le=["disabled","title"],Fe={key:0,class:"sync-icon"},je={key:1,class:"sync-icon"},Ue={key:2,class:"sync-icon"},qe={class:"sync-text"},Ge=(0,r.defineComponent)({__name:"StorePreSeting",props:{size:{},variant:{},currentStep:{},totalSteps:{},characterData:{}},emits:["storeCompleted","storeStarted"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)(!1),i=(0,r.ref)(!1),s=(0,r.ref)(!1),{t:l}=(0,K.s)(),c=(0,r.computed)(()=>void 0===n.currentStep||void 0===n.totalSteps||n.currentStep===n.totalSteps);function d(){o.value||i.value||!c.value?i.value?X.o.info(l("预设已存储，无需重复操作")):c.value||X.o.warning(l("请完成所有步骤后再保存预设")):(s.value=!0,a("storeStarted"))}async function u(e){o.value=!0,s.value=!1;const t={name:e.presetName,description:e.presetDescription,savedAt:(new Date).toISOString()};i.value=!0,a("storeCompleted",{success:!0,message:l("预设保存成功"),presetData:t}),o.value=!1}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("button",{onClick:d,class:(0,r.normalizeClass)(["cloud-sync-button",{synced:i.value}]),disabled:o.value||!c.value,title:c.value?o.value?l("正在存储预设..."):i.value?l("预设已存储"):l("保存当前选择为预设"):l("请完成所有步骤后再保存预设")},[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Fe,"⏳")):i.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",je,"✅")):((0,r.openBlock)(),(0,r.createElementBlock)("span",Ue,"💾")),(0,r.createElementVNode)("span",qe,(0,r.toDisplayString)(o.value?l("存储中"):i.value?l("已存储"):l("存储预设")),1)],10,Le),(0,r.createCommentVNode)(" 预设保存对话框 "),(0,r.createVNode)(Oe,{visible:s.value,"character-data":n.characterData,onClose:t[0]||(t[0]=e=>s.value=!1),onSubmit:u},null,8,["visible","character-data"])]))}});var He=n(2497),Ye={};Ye.styleTagTransform=k(),Ye.setAttributes=v(),Ye.insert=h().bind(null,"head"),Ye.domAPI=p(),Ye.insertStyleElement=y(),u()(He.A,Ye),He.A&&He.A.locals&&He.A.locals;const We=(0,N.A)(Ge,[["__scopeId","data-v-5cceb5b0"]]);var Xe=n(5735);const Je={class:"modal-container"},Ke={class:"modal-content"},Ze={key:0,class:"loading-state"},Qe={key:1,class:"empty-state"},et={key:2},tt={class:"export-options"},nt={class:"option-label"},at={class:"option-text"},rt={class:"option-desc"},ot={class:"option-label"},it={key:0,class:"presets-list"},st={class:"list-header"},lt={class:"checkbox-label"},ct=["checked"],dt={class:"selected-count"},ut={class:"preset-items"},mt=["value"],pt={class:"preset-info"},gt={class:"preset-header"},ht={class:"preset-name"},ft={class:"preset-date"},vt={key:0,class:"preset-description"},bt={key:1,class:"preset-tags"},yt={key:0,class:"info-tag name-tag"},xt={key:1,class:"info-tag age-tag"},kt={key:2,class:"info-tag"},wt={key:3,class:"info-tag"},Et={class:"export-info"},Nt={class:"info-item"},St={class:"info-value"},Vt={class:"info-item"},_t={class:"info-value"},Ct={class:"modal-footer"},At=["disabled"],Dt={key:0},Tt={key:1},Bt=(0,r.defineComponent)({__name:"PresetExportModal",props:{visible:{type:Boolean}},emits:["close","exported"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)([]),i=(0,r.ref)("all"),s=(0,r.ref)([]),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)("");let u=null;const m=(0,r.computed)(()=>o.value.length>0&&s.value.length===o.value.length),p=(0,r.computed)(()=>0!==o.value.length&&("all"===i.value||s.value.length>0));function g(){const e=new Date;d.value=e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function h(e){const t=new Date(e),n=(new Date).getTime()-t.getTime(),a=Math.floor(n/864e5);return 0===a?"今天":1===a?"昨天":a<7?`${a}天前`:t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function f(){m.value?s.value=[]:s.value=o.value.map(e=>e.id)}function v(){return"all"===i.value?o.value.length:s.value.length}function b(){c.value||a("close")}async function y(){if(!p.value||c.value)return;c.value=!0;const e="export-preset-toast";X.o.loading("正在导出预设...",{id:e});try{const t="all"===i.value?void 0:s.value;await(0,Xe.VW)(t);const n=v();X.o.success(`成功导出 ${n} 个预设！`,{id:e}),a("exported"),a("close")}catch(t){console.error("[预设导出对话框] 导出失败:",t);const n=t instanceof Error?t.message:"导出失败";X.o.error(`导出失败: ${n}`,{id:e})}finally{c.value=!1}}return(0,r.onMounted)(()=>{g(),u=window.setInterval(g,1e3)}),(0,r.onUnmounted)(()=>{null!==u&&clearInterval(u)}),(0,r.watch)(()=>n.visible,async e=>{e&&(i.value="all",s.value=[],await async function(){l.value=!0;try{console.log("[预设导出对话框] 开始加载预设列表");const e=await(0,Xe.Vd)();o.value=e,console.log("[预设导出对话框] 成功加载",o.value.length,"个预设")}catch(e){console.error("[预设导出对话框] 加载预设列表失败:",e),X.o.error("加载预设列表失败"),o.value=[]}finally{l.value=!1}}())}),(e,t)=>e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(b,["self"])},[(0,r.createElementVNode)("div",Je,[(0,r.createCommentVNode)(" Header "),(0,r.createElementVNode)("div",{class:"modal-header"},[t[3]||(t[3]=(0,r.createElementVNode)("h2",{class:"modal-title"},"📤 导出预设",-1)),(0,r.createElementVNode)("button",{class:"modal-close",onClick:b},"×")]),(0,r.createCommentVNode)(" Content "),(0,r.createElementVNode)("div",Ke,[l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ze,t[4]||(t[4]=[(0,r.createElementVNode)("div",{class:"spinner"},null,-1),(0,r.createElementVNode)("p",null,"正在加载预设列表...",-1)]))):0===o.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Qe,t[5]||(t[5]=[(0,r.createElementVNode)("div",{class:"empty-icon"},"📭",-1),(0,r.createElementVNode)("p",null,"暂无可导出的预设",-1),(0,r.createElementVNode)("p",{class:"empty-hint"},"请先保存一些预设后再进行导出",-1)]))):((0,r.openBlock)(),(0,r.createElementBlock)("div",et,[(0,r.createCommentVNode)(" 导出模式选择 "),(0,r.createElementVNode)("div",tt,[(0,r.createElementVNode)("label",nt,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),value:"all",class:"radio-input"},null,512),[[r.vModelRadio,i.value]]),(0,r.createElementVNode)("span",at,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"option-title"},"导出全部预设",-1)),(0,r.createElementVNode)("span",rt,"导出所有 "+(0,r.toDisplayString)(o.value.length)+" 个预设",1)])]),(0,r.createElementVNode)("label",ot,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),value:"selected",class:"radio-input"},null,512),[[r.vModelRadio,i.value]]),t[7]||(t[7]=(0,r.createElementVNode)("span",{class:"option-text"},[(0,r.createElementVNode)("span",{class:"option-title"},"导出选中预设"),(0,r.createElementVNode)("span",{class:"option-desc"},"选择要导出的预设")],-1))])]),(0,r.createCommentVNode)(" 预设列表 (仅在选中模式下显示) "),"selected"===i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",it,[(0,r.createElementVNode)("div",st,[(0,r.createElementVNode)("label",lt,[(0,r.createElementVNode)("input",{type:"checkbox",checked:m.value,onChange:f,class:"checkbox-input"},null,40,ct),t[8]||(t[8]=(0,r.createElementVNode)("span",null,"全选/取消全选",-1))]),(0,r.createElementVNode)("span",dt,"已选择 "+(0,r.toDisplayString)(s.value.length)+" 个",1)]),(0,r.createElementVNode)("div",ut,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("label",{key:e.id,class:(0,r.normalizeClass)(["preset-item",{selected:s.value.includes(e.id)}])},[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e),class:"checkbox-input"},null,8,mt),[[r.vModelCheckbox,s.value]]),(0,r.createElementVNode)("div",pt,[(0,r.createElementVNode)("div",gt,[(0,r.createElementVNode)("h3",ht,(0,r.toDisplayString)(e.name||"未命名预设"),1),(0,r.createElementVNode)("span",ft,(0,r.toDisplayString)(h(e.savedAt)),1)]),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("p",vt,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0),e.data?((0,r.openBlock)(),(0,r.createElementBlock)("div",bt,[e.data.character_name?((0,r.openBlock)(),(0,r.createElementBlock)("span",yt,(0,r.toDisplayString)(e.data.character_name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.current_age?((0,r.openBlock)(),(0,r.createElementBlock)("span",xt,(0,r.toDisplayString)(e.data.current_age)+"岁",1)):(0,r.createCommentVNode)("v-if",!0),e.data.world?((0,r.openBlock)(),(0,r.createElementBlock)("span",kt,(0,r.toDisplayString)(e.data.world.name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.talentTier?((0,r.openBlock)(),(0,r.createElementBlock)("span",wt,(0,r.toDisplayString)(e.data.talentTier.name),1)):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0)])],2))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 导出信息 "),(0,r.createElementVNode)("div",Et,[(0,r.createElementVNode)("div",Nt,[t[9]||(t[9]=(0,r.createElementVNode)("span",{class:"info-label"},"📦 导出数量：",-1)),(0,r.createElementVNode)("span",St,(0,r.toDisplayString)(v())+" 个预设",1)]),t[11]||(t[11]=(0,r.createElementVNode)("div",{class:"info-item"},[(0,r.createElementVNode)("span",{class:"info-label"},"📄 文件格式："),(0,r.createElementVNode)("span",{class:"info-value"},"JSON")],-1)),(0,r.createElementVNode)("div",Vt,[t[10]||(t[10]=(0,r.createElementVNode)("span",{class:"info-label"},"📅 导出时间：",-1)),(0,r.createElementVNode)("span",_t,(0,r.toDisplayString)(d.value),1)])])]))]),(0,r.createCommentVNode)(" Footer "),(0,r.createElementVNode)("div",Ct,[(0,r.createElementVNode)("button",{class:"btn btn-cancel",onClick:b},"取消"),(0,r.createElementVNode)("button",{class:"btn btn-confirm",onClick:y,disabled:!p.value||c.value},[c.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Dt,"⏳ 导出中...")):((0,r.openBlock)(),(0,r.createElementBlock)("span",Tt,"📥 导出预设"))],8,At)])])])):(0,r.createCommentVNode)("v-if",!0)}});var It=n(7457),zt={};zt.styleTagTransform=k(),zt.setAttributes=v(),zt.insert=h().bind(null,"head"),zt.domAPI=p(),zt.insertStyleElement=y(),u()(It.A,zt),It.A&&It.A.locals&&It.A.locals;const Mt=(0,N.A)(Bt,[["__scopeId","data-v-3e075713"]]),Pt={class:"modal-container"},Rt={class:"modal-content"},$t={key:0,class:"file-info"},Ot={class:"file-header"},Lt={class:"file-name"},Ft={class:"file-size"},jt={key:1,class:"import-options"},Ut={class:"option-label"},qt={class:"option-label"},Gt={class:"result-icon"},Ht={class:"result-content"},Yt={class:"result-message"},Wt={key:0,class:"result-details"},Xt={key:0,class:"detail-item success"},Jt={key:1,class:"detail-item error"},Kt={class:"modal-footer"},Zt=["disabled"],Qt={key:0},en={key:1},tn=(0,r.defineComponent)({__name:"PresetImportModal",props:{visible:{type:Boolean}},emits:["close","imported"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)(null),i=(0,r.ref)(null),s=(0,r.ref)("merge"),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)(null);function u(){o.value?.click()}function m(e){const t=e.target,n=t.files?.[0];n&&g(n)}function p(e){c.value=!1;const t=e.dataTransfer?.files[0];t&&g(t)}function g(e){e.name.endsWith(".json")||"application/json"===e.type?e.size>10485760?X.o.error("文件大小超过限制（最大10MB）"):(i.value=e,d.value=null):X.o.error("请选择JSON格式的文件")}function h(){i.value=null,d.value=null,o.value&&(o.value.value="")}function f(){l.value||a("close")}async function v(){if(!i.value||l.value)return;if("replace"===s.value&&!window.confirm("替换模式将删除所有现有预设！\n\n此操作不可撤销，确定要继续吗？"))return;l.value=!0;const e="import-preset-toast";X.o.loading("正在导入预设...",{id:e});try{const t=await(0,Xe.Ge)(i.value,s.value);console.log("[预设导入对话框] 导入完成:",t),t.success>0&&0===t.failed?(d.value={type:"success",message:`成功导入 ${t.success} 个预设！`,details:t},X.o.success(`成功导入 ${t.success} 个预设！`,{id:e})):t.success>0&&t.failed>0?(d.value={type:"warning",message:"部分预设导入成功",details:t},X.o.warning(`成功: ${t.success} 个，失败: ${t.failed} 个`,{id:e})):(d.value={type:"error",message:"预设导入失败",details:t},X.o.error("预设导入失败",{id:e})),a("imported",t)}catch(t){console.error("[预设导入对话框] 导入失败:",t);const n=t instanceof Error?t.message:"导入失败";d.value={type:"error",message:`导入失败: ${n}`},X.o.error(`导入失败: ${n}`,{id:e})}finally{l.value=!1}}return(0,r.watch)(()=>n.visible,e=>{e&&(i.value=null,s.value="merge",d.value=null,c.value=!1)}),(e,t)=>{return e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(f,["self"])},[(0,r.createElementVNode)("div",Pt,[(0,r.createCommentVNode)(" Header "),(0,r.createElementVNode)("div",{class:"modal-header"},[t[4]||(t[4]=(0,r.createElementVNode)("h2",{class:"modal-title"},"📥 导入预设",-1)),(0,r.createElementVNode)("button",{class:"modal-close",onClick:f},"×")]),(0,r.createCommentVNode)(" Content "),(0,r.createElementVNode)("div",Rt,[(0,r.createCommentVNode)(" 文件选择区域 "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["upload-area",{"drag-over":c.value}]),onDrop:(0,r.withModifiers)(p,["prevent"]),onDragover:t[0]||(t[0]=(0,r.withModifiers)(e=>c.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=(0,r.withModifiers)(e=>c.value=!1,["prevent"]))},[(0,r.createElementVNode)("input",{ref_key:"fileInputRef",ref:o,type:"file",accept:".json,application/json",onChange:m,class:"file-input"},null,544),(0,r.createElementVNode)("div",{class:"upload-content"},[t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"upload-icon"},"📁",-1)),t[6]||(t[6]=(0,r.createElementVNode)("p",{class:"upload-text"},"拖放JSON文件到此处，或点击选择文件",-1)),(0,r.createElementVNode)("button",{class:"btn-select",onClick:u},"选择文件"),t[7]||(t[7]=(0,r.createElementVNode)("p",{class:"upload-hint"},"仅支持通过本应用导出的预设JSON文件",-1))])],34),(0,r.createCommentVNode)(" 已选择文件信息 "),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",$t,[(0,r.createElementVNode)("div",Ot,[t[8]||(t[8]=(0,r.createElementVNode)("span",{class:"file-icon"},"📄",-1)),(0,r.createElementVNode)("span",Lt,(0,r.toDisplayString)(i.value.name),1),(0,r.createElementVNode)("span",Ft,(0,r.toDisplayString)((n=i.value.size,n<1024?`${n} B`:n<1048576?`${(n/1024).toFixed(2)} KB`:`${(n/1048576).toFixed(2)} MB`)),1),(0,r.createElementVNode)("button",{class:"btn-remove",onClick:h},"×")])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 导入选项 "),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",jt,[(0,r.createElementVNode)("label",Ut,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e),value:"merge",class:"radio-input"},null,512),[[r.vModelRadio,s.value]]),t[9]||(t[9]=(0,r.createElementVNode)("span",{class:"option-text"},[(0,r.createElementVNode)("span",{class:"option-title"},"合并模式"),(0,r.createElementVNode)("span",{class:"option-desc"},"将导入的预设添加到现有预设中（推荐）")],-1))]),(0,r.createElementVNode)("label",qt,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=e=>s.value=e),value:"replace",class:"radio-input"},null,512),[[r.vModelRadio,s.value]]),t[10]||(t[10]=(0,r.createElementVNode)("span",{class:"option-text"},[(0,r.createElementVNode)("span",{class:"option-title"},"替换模式"),(0,r.createElementVNode)("span",{class:"option-desc warning"},"将清除所有现有预设，仅保留导入的预设")],-1))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 导入结果 "),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:2,class:(0,r.normalizeClass)(["import-result",d.value.type])},[(0,r.createElementVNode)("div",Gt,(0,r.toDisplayString)("success"===d.value.type?"✅":"warning"===d.value.type?"⚠️":"❌"),1),(0,r.createElementVNode)("div",Ht,[(0,r.createElementVNode)("p",Yt,(0,r.toDisplayString)(d.value.message),1),d.value.details?((0,r.openBlock)(),(0,r.createElementBlock)("div",Wt,[d.value.details.success>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",Xt," 成功导入: "+(0,r.toDisplayString)(d.value.details.success)+" 个 ",1)):(0,r.createCommentVNode)("v-if",!0),d.value.details.failed>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",Jt," 导入失败: "+(0,r.toDisplayString)(d.value.details.failed)+" 个 ",1)):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0)])],2)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" Footer "),(0,r.createElementVNode)("div",Kt,[(0,r.createElementVNode)("button",{class:"btn btn-cancel",onClick:f},(0,r.toDisplayString)(d.value?"关闭":"取消"),1),d.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"btn btn-confirm",onClick:v,disabled:!i.value||l.value},[l.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Qt,"⏳ 导入中...")):((0,r.openBlock)(),(0,r.createElementBlock)("span",en,"📤 开始导入"))],8,Zt))])])])):(0,r.createCommentVNode)("v-if",!0);var n}}});var nn=n(9531),an={};an.styleTagTransform=k(),an.setAttributes=v(),an.insert=h().bind(null,"head"),an.domAPI=p(),an.insertStyleElement=y(),u()(nn.A,an),nn.A&&nn.A.locals&&nn.A.locals;const rn=(0,N.A)(tn,[["__scopeId","data-v-3fadd167"]]),on={class:"modal-container"},sn={class:"modal-header"},ln={class:"title-section"},cn={key:0,class:"preset-count"},dn={class:"header-actions"},un={class:"modal-content"},mn={key:0,class:"loading-state"},pn={key:1,class:"empty-state"},gn={key:2,class:"presets-list"},hn=["onClick"],fn={class:"preset-header"},vn={class:"preset-name"},bn={class:"preset-actions"},yn={class:"preset-date"},xn=["onClick"],kn={key:0,class:"preset-description"},wn={key:1,class:"preset-info"},En={key:0,class:"info-tag name-tag"},Nn={key:1,class:"info-tag age-tag"},Sn={key:2,class:"info-tag"},Vn={key:3,class:"info-tag"},_n={key:4,class:"info-tag"},Cn={key:5,class:"info-tag"},An={class:"modal-footer"},Dn=["disabled"],Tn={key:0},Bn={key:1},In=(0,r.defineComponent)({__name:"PresetLoadModal",props:{visible:{type:Boolean}},emits:["close","select"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)([]),i=(0,r.ref)(null),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)(!1);async function u(){s.value=!0;try{console.log("[预设加载对话框] 开始加载预设列表");const e=await(0,Xe.Vd)();o.value=e,console.log("[预设加载对话框] 成功加载",o.value.length,"个预设",o.value)}catch(e){console.error("[预设加载对话框] 加载预设列表失败:",e),X.o.error("加载预设列表失败"),o.value=[]}finally{s.value=!1}}function m(e){const t=new Date(e),n=(new Date).getTime()-t.getTime(),a=Math.floor(n/864e5);return 0===a?"今天":1===a?"昨天":a<7?`${a}天前`:t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function p(){l.value||a("close")}function g(){i.value&&!l.value&&(l.value=!0,setTimeout(()=>{i.value&&a("select",i.value),l.value=!1},300))}function h(){console.log("[预设加载对话框] 预设已导出"),u()}async function f(e){console.log("[预设加载对话框] 预设导入完成:",e),await u()}return(0,r.watch)(()=>n.visible,async e=>{e&&(i.value=null,await u())}),(e,t)=>e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(p,["self"])},[(0,r.createElementVNode)("div",on,[(0,r.createCommentVNode)(" Header "),(0,r.createElementVNode)("div",sn,[(0,r.createElementVNode)("div",ln,[t[4]||(t[4]=(0,r.createElementVNode)("h2",{class:"modal-title"},"📂 加载预设",-1)),!s.value&&o.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",cn,(0,r.toDisplayString)(o.value.length)+" 个",1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",dn,[(0,r.createElementVNode)("button",{class:"btn-action import",onClick:t[0]||(t[0]=e=>d.value=!0)},t[5]||(t[5]=[(0,r.createElementVNode)("span",{class:"btn-icon"},"📥",-1),(0,r.createElementVNode)("span",{class:"btn-text"},"导入",-1)])),(0,r.createElementVNode)("button",{class:"btn-action export",onClick:t[1]||(t[1]=e=>c.value=!0)},t[6]||(t[6]=[(0,r.createElementVNode)("span",{class:"btn-icon"},"📤",-1),(0,r.createElementVNode)("span",{class:"btn-text"},"导出",-1)])),(0,r.createElementVNode)("button",{class:"modal-close",onClick:p},"×")])]),(0,r.createCommentVNode)(" Content "),(0,r.createElementVNode)("div",un,[s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",mn,t[7]||(t[7]=[(0,r.createElementVNode)("div",{class:"spinner"},null,-1),(0,r.createElementVNode)("p",null,"正在加载预设列表...",-1)]))):0===o.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",pn,t[8]||(t[8]=[(0,r.createElementVNode)("div",{class:"empty-icon"},"📭",-1),(0,r.createElementVNode)("p",null,"暂无保存的预设",-1),(0,r.createElementVNode)("p",{class:"empty-hint"},"完成角色创建后,可以保存为预设以便快速开始新游戏",-1)]))):((0,r.openBlock)(),(0,r.createElementBlock)("div",gn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:(0,r.normalizeClass)(["preset-item",{selected:i.value?.id===e.id}]),onClick:t=>i.value=e},[(0,r.createElementVNode)("div",fn,[(0,r.createElementVNode)("h3",vn,(0,r.toDisplayString)(e.name||"未命名预设"),1),(0,r.createElementVNode)("div",bn,[(0,r.createElementVNode)("span",yn,(0,r.toDisplayString)(m(e.savedAt)),1),(0,r.createElementVNode)("button",{class:"btn-delete",onClick:(0,r.withModifiers)(t=>async function(e){if(window.confirm("确定要删除这个预设吗？此操作不可撤销。"))try{await(0,Xe.BC)(e),X.o.success("预设已删除"),await u(),i.value?.id===e&&(i.value=null)}catch(e){console.error("[预设加载对话框] 删除预设失败:",e),X.o.error("删除预设失败")}}(e.id),["stop"])},"×",8,xn)])]),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("p",kn,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0),e.data?((0,r.openBlock)(),(0,r.createElementBlock)("div",wn,[e.data.character_name?((0,r.openBlock)(),(0,r.createElementBlock)("span",En,(0,r.toDisplayString)(e.data.character_name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.current_age?((0,r.openBlock)(),(0,r.createElementBlock)("span",Nn,(0,r.toDisplayString)(e.data.current_age)+"岁",1)):(0,r.createCommentVNode)("v-if",!0),e.data.world?((0,r.openBlock)(),(0,r.createElementBlock)("span",Sn,(0,r.toDisplayString)(e.data.world.name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.talentTier?((0,r.openBlock)(),(0,r.createElementBlock)("span",Vn,(0,r.toDisplayString)(e.data.talentTier.name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.origin?((0,r.openBlock)(),(0,r.createElementBlock)("span",_n,(0,r.toDisplayString)(e.data.origin.name),1)):(0,r.createCommentVNode)("v-if",!0),e.data.spiritRoot?((0,r.openBlock)(),(0,r.createElementBlock)("span",Cn,(0,r.toDisplayString)(e.data.spiritRoot.name),1)):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0)],10,hn))),128))]))]),(0,r.createCommentVNode)(" Footer "),(0,r.createElementVNode)("div",An,[(0,r.createElementVNode)("button",{class:"btn btn-cancel",onClick:p},"取消"),(0,r.createElementVNode)("button",{class:"btn btn-confirm",onClick:g,disabled:!i.value||l.value},[l.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Tn,"⏳ 加载中...")):((0,r.openBlock)(),(0,r.createElementBlock)("span",Bn,"✨ 加载预设"))],8,Dn)])]),(0,r.createCommentVNode)(" 导出预设对话框 "),(0,r.createVNode)(Mt,{visible:c.value,onClose:t[2]||(t[2]=e=>c.value=!1),onExported:h},null,8,["visible"]),(0,r.createCommentVNode)(" 导入预设对话框 "),(0,r.createVNode)(rn,{visible:d.value,onClose:t[3]||(t[3]=e=>d.value=!1),onImported:f},null,8,["visible"])])):(0,r.createCommentVNode)("v-if",!0)}});var zn=n(8139),Mn={};Mn.styleTagTransform=k(),Mn.setAttributes=v(),Mn.insert=h().bind(null,"head"),Mn.domAPI=p(),Mn.insertStyleElement=y(),u()(zn.A,Mn),zn.A&&zn.A.locals&&zn.A.locals;const Pn=(0,N.A)(In,[["__scopeId","data-v-a2b6e2a4"]]),Rn=["disabled","title"],$n={key:0,class:"sync-icon"},On={key:1,class:"sync-icon"},Ln={key:2,class:"sync-icon"},Fn={class:"sync-text"},jn=(0,r.defineComponent)({__name:"LoadingPreSeting",props:{size:{},variant:{}},emits:["loadCompleted","loadStarted"],setup(e,{emit:t}){const n=t,a=(0,r.ref)(!1),o=(0,r.ref)(!1),i=(0,r.ref)(!1);function s(){a.value||o.value?o.value&&X.o.info("预设已加载，无需重复操作"):(i.value=!0,n("loadStarted"))}async function l(e){a.value=!0,i.value=!1;const t="load-preset-toast";X.o.loading("正在加载预设...",{id:t});try{console.log("[加载预设组件] 选中的预设:",e),await new Promise(e=>setTimeout(e,800)),X.o.success(`预设「${e.name}」加载成功！`,{id:t}),o.value=!0,n("loadCompleted",{success:!0,message:"加载成功",presetData:e})}catch(e){console.error("[加载预设组件] 加载失败:",e);const a=e instanceof Error?e.message:"加载失败";X.o.error(`加载失败: ${a}`,{id:t}),n("loadCompleted",{success:!1,message:a})}finally{a.value=!1}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("button",{onClick:s,class:(0,r.normalizeClass)(["cloud-sync-button",{synced:o.value}]),disabled:a.value,title:a.value?"正在加载预设...":o.value?"预设已加载":"加载预设"},[a.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",$n,"⏳")):o.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",On,"✅")):((0,r.openBlock)(),(0,r.createElementBlock)("span",Ln,"📂")),(0,r.createElementVNode)("span",Fn,(0,r.toDisplayString)(a.value?"加载中":o.value?"已加载":"加载预设"),1)],10,Rn),(0,r.createCommentVNode)(" 预设加载对话框 "),(0,r.createVNode)(Pn,{visible:i.value,onClose:t[0]||(t[0]=e=>i.value=!1),onSelect:l},null,8,["visible"])]))}});var Un=n(8233),qn={};qn.styleTagTransform=k(),qn.setAttributes=v(),qn.insert=h().bind(null,"head"),qn.domAPI=p(),qn.insertStyleElement=y(),u()(Un.A,qn),Un.A&&Un.A.locals&&Un.A.locals;const Gn=(0,N.A)(jn,[["__scopeId","data-v-1f7f5d72"]]);var Hn=n(4717),Yn=n(1783),Wn=n(9037);const Xn={class:"modal-dialog"},Jn={class:"modal-title"},Kn={class:"form-fields"},Zn=["for"],Qn=["id","onUpdate:modelValue","placeholder","type"],ea=["id","onUpdate:modelValue","placeholder"],ta=["id","onUpdate:modelValue"],na=["value"],aa={class:"dynamic-list-container"},ra={class:"list-header"},oa=["onClick"],ia={key:0,class:"list-items"},sa={class:"item-inputs"},la=["onUpdate:modelValue"],ca=["value"],da=["onUpdate:modelValue","placeholder"],ua=["onUpdate:modelValue","placeholder"],ma=["onUpdate:modelValue","placeholder"],pa=["onClick"],ga={key:1,class:"empty-list"},ha={key:0,class:"error-messages"},fa={class:"modal-actions"},va=(0,r.defineComponent)({__name:"CustomCreationModal",props:{visible:{type:Boolean},title:{},fields:{},validationFn:{type:Function},initialData:{}},emits:["close","submit"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)({}),i=(0,r.ref)([]),s=(0,r.computed)(()=>n.fields.filter(e=>!e.condition||e.condition(o.value)));function l(){a("close")}function c(){i.value=[];const e=n.validationFn(o.value);e.valid?(a("submit",{...o.value}),l()):i.value=e.errors}return(0,r.watch)(()=>[n.fields,n.initialData],([e,t])=>{const n={};e.forEach(e=>{const a=t?.[e.key];"select"===e.type?n[e.key]=a??e.options?.[0]?.value??"":"dynamic-list"===e.type?n[e.key]=Array.isArray(a)?JSON.parse(JSON.stringify(a)):[]:n[e.key]=a??""}),o.value=n},{immediate:!0,deep:!0}),(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Transition,{name:"modal-fade"},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(l,["self"])},[(0,r.createElementVNode)("div",Xn,[(0,r.createElementVNode)("h2",Jn,(0,r.toDisplayString)(e.title),1),(0,r.createElementVNode)("div",Kn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.key,class:"form-group"},[(0,r.createElementVNode)("label",{for:t.key},(0,r.toDisplayString)(t.label),9,Zn),"text"===t.type||"color"===t.type||"number"===t.type?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:0,id:t.key,"onUpdate:modelValue":e=>o.value[t.key]=e,placeholder:t.placeholder,type:t.type},null,8,Qn)),[[r.vModelDynamic,o.value[t.key]]]):"textarea"===t.type?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("textarea",{key:1,id:t.key,"onUpdate:modelValue":e=>o.value[t.key]=e,placeholder:t.placeholder,rows:"5"},null,8,ea)),[[r.vModelText,o.value[t.key]]]):"select"===t.type?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:2,id:t.key,"onUpdate:modelValue":e=>o.value[t.key]=e},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(t.options,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.value,value:e.value},(0,r.toDisplayString)(e.label),9,na))),128))],8,ta)),[[r.vModelSelect,o.value[t.key]]]):"dynamic-list"===t.type?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(" 动态列表字段 "),(0,r.createElementVNode)("div",aa,[(0,r.createElementVNode)("div",ra,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(t.label),1),(0,r.createElementVNode)("button",{onClick:e=>function(e){const t=o.value[e.key];Array.isArray(t)||(o.value[e.key]=[]);const n={};e.columns.forEach(e=>{"select"===e.type&&e.options?n[e.key]=e.options[0]?.value||"":n[e.key]=""}),o.value[e.key].push(n)}(t),class:"add-btn",type:"button"},"+ "+(0,r.toDisplayString)(e.$t("添加")),9,oa)]),Array.isArray(o.value[t.key])&&o.value[t.key].length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",ia,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value[t.key],(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"list-item"},[(0,r.createElementVNode)("div",sa,["select"===t.columns[0].type?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:0,"onUpdate:modelValue":n=>e[t.columns[0].key]=n,class:"item-input"},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(t.columns[0].options,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.value,value:e.value},(0,r.toDisplayString)(e.label),9,ca))),128))],8,la)),[[r.vModelSelect,e[t.columns[0].key]]]):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:1,"onUpdate:modelValue":n=>e[t.columns[0].key]=n,placeholder:t.columns[0].placeholder,class:"item-input"},null,8,da)),[[r.vModelText,e[t.columns[0].key]]]),t.columns[1]?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:2,"onUpdate:modelValue":n=>e[t.columns[1].key]=n,placeholder:t.columns[1].placeholder,class:"item-input"},null,8,ua)),[[r.vModelText,e[t.columns[1].key]]]):(0,r.createCommentVNode)("v-if",!0),t.columns[2]?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:3,"onUpdate:modelValue":n=>e[t.columns[2].key]=n,placeholder:t.columns[2].placeholder,class:"item-input",type:"number",step:"0.1"},null,8,ma)),[[r.vModelText,e[t.columns[2].key]]]):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("button",{onClick:e=>function(e,t){const n=o.value[e.key];Array.isArray(n)&&n.splice(t,1)}(t,n),class:"remove-btn",type:"button"},"×",8,pa)]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",ga,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("暂无数据")),1)]))])],2112)):(0,r.createCommentVNode)("v-if",!0)]))),128))]),i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",ha,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("p",{key:t},"* "+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",fa,[(0,r.createElementVNode)("button",{onClick:l,class:"btn btn-secondary"},(0,r.toDisplayString)(e.$t("关闭")),1),(0,r.createElementVNode)("button",{onClick:c,class:"btn"},(0,r.toDisplayString)(e.$t("确认")),1)])])])):(0,r.createCommentVNode)("v-if",!0)]),_:1}))}});var ba=n(5609),ya={};ya.styleTagTransform=k(),ya.setAttributes=v(),ya.insert=h().bind(null,"head"),ya.domAPI=p(),ya.insertStyleElement=y(),u()(ba.A,ya),ba.A&&ba.A.locals&&ba.A.locals;const xa=(0,N.A)(va,[["__scopeId","data-v-6ec25edf"]]),ka={class:"modal-content"},wa={class:"modal-header"},Ea={class:"modal-body"},Na={class:"hint"},Sa=["placeholder","onKeydown"],Va={class:"modal-footer"},_a=["disabled"],Ca=(0,r.defineComponent)({__name:"AIPromptModal",props:{visible:{type:Boolean}},emits:["close","submit"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)("");function i(){a("close")}function s(){const e=o.value.trim();e&&(a("submit",e),i())}return(0,r.watch)(()=>n.visible,e=>{e&&(o.value="")}),(e,t)=>e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(i,["self"])},[(0,r.createElementVNode)("div",ka,[(0,r.createElementVNode)("div",wa,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("AI帮你创建")),1),(0,r.createElementVNode)("button",{class:"close-btn",onClick:i},"×")]),(0,r.createElementVNode)("div",Ea,[(0,r.createElementVNode)("p",Na,(0,r.toDisplayString)(e.$t("请描述你想生成什么内容：")),1),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),class:"prompt-input",placeholder:e.$t("例如：生成一个火属性的天赋，适合剑修..."),rows:"6",onKeydown:(0,r.withKeys)((0,r.withModifiers)(s,["ctrl"]),["enter"])},null,40,Sa),[[r.vModelText,o.value]])]),(0,r.createElementVNode)("div",Va,[(0,r.createElementVNode)("button",{class:"cancel-btn",onClick:i},(0,r.toDisplayString)(e.$t("取消")),1),(0,r.createElementVNode)("button",{class:"submit-btn",onClick:s,disabled:!o.value.trim()},(0,r.toDisplayString)(e.$t("开始创建")),9,_a)])])])):(0,r.createCommentVNode)("v-if",!0)}});var Aa=n(2047),Da={};Da.styleTagTransform=k(),Da.setAttributes=v(),Da.insert=h().bind(null,"head"),Da.domAPI=p(),Da.insertStyleElement=y(),u()(Aa.A,Da),Aa.A&&Aa.A.locals&&Aa.A.locals;const Ta=(0,N.A)(Ca,[["__scopeId","data-v-e43e747c"]]);var Ba=n(236);const Ia='**立即执行任务，输出JSON格式的数据。禁止输出确认消息或纯文本！**\n\n你是专业的世界观内容生成器，根据用户提供的主题生成对应风格的内容。\n\n【世界观核心理念】\n- 修仙/超凡体系只是一个背景元素，不是唯一重点\n- 严格按照用户的选择和世界设定来生成内容\n- 如果用户指定了特定风格（科幻、现代、赛博朋克等），必须完全遵循该风格\n- 不要预设固定的修仙剧情方向，让用户自己决定故事走向\n\n【输出格式示例】\n```json\n{\n  "name": "示例名称",\n  "description": "示例描述",\n  "其他字段": "根据具体任务要求"\n}\n```\n\n【输出要求】\n1. 所有数值字段必须是数字类型（不要用字符串）\n2. 必须使用```json代码块包裹\n3. 不得添加任何额外的解释说明文字\n4. ❌ 禁止输出确认消息（如"法则已刻入天轨"、"明白了"、"收到"等）\n5. ❌ 禁止输出纯文本，必须是JSON格式\n',za=`${Ia}\n\n【任务】生成世界设定\n\n【字段】name(2-6字)/description(200-400字)/era(5-10字)\n`,Ma=`${Ia}\n\n【任务】生成天赋等级\n\n【必填字段】\n- name: 天赋名称\n- description: 描述文字（50-150字）\n- total_points: 总点数（数字类型，范围10-50）\n- rarity: 稀有度（数字类型，范围1-5）\n- color: 颜色（十六进制格式）\n`,Pa=`${Ia}\n\n【任务】生成出身背景\n\n【字段要求】\n- name (字符串): 4-6字的出身名称\n- description (字符串): 100-300字的背景故事\n- talent_cost (数字): 0-10之间的整数\n- rarity (数字): 1-5之间的整数\n- attribute_modifiers (对象): 先天六司加成，总和不超过5点\n- effects (数组): 1-2个独特效果的文字描述\n\n【输出示例】\n\`\`\`json\n{\n  "name": "山野遗孤",\n  "description": "自幼流落山野，与野兽为伴，练就了一身野性与求生本能...",\n  "talent_cost": 2,\n  "rarity": 3,\n  "attribute_modifiers": {\n    "根骨": 2,\n    "灵性": -1,\n    "悟性": 0,\n    "气运": 1,\n    "魅力": -1,\n    "心性": 1\n  },\n  "effects": ["野性直觉：在野外环境中感知力提升", "兽语通晓：能与灵兽沟通"]\n}\n\`\`\`\n`,Ra=`${Ia}\n\n【任务】生成核心天赋类型（如灵根、血统等）\n\n【字段要求】\n- name (字符串): 灵根名称，不含等级前缀\n- tier (字符串): 等级，可选值：凡品、下品、中品、上品、极品、神品\n- description (字符串): 50-200字的灵根描述\n- cultivation_speed (字符串): 修炼速度，格式为"数字x"\n- special_effects (数组): 1-3个特殊效果\n- base_multiplier (数字): 基础倍率，纯数字\n- talent_cost (数字): 3-30之间的整数\n- rarity (数字): 1-5之间的整数\n\n【输出示例】\n\`\`\`json\n{\n  "name": "雷灵根",\n  "tier": "上品",\n  "description": "天生雷属性灵根，修炼雷法事半功倍，雷霆之力刚猛霸道...",\n  "cultivation_speed": "1.8x",\n  "special_effects": ["雷法威力提升30%", "抗雷属性伤害", "修炼速度加快"],\n  "base_multiplier": 1.8,\n  "talent_cost": 15,\n  "rarity": 4\n}\n\`\`\`\n`,$a=`${Ia}\n\n【任务】生成先天天赋\n\n【字段要求】\n- name (字符串): 4-6字的天赋名称\n- description (字符串): 30-100字的天赋描述\n\n【输出示例】\n\`\`\`json\n{\n  "name": "过目不忘",\n  "description": "天生记忆力超群，看过的功法、阵法过目不忘，学习速度大幅提升"\n}\n\`\`\`\n`;var Oa=n(758);const La={class:"world-selection-container"},Fa={key:0,class:"loading-state"},ja={key:1,class:"error-state"},Ua={key:2,class:"world-layout"},qa={class:"left-panel"},Ga={class:"top-actions-container"},Ha={class:"action-name"},Ya={class:"action-name"},Wa={class:"list-container"},Xa={key:0,class:"no-worlds-message"},Ja={class:"no-worlds-text"},Ka={key:0,class:"no-worlds-hint"},Za=["onClick","onMouseover"],Qa={class:"item-content"},er={class:"item-name"},tr={key:0,class:"action-buttons"},nr=["onClick","title"],ar=["onClick","title"],rr={class:"details-container"},or={key:0,class:"world-details"},ir={class:"details-header"},sr={class:"details-title"},lr=["title"],cr={class:"btn-text"},dr={class:"era"},ur={class:"map-options"},mr={class:"map-options-header"},pr={class:"difficulty-section"},gr={class:"difficulty-label"},hr={class:"difficulty-options"},fr=["value"],vr={class:"difficulty-name"},br={class:"difficulty-desc"},yr={class:"continents-only-section"},xr={class:"continents-only-toggle"},kr={class:"toggle-label"},wr={class:"toggle-hint"},Er={key:0,class:"config-warning"},Nr={class:"warning-text"},Sr={class:"warning-title"},Vr={class:"warning-desc"},_r={class:"map-options-grid"},Cr={class:"option-item"},Ar={class:"option-label"},Dr=["disabled"],Tr={class:"config-hint"},Br={class:"option-item"},Ir={class:"option-label"},zr=["disabled"],Mr={class:"config-hint"},Pr={class:"option-item"},Rr={class:"option-label"},$r=["disabled"],Or={class:"config-hint"},Lr={class:"option-item"},Fr={class:"option-label"},jr=["title"],Ur={class:"config-hint"},qr={class:"map-options-actions"},Gr={class:"description-scroll"},Hr={key:1,class:"placeholder"},Yr=(0,r.defineComponent)({__name:"Step1_WorldSelection",emits:["ai-generate"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,r.ref)(null),i=(0,r.ref)(!1),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)(null),u=[{value:"简单",label:"简单",desc:"机缘频繁，敌人较弱"},{value:"普通",label:"普通",desc:"机缘与危险并存"},{value:"困难",label:"困难",desc:"机缘稀少，敌人较强"},{value:"噩梦",label:"噩梦",desc:"九死一生，举步维艰"}],m=(0,r.ref)((()=>{const e=a.worldGenerationConfig;return e&&e.majorFactionsCount?(console.log("[世界配置] 从store恢复已保存的配置:",e),{majorFactionsCount:e.majorFactionsCount,totalLocations:e.totalLocations,secretRealmsCount:e.secretRealmsCount,continentCount:e.continentCount,generateOnlyContinents:void 0===e.generateOnlyContinents||e.generateOnlyContinents}):(console.log("[世界配置] 使用默认配置"),{majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0})})());(0,r.watch)(m,e=>{a.setWorldGenerationConfig(e),console.log("[世界配置] 配置已更新并保存:",e)},{deep:!0});const p=(0,r.computed)(()=>{const e=a.creationData.worlds;if(console.log("【世界选择】所有世界数据:",e),console.log("【世界选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const t=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【世界选择】穿越异世界可用世界列表:",t),t}{const t=e.filter(e=>"cloud"===e.source);if(console.log("【世界选择】联机模式云端世界列表:",t),console.log("【世界选择】云端世界数量:",t.length),0===t.length){console.warn("【世界选择】警告：联机模式下没有云端世界数据，回退到本地数据！");const t=e.filter(e=>"local"===e.source);return console.log("【世界选择】回退使用本地世界:",t),t}return t}}),g=[{key:"name",label:"世界名称",type:"text",placeholder:"例如：九霄界"},{key:"era",label:"时代背景",type:"text",placeholder:"例如：仙道昌隆"},{key:"description",label:"世界描述",type:"textarea",placeholder:"描述这个世界的背景故事、修炼体系特点等..."}];function h(e){const t={};return e.name?.trim()||(t.name="世界名称不可为空"),{valid:0===Object.keys(t).length,errors:Object.values(t)}}async function f(e){const t={id:Date.now(),name:e.name,era:e.era,description:e.description,source:"local"};try{a.addWorld(t),y(t),i.value=!1,X.o.success(`自定义世界 "${t.name}" 已成功保存！`)}catch(e){console.error("保存自定义世界失败:",e),X.o.error("保存自定义世界失败！")}}function v(){a.isLocalCreation?c.value=!0:n("ai-generate")}async function b(e){const t="ai-generate-world";X.o.loading("世界推演中，请稍候...",{id:t});try{const n=await(0,Ba.e)(e,za,!1,"world_generation");if(!n)return void X.o.error("AI推演失败",{id:t});let r;console.log("【AI推演-世界】完整响应:",n);try{r=(0,Oa.p)(n)}catch(e){return console.error("【AI推演-世界】JSON解析失败:",e),void X.o.error("AI推演结果格式错误，无法解析",{id:t})}if(!r.name)return void X.o.error("AI推演结果缺少世界名称",{id:t});const o={id:Date.now(),name:r.name||r.名称||"未命名世界",era:r.era||r.时代背景||"",description:r.description||r.描述||r.世界描述||"",source:"local"};a.addWorld(o),y(o),c.value=!1,X.o.success(`AI推演完成！世界 "${o.name}" 已生成`,{id:t})}catch(e){console.error("【AI推演-世界】失败:",e),X.o.error(`AI推演失败: ${e.message}`,{id:t})}}function y(e){a.selectWorld(e.id),a.setWorldGenerationConfig(m.value)}function x(){const e=[3,4,5,6,7],t=[8,10,12,15,18],n=[3,4,5,6,8],r=[3,4,5,6];m.value={majorFactionsCount:e[Math.floor(Math.random()*e.length)],totalLocations:t[Math.floor(Math.random()*t.length)],secretRealmsCount:n[Math.floor(Math.random()*n.length)],continentCount:r[Math.floor(Math.random()*r.length)],generateOnlyContinents:m.value.generateOnlyContinents},a.setWorldGenerationConfig(m.value),X.o.info("已随机生成世界配置")}function k(){m.value={majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0},a.setWorldGenerationConfig(m.value),X.o.info("已重置为默认配置")}const w=(0,r.computed)(()=>m.value.majorFactionsCount>8||m.value.totalLocations>15||m.value.secretRealmsCount>10);async function E(e){if(!d.value)return;const t={name:e.name,era:e.era,description:e.description};try{a.updateWorld(d.value.id,t)?(l.value=!1,d.value=null,X.o.success(`世界 "${t.name}" 已更新！`)):X.o.error("更新世界失败！")}catch(e){console.error("更新世界失败:",e),X.o.error("更新世界失败！")}}const N=(0,r.computed)(()=>d.value?{name:d.value.name,era:d.value.era,description:d.value.description}:{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",La,[(0,r.unref)(a).isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",Fa,(0,r.toDisplayString)(e.$t("正在推演诸天万界...")),1)):(0,r.unref)(a).error?((0,r.openBlock)(),(0,r.createElementBlock)("div",ja,(0,r.toDisplayString)(e.$t("致命错误"))+"："+(0,r.toDisplayString)((0,r.unref)(a).error),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ua,[(0,r.createCommentVNode)(" 左侧面板：世界列表 "),(0,r.createElementVNode)("div",qa,[(0,r.createCommentVNode)(" 顶部功能按钮 "),(0,r.createElementVNode)("div",Ga,[(0,r.unref)(a).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:t[0]||(t[0]=e=>i.value=!0),class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",Ha,(0,r.toDisplayString)(e.$t("自定义世界")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:v,class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",Ya,(0,r.toDisplayString)(e.$t("AI帮你创建")),1)])]),(0,r.createElementVNode)("div",Wa,[0===p.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Xa,[t[11]||(t[11]=(0,r.createElementVNode)("div",{class:"no-worlds-icon"},"🌌",-1)),(0,r.createElementVNode)("div",Ja,(0,r.toDisplayString)((0,r.unref)(a).isLocalCreation?e.$t("暂无本地世界数据"):e.$t("暂无云端世界数据")),1),(0,r.unref)(a).isLocalCreation?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ka,(0,r.toDisplayString)(e.$t("请检查网络连接或联系管理员")),1))])):((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(p.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:(0,r.normalizeClass)(["list-item",{selected:(0,r.unref)(a).characterPayload.world_id===t.id}]),onClick:e=>y(t),onMouseover:e=>o.value=t},[(0,r.createElementVNode)("div",Qa,[(0,r.createElementVNode)("span",er,(0,r.toDisplayString)(t.name),1)]),"cloud"===t.source?((0,r.openBlock)(),(0,r.createElementBlock)("div",tr,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>function(e){d.value=e,l.value=!0}(t),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.createVNode)((0,r.unref)(Hn.A),{size:14})],8,nr),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>async function(e){try{await a.removeWorld(e),console.log(`【世界选择】成功删除世界 ID: ${e}`)}catch(t){console.error(`【世界选择】删除世界失败 ID: ${e}`,t)}}(t.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,ar)])):(0,r.createCommentVNode)("v-if",!0)],42,Za))),128))])]),(0,r.createCommentVNode)(" 右侧面板：世界详情 + 地图生成选项 "),(0,r.createElementVNode)("div",rr,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",or,[(0,r.createElementVNode)("div",ir,[(0,r.createElementVNode)("h2",sr,(0,r.toDisplayString)(o.value.name),1),(0,r.createElementVNode)("button",{class:"map-settings-btn",onClick:t[1]||(t[1]=e=>s.value=!s.value),title:e.$t("地图生成选项")},[(0,r.createVNode)((0,r.unref)(Wn.A),{size:16}),(0,r.createElementVNode)("span",cr,(0,r.toDisplayString)(e.$t("设置")),1)],8,lr)]),(0,r.createElementVNode)("p",dr,"【"+(0,r.toDisplayString)(o.value.era||e.$t("时代未知"))+"】",1),(0,r.createCommentVNode)(" 地图生成选项（移入右侧详情内，避免整体高度溢出） "),(0,r.withDirectives)((0,r.createElementVNode)("div",ur,[(0,r.createElementVNode)("div",mr,(0,r.toDisplayString)(e.$t("世界规模配置")),1),(0,r.createCommentVNode)(" 游戏难度选择 "),(0,r.createElementVNode)("div",pr,[(0,r.createElementVNode)("div",gr,(0,r.toDisplayString)(e.$t("游戏难度")),1),(0,r.createElementVNode)("div",hr,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u,e=>(0,r.createElementVNode)("label",{key:e.value,class:(0,r.normalizeClass)(["difficulty-option",{selected:(0,r.unref)(a).gameDifficulty===e.value}])},[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",value:e.value,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,r.unref)(a).gameDifficulty=e),class:"difficulty-radio"},null,8,fr),[[r.vModelRadio,(0,r.unref)(a).gameDifficulty]]),(0,r.createElementVNode)("span",vr,(0,r.toDisplayString)(e.label),1),(0,r.createElementVNode)("span",br,(0,r.toDisplayString)(e.desc),1)],2)),64))])]),(0,r.createCommentVNode)(" 仅生成大陆开关 "),(0,r.createElementVNode)("div",yr,[(0,r.createElementVNode)("label",xr,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>m.value.generateOnlyContinents=e),class:"toggle-checkbox"},null,512),[[r.vModelCheckbox,m.value.generateOnlyContinents]]),(0,r.createElementVNode)("span",kr,(0,r.toDisplayString)(e.$t("仅生成大陆（开局优化）")),1)]),(0,r.createElementVNode)("div",wr,(0,r.toDisplayString)(m.value.generateOnlyContinents?e.$t("开局只生成大陆，势力和地点可在游戏中动态生成，减少token消耗"):e.$t("开局生成完整世界（包括势力、地点和秘境）")),1)]),(0,r.createCommentVNode)(" 配置警告提示 "),w.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Er,[t[12]||(t[12]=(0,r.createElementVNode)("div",{class:"warning-icon"},"⚠️",-1)),(0,r.createElementVNode)("div",Nr,[(0,r.createElementVNode)("div",Sr,(0,r.toDisplayString)(e.$t("配置过高警告")),1),(0,r.createElementVNode)("div",Vr,(0,r.toDisplayString)(e.$t("当前配置可能导致生成失败，建议调整至合理范围")),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 核心游戏配置 "),(0,r.createElementVNode)("div",_r,[(0,r.createElementVNode)("label",Cr,[(0,r.createElementVNode)("span",Ar,(0,r.toDisplayString)(e.$t("主要势力")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",min:"1",max:"20",step:"1","onUpdate:modelValue":t[4]||(t[4]=e=>m.value.majorFactionsCount=e),class:(0,r.normalizeClass)({"config-risky":m.value.majorFactionsCount>8}),disabled:m.value.generateOnlyContinents},null,10,Dr),[[r.vModelText,m.value.majorFactionsCount,void 0,{number:!0}]]),(0,r.createElementVNode)("span",Tr,(0,r.toDisplayString)(e.$t("推荐: 3-8")),1)]),(0,r.createElementVNode)("label",Br,[(0,r.createElementVNode)("span",Ir,(0,r.toDisplayString)(e.$t("地点总数")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",min:"5",max:"100",step:"1","onUpdate:modelValue":t[5]||(t[5]=e=>m.value.totalLocations=e),class:(0,r.normalizeClass)({"config-risky":m.value.totalLocations>15}),disabled:m.value.generateOnlyContinents},null,10,zr),[[r.vModelText,m.value.totalLocations,void 0,{number:!0}]]),(0,r.createElementVNode)("span",Mr,(0,r.toDisplayString)(e.$t("推荐: 8-15")),1)]),(0,r.createElementVNode)("label",Pr,[(0,r.createElementVNode)("span",Rr,(0,r.toDisplayString)(e.$t("秘境数量")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",min:"0",max:"30",step:"1","onUpdate:modelValue":t[6]||(t[6]=e=>m.value.secretRealmsCount=e),class:(0,r.normalizeClass)({"config-risky":m.value.secretRealmsCount>10}),disabled:m.value.generateOnlyContinents},null,10,$r),[[r.vModelText,m.value.secretRealmsCount,void 0,{number:!0}]]),(0,r.createElementVNode)("span",Or,(0,r.toDisplayString)(e.$t("推荐: 3-10")),1)]),(0,r.createElementVNode)("label",Lr,[(0,r.createElementVNode)("span",Fr,(0,r.toDisplayString)(e.$t("大陆数量")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",min:"3",max:"7",step:"1","onUpdate:modelValue":t[7]||(t[7]=e=>m.value.continentCount=e),title:e.$t("大陆数量决定世界的宏观格局，3-7片大陆形成不同的地缘政治结构")},null,8,jr),[[r.vModelText,m.value.continentCount,void 0,{number:!0}]]),(0,r.createElementVNode)("span",Ur,(0,r.toDisplayString)(e.$t("范围: 3-7")),1)])]),(0,r.createElementVNode)("div",qr,[(0,r.createElementVNode)("button",{class:"opt-btn",onClick:x},(0,r.toDisplayString)(e.$t("随机")),1),(0,r.createElementVNode)("button",{class:"opt-btn",onClick:k},(0,r.toDisplayString)(e.$t("重置")),1)])],512),[[r.vShow,s.value]]),(0,r.withDirectives)((0,r.createElementVNode)("div",Gr,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(o.value.description||e.$t("此界一片混沌，尚无描述。")),1)],512),[[r.vShow,!s.value]])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Hr,(0,r.toDisplayString)(e.$t("请择一个世界，以开启你的故事。")),1))])])),(0,r.createVNode)(xa,{visible:i.value,title:e.$t("自定义世界"),fields:g,validationFn:h,onClose:t[8]||(t[8]=e=>i.value=!1),onSubmit:f},null,8,["visible","title"]),(0,r.createCommentVNode)(" 编辑模态框 "),(0,r.createVNode)(xa,{visible:l.value,title:e.$t("编辑世界"),fields:g,validationFn:h,initialData:N.value,onClose:t[9]||(t[9]=e=>{l.value=!1,d.value=null}),onSubmit:E},null,8,["visible","title","initialData"]),(0,r.createCommentVNode)(" AI推演输入弹窗 "),(0,r.createVNode)(Ta,{visible:c.value,onClose:t[10]||(t[10]=e=>c.value=!1),onSubmit:b},null,8,["visible"])]))}});var Wr=n(6591),Xr={};Xr.styleTagTransform=k(),Xr.setAttributes=v(),Xr.insert=h().bind(null,"head"),Xr.domAPI=p(),Xr.insertStyleElement=y(),u()(Wr.A,Xr),Wr.A&&Wr.A.locals&&Wr.A.locals;const Jr=(0,N.A)(Yr,[["__scopeId","data-v-802455fa"]]),Kr={class:"talent-tier-selection"},Zr={key:0,class:"loading-state"},Qr={key:1,class:"error-state"},eo={key:2,class:"tier-layout"},to={class:"tier-left-panel"},no={class:"top-actions-container"},ao={class:"action-name"},ro={class:"action-name"},oo={class:"tiers-list-container"},io=["onClick","onMouseover"],so={class:"item-content"},lo={class:"tier-name"},co={class:"tier-points"},uo={key:0,class:"action-buttons"},mo=["onClick","title"],po=["onClick","title"],go={class:"tier-details-container"},ho={key:0,class:"tier-details"},fo={class:"description-scroll"},vo={class:"points-display"},bo={key:1,class:"placeholder"},yo=(0,r.defineComponent)({__name:"Step2_TalentTierSelection",emits:["ai-generate"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,r.ref)(null),i=(0,r.ref)(!1),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(null),d=(0,r.computed)(()=>{const e=a.creationData.talentTiers;if(console.log("【天资选择】所有天资数据:",e),console.log("【天资选择】当前模式:",a.isLocalCreation?"本地":"联机"),console.log("【天资选择】数据明细:",e.map(e=>({name:e.name,source:e.source,id:e.id}))),a.isLocalCreation){const t=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【天资选择】穿越异世界可用天资列表:",t),t.sort((e,t)=>e.total_points-t.total_points)}{const t=e.length>0?e:[];return console.log("【天资选择】联机模式天资列表:",t),console.log("【天资选择】联机模式天资数量:",t.length),0===t.length&&console.warn("【天资选择】警告：联机模式下没有找到任何天资数据！"),t.sort((e,t)=>e.total_points-t.total_points)}}),u=[{key:"name",label:"人设名称",type:"text",placeholder:"例如：凡人"},{key:"description",label:"人设描述",type:"textarea",placeholder:"描述此人设的特点..."},{key:"total_points",label:"技能点",type:"number",placeholder:"例如：20"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"color",label:"辉光颜色",type:"color",placeholder:"例如：#808080"}];function m(e){const t={};e.name?.trim()||(t.name="天资名称不可为空");const n=Number(e.total_points);(isNaN(n)||n<0)&&(t.total_points="技能点必须是非负数");const a=Number(e.rarity);return(isNaN(a)||a<1||a>10)&&(t.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(t).length,errors:Object.values(t)}}async function p(e){const t={id:Date.now(),name:e.name,description:e.description,total_points:parseInt(e.total_points,10)||10,rarity:parseInt(e.rarity,10)||1,color:e.color||"#808080"};try{a.addTalentTier(t),f(t),i.value=!1,X.o.success(`自定义人设 "${t.name}" 已保存！`)}catch(e){console.error("保存自定义人设失败:",e),X.o.error("保存自定义人设失败！")}}function g(){a.isLocalCreation?l.value=!0:n("ai-generate")}async function h(e){const t="ai-generate-talent-tier";X.o.loading("世界推演中，请稍候...",{id:t});try{const n=await(0,Ba.e)(e,Ma,!1);if(!n)return void X.o.error("AI推演失败",{id:t});let r;console.log("【AI推演-天资】完整响应:",n);try{r=(0,Oa.p)(n)}catch(e){return console.error("【AI推演-天资】JSON解析失败:",e),void X.o.error("AI推演结果格式错误，无法解析",{id:t})}if(!r.name&&!r.名称)return void X.o.error("AI推演结果缺少天资名称",{id:t});const o={id:Date.now(),name:r.name||r.名称||"未命名天资",description:r.description||r.描述||r.说明||"",total_points:r.total_points||r.总点数||r.点数||10,color:r.color||r.颜色||"#808080",rarity:r.rarity||r.稀有度||1,source:"local"};a.addTalentTier(o),f(o),l.value=!1,X.o.success(`AI推演完成！天资 "${o.name}" 已生成`,{id:t})}catch(e){console.error("【AI推演-天资】失败:",e),X.o.error(`AI推演失败: ${e.message}`,{id:t})}}function f(e){a.selectTalentTier(e.id)}function v(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:"229, 192, 123"}async function b(e){if(!c.value)return;const t={name:e.name,description:e.description,total_points:parseInt(e.total_points,10)||10,rarity:parseInt(e.rarity,10)||1,color:e.color||"#808080"};try{a.updateTalentTier(c.value.id,t)?(s.value=!1,c.value=null,X.o.success(`天资 "${t.name}" 已更新！`)):X.o.error("更新天资失败！")}catch(e){console.error("更新天资失败:",e),X.o.error("更新天资失败！")}}const y=(0,r.computed)(()=>c.value?{name:c.value.name,description:c.value.description,total_points:c.value.total_points.toString(),rarity:c.value.rarity?.toString()||"1",color:c.value.color}:{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Kr,[(0,r.unref)(a).isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",Zr,(0,r.toDisplayString)(e.$t("感应天道，测算天资...")),1)):(0,r.unref)(a).error?((0,r.openBlock)(),(0,r.createElementBlock)("div",Qr,(0,r.toDisplayString)(e.$t("天机混沌"))+"："+(0,r.toDisplayString)((0,r.unref)(a).error),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",eo,[(0,r.createCommentVNode)(" 左侧面板：列表和操作按钮 "),(0,r.createElementVNode)("div",to,[(0,r.createCommentVNode)(" 顶部功能按钮 "),(0,r.createElementVNode)("div",no,[(0,r.unref)(a).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:t[0]||(t[0]=e=>i.value=!0),class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ao,(0,r.toDisplayString)(e.$t("自定义人设")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:g,class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ro,(0,r.toDisplayString)(e.$t("AI帮你创建")),1)])]),(0,r.createElementVNode)("div",oo,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:(0,r.normalizeClass)(["tier-item",{selected:(0,r.unref)(a).characterPayload.talent_tier_id===t.id}]),style:(0,r.normalizeStyle)({"--tier-glow-color":t.color,"--tier-glow-color-rgb":v(t.color)}),onClick:e=>f(t),onMouseover:e=>o.value=t},[(0,r.createElementVNode)("div",so,[(0,r.createElementVNode)("span",lo,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)("span",co,(0,r.toDisplayString)(t.total_points)+" "+(0,r.toDisplayString)(e.$t("点")),1)]),"cloud"===t.source?((0,r.openBlock)(),(0,r.createElementBlock)("div",uo,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>function(e){c.value=e,s.value=!0}(t),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.createVNode)((0,r.unref)(Hn.A),{size:14})],8,mo),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>async function(e){console.log(`🔥 点击删除按钮，准备删除天资 ID: ${e}`);try{await a.removeTalentTier(e),console.log(`【天资选择】成功删除天资 ID: ${e}`)}catch(t){console.error(`【天资选择】删除天资失败 ID: ${e}`,t)}}(t.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,po)])):(0,r.createCommentVNode)("v-if",!0)],46,io))),128))])]),(0,r.createCommentVNode)(" 右侧详情 "),(0,r.createElementVNode)("div",go,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ho,[(0,r.createElementVNode)("h2",{style:(0,r.normalizeStyle)({color:o.value.color})},(0,r.toDisplayString)(o.value.name),5),(0,r.createElementVNode)("div",fo,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(o.value.description),1)]),(0,r.createElementVNode)("div",vo,(0,r.toDisplayString)(e.$t("技能点"))+": "+(0,r.toDisplayString)(o.value.total_points),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",bo,(0,r.toDisplayString)(e.$t("请选择你的人设等级，这将决定你的起点。")),1))])])),(0,r.createVNode)(xa,{visible:i.value,title:e.$t("自定义人设"),fields:u,validationFn:m,onClose:t[1]||(t[1]=e=>i.value=!1),onSubmit:p},null,8,["visible","title"]),(0,r.createCommentVNode)(" 编辑模态框 "),(0,r.createVNode)(xa,{visible:s.value,title:e.$t("编辑人设"),fields:u,validationFn:m,initialData:y.value,onClose:t[2]||(t[2]=e=>{s.value=!1,c.value=null}),onSubmit:b},null,8,["visible","title","initialData"]),(0,r.createCommentVNode)(" AI推演输入弹窗 "),(0,r.createVNode)(Ta,{visible:l.value,onClose:t[3]||(t[3]=e=>l.value=!1),onSubmit:h},null,8,["visible"])]))}});var xo=n(6491),ko={};ko.styleTagTransform=k(),ko.setAttributes=v(),ko.insert=h().bind(null,"head"),ko.domAPI=p(),ko.insertStyleElement=y(),u()(xo.A,ko),xo.A&&xo.A.locals&&xo.A.locals;const wo=(0,N.A)(yo,[["__scopeId","data-v-075e4a68"]]),Eo={class:"origin-selection-container"},No={key:0,class:"loading-state"},So={key:1,class:"error-state"},Vo={key:2,class:"origin-layout"},_o={class:"origin-left-panel"},Co={class:"top-actions-container"},Ao={class:"action-name"},Do={class:"action-name"},To={class:"origin-list-container"},Bo={class:"origin-name"},Io={class:"origin-cost"},zo=["onClick","onMouseover"],Mo={class:"item-content"},Po={class:"origin-name"},Ro={class:"origin-cost"},$o={key:0,class:"action-buttons"},Oo=["onClick","title"],Lo=["onClick","title"],Fo={class:"origin-details-container"},jo={key:0,class:"origin-details"},Uo={class:"description-scroll"},qo={class:"cost-display"},Go={key:1,class:"placeholder"},Ho=(0,r.defineComponent)({__name:"Step3_OriginSelection",emits:["ai-generate"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,r.ref)(null),i=(0,r.ref)(!1),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(null),d=(0,r.computed)(()=>{const e=a.creationData.origins;if(console.log("【出身选择】所有出身数据:",e),console.log("【出身选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const t=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【出身选择】穿越异世界可用出身列表:",t),t}{const t=e.filter(e=>"cloud"===e.source);return console.log("【出身选择】联机模式出身列表:",t),console.log("【出身选择】云端出身数量:",t.length),0===t.length&&(console.warn("【出身选择】警告：联机模式下没有找到云端出身数据！"),console.log("【出身选择】所有出身的source分布:",e.reduce((e,t)=>(e[t.source]=(e[t.source]||0)+1,e),{}))),t}}),u=[{key:"name",label:"出身名称",type:"text",placeholder:"例如：山野遗孤"},{key:"description",label:"出身描述",type:"textarea",placeholder:"描述此出身的背景故事和成长经历..."},{key:"talent_cost",label:"技能点消耗",type:"number",placeholder:"选择此出身需要消耗的技能点，可为负数表示奖励"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"attribute_modifiers",label:"属性修正",type:"dynamic-list",columns:[{key:"attribute",placeholder:"属性名称",type:"select",options:[{value:"根骨",label:"根骨"},{value:"灵性",label:"灵性"},{value:"悟性",label:"悟性"},{value:"气运",label:"气运"},{value:"魅力",label:"魅力"},{value:"心性",label:"心性"}]},{key:"value",placeholder:"修正值（可为负数）",type:"text"}]},{key:"background_effects",label:"背景效果",type:"dynamic-list",columns:[{key:"type",placeholder:"效果类型（如：技能、资源、关系）"},{key:"description",placeholder:"效果描述"}]}];function m(e){const t={};e.name?.trim()||(t.name="出身名称不可为空"),e.description?.trim()||(t.description="出身描述不可为空");const n=Number(e.talent_cost);void 0!==e.talent_cost&&""!==e.talent_cost&&isNaN(n)&&(t.talent_cost="技能点消耗必须是数字");const a=Number(e.rarity);return void 0!==e.rarity&&""!==e.rarity&&(isNaN(a)||a<1||a>10)&&(t.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(t).length,errors:Object.values(t)}}async function p(e){const t={};Array.isArray(e.attribute_modifiers)&&e.attribute_modifiers.forEach(e=>{e.attribute&&e.value&&(t[e.attribute]=Number(e.value)||0)});const n=Array.isArray(e.background_effects)?e.background_effects.filter(e=>e.type&&e.description):[],r={id:Date.now(),name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,attribute_modifiers:t,background_effects:n,rarity:Number(e.rarity)||1,source:"local"};try{a.addOrigin(r),y(r),i.value=!1,X.o.success(`自定义出身 "${r.name}" 已保存！`)}catch(e){console.error("保存自定义出身失败:",e),X.o.error("保存自定义出身失败！")}}function g(){if(a.isLocalCreation){if(!a.selectedWorld)return void X.o.error("请先选择一方大千世界，方可推演出身。");l.value=!0}else n("ai-generate")}async function h(e){const t="ai-generate-origin";X.o.loading("世界推演中，请稍候...",{id:t});try{const n=await(0,Ba.e)(e,Pa,!1);if(!n)return void X.o.error("AI推演失败",{id:t});let r;console.log("【AI推演-出身】完整响应:",n);try{r=(0,Oa.p)(n)}catch(e){return console.error("【AI推演-出身】JSON解析失败:",e),void X.o.error("AI推演结果格式错误，无法解析",{id:t})}if(!r.name&&!r.名称)return void X.o.error("AI推演结果缺少出身名称",{id:t});let o=r.talent_cost||r.技能点消耗||r.消耗技能点;null==o?(console.warn("【AI推演-出身】AI未返回技能点消耗字段，使用默认值3"),X.o.warning("AI未设置技能点消耗，已自动设为3点",{id:t,duration:2e3}),o=3):(o=Number(o),isNaN(o)&&(console.warn("【AI推演-出身】技能点消耗不是有效数字，使用默认值3"),o=3));const i={id:Date.now(),name:r.name||r.名称||"未命名出身",description:r.description||r.描述||r.说明||"",talent_cost:o,attribute_modifiers:r.attribute_modifiers||r.属性修正||{},background_effects:r.background_effects||r.背景效果||[],rarity:r.rarity||r.稀有度||1,source:"local"};a.addOrigin(i),y(i),l.value=!1,X.o.success(`AI推演完成！出身 "${i.name}" 已生成`,{id:t})}catch(e){console.error("【AI推演-出身】失败:",e),X.o.error(`AI推演失败: ${e.message}`,{id:t})}}const f=e=>{if(a.characterPayload.origin_id===e.id)return!0;const t=a.selectedOrigin?.talent_cost??0;return a.remainingTalentPoints+t>=e.talent_cost};async function v(e){if(!c.value)return;const t={};Array.isArray(e.attribute_modifiers)&&e.attribute_modifiers.forEach(e=>{e.attribute&&e.value&&(t[e.attribute]=Number(e.value)||0)});const n=Array.isArray(e.background_effects)?e.background_effects.filter(e=>e.type&&e.description):[],r={name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,attribute_modifiers:t,background_effects:n};try{a.updateOrigin(c.value.id,r)?(s.value=!1,c.value=null,X.o.success(`出身 "${r.name}" 已更新！`)):X.o.error("更新出身失败！")}catch(e){console.error("更新出身失败:",e),X.o.error("更新出身失败！")}}const b=(0,r.computed)(()=>{if(!c.value)return{};const e=c.value.attribute_modifiers?Object.entries(c.value.attribute_modifiers).map(([e,t])=>({attribute:e,value:String(t)})):[];return{name:c.value.name,description:c.value.description,talent_cost:c.value.talent_cost.toString(),rarity:c.value.rarity.toString(),attribute_modifiers:e,background_effects:c.value.background_effects||[]}});function y(e){if(!f(e))return void X.o.warning("技能点不足，无法选择此出身。");const t=a.characterPayload.origin_id===e.id?null:e.id;a.selectOrigin(t)}function x(){a.selectOrigin(null)}const k=(0,r.computed)(()=>null===a.characterPayload.origin_id),w=((0,r.computed)(()=>k.value?"随机出身":a.selectedOrigin?.name||""),(0,r.computed)(()=>k.value?"天道无常，造化弄人。选择此项，你的出身将完全随机生成。是生于帝王之家，或为山野遗孤，皆在天道一念之间。":a.selectedOrigin?.description||"身世如谜，过往一片空白。"),(0,r.computed)(()=>k.value?0:a.selectedOrigin?.talent_cost||0),(0,r.computed)(()=>"random"===o.value?"随机出身":o.value&&"object"==typeof o.value?o.value.name:"")),E=(0,r.computed)(()=>"random"===o.value?"天道无常，造化弄人。选择此项，你的出身将完全随机生成。是生于帝王之家，或为山野遗孤，皆在天道一念之间。":o.value&&"object"==typeof o.value&&o.value.description||"身世如谜，过往一片空白。"),N=(0,r.computed)(()=>"random"===o.value?0:o.value&&"object"==typeof o.value&&o.value.talent_cost||0);return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Eo,[(0,r.unref)(a).isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",No,(0,r.toDisplayString)(e.$t("追溯过往，探寻出身...")),1)):(0,r.unref)(a).error?((0,r.openBlock)(),(0,r.createElementBlock)("div",So,(0,r.toDisplayString)(e.$t("因果不明"))+"："+(0,r.toDisplayString)((0,r.unref)(a).error),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Vo,[(0,r.createCommentVNode)(" 左侧栏：列表和操作按钮 "),(0,r.createElementVNode)("div",_o,[(0,r.createCommentVNode)(" 顶部功能按钮 "),(0,r.createElementVNode)("div",Co,[(0,r.unref)(a).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:t[0]||(t[0]=e=>i.value=!0),class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",Ao,(0,r.toDisplayString)(e.$t("自定义出身")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:g,class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",Do,(0,r.toDisplayString)(e.$t("AI帮你创建")),1)])]),(0,r.createElementVNode)("div",To,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["origin-item",{selected:k.value}]),onClick:x,onMouseover:t[1]||(t[1]=e=>o.value="random")},[(0,r.createElementVNode)("span",Bo,(0,r.toDisplayString)(e.$t("随机出身")),1),(0,r.createElementVNode)("span",Io,(0,r.toDisplayString)(e.$t("0 点")),1)],34),t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"divider"},null,-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:(0,r.normalizeClass)(["origin-item",{selected:(0,r.unref)(a).characterPayload.origin_id===t.id,disabled:!f(t)}]),onClick:e=>y(t),onMouseover:e=>o.value=t},[(0,r.createElementVNode)("div",Mo,[(0,r.createElementVNode)("span",Po,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)("span",Ro,(0,r.toDisplayString)(t.talent_cost)+" "+(0,r.toDisplayString)(e.$t("点")),1)]),"cloud"===t.source?((0,r.openBlock)(),(0,r.createElementBlock)("div",$o,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>function(e){c.value=e,s.value=!0}(t),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.createVNode)((0,r.unref)(Hn.A),{size:14})],8,Oo),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>async function(e){try{await a.removeOrigin(e),console.log(`【出身选择】成功删除出身 ID: ${e}`)}catch(t){console.error(`【出身选择】删除出身失败 ID: ${e}`,t)}}(t.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,Lo)])):(0,r.createCommentVNode)("v-if",!0)],42,zo))),128))])]),(0,r.createCommentVNode)(" 右侧详情 "),(0,r.createElementVNode)("div",Fo,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",jo,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(w.value),1),(0,r.createElementVNode)("div",Uo,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(E.value),1)]),(0,r.createElementVNode)("div",qo,(0,r.toDisplayString)(e.$t("消耗技能点: {0}").replace("{0}",String(N.value))),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Go,(0,r.toDisplayString)(e.$t("请选择一处出身，或随机选择。")),1))])])),(0,r.createVNode)(xa,{visible:i.value,title:e.$t("自定义出身"),fields:u,validationFn:m,onClose:t[2]||(t[2]=e=>i.value=!1),onSubmit:p},null,8,["visible","title"]),(0,r.createCommentVNode)(" 编辑模态框 "),(0,r.createVNode)(xa,{visible:s.value,title:e.$t("编辑出身"),fields:u,validationFn:m,initialData:b.value,onClose:t[3]||(t[3]=e=>{s.value=!1,c.value=null}),onSubmit:v},null,8,["visible","title","initialData"]),(0,r.createCommentVNode)(" AI推演输入弹窗 "),(0,r.createVNode)(Ta,{visible:l.value,onClose:t[4]||(t[4]=e=>l.value=!1),onSubmit:h},null,8,["visible"])]))}});var Yo=n(8951),Wo={};Wo.styleTagTransform=k(),Wo.setAttributes=v(),Wo.insert=h().bind(null,"head"),Wo.domAPI=p(),Wo.insertStyleElement=y(),u()(Yo.A,Wo),Yo.A&&Yo.A.locals&&Yo.A.locals;const Xo=(0,N.A)(Ho,[["__scopeId","data-v-3d363671"]]),Jo={class:"spirit-root-selection-container"},Ko={key:0,class:"loading-state"},Zo={key:1,class:"error-state"},Qo={key:2,class:"spirit-root-layout"},ei={class:"spirit-root-left-panel"},ti={class:"top-actions-container"},ni={class:"action-name"},ai={class:"action-name"},ri={class:"selection-mode-tabs"},oi={key:0,class:"preset-mode"},ii={class:"spirit-root-list-container"},si={class:"spirit-root-name"},li={class:"spirit-root-cost"},ci=["onClick","onMouseover"],di={class:"item-content"},ui={class:"spirit-root-name-container"},mi={class:"spirit-root-name"},pi={class:"spirit-root-cost"},gi={key:0,class:"action-buttons"},hi=["onClick"],fi=["onClick"],vi={key:1,class:"custom-mode"},bi={class:"custom-selection-container"},yi={class:"selection-group"},xi={class:"selection-label"},ki={class:"spirit-type-grid"},wi=["onClick"],Ei={class:"type-icon"},Ni={class:"type-name"},Si={class:"selection-group"},Vi={class:"selection-label"},_i={class:"tier-selection"},Ci=["onClick"],Ai={class:"tier-name"},Di={class:"tier-multiplier"},Ti={class:"tier-cost"},Bi={class:"custom-preview"},Ii={class:"preview-title"},zi={class:"preview-content"},Mi={class:"preview-name"},Pi={class:"preview-stats"},Ri={class:"stat"},$i={class:"stat"},Oi=["disabled"],Li={class:"spirit-root-details-container"},Fi={key:0,class:"spirit-root-details"},ji={class:"description-scroll"},Ui={class:"stats-display"},qi={class:"stat-item"},Gi={class:"stat-label"},Hi={class:"stat-value"},Yi={class:"stat-item"},Wi={class:"stat-label"},Xi={class:"stat-value"},Ji={key:1,class:"placeholder"},Ki=(0,r.defineComponent)({__name:"Step4_SpiritRootSelection",emits:["ai-generate"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,r.ref)(null),i=(0,r.ref)("preset"),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)(null),u=(0,r.reactive)({type:"none",tier:"none"}),m=[{key:"fire",name:"火",icon:"🔥",color:"#ef4444",desc:"烈火焚天，爆发力强"},{key:"water",name:"水",icon:"💧",color:"#3b82f6",desc:"水流不息，绵延悠长"},{key:"wood",name:"木",icon:"🌿",color:"#10b981",desc:"生机盎然，治愈修复"},{key:"metal",name:"金",icon:"⚔️",color:"#f59e0b",desc:"锋锐无匹，切金断玉"},{key:"earth",name:"土",icon:"🗿",color:"#8b5cf6",desc:"厚德载物，防御超群"},{key:"wind",name:"风",icon:"💨",color:"#06b6d4",desc:"风驰电掣，身法如神"},{key:"thunder",name:"雷",icon:"⚡",color:"#eab308",desc:"雷霆万钧，毁天灭地"},{key:"ice",name:"冰",icon:"❄️",color:"#0ea5e9",desc:"冰霜刺骨，万物凋零"},{key:"light",name:"光",icon:"☀️",color:"#f97316",desc:"光明普照，净化邪恶"},{key:"dark",name:"暗",icon:"🌑",color:"#6b7280",desc:"幽暗深邃，诡异莫测"},{key:"space",name:"空间",icon:"🌀",color:"#7c3aed",desc:"虚空挪移，空间掌控"},{key:"time",name:"时间",icon:"⏰",color:"#ec4899",desc:"时光流转，逆转乾坤"}],p=[{key:"common",name:"凡品",multiplier:1,cost:0,desc:"平平无奇的普通灵根"},{key:"low",name:"下品",multiplier:1.1,cost:3,desc:"略有天赋，勉强可用"},{key:"middle",name:"中品",multiplier:1.3,cost:6,desc:"资质尚可，小有成就"},{key:"high",name:"上品",multiplier:1.6,cost:10,desc:"天赋卓越，前途无量"},{key:"supreme",name:"极品",multiplier:2,cost:15,desc:"万中无一，天之骄子"},{key:"heaven",name:"仙品",multiplier:2.4,cost:20,desc:"天降异象，举世罕见"},{key:"divine",name:"神品",multiplier:2.8,cost:25,desc:"神鬼莫测，逆天改命"},{key:"special",name:"特殊",multiplier:0,cost:0,desc:"特殊体质，另有奥妙"}],g=(0,r.computed)(()=>a.isLocalCreation?a.creationData.spiritRoots.filter(e=>"local"===e.source||"cloud"===e.source):a.creationData.spiritRoots.filter(e=>"cloud"===e.source)),h=[{key:"name",label:"灵根名称",type:"text",placeholder:"例如：混沌灵根"},{key:"tier",label:"品级",type:"select",options:p.map(e=>({value:e.key,label:e.name}))},{key:"description",label:"灵根描述",type:"textarea",placeholder:"描述这个灵根的特性和背景故事..."},{key:"cultivation_speed",label:"修炼速度",type:"text",placeholder:"例如：极快、快速、普通、缓慢"},{key:"base_multiplier",label:"修炼倍率",type:"number",placeholder:"例如：1.5"},{key:"talent_cost",label:"消耗技能点",type:"number",placeholder:"例如：10"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"special_effects",label:"特殊效果",type:"dynamic-list",columns:[{key:"effect",placeholder:"效果描述，如：雷系法术威力+80%"}]}],f=(0,r.computed)(()=>null===a.characterPayload.spirit_root_id),v=(0,r.computed)(()=>"random"===o.value?"随机灵根":o.value&&"object"==typeof o.value?o.value.name:""),b=(0,r.computed)(()=>"random"===o.value?"大道五十，天衍四九，人遁其一。选择此项，你的灵根将完全随机生成，可能一步登天，亦可能平庸无奇。":o.value&&"object"==typeof o.value&&o.value.description||"灵根信息不明。"),y=(0,r.computed)(()=>"random"===o.value?0:o.value&&"object"==typeof o.value&&o.value.talent_cost||0),x=e=>{if(a.characterPayload.spirit_root_id===e.id)return!0;const t=a.selectedSpiritRoot?.talent_cost??0;return a.remainingTalentPoints+t>=e.talent_cost};function k(e){if(!x(e))return void X.o.warning("技能点不足，无法选择此灵根。");const t=a.characterPayload.spirit_root_id===e.id?null:e.id;a.selectSpiritRoot(t)}function w(){a.selectSpiritRoot(null)}function E(){a.isLocalCreation?c.value=!0:n("ai-generate")}async function N(e){const t="ai-generate-spirit-root";X.o.loading("世界推演中，请稍候...",{id:t});try{const n=await(0,Ba.e)(e,Ra,!1);if(!n)return void X.o.error("AI推演失败",{id:t});let r;console.log("【AI推演-灵根】完整响应:",n);try{r=(0,Oa.p)(n)}catch(e){return console.error("【AI推演-灵根】JSON解析失败:",e),void X.o.error("AI推演结果格式错误，无法解析",{id:t})}if(!r.name&&!r.名称)return void X.o.error("AI推演结果缺少灵根名称",{id:t});const o={id:Date.now(),name:String(r.name||r["名称"]||"未命名灵根"),tier:String(r.tier||r["品级"]||r["等级"]||""),description:String(r.description||r["描述"]||r["说明"]||""),base_multiplier:Number(r.base_multiplier||r["修炼倍率"])||1,talent_cost:Number(r.talent_cost||r["技能点消耗"]||r["点数消耗"])||5,rarity:Number(r.rarity||r["稀有度"])||3,source:"local"};a.addSpiritRoot(o),k(o),c.value=!1,X.o.success(`AI推演完成！灵根 "${o.name}" 已生成`,{id:t})}catch(e){console.error("【AI推演-灵根】失败:",e);const n=e instanceof Error?e.message:"未知错误";X.o.error(`AI推演失败: ${n}`,{id:t})}}function S(e){return e.tier||""}function V(){if("none"===u.type)return"请选择灵根类型";const e=m.find(e=>e.key===u.type);return e?`${e.name}灵根`:"未知灵根"}function _(){if("none"===u.tier)return 1;const e=p.find(e=>e.key===u.tier);return e?e.multiplier:1}function C(){if("none"===u.tier)return 0;const e=p.find(e=>e.key===u.tier);return e?e.cost:0}function A(e){const t=p.find(t=>t.key===e);return t?t.name:""}function D(){return"none"!==u.type&&"none"!==u.tier}function T(){if(!D())return void X.o.warning("请完整选择灵根类型和品级");const e=m.find(e=>e.key===u.type),t=p.find(e=>e.key===u.tier);if(!e||!t)return void X.o.error("选择的灵根配置无效");const n={id:Date.now(),name:`${e.name}灵根`,description:`${t.desc}的${e.desc}`,base_multiplier:t.multiplier,talent_cost:t.cost,tier:t.name,source:"cloud"};a.addSpiritRoot(n),k(n),X.o.success(`自定义灵根 "${n.name}" 已创建！`),u.type="none",u.tier="none"}function B(){if("custom"===i.value&&"none"!==u.type){const e=m.find(e=>e.key===u.type),t=p.find(e=>e.key===u.tier);return e&&t&&"none"!==u.tier?`${t.desc}的${e.desc}`:e?e.desc:"请选择灵根品级"}return b.value}function I(e){return function(e){const t={};e.name?.trim()||(t.name="灵根名称不可为空"),e.tier||(t.tier="请选择品级"),e.description?.trim()||(t.description="灵根描述不可为空");const n=Number(e.base_multiplier);void 0!==e.base_multiplier&&""!==e.base_multiplier&&isNaN(n)&&(t.base_multiplier="修炼倍率必须为数字");const a=Number(e.talent_cost);void 0!==e.talent_cost&&""!==e.talent_cost&&isNaN(a)&&(t.talent_cost="消耗点数必须为数字");const r=Number(e.rarity);return void 0!==e.rarity&&""!==e.rarity&&(isNaN(r)||r<1||r>10)&&(t.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(t).length,errors:Object.values(t)}}(e)}function z(e){!async function(e){const t=e.special_effects?.length?e.special_effects.filter(e=>e.effect?.trim()).map(e=>e.effect.trim()):[],n={id:Date.now(),name:e.name,tier:p.find(t=>t.key===e.tier)?.name||e.tier,description:e.description,cultivation_speed:e.cultivation_speed||"普通",special_effects:t,base_multiplier:Number(e.base_multiplier)||1,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,source:"cloud"};try{a.addSpiritRoot(n),k(n),s.value=!1,X.o.success(`自定义灵根 "${n.name}" 已保存！`)}catch(e){console.error("保存自定义灵根失败:",e),X.o.error("保存自定义灵根失败！")}}(e)}async function M(e){if(!d.value)return;const t=e.special_effects?.length?e.special_effects.filter(e=>e.effect?.trim()).map(e=>e.effect.trim()):[],n={name:e.name,tier:p.find(t=>t.key===e.tier)?.name||e.tier,description:e.description,cultivation_speed:`${e.base_multiplier}x`,special_effects:t,base_multiplier:parseFloat(String(e.base_multiplier))||1,talent_cost:parseInt(String(e.talent_cost),10)||0};try{a.updateSpiritRoot(d.value.id,n)?(l.value=!1,d.value=null,X.o.success(`灵根 "${n.name}" 已更新！`)):X.o.error("更新灵根失败！")}catch(e){console.error("更新灵根失败:",e),X.o.error("更新灵根失败！")}}const P=(0,r.computed)(()=>d.value?{name:d.value.name,tier:p.find(e=>e.name===d.value.tier)?.key||"common",description:d.value.description,base_multiplier:d.value.base_multiplier?.toString()||"1.0",talent_cost:d.value.talent_cost.toString(),special_effects:d.value.special_effects?.map(e=>({effect:e}))||[]}:{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Jo,[(0,r.unref)(a).isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ko,(0,r.toDisplayString)(e.$t("天地玄黄，探查灵根...")),1)):(0,r.unref)(a).error?((0,r.openBlock)(),(0,r.createElementBlock)("div",Zo,(0,r.toDisplayString)(e.$t("天机混沌："))+(0,r.toDisplayString)((0,r.unref)(a).error),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Qo,[(0,r.createCommentVNode)(" 左侧面板：选择和操作 "),(0,r.createElementVNode)("div",ei,[(0,r.createCommentVNode)(" 顶部功能按钮 "),(0,r.createElementVNode)("div",ti,[(0,r.unref)(a).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:t[0]||(t[0]=e=>s.value=!0),class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ni,(0,r.toDisplayString)(e.$t("高级自定义")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:E,class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ai,(0,r.toDisplayString)(e.$t("AI帮你创建")),1)])]),(0,r.createCommentVNode)(" 选择模式切换 "),(0,r.createElementVNode)("div",ri,[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)([{active:"preset"===i.value},"mode-tab"]),onClick:t[1]||(t[1]=e=>i.value="preset")},(0,r.toDisplayString)(e.$t("预设灵根")),3),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)([{active:"custom"===i.value},"mode-tab"]),onClick:t[2]||(t[2]=e=>i.value="custom")},(0,r.toDisplayString)(e.$t("组合选择")),3)]),(0,r.createCommentVNode)(" 预设灵根模式 "),"preset"===i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",oi,[(0,r.createElementVNode)("div",ii,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["spirit-root-item",{selected:f.value}]),onClick:w,onMouseover:t[3]||(t[3]=e=>o.value="random")},[(0,r.createElementVNode)("span",si,(0,r.toDisplayString)(e.$t("随机灵根")),1),(0,r.createElementVNode)("span",li,(0,r.toDisplayString)(e.$t("0 点")),1)],34),t[7]||(t[7]=(0,r.createElementVNode)("div",{class:"divider"},null,-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:(0,r.normalizeClass)(["spirit-root-item",{selected:(0,r.unref)(a).characterPayload.spirit_root_id===t.id,disabled:!x(t)}]),onClick:e=>k(t),onMouseover:e=>o.value=t},[(0,r.createElementVNode)("div",di,[(0,r.createElementVNode)("div",ui,[(0,r.createElementVNode)("span",mi,(0,r.toDisplayString)(t.name),1),S(t)?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["spirit-root-tier",`tier-${S(t)}`])},(0,r.toDisplayString)(S(t)),3)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("span",pi,(0,r.toDisplayString)(t.talent_cost)+" "+(0,r.toDisplayString)(e.$t("点")),1)]),"cloud"===t.source?((0,r.openBlock)(),(0,r.createElementBlock)("div",gi,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>function(e){d.value=e,l.value=!0}(t),["stop"]),class:"edit-btn",title:"编辑此项"},[(0,r.createVNode)((0,r.unref)(Hn.A),{size:14})],8,hi),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>async function(e){try{await a.removeSpiritRoot(e),console.log(`【灵根选择】成功删除灵根 ID: ${e}`)}catch(t){console.error(`【灵根选择】删除灵根失败 ID: ${e}`,t)}}(t.id),["stop"]),class:"delete-btn",title:"删除此项"},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,fi)])):(0,r.createCommentVNode)("v-if",!0)],42,ci))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 组合选择模式 "),"custom"===i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",vi,[(0,r.createElementVNode)("div",bi,[(0,r.createCommentVNode)(" 灵根类型选择 "),(0,r.createElementVNode)("div",yi,[(0,r.createElementVNode)("label",xi,(0,r.toDisplayString)(e.$t("灵根类型")),1),(0,r.createElementVNode)("div",ki,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m,e=>(0,r.createElementVNode)("button",{key:e.key,class:(0,r.normalizeClass)([{selected:u.type===e.key},"type-button"]),onClick:t=>u.type=e.key,style:(0,r.normalizeStyle)({"--element-color":e.color})},[(0,r.createElementVNode)("span",Ei,(0,r.toDisplayString)(e.icon),1),(0,r.createElementVNode)("span",Ni,(0,r.toDisplayString)(e.name),1)],14,wi)),64))])]),(0,r.createCommentVNode)(" 品级选择 "),(0,r.createElementVNode)("div",Si,[(0,r.createElementVNode)("label",Vi,(0,r.toDisplayString)(e.$t("灵根品级")),1),(0,r.createElementVNode)("div",_i,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(p,e=>(0,r.createElementVNode)("button",{key:e.key,class:(0,r.normalizeClass)(["tier-button",`tier-${e.key}`,{selected:u.tier===e.key}]),onClick:t=>u.tier=e.key},[(0,r.createElementVNode)("span",Ai,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",Di,(0,r.toDisplayString)(e.multiplier)+"x",1),(0,r.createElementVNode)("span",Ti,(0,r.toDisplayString)(e.cost)+"点",1)],10,Ci)),64))])]),(0,r.createCommentVNode)(" 预览和确认 "),(0,r.createElementVNode)("div",Bi,[(0,r.createElementVNode)("div",Ii,(0,r.toDisplayString)(e.$t("预览")),1),(0,r.createElementVNode)("div",zi,[(0,r.createElementVNode)("div",Mi,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(V()),1),"none"!==u.tier?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["preview-tier",`tier-${u.tier}`])},(0,r.toDisplayString)(A(u.tier)),3)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",Pi,[(0,r.createElementVNode)("div",Ri,(0,r.toDisplayString)(e.$t("修炼倍率:"))+" "+(0,r.toDisplayString)(_())+"x",1),(0,r.createElementVNode)("div",$i,(0,r.toDisplayString)(e.$t("消耗点数:"))+" "+(0,r.toDisplayString)(C())+(0,r.toDisplayString)(e.$t("点")),1)])]),(0,r.createElementVNode)("button",{onClick:T,disabled:!D(),class:"confirm-custom-button"},(0,r.toDisplayString)(e.$t("确认选择")),9,Oi)])])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 右侧详情 "),(0,r.createElementVNode)("div",Li,[o.value||"custom"===i.value&&"none"!==u.type?((0,r.openBlock)(),(0,r.createElementBlock)("div",Fi,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)("custom"===i.value&&"none"!==u.type?V():v.value),1),(0,r.createElementVNode)("div",ji,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(B()),1)]),(0,r.createElementVNode)("div",Ui,[(0,r.createElementVNode)("div",qi,[(0,r.createElementVNode)("span",Gi,(0,r.toDisplayString)(e.$t("修炼倍率:")),1),(0,r.createElementVNode)("span",Hi,(0,r.toDisplayString)("custom"===i.value&&"none"!==u.type?_().toString():"random"===o.value?"随机":o.value&&"object"==typeof o.value?(o.value.base_multiplier||1).toString():"1.0")+"x",1)]),(0,r.createElementVNode)("div",Yi,[(0,r.createElementVNode)("span",Wi,(0,r.toDisplayString)(e.$t("消耗技能点:")),1),(0,r.createElementVNode)("span",Xi,(0,r.toDisplayString)("custom"===i.value&&"none"!==u.type?C().toString():y.value.toString())+(0,r.toDisplayString)(e.$t("点")),1)])])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ji,(0,r.toDisplayString)(e.$t("请选择一种灵根，或随机选择。")),1))])])),(0,r.createCommentVNode)(" 高级自定义模态框 "),(0,r.createVNode)(xa,{visible:s.value,title:e.$t("高级自定义灵根"),fields:h,validationFn:I,onClose:t[4]||(t[4]=e=>s.value=!1),onSubmit:z},null,8,["visible","title"]),(0,r.createCommentVNode)(" 编辑模态框 "),(0,r.createVNode)(xa,{visible:l.value,title:e.$t("编辑灵根"),fields:h,validationFn:I,initialData:P.value,onClose:t[5]||(t[5]=e=>{l.value=!1,d.value=null}),onSubmit:M},null,8,["visible","title","initialData"]),(0,r.createCommentVNode)(" AI推演输入弹窗 "),(0,r.createVNode)(Ta,{visible:c.value,onClose:t[6]||(t[6]=e=>c.value=!1),onSubmit:N},null,8,["visible"])]))}});var Zi=n(274),Qi={};Qi.styleTagTransform=k(),Qi.setAttributes=v(),Qi.insert=h().bind(null,"head"),Qi.domAPI=p(),Qi.insertStyleElement=y(),u()(Zi.A,Qi),Zi.A&&Zi.A.locals&&Zi.A.locals;const es=(0,N.A)(Ki,[["__scopeId","data-v-5fa92edb"]]),ts={class:"talent-selection-container"},ns={key:0,class:"loading-state"},as={key:1,class:"error-state"},rs={key:2,class:"talent-layout"},os={class:"talent-left-panel"},is={class:"top-actions-container"},ss={class:"action-name"},ls={class:"action-name"},cs={class:"talent-list-container"},ds=["onClick","onMouseover"],us={class:"item-content"},ms={class:"talent-name"},ps={class:"talent-cost"},gs={key:0,class:"action-buttons"},hs=["onClick","title"],fs=["onClick","title"],vs={class:"talent-details-container"},bs={key:0,class:"talent-details"},ys={class:"description-scroll"},xs={key:1,class:"placeholder"},ks=(0,r.defineComponent)({__name:"Step5_TalentSelection",emits:["ai-generate"],setup(e,{emit:t}){const n=t,a=(0,J.N)(),o=(0,r.ref)(null),i=(0,r.ref)(!1),s=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(null),d=(0,r.computed)(()=>{const e=a.creationData.talents;if(console.log("【天赋选择】所有天赋数据:",e.length,"个"),console.log("【天赋选择】当前模式:",a.isLocalCreation?"本地":"联机"),a.isLocalCreation){const t=e.filter(e=>"local"===e.source||"cloud"===e.source);return console.log("【天赋选择】穿越异世界可用天赋数量:",t.length),t}{const t=e.length>0?e:[];return console.log("【天赋选择】联机模式天赋数量:",t.length),0===t.length&&console.warn("【天赋选择】警告：联机模式下没有找到任何天赋数据！"),t}}),u=[{key:"name",label:"天赋名称",type:"text",placeholder:"例如：道心天成"},{key:"description",label:"天赋描述",type:"textarea",placeholder:"描述此天赋的本质..."},{key:"talent_cost",label:"技能点消耗",type:"number",placeholder:"例如：3"},{key:"rarity",label:"稀有度",type:"number",placeholder:"1-10，数值越高越稀有"},{key:"effects",label:"天赋效果",type:"dynamic-list",columns:[{key:"类型",placeholder:"效果类型",type:"select",options:[{value:"属性加成",label:"属性加成"},{value:"技能解锁",label:"技能解锁"},{value:"特殊能力",label:"特殊能力"},{value:"修炼加成",label:"修炼加成"}]},{key:"目标",placeholder:"目标（如：根骨、悟性）"},{key:"数值",placeholder:"数值（如：+2、+10%）"}]}];function m(e){const t={};e.name?.trim()||(t.name="天赋名称不可为空"),e.description?.trim()||(t.description="天赋描述不可为空");const n=Number(e.talent_cost);void 0===e.talent_cost||null===e.talent_cost||""===e.talent_cost||isNaN(n)?t.talent_cost="技能点消耗必须填写":n<0&&(t.talent_cost="技能点消耗不能为负数");const a=Number(e.rarity);return void 0!==e.rarity&&""!==e.rarity&&(isNaN(a)||a<1||a>10)&&(t.rarity="稀有度必须在1-10之间"),{valid:0===Object.keys(t).length,errors:Object.values(t)}}async function p(e){const t=Array.isArray(e.effects)?e.effects.filter(e=>e.类型&&e.数值).map(e=>({类型:e.类型,目标:e.目标||void 0,数值:Number(e.数值)||0})):[],n={id:Date.now(),name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,effects:t.length>0?t:void 0,source:"local"};try{a.addTalent(n),i.value=!1,X.o.success(`自定义天赋 "${n.name}" 已保存！`)}catch(e){console.error("保存自定义天赋失败:",e),X.o.error("保存自定义天赋失败！")}}const g=e=>a.characterPayload.selected_talent_ids.includes(e.id);function h(e){o.value=e,a.toggleTalent(e.id)}function f(){a.isLocalCreation?l.value=!0:n("ai-generate")}async function v(e){const t="ai-generate-talent";X.o.loading("世界推演中，请稍候...",{id:t});try{const n=await(0,Ba.e)(e,$a,!1);if(!n)return void X.o.error("AI推演失败",{id:t});let r;console.log("【AI推演-天赋】完整响应:",n);try{r=(0,Oa.p)(n)}catch(e){return console.error("【AI推演-天赋】JSON解析失败:",e),void X.o.error("AI推演结果格式错误，无法解析",{id:t})}if(!r.name&&!r.名称)return void X.o.error("AI推演结果缺少天赋名称",{id:t});const o={id:Date.now(),name:r.name||r.名称||"未命名天赋",description:r.description||r.描述||r.说明||"",talent_cost:r.talent_cost||r.点数消耗||1,rarity:r.rarity||r.稀有度||1,source:"local"};a.addTalent(o),h(o),l.value=!1,X.o.success(`AI推演完成！天赋 "${o.name}" 已生成`,{id:t})}catch(e){console.error("【AI推演-天赋】失败:",e),X.o.error(`AI推演失败: ${e.message}`,{id:t})}}async function b(e){if(!c.value)return;const t=Array.isArray(e.effects)?e.effects.filter(e=>e.类型&&e.数值).map(e=>({类型:e.类型,目标:e.目标||void 0,数值:Number(e.数值)||0})):[],n={name:e.name,description:e.description,talent_cost:Number(e.talent_cost)||0,rarity:Number(e.rarity)||1,effects:t.length>0?t:void 0};try{a.updateTalent(c.value.id,n)?(s.value=!1,c.value=null,X.o.success(`天赋 "${n.name}" 已更新！`)):X.o.error("更新天赋失败！")}catch(e){console.error("更新天赋失败:",e),X.o.error("更新天赋失败！")}}const y=(0,r.computed)(()=>c.value?{name:c.value.name,description:c.value.description,talent_cost:c.value.talent_cost||0,rarity:c.value.rarity||1,effects:c.value.effects||[]}:{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",ts,[(0,r.unref)(a).isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",ns,(0,r.toDisplayString)(e.$t("于时光长河中搜寻天赋...")),1)):(0,r.unref)(a).error?((0,r.openBlock)(),(0,r.createElementBlock)("div",as,(0,r.toDisplayString)(e.$t("致命错误"))+"："+(0,r.toDisplayString)((0,r.unref)(a).error),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",rs,[(0,r.createCommentVNode)(" 左侧面板：列表和操作按钮 "),(0,r.createElementVNode)("div",os,[(0,r.createCommentVNode)(" 顶部功能按钮 "),(0,r.createElementVNode)("div",is,[(0,r.unref)(a).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:t[0]||(t[0]=e=>i.value=!0),class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ss,(0,r.toDisplayString)(e.$t("自定义天赋")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:f,class:"action-item shimmer-on-hover"},[(0,r.createElementVNode)("span",ls,(0,r.toDisplayString)(e.$t("AI帮你创建")),1)])]),(0,r.createElementVNode)("div",cs,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:(0,r.normalizeClass)(["talent-item",{selected:g(t)}]),onClick:e=>h(t),onMouseover:e=>o.value=t},[(0,r.createElementVNode)("div",us,[(0,r.createElementVNode)("span",ms,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)("span",ps,(0,r.toDisplayString)(t.talent_cost||0)+(0,r.toDisplayString)(e.$t("点")),1)]),"cloud"===t.source||"local"===t.source?((0,r.openBlock)(),(0,r.createElementBlock)("div",gs,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>function(e){c.value=e,s.value=!0}(t),["stop"]),class:"edit-btn",title:e.$t("编辑此项")},[(0,r.createVNode)((0,r.unref)(Hn.A),{size:14})],8,hs),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>async function(e){try{await a.removeTalent(e),console.log(`【天赋选择】成功删除天赋 ID: ${e}`)}catch(t){console.error(`【天赋选择】删除天赋失败 ID: ${e}`,t)}}(t.id),["stop"]),class:"delete-btn",title:e.$t("删除此项")},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,fs)])):(0,r.createCommentVNode)("v-if",!0)],42,ds))),128))])]),(0,r.createElementVNode)("div",vs,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",bs,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(o.value.name),1),(0,r.createElementVNode)("div",ys,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(o.value.description||e.$t("此天赋之玄妙，需自行领悟。")),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",xs,(0,r.toDisplayString)(e.$t("请选择天赋。")),1))])])),(0,r.createVNode)(xa,{visible:i.value,title:e.$t("自定义天赋"),fields:u,validationFn:m,onClose:t[1]||(t[1]=e=>i.value=!1),onSubmit:p},null,8,["visible","title"]),(0,r.createCommentVNode)(" 编辑模态框 "),(0,r.createVNode)(xa,{visible:s.value,title:e.$t("编辑天赋"),fields:u,validationFn:m,initialData:y.value,onClose:t[2]||(t[2]=e=>{s.value=!1,c.value=null}),onSubmit:b},null,8,["visible","title","initialData"]),(0,r.createCommentVNode)(" AI推演输入弹窗 "),(0,r.createVNode)(Ta,{visible:l.value,onClose:t[3]||(t[3]=e=>l.value=!1),onSubmit:v},null,8,["visible"])]))}});var ws=n(3147),Es={};Es.styleTagTransform=k(),Es.setAttributes=v(),Es.insert=h().bind(null,"head"),Es.domAPI=p(),Es.insertStyleElement=y(),u()(ws.A,Es),ws.A&&ws.A.locals&&ws.A.locals;const Ns=(0,N.A)(ks,[["__scopeId","data-v-0d74e85b"]]),Ss={class:"attribute-allocation-container"},Vs={class:"header"},_s={class:"points-display"},Cs={class:"attributes-list"},As={class:"attribute-info"},Ds={class:"attribute-name"},Ts={class:"attribute-desc"},Bs={class:"attribute-controls"},Is=["onClick","disabled"],zs={class:"attribute-value"},Ms=["onClick","disabled"],Ps={class:"actions"},Rs=10,$s=(0,r.defineComponent)({__name:"Step6_AttributeAllocation",setup(e){const t=(0,J.N)(),n={root_bone:"根骨",spirituality:"灵性",comprehension:"悟性",fortune:"气运",charm:"魅力",temperament:"心性"},a={root_bone:"决定气血上限、恢复速度、寿命上限。影响炼体修行、抗打击能力。",spirituality:"决定灵气上限、吸收效率。影响修炼速度、法术威力。",comprehension:"决定神识上限、学习效率。影响功法领悟、技能掌握速度。",fortune:"决定各种概率、物品掉落品质。影响天材地宝获取、贵人相助。",charm:"决定初始好感度、社交加成。影响NPC互动、门派声望获取。",temperament:"决定心魔抗性、意志力。影响走火入魔抵抗、关键抉择。"};function o(){Object.keys(t.attributes).forEach(e=>{t.setAttribute(e,0)})}function i(){o();let e=t.remainingTalentPoints;const n=Object.keys(t.attributes);for(;e>0;){const a=n[Math.floor(Math.random()*n.length)],r=t.attributes[a];if(r<Rs&&(t.setAttribute(a,r+1),e--),n.every(e=>t.attributes[e]>=Rs))break}}function s(){o();const e=Math.max(0,t.remainingTalentPoints);if(e<=0)return;const n=Object.keys(t.attributes).length,a=Math.floor(e/n);let r=e%n;Object.keys(t.attributes).forEach(e=>{let n=a;r>0&&(n++,r--);const o=Math.min(0+n,Rs);t.setAttribute(e,o)})}return(0,r.onMounted)(()=>{}),(e,l)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Ss,[(0,r.createElementVNode)("div",Vs,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("先天六命分配")),1),(0,r.createElementVNode)("div",_s,[(0,r.createTextVNode)((0,r.toDisplayString)(e.$t("剩余技能点:"))+" ",1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)({negative:(0,r.unref)(t).remainingTalentPoints<0})},(0,r.toDisplayString)((0,r.unref)(t).remainingTalentPoints),3)])]),(0,r.createElementVNode)("div",Cs,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(t).attributes,(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:o,class:"attribute-item"},[(0,r.createElementVNode)("div",As,[(0,r.createElementVNode)("span",Ds,(0,r.toDisplayString)(n[o]),1),(0,r.createElementVNode)("p",Ts,(0,r.toDisplayString)(a[o]),1)]),(0,r.createElementVNode)("div",Bs,[(0,r.createElementVNode)("button",{onClick:e=>function(e){t.attributes[e]>0&&t.setAttribute(e,t.attributes[e]-1)}(o),disabled:e<=0},"-",8,Is),(0,r.createElementVNode)("span",zs,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)("button",{onClick:e=>function(e){t.remainingTalentPoints>0&&t.attributes[e]<Rs&&t.setAttribute(e,t.attributes[e]+1)}(o),disabled:(0,r.unref)(t).remainingTalentPoints<=0||e>=Rs,class:(0,r.normalizeClass)({disabled:(0,r.unref)(t).remainingTalentPoints<=0||e>=Rs})}," + ",10,Ms)])]))),128))]),(0,r.createElementVNode)("div",Ps,[(0,r.createElementVNode)("button",{onClick:o,class:"btn btn-secondary"},(0,r.toDisplayString)(e.$t("重置")),1),(0,r.createElementVNode)("button",{onClick:i,class:"btn btn-warning"},(0,r.toDisplayString)(e.$t("🎲 随机")),1),(0,r.createElementVNode)("button",{onClick:s,class:"btn btn-success"},(0,r.toDisplayString)(e.$t("⚖️ 均衡")),1)])]))}});var Os=n(6095),Ls={};Ls.styleTagTransform=k(),Ls.setAttributes=v(),Ls.insert=h().bind(null,"head"),Ls.domAPI=p(),Ls.insertStyleElement=y(),u()(Os.A,Ls),Os.A&&Os.A.locals&&Os.A.locals;const Fs=(0,N.A)($s,[["__scopeId","data-v-88b3b82e"]]),js={class:"preview-container"},Us={class:"title"},qs={class:"subtitle"},Gs={class:"preview-grid"},Hs={class:"preview-item name-item"},Ys={for:"characterName"},Ws=["placeholder"],Xs={class:"name-hint"},Js={class:"preview-item race-item input-field"},Ks={for:"characterRace"},Zs=["placeholder"],Qs={class:"preview-item gender-item"},el={class:"gender-control"},tl={class:"gender-label"},nl={class:"gender-label"},al={class:"gender-label"},rl={class:"preview-item age-item"},ol={class:"age-control"},il=["disabled"],sl={class:"age-unit"},ll={key:0,class:"preview-item"},cl={class:"streaming-control"},dl={class:"streaming-label"},ul={class:"streaming-label"},ml={class:"streaming-hint"},pl={class:"preview-item"},gl={class:"item-description"},hl={class:"preview-item"},fl={class:"item-description"},vl={class:"preview-item"},bl={class:"item-description"},yl={class:"preview-item"},xl={class:"item-description"},kl={class:"preview-item talents-item"},wl={key:0},El={class:"item-description"},Nl={key:1},Sl={key:1,class:"preview-item attributes-item"},Vl={class:"preview-item cloud-info-item"},_l={class:"cloud-info-text"},Cl=(0,r.defineComponent)({__name:"Step7_Preview",props:{isLocalCreation:{type:Boolean}},setup(e){const t=(0,J.N)(),n=e;(0,r.onMounted)(async()=>{if(t.characterPayload.character_name&&"无名者"!==t.characterPayload.character_name&&""!==t.characterPayload.character_name.trim())return void console.log("[Step7_Preview] 已有角色名字，跳过获取:",t.characterPayload.character_name);let e=!1;try{const n="undefined"!=typeof window?window.TavernHelper:null;if(n){if(!e&&"function"==typeof n.substitudeMacros)try{const a=await n.substitudeMacros("{{user}}");console.log("[Step7_Preview] substitudeMacros {{user}} ->",a),a&&"{{user}}"!==a&&"string"==typeof a&&a.trim()&&(t.characterPayload.character_name=a.trim(),console.log("[Step7_Preview] ✅ 从酒馆宏获取用户名字:",a),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ substitudeMacros 失败:",e)}if(!e&&"function"==typeof n.getVariables)try{const a=await n.getVariables({type:"global"}),r=a["persona.name"]||a.name||a.user_name||a.user;console.log("[Step7_Preview] 全局变量中的名字:",r),r&&"string"==typeof r&&r.trim()&&(t.characterPayload.character_name=r.trim(),console.log("[Step7_Preview] ✅ 从全局变量获取名字:",r),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ getVariables 失败:",e)}if(!e&&"function"==typeof n.getCharData)try{const a=await n.getCharData();a?.name&&"string"==typeof a.name&&a.name.trim()&&(t.characterPayload.character_name=a.name.trim(),console.log("[Step7_Preview] ✅ 从角色数据获取名字:",a.name),e=!0)}catch(e){console.warn("[Step7_Preview] ⚠️ getCharData 失败:",e)}}else console.log("[Step7_Preview] 非酒馆模式，跳过名字获取")}catch(e){console.error("[Step7_Preview] ❌ 无法从酒馆获取Persona名字:",e)}e||(t.characterPayload.character_name="",console.log("[Step7_Preview] 📝 未获取到名字，请用户自行输入用户名"))});const a=()=>{t.characterPayload.current_age++},o=()=>{t.characterPayload.current_age>0&&t.characterPayload.current_age--},i=()=>{t.characterPayload.current_age<0&&(t.characterPayload.current_age=0),t.characterPayload.current_age=Math.floor(t.characterPayload.current_age)};return(e,s)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",js,[(0,r.createElementVNode)("h2",Us,(0,r.toDisplayString)(e.$t("最终预览")),1),(0,r.createElementVNode)("p",qs,(0,r.toDisplayString)(e.$t("请确认你的选择，此为踏入超凡新生的最后一步。")),1),(0,r.createElementVNode)("div",Gs,[(0,r.createCommentVNode)(" Character Name "),(0,r.createElementVNode)("div",Hs,[(0,r.createElementVNode)("label",Ys,(0,r.toDisplayString)(e.$t("用户名:")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",id:"characterName",class:"named","onUpdate:modelValue":s[0]||(s[0]=e=>(0,r.unref)(t).characterPayload.character_name=e),placeholder:e.$t("请输入用户名")},null,8,Ws),[[r.vModelText,(0,r.unref)(t).characterPayload.character_name]]),(0,r.createElementVNode)("span",Xs,(0,r.toDisplayString)(e.$t("可自定义修改")),1)]),(0,r.createCommentVNode)(" Character Race "),(0,r.createElementVNode)("div",Js,[(0,r.createElementVNode)("label",Ks,(0,r.toDisplayString)(e.$t("种族:")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",id:"characterRace",class:"named","onUpdate:modelValue":s[1]||(s[1]=e=>(0,r.unref)(t).characterPayload.race=e),placeholder:e.$t("人族"),onMousedown:s[2]||(s[2]=(0,r.withModifiers)(()=>{},["stop"])),onClick:s[3]||(s[3]=(0,r.withModifiers)(()=>{},["stop"])),onSelect:s[4]||(s[4]=(0,r.withModifiers)(()=>{},["stop"]))},null,40,Zs),[[r.vModelText,(0,r.unref)(t).characterPayload.race]])]),(0,r.createCommentVNode)(" Gender Selection "),(0,r.createElementVNode)("div",Qs,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("性别")),1),(0,r.createElementVNode)("div",el,[(0,r.createElementVNode)("label",tl,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"gender",value:"男","onUpdate:modelValue":s[5]||(s[5]=e=>(0,r.unref)(t).characterPayload.gender=e)},null,512),[[r.vModelRadio,(0,r.unref)(t).characterPayload.gender]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("男")),1)]),(0,r.createElementVNode)("label",nl,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"gender",value:"女","onUpdate:modelValue":s[6]||(s[6]=e=>(0,r.unref)(t).characterPayload.gender=e)},null,512),[[r.vModelRadio,(0,r.unref)(t).characterPayload.gender]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("女")),1)]),(0,r.createElementVNode)("label",al,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"gender",value:"双性","onUpdate:modelValue":s[7]||(s[7]=e=>(0,r.unref)(t).characterPayload.gender=e)},null,512),[[r.vModelRadio,(0,r.unref)(t).characterPayload.gender]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("双性")),1)])])]),(0,r.createCommentVNode)(" Birth Age "),(0,r.createElementVNode)("div",rl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("初始年龄")),1),(0,r.createElementVNode)("div",ol,[(0,r.createElementVNode)("button",{type:"button",onClick:o,disabled:(0,r.unref)(t).characterPayload.current_age<=0,class:"age-btn"},"-",8,il),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":s[8]||(s[8]=e=>(0,r.unref)(t).characterPayload.current_age=e),class:"age-input",min:"0",onInput:i},null,544),[[r.vModelText,(0,r.unref)(t).characterPayload.current_age,void 0,{number:!0}]]),(0,r.createElementVNode)("span",sl,(0,r.toDisplayString)(e.$t("岁")),1),(0,r.createElementVNode)("button",{type:"button",onClick:a,class:"age-btn"},"+")])]),(0,r.createCommentVNode)(" Start Mode (Streaming / Non-Streaming) "),n.isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("div",ll,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("开局模式")),1),(0,r.createElementVNode)("div",cl,[(0,r.createElementVNode)("label",dl,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"startMode",value:!0,"onUpdate:modelValue":s[9]||(s[9]=e=>(0,r.unref)(t).useStreamingStart=e)},null,512),[[r.vModelRadio,(0,r.unref)(t).useStreamingStart]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("流式开局")),1)]),(0,r.createElementVNode)("label",ul,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"startMode",value:!1,"onUpdate:modelValue":s[10]||(s[10]=e=>(0,r.unref)(t).useStreamingStart=e)},null,512),[[r.vModelRadio,(0,r.unref)(t).useStreamingStart]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("非流式开局")),1)])]),(0,r.createElementVNode)("p",ml,(0,r.toDisplayString)((0,r.unref)(t).useStreamingStart?e.$t("流式开局：更快，可能被中断"):e.$t("非流式开局：一次性生成完整内容，更稳定可靠")),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" World "),(0,r.createElementVNode)("div",pl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("所选世界")),1),(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t).selectedWorld?.name||e.$t("未选择")),1),(0,r.createElementVNode)("p",gl,(0,r.toDisplayString)((0,r.unref)(t).selectedWorld?.description||e.$t("暂无描述")),1)]),(0,r.createCommentVNode)(" Talent Tier "),(0,r.createElementVNode)("div",hl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("天资")),1),(0,r.createElementVNode)("h4",{style:(0,r.normalizeStyle)({color:(0,r.unref)(t).selectedTalentTier?.color||"inherit"})},(0,r.toDisplayString)((0,r.unref)(t).selectedTalentTier?.name||e.$t("未选择")),5),(0,r.createElementVNode)("p",fl,(0,r.toDisplayString)((0,r.unref)(t).selectedTalentTier?.description||e.$t("暂无描述")),1)]),(0,r.createCommentVNode)(" Origin "),(0,r.createElementVNode)("div",vl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("出身")),1),(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t).selectedOrigin?.name||e.$t("随机出身")),1),(0,r.createElementVNode)("p",bl,(0,r.toDisplayString)((0,r.unref)(t).selectedOrigin?.description||e.$t("暂无描述")),1)]),(0,r.createCommentVNode)(" Spirit Root "),(0,r.createElementVNode)("div",yl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("灵根")),1),(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t).selectedSpiritRoot?.name||e.$t("随机灵根")),1),(0,r.createElementVNode)("p",xl,(0,r.toDisplayString)((0,r.unref)(t).selectedSpiritRoot?.description||e.$t("暂无描述")),1)]),(0,r.createCommentVNode)(" Talents "),(0,r.createElementVNode)("div",kl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("天赋")),1),(0,r.unref)(t).selectedTalents.length?((0,r.openBlock)(),(0,r.createElementBlock)("ul",wl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(t).selectedTalents,e=>((0,r.openBlock)(),(0,r.createElementBlock)("li",{key:e.id},[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("p",El,(0,r.toDisplayString)(e.description),1)]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("p",Nl,(0,r.toDisplayString)(e.$t("未选择任何天赋")),1))]),(0,r.createCommentVNode)(" Attributes "),n.isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("div",Sl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("先天六司")),1),(0,r.createElementVNode)("ul",null,[(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("根骨"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.root_bone),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("灵性"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.spirituality),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("悟性"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.comprehension),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("气运"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.fortune),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("魅力"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.charm),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("心性"))+": "+(0,r.toDisplayString)((0,r.unref)(t).attributes.temperament),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" Cloud Mode Placeholder "),(0,r.createElementVNode)("div",Vl,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("命格天定")),1),(0,r.createElementVNode)("p",_l,(0,r.toDisplayString)(e.$t("联机模式下，角色的初始命格将由所选世界的天道法则在云端生成，以确保公平与平衡。")),1)])],2112))])]))}});var Al=n(7063),Dl={};Dl.styleTagTransform=k(),Dl.setAttributes=v(),Dl.insert=h().bind(null,"head"),Dl.domAPI=p(),Dl.insertStyleElement=y(),u()(Al.A,Dl),Al.A&&Al.A.locals&&Al.A.locals;const Tl=(0,N.A)(Cl,[["__scopeId","data-v-c4ae9bdc"]]),Bl={class:"creation-container"},Il={class:"creation-scroll"},zl={class:"header-container"},Ml={class:"header-top"},Pl={class:"mode-indicator"},Rl={key:0,class:"cloud-sync-container"},$l={class:"progress-steps"},Ol={class:"step-circle"},Ll={class:"step-label"},Fl={class:"step-content"},jl={class:"navigation-buttons"},Ul={class:"points-display"},ql={key:0,class:"destiny-points"},Gl={class:"points-label"},Hl=["disabled"],Yl={class:"travel-confirm-card"},Wl={class:"travel-confirm-title"},Xl={class:"travel-confirm-message"},Jl={class:"travel-confirm-points"},Kl={class:"points-label"},Zl={class:"points-value"},Ql={class:"travel-confirm-actions"},ec=["disabled"],tc=["disabled"],nc=(0,r.defineComponent)({__name:"CharacterCreation",props:{onBack:{type:Function}},emits:["creation-complete"],setup(e,{expose:t,emit:a}){const o=e,i=a,s=(0,J.N)(),{t:l}=(0,K.s)(),c=(0,r.ref)(!1),d=(0,r.ref)(!1),u=(0,r.ref)(null),m=(0,r.ref)(!1),p=(0,r.ref)(null),g=(0,r.computed)(()=>u.value??0);function h(e){if("男"===e||"女"===e||"其他"===e)return e}function f(){}(0,r.onMounted)(async()=>{console.log("【角色创建】当前模式:",s.isLocalCreation?"单机":"联机"),await s.initializeStore(s.isLocalCreation?"single":"cloud");const e=s.creationData.worlds.length,t=s.creationData.talents.length;console.log("【角色创建】当前数据量:"),console.log("- 总世界数量:",e),console.log("- 总天赋数量:",t),!s.isLocalCreation&&(e<=3||t<=5)&&(console.log("【角色创建】联机模式下数据量不足，尝试获取更新数据..."),await s.fetchAllCloudData(),console.log("【角色创建】云端数据获取完成，最终数据量:"),console.log("- 总世界数量:",s.creationData.worlds.length),console.log("- 总天赋数量:",s.creationData.talents.length));try{const e=await(0,se.getCurrentCharacterName)();e?(console.log("【角色创建】成功获取酒馆角色卡名字:",e),s.characterPayload.character_name=e):(console.log("【角色创建】无法获取酒馆角色卡名字，使用默认值"),s.characterPayload.character_name=s.isLocalCreation?"无名者":"修士")}catch(e){console.error("【角色创建】获取角色名字时出错:",e),s.characterPayload.character_name=s.isLocalCreation?"无名者":"修士"}}),(0,r.onUnmounted)(()=>{s.resetOnExit()}),t({handleAIGenerateClick:f});const v=(0,r.computed)(()=>[l("次元选择"),l("初始人设"),l("出身设置"),l("基础设定"),l("天赋选择"),l("属性加点"),l("最终预览")]),b=(0,r.computed)(()=>({character_name:s.characterPayload.character_name,gender:s.characterPayload.gender,race:s.characterPayload.race,current_age:s.characterPayload.current_age,world:s.selectedWorld,talentTier:s.selectedTalentTier,origin:s.selectedOrigin,spiritRoot:s.selectedSpiritRoot,talents:s.selectedTalents,baseAttributes:{root_bone:s.attributes.root_bone,spirituality:s.attributes.spirituality,comprehension:s.attributes.comprehension,fortune:s.attributes.fortune,charm:s.attributes.charm,temperament:s.attributes.temperament}})),y=()=>{s.currentStep>1?s.prevStep():o.onBack()},x=(0,r.computed)(()=>{const e=s.currentStep,t=s.totalSteps,n=s.selectedWorld,a=s.selectedTalentTier,r=s.remainingTalentPoints,o=c.value;return console.log("[DEBUG] 按钮状态检查 - 当前步骤:",e,"/",t),console.log("[DEBUG] 按钮状态检查 - isGenerating:",o),console.log("[DEBUG] 按钮状态检查 - 选中的世界:",n?.name),console.log("[DEBUG] 按钮状态检查 - 选中的天资:",a?.name),console.log("[DEBUG] 按钮状态检查 - 剩余天赋点:",r),1!==e||n?2!==e||a?(console.log("[DEBUG] 按钮状态：启用"),!1):(console.log("[DEBUG] 按钮被禁用：第2步未选择天资"),!0):(console.log("[DEBUG] 按钮被禁用：第1步未选择世界"),!0)}),k=()=>{m.value||(d.value=!1,p.value=null)},w=async()=>{if(!m.value){m.value=!0;try{const e=await T.Em.post("/api/v1/auth/travel-points/consume",{amount:10});u.value=Number(e?.travel_points??(u.value??0)-10),d.value=!1;const t=p.value;p.value=null,t&&await t()}catch(e){console.error("扣减穿越点数失败:",e),X.o.error("扣减穿越点数失败")}finally{m.value=!1}}},E=(0,r.ref)(null),N=(0,r.ref)(null),V=(0,r.ref)(null),_=(0,r.ref)(null),C=(0,r.ref)(null);async function A(){if(console.log("[DEBUG] createCharacter 开始执行"),console.log("[DEBUG] isGenerating.value:",c.value),c.value)console.warn("[CharacterCreation.vue] 角色创建已在进行中，忽略重复请求");else{if(console.log("[CharacterCreation.vue] createCharacter() called."),console.log("[DEBUG] 开始数据校验"),console.log("[DEBUG] 角色名:",s.characterPayload.character_name),console.log("[DEBUG] 选中的世界:",s.selectedWorld),console.log("[DEBUG] 选中的天资:",s.selectedTalentTier),console.log("[DEBUG] 选中的出身:",s.selectedOrigin),console.log("[DEBUG] 选中的灵根:",s.selectedSpiritRoot),s.characterPayload.character_name||(console.log("[DEBUG] 角色名为空，使用默认值"),s.characterPayload.character_name="修士"),!s.selectedWorld||!s.selectedTalentTier)return console.log("[DEBUG] 验证失败：缺少必需选择项"),console.log("[DEBUG] selectedWorld:",s.selectedWorld),console.log("[DEBUG] selectedTalentTier:",s.selectedTalentTier),void X.o.error("创建数据不完整，请检查世界和天资选择！");console.log("[DEBUG] selectedOrigin:",s.selectedOrigin,"(可为空，表示随机出生)"),console.log("[DEBUG] selectedSpiritRoot:",s.selectedSpiritRoot,"(可为空，表示随机灵根)"),c.value=!0,console.log("[DEBUG] 数据校验通过，开始创建角色");try{s.characterPayload.character_name,s.characterPayload.gender,s.characterPayload.race,s.selectedWorld,s.selectedTalentTier,s.selectedOrigin,s.selectedSpiritRoot,s.selectedTalents,s.attributes.root_bone,s.attributes.spirituality,s.attributes.comprehension,s.attributes.fortune,s.attributes.charm,s.attributes.temperament;const e={charId:`char_${Date.now()}`,characterName:s.characterPayload.character_name,world:s.selectedWorld,talentTier:s.selectedTalentTier,origin:s.selectedOrigin,spiritRoot:s.selectedSpiritRoot,talents:s.selectedTalents,baseAttributes:{root_bone:s.attributes.root_bone,spirituality:s.attributes.spirituality,comprehension:s.attributes.comprehension,fortune:s.attributes.fortune,charm:s.attributes.charm,temperament:s.attributes.temperament},mode:s.isLocalCreation?"单机":"联机",age:s.characterPayload.current_age,gender:s.characterPayload.gender,race:s.characterPayload.race};console.log("🔥 [角色创建] 当前选择的开局年龄:",s.characterPayload.current_age),console.log("🔥 [角色创建] 当前选择的种族:",s.characterPayload.race),console.log("发射creation-complete事件，载荷:",e),i("creation-complete",e)}catch(e){console.error("创建角色时发生严重错误:",e),c.value=!1,i("creation-complete",{error:e})}}}function B(e){console.log("[角色创建] 云端同步完成:",e),e.success&&e.newItemsCount>0&&X.o.success(`已更新 ${e.newItemsCount} 项云端数据`)}function I(e,t){console.log("[角色创建] 数据清除完成:",{type:e,count:t}),t>0&&s.resetCharacter()}async function z(e){if(console.log("[角色创建] 存储预设完成:",e),e.success&&e.presetData)try{const{savePreset:t}=await Promise.resolve().then(n.bind(n,5735)),a={name:"string"==typeof e.presetData.name?e.presetData.name:"未命名预设",description:"string"==typeof e.presetData.description?e.presetData.description:"",data:{character_name:s.characterPayload.character_name,gender:h(s.characterPayload.gender),race:s.characterPayload.race,current_age:s.characterPayload.current_age,world:s.selectedWorld??null,talentTier:s.selectedTalentTier??null,origin:s.selectedOrigin??null,spiritRoot:s.selectedSpiritRoot??null,talents:s.selectedTalents??[],baseAttributes:{root_bone:s.attributes.root_bone,spirituality:s.attributes.spirituality,comprehension:s.attributes.comprehension,fortune:s.attributes.fortune,charm:s.attributes.charm,temperament:s.attributes.temperament}}},r=await t(a);console.log("[角色创建] 预设已保存到 IndexedDB, ID:",r),X.o.success("预设保存成功！")}catch(e){console.error("[角色创建] 保存预设到 IndexedDB 失败:",e),X.o.error("预设保存失败")}}async function M(e){if(console.log("[角色创建] 加载预设完成:",e),e.success){if(!e.presetData)return console.warn("[角色创建] 预设数据为空"),void X.o.error("预设数据无效");console.log("[角色创建] 准备使用预设数据创建角色:",e.presetData);try{const t=e.presetData.data,n=s.creationData.worlds.find(e=>e.name===t.world?.name),a=s.creationData.talentTiers.find(e=>e.name===t.talentTier?.name),o=s.creationData.origins.find(e=>e.name===t.origin?.name),i=s.creationData.spiritRoots.find(e=>e.name===t.spiritRoot?.name),l=n?n.id:"",c=a?a.id:"",d=t.talents&&Array.isArray(t.talents)?t.talents.map(e=>s.creationData.talents.find(t=>t.name===e.name)?.id).filter(e=>void 0!==e):[],u={...s.characterPayload,character_name:t.character_name||"无名者",gender:t.gender||"男",race:t.race||"人族",current_age:t.current_age??16,world_id:l,talent_tier_id:c,origin_id:o?o.id:null,spirit_root_id:i?i.id:null,selected_talent_ids:d,root_bone:t.baseAttributes?.root_bone??0,spirituality:t.baseAttributes?.spirituality??0,comprehension:t.baseAttributes?.comprehension??0,fortune:t.baseAttributes?.fortune??0,charm:t.baseAttributes?.charm??0,temperament:t.baseAttributes?.temperament??0};if(s.characterPayload=u,console.log("[角色创建] 预设数据已原子性恢复, 新的Payload:",u),await(0,r.nextTick)(),!s.selectedWorld||!s.selectedTalentTier)return console.error("[角色创建] 预设恢复后检查失败，核心数据缺失。"),X.o.error("预设数据不完整或已失效，请重新选择。"),void(s.currentStep=1);s.currentStep=s.totalSteps,await(0,r.nextTick)(),console.log("[角色创建] 预设数据恢复且校验通过，执行创建..."),await A()}catch(e){console.error("[角色创建] 使用预设数据失败:",e),X.o.error("预设数据处理失败")}}else X.o.error(e.message)}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Bl,[(0,r.createVNode)(S),(0,r.createElementVNode)("div",Il,[(0,r.createCommentVNode)(" 进度条 "),(0,r.createElementVNode)("div",zl,[(0,r.createElementVNode)("div",Ml,[(0,r.createCommentVNode)(" 左侧：模式指示 "),(0,r.createElementVNode)("div",Pl,(0,r.toDisplayString)(e.$t("准备穿越异世界")),1),(0,r.createCommentVNode)(" 右侧：云端同步按钮（仅单机模式显示） "),(0,r.unref)(s).isLocalCreation?((0,r.openBlock)(),(0,r.createElementBlock)("div",Rl,[(0,r.createVNode)(ie,{onSyncCompleted:B,variant:"compact",size:"small"}),(0,r.createVNode)(We,{variant:"compact",size:"small","current-step":(0,r.unref)(s).currentStep,"total-steps":(0,r.unref)(s).totalSteps,"character-data":b.value,onStoreCompleted:z},null,8,["current-step","total-steps","character-data"]),(0,r.createVNode)(Gn,{variant:"compact",size:"small",onLoadCompleted:M}),(0,r.createVNode)(he,{variant:"horizontal",size:"small",onDataCleared:I})])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",$l,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(s).totalSteps,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:(0,r.normalizeClass)(["step",{active:(0,r.unref)(s).currentStep>=e}])},[(0,r.createElementVNode)("div",Ol,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)("div",Ll,(0,r.toDisplayString)(v.value[e-1]),1)],2))),128))])]),(0,r.createCommentVNode)(" 内容区域 "),(0,r.createElementVNode)("div",Fl,[(0,r.createVNode)(r.Transition,{name:"fade-step",mode:"out-in"},{default:(0,r.withCtx)(()=>[((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:(0,r.unref)(s).currentStep,class:"step-wrapper"},[1===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(Jr,{key:0,ref_key:"step1Ref",ref:E,onAiGenerate:f},null,512)):2===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(wo,{key:1,ref_key:"step2Ref",ref:N,onAiGenerate:f},null,512)):3===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(Xo,{key:2,ref_key:"step3Ref",ref:V,onAiGenerate:f},null,512)):4===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(es,{key:3,ref_key:"step4Ref",ref:_,onAiGenerate:f},null,512)):5===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(Ns,{key:4,ref_key:"step5Ref",ref:C,onAiGenerate:f},null,512)):6===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(Fs,{key:5})):7===(0,r.unref)(s).currentStep?((0,r.openBlock)(),(0,r.createBlock)(Tl,{key:6,"is-local-creation":(0,r.unref)(s).isLocalCreation},null,8,["is-local-creation"])):(0,r.createCommentVNode)("v-if",!0)]))]),_:1})]),(0,r.createCommentVNode)(" 导航 "),(0,r.createElementVNode)("div",jl,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(y,["prevent"]),type:"button",class:"btn btn-secondary"},(0,r.toDisplayString)(1===(0,r.unref)(s).currentStep?e.$t("返回"):e.$t("上一步")),1),(0,r.createCommentVNode)(" 剩余点数显示 "),(0,r.createElementVNode)("div",Ul,[(0,r.unref)(s).currentStep>=3&&(0,r.unref)(s).currentStep<=7?((0,r.openBlock)(),(0,r.createElementBlock)("div",ql,[(0,r.createElementVNode)("span",Gl,(0,r.toDisplayString)(e.$t("剩余技能点"))+":",1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["points-value",{low:(0,r.unref)(s).remainingTalentPoints<0}])},(0,r.toDisplayString)((0,r.unref)(s).remainingTalentPoints),3)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("button",{type:"button",onClick:t[0]||(t[0]=(0,r.withModifiers)(e=>{console.log("[DEBUG] 开启超凡新生按钮被点击!"),async function(e){console.log("[DEBUG] handleNext 被调用，当前步骤:",s.currentStep,"总步骤:",s.totalSteps),e&&(e.preventDefault(),e.stopPropagation(),console.log("[DEBUG] 事件已阻止默认行为")),s.currentStep<s.totalSteps?(console.log("[DEBUG] 执行下一步"),s.nextStep()):(console.log("[DEBUG] 最后一步，准备创建角色"),await(async e=>{const t=await(async()=>{if(!(0,D.isBackendConfigured)())return X.o.error("后端未配置，无法获取穿越点数"),null;if(!localStorage.getItem("access_token"))return X.o.error("请先登录后端"),null;try{const e=await T.Em.get("/api/v1/auth/me"),t=Number(e?.travel_points??0);return u.value=t,t}catch(e){return console.error("获取穿越点数失败:",e),X.o.error("获取穿越点数失败"),null}})();null!==t&&(t<10?X.o.error(`穿越点数不足，当前剩余 ${t} 点`):(p.value=e,d.value=!0))})(async()=>{await A()}))}(e)},["prevent"])),disabled:c.value||x.value||(0,r.unref)(s).currentStep===(0,r.unref)(s).totalSteps&&(0,r.unref)(s).remainingTalentPoints<0,class:(0,r.normalizeClass)(["btn",{"btn-complete":(0,r.unref)(s).currentStep===(0,r.unref)(s).totalSteps,disabled:c.value||x.value||(0,r.unref)(s).currentStep===(0,r.unref)(s).totalSteps&&(0,r.unref)(s).remainingTalentPoints<0}])},(0,r.toDisplayString)((0,r.unref)(s).currentStep===(0,r.unref)(s).totalSteps?e.$t("开启超凡新生"):e.$t("下一步")),11,Hl)])]),(0,r.createCommentVNode)(" 穿越点数确认弹窗 "),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"travel-confirm-overlay",onClick:(0,r.withModifiers)(k,["self"])},[(0,r.createElementVNode)("div",Yl,[(0,r.createElementVNode)("h3",Wl,(0,r.toDisplayString)(e.$t("穿越点数确认")),1),(0,r.createElementVNode)("p",Xl,(0,r.toDisplayString)(e.$t("创建新的世界会消耗10个穿越点数")),1),(0,r.createElementVNode)("div",Jl,[(0,r.createElementVNode)("span",Kl,(0,r.toDisplayString)(e.$t("当前剩余"))+":",1),(0,r.createElementVNode)("span",Zl,(0,r.toDisplayString)(g.value),1)]),(0,r.createElementVNode)("div",Ql,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",type:"button",onClick:k,disabled:m.value},(0,r.toDisplayString)(e.$t("取消")),9,ec),(0,r.createElementVNode)("button",{class:"btn btn-complete",type:"button",onClick:w,disabled:m.value},(0,r.toDisplayString)(e.$t("确定")),9,tc)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" AI生成等待由全局toast处理 ")]))}});var ac=n(8721),rc={};rc.styleTagTransform=k(),rc.setAttributes=v(),rc.insert=h().bind(null,"head"),rc.domAPI=p(),rc.insertStyleElement=y(),u()(ac.A,rc),ac.A&&ac.A.locals&&ac.A.locals;var oc=n(4319),ic={};ic.styleTagTransform=k(),ic.setAttributes=v(),ic.insert=h().bind(null,"head"),ic.domAPI=p(),ic.insertStyleElement=y(),u()(oc.A,ic),oc.A&&oc.A.locals&&oc.A.locals;const sc=(0,N.A)(nc,[["__scopeId","data-v-240ca87a"]]);function lc(e){if(window.turnstile)try{window.turnstile.reset(e??void 0)}catch(e){}}function cc(e){if(window.turnstile&&e)try{window.turnstile.remove?.(e)}catch(e){}}const dc={class:"login-container"},uc={class:"login-panel"},mc={class:"title"},pc={key:0,class:"subtitle"},gc={key:1,class:"subtitle"},hc={class:"form-group"},fc={for:"username"},vc=["placeholder"],bc={class:"form-group"},yc={for:"password"},xc=["placeholder"],kc={key:0,class:"form-group"},wc={for:"confirmPassword"},Ec=["placeholder"],Nc={key:1,class:"form-group"},Sc={for:"email"},Vc={class:"optional"},_c=["placeholder"],Cc={key:2,class:"form-group"},Ac={for:"invitationCode"},Dc=["placeholder"],Tc={key:3,class:"form-group"},Bc={for:"emailCode"},Ic={class:"email-input-row"},zc=["placeholder"],Mc=["disabled"],Pc={key:4,class:"form-group turnstile-group"},Rc={key:5,class:"success-message"},$c={class:"form-actions"},Oc=["disabled"],Lc={class:"btn-text"},Fc={class:"form-footer"},jc={key:0,class:"admin-login-toggle"},Uc={class:"admin-checkbox"},qc={key:3,class:"form-actions"},Gc=(0,r.defineComponent)({__name:"LoginView",emits:["loggedIn","back"],setup(e,{emit:t}){const n=t,a=(0,r.ref)(""),o=(0,r.ref)(""),i=(0,r.ref)(""),s=(0,r.ref)(""),l=(0,r.ref)(""),c=(0,r.ref)(""),d=(0,r.ref)(!1),u=(0,r.ref)(null),m=(0,r.ref)(null),p=(0,r.ref)(!1),g=(0,r.ref)(!1),h=(0,r.ref)((0,D.isBackendConfigured)()),f=(0,r.ref)(!1),v=(0,r.ref)(""),b=(0,r.ref)(!1),y=(0,r.ref)(null),x=(0,r.ref)(null),k=(0,r.ref)(""),w=(0,r.ref)(!1),E=(0,r.ref)(0);let N=null;const S=()=>{p.value=!p.value,u.value=null,m.value=null,o.value="",i.value="",s.value="",c.value="",k.value="",f.value&&lc(x.value)},V=async()=>{if(s.value)if(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s.value)){w.value=!0,u.value=null;try{const e=await(0,T.Em)("/api/v1/auth/send-email-code",{method:"POST",body:JSON.stringify({email:s.value,purpose:"register"})});e.success?(X.o.success("验证码已发送，请查收邮件"),E.value=60,N=setInterval(()=>{E.value--,E.value<=0&&N&&(clearInterval(N),N=null)},1e3)):u.value=e.message||"发送失败"}catch(e){u.value=e.detail||e.message||"发送验证码失败"}finally{w.value=!1}}else u.value="邮箱格式不正确";else u.value="请先输入邮箱"},_=async()=>{if(f.value&&v.value&&y.value)if(await async function(e=8e3){if("undefined"==typeof window)return!1;if(window.turnstile)return!0;const t="undefined"==typeof window?null:(window.turnstileCallbacks||(window.turnstileCallbacks=[]),window.turnstileCallbacks);return!!t&&await new Promise(n=>{let a=!1;const r=e=>{a||(a=!0,n(e))},o=setTimeout(()=>r(!!window.turnstile),e);t.push(()=>{clearTimeout(o),r(!!window.turnstile)})})}())try{cc(x.value),x.value=function(e,t){if(!window.turnstile)throw new Error("Turnstile SDK not loaded");return window.turnstile.render(e,{sitekey:t.siteKey??"0x4AAAAAACKKIZGhHxLokv-j",theme:t.theme??"auto",callback:e=>t.onSuccess("string"==typeof e?e:""),"error-callback":()=>t.onError?.(),"expired-callback":()=>t.onExpired?.()})}(y.value,{siteKey:v.value,theme:"dark"===document.documentElement.getAttribute("data-theme")?"dark":"light",onSuccess:e=>{k.value=e,u.value=null},onExpired:()=>{k.value=""},onError:()=>{k.value="",u.value="无效域。如果此问题仍然存在，请与站点管理员联系。"}})}catch(e){console.error("[Turnstile] render failed:",e),u.value="人机验证组件渲染失败，请刷新页面后重试"}else u.value="人机验证组件加载失败，请检查网络或刷新页面后重试"};return(0,r.watch)(f,e=>{e&&v.value&&setTimeout(()=>{_()},100)}),(0,r.onMounted)(async()=>{h.value&&await(async()=>{try{const e=await(0,T.Em)("/api/v1/auth/security-settings");f.value=e.turnstile_enabled,v.value=e.turnstile_site_key||"",b.value=e.email_verification_enabled}catch(e){console.warn("[Security] 获取配置失败:",e),f.value=!1,b.value=!1}})()}),(0,r.onBeforeUnmount)(()=>{cc(x.value),N&&clearInterval(N)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",dc,[(0,r.createElementVNode)("div",uc,[(0,r.createElementVNode)("h2",mc,(0,r.toDisplayString)(p.value?e.$t("注册账号"):e.$t("登录/注册")),1),h.value?((0,r.openBlock)(),(0,r.createElementBlock)("p",pc,(0,r.toDisplayString)(p.value?e.$t("注册新用户名，踏入异世界。"):e.$t("登录账户，以便同步云端数据。")),1)):((0,r.openBlock)(),(0,r.createElementBlock)("p",gc,"未配置后端服务器，登录/注册不可用")),h.value?((0,r.openBlock)(),(0,r.createElementBlock)("form",{key:2,onSubmit:t[8]||(t[8]=(0,r.withModifiers)(e=>p.value?(async()=>{if(!d.value)if(h.value)if(o.value===i.value){if(!l.value)return u.value="请输入邀请码",void X.o.error(u.value);if(b.value){if(!s.value)return void(u.value="请输入邮箱");if(!c.value)return void(u.value="请输入邮箱验证码")}if(f.value&&!k.value)return u.value="请先完成人机验证",void X.o.error(u.value);d.value=!0,u.value=null,m.value=null;try{const e={user_name:a.value,password:o.value};if(s.value&&(e.email=s.value),e.invitation_code=l.value,b.value){if(!c.value)return void(u.value="请输入邮箱验证码");e.email_code=c.value}f.value&&k.value&&(e.turnstile_token=k.value),await(0,T.Em)("/api/v1/auth/register",{method:"POST",body:JSON.stringify(e)}),X.o.success("用户名注册成功，欢迎踏入修仙之路！"),m.value="注册成功！请登录您的用户名",p.value=!1,k.value="",f.value&&lc(x.value)}catch(e){let t="一个未知的错误发生了";"object"==typeof e&&null!==e&&("detail"in e&&"string"==typeof e.detail?t=e.detail:"message"in e&&"string"==typeof e.message&&(t=e.message)),u.value=t,X.o.error(t)}finally{d.value=!1,k.value="",f.value&&lc(x.value)}}else u.value="两次输入密码不一致！";else X.o.info("未配置后端服务器，注册不可用")})():(async()=>{if(!d.value)if(h.value){if(f.value&&!k.value)return u.value="请先完成人机验证",void X.o.error(u.value);d.value=!0,u.value=null,m.value=null;try{const e={username:a.value,password:o.value,is_admin:g.value};f.value&&k.value&&(e.turnstile_token=k.value);const t=await(0,T.Em)("/api/v1/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});localStorage.setItem("access_token",t.access_token),localStorage.setItem("username",a.value),g.value?localStorage.setItem("is_admin","true"):localStorage.removeItem("is_admin"),X.o.success("登入成功，异世界已连通！"),n("loggedIn")}catch(e){let t="一个未知的错误发生了";"object"==typeof e&&null!==e&&("detail"in e&&"string"==typeof e.detail?t=e.detail:"message"in e&&"string"==typeof e.message&&(t=e.message)),u.value=t,X.o.error(t)}finally{d.value=!1,k.value="",f.value&&lc(x.value)}}else X.o.info("未配置后端服务器，登录不可用")})(),["prevent"]))},[(0,r.createElementVNode)("div",hc,[(0,r.createElementVNode)("label",fc,(0,r.toDisplayString)(e.$t("用户名")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),placeholder:e.$t("请输入您的用户名"),required:""},null,8,vc),[[r.vModelText,a.value]])]),(0,r.createElementVNode)("div",bc,[(0,r.createElementVNode)("label",yc,(0,r.toDisplayString)(e.$t("密码")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),placeholder:e.$t("请输入您的身份密码"),required:""},null,8,xc),[[r.vModelText,o.value]])]),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",kc,[(0,r.createElementVNode)("label",wc,(0,r.toDisplayString)(e.$t("确认密码")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),placeholder:e.$t("请再次输密码"),required:""},null,8,Ec),[[r.vModelText,i.value]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 邮箱字段（注册时显示） "),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Nc,[(0,r.createElementVNode)("label",Sc,[(0,r.createTextVNode)((0,r.toDisplayString)(e.$t("邮箱"))+" ",1),(0,r.createElementVNode)("span",Vc,"("+(0,r.toDisplayString)(e.$t("可选"))+")",1)]),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"email",id:"email","onUpdate:modelValue":t[3]||(t[3]=e=>s.value=e),placeholder:e.$t("请输入您的邮箱")},null,8,_c),[[r.vModelText,s.value]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 邀请码字段（注册时显示） "),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Cc,[(0,r.createElementVNode)("label",Ac,[(0,r.createTextVNode)((0,r.toDisplayString)(e.$t("邀请码"))+" ",1),t[10]||(t[10]=(0,r.createElementVNode)("span",{class:"required"},"*",-1))]),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",id:"invitationCode","onUpdate:modelValue":t[4]||(t[4]=e=>l.value=e),placeholder:e.$t("请输入邀请码"),required:""},null,8,Dc),[[r.vModelText,l.value]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 邮箱验证（仅注册且启用时显示） "),p.value&&b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Tc,[(0,r.createElementVNode)("label",Bc,(0,r.toDisplayString)(e.$t("验证码")),1),(0,r.createElementVNode)("div",Ic,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",id:"emailCode","onUpdate:modelValue":t[5]||(t[5]=e=>c.value=e),placeholder:e.$t("请输入邮箱验证码"),required:""},null,8,zc),[[r.vModelText,c.value]]),(0,r.createElementVNode)("button",{type:"button",class:"btn btn-small",onClick:V,disabled:w.value||E.value>0||!s.value},(0,r.toDisplayString)(E.value>0?`${E.value}s`:w.value?"发送中...":"发送验证码"),9,Mc)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" Turnstile 人机验证 "),f.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Pc,[(0,r.createElementVNode)("div",{ref_key:"turnstileContainer",ref:y,class:"turnstile-container"},null,512)])):(0,r.createCommentVNode)("v-if",!0),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Rc,(0,r.toDisplayString)(m.value),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",$c,[(0,r.createElementVNode)("button",{type:"button",onClick:t[6]||(t[6]=e=>n("back")),class:"btn btn-secondary"},(0,r.toDisplayString)(e.$t("返回")),1),(0,r.createElementVNode)("button",{type:"submit",class:(0,r.normalizeClass)(["btn",{"is-loading":d.value}]),disabled:d.value},[(0,r.createElementVNode)("span",Lc,(0,r.toDisplayString)(p.value?e.$t("注册"):e.$t("登入")),1)],10,Oc)]),(0,r.createElementVNode)("div",Fc,[(0,r.createElementVNode)("a",{href:"#",onClick:(0,r.withModifiers)(S,["prevent"]),class:"link"},(0,r.toDisplayString)(p.value?e.$t("已有用户名？立即登入"):e.$t("没有账号？立即注册")),1),p.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",jc,[(0,r.createElementVNode)("label",Uc,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>g.value=e)},null,512),[[r.vModelCheckbox,g.value]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("管理员登录")),1)])]))])],32)):((0,r.openBlock)(),(0,r.createElementBlock)("div",qc,[(0,r.createElementVNode)("button",{type:"button",onClick:t[9]||(t[9]=e=>n("back")),class:"btn btn-secondary"},(0,r.toDisplayString)(e.$t("返回")),1)]))])]))}});var Hc=n(4033),Yc={};Yc.styleTagTransform=k(),Yc.setAttributes=v(),Yc.insert=h().bind(null,"head"),Yc.domAPI=p(),Yc.insertStyleElement=y(),u()(Hc.A,Yc),Hc.A&&Hc.A.locals&&Hc.A.locals;const Wc=(0,N.A)(Gc,[["__scopeId","data-v-3cd22fcb"]]);var Xc=n(4459),Jc=n(4582),Kc=n(7760),Zc=n(4530),Qc=n(6988);const ed={class:"workshop-container"},td={class:"workshop-panel"},nd={class:"header"},ad={class:"title-row"},rd={key:0},od={key:1},id={key:2},sd={key:1,class:"auth-pill warn"},ld={key:0,class:"backend-locked"},cd={class:"tabs"},dd={key:0,class:"browse scroll-content"},ud={class:"filters"},md=["placeholder"],pd=["value"],gd=["disabled"],hd={key:0,class:"manage-bar"},fd={class:"manage-meta"},vd={key:1,class:"loading"},bd={key:2,class:"empty"},yd={key:3,class:"item-list"},xd={class:"item-top"},kd={class:"item-title"},wd={class:"item-type"},Ed={key:0,class:"item-desc"},Nd={class:"item-meta"},Sd={key:0},Vd={key:1,class:"tags"},_d={class:"item-actions"},Cd=["onClick"],Ad=["onClick"],Dd={key:4,class:"pagination"},Td={class:"page-meta"},Bd={class:"page-controls"},Id=["disabled"],zd=["disabled"],Md={key:1,class:"upload scroll-content"},Pd={key:0,class:"upload-locked"},Rd={key:1,class:"upload-form"},$d={class:"form-row"},Od={class:"form-row"},Ld={class:"form-row"},Fd={class:"form-row"},jd={class:"form-row"},Ud={class:"content-actions"},qd={class:"file-btn btn btn-secondary"},Gd={key:2,class:"hint"},Hd={class:"actions"},Yd=["disabled"],Wd={key:2,class:"actions"},Xd={class:"modal"},Jd={key:0,class:"modal-body"},Kd={key:1,class:"modal-body"},Zd={class:"modal-info"},Qd={class:"modal-title"},eu={class:"modal-sub"},tu={key:0},nu={key:1},au={key:2},ru={class:"modal-actions"},ou={key:0,class:"import-saves"},iu={class:"form-row"},su=["value"],lu=["disabled"],cu=(0,r.defineComponent)({__name:"WorkshopView",setup(e){const t=(0,a.useRouter)(),n=(0,Jc.useCharacterStore)(),o=(0,r.ref)((0,D.isBackendConfigured)()),i=(0,r.ref)(null),s=(0,r.computed)(()=>o.value?i.value??"":""),l=(0,r.computed)(()=>s.value||"未知版本"),c=(0,r.ref)("checking"),d=(0,r.ref)("browse"),u=(0,r.ref)(1),m=(0,r.ref)(12),p=(0,r.ref)(0),g=[8,12,20,30],h=(0,r.computed)(()=>"mine"===d.value?"mine":"browse"),f=(0,r.computed)(()=>Math.max(1,Math.ceil(p.value/m.value))),v=(0,r.computed)(()=>"mine"===d.value),b=(0,r.computed)(()=>"upload"!==d.value),y={settings:"设置",prompts:"提示词",saves:"单机存档",start_config:"开局配置"},x=async()=>{if(o.value){c.value="checking";try{const e=await(0,T.verifyStoredToken)();c.value=e?"authed":"unauthed"}catch{c.value="unauthed"}}else c.value="unauthed"};(0,r.onMounted)(async()=>{if(!o.value)return;const e=await(0,D.d9)();e&&(i.value=e),x(),A()});const k=()=>{t.push("/")},w=()=>{o.value?t.push("/login"):X.o.info("未配置后端服务器，登录不可用")},E=e=>{"mine"!==e||"authed"===c.value?d.value=e:w()},N=(0,r.ref)(""),V=(0,r.ref)(""),_=(0,r.ref)([]),C=(0,r.ref)(!1),A=async()=>{if(!o.value)return _.value=[],void(p.value=0);if("mine"!==h.value||"authed"===c.value){C.value=!0;try{const e="mine"===h.value?await async function(e){const t=new URLSearchParams;e.type&&t.set("type",e.type),e.q&&t.set("q",e.q),e.page&&t.set("page",String(e.page)),e.pageSize&&t.set("page_size",String(e.pageSize));const n=t.toString();return T.Em.get("/api/v1/workshop/my-items"+(n?`?${n}`:""))}({type:N.value,q:V.value,page:u.value,pageSize:m.value}):await async function(e){const t=new URLSearchParams;e.type&&t.set("type",e.type),e.q&&t.set("q",e.q),e.page&&t.set("page",String(e.page)),e.pageSize&&t.set("page_size",String(e.pageSize));const n=t.toString();return T.Em.get("/api/v1/workshop/items"+(n?`?${n}`:""))}({type:N.value,q:V.value,page:u.value,pageSize:m.value});_.value=e.items||[],p.value=e.total||0}catch{_.value=[],p.value=0}finally{C.value=!1}}else w()},B=()=>{u.value>1&&(u.value-=1)},I=()=>{u.value<f.value&&(u.value+=1)};(0,r.watch)(d,()=>{u.value=1,b.value&&A()}),(0,r.watch)(u,()=>{b.value&&A()}),(0,r.watch)(m,()=>{u.value=1,b.value&&A()}),(0,r.watch)(N,()=>{u.value=1,b.value&&A()});const z=(0,r.ref)({open:!1,loading:!1,item:null,payload:null}),M=(0,r.ref)(""),P=()=>{z.value.open=!1,z.value.loading=!1,z.value.item=null,z.value.payload=null,M.value=""},R=()=>{if(!z.value.item)return;const e=z.value.payload,t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n);const r=(new Date).toISOString().split("T")[0];a.download=`超凡新生-工坊-${z.value.item.type}-${r}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)},$=()=>{const e=z.value.payload,t=(0,Kc.ZT)(e);let n=null;if("settings"===t.type?n=t.payload:e?.settings?n=e.settings:null===t.type&&"object"==typeof t.payload&&(n=t.payload),n&&"object"==typeof n)try{const e={...(()=>{try{const e=localStorage.getItem("dad_game_settings");return e?JSON.parse(e):{}}catch{return{}}})(),...n};localStorage.setItem("dad_game_settings",JSON.stringify(e)),X.o.success("已导入本地设置（刷新页面后生效）"),P()}catch(e){console.error("导入设置失败:",e),X.o.error("导入设置失败，请重试")}else X.o.error("设置内容格式不正确")},O=async()=>{const e=z.value.payload,t=(0,Kc.ZT)(e);let n=null;if("prompts"===t.type?n=t.payload:"object"!=typeof e||Array.isArray(e)||(n=e),n&&"object"==typeof n)try{const e=await Xc.promptStorage.importPrompts(n);X.o.success(`已导入 ${e} 条提示词（刷新页面后生效）`),P()}catch(e){console.error("导入提示词失败:",e),X.o.error("导入提示词失败，请重试")}else X.o.error("提示词内容格式不正确")},L=()=>{const e=z.value.payload,t=(0,Kc.ZT)(e);let n=null;if("start_config"===t.type?n=t.payload:"object"!=typeof e||Array.isArray(e)||(n=e),n&&"object"==typeof n)try{localStorage.setItem("dad_start_config",JSON.stringify(n)),X.o.success("已应用到本地开局配置（重新打开开局页面生效）"),P()}catch(e){console.error("导入开局配置失败:",e),X.o.error("导入开局配置失败，请重试")}else X.o.error("开局配置格式不正确")},F=(0,r.computed)(()=>(n.allCharacterProfiles||[]).filter(e=>"单机"===e?.模式).map(e=>({角色ID:e.角色ID,name:e?.角色?.名字||e.角色ID}))),j=async()=>{if(!M.value)return;const e=z.value.payload,t=(0,Kc.ZT)(e),a="saves"===t.type&&Array.isArray(t.payload?.saves)?t.payload.saves:"character"===t.type&&Array.isArray(t.payload?.存档列表)?t.payload.存档列表:null;if(a){for(const e of a)await n.importSave(M.value,e);X.o.success(`已导入 ${a.length} 个存档到本地单机角色`)}else X.o.error("存档内容格式不正确")},U=(0,r.ref)("settings"),q=(0,r.ref)(""),G=(0,r.ref)(""),H=(0,r.ref)(""),Y=(0,r.ref)(null),W=(0,r.ref)(""),J=(0,r.ref)(!1),K=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text();Y.value=JSON.parse(e),W.value=`已读取：${t.name}`,q.value||(q.value=t.name.replace(/\.json$/i,""))}catch{Y.value=null,W.value="",X.o.error("读取文件失败，请确认是有效的 JSON")}finally{e.target.value=""}},Z=()=>{try{const e=localStorage.getItem("dad_game_settings");if(!e)return void X.o.info("本地还没有设置数据");const t=JSON.parse(e);Y.value={settings:t,exportInfo:{timestamp:(new Date).toISOString(),version:l.value,gameVersion:`超凡新生 v${l.value}`}},W.value="已从本地读取 dad_game_settings",q.value||(q.value=`设置-${l.value}`)}catch{X.o.error("读取本地设置失败")}},Q=async()=>{try{const e=await Xc.promptStorage.exportAll();Y.value=e,W.value="已从本地导出提示词",q.value||(q.value=`提示词-${l.value}`)}catch{X.o.error("导出本地提示词失败")}},ee=async()=>{if("authed"!==c.value)return void X.o.info("上传前需要先完成账号验证");const e=q.value.trim();if(e)if(Y.value){J.value=!0;try{const n=(()=>{const e=Y.value,t=(0,Kc.ZT)(e);if("settings"===U.value){const n="settings"===t.type?t.payload:e?.settings??e;if(!n||"object"!=typeof n)throw new Error("设置内容格式不正确");return{bundleType:"settings",bundle:(0,Kc.q3)("settings",n,{appVersion:l.value})}}if("prompts"===U.value){const n="prompts"===t.type?t.payload:e;if(!n||"object"!=typeof n)throw new Error("提示词内容格式不正确");return{bundleType:"prompts",bundle:(0,Kc.q3)("prompts",n,{appVersion:l.value})}}if("start_config"===U.value){const n="start_config"===t.type?t.payload:e;if(!n||"object"!=typeof n)throw new Error("开局配置格式不正确");return{bundleType:"start_config",bundle:(0,Kc.q3)("start_config",n,{appVersion:l.value})}}if("saves"===U.value){const n="character"===t.type?"character":"saves",a="saves"===t.type&&Array.isArray(t.payload?.saves)?t.payload.saves:"character"===t.type&&Array.isArray(t.payload?.存档列表)?t.payload.存档列表:"saves"===e?.type&&Array.isArray(e.saves)?e.saves:"character"===e?.type&&Array.isArray(e.character?.存档列表)?e.character.存档列表:null;if(!a)throw new Error("单机存档必须使用游戏导出的存档或角色文件");const r=a.map(e=>{const t=e?.存档数据;if(!t)throw new Error(`存档「${e?.存档名??"未知"}」缺少存档数据`);const n=(0,Zc.ru)(t)?t:(0,Zc.jj)(t).migrated,a=(0,Qc.$)(n);if(!a.isValid)throw new Error(`存档「${e?.存档名??"未知"}」校验失败：${a.errors[0]||"未知原因"}`);return{...e,存档数据:n}});if("character"===n){const n={角色ID:e?.角色ID??t.payload?.角色ID,角色信息:JSON.parse(JSON.stringify(e?.角色信息??t.payload?.角色信息??{})),存档列表:r};return{bundleType:"character",bundle:(0,Kc.q3)("character",n,{appVersion:l.value})}}const o={characterId:e?.characterId??t.payload?.characterId,characterName:e?.characterName??t.payload?.characterName,saves:r};return{bundleType:"saves",bundle:(0,Kc.q3)("saves",o,{appVersion:l.value})}}throw new Error("不支持的上传类型")})();await async function(e){return T.Em.post("/api/v1/workshop/items",e)}({type:U.value,title:e,description:G.value.trim()||void 0,tags:(t=H.value,t.split(",").map(e=>e.trim()).filter(Boolean).slice(0,12)),payload:n.bundle,game_version:`超凡新生 v${l.value}`,data_version:"1"}),X.o.success("上传成功"),q.value="",G.value="",H.value="",Y.value=null,W.value="",d.value="browse",u.value=1,await A()}catch{}finally{J.value=!1}var t}else X.o.error("请先选择/生成要上传的内容");else X.o.error("请填写标题")};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",ed,[(0,r.createVNode)(S),(0,r.createElementVNode)("div",td,[(0,r.createElementVNode)("div",nd,[(0,r.createElementVNode)("div",ad,[t[12]||(t[12]=(0,r.createElementVNode)("h2",{class:"title"},"创意工坊",-1)),o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)(["auth-pill",{ok:"authed"===c.value,warn:"authed"!==c.value}])},["checking"===c.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",rd,"检测中…")):"authed"===c.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",od,"已验证")):((0,r.openBlock)(),(0,r.createElementBlock)("span",id,"未验证")),"authed"!==c.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:3,class:"pill-link",onClick:w},"去验证")):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{class:"pill-link",onClick:x},"刷新")],2)):((0,r.openBlock)(),(0,r.createElementBlock)("div",sd,t[11]||(t[11]=[(0,r.createElementVNode)("span",null,"未配置后端",-1)])))]),t[13]||(t[13]=(0,r.createElementVNode)("p",{class:"subtitle"},"用于玩家之间上传/分享：设置、提示词、开局配置、存档等内容",-1)),t[14]||(t[14]=(0,r.createElementVNode)("p",{class:"notice"},[(0,r.createTextVNode)(" 说明：创意工坊内容只对"),(0,r.createElementVNode)("strong",null,"单机本地"),(0,r.createTextVNode)("生效；联机模式的数据由后端权威控制（用于防作弊），不会被工坊内容覆盖。 ")],-1))]),o.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createElementVNode)("div",cd,[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["tab",{active:"browse"===d.value}]),onClick:t[0]||(t[0]=e=>E("browse"))},"浏览",2),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["tab",{active:"mine"===d.value}]),onClick:t[1]||(t[1]=e=>E("mine"))},"我的发布",2),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["tab",{active:"upload"===d.value}]),onClick:t[2]||(t[2]=e=>E("upload"))},"上传",2)]),"upload"!==d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",dd,[(0,r.createElementVNode)("div",ud,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>N.value=e),class:"input"},t[16]||(t[16]=[(0,r.createStaticVNode)('<option value="" data-v-7a070651>全部类型</option><option value="settings" data-v-7a070651>设置</option><option value="prompts" data-v-7a070651>提示词</option><option value="saves" data-v-7a070651>单机存档</option><option value="start_config" data-v-7a070651>开局配置</option>',5)]),512),[[r.vModelSelect,N.value]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>V.value=e),class:"input",placeholder:v.value?"搜索标题 / 说明":"搜索标题 / 作者 / 说明"},null,8,md),[[r.vModelText,V.value]]),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>m.value=e),class:"input"},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g,e=>(0,r.createElementVNode)("option",{key:e,value:e}," 每页 "+(0,r.toDisplayString)(e)+" 个 ",9,pd)),64))],512),[[r.vModelSelect,m.value,void 0,{number:!0}]]),(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:A,disabled:C.value},"刷新",8,gd)]),v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",hd,[t[17]||(t[17]=(0,r.createElementVNode)("div",{class:"manage-title"},"我的发布管理",-1)),(0,r.createElementVNode)("div",fd,"仅显示自己发布的内容 · 共 "+(0,r.toDisplayString)(p.value)+" 条",1)])):(0,r.createCommentVNode)("v-if",!0),C.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",vd,"加载中…")):0===_.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",bd,t[18]||(t[18]=[(0,r.createElementVNode)("p",null,"暂无内容",-1)]))):((0,r.openBlock)(),(0,r.createElementBlock)("div",yd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(_.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"item-card"},[(0,r.createElementVNode)("div",xd,[(0,r.createElementVNode)("div",kd,(0,r.toDisplayString)(e.title),1),(0,r.createElementVNode)("div",wd,(0,r.toDisplayString)(y[e.type]||e.type),1)]),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ed,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Nd,[(0,r.createElementVNode)("span",null,"作者："+(0,r.toDisplayString)(e.author_name),1),e.game_version?((0,r.openBlock)(),(0,r.createElementBlock)("span",Sd,"版本："+(0,r.toDisplayString)(e.game_version),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("span",null,"下载："+(0,r.toDisplayString)(e.downloads),1)]),e.tags?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Vd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.tags,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"tag"},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",_d,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:t=>(async e=>{z.value.open=!0,z.value.loading=!0,z.value.item=null,z.value.payload=null;try{const t=await async function(e){return T.Em.post(`/api/v1/workshop/items/${e}/download`,{})}(e);z.value.item=t.item,z.value.payload=t.payload}catch{P()}finally{z.value.loading=!1}})(e.id)},"下载",8,Cd),v.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"btn danger",onClick:t=>(async e=>{if("authed"===c.value){if(window.confirm(`确定删除「${e.title}」吗？删除后将无法恢复。`))try{await async function(e){return T.Em.delete(`/api/v1/workshop/items/${e}`)}(e.id),X.o.success("已删除"),await A()}catch{}}else w()})(e)},"删除",8,Ad)):(0,r.createCommentVNode)("v-if",!0)])]))),128))])),f.value>1?((0,r.openBlock)(),(0,r.createElementBlock)("div",Dd,[(0,r.createElementVNode)("div",Td,[(0,r.createElementVNode)("span",null,"共 "+(0,r.toDisplayString)(p.value)+" 条",1),(0,r.createElementVNode)("span",null,"第 "+(0,r.toDisplayString)(u.value)+" / "+(0,r.toDisplayString)(f.value)+" 页",1)]),(0,r.createElementVNode)("div",Bd,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:B,disabled:u.value<=1},"上一页",8,Id),(0,r.createElementVNode)("button",{class:"btn",onClick:I,disabled:u.value>=f.value},"下一页",8,zd)])])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Md,["authed"!==c.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Pd,[t[19]||(t[19]=(0,r.createElementVNode)("p",null,"上传需要先完成账号验证（用于标识作者与权限控制）。",-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:w},"去验证"),(0,r.createElementVNode)("button",{class:"btn",onClick:x},"刷新")])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Rd,[(0,r.createElementVNode)("div",$d,[t[21]||(t[21]=(0,r.createElementVNode)("label",{class:"label"},"类型",-1)),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>U.value=e),class:"input"},t[20]||(t[20]=[(0,r.createElementVNode)("option",{value:"settings"},"设置",-1),(0,r.createElementVNode)("option",{value:"prompts"},"提示词",-1),(0,r.createElementVNode)("option",{value:"saves"},"单机存档",-1),(0,r.createElementVNode)("option",{value:"start_config"},"开局配置",-1)]),512),[[r.vModelSelect,U.value]])]),(0,r.createElementVNode)("div",Od,[t[22]||(t[22]=(0,r.createElementVNode)("label",{class:"label"},"标题",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>q.value=e),class:"input",placeholder:"给这个分享起个名字"},null,512),[[r.vModelText,q.value]])]),(0,r.createElementVNode)("div",Ld,[t[23]||(t[23]=(0,r.createElementVNode)("label",{class:"label"},"说明",-1)),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>G.value=e),class:"input textarea",placeholder:"可选：写点说明（支持 2000 字以内）"},null,512),[[r.vModelText,G.value]])]),(0,r.createElementVNode)("div",Fd,[t[24]||(t[24]=(0,r.createElementVNode)("label",{class:"label"},"标签",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>H.value=e),class:"input",placeholder:"可选：用逗号分隔，如：新手,爽文,慢热"},null,512),[[r.vModelText,H.value]])]),(0,r.createElementVNode)("div",jd,[t[26]||(t[26]=(0,r.createElementVNode)("label",{class:"label"},"内容",-1)),(0,r.createElementVNode)("div",Ud,["settings"===U.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"btn btn-secondary",onClick:Z}," 从本地读取设置 ")):(0,r.createCommentVNode)("v-if",!0),"prompts"===U.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"btn btn-secondary",onClick:Q}," 从本地导出提示词 ")):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("label",qd,[t[25]||(t[25]=(0,r.createTextVNode)(" 选择 JSON 文件 ",-1)),(0,r.createElementVNode)("input",{type:"file",accept:".json,application/json",onChange:K,hidden:""},null,32)]),W.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",Gd,(0,r.toDisplayString)(W.value),1)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",Hd,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:k},"返回"),(0,r.createElementVNode)("button",{class:"btn",onClick:ee,disabled:J.value},(0,r.toDisplayString)(J.value?"上传中…":"上传到工坊"),9,Yd)])]))])),"upload"!==d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Wd,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:k},"返回")])):(0,r.createCommentVNode)("v-if",!0)],64)):((0,r.openBlock)(),(0,r.createElementBlock)("div",ld,[t[15]||(t[15]=(0,r.createElementVNode)("p",null,"未配置后端服务器，创意工坊不可用。",-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:k},"返回")])]))]),(0,r.createCommentVNode)(" 下载/导入弹窗 "),z.value.open?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(P,["self"])},[(0,r.createElementVNode)("div",Xd,[(0,r.createElementVNode)("div",{class:"modal-header"},[t[27]||(t[27]=(0,r.createElementVNode)("h3",null,"下载内容",-1)),(0,r.createElementVNode)("button",{class:"close-btn",onClick:P},"×")]),z.value.loading?((0,r.openBlock)(),(0,r.createElementBlock)("div",Jd,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Kd,[(0,r.createElementVNode)("div",Zd,[(0,r.createElementVNode)("div",Qd,(0,r.toDisplayString)(z.value.item?.title),1),(0,r.createElementVNode)("div",eu,[z.value.item?((0,r.openBlock)(),(0,r.createElementBlock)("span",tu,"类型："+(0,r.toDisplayString)(y[z.value.item.type]||z.value.item.type),1)):(0,r.createCommentVNode)("v-if",!0),z.value.item?.author_name?((0,r.openBlock)(),(0,r.createElementBlock)("span",nu,"作者："+(0,r.toDisplayString)(z.value.item.author_name),1)):(0,r.createCommentVNode)("v-if",!0),z.value.item?.game_version?((0,r.openBlock)(),(0,r.createElementBlock)("span",au,"版本："+(0,r.toDisplayString)(z.value.item.game_version),1)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",ru,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:R},"下载为文件"),"settings"===z.value.item?.type?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"btn",onClick:$}," 导入到本地设置 ")):(0,r.createCommentVNode)("v-if",!0),"prompts"===z.value.item?.type?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"btn",onClick:O}," 导入到本地提示词 ")):(0,r.createCommentVNode)("v-if",!0),"start_config"===z.value.item?.type?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:2,class:"btn",onClick:L}," 应用到开局配置 ")):(0,r.createCommentVNode)("v-if",!0)]),"saves"===z.value.item?.type?((0,r.openBlock)(),(0,r.createElementBlock)("div",ou,[(0,r.createElementVNode)("div",iu,[t[29]||(t[29]=(0,r.createElementVNode)("label",{class:"label"},"导入到单机角色",-1)),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>M.value=e),class:"input"},[t[28]||(t[28]=(0,r.createElementVNode)("option",{value:""},"请选择角色",-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(F.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.角色ID,value:e.角色ID},(0,r.toDisplayString)(e.name),9,su))),128))],512),[[r.vModelSelect,M.value]])]),(0,r.createElementVNode)("button",{class:"btn",disabled:!M.value,onClick:j},"导入存档",8,lu)])):(0,r.createCommentVNode)("v-if",!0)]))])])):(0,r.createCommentVNode)("v-if",!0)]))}});var du=n(8091),uu={};uu.styleTagTransform=k(),uu.setAttributes=v(),uu.insert=h().bind(null,"head"),uu.domAPI=p(),uu.insertStyleElement=y(),u()(du.A,uu),du.A&&du.A.locals&&du.A.locals;const mu=(0,N.A)(cu,[["__scopeId","data-v-7a070651"]]);var pu=n(1184);const gu=(0,V.A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),hu=(0,V.A)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),fu=(0,V.A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var vu=n(2794);const bu=(0,V.A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),yu=(0,V.A)("scroll",[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);var xu=n(7677);const ku=(0,V.A)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),wu=(0,V.A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),Eu=(0,V.A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Nu=(0,V.A)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),Su=(0,V.A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Vu=(0,V.A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var _u=n(1412);const Cu=(0,V.A)("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);var Au=n(8684),Du=n(8133);const Tu=(0,V.A)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Bu=(0,V.A)("users-round",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);var Iu=n(6494);const zu=new class{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}async emit(e,t){const n=Array.from(this.listeners.get(e)||[]);for(const e of n)await e(t)}};var Mu=n(2224);const Pu={练气:1,练气初期:1,练气中期:1,练气后期:1,练气圆满:1,练气极境:1,筑基:2,筑基初期:2,筑基中期:2,筑基后期:2,筑基圆满:2,筑基极境:2,金丹:3,金丹初期:3,金丹中期:3,金丹后期:3,金丹圆满:3,金丹极境:3,元婴:4,元婴初期:4,元婴中期:4,元婴后期:4,元婴圆满:4,元婴极境:4,化神:5,化神初期:5,化神中期:5,化神后期:5,化神圆满:5,化神极境:5,炼虚:6,炼虚初期:6,炼虚中期:6,炼虚后期:6,炼虚圆满:6,炼虚极境:6,合体:7,合体初期:7,合体中期:7,合体后期:7,合体圆满:7,合体极境:7,渡劫:8,渡劫初期:8,渡劫中期:8,渡劫后期:8,渡劫圆满:8,渡劫极境:8,练气期:1,筑基期:2,金丹期:3,元婴期:4,化神期:5,炼虚期:6,合体期:7,渡劫期:8};function Ru(e){return Pu[e]||0}function $u(e){return Array.isArray(e)?e.map(e=>{const t=function(e){if(!e)return e;if(e.leadership&&!e.领导层&&(e.领导层=e.leadership,delete e.leadership),String(e.名称||e.name||"").includes("合欢")?e.领导层?e.领导层.圣女||(e.领导层.圣女="灰夫人(合欢圣女)"):e.领导层={宗主:"合欢老魔",宗主修为:e.最强修为||"化神期",最强修为:e.最强修为||"化神期",圣女:"灰夫人(合欢圣女)"}:e.领导层&&("圣女"in e.领导层&&delete e.领导层.圣女,"圣子"in e.领导层&&delete e.领导层.圣子),e.memberCount&&!e.成员数量&&(e.成员数量={总数:e.memberCount.total,按境界:e.memberCount.byRealm,按职位:e.memberCount.byPosition},delete e.memberCount),e.成员数量){const t=e.成员数量;void 0!==t.total&&void 0===t.总数&&(t.总数=t.total),t.byRealm&&!t.按境界&&(t.按境界=t.byRealm),t.byPosition&&!t.按职位&&(t.按职位=t.byPosition)}const t=e.领导层?.最强修为||e.最强修为,n=Ru(t);if(console.log(`[宗门验证] ${e.名称}: 最强修为="${t}" → 等级=${n}`),console.log(`[宗门验证] ${e.名称}: 原始境界分布=`,e.成员数量?.按境界),e.成员数量?.按境界){const t=e.成员数量.按境界;let n=0,a="";if(Object.keys(t).forEach(e=>{if(t[e]>0){const t=Ru(e);t>n&&(n=t,a=e)}}),n>0&&a){const t=`${a.replace("期","")}圆满`;if(e.领导层){const a=e.领导层.最强修为;e.领导层.最强修为=t,console.log(`[宗门验证] ${e.名称}: 根据境界分布自动修正最强修为: "${a}" → "${t}"`),Ru(e.领导层.宗主修为||"")<n&&(e.领导层.宗主修为=t,console.log(`[宗门验证] ${e.名称}: 同时更新宗主修为为: "${t}"`))}}console.log(`[宗门验证] ${e.名称}: 境界分布包含:`,Object.keys(t).filter(e=>t[e]>0))}if(console.log(`[宗门验证] ${e.名称}: 验证后境界分布=`,e.成员数量?.按境界),e.领导层?.长老数量&&e.成员数量?.按境界){const t=e.领导层.长老数量,n=e.成员数量.按境界;let a=0;if(Object.keys(n).forEach(e=>{Ru(e)>=4&&(a+=n[e]||0)}),a>1.5*t){const e=1.2*t/a;Object.keys(n).forEach(t=>{if(Ru(t)>=4){const a=n[t];n[t]=Math.max(1,Math.round(a*e))}})}}return e}(e),n=function(e){const t=[];if(!e)return t.push("宗门数据为空"),{isValid:!1,errors:t};const n=e.领导层?.最强修为||e.最强修为,a=Ru(n);e.成员数量?.按境界&&Object.keys(e.成员数量.按境界).forEach(e=>{Ru(e)>a&&t.push(`境界分布错误: 存在${e}期修士，但最强修为仅为${n}`)});const r=e.领导层?.长老数量;if(r&&e.成员数量?.按境界){let n=0;Object.keys(e.成员数量.按境界).forEach(t=>{Ru(t)>=4&&(n+=e.成员数量.按境界[t]||0)}),n>2*r&&t.push(`人员配置不合理: 长老${r}位，但元婴期以上修士${n}人`)}return{isValid:0===t.length,errors:t}}(t);return n.isValid||console.warn(`[宗门验证] ${e.名称||"未知宗门"}存在问题:`,n.errors),t}):e}const Ou=(0,V.A)("maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),Lu=(0,V.A)("minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);function Fu(e){if(!e)return"凡人";if("string"==typeof e)return e;const t=e.名称||e.name||"凡人",n=e.阶段||e.stage||"";return"凡人"===t||"Mortal"===t?"凡人":n?`${t}·${n}`:t}var ju=n(1040);const Uu={class:"top-bar"},qu={class:"left-section"},Gu={class:"game-title"},Hu={key:0,class:"character-quick-info"},Yu={class:"character-name"},Wu={class:"character-realm"},Xu={class:"center-section"},Ju={class:"location-time-info"},Ku={class:"location-text"},Zu=["title"],Qu={class:"spirit-label"},em={class:"spirit-value"},tm={class:"spirit-bar"},nm={class:"time-value"},am={class:"right-section"},rm=(0,r.defineComponent)({__name:"TopBar",setup(e){const{t}=(0,K.s)(),n=(0,pu.useGameStateStore)(),a=(0,r.ref)(!1),o=(0,r.computed)(()=>{try{return n.character?.名字||""}catch(e){return console.error("[TopBar] Error getting characterName:",e),""}}),i=(0,r.computed)(()=>{try{return Fu(n.attributes?.境界)}catch(e){return console.error("[TopBar] Error getting characterRealm:",e),t("凡人")}}),s=(0,r.computed)(()=>{try{return n.location?.描述||t("初始地")}catch(e){return console.error("[TopBar] Error getting currentLocation:",e),t("初始地")}}),l=(0,r.computed)(()=>{try{return n.location?.灵气浓度||0}catch(e){return 0}}),c=(0,r.computed)(()=>{const e=l.value;return e>=80?"density-very-high":e>=60?"density-high":e>=40?"density-medium":e>=20?"density-low":"density-very-low"}),d=(0,r.computed)(()=>{const e=l.value;return t(e>=80?"灵气充沛 - 极佳修炼环境":e>=60?"灵气浓郁 - 良好修炼环境":e>=40?"灵气适中 - 普通修炼环境":e>=20?"灵气稀薄 - 修炼困难":"灵气枯竭 - 难以修炼")}),u=(0,r.computed)(()=>{try{const e=n.gameTime;if(e){const n=function(e){return e.分钟??0}(e),a=n.toString().padStart(2,"0"),r=e.小时.toString().padStart(2,"0");return`${t("仙道")}${e.年}${t("年")}${e.月}${t("月")}${e.日}${t("日")} ${r}:${a}`}return`${t("仙道")}${t("元年")}1${t("月")}1${t("日")} 00:00`}catch(e){return console.error("[TopBar] Error getting gameTime:",e),`${t("仙道")}${t("元年")}1${t("月")}1${t("日")} 00:00`}}),m=()=>{(0,ju.Kn)()?(0,ju.Eh)().catch(e=>{console.error((0,ju.zp)(e))}):(0,ju.lh)(document.documentElement).catch(e=>{console.error((0,ju.zp)(e))})};return(0,r.onMounted)(()=>{console.log("[TopBar] Component mounted");const e=()=>{a.value=!!(0,ju.Kn)()};document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e)}),(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Uu,[(0,r.createElementVNode)("div",qu,[(0,r.createElementVNode)("h1",Gu,(0,r.toDisplayString)((0,r.unref)(t)("超凡新生")),1),o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Hu,[(0,r.createElementVNode)("span",Yu,(0,r.toDisplayString)(o.value),1),(0,r.createElementVNode)("span",Wu,(0,r.toDisplayString)(i.value),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",Xu,[(0,r.createElementVNode)("div",Ju,[(0,r.createElementVNode)("span",Ku,(0,r.toDisplayString)(s.value),1),l.value>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["spirit-density",c.value]),title:d.value},[n[0]||(n[0]=(0,r.createElementVNode)("span",{class:"spirit-icon-wrapper"},[(0,r.createElementVNode)("span",{class:"spirit-icon"},"✧"),(0,r.createElementVNode)("span",{class:"spirit-glow"})],-1)),(0,r.createElementVNode)("span",Qu,(0,r.toDisplayString)((0,r.unref)(t)("灵气")),1),(0,r.createElementVNode)("span",em,(0,r.toDisplayString)(l.value),1),(0,r.createElementVNode)("span",tm,[(0,r.createElementVNode)("span",{class:"spirit-bar-fill",style:(0,r.normalizeStyle)({width:l.value+"%"})},null,4)])],10,Zu)):(0,r.createCommentVNode)("v-if",!0),n[1]||(n[1]=(0,r.createElementVNode)("span",{class:"separator"},"|",-1)),(0,r.createElementVNode)("span",nm,(0,r.toDisplayString)(u.value),1)])]),(0,r.createElementVNode)("div",am,[(0,r.createElementVNode)("button",{onClick:m,class:"fullscreen-btn"},[a.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(Lu),{key:1,size:16})):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(Ou),{key:0,size:16}))])])]))}});var om=n(952),im={};im.styleTagTransform=k(),im.setAttributes=v(),im.insert=h().bind(null,"head"),im.domAPI=p(),im.insertStyleElement=y(),u()(om.A,im),om.A&&om.A.locals&&om.A.locals;const sm=(0,N.A)(rm,[["__scopeId","data-v-4be6bb59"]]),lm=(0,V.A)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),cm=(0,V.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),dm=(0,V.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var um=n(4449);const mm=(0,V.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),pm={class:"left-sidebar"},gm={class:"sidebar-header"},hm={class:"sidebar-title"},fm={class:"real-time"},vm={class:"sidebar-content"},bm={class:"function-section"},ym={class:"section-title"},xm={class:"function-group"},km={class:"btn-icon"},wm={class:"btn-content"},Em={class:"btn-text"},Nm={class:"btn-desc"},Sm={class:"btn-icon"},Vm={class:"btn-content"},_m={class:"btn-text"},Cm={class:"btn-desc"},Am={class:"function-section"},Dm={class:"section-title"},Tm={class:"function-group"},Bm={class:"btn-icon"},Im={class:"btn-content"},zm={class:"btn-text"},Mm={class:"btn-desc"},Pm={class:"btn-icon"},Rm={class:"btn-content"},$m={class:"btn-text"},Om={class:"btn-desc"},Lm={class:"function-section"},Fm={class:"section-title"},jm={class:"function-group"},Um={class:"btn-icon"},qm={class:"btn-content"},Gm={class:"btn-text"},Hm={class:"btn-desc"},Ym={class:"btn-icon"},Wm={class:"btn-content"},Xm={class:"btn-text"},Jm={class:"btn-desc"},Km={class:"function-section"},Zm={class:"section-title"},Qm={class:"function-group"},ep={class:"btn-icon"},tp={class:"btn-content"},np={class:"btn-text"},ap={class:"btn-desc"},rp={class:"btn-icon"},op={class:"btn-content"},ip={class:"btn-text"},sp={class:"btn-desc"},lp={class:"btn-icon"},cp={class:"btn-content"},dp={class:"btn-text"},up={class:"btn-desc"},mp={class:"system-section"},pp={class:"function-group"},gp=["disabled"],hp={class:"btn-icon"},fp={class:"btn-content"},vp={class:"btn-text"},bp={class:"btn-desc"},yp={class:"btn-icon"},xp={class:"btn-content"},kp={class:"btn-text"},wp={class:"btn-desc"},Ep={class:"btn-icon"},Np={class:"btn-content"},Sp={class:"btn-text"},Vp={class:"btn-desc"},_p={class:"btn-icon"},Cp={class:"btn-content"},Ap={class:"btn-text"},Dp={class:"btn-desc"},Tp={class:"btn-icon"},Bp={class:"btn-content"},Ip={class:"btn-text"},zp={class:"btn-desc"},Mp={class:"btn-icon"},Pp={class:"btn-content"},Rp={class:"btn-text"},$p={class:"btn-desc"},Op={class:"btn-icon"},Lp={class:"btn-content"},Fp={class:"btn-text"},jp={class:"btn-desc"},Up={class:"sidebar-footer"},qp={class:"app-version"},Gp=(0,r.defineComponent)({__name:"LeftSidebar",setup(e){const t=(0,a.useRouter)(),o=(0,Jc.useCharacterStore)(),i=(0,A.useUIStore)(),{t:s}=(0,K.s)(),l=(0,r.ref)(!1),c=(0,r.ref)(null),d=(0,r.computed)(()=>l.value?c.value??"同步中":""),u=(0,r.ref)("");let m=null;const p=()=>{const e=new Date,t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0"),i=e.getSeconds().toString().padStart(2,"0");u.value=`${t}-${n}-${a} ${r}:${o}:${i}`};(0,r.onMounted)(async()=>{if(p(),m=window.setInterval(p,1e3),(0,D.isBackendConfigured)()){const e=await(0,D.d9)();e&&(l.value=!0,c.value=e)}}),(0,r.onUnmounted)(()=>{m&&clearInterval(m)});const g=(0,r.computed)(()=>o.activeCharacterProfile),h=(0,r.computed)(()=>"true"===localStorage.getItem("is_admin")),f=async()=>{t.push("/game/save")},v=()=>{t.push("/game/inventory")},b=()=>{t.push("/game/character-details")},y=()=>{t.push("/game/events")},x=()=>{t.push("/game/sect")},k=()=>{t.push("/game/relationships")},w=()=>{t.push("/game/techniques")},E=()=>{t.push("/game/thousand-dao")},N=()=>{t.push("/game/memory")},S=()=>{t.push("/game/world-map")},V=()=>{t.push("/game/prompts")},C=()=>{t.push("/game/settings")},T=()=>{if(!localStorage.getItem("access_token"))return X.o.info(s("请先登录")),void t.push("/login");t.push("/game/api-management")},B=()=>{t.push("/game/game-variables")},I=()=>{t.push("/backend-admin")},z=()=>{i.showRetryDialog({title:s("返回"),message:s("您想如何退出当前游戏？"),confirmText:s("保存并退出"),cancelText:s("取消"),neutralText:s("不保存直接退出"),onConfirm:async()=>{console.log("[返回] 用户选择保存并退出...");try{const{useGameStateStore:e}=await Promise.resolve().then(n.bind(n,1184)),t=e();await t.saveBeforeExit(),X.o.success(s("游戏已保存"))}catch(e){console.error("[返回] 保存游戏失败:",e),X.o.error(s("游戏保存失败，但仍会继续退出。"))}await M()},onNeutral:async()=>{console.log("[返回] 用户选择不保存直接退出..."),X.o.info(s("游戏进度未保存")),await M()},onCancel:()=>{console.log("[返回] 用户取消操作")}})},M=async()=>{console.log("[返回] 准备返回主菜单"),o.rootState.当前激活存档=null,await o.commitMetadataToStorage(),console.log("[返回] 已重置激活存档状态"),i.stopLoading(),await t.push("/"),console.log("[返回] 已跳转至主菜单")};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",pm,[(0,r.createElementVNode)("div",gm,[(0,r.createElementVNode)("h3",hm,[(0,r.createVNode)((0,r.unref)(lm),{size:20,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(s)("游戏功能")),1)]),(0,r.createElementVNode)("div",fm,[(0,r.createVNode)((0,r.unref)(cm),{size:14,class:"time-icon"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(u.value),1)])]),(0,r.createElementVNode)("div",vm,[(0,r.createCommentVNode)(" 角色信息区 "),(0,r.createElementVNode)("div",bm,[(0,r.createElementVNode)("div",ym,(0,r.toDisplayString)((0,r.unref)(s)("角色信息")),1),(0,r.createElementVNode)("div",xm,[(0,r.createElementVNode)("button",{class:"function-btn primary",onClick:b},[(0,r.createElementVNode)("div",km,[(0,r.createVNode)((0,r.unref)(_),{size:18})]),(0,r.createElementVNode)("div",wm,[(0,r.createElementVNode)("span",Em,(0,r.toDisplayString)((0,r.unref)(s)("人物属性")),1),(0,r.createElementVNode)("span",Nm,(0,r.toDisplayString)((0,r.unref)(s)("修为境界状态")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn primary",onClick:v},[(0,r.createElementVNode)("div",Sm,[(0,r.createVNode)((0,r.unref)(gu),{size:18})]),(0,r.createElementVNode)("div",Vm,[(0,r.createElementVNode)("span",_m,(0,r.toDisplayString)((0,r.unref)(s)("背包物品")),1),(0,r.createElementVNode)("span",Cm,(0,r.toDisplayString)((0,r.unref)(s)("管理道具装备")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])])]),(0,r.createCommentVNode)(" 修炼系统区 "),(0,r.createElementVNode)("div",Am,[(0,r.createElementVNode)("div",Dm,(0,r.toDisplayString)((0,r.unref)(s)("修炼系统")),1),(0,r.createElementVNode)("div",Tm,[(0,r.createElementVNode)("button",{class:"function-btn cultivation",onClick:w},[(0,r.createElementVNode)("div",Bm,[(0,r.createVNode)((0,r.unref)(vu.A),{size:18})]),(0,r.createElementVNode)("div",Im,[(0,r.createElementVNode)("span",zm,(0,r.toDisplayString)((0,r.unref)(s)("功法技能")),1),(0,r.createElementVNode)("span",Mm,(0,r.toDisplayString)((0,r.unref)(s)("修炼突破晋级")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn cultivation",onClick:E},[(0,r.createElementVNode)("div",Pm,[(0,r.createVNode)((0,r.unref)(bu),{size:18})]),(0,r.createElementVNode)("div",Rm,[(0,r.createElementVNode)("span",$m,(0,r.toDisplayString)((0,r.unref)(s)("大道感悟")),1),(0,r.createElementVNode)("span",Om,(0,r.toDisplayString)((0,r.unref)(s)("领悟天地法则")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])])]),(0,r.createCommentVNode)(" 事件与探索区 "),(0,r.createElementVNode)("div",Lm,[(0,r.createElementVNode)("div",Fm,(0,r.toDisplayString)((0,r.unref)(s)("事件探索")),1),(0,r.createElementVNode)("div",jm,[(0,r.createElementVNode)("button",{class:"function-btn quest",onClick:y},[(0,r.createElementVNode)("div",Um,[(0,r.createVNode)((0,r.unref)(wu),{size:18})]),(0,r.createElementVNode)("div",qm,[(0,r.createElementVNode)("span",Gm,(0,r.toDisplayString)((0,r.unref)(s)("世界事件")),1),(0,r.createElementVNode)("span",Hm,(0,r.toDisplayString)((0,r.unref)(s)("世界变革与危机")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn quest",onClick:S},[(0,r.createElementVNode)("div",Ym,[(0,r.createVNode)((0,r.unref)(ku),{size:18})]),(0,r.createElementVNode)("div",Wm,[(0,r.createElementVNode)("span",Xm,(0,r.toDisplayString)((0,r.unref)(s)("世界地图")),1),(0,r.createElementVNode)("span",Jm,(0,r.toDisplayString)((0,r.unref)(s)("探索天下各地")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])])]),(0,r.createCommentVNode)(" 社交势力区 "),(0,r.createElementVNode)("div",Km,[(0,r.createElementVNode)("div",Zm,(0,r.toDisplayString)((0,r.unref)(s)("社交势力")),1),(0,r.createElementVNode)("div",Qm,[(0,r.createElementVNode)("button",{class:"function-btn secondary",onClick:k},[(0,r.createElementVNode)("div",ep,[(0,r.createVNode)((0,r.unref)(fu),{size:18})]),(0,r.createElementVNode)("div",tp,[(0,r.createElementVNode)("span",np,(0,r.toDisplayString)((0,r.unref)(s)("人物关系")),1),(0,r.createElementVNode)("span",ap,(0,r.toDisplayString)((0,r.unref)(s)("人脉交际管理")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn secondary",onClick:x},[(0,r.createElementVNode)("div",rp,[(0,r.createVNode)((0,r.unref)(Eu),{size:18})]),(0,r.createElementVNode)("div",op,[(0,r.createElementVNode)("span",ip,(0,r.toDisplayString)((0,r.unref)(s)("宗门")),1),(0,r.createElementVNode)("span",sp,(0,r.toDisplayString)((0,r.unref)(s)("门派事务管理")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn secondary",onClick:N},[(0,r.createElementVNode)("div",lp,[(0,r.createVNode)((0,r.unref)(hu),{size:18})]),(0,r.createElementVNode)("div",cp,[(0,r.createElementVNode)("span",dp,(0,r.toDisplayString)((0,r.unref)(s)("记忆")),1),(0,r.createElementVNode)("span",up,(0,r.toDisplayString)((0,r.unref)(s)("重要事件回顾")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])])]),t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"divider"},null,-1)),(0,r.createCommentVNode)(" 系统功能区 "),(0,r.createElementVNode)("div",mp,[(0,r.createElementVNode)("div",pp,[(0,r.createElementVNode)("button",{class:"function-btn system",onClick:f,disabled:!g.value},[(0,r.createElementVNode)("div",hp,[(0,r.createVNode)((0,r.unref)(xu.A),{size:18})]),(0,r.createElementVNode)("div",fp,[(0,r.createElementVNode)("span",vp,(0,r.toDisplayString)((0,r.unref)(s)("保存游戏")),1),(0,r.createElementVNode)("span",bp,(0,r.toDisplayString)((0,r.unref)(s)("保存当前进度")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})],8,gp),e.isOnlineMode?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"function-btn system",onClick:B},[(0,r.createElementVNode)("div",yp,[(0,r.createVNode)((0,r.unref)(Su),{size:18})]),(0,r.createElementVNode)("div",xp,[(0,r.createElementVNode)("span",kp,(0,r.toDisplayString)((0,r.unref)(s)("游戏变量")),1),(0,r.createElementVNode)("span",wp,(0,r.toDisplayString)((0,r.unref)(s)("查看游戏数据")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])),(0,r.createElementVNode)("button",{class:"function-btn system",onClick:V},[(0,r.createElementVNode)("div",Ep,[(0,r.createVNode)((0,r.unref)(Vu),{size:18})]),(0,r.createElementVNode)("div",Np,[(0,r.createElementVNode)("span",Sp,(0,r.toDisplayString)((0,r.unref)(s)("提示词管理")),1),(0,r.createElementVNode)("span",Vp,(0,r.toDisplayString)((0,r.unref)(s)("自定义提示词")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn system",onClick:T},[(0,r.createElementVNode)("div",_p,[(0,r.createVNode)((0,r.unref)(_u.A),{size:18})]),(0,r.createElementVNode)("div",Cp,[(0,r.createElementVNode)("span",Ap,(0,r.toDisplayString)((0,r.unref)(s)("API管理")),1),(0,r.createElementVNode)("span",Dp,(0,r.toDisplayString)((0,r.unref)(s)("多API配置")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),(0,r.createElementVNode)("button",{class:"function-btn system",onClick:C},[(0,r.createElementVNode)("div",Tp,[(0,r.createVNode)((0,r.unref)(Wn.A),{size:18})]),(0,r.createElementVNode)("div",Bp,[(0,r.createElementVNode)("span",Ip,(0,r.toDisplayString)((0,r.unref)(s)("系统设置")),1),(0,r.createElementVNode)("span",zp,(0,r.toDisplayString)((0,r.unref)(s)("偏好设置")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})]),h.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"function-btn admin",onClick:I},[(0,r.createElementVNode)("div",Mp,[(0,r.createVNode)((0,r.unref)(um.A),{size:18})]),(0,r.createElementVNode)("div",Pp,[(0,r.createElementVNode)("span",Rp,(0,r.toDisplayString)((0,r.unref)(s)("管理员后台")),1),(0,r.createElementVNode)("span",$p,(0,r.toDisplayString)((0,r.unref)(s)("管理员控制台")),1)]),(0,r.createVNode)((0,r.unref)(dm),{size:14,class:"btn-arrow"})])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{class:"function-btn exit-btn no-arrow",onClick:z},[(0,r.createElementVNode)("div",Op,[(0,r.createVNode)((0,r.unref)(mm),{size:18})]),(0,r.createElementVNode)("div",Lp,[(0,r.createElementVNode)("span",Fp,(0,r.toDisplayString)((0,r.unref)(s)("返回")),1),(0,r.createElementVNode)("span",jp,(0,r.toDisplayString)((0,r.unref)(s)("退出当前游戏")),1)])])])])]),(0,r.createCommentVNode)(" 版本号显示 "),(0,r.createElementVNode)("div",Up,[(0,r.createElementVNode)("span",qp,"V"+(0,r.toDisplayString)(d.value),1)])]))}});var Hp=n(1459),Yp={};Yp.styleTagTransform=k(),Yp.setAttributes=v(),Yp.insert=h().bind(null,"head"),Yp.domAPI=p(),Yp.insertStyleElement=y(),u()(Hp.A,Yp),Hp.A&&Hp.A.locals&&Hp.A.locals;const Wp=(0,N.A)(Gp,[["__scopeId","data-v-ee6620be"]]),Xp=(0,V.A)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),Jp=(0,V.A)("droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),Kp=(0,V.A)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),Zp=(0,V.A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var Qp=n(8275);const eg={class:"status-detail-card"},tg={class:"type-icon"},ng={class:"type-text"},ag={class:"card-body"},rg={class:"details-grid"},og={key:0,class:"detail-item"},ig={class:"item-value source"},sg={key:1,class:"detail-item"},lg={class:"item-value strength"},cg={class:"strength-value"},dg={class:"strength-bar"},ug={key:2,class:"detail-item"},mg={class:"item-value duration"},pg={key:3,class:"detail-item"},gg={class:"item-value time"},hg=(0,r.defineComponent)({__name:"StatusDetailCard",props:{effect:{}},setup(e){const t=e,n=(0,r.computed)(()=>"buff"===String(t.effect.类型).toLowerCase()),a=(0,r.computed)(()=>{const e=t.effect.强度||0;return e>=80?"极强":e>=60?"强":e>=40?"中等":e>=20?"一般":"轻微"}),o=(0,r.computed)(()=>{const e=t.effect.强度||0;return e>=80?"#ef4444":e>=60?"#f59e0b":e>=40?"#3b82f6":e>=20?"#10b981":"#6b7280"}),i=(0,r.computed)(()=>{const e=t.effect.持续时间分钟;if(null==e)return"";if(99999===e)return"永久";if(e>=1440)return`${Math.floor(e/1440)}天`;if(e>=60){const t=Math.floor(e/60),n=e%60;return n>0?`${t}时${n}分`:`${t}时`}return`${e}分钟`});return(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",eg,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["card-header",n.value?"buff":"debuff"])},[(0,r.createElementVNode)("span",tg,(0,r.toDisplayString)(n.value?"+":"-"),1),(0,r.createElementVNode)("span",ng,(0,r.toDisplayString)(n.value?"增益状态":"负面状态"),1)],2),(0,r.createElementVNode)("div",ag,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["description",n.value?"buff-border":"debuff-border"])},(0,r.toDisplayString)(e.effect.状态描述||`${e.effect.状态名称}状态生效中`),3),(0,r.createElementVNode)("div",rg,[e.effect.来源?((0,r.openBlock)(),(0,r.createElementBlock)("div",og,[t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"item-label"},"来源",-1)),(0,r.createElementVNode)("div",ig,(0,r.toDisplayString)(e.effect.来源),1)])):(0,r.createCommentVNode)("v-if",!0),e.effect.强度?((0,r.openBlock)(),(0,r.createElementBlock)("div",sg,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"item-label"},"效果强度",-1)),(0,r.createElementVNode)("div",lg,[(0,r.createElementVNode)("span",{class:"strength-text",style:(0,r.normalizeStyle)({color:o.value})},(0,r.toDisplayString)(a.value),5),(0,r.createElementVNode)("span",cg,"("+(0,r.toDisplayString)(e.effect.强度)+"/100)",1)]),(0,r.createElementVNode)("div",dg,[(0,r.createElementVNode)("div",{class:"bar-fill",style:(0,r.normalizeStyle)({width:`${Math.min(e.effect.强度,100)}%`,backgroundColor:o.value})},null,4)])])):(0,r.createCommentVNode)("v-if",!0),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ug,[t[2]||(t[2]=(0,r.createElementVNode)("div",{class:"item-label"},"持续时间",-1)),(0,r.createElementVNode)("div",mg,(0,r.toDisplayString)(i.value),1)])):(0,r.createCommentVNode)("v-if",!0),e.effect.生成时间?((0,r.openBlock)(),(0,r.createElementBlock)("div",pg,[t[3]||(t[3]=(0,r.createElementVNode)("div",{class:"item-label"},"生成时间",-1)),(0,r.createElementVNode)("div",gg,(0,r.toDisplayString)((s=e.effect.生成时间,s?`${s.年}年${s.月}月${s.日}日 ${String(s.小时).padStart(2,"0")}:${String(s.分钟).padStart(2,"0")}`:"")),1)])):(0,r.createCommentVNode)("v-if",!0)])])]);var s}}});var fg=n(7807),vg={};vg.styleTagTransform=k(),vg.setAttributes=v(),vg.insert=h().bind(null,"head"),vg.domAPI=p(),vg.insertStyleElement=y(),u()(fg.A,vg),fg.A&&fg.A.locals&&fg.A.locals;const bg=(0,N.A)(hg,[["__scopeId","data-v-627cf7f9"]]);var yg=n(6939);const xg={class:"right-sidebar"},kg={class:"sidebar-header"},wg={class:"sidebar-title"},Eg={key:0,class:"sidebar-content"},Ng={class:"vitals-section"},Sg={class:"section-title"},Vg={class:"vitals-list"},_g={class:"vital-item"},Cg={class:"vital-info"},Ag={class:"vital-name"},Dg={class:"vital-text"},Tg={class:"progress-bar"},Bg={class:"vital-item"},Ig={class:"vital-info"},zg={class:"vital-name"},Mg={class:"vital-text"},Pg={class:"progress-bar"},Rg={class:"vital-item"},$g={class:"vital-info"},Og={class:"vital-name"},Lg={class:"vital-text"},Fg={class:"progress-bar"},jg={class:"vital-item"},Ug={class:"vital-info"},qg={class:"vital-name"},Gg={class:"vital-text"},Hg={class:"progress-bar"},Yg={class:"cultivation-section"},Wg={class:"section-title"},Xg={class:"realm-display"},Jg={class:"realm-info"},Kg={class:"realm-name"},Zg={key:0,class:"realm-breakthrough"},Qg={key:0,class:"realm-mortal"},eh={class:"mortal-text"},th={class:"realm-progress"},nh={class:"progress-bar"},ah={key:0,class:"breakthrough-hint"},rh={key:1,class:"sprint-hint"},oh={class:"reputation-display"},ih={class:"reputation-item"},sh={class:"reputation-info"},lh={class:"reputation-label"},ch={class:"collapsible-section talents-section"},dh={class:"section-title"},uh={class:"talents-list"},mh=["onClick"],ph={class:"talent-header"},gh={class:"talent-name"},hh={key:0,class:"empty-talents"},fh={class:"empty-text"},vh={class:"collapsible-section status-section"},bh={class:"section-title"},yh={class:"status-effects"},xh={key:0,class:"empty-status"},kh={class:"empty-text"},wh={key:1,class:"status-tags-container"},Eh=["onClick","title"],Nh={class:"tag-icon"},Sh={class:"tag-name"},Vh={key:0,class:"tag-intensity"},_h={key:1,class:"tag-time"},Ch={class:"no-character"},Ah={class:"no-char-text"},Dh=(0,r.defineComponent)({__name:"RightSidebar",setup(e){const{t}=(0,K.s)(),n=(0,pu.useGameStateStore)(),a=(0,A.useUIStore)(),o=(0,r.computed)(()=>n.isGameLoaded&&!!n.character),i=(0,r.computed)(()=>n.character),s=(0,r.computed)(()=>n.attributes),l=(0,r.computed)(()=>(n.effects||[]).filter(e=>null!=e&&"object"==typeof e&&"状态名称"in e)),c=(0,r.computed)(()=>{const e=i.value?.出生日期,t=n.gameTime;return e&&t?(0,yg.R5)(e,t):n.attributes?.寿命?.当前||0}),d=(0,r.ref)(!1),u=(0,r.ref)(!1),m=e=>{if(!e||"未指定"===e)return"";if("永久"===e)return"永久";if(/^\d+$/.test(e)){const t=parseInt(e);if(t>=60){const e=Math.floor(t/60),n=t%60;return n>0?`${e}时${n}分`:`${e}时`}return`${t}分钟`}return e},p=(0,r.computed)(()=>{if(!n.attributes?.境界)return 0;const e=n.attributes.境界.当前进度,t=n.attributes.境界.下一级所需;return e&&t?Math.round(e/t*100):0}),g=()=>{const e=p.value;return e>=100?"realm-breakthrough":e>=90?"realm-sprint":""},h=e=>{if(!n.attributes)return 0;const t=n.attributes[e];return t?.当前&&t?.上限?Math.round(t.当前/t.上限*100):0},f=()=>{const e=n.attributes?.寿命?.上限;return e?Math.round(c.value/e*100):0},v=e=>{const t=s.value?.境界?.当前进度,n=s.value?.境界?.下一级所需,a=s.value?.境界?.阶段;return Fu({name:e,阶段:a,progress:t,maxProgress:n})},b=()=>{const e=s.value?.声望;if(null==e)return"籍籍无名";const t=Number(e);return t<0?t<=-5e3?`恶名昭彰 (${t})`:t<=-1e3?`臭名远扬 (${t})`:t<=-500?`声名狼藉 (${t})`:t<=-100?`恶名在外 (${t})`:`小有恶名 (${t})`:t>=1e4?`传说人物 (${t})`:t>=5e3?`名满天下 (${t})`:t>=3e3?`威震四方 (${t})`:t>=1e3?`名动一方 (${t})`:t>=500?`声名远播 (${t})`:t>=100?`小有名气 (${t})`:"籍籍无名"},y=()=>{const e=s.value?.声望;if(null==e)return"reputation-neutral";const t=Number(e);return t<0?t<=-5e3?"reputation-evil-legendary":t<=-1e3?"reputation-evil-high":t<=-500?"reputation-evil-medium":t<=-100?"reputation-evil-low":"reputation-evil-minor":t>=1e4?"reputation-legendary":t>=5e3?"reputation-famous":t>=3e3?"reputation-renowned":t>=1e3?"reputation-notable":t>=500?"reputation-known":t>=100?"reputation-minor":"reputation-neutral"};return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",xg,[(0,r.createElementVNode)("div",kg,[(0,r.createElementVNode)("h3",wg,[(0,r.createVNode)((0,r.unref)(_),{size:18,class:"title-icon"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("角色状态")),1)])]),o.value&&i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Eg,[(0,r.createCommentVNode)(" 核心数值 "),(0,r.createElementVNode)("div",Ng,[(0,r.createElementVNode)("h3",Sg,[(0,r.createVNode)((0,r.unref)(Xp),{size:14,class:"section-icon"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("核心数值")),1)]),(0,r.createElementVNode)("div",Vg,[(0,r.createElementVNode)("div",_g,[(0,r.createElementVNode)("div",Cg,[(0,r.createElementVNode)("span",Ag,[(0,r.createVNode)((0,r.unref)(Jp),{size:12,class:"vital-icon blood"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("气血")),1)]),(0,r.createElementVNode)("span",Dg,(0,r.toDisplayString)(s.value?.气血?.当前)+" / "+(0,r.toDisplayString)(s.value?.气血?.上限),1)]),(0,r.createElementVNode)("div",Tg,[(0,r.createElementVNode)("div",{class:"progress-fill health",style:(0,r.normalizeStyle)({width:h("气血")+"%"})},null,4)])]),(0,r.createElementVNode)("div",Bg,[(0,r.createElementVNode)("div",Ig,[(0,r.createElementVNode)("span",zg,[(0,r.createVNode)((0,r.unref)(Kp),{size:12,class:"vital-icon mana"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("灵气")),1)]),(0,r.createElementVNode)("span",Mg,(0,r.toDisplayString)(s.value?.灵气?.当前)+" / "+(0,r.toDisplayString)(s.value?.灵气?.上限),1)]),(0,r.createElementVNode)("div",Pg,[(0,r.createElementVNode)("div",{class:"progress-fill mana",style:(0,r.normalizeStyle)({width:h("灵气")+"%"})},null,4)])]),(0,r.createElementVNode)("div",Rg,[(0,r.createElementVNode)("div",$g,[(0,r.createElementVNode)("span",Og,[(0,r.createVNode)((0,r.unref)(hu),{size:12,class:"vital-icon spirit"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("神识")),1)]),(0,r.createElementVNode)("span",Lg,(0,r.toDisplayString)(s.value?.神识?.当前)+" / "+(0,r.toDisplayString)(s.value?.神识?.上限),1)]),(0,r.createElementVNode)("div",Fg,[(0,r.createElementVNode)("div",{class:"progress-fill spirit",style:(0,r.normalizeStyle)({width:h("神识")+"%"})},null,4)])]),(0,r.createElementVNode)("div",jg,[(0,r.createElementVNode)("div",Ug,[(0,r.createElementVNode)("span",qg,[(0,r.createVNode)((0,r.unref)(cm),{size:12,class:"vital-icon lifespan"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("寿元")),1)]),(0,r.createElementVNode)("span",Gg,(0,r.toDisplayString)(c.value)+" / "+(0,r.toDisplayString)(s.value?.寿命?.上限),1)]),(0,r.createElementVNode)("div",Hg,[(0,r.createElementVNode)("div",{class:"progress-fill lifespan",style:(0,r.normalizeStyle)({width:f()+"%"})},null,4)])])])]),(0,r.createCommentVNode)(" 境界状态 "),(0,r.createElementVNode)("div",Yg,[(0,r.createElementVNode)("h3",Wg,[(0,r.createVNode)((0,r.unref)(Zp),{size:14,class:"section-icon"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("境界状态")),1)]),(0,r.createElementVNode)("div",Xg,[(0,r.createElementVNode)("div",Jg,[(0,r.createElementVNode)("span",Kg,(0,r.toDisplayString)(v(s.value?.境界?.名称)),1),s.value?.境界?.突破描述?((0,r.openBlock)(),(0,r.createElementBlock)("span",Zg,(0,r.toDisplayString)(s.value?.境界?.突破描述),1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 凡人境界显示等待引气入体 "),"凡人"===s.value?.境界?.名称?((0,r.openBlock)(),(0,r.createElementBlock)("div",Qg,[(0,r.createElementVNode)("span",eh,(0,r.toDisplayString)((0,r.unref)(t)("等待仙缘，引气入体")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 修炼境界显示进度条 "),(0,r.createElementVNode)("div",th,[(0,r.createElementVNode)("div",nh,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["progress-fill cultivation",g()]),style:(0,r.normalizeStyle)({width:p.value+"%"})},null,6)]),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["progress-text",g()])},[(0,r.createTextVNode)((0,r.toDisplayString)(p.value)+"% ",1),p.value>=100?((0,r.openBlock)(),(0,r.createElementBlock)("span",ah,"可突破!")):p.value>=90?((0,r.openBlock)(),(0,r.createElementBlock)("span",rh,"可冲刺")):(0,r.createCommentVNode)("v-if",!0)],2)])],2112))]),(0,r.createCommentVNode)(" 声望显示 "),(0,r.createElementVNode)("div",oh,[(0,r.createElementVNode)("div",ih,[(0,r.createElementVNode)("div",sh,[(0,r.createElementVNode)("span",lh,[(0,r.createVNode)((0,r.unref)(Zp),{size:12,class:"vital-icon reputation"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("声望")),1)]),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["reputation-value",y()])},(0,r.toDisplayString)(b()),3)])])])]),(0,r.createCommentVNode)(" 天赋神通 "),(0,r.createElementVNode)("div",ch,[(0,r.createElementVNode)("div",{class:"section-header",onClick:n[0]||(n[0]=e=>d.value=!d.value)},[(0,r.createElementVNode)("h3",dh,[(0,r.createVNode)((0,r.unref)(Zp),{size:14,class:"section-icon gold"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("天赋神通")),1)]),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["collapse-toggle",{collapsed:d.value}])},n[2]||(n[2]=[(0,r.createElementVNode)("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"currentColor"},[(0,r.createElementVNode)("path",{d:"M8 10l4-4H4l4 4z"})],-1)]),2)]),(0,r.withDirectives)((0,r.createElementVNode)("div",uh,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value.天赋,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:"string"==typeof e?e:e.name,class:"talent-card clickable",onClick:t=>(e=>{const t=i.value,n=t?.天赋?.find(t=>t.name===e),r=le.qS.find(t=>t.name===e),o=(n?{description:n.description||"自定义天赋"}:r?{description:r.description||""}:{description:`天赋《${e}》的详细描述暂未开放，请期待后续更新。`}).description;a.showDetailModal({title:e,content:o})})("string"==typeof e?e:e.name)},[(0,r.createElementVNode)("div",ph,[(0,r.createElementVNode)("span",gh,(0,r.toDisplayString)("string"==typeof e?e:e.name),1)])],8,mh))),128)),(0,r.createCommentVNode)(" 空状态显示 "),i.value.天赋&&0!==i.value.天赋.length?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",hh,[(0,r.createElementVNode)("div",fh,(0,r.toDisplayString)((0,r.unref)(t)("暂无天赋神通")),1)]))],512),[[r.vShow,!d.value]])]),(0,r.createCommentVNode)(" 状态效果 "),(0,r.createElementVNode)("div",vh,[(0,r.createElementVNode)("div",{class:"section-header",onClick:n[1]||(n[1]=e=>u.value=!u.value)},[(0,r.createElementVNode)("h3",bh,[(0,r.createVNode)((0,r.unref)(bu),{size:14,class:"section-icon"}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("状态效果")),1)]),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["collapse-toggle",{collapsed:u.value}])},n[3]||(n[3]=[(0,r.createElementVNode)("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"currentColor"},[(0,r.createElementVNode)("path",{d:"M8 10l4-4H4l4 4z"})],-1)]),2)]),(0,r.withDirectives)((0,r.createElementVNode)("div",yh,[0===l.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",xh,[(0,r.createElementVNode)("span",kh,(0,r.toDisplayString)((0,r.unref)(t)("清净无为")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",wh,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.状态名称||`effect-${n}`,class:(0,r.normalizeClass)(["status-tag clickable",["buff"===String(e.类型||"").toLowerCase()?"buff":"debuff"]]),onClick:t=>(e=>{e&&e.状态名称?a.showDetailModal({title:e.状态名称,component:bg,props:{effect:e}}):console.warn("[RightSidebar] 状态效果数据异常，无法显示详情",e)})(e),title:`${e.状态名称||"未知状态"}${e.状态描述?`\n${e.状态描述}`:""}${e.强度?`\n强度: ${e.强度}`:""}${m(e.时间)?`\n${m(e.时间)}`:""}`},[(0,r.createElementVNode)("span",Nh,(0,r.toDisplayString)("buff"===String(e.类型||"").toLowerCase()?(0,r.unref)(t)("增"):(0,r.unref)(t)("减")),1),(0,r.createElementVNode)("span",Sh,(0,r.toDisplayString)(e.状态名称||"未知状态"),1),e.强度?((0,r.openBlock)(),(0,r.createElementBlock)("span",Vh,(0,r.toDisplayString)(e.强度),1)):(0,r.createCommentVNode)("v-if",!0),m(e.时间)?((0,r.openBlock)(),(0,r.createElementBlock)("span",_h,(0,r.toDisplayString)(m(e.时间)),1)):(0,r.createCommentVNode)("v-if",!0)],10,Eh))),128))]))],512),[[r.vShow,!u.value]])])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 无角色数据 "),(0,r.createElementVNode)("div",Ch,[(0,r.createElementVNode)("div",Ah,(0,r.toDisplayString)((0,r.unref)(t)("请选择角色开启修仙之旅")),1)])],2112)),(0,r.createCommentVNode)(" 详情模态框 "),(0,r.createVNode)(Qp.A)]))}});var Th=n(805),Bh={};Bh.styleTagTransform=k(),Bh.setAttributes=v(),Bh.insert=h().bind(null,"head"),Bh.domAPI=p(),Bh.insertStyleElement=y(),u()(Th.A,Bh),Th.A&&Th.A.locals&&Th.A.locals;const Ih=(0,N.A)(Dh,[["__scopeId","data-v-6b21266e"]]),zh={class:"hexagon-chart-container"},Mh=["width","height","viewBox"],Ph=["transform"],Rh=["points"],$h=["x2","y2"],Oh=["points"],Lh=["cx","cy"],Fh=["x","y","text-anchor","dominant-baseline"],jh=["x","y","text-anchor","dominant-baseline"],Uh=(0,r.defineComponent)({__name:"HexagonChart",props:{stats:{},size:{default:160},maxValue:{default:10}},setup(e){const{t}=(0,K.s)(),n=e,a=(0,r.computed)(()=>n.size/2),o=(0,r.computed)(()=>n.size/2*.7),i=["root_bone","spirituality","comprehension","fortune","charm","temperament"],s={root_bone:t("根骨"),spirituality:t("灵性"),comprehension:t("悟性"),fortune:t("气运"),charm:t("魅力"),temperament:t("心性")},l=(e=1)=>{const t=[];for(let n=0;n<6;n++){const a=Math.PI/2+Math.PI/3*n,r=Math.cos(a)*o.value*e,i=-Math.sin(a)*o.value*e;t.push(`${r.toFixed(2)},${i.toFixed(2)}`)}return t.join(" ")},c=(0,r.computed)(()=>i.map((e,t)=>{const a=n.stats[e]??0,r=Math.max(0,Math.min(1,a/n.maxValue)),i=Math.PI/2+Math.PI/3*t,s=o.value*r+(0===r?4:0);return{value:a,x:Math.cos(i)*s,y:-Math.sin(i)*s}})),d=(0,r.computed)(()=>{const e=[];return i.forEach((t,a)=>{const r=n.stats[t]??0,i=Math.max(0,Math.min(1,r/n.maxValue)),s=Math.PI/2+Math.PI/3*a,l=Math.cos(s)*o.value*i,c=-Math.sin(s)*o.value*i;e.push(`${l.toFixed(2)},${c.toFixed(2)}`)}),e.join(" ")}),u=(0,r.computed)(()=>{const e=[];for(let t=0;t<6;t++){const n=Math.PI/2+Math.PI/3*t;e.push({x:Math.cos(n)*o.value,y:-Math.sin(n)*o.value})}return e}),m=(0,r.computed)(()=>{const e=1.25*o.value;return i.map((t,n)=>{const a=Math.PI/2+Math.PI/3*n;return{key:t,name:s[t],x:Math.cos(a)*e,y:-Math.sin(a)*e}})}),p=(e,t=!1)=>0===e||3===e?"middle":1===e||2===e?t?"end":"start":t?"start":"end",g=(e,t=!1)=>0===e?t?"hanging":"alphabetic":3===e?t?"alphabetic":"hanging":"middle";return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",zh,[((0,r.openBlock)(),(0,r.createElementBlock)("svg",{width:e.size,height:e.size,viewBox:`0 0 ${e.size} ${e.size}`},[(0,r.createCommentVNode)(" 定义渐变 "),t[0]||(t[0]=(0,r.createStaticVNode)('<defs data-v-a8caf924><linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-a8caf924><stop offset="0%" stop-color="rgba(255, 215, 0, 0.3)" data-v-a8caf924></stop><stop offset="50%" stop-color="rgba(218, 165, 32, 0.25)" data-v-a8caf924></stop><stop offset="100%" stop-color="rgba(255, 223, 0, 0.2)" data-v-a8caf924></stop></linearGradient><linearGradient id="darkGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-a8caf924><stop offset="0%" stop-color="rgba(100, 181, 246, 0.3)" data-v-a8caf924></stop><stop offset="100%" stop-color="rgba(100, 181, 246, 0.1)" data-v-a8caf924></stop></linearGradient></defs>',1)),(0,r.createElementVNode)("g",{transform:`translate(${a.value}, ${a.value})`},[(0,r.createCommentVNode)(" Hexagon Grid Lines "),((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(5,e=>(0,r.createElementVNode)("polygon",{key:`grid-${e}`,points:l(e/5),class:"grid-line"},null,8,Rh)),64)),(0,r.createCommentVNode)(" Radial Lines "),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("line",{key:`axis-${t}`,x1:"0",y1:"0",x2:e.x,y2:e.y,class:"grid-line"},null,8,$h))),128)),(0,r.createCommentVNode)(" Data Polygon "),(0,r.createElementVNode)("polygon",{points:d.value,class:"data-polygon"},null,8,Oh),(0,r.createCommentVNode)(" Data Points & Numeric Values "),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(c.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("g",{key:`data-point-${t}`},[(0,r.createElementVNode)("circle",{cx:e.x,cy:e.y,r:"3",class:"data-point"},null,8,Lh),(0,r.createElementVNode)("text",{x:e.x,y:e.y,class:"data-value-text","text-anchor":p(t,!0),"dominant-baseline":g(t,!0)},(0,r.toDisplayString)(e.value),9,Fh)]))),128)),(0,r.createCommentVNode)(" Stat Labels "),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("text",{key:e.key,x:e.x,y:e.y,class:"label-text","text-anchor":p(t),"dominant-baseline":g(t)},(0,r.toDisplayString)(e.name),9,jh))),128))],8,Ph)],8,Mh))]))}});var qh=n(5794),Gh={};Gh.styleTagTransform=k(),Gh.setAttributes=v(),Gh.insert=h().bind(null,"head"),Gh.domAPI=p(),Gh.insertStyleElement=y(),u()(qh.A,Gh),qh.A&&qh.A.locals&&qh.A.locals;const Hh=(0,N.A)(Uh,[["__scopeId","data-v-a8caf924"]]),Yh=(0,V.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var Wh=n(5365);const Xh=(0,V.A)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]);var Jh=n(3528);const Kh=(0,V.A)("arrow-down-to-line",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]),Zh={class:"legacy-modal"},Qh={class:"legacy-modal-header"},ef={class:"title"},tf={class:"legacy-modal-body"},nf={class:"file-row"},af={key:0,class:"file-name"},rf={key:1,class:"file-name muted"},of={key:0,class:"result"},sf={class:"summary-grid"},lf={class:"kv"},cf={class:"v"},df={class:"kv"},uf={class:"v"},mf={class:"kv"},pf={class:"v"},gf={class:"kv"},hf={class:"v"},ff={key:0,class:"details"},vf={class:"chips"},bf={key:1,class:"details"},yf={class:"errors"},xf={class:"details"},kf={class:"json-preview"},wf={class:"legacy-modal-actions"},Ef=["disabled"],Nf=["disabled"],Sf=(0,r.defineComponent)({__name:"LegacySaveMigrationModal",props:{open:{type:Boolean},targetCharId:{},targetCharName:{}},emits:["close","imported"],setup(e,{emit:t}){const n=e,a=t,o=(0,Jc.useCharacterStore)(),i=(0,r.ref)(null),s=(0,r.ref)(""),l=(0,r.ref)(null),c=(0,r.ref)(null),d=(0,r.ref)(null),u=(0,r.computed)(()=>{if(!c.value)return null;const e=(0,Kc.ZT)(c.value);return e.isBundle?{schema:"dad.bundle",type:e.type}:c.value}),m=(0,r.computed)(()=>{if(!n.targetCharId)return!1;const e=o.rootState.角色列表?.[n.targetCharId];return!(!e||"单机"!==e.模式)&&Array.isArray(d.value)&&d.value.length>0}),p=()=>{i.value?.click()},g=async e=>{const t=e.target.files?.[0];if(t)try{s.value=t.name,l.value=null,c.value=null,d.value=null;const e=await t.text();(e=>{const t=[],n=new Set;let a=0,r=0;const o=(new Date).toISOString(),i=e.saves.map((e,i)=>{const s=e?.存档数据??e,l=(0,Zc.WI)(s);l.needsMigration&&a++,l.legacyKeysFound.forEach(e=>n.add(e));const c=(0,Zc.ru)(s)?s:(0,Zc.jj)(s).migrated,d=(0,Qc.$)(c);d.isValid||(r++,t.push(`第 ${i+1} 个存档「${e?.存档名??"未命名"}」校验失败：${d.errors[0]||"未知原因"}`));const u=String(e?.存档名??`导入存档_${i+1}`);return{...e,存档名:u,保存时间:e?.保存时间??o,最后保存时间:e?.最后保存时间??e?.保存时间??o,存档数据:c}});l.value={typeLabel:e.label,totalSaves:e.saves.length,needsMigration:a,invalidSaves:r,legacyKeys:Array.from(n).sort((e,t)=>e.localeCompare(t,"zh")),errors:t},d.value=i,"character"===e.exportType?c.value=(0,Kc.q3)("character",{...e.exportPayloadBase||{},存档列表:i},{exportedAt:o}):c.value=(0,Kc.q3)("saves",{...e.exportPayloadBase||{},saves:i},{exportedAt:o})})((e=>{const t=(0,Kc.ZT)(e);if("saves"===t.type&&Array.isArray(t.payload?.saves))return{label:"存档包",exportType:"saves",exportPayloadBase:{...t.payload||{}},saves:t.payload.saves};if("character"===t.type&&Array.isArray(t.payload?.存档列表))return{label:"角色包",exportType:"character",exportPayloadBase:{...t.payload||{}},saves:t.payload.存档列表};if(e&&"object"==typeof e&&e.存档数据)return{label:"单个存档",exportType:"saves",exportPayloadBase:{},saves:[e]};if(e&&"object"==typeof e&&((0,Zc.WI)(e).needsMigration||(0,Zc.ru)(e)))return{label:"存档数据",exportType:"saves",exportPayloadBase:{},saves:[{存档名:"转换存档",存档数据:e}]};throw new Error("无法识别文件类型：请使用本游戏导出的存档/角色文件，或直接选择存档数据 JSON")})(JSON.parse(e)));const n=l.value;n&&n.errors.length?X.o.error("检测到转换/校验问题，请先处理后再导入"):n&&(n.needsMigration??0)>0?X.o.success("旧存档已转换为当前格式（未写入本地，需手动下载/导入）"):X.o.info("文件已是当前格式（可直接下载或导入）")}catch(e){const t=e instanceof Error?e.message:"未知错误";l.value={typeLabel:"未知",totalSaves:0,needsMigration:0,invalidSaves:0,legacyKeys:[],errors:[t]},X.o.error(`读取/解析失败：${t}`)}finally{i.value&&(i.value.value="")}},h=()=>{if(!c.value)return;const e=new Blob([JSON.stringify(c.value,null,2)],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e);const n=(new Date).toISOString().split("T")[0];t.download=`超凡新生-旧存档转化-${n}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href),X.o.success("已下载转换后的文件")},f=async()=>{if(!n.targetCharId)return;if(!d.value?.length)return;const e=n.targetCharName||n.targetCharId;try{for(const e of d.value)await o.importSave(n.targetCharId,e);X.o.success(`已导入 ${d.value.length} 个存档到角色「${e}」`),a("imported",d.value.length)}catch(e){X.o.error(`导入失败：${e instanceof Error?e.message:"未知错误"}`)}};return(e,t)=>e.open?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"legacy-modal-overlay",onClick:t[2]||(t[2]=(0,r.withModifiers)(e=>a("close"),["self"]))},[(0,r.createElementVNode)("div",Zh,[(0,r.createElementVNode)("div",Qh,[(0,r.createElementVNode)("div",ef,[(0,r.createVNode)((0,r.unref)(Xh),{size:18}),t[3]||(t[3]=(0,r.createElementVNode)("span",null,"旧存档转化",-1))]),(0,r.createElementVNode)("button",{class:"icon-btn",onClick:t[0]||(t[0]=e=>a("close")),title:"关闭"},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:18})])]),(0,r.createElementVNode)("div",tf,[t[12]||(t[12]=(0,r.createElementVNode)("p",{class:"hint"}," 选择旧存档/旧导出文件后，会先检测并转换为当前格式，再进行校验。你可以下载转换后的文件，或导入到当前选中单机角色。 ",-1)),(0,r.createElementVNode)("div",nf,[(0,r.createElementVNode)("button",{class:"btn",onClick:p},[(0,r.createVNode)((0,r.unref)(Wh.A),{size:16}),t[4]||(t[4]=(0,r.createTextVNode)(" 选择 JSON 文件 ",-1))]),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",af,(0,r.toDisplayString)(s.value),1)):((0,r.openBlock)(),(0,r.createElementBlock)("span",rf,"未选择文件"))]),l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",of,[(0,r.createElementVNode)("div",sf,[(0,r.createElementVNode)("div",lf,[t[5]||(t[5]=(0,r.createElementVNode)("span",{class:"k"},"识别类型",-1)),(0,r.createElementVNode)("span",cf,(0,r.toDisplayString)(l.value.typeLabel),1)]),(0,r.createElementVNode)("div",df,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"k"},"存档数量",-1)),(0,r.createElementVNode)("span",uf,(0,r.toDisplayString)(l.value.totalSaves),1)]),(0,r.createElementVNode)("div",mf,[t[7]||(t[7]=(0,r.createElementVNode)("span",{class:"k"},"需要转换",-1)),(0,r.createElementVNode)("span",pf,(0,r.toDisplayString)(l.value.needsMigration),1)]),(0,r.createElementVNode)("div",gf,[t[8]||(t[8]=(0,r.createElementVNode)("span",{class:"k"},"校验失败",-1)),(0,r.createElementVNode)("span",hf,(0,r.toDisplayString)(l.value.invalidSaves),1)])]),l.value.legacyKeys.length?((0,r.openBlock)(),(0,r.createElementBlock)("details",ff,[t[9]||(t[9]=(0,r.createElementVNode)("summary",null,"检测到的旧 key（合并展示）",-1)),(0,r.createElementVNode)("div",vf,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.legacyKeys,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"chip"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0),l.value.errors.length?((0,r.openBlock)(),(0,r.createElementBlock)("details",bf,[t[10]||(t[10]=(0,r.createElementVNode)("summary",null,"转换/校验问题",-1)),(0,r.createElementVNode)("ul",yf,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.errors,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("li",{key:t},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("details",xf,[t[11]||(t[11]=(0,r.createElementVNode)("summary",null,"转换后的导出结构",-1)),(0,r.createElementVNode)("pre",kf,(0,r.toDisplayString)(JSON.stringify(u.value,null,2)),1)])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",wf,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=e=>a("close"))},"关闭"),(0,r.createElementVNode)("button",{class:"btn",disabled:!c.value||!!l.value?.errors.length,onClick:h},[(0,r.createVNode)((0,r.unref)(Jh.A),{size:16}),t[13]||(t[13]=(0,r.createTextVNode)(" 转换并下载 ",-1))],8,Ef),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"btn",disabled:!d.value||!!l.value?.errors.length,onClick:f},[(0,r.createVNode)((0,r.unref)(Kh),{size:16}),t[14]||(t[14]=(0,r.createTextVNode)(" 导入到当前角色 ",-1))],8,Nf)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("input",{ref_key:"fileInput",ref:i,type:"file",accept:".json,application/json",hidden:"",onChange:g},null,544)])])):(0,r.createCommentVNode)("v-if",!0)}});var Vf=n(9716),_f={};_f.styleTagTransform=k(),_f.setAttributes=v(),_f.insert=h().bind(null,"head"),_f.domAPI=p(),_f.insertStyleElement=y(),u()(Vf.A,_f),Vf.A&&Vf.A.locals&&Vf.A.locals;const Cf=(0,N.A)(Sf,[["__scopeId","data-v-08dba163"]]);n(4511);var Af=n(6585);const Df={class:"dialog-title"},Tf={class:"dialog-message"},Bf={key:0,class:"dialog-points"},If={class:"points-row"},zf={class:"points-label"},Mf={class:"points-value"},Pf={class:"points-row"},Rf={class:"points-label"},$f={class:"points-value"},Of=["placeholder"],Lf={class:"dialog-actions"},Ff=["disabled"],jf=["disabled"],Uf={key:0,class:"fullscreen-header"},qf={class:"fullscreen-title"},Gf={class:"mobile-header"},Hf={class:"menu-text"},Yf={class:"mobile-title"},Wf={key:0,class:"selected-info"},Xf={key:2,class:"empty-state"},Jf={class:"empty-icon"},Kf={class:"empty-actions"},Zf={class:"management-layout"},Qf={class:"grid-container"},ev={class:"grid-header-left"},tv={class:"header-title-group"},nv={class:"character-count"},av=["title"],rv={class:"grid-header-right"},ov={class:"header-left-content"},iv={key:0,class:"selected-char-info"},sv={key:0,class:"save-actions-buttons"},lv=["title"],cv=["disabled"],dv={class:"characters-grid"},uv=["onClick"],mv={class:"card-header"},pv={class:"avatar-text"},gv={class:"char-info"},hv={class:"name-row"},fv={class:"char-name"},vv={class:"char-meta"},bv={class:"world"},yv={class:"talent"},xv={class:"save-count"},kv={class:"count"},wv={class:"label"},Ev={class:"card-actions"},Nv=["onClick"],Sv=["onClick"],Vv=["onClick"],_v={class:"grid-content-right saves-panel"},Cv={key:0,class:"no-selection"},Av={class:"no-selection-icon"},Dv={class:"loading-saves"},Tv={class:"saves-container"},Bv={class:"saves-section"},Iv={key:0,class:"manual-saves-section"},zv={class:"manual-saves-header"},Mv={class:"save-info-text"},Pv={class:"manual-saves-grid"},Rv=["onClick"],$v={key:0,class:"save-data"},Ov={class:"save-header"},Lv={class:"save-name"},Fv={class:"save-actions"},jv=["onClick","title"],Uv=["onClick","title","disabled"],qv=["onClick","disabled","title"],Gv={class:"save-badges"},Hv={class:"realm-badge"},Yv={class:"age-badge"},Wv={class:"save-stats"},Xv={class:"stat-grid"},Jv={class:"stat"},Kv={class:"value"},Zv={class:"stat"},Qv={class:"value"},eb={class:"stat"},tb={class:"value"},nb={class:"stat"},ab={class:"value"},rb={class:"save-footer"},ob={class:"location"},ib={class:"save-time"},sb={key:1,class:"save-empty"},lb={class:"empty-text"},cb={class:"empty-desc"},db={class:"online-saves-container"},ub={key:0,class:"login-prompt"},mb={class:"loading-saves"},pb={key:2,class:"online-save-card"},gb={class:"save-data"},hb={class:"save-header"},fb={class:"save-name"},vb={class:"save-badges"},bb={class:"realm-badge"},yb={class:"age-badge"},xb={class:"save-stats"},kb={class:"stat-grid"},wb={class:"stat"},Eb={class:"value"},Nb={class:"stat"},Sb={class:"value"},Vb={class:"stat"},_b={class:"value"},Cb={class:"stat"},Ab={class:"value"},Db={class:"save-footer"},Tb={class:"location"},Bb={class:"sync-info"},Ib={class:"online-actions"},zb={key:0,class:"btn-sync"},Mb={class:"online-save-card"},Pb={class:"save-empty"},Rb={class:"empty-text"},$b={class:"empty-hint"},Ob={class:"modal-header"},Lb={key:0,class:"modal-content"},Fb={class:"details-grid"},jb={class:"detail-section"},Ub={class:"detail-items"},qb={class:"detail-item"},Gb={class:"label"},Hb={class:"value"},Yb={class:"detail-item"},Wb={class:"label"},Xb={class:"value"},Jb={class:"detail-item"},Kb={class:"label"},Zb={class:"value"},Qb={class:"detail-item"},ey={class:"label"},ty={class:"value"},ny={class:"detail-item"},ay={class:"label"},ry={class:"value"},oy={class:"detail-item"},iy={class:"label"},sy={class:"value"},ly={class:"detail-section"},cy={class:"attributes-display"},dy={class:"detail-section"},uy={class:"talents-list"},my={key:0,class:"talent-items"},py=["title"],gy={key:1,class:"no-talents"},hy=(0,r.defineComponent)({__name:"CharacterManagement",props:{fullscreen:{type:Boolean,default:!1}},emits:["back","login","close","character-selected"],setup(e,{emit:t}){const o=e,i=t,s=(0,r.computed)(()=>o.fullscreen),l=(0,a.useRouter)(),c=(0,Jc.useCharacterStore)(),d=(0,r.ref)(!0),u=(0,r.ref)(null),m=(0,r.ref)(!1),p=(0,r.ref)(null),g=(0,r.ref)(null),h=(0,r.ref)(null),f=(0,r.ref)(!1),v=(0,r.ref)(!1),b=(0,r.ref)(!1),y=(0,r.ref)("character"),x=(0,r.ref)(!1),k=(0,r.ref)(window.innerWidth),w=()=>{k.value=window.innerWidth,k.value>768?f.value=!0:k.value<=480&&(f.value=!1)},E=()=>{B.value?"单机"===B.value.模式?x.value=!0:X.o.error("联机角色不支持旧存档转化/导入"):X.o.info("请先选择一个单机角色")},N=async()=>{u.value&&await M(u.value)};(0,r.onMounted)(async()=>{window.addEventListener("resize",w),w();const e=Object.keys(c.rootState.角色列表);for(const t of e)try{await c.loadCharacterSaves(t)}catch(e){console.warn(`[CharacterManagement] 预加载角色 ${t} 存档失败:`,e)}const t=e[0];t&&M(t)}),(0,r.onUnmounted)(()=>{window.removeEventListener("resize",w)});const V=(0,r.ref)({show:!1,type:"alert",title:"",message:"",inputValue:"",placeholder:"",onConfirm:()=>{},onCancel:()=>{},travelPoints:null,travelCost:null,isBusy:!1}),_=(0,r.computed)(()=>Object.keys(c.rootState.角色列表).length),A=(0,r.computed)(()=>{const e=c.rootState.角色列表,t=Object.entries(e);return t.length>0&&console.log("[CharacterManagement] 第一个角色的数据结构:",JSON.stringify(t[0][1],null,2).substring(0,500)),t.filter(([,e])=>!(!e?.角色?.名字&&!e?.角色?.身份?.名字))}),B=(0,r.computed)(()=>u.value?c.rootState.角色列表[u.value]:null),I=(0,r.computed)(()=>k.value<=768),z=()=>{f.value=!f.value},M=async e=>{if(u.value!==e){u.value=e,b.value=!0;try{await c.loadCharacterSaves(e)}catch(e){console.error("[CharacterManagement] 加载存档数据失败:",e)}finally{b.value=!1}I.value&&(f.value=!1)}},P=e=>"单机"===e.模式?Object.entries(e.存档列表||{}).filter(([e,t])=>"上次对话"!==e&&t.存档数据).length:e.存档列表?.["云端修行"]?.存档数据?1:0,R=()=>{m.value=!1,p.value=null},$=async(e,t,n)=>{console.log("选择存档:",e,t,n);const a=c.rootState.角色列表[e];if("联机"===a?.模式&&(0,D.isBackendConfigured)()&&!await(0,T.verifyStoredToken)())return X.o.warning("联机模式需要登录，正在跳转..."),void l.push("/login");if(n){console.log("加载存档...");const n=await c.loadGame(e,t);console.log("加载结果:",n),n?(console.log("跳转到游戏界面..."),o.fullscreen?i("character-selected",a):l.push("/game")):console.error("存档加载失败")}else{const n="上次对话"===t;K(n?"创建新存档":"开启新征程",n?`是否在【${t}】位置创建新的存档开始游戏？`:`是否在存档位 "${t}" 开始一段新的修行？`,async()=>{console.log("确认创建新存档...");const n=await c.loadGame(e,t);console.log("新存档加载结果:",n),n&&(console.log("跳转到游戏界面..."),o.fullscreen?i("character-selected",a):l.push("/game"))})}},O=(e,t)=>{if(!e||"联机"===e.模式)return!1;if("上次对话"===t||"时间点存档"===t)return!1;const n=e.存档列表||{},a=Object.entries(n).filter(([e,t])=>"上次对话"!==e&&"时间点存档"!==e&&t.存档数据).length,r=n[t];return!(r?.存档数据&&a<=1)},L=(e,t)=>"上次对话"===t?"上次对话存档不可删除（用于回滚）":"时间点存档"===t?"时间点存档不可删除（定时自动覆盖）":O(e,t)?"删除存档":"无法删除：至少需要保留一个手动存档",F=()=>{i("back")},j=()=>{o.fullscreen?i("close"):F()},U=()=>{i("login")},q=e=>{if(!e||"object"!=typeof e)return null;const t=e;return(0,Zc.ru)(t)?t:(0,Zc.jj)(t).migrated},G=e=>Fu(e),H=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){const t=e;return String(t["名称"]||t.name||"未知天赋")}return"未知天赋"},Y=e=>{if("string"==typeof e)return`天赋《${e}》`;if(e&&"object"==typeof e){const t=e,n=t["描述"]||t.description||"",a=H(e);return n?String(n):`天赋《${a}》`}return"未知天赋"},W=e=>e?"string"==typeof e?e:"object"==typeof e&&null!==e&&(e.名称||e.name||e.名字)||"未知":"未知",J=(e,t,n)=>{V.value={show:!0,type:"alert",title:e,message:t,inputValue:"",placeholder:"",onConfirm:async()=>{n&&await n(),ee()},onCancel:ee,travelPoints:null,travelCost:null,isBusy:!1}},K=(e,t,n,a)=>{V.value={show:!0,type:"confirm",title:e,message:t,inputValue:"",placeholder:"",onConfirm:async()=>{await n(),ee()},onCancel:()=>{a&&a(),ee()},travelPoints:null,travelCost:null,isBusy:!1}},Z=async()=>{"prompt"===V.value.type?await V.value.onConfirm(V.value.inputValue):await V.value.onConfirm()},Q=()=>{V.value.onCancel(),ee()},ee=()=>{V.value.travelPoints=null,V.value.travelCost=null,V.value.isBusy=!1,V.value.show=!1},te=()=>{B.value?(y.value="saves",h.value?.click()):X.o.error("请先选择一个角色以导入存档")},ne=()=>{y.value="character",h.value?.click()},ae=async e=>{const t=e.target.files?.[0];if(!t)return;const n=()=>{h.value&&(h.value.value="")};try{const e=await t.text(),a=JSON.parse(e),r=(0,Kc.ZT)(a);if("saves"===y.value){const e="saves"===r.type&&Array.isArray(r.payload?.saves)?r.payload.saves:"character"===r.type&&Array.isArray(r.payload?.存档列表)?r.payload.存档列表:null;if(!e)throw new Error("无效的存档文件格式，请使用本游戏导出的存档文件");if(0===e.length)throw new Error("文件中没有找到有效的存档数据");if(!u.value||!B.value)return X.o.error("请先选择一个角色以导入存档"),void n();const t=u.value,a=B.value.角色.名字;K("导入存档",`确定要将 ${e.length} 个存档导入到角色 "${a}" 吗？同名存档将被覆盖。`,async()=>{v.value=!0;try{for(const n of e)await c.importSave(t,n);X.o.success(`成功为角色 "${a}" 导入 ${e.length} 个存档`),await M(t)}catch(e){console.error("导入存档失败",e),X.o.error("导入存档失败: "+e.message)}finally{v.value=!1,n()}},n)}else if("character"===y.value){if("character"!==r.type||!r.payload?.角色信息)throw new Error("无效的角色文件格式，请使用本游戏导出的角色文件");const e=r.payload.角色信息,t=e?.角色?.名字||"未知角色";e.存档列表={},Array.isArray(r.payload?.存档列表)&&(e._导入存档列表=r.payload.存档列表),(async(e,t,n,a)=>{try{const r=await(async()=>{if(!(0,D.isBackendConfigured)())throw new Error("后端未配置，无法获取穿越点数");if(!localStorage.getItem("access_token"))throw new Error("请先登录后端");const e=await T.Em.get("/api/v1/auth/me");return Number(e?.travel_points??0)})();if(r<10)return void J("穿越点数不足",`当前剩余 ${r} 点，无法执行该操作。`);V.value={show:!0,type:"confirm",title:e,message:t,inputValue:"",placeholder:"",travelPoints:r,travelCost:10,isBusy:!1,onConfirm:async()=>{V.value.isBusy=!0;try{const e=await(async()=>{const e=await T.Em.post("/api/v1/auth/travel-points/consume",{amount:10});return Number(e?.travel_points??0)})();await n(),X.o.info(`已扣除10点，剩余${e}点`)}catch(e){console.error("扣减穿越点数失败",e),X.o.error("扣减穿越点数失败")}finally{V.value.isBusy=!1,ee()}},onCancel:()=>{a&&a(),ee()}}}catch(e){X.o.error(e?.message||"获取穿越点数失败"),a&&a()}})("导入角色",`导入角色将消耗10个穿越点数，确定要导入角色 "${t}" 吗？`,async()=>{v.value=!0;try{await c.importCharacter(e),X.o.success(`成功导入角色 "${t}"`)}catch(e){console.error("导入角色失败",e),X.o.error("导入角色失败: "+e.message)}finally{v.value=!1,n()}},n)}}catch(e){console.error("处理导入文件失败",e),X.o.error("处理导入文件失败: "+e.message),n()}};return(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["character-management-panel",{fullscreen:s.value}])},[s.value?((0,r.openBlock)(),(0,r.createBlock)(S,{key:0})):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 自定义对话框 "),V.value.show?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"dialog-overlay",onClick:Q},[(0,r.createElementVNode)("div",{class:"dialog-box",onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("h3",Df,(0,r.toDisplayString)(V.value.title),1),(0,r.createElementVNode)("p",Tf,(0,r.toDisplayString)(V.value.message),1),null!==V.value.travelPoints?((0,r.openBlock)(),(0,r.createElementBlock)("div",Bf,[(0,r.createElementVNode)("div",If,[(0,r.createElementVNode)("span",zf,(0,r.toDisplayString)(e.$t("当前剩余"))+":",1),(0,r.createElementVNode)("span",Mf,(0,r.toDisplayString)(V.value.travelPoints),1)]),(0,r.createElementVNode)("div",Pf,[(0,r.createElementVNode)("span",Rf,(0,r.toDisplayString)(e.$t("本次消耗"))+":",1),(0,r.createElementVNode)("span",$f,(0,r.toDisplayString)(V.value.travelCost),1)])])):(0,r.createCommentVNode)("v-if",!0),"prompt"===V.value.type?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:1,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value.inputValue=e),placeholder:V.value.placeholder,class:"dialog-input",ref_key:"promptInput",ref:g},null,8,Of)),[[r.vModelText,V.value.inputValue]]):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Lf,["alert"!==V.value.type?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:Q,class:"btn-dialog-cancel",disabled:V.value.isBusy},(0,r.toDisplayString)(e.$t("取消")),9,Ff)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{onClick:Z,class:"btn-dialog-confirm",disabled:V.value.isBusy},(0,r.toDisplayString)(e.$t("确认")),9,jf)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 主体区域 "),(0,r.createElementVNode)("main",{class:(0,r.normalizeClass)(["main-content",{"fullscreen-content":s.value}])},[(0,r.createElementVNode)("input",{ref_key:"fileInput",ref:h,type:"file",accept:".json",onChange:ae,style:{display:"none"}},null,544),(0,r.createVNode)(Cf,{open:x.value,targetCharId:u.value,targetCharName:B.value?.角色?.名字,onClose:t[2]||(t[2]=e=>x.value=!1),onImported:N},null,8,["open","targetCharId","targetCharName"]),(0,r.createCommentVNode)(" 返回按钮 - 仅在全屏模式显示 "),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Uf,[(0,r.createElementVNode)("button",{onClick:j,class:"fullscreen-back-btn"},[(0,r.createVNode)((0,r.unref)(Yh),{size:20}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("返回")),1)]),(0,r.createElementVNode)("div",qf,[(0,r.createElementVNode)("h1",null,(0,r.toDisplayString)(e.$t("加载存档")),1),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("选择一个存档进入")),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 移动端头部导航 "),(0,r.createElementVNode)("div",Gf,[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["mobile-menu-btn",{active:f.value}]),onClick:z},[t[7]||(t[7]=(0,r.createElementVNode)("div",{class:"hamburger"},[(0,r.createElementVNode)("span"),(0,r.createElementVNode)("span"),(0,r.createElementVNode)("span")],-1)),(0,r.createElementVNode)("span",Hf,(0,r.toDisplayString)(e.$t("角色列表")),1)],2),(0,r.createElementVNode)("div",Yf,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("角色管理")),1),B.value?.角色?.名字?((0,r.openBlock)(),(0,r.createElementBlock)("div",Wf,(0,r.toDisplayString)(B.value.角色.名字)+" - "+(0,r.toDisplayString)(B.value.模式)+(0,r.toDisplayString)(e.$t("模式")),1)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 遮罩层 "),f.value&&I.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"panel-overlay",onClick:t[3]||(t[3]=e=>f.value=!1)})):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 无角色提示 "),0===Object.keys((0,r.unref)(c).rootState.角色列表).length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Xf,[(0,r.createElementVNode)("div",Jf,[(0,r.createVNode)((0,r.unref)(Zp),{size:32})]),(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("未找到任何存档")),1),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("尚未创建任何存档，请返回主页开启你的冒险之旅")),1),(0,r.createElementVNode)("div",Kf,[(0,r.createElementVNode)("button",{onClick:F,class:"btn-create"},(0,r.toDisplayString)(e.$t("踏入超凡新生")),1),(0,r.createElementVNode)("button",{onClick:ne,class:"btn-import"},(0,r.toDisplayString)(e.$t("导入角色")),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(" 角色管理界面 "),(0,r.createElementVNode)("div",Zf,[(0,r.createCommentVNode)(" 3行2列网格容器 "),(0,r.createElementVNode)("div",Qf,[(0,r.createCommentVNode)(" 第1行：标题栏 "),(0,r.createElementVNode)("div",ev,[(0,r.createElementVNode)("div",tv,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("角色列表")),1),(0,r.createElementVNode)("div",nv,(0,r.toDisplayString)(_.value)+" "+(0,r.toDisplayString)(e.$t("个角色")),1)]),(0,r.createElementVNode)("button",{onClick:ne,class:"btn-header-action import",title:e.$t("导入角色")},[(0,r.createVNode)((0,r.unref)(Wh.A),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("导入")),1)],8,av)]),(0,r.createElementVNode)("div",rv,[(0,r.createElementVNode)("div",ov,[(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("存档管理")),1),B.value?.角色?.名字?((0,r.openBlock)(),(0,r.createElementBlock)("div",iv,(0,r.toDisplayString)(B.value.角色.名字)+" - "+(0,r.toDisplayString)(B.value.模式)+(0,r.toDisplayString)(e.$t("模式")),1)):(0,r.createCommentVNode)("v-if",!0)]),B.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",sv,[(0,r.createElementVNode)("button",{onClick:te,class:"btn-save-action import",title:e.$t("向选中角色导入存档")},[(0,r.createVNode)((0,r.unref)(Wh.A),{size:18}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("导入存档")),1)],8,lv),(0,r.createElementVNode)("button",{onClick:E,class:"btn-save-action migrate",disabled:"单机"!==B.value.模式,title:"旧存档转化（单机）"},[(0,r.createVNode)((0,r.unref)(Xh),{size:18}),t[8]||(t[8]=(0,r.createElementVNode)("span",null,"旧存档转化",-1))],8,cv)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 第2行：主要内容区 "),(0,r.createElementVNode)("section",{class:(0,r.normalizeClass)(["grid-content-left characters-panel",{"is-open":f.value}])},[(0,r.createElementVNode)("div",dv,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(A.value,([t,a])=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:(0,r.normalizeClass)(["character-card",{active:u.value===String(t),"single-mode":"单机"===a.模式,"online-mode":"联机"===a.模式}]),onClick:e=>M(String(t))},[(0,r.createCommentVNode)(" 卡片头部 "),(0,r.createElementVNode)("div",mv,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["char-avatar",a.模式])},[(0,r.createElementVNode)("span",pv,(0,r.toDisplayString)(a.角色.名字[0]),1)],2),(0,r.createElementVNode)("div",gv,[(0,r.createElementVNode)("div",hv,[(0,r.createElementVNode)("h3",fv,(0,r.toDisplayString)(a.角色.名字),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["mode-badge","联机"===a.模式?"online":"single"])},(0,r.toDisplayString)(a.模式===e.$t("单机")?e.$t("单机"):e.$t("联机")),3)]),(0,r.createElementVNode)("div",vv,[(0,r.createElementVNode)("span",bv,(0,r.toDisplayString)(a.角色.世界.name),1),(0,r.createElementVNode)("span",yv,(0,r.toDisplayString)(W(a.角色.天资.name)),1)])]),(0,r.createElementVNode)("div",xv,[(0,r.createElementVNode)("span",kv,(0,r.toDisplayString)(P(a)),1),(0,r.createElementVNode)("span",wv,(0,r.toDisplayString)(e.$t("存档管理")),1)])]),(0,r.createCommentVNode)(" 卡片底部操作 "),(0,r.createElementVNode)("div",Ev,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>(e=>{p.value=c.rootState.角色列表[e],m.value=!0})(String(t)),["stop"]),class:"btn-details"},(0,r.toDisplayString)(e.$t("详情")),9,Nv),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>(async e=>{v.value=!0;try{const t=c.rootState.角色列表[e];if(!t)return X.o.error("角色不存在"),void(v.value=!1);const{loadSaveData:a}=await Promise.resolve().then(n.bind(n,5099)),r=Object.values(t.存档列表||{}).filter(e=>"上次对话"!==e.存档名),o=(await Promise.all(r.map(async t=>{const n=t.id||t.存档名,r=await a(e,n);if(!r)return console.warn(`[角色导出] 存档「${t.存档名}」数据为空，跳过`),null;const o=(0,se.isTavernEnv)()?(0,Af.kL)(r):r;return{...t,存档数据:o}})).then(e=>e.filter(Boolean))).map(e=>{const t=e.存档数据;if(!t)throw new Error(`存档「${e.存档名}」缺少存档数据，无法导出`);const n=(0,Zc.ru)(t)?t:(0,Zc.jj)(t).migrated,a=(0,Qc.$)(n);if(!a.isValid)throw new Error(`存档「${e.存档名}」校验失败：${a.errors[0]||"未知原因"}`);return{...e,存档数据:n}}),i=(0,Kc.q3)("character",{角色ID:e,角色信息:JSON.parse(JSON.stringify(t)),存档列表:o}),s=JSON.stringify(i,null,2),l=new Blob([s],{type:"application/json"});console.log("[角色导出] 数据大小:",(s.length/1024).toFixed(2),"KB");const d=document.createElement("a");d.href=URL.createObjectURL(l);const u=t.角色?.名字||"未命名角色";d.download=`超凡新生-角色-${u}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(d.href)},100),X.o.success(`已导出角色: ${u} (含 ${o.length} 个存档)`)}catch(e){console.error("导出角色失败",e),X.o.error("导出角色失败: "+(e instanceof Error?e.message:"未知错误"))}finally{v.value=!1}})(String(t)),["stop"]),class:"btn-export"},(0,r.toDisplayString)(e.$t("导出")),9,Sv),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>(e=>{const t=c.rootState.角色列表[e]?.角色.名字;K("删除角色",`确定要彻底删除角色"${t}"及其所有修行记录吗？此操作不可恢复。`,async()=>{u.value===e&&(u.value=null),await c.deleteCharacter(e)})})(String(t)),["stop"]),class:"btn-delete"},(0,r.toDisplayString)(e.$t("删除")),9,Vv)])],10,uv))),128))])],2),(0,r.createCommentVNode)(" 右侧：存档详情 "),(0,r.createElementVNode)("section",_v,[(0,r.createCommentVNode)(" 未选择角色 "),B.value?b.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 正在加载存档 "),(0,r.createElementVNode)("div",Dv,[t[9]||(t[9]=(0,r.createElementVNode)("div",{class:"loading-spinner"},null,-1)),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("正在加载存档...")),1)])],2112)):"单机"===B.value.模式?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" 单机模式存档 "),(0,r.createElementVNode)("div",Tv,[(0,r.createElementVNode)("div",Bv,[(0,r.createCommentVNode)(" 手动存档区 - 仅单机模式显示 "),"单机"===B.value.模式?((0,r.openBlock)(),(0,r.createElementBlock)("div",Iv,[(0,r.createElementVNode)("div",zv,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("手动存档")),1),(0,r.createElementVNode)("div",Mv,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("存档通过游戏内保存功能创建")),1)])]),(0,r.createElementVNode)("div",Pv,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((o=B.value,o?.存档列表?o.存档列表:{}),(a,o)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:o,class:(0,r.normalizeClass)(["save-card manual-save",{"has-data":a.存档数据,"auto-save":"上次对话"===o||"时间点存档"===o}]),onClick:e=>a.存档数据&&$(u.value,String(o),!0),style:(0,r.normalizeStyle)({cursor:a.存档数据?"pointer":"default"})},[a.存档数据?((0,r.openBlock)(),(0,r.createElementBlock)("div",$v,[(0,r.createElementVNode)("div",Ov,[(0,r.createElementVNode)("h4",Lv,["上次对话"===o?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(C),{key:0,size:16,class:"save-icon last-save-icon"})):"时间点存档"===o?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(cm),{key:1,size:16,class:"save-icon time-save-icon"})):(0,r.createCommentVNode)("v-if",!0),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(a.存档名||o),1)]),(0,r.createElementVNode)("div",Fv,[(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>(async(e,t,a)=>{v.value=!0;try{const{loadSaveData:r}=await Promise.resolve().then(n.bind(n,5099)),o=await r(e,t),i=(0,se.isTavernEnv)()?(0,Af.kL)(o):o;if(!i)return X.o.error("无法加载存档数据"),void(v.value=!1);const s=(0,Zc.ru)(i)?i:(0,Zc.jj)(i).migrated,l=(0,Qc.$)(s);if(!l.isValid)throw new Error(l.errors[0]||"存档结构校验失败");const c=(0,Kc.q3)("saves",{characterId:e,characterName:B.value?.角色?.名字,saves:[{...a,存档名:t,存档数据:s}]}),d=JSON.stringify(c,null,2),u=new Blob([d],{type:"application/json"}),m=document.createElement("a");m.href=URL.createObjectURL(u);const p=a.存档名||t;m.download=`超凡新生-${p}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.removeChild(m),URL.revokeObjectURL(m.href)},100),X.o.success(`已导出存档: ${p}`)}catch(e){console.error("导出存档失败",e),X.o.error("导出存档失败: "+(e instanceof Error?e.message:"未知错误"))}finally{v.value=!1}})(u.value,String(o),a),["stop"]),class:"btn-export-save",title:e.$t("导出此存档")},(0,r.toDisplayString)(e.$t("导")),9,jv),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>((e,t)=>{const n=c.rootState.角色列表[e]?.存档列表?.[t],a=n?.存档名||t;((e,t,n="",a="",o,i)=>{V.value={show:!0,type:"prompt",title:e,message:t,inputValue:n,placeholder:a,onConfirm:async e=>{await o(e||""),ee()},onCancel:()=>{i&&i(),ee()},travelPoints:null,travelCost:null,isBusy:!1},(0,r.nextTick)(()=>{g.value?.focus()})})("重命名存档","请输入新的存档名称：",a,"",async n=>{if(n&&n.trim()&&n.trim()!==a){const a=n.trim(),r=c.rootState.角色列表[e]?.存档列表;if(r&&a!==t&&r[a])return void J("重命名失败","存档名称已存在，请使用其他名称。");await c.renameSave(e,t,a)}})})(u.value,String(o)),["stop"]),class:"btn-edit-save",title:e.$t("重命名"),disabled:"上次对话"===o||"时间点存档"===o},(0,r.toDisplayString)(e.$t("编")),9,Uv),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(e=>((e,t)=>{const n=c.rootState.角色列表[e],a=n?.角色.名字,r="上次对话"===t?"上次对话存档":t;O(n,t)?K("删除存档",`确定要删除角色"${a}"的"${r}"吗？此操作不可恢复。`,()=>{c.deleteSave(e,t)}):J("无法删除存档","无法删除该存档：角色至少需要保留一个存档。如需删除，请先创建其他存档或删除整个角色。")})(u.value,String(o)),["stop"]),class:(0,r.normalizeClass)(["btn-delete-save",{disabled:!O(B.value,String(o))}]),disabled:!O(B.value,String(o)),title:L(B.value,String(o))},(0,r.toDisplayString)(e.$t("删")),11,qv)])]),(0,r.createElementVNode)("div",Gv,[(0,r.createElementVNode)("span",Hv,(0,r.toDisplayString)(G(q(a.存档数据)?.角色?.属性?.境界)),1),(0,r.createElementVNode)("span",Yv,(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.寿命?.当前??18)+"岁",1)]),(0,r.createElementVNode)("div",Wv,[(0,r.createElementVNode)("div",Xv,[(0,r.createElementVNode)("div",Jv,[t[10]||(t[10]=(0,r.createElementVNode)("span",{class:"label"},"气血",-1)),(0,r.createElementVNode)("span",Kv,(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.气血?.当前??0)+"/"+(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.气血?.上限??0),1)]),(0,r.createElementVNode)("div",Zv,[t[11]||(t[11]=(0,r.createElementVNode)("span",{class:"label"},"灵气",-1)),(0,r.createElementVNode)("span",Qv,(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.灵气?.当前??0)+"/"+(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.灵气?.上限??0),1)]),(0,r.createElementVNode)("div",eb,[t[12]||(t[12]=(0,r.createElementVNode)("span",{class:"label"},"神识",-1)),(0,r.createElementVNode)("span",tb,(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.神识?.当前??0)+"/"+(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.神识?.上限??0),1)]),(0,r.createElementVNode)("div",nb,[t[13]||(t[13]=(0,r.createElementVNode)("span",{class:"label"},"声望",-1)),(0,r.createElementVNode)("span",ab,(0,r.toDisplayString)(q(a.存档数据)?.角色?.属性?.声望??0),1)])])]),(0,r.createElementVNode)("div",rb,[(0,r.createElementVNode)("span",ob,(0,r.toDisplayString)(q(a.存档数据)?.角色?.位置?.描述||"初始地"),1),(0,r.createElementVNode)("span",ib,(0,r.toDisplayString)((i=a.保存时间,i?new Date(i).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未保存")),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",sb,[t[14]||(t[14]=(0,r.createElementVNode)("div",{class:"empty-slot-icon"},"📁",-1)),(0,r.createElementVNode)("span",lb,(0,r.toDisplayString)(e.$t("空存档槽")),1),(0,r.createElementVNode)("span",cb,(0,r.toDisplayString)(e.$t("通过游戏内保存创建")),1)]))],14,Rv);var i}),128))])])):(0,r.createCommentVNode)("v-if",!0)])])],2112)):"联机"===B.value.模式?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(" 联机模式存档 "),(0,r.createElementVNode)("div",db,[d.value?b.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 加载中状态 "),(0,r.createElementVNode)("div",mb,[t[16]||(t[16]=(0,r.createElementVNode)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("正在加载云端存档...")),1)])],2112)):B.value.存档列表?.["云端修行"]?.存档数据?((0,r.openBlock)(),(0,r.createElementBlock)("div",pb,[(0,r.createElementVNode)("div",gb,[(0,r.createElementVNode)("div",hb,[(0,r.createElementVNode)("h4",fb,(0,r.toDisplayString)(e.$t("云端存档")),1),(0,r.createElementVNode)("div",vb,[(0,r.createElementVNode)("span",bb,(0,r.toDisplayString)(G(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.境界)),1),(0,r.createElementVNode)("span",yb,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.寿命?.当前??18)+"岁",1)])]),(0,r.createElementVNode)("div",xb,[(0,r.createElementVNode)("div",kb,[(0,r.createElementVNode)("div",wb,[t[17]||(t[17]=(0,r.createElementVNode)("span",{class:"label"},"气血",-1)),(0,r.createElementVNode)("span",Eb,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.气血?.当前??0)+"/"+(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.气血?.上限??0),1)]),(0,r.createElementVNode)("div",Nb,[t[18]||(t[18]=(0,r.createElementVNode)("span",{class:"label"},"灵气",-1)),(0,r.createElementVNode)("span",Sb,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.灵气?.当前??0)+"/"+(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.灵气?.上限??0),1)]),(0,r.createElementVNode)("div",Vb,[t[19]||(t[19]=(0,r.createElementVNode)("span",{class:"label"},"神识",-1)),(0,r.createElementVNode)("span",_b,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.神识?.当前??0)+"/"+(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.神识?.上限??0),1)]),(0,r.createElementVNode)("div",Cb,[t[20]||(t[20]=(0,r.createElementVNode)("span",{class:"label"},"声望",-1)),(0,r.createElementVNode)("span",Ab,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.属性?.声望??0),1)])])]),(0,r.createElementVNode)("div",Db,[(0,r.createElementVNode)("span",Tb,(0,r.toDisplayString)(q(B.value.存档列表["云端修行"].存档数据)?.角色?.位置?.描述||"初始地"),1),(0,r.createElementVNode)("div",Bb,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["sync-status",{synced:!B.value.存档列表["云端修行"].云端同步信息?.需要同步}])},(0,r.toDisplayString)(B.value.存档列表["云端修行"].云端同步信息?.需要同步?e.$t("待同步"):e.$t("已同步")),3)])]),(0,r.createElementVNode)("div",Ib,[(0,r.createElementVNode)("button",{onClick:t[4]||(t[4]=e=>$(u.value,"云端修行",!0)),class:"btn-play"},(0,r.toDisplayString)(e.$t("进入游戏")),1),B.value.存档列表["云端修行"]?.云端同步信息?.需要同步?((0,r.openBlock)(),(0,r.createElementBlock)("button",zb,(0,r.toDisplayString)(e.$t("同步云端")),1)):(0,r.createCommentVNode)("v-if",!0)])])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(" 没有存档数据：显示开始游戏 "),(0,r.createElementVNode)("div",Mb,[(0,r.createElementVNode)("div",Pb,[t[21]||(t[21]=(0,r.createElementVNode)("div",{class:"empty-slot-icon"},"☁️",-1)),(0,r.createElementVNode)("span",Rb,(0,r.toDisplayString)(e.$t("尚未开始修行")),1),(0,r.createElementVNode)("p",$b,(0,r.toDisplayString)(e.$t("开始您的联机修仙之旅，存档将自动同步到云端")),1),(0,r.createElementVNode)("button",{onClick:t[5]||(t[5]=e=>$(u.value,"云端修行",!1)),class:"btn-start"},(0,r.toDisplayString)(e.$t("开始游戏")),1)])])],2112)):((0,r.openBlock)(),(0,r.createElementBlock)("div",ub,[t[15]||(t[15]=(0,r.createElementVNode)("div",{class:"login-icon"},"🔐",-1)),(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("需要登录")),1),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("请先登录以管理联机角色存档")),1),(0,r.createElementVNode)("button",{onClick:U,class:"btn-login"},(0,r.toDisplayString)(e.$t("登入道籍")),1)]))])],2112)):(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Cv,[(0,r.createElementVNode)("div",Av,[(0,r.createVNode)((0,r.unref)(Xh),{size:30})]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("请选择左侧角色查看存档详情")),1)]))]),(0,r.createCommentVNode)(" 第3行：底部信息栏（可选） "),t[22]||(t[22]=(0,r.createElementVNode)("div",{class:"grid-footer-left"},[(0,r.createCommentVNode)(" 预留底部区域 ")],-1)),t[23]||(t[23]=(0,r.createElementVNode)("div",{class:"grid-footer-right"},[(0,r.createCommentVNode)(" 预留底部区域 ")],-1))])])],2112))],2),(0,r.createCommentVNode)(" 角色详情弹窗 "),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:2,class:"modal-overlay",onClick:R},[(0,r.createElementVNode)("div",{class:"details-modal",onClick:t[6]||(t[6]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",Ob,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(p.value?.角色?.名字)+" - "+(0,r.toDisplayString)(e.$t("详情")),1),(0,r.createElementVNode)("button",{onClick:R,class:"btn-close"},"×")]),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Lb,[(0,r.createElementVNode)("div",Fb,[(0,r.createElementVNode)("div",jb,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(e.$t("基础信息")),1),(0,r.createElementVNode)("div",Ub,[(0,r.createElementVNode)("div",qb,[(0,r.createElementVNode)("span",Gb,(0,r.toDisplayString)(e.$t("用户名")),1),(0,r.createElementVNode)("span",Hb,(0,r.toDisplayString)(p.value.角色.名字),1)]),(0,r.createElementVNode)("div",Yb,[(0,r.createElementVNode)("span",Wb,(0,r.toDisplayString)(e.$t("世界")),1),(0,r.createElementVNode)("span",Xb,(0,r.toDisplayString)(W(p.value.角色.世界)),1)]),(0,r.createElementVNode)("div",Jb,[(0,r.createElementVNode)("span",Kb,(0,r.toDisplayString)(e.$t("天资")),1),(0,r.createElementVNode)("span",Zb,(0,r.toDisplayString)(W(p.value.角色.天资)),1)]),(0,r.createElementVNode)("div",Qb,[(0,r.createElementVNode)("span",ey,(0,r.toDisplayString)(e.$t("出身")),1),(0,r.createElementVNode)("span",ty,(0,r.toDisplayString)(W(p.value.角色.出生)),1)]),(0,r.createElementVNode)("div",ny,[(0,r.createElementVNode)("span",ay,(0,r.toDisplayString)(e.$t("灵根")),1),(0,r.createElementVNode)("span",ry,(0,r.toDisplayString)(W(p.value.角色.灵根)),1)]),(0,r.createElementVNode)("div",oy,[(0,r.createElementVNode)("span",iy,(0,r.toDisplayString)(e.$t("模式")),1),(0,r.createElementVNode)("span",sy,(0,r.toDisplayString)(p.value.模式),1)])])]),(0,r.createElementVNode)("div",ly,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(e.$t("先天六司")),1),(0,r.createElementVNode)("div",cy,[p.value.角色.先天六司?((0,r.openBlock)(),(0,r.createBlock)(Hh,{key:0,stats:(a=p.value.角色.先天六司,{root_bone:a["根骨"]||0,spirituality:a["灵性"]||0,comprehension:a["悟性"]||0,fortune:a["气运"]||0,charm:a["魅力"]||0,temperament:a["心性"]||0}),size:150,maxValue:10},null,8,["stats"])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",dy,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(e.$t("天赋神通")),1),(0,r.createElementVNode)("div",uy,[p.value.角色.天赋?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",my,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(p.value.角色.天赋,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:t,class:"talent-tag",title:Y(e)},(0,r.toDisplayString)(H(e)),9,py))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("span",gy,(0,r.toDisplayString)(e.$t("暂无天赋")),1))])])])])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0)],2);var a,o}}});var fy=n(8885),vy={};vy.styleTagTransform=k(),vy.setAttributes=v(),vy.insert=h().bind(null,"head"),vy.domAPI=p(),vy.insertStyleElement=y(),u()(fy.A,vy),fy.A&&fy.A.locals&&fy.A.locals;const by=(0,N.A)(hy,[["__scopeId","data-v-6c72ccc2"]]),yy={key:0,class:"error-boundary"},xy={class:"error-container"},ky={class:"error-message"},wy={key:0,class:"error-details"},Ey={class:"error-actions"},Ny=(0,r.defineComponent)({__name:"ErrorBoundary",setup(e){const t=(0,a.useRouter)(),n=(0,r.ref)(!1),o=(0,r.ref)(""),i=(0,r.ref)(""),s=(0,r.ref)(!1);(0,r.onErrorCaptured)((e,t,a)=>(console.error("[错误边界] 捕获到错误:",e),console.error("[错误边界] 组件信息:",a),n.value=!0,o.value=e.message||"未知错误",i.value=`\n错误: ${e.name}: ${e.message}\n堆栈: ${e.stack||"无堆栈信息"}\n组件: ${a}\n  `.trim(),!1));const l=()=>{n.value=!1,o.value="",i.value="",s.value=!1,t.go(0)},c=()=>{n.value=!1,t.back()},d=()=>{s.value=!s.value};return(e,t)=>n.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",yy,[(0,r.createElementVNode)("div",xy,[t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"error-icon"},"⚠️",-1)),(0,r.createElementVNode)("h2",null,(0,r.toDisplayString)(e.$t("道法受阻")),1),(0,r.createElementVNode)("p",ky,(0,r.toDisplayString)(o.value),1),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",wy,[(0,r.createElementVNode)("pre",null,(0,r.toDisplayString)(i.value),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Ey,[(0,r.createElementVNode)("button",{onClick:l,class:"btn-retry"},(0,r.toDisplayString)(e.$t("重试")),1),(0,r.createElementVNode)("button",{onClick:c,class:"btn-back"},(0,r.toDisplayString)(e.$t("返回")),1),(0,r.createElementVNode)("button",{onClick:d,class:"btn-details"},(0,r.toDisplayString)(s.value?e.$t("隐藏详情"):e.$t("查看详情")),1)])])])):(0,r.renderSlot)(e.$slots,"default",{key:1})}});var Sy=n(5674),Vy={};Vy.styleTagTransform=k(),Vy.setAttributes=v(),Vy.insert=h().bind(null,"head"),Vy.domAPI=p(),Vy.insertStyleElement=y(),u()(Sy.A,Vy),Sy.A&&Sy.A.locals&&Sy.A.locals;const _y=(0,N.A)(Ny,[["__scopeId","data-v-7ca07f60"]]);var Cy=n(5099);const Ay={class:"sect-migration"},Dy={class:"migration-header"},Ty={key:0,class:"migration-reasons"},By={class:"migration-meta"},Iy={class:"meta-item"},zy={class:"value"},My={class:"meta-item"},Py={class:"value"},Ry={class:"meta-item"},$y={class:"value"},Oy={class:"migration-actions"},Ly=["disabled"],Fy=["disabled"],jy=(0,r.defineComponent)({__name:"SectMigrationModal",props:{reasons:{},fromVersion:{},toVersion:{}},setup(e){const t=e,n=(0,Jc.useCharacterStore)(),a=(0,pu.useGameStateStore)(),o=(0,A.useUIStore)(),i=(0,r.ref)(!1),s=(0,r.computed)(()=>t.toVersion??2),l=(0,r.computed)(()=>t.reasons?.length?t.reasons:["检测到旧版宗门字段"]),c=(0,r.computed)(()=>{const e=a.sectMemberInfo?.宗门名称,t=a.sectSystem?.当前宗门??void 0;return e||t||"未加入宗门"}),d=(0,r.computed)(()=>{const e=a.sectSystem;return e?.宗门档案?Object.keys(e.宗门档案).length:a.worldInfo?.势力信息?.length||0}),u=(0,r.computed)(()=>n.activeCharacterProfile?.模式||"未知"),m=async()=>{if(!i.value){i.value=!0;try{const e=a.getCurrentSaveData();if(!e)return void X.o.error("未找到存档数据，无法迁移");await(async e=>{const t=n.rootState.当前激活存档,a=n.activeCharacterProfile;if(!t||!a)return void X.o.warning("无法创建备份：未找到激活存档");const r=`宗门迁移备份-${(()=>{const e=new Date,t=e=>String(e).padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`})()}`;if("单机"===a.模式)return void await n.saveAsNewSlot(r);await Cy.dc(t.角色ID,r,e);const o="sect_migration_backups",i={角色ID:t.角色ID,存档槽位:r,时间:(new Date).toISOString()},s=JSON.parse(localStorage.getItem(o)||"[]");s.push(i),localStorage.setItem(o,JSON.stringify(s.slice(-20))),X.o.success(`已创建本地备份：${r}`)})(e);const t=(e=>{const t=(0,Mu.cloneDeep)(e),n=t.世界?.信息??null,a=Array.isArray(n?.势力信息)?n.势力信息:[],r=$u((0,Mu.cloneDeep)(a));n?.势力信息&&(n.势力信息=r);const o=t.社交?.宗门??null,i="number"==typeof o?.版本?o.版本:0;return t.社交&&"object"==typeof t.社交||(t.社交={}),t.社交.宗门=((e,t,n)=>{const a=e.社交?.宗门??{},r={};t.forEach(e=>{e?.名称&&(r[e.名称]=e)});const o=a?.成员信息?.宗门名称??null,i=(e=>{const t={},n=e.社交?.关系??{};return Object.entries(n).forEach(([e,n])=>{if(!n||"object"!=typeof n)return;const a=n.势力归属||n.宗门||n.势力;if(!a)return;const r=n.名字||e;t[a]||(t[a]=[]),t[a].includes(r)||t[a].push(r)}),t})(e);return{...a,版本:2,当前宗门:a.当前宗门??o??null,宗门档案:{...r,...a.宗门档案||{}},宗门成员:a.宗门成员??i,宗门藏经阁:a.宗门藏经阁??{},宗门贡献商店:a.宗门贡献商店??{},迁移记录:{来源版本:n,目标版本:2,时间:(new Date).toISOString(),说明:"由旧版宗门字段迁移生成"}}})(t,r,i),t})(e);a.loadFromSaveData(t),await n.saveCurrentGame(),X.o.success("宗门存档迁移完成"),o.hideDetailModal()}catch(e){X.o.error(`宗门存档迁移失败：${e instanceof Error?e.message:"未知错误"}`)}finally{i.value=!1}}},p=()=>{o.hideDetailModal()};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Ay,[(0,r.createElementVNode)("div",Dy,[t[0]||(t[0]=(0,r.createElementVNode)("h4",null,"检测到旧版宗门存档",-1)),(0,r.createElementVNode)("p",null,"将把宗门数据升级到 V"+(0,r.toDisplayString)(s.value)+"，只写入 V3 路径（不再保留旧字段）。",1)]),l.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ty,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"reason-item"},[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"dot"},null,-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e),1)]))),128))])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",By,[(0,r.createElementVNode)("div",Iy,[t[2]||(t[2]=(0,r.createElementVNode)("span",{class:"label"},"当前宗门",-1)),(0,r.createElementVNode)("span",zy,(0,r.toDisplayString)(c.value),1)]),(0,r.createElementVNode)("div",My,[t[3]||(t[3]=(0,r.createElementVNode)("span",{class:"label"},"势力数量",-1)),(0,r.createElementVNode)("span",Py,(0,r.toDisplayString)(d.value),1)]),(0,r.createElementVNode)("div",Ry,[t[4]||(t[4]=(0,r.createElementVNode)("span",{class:"label"},"存档模式",-1)),(0,r.createElementVNode)("span",$y,(0,r.toDisplayString)(u.value),1)])]),(0,r.createElementVNode)("div",Oy,[(0,r.createElementVNode)("button",{class:"primary",disabled:i.value,onClick:m},(0,r.toDisplayString)(i.value?"正在迁移...":"创建备份并迁移"),9,Ly),(0,r.createElementVNode)("button",{class:"secondary",disabled:i.value,onClick:p}," 稍后再说 ",8,Fy)]),t[5]||(t[5]=(0,r.createElementVNode)("p",{class:"migration-hint"}," 迁移前会自动备份：单机模式生成新存档槽，联机模式写入本地备份记录。 ",-1))]))}});var Uy=n(5097),qy={};qy.styleTagTransform=k(),qy.setAttributes=v(),qy.insert=h().bind(null,"head"),qy.domAPI=p(),qy.insertStyleElement=y(),u()(Uy.A,qy),Uy.A&&Uy.A.locals&&Uy.A.locals;const Gy=(0,N.A)(jy,[["__scopeId","data-v-84b88b2c"]]),Hy={class:"game-view"},Yy={class:"sidebar-wrapper"},Wy={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Xy=["points"],Jy={class:"main-content"},Ky={key:0,class:"panel-overlay"},Zy={class:"panel-header compact","aria-label":"功能面板导航"},Qy=["title","aria-label"],ex={class:"panel-title-compact"},tx={class:"title-text"},nx={class:"panel-actions"},ax=["title","onClick","aria-label"],rx={class:"panel-content compact"},ox={key:2,class:"panel-overlay"},ix={class:"panel-header"},sx={class:"panel-title"},lx=["title"],cx={class:"panel-content"},dx={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ux=["points"],mx={class:"sidebar-wrapper"},px={class:"data-loading"},gx={class:"loading-content"},hx={class:"loading-title"},fx={class:"loading-message"},vx={class:"loading-steps"},bx={class:"loading-step"},yx={class:"step-text"},xx={class:"loading-step"},kx={class:"step-text"},wx={class:"loading-step active"},Ex={class:"step-text"},Nx={class:"loading-hint"},Sx=(0,r.defineComponent)({__name:"GameView",setup(e){const t=(0,Jc.useCharacterStore)(),n=(0,pu.useGameStateStore)(),o=(0,A.useUIStore)(),i=(0,a.useRouter)(),s=(0,a.useRoute)(),l=(0,r.ref)(!1),c=(0,r.ref)(!1),d=(0,r.ref)(!1),u=()=>{d.value=window.innerWidth<=768,d.value&&(l.value=!0,c.value=!0)},m=()=>{l.value=!0,c.value=!0},p=(0,r.ref)(null),g=new Set(["Inventory","CharacterDetails","Memory","Relationships","Cultivation","Techniques","ThousandDao","Settings","Save","WorldMap","Events","Sect","SectOverview","SectMembers","SectLibrary","SectContribution","GameVariables","Prompts","APIManagement"]),h=new Set(["Settings","Prompts","APIManagement"]),f=new Set(["Memory","Relationships","Cultivation","Techniques","ThousandDao","Settings","Save","Sect","SectOverview","SectMembers","SectLibrary","SectContribution"]),v={Inventory:{title:"背包物品",icon:gu},CharacterDetails:{title:"人物详情",icon:_},Memory:{title:"记忆中心",icon:hu},Relationships:{title:"人物关系",icon:fu},Cultivation:{title:"修炼系统",icon:vu.A},Techniques:{title:"修炼功法",icon:bu},ThousandDao:{title:"三千大道",icon:yu},Settings:{title:"系统设置",icon:Wn.A},Save:{title:"保存游戏",icon:xu.A},WorldMap:{title:"世界地图",icon:ku},Events:{title:"世界事件",icon:wu},Sect:{title:"宗门势力",icon:Eu},SectOverview:{title:"宗门概览",icon:Eu},SectMembers:{title:"宗门成员",icon:fu},SectLibrary:{title:"宗门藏经",icon:vu.A},SectContribution:{title:"贡献兑换",icon:Nu},GameVariables:{title:"游戏变量",icon:Su},Prompts:{title:"提示词管理",icon:Vu},APIManagement:{title:"API管理",icon:_u.A}},b=(0,r.computed)(()=>g.has(String(s.name))),y=(0,r.computed)(()=>{const e=String(s.name),t=v[e];return t?.title||"功能面板"}),x=(0,r.computed)(()=>{const e=String(s.name),t=v[e];return t?.icon||Cu}),k=()=>{"GameMain"!==s.name&&i.push("/game")},w={Memory:[{key:"refresh",title:"刷新",icon:Au.A,action:"refresh"},{key:"test",title:"测试转化",icon:Du.A,action:"test"},{key:"clear",title:"清理",icon:Yn.A,action:"clear"}],Events:[{key:"refresh",title:"刷新",icon:Au.A,action:"refresh"}],Save:[{key:"refresh",title:"刷新",icon:Au.A,action:"refresh"},{key:"save",title:"快速存档",icon:xu.A,action:"save"}],ThousandDao:[{key:"refresh",title:"刷新",icon:Au.A,action:"refresh"}],GameVariables:[{key:"refresh",title:"刷新数据",icon:Au.A,action:"refresh"},{key:"export",title:"导出JSON",icon:xu.A,action:"export"},{key:"stats",title:"数据统计",icon:Tu,action:"stats"}]},E=(0,r.computed)(()=>{const e=String(s.name);return(w[e]||[]).map(e=>({key:e.key,title:e.title,icon:e.icon,onClick:()=>zu.emit(e.action)}))}),N=(0,r.computed)(()=>{const e=String(s.name);return!!h.has(e)||!!t.activeCharacterProfile});return(0,r.onMounted)(async()=>{(()=>{try{const e=localStorage.getItem("dad_game_settings");if(e){const t=JSON.parse(e);if(t.uiScale){const e=t.uiScale/100;document.documentElement.style.setProperty("--ui-scale",e.toString())}if(t.fontSize){const e={small:"0.875rem",medium:"1rem",large:"1.125rem"}[t.fontSize]||"1rem";document.documentElement.style.setProperty("--base-font-size",e)}document.documentElement.setAttribute("data-theme","dark"),t.theme="dark",localStorage.setItem("dad_game_settings",JSON.stringify(t))}else document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("dad_game_settings",JSON.stringify({theme:"dark"}))}catch(e){console.error("[GameView] 应用设置失败:",e)}})(),u(),window.addEventListener("resize",u)}),(0,r.onBeforeUnmount)(()=>{window.removeEventListener("resize",u)}),(0,r.watch)(()=>[n.isGameLoaded,t.rootState.当前激活存档?.角色ID,t.rootState.当前激活存档?.存档槽位],([e])=>{e?(()=>{if(!n.isGameLoaded)return;const e=(()=>{const e=t.rootState.当前激活存档;return e?`${e.角色ID}::${e.存档槽位}`:null})();if(!e||p.value===e)return;const a=(e=>{const t={needed:!1,fromVersion:0,toVersion:2,reasons:[]};if(!e)return t;const n=e.社交?.宗门??null,a=null!==n&&"object"==typeof n&&0===Object.keys(n).length,r=!!n?.成员信息?.宗门名称,o=null!==n&&!a&&2!==n.版本;if((!n||a)&&!r)return t;const i="number"==typeof n?.版本?n.版本:0;return t.fromVersion=i,r&&!n?.当前宗门&&t.reasons.push("玩家宗门信息未同步到宗门系统"),o&&t.reasons.push("宗门系统版本不匹配"),t.needed=t.reasons.length>0,t})(n.getCurrentSaveData());a.needed&&(p.value=e,o.showDetailModal({title:"宗门存档迁移",component:Gy,props:{reasons:a.reasons,fromVersion:a.fromVersion,toVersion:a.toVersion}}))})():p.value=null},{immediate:!0}),(0,r.watch)(b,e=>{if(e){const e=String(s.name);d.value&&(l.value=!0),f.has(e)&&(c.value=!0)}}),(e,t)=>{const n=(0,r.resolveComponent)("router-view");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Hy,[(0,r.createCommentVNode)(" 顶部栏 "),(0,r.createVNode)(sm),(0,r.createCommentVNode)(" 主要内容区域 "),N.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)(["game-content",{"panel-mode":b.value}])},[(0,r.createCommentVNode)(" 左侧功能栏 "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["left-sidebar",{collapsed:l.value}])},[(0,r.createElementVNode)("div",Yy,[(0,r.createVNode)(Wp)])],2),(0,r.createCommentVNode)(" Mobile Overlay "),!d.value||l.value&&c.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"mobile-sidebar-overlay",onClick:m})),(0,r.createCommentVNode)(" 左侧收缩按钮 "),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["collapse-btn left",{collapsed:l.value}]),onClick:t[0]||(t[0]=e=>l.value=!l.value)},[((0,r.openBlock)(),(0,r.createElementBlock)("svg",Wy,[(0,r.createElementVNode)("polyline",{points:l.value?"9,18 15,12 9,6":"15,18 9,12 15,6"},null,8,Xy)]))],2),(0,r.createCommentVNode)(" 主游戏区域 "),(0,r.createElementVNode)("div",Jy,[(0,r.createCommentVNode)(" 功能面板覆盖层 "),b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ky,[(0,r.createElementVNode)("div",Zy,[(0,r.createElementVNode)("button",{class:"back-btn",onClick:k,title:e.$t("返回"),"aria-label":e.$t("返回")},t[3]||(t[3]=[(0,r.createElementVNode)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("polyline",{points:"15 18 9 12 15 6"})],-1)]),8,Qy),(0,r.createElementVNode)("div",ex,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(x.value),{size:16,class:"panel-title-icon"})),(0,r.createElementVNode)("span",tx,(0,r.toDisplayString)(y.value),1)]),(0,r.createElementVNode)("div",nx,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(E.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.key,class:"action-btn-compact",title:e.title,onClick:e.onClick,"aria-label":e.title},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:14}))],8,ax))),128))])]),(0,r.createElementVNode)("div",rx,[(0,r.createVNode)(n,null,{default:(0,r.withCtx)(({Component:e})=>[((0,r.openBlock)(),(0,r.createBlock)(r.KeepAlive,null,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e)))],1024))]),_:1})])])):(0,r.unref)(o).showCharacterManagement?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 正常路由视图 "),(0,r.createVNode)(n,null,{default:(0,r.withCtx)(({Component:e})=>[((0,r.openBlock)(),(0,r.createBlock)(r.KeepAlive,null,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e)))],1024))]),_:1})],2112)),(0,r.createCommentVNode)(" 角色管理面板 "),(0,r.unref)(o).showCharacterManagement?((0,r.openBlock)(),(0,r.createElementBlock)("div",ox,[(0,r.createElementVNode)("div",ix,[(0,r.createElementVNode)("h2",sx,[(0,r.createVNode)((0,r.unref)(Bu),{size:20,class:"panel-title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.$t("角色管理")),1)]),(0,r.createElementVNode)("button",{class:"panel-close-btn",onClick:t[1]||(t[1]=e=>(0,r.unref)(o).closeCharacterManagement()),title:e.$t("关闭")},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})],8,lx)]),(0,r.createElementVNode)("div",cx,[(0,r.createVNode)(by,{onBack:(0,r.unref)(o).closeCharacterManagement},null,8,["onBack"])])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 右侧收缩按钮 "),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["collapse-btn right",{collapsed:c.value}]),onClick:t[2]||(t[2]=e=>c.value=!c.value)},[((0,r.openBlock)(),(0,r.createElementBlock)("svg",dx,[(0,r.createElementVNode)("polyline",{points:c.value?"15,18 9,12 15,6":"9,18 15,12 9,6"},null,8,ux)]))],2),(0,r.createCommentVNode)(" 右侧区域: 角色信息栏 "),(0,r.withDirectives)((0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["right-panel-area",{collapsed:c.value}])},[(0,r.createElementVNode)("div",mx,[(0,r.createVNode)(_y,null,{default:(0,r.withCtx)(()=>[(0,r.createVNode)(Ih)]),_:1})])],2),[[r.vShow,!b.value]])],2)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 数据未就绪时的提示 "),(0,r.createElementVNode)("div",px,[(0,r.createElementVNode)("div",gx,[t[7]||(t[7]=(0,r.createElementVNode)("div",{class:"loading-spinner-wrapper"},[(0,r.createElementVNode)("div",{class:"loading-spinner"}),(0,r.createElementVNode)("div",{class:"spinner-glow"})],-1)),(0,r.createElementVNode)("h2",hx,(0,r.toDisplayString)(e.$t("道法自然，天地初开")),1),(0,r.createElementVNode)("p",fx,(0,r.toDisplayString)(e.$t("正在加载修仙世界...")),1),(0,r.createElementVNode)("div",vx,[(0,r.createElementVNode)("div",bx,[t[4]||(t[4]=(0,r.createElementVNode)("span",{class:"step-icon"},"✓",-1)),(0,r.createElementVNode)("span",yx,(0,r.toDisplayString)(e.$t("连接天道")),1)]),(0,r.createElementVNode)("div",xx,[t[5]||(t[5]=(0,r.createElementVNode)("span",{class:"step-icon"},"✓",-1)),(0,r.createElementVNode)("span",kx,(0,r.toDisplayString)(e.$t("加载角色数据")),1)]),(0,r.createElementVNode)("div",wx,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"step-icon"},"○",-1)),(0,r.createElementVNode)("span",Ex,(0,r.toDisplayString)(e.$t("读取存档信息")),1)])]),(0,r.createElementVNode)("p",Nx,(0,r.toDisplayString)(e.$t("提示：请在左侧菜单选择角色并加载存档")),1)])])],2112))])}}});var Vx=n(193),_x={};_x.styleTagTransform=k(),_x.setAttributes=v(),_x.insert=h().bind(null,"head"),_x.domAPI=p(),_x.insertStyleElement=y(),u()(Vx.A,_x),Vx.A&&Vx.A.locals&&Vx.A.locals;const Cx=(0,N.A)(Sx,[["__scopeId","data-v-2c3d1126"]]);var Ax=n(100);const Dx={class:"account-container"},Tx={class:"account-panel"},Bx={class:"header"},Ix={class:"title-row"},zx={key:0,class:"backend-locked"},Mx={key:0,class:"loading"},Px={key:1,class:"sections"},Rx=["open"],$x={class:"section-title"},Ox={class:"section-body"},Lx={key:0,class:"info-list"},Fx={class:"info-label"},jx={class:"info-value"},Ux={key:1,class:"info-empty"},qx=(0,r.defineComponent)({__name:"AccountCenter",setup(e){const t=(0,a.useRouter)(),n=(0,Ax.useAPIManagementStore)(),o=(0,Jc.useCharacterStore)(),i=(0,r.ref)((0,D.isBackendConfigured)()),s=(0,r.ref)(!1),l=(0,r.ref)(null),c=(0,r.computed)(()=>!!l.value),d=e=>{if(!e)return"-";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},u=(0,r.computed)(()=>[{title:"账号信息",open:!0,items:l.value?[{label:"用户名",value:l.value.user_name},{label:"账号ID",value:String(l.value.account_id)},{label:"邮箱",value:l.value.email||"未设置"},{label:"穿越点数",value:String(l.value.travel_points??0)},{label:"最后登录-北京时间",value:l.value.last_login?d(l.value.last_login):"未记录"},{label:"注册时间",value:d(l.value.created_at)}]:[],emptyText:"未获取到账号信息"}]),m=()=>{t.push("/")},p=async()=>{try{await o.saveLocalDataToBackend()}catch{}try{await Xc.promptStorage.resetAll()}catch{}localStorage.removeItem("access_token"),localStorage.removeItem("username"),n.clearAll({clearRemote:!0}),o.clearLocalCharacterData(),l.value=null,X.o.info("已退出登录"),t.push("/login")};return(0,r.onMounted)(async()=>{if(i.value)if(localStorage.getItem("access_token")){s.value=!0;try{l.value=await T.Em.get("/api/v1/auth/me")}catch(e){l.value=null,t.push("/login")}finally{s.value=!1}}else t.push("/login")}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Dx,[(0,r.createVNode)(S),(0,r.createElementVNode)("div",Tx,[(0,r.createElementVNode)("div",Bx,[(0,r.createElementVNode)("div",Ix,[t[0]||(t[0]=(0,r.createElementVNode)("h2",{class:"title"},"账号中心",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status",{ok:c.value,warn:!c.value}])},(0,r.toDisplayString)(c.value?"已登录":"未登录"),3)]),t[1]||(t[1]=(0,r.createElementVNode)("p",{class:"subtitle"},"集中管理账号信息",-1))]),i.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Mx,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Px,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("details",{key:e.title,class:"section",open:e.open},[(0,r.createElementVNode)("summary",$x,(0,r.toDisplayString)(e.title),1),(0,r.createElementVNode)("div",Ox,[e.items.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Lx,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.items,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.label,class:"info-row"},[(0,r.createElementVNode)("span",Fx,(0,r.toDisplayString)(e.label),1),(0,r.createElementVNode)("span",jx,(0,r.toDisplayString)(e.value),1)]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ux,(0,r.toDisplayString)(e.emptyText||"暂无信息"),1))])],8,Rx))),128))])),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:m},"返回"),(0,r.createElementVNode)("button",{class:"btn danger",onClick:p},"退出登录")])],64)):((0,r.openBlock)(),(0,r.createElementBlock)("div",zx,[t[2]||(t[2]=(0,r.createElementVNode)("p",null,"未配置后端服务器，账号中心不可用。",-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:m},"返回")])]))])]))}});var Gx=n(3293),Hx={};Hx.styleTagTransform=k(),Hx.setAttributes=v(),Hx.insert=h().bind(null,"head"),Hx.domAPI=p(),Hx.insertStyleElement=y(),u()(Gx.A,Hx),Gx.A&&Gx.A.locals&&Gx.A.locals;const Yx=(0,N.A)(qx,[["__scopeId","data-v-2600fd5e"]]);async function Wx(e,t={}){if(!(0,D.isBackendConfigured)())throw new Error("未配置后端服务器");const n=(0,D.mh)(e);if(!n)throw new Error("后端地址无效");const a=new Headers(t.headers||{}),r=localStorage.getItem("admin_access_token");r&&a.set("Authorization",`Bearer ${r}`),!t.body||t.body instanceof FormData||a.has("Content-Type")||a.set("Content-Type","application/json");const o=await fetch(n,{...t,headers:a});if(204===o.status)return null;const i=await o.text(),s=(o.headers.get("content-type")||"").includes("application/json")&&i?JSON.parse(i):i;if(!o.ok){const e=(e=>{if(null==e)return null;if("string"==typeof e)return e;if("object"!=typeof e)return String(e);const t=e;return"string"==typeof t.detail?t.detail:"string"==typeof t.message?t.message:null!=t.detail?JSON.stringify(t.detail):JSON.stringify(t)})(s);throw new Error((e||`服务器错误 ${o.status}`||"").trim()||"请求失败，请检查后端服务与权限。")}return s}Wx.get=async(e,t={})=>Wx(e,{...t,method:"GET"}),Wx.post=async(e,t,n={})=>Wx(e,{...n,method:"POST",body:void 0===t?void 0:JSON.stringify(t)}),Wx.put=async(e,t,n={})=>Wx(e,{...n,method:"PUT",body:void 0===t?void 0:JSON.stringify(t)}),Wx.delete=async(e,t={})=>Wx(e,{...t,method:"DELETE"});const Xx={class:"admin-container"},Jx={class:"admin-panel"},Kx={class:"header"},Zx={class:"title-row"},Qx={key:0,class:"locked"},ek={key:1,class:"locked"},tk={key:0,class:"locked"},nk={class:"top-actions"},ak={class:"tab-groups"},rk={class:"group-label"},ok={class:"tabs"},ik=["onClick"],sk={class:"actions"},lk=["disabled"],ck={class:"content"},dk={key:0,class:"section"},uk={class:"toolbar"},mk=["disabled"],pk={key:0,class:"error"},gk={key:1,class:"loading"},hk={key:2,class:"table saves"},fk={class:"cell id"},vk={class:"cell name"},bk={class:"cell name"},yk={class:"cell mode"},xk={class:"cell time"},kk={class:"cell time"},wk={class:"cell num"},Ek={class:"cell actions"},Nk=["disabled","onClick"],Sk={class:"section"},Vk={class:"toolbar"},_k=["disabled"],Ck={key:0,class:"error"},Ak={key:1,class:"loading"},Dk={key:2,class:"table characters"},Tk={class:"cell id"},Bk={class:"cell name"},Ik={class:"cell name"},zk={class:"cell"},Mk={class:"cell"},Pk={class:"cell num"},Rk={class:"cell time"},$k={key:2,class:"section"},Ok={class:"toolbar"},Lk=["disabled"],Fk=["disabled"],jk={key:0,class:"error"},Uk={key:1,class:"loading"},qk={key:2,class:"table codes"},Gk={class:"cell id"},Hk={class:"cell name"},Yk={class:"cell"},Wk={class:"cell num"},Xk={class:"cell time"},Jk={class:"cell time"},Kk={class:"cell actions"},Zk=["disabled","onClick"],Qk=["disabled","onClick"],ew={key:3,class:"section"},tw={class:"toolbar"},nw=["disabled"],aw=["disabled"],rw={key:0,class:"error"},ow={key:1,class:"loading"},iw={key:2,class:"table codes"},sw={class:"cell id"},lw={class:"cell name"},cw={class:"cell"},dw={class:"cell num"},uw={class:"cell time"},mw={class:"cell time"},pw={class:"cell actions"},gw=["disabled","onClick"],hw={key:4,class:"section"},fw={class:"section-head"},vw={class:"section-title"},bw={class:"toolbar"},yw=["disabled"],xw=["disabled"],kw={key:0,class:"error"},ww={key:1,class:"loading"},Ew={key:2,class:"table crud"},Nw={class:"cell id"},Sw={class:"cell name"},Vw={class:"cell desc"},_w={class:"cell actions"},Cw=["disabled","onClick"],Aw=["disabled","onClick"],Dw={class:"modal"},Tw={class:"modal-head"},Bw={class:"modal-title"},Iw={class:"modal-body"},zw={class:"field"},Mw={class:"field"},Pw={class:"field"},Rw={class:"actions"},$w=["disabled"],Ow=(0,r.defineComponent)({__name:"BackendAdminView",setup(e){const t=(0,a.useRouter)(),n=(0,A.useUIStore)(),o=(0,r.ref)((0,D.isBackendConfigured)()),i=(0,r.ref)(!1),s=async()=>{o.value=(0,D.isBackendConfigured)(),o.value?i.value=await n.checkBackendConnection():i.value=!1},l=()=>t.push("/"),c=()=>t.push("/login"),d=(0,r.ref)(!1),u=(0,Ax.useAPIManagementStore)(),m=(0,Jc.useCharacterStore)(),p=(0,r.computed)(()=>"true"===localStorage.getItem("is_admin")),g=async()=>{try{await m.saveLocalDataToBackend()}catch{}try{await Xc.promptStorage.resetAll()}catch{}localStorage.removeItem("is_admin"),localStorage.removeItem("access_token"),localStorage.removeItem("username"),u.clearAll({clearRemote:!0}),m.clearLocalCharacterData(),X.o.info("已退出登录"),t.push("/login")},h=[{id:"saves",label:"存档管理",group:"数据管理"},{id:"characters",label:"角色管理",group:"数据管理"},{id:"ban_records",label:"封号管理",group:"用户管理"},{id:"appeals",label:"申诉管理",group:"用户管理"},{id:"admins",label:"管理员管理",group:"用户管理"},{id:"worlds",label:"世界",group:"开局配置"},{id:"origins",label:"出身",group:"开局配置"},{id:"talents",label:"天赋",group:"开局配置"},{id:"talent_tiers",label:"天资",group:"开局配置"},{id:"spirit_roots",label:"灵根",group:"开局配置"},{id:"invitation_codes",label:"邀请码管理",group:"其他"},{id:"codes",label:"兑换码",group:"其他"},{id:"workshop",label:"创意工坊",group:"其他"},{id:"system",label:"系统设置",group:"其他"}],f=[{label:"数据管理",tabs:h.filter(e=>"数据管理"===e.group)},{label:"用户管理",tabs:h.filter(e=>"用户管理"===e.group)},{label:"开局配置",tabs:h.filter(e=>"开局配置"===e.group)},{label:"其他",tabs:h.filter(e=>"其他"===e.group)}],v=(0,r.ref)("worlds"),b=(0,r.computed)(()=>h.find(e=>e.id===v.value)?.label||"管理"),y=(0,r.ref)(""),x=(0,r.ref)(!1),k=(0,r.ref)(""),w=(0,r.ref)([]),E=((0,r.ref)(!1),(0,r.ref)("")),N=(0,r.ref)(""),V=(0,r.ref)([]),_=(0,r.ref)(!1),C=(0,r.ref)(""),T=(0,r.ref)(""),B=(0,r.ref)([]),I=(0,r.ref)(!1),z=(0,r.ref)(""),M=(0,r.ref)(""),P=(0,r.ref)([]),R=(0,r.ref)(!1),$=(0,r.ref)(""),O=(0,r.ref)([]),L=(0,r.reactive)({custom_code:"",max_uses:-1,days_valid:""}),F=(0,r.ref)(!1),j=(0,r.ref)(""),U=(0,r.ref)([]),q=(0,r.reactive)({custom_code:"",max_uses:1,days_valid:"",reward_type:"ai",reward_value:1}),G=e=>{if(!e)return"-";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},H=()=>{switch(v.value){case"worlds":return"/api/v1/worlds/";case"origins":return"/api/v1/origins/";case"talents":return"/api/v1/talents/";case"talent_tiers":return"/api/v1/talent_tiers/";case"spirit_roots":return"/api/v1/spirit_roots/";default:return""}},Y=e=>({...e,id:Number(e?.id),name:String(e?.name??e?.名称??""),description:"string"==typeof e?.description?e.description:"string"==typeof e?.描述?e.描述:""}),W=async()=>{const e=H();if(e){x.value=!0,k.value="";try{const t=await Wx.get(e);w.value=(t||[]).map(Y)}catch(e){k.value=e?.message||"加载失败"}finally{x.value=!1}}},J=(0,r.computed)(()=>{const e=y.value.trim(),t=w.value;return e?t.filter(t=>(t.name||"").includes(e)||String(t.id).includes(e)):t}),K=((0,r.computed)(()=>{const e=N.value.trim();return e?V.value.filter(t=>t.user_name.includes(e)||String(t.id).includes(e)):V.value}),async()=>{_.value=!0,C.value="";try{const e=await Wx.get("/api/v1/admin/saves");B.value=(e||[]).map(e=>({id:Number(e?.id),user_name:String(e?.user_name??""),character_name:String(e?.character_name??""),mode:String(e?.mode??""),created_at:String(e?.created_at??""),updated_at:String(e?.updated_at??""),size_kb:Number(e?.size_kb??0)}))}catch(e){C.value=e?.message||"加载失败"}finally{_.value=!1}}),Z=(0,r.computed)(()=>{const e=T.value.trim();return e?B.value.filter(t=>t.user_name.includes(e)||t.character_name.includes(e)||String(t.id).includes(e)):B.value}),Q=async()=>{I.value=!0,z.value="";try{const e=await Wx.get("/api/v1/admin/characters");P.value=(e||[]).map(e=>({id:Number(e?.id),user_name:String(e?.user_name??""),character_name:String(e?.character_name??""),world:String(e?.world??""),realm:String(e?.realm??""),age:Number(e?.age??0),created_at:String(e?.created_at??"")}))}catch(e){z.value=e?.message||"加载失败"}finally{I.value=!1}},ee=async()=>{R.value=!0,$.value="";try{const e=await Wx.get("/api/v1/admin/invitation-codes");O.value=e?.items||[]}catch(e){$.value=e?.message||"加载失败"}finally{R.value=!1}},te=async()=>{d.value=!0;try{const e={max_uses:Number(L.max_uses??-1)};L.custom_code.trim()&&(e.custom_code=L.custom_code.trim()),String(L.days_valid).trim()&&(e.days_valid=Number(L.days_valid)),await Wx.post("/api/v1/admin/invitation-codes",e),X.o.success("邀请码已创建"),L.custom_code="",L.days_valid="",await ee()}catch(e){X.o.error(e?.message||"创建失败")}finally{d.value=!1}},ne=async()=>{F.value=!0,j.value="";try{const e=await Wx.get("/api/v1/admin/redemption-codes");U.value=e?.items||[]}catch(e){j.value=e?.message||"加载失败"}finally{F.value=!1}},ae=async()=>{d.value=!0;try{const e={max_uses:Number(q.max_uses??1),reward_type:q.reward_type||"ai",reward_value:Number(q.reward_value??1)};q.custom_code.trim()&&(e.custom_code=q.custom_code.trim()),String(q.days_valid).trim()&&(e.days_valid=Number(q.days_valid)),await Wx.post("/api/v1/admin/redemption-codes",e),X.o.success("兑换码已创建"),q.custom_code="",q.days_valid="",await ne()}catch(e){X.o.error(e?.message||"创建失败")}finally{d.value=!1}},re=(0,r.computed)(()=>{const e=M.value.trim();return e?P.value.filter(t=>t.user_name.includes(e)||t.character_name.includes(e)||String(t.id).includes(e)):P.value}),oe=(0,r.ref)(!1),ie=(0,r.ref)(null),se=(0,r.reactive)({name:"",description:"",extraJson:""}),le=()=>{ie.value=null,se.name="",se.description="",se.extraJson="",oe.value=!0},ce=()=>{oe.value=!1},de=async()=>{const e=H();if(!e)return;let t={};if(se.extraJson.trim())try{t=JSON.parse(se.extraJson)}catch{return void X.o.error("附加 JSON 不是合法 JSON")}const n={...t,name:se.name,description:se.description};d.value=!0;try{ie.value?.id?(await Wx.put(`${e}${ie.value.id}`,n),X.o.success("已保存")):(await Wx.post(e,n),X.o.success("已创建")),oe.value=!1,await W()}catch(e){X.o.error(e?.message||"保存失败")}finally{d.value=!1}},ue=async()=>{"saves"===v.value?await K():"characters"===v.value?await Q():"invitation_codes"===v.value?await ee():"codes"===v.value?await ne():await W()};return(0,r.watch)(v,()=>{y.value="",k.value="",E.value="",$.value="",j.value=""}),(0,r.onMounted)(async()=>{await s(),i.value&&p.value&&await ue()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Xx,[(0,r.createVNode)(S),(0,r.createElementVNode)("div",Jx,[(0,r.createElementVNode)("div",Kx,[(0,r.createElementVNode)("div",Zx,[t[14]||(t[14]=(0,r.createElementVNode)("h2",{class:"title"},"后端管理",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status",{ok:i.value&&p.value,warn:!i.value||!p.value}])},(0,r.toDisplayString)(i.value?p.value?"管理员权限":"无权限":"后端不可用"),3)]),t[15]||(t[15]=(0,r.createElementVNode)("p",{class:"subtitle"},"世界/出身/天赋/天资/灵根 数据管理",-1))]),o.value?i.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[p.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createElementVNode)("div",nk,[(0,r.createElementVNode)("div",ak,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f,e=>(0,r.createElementVNode)("div",{key:e.label,class:"tab-group"},[(0,r.createElementVNode)("div",rk,(0,r.toDisplayString)(e.label),1),(0,r.createElementVNode)("div",ok,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.tabs,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.id,class:(0,r.normalizeClass)(["tab",{active:v.value===e.id}]),onClick:t=>v.value=e.id},(0,r.toDisplayString)(e.label),11,ik))),128))])])),64))]),(0,r.createElementVNode)("div",sk,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:g},"退出登录"),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:ue},"刷新",8,lk)])]),(0,r.createElementVNode)("div",ck,[(0,r.createCommentVNode)(" 存档管理标签页 "),"saves"===v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",dk,[t[21]||(t[21]=(0,r.createElementVNode)("div",{class:"section-head"},[(0,r.createElementVNode)("div",{class:"section-title"},"存档管理"),(0,r.createElementVNode)("div",{class:"section-sub"},"查看和删除玩家存档")],-1)),(0,r.createElementVNode)("div",uk,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>T.value=e),class:"input",placeholder:"搜索角色名/用户名..."},null,512),[[r.vModelText,T.value]]),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:K},"加载",8,mk)]),C.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",pk,(0,r.toDisplayString)(C.value),1)):_.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",gk,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",hk,[t[20]||(t[20]=(0,r.createStaticVNode)('<div class="row header" data-v-79c43826><div class="cell id" data-v-79c43826>ID</div><div class="cell name" data-v-79c43826>用户名</div><div class="cell name" data-v-79c43826>角色名</div><div class="cell mode" data-v-79c43826>模式</div><div class="cell time" data-v-79c43826>创建时间</div><div class="cell time" data-v-79c43826>更新时间</div><div class="cell num" data-v-79c43826>大小(KB)</div><div class="cell actions" data-v-79c43826>操作</div></div>',1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Z.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"row"},[(0,r.createElementVNode)("div",fk,"#"+(0,r.toDisplayString)(e.id),1),(0,r.createElementVNode)("div",vk,(0,r.toDisplayString)(e.user_name),1),(0,r.createElementVNode)("div",bk,(0,r.toDisplayString)(e.character_name),1),(0,r.createElementVNode)("div",yk,(0,r.toDisplayString)(e.mode),1),(0,r.createElementVNode)("div",xk,(0,r.toDisplayString)(G(e.created_at)),1),(0,r.createElementVNode)("div",kk,(0,r.toDisplayString)(G(e.updated_at)),1),(0,r.createElementVNode)("div",wk,(0,r.toDisplayString)(e.size_kb.toFixed(1)),1),(0,r.createElementVNode)("div",Ek,[(0,r.createElementVNode)("button",{class:"btn sm danger",disabled:d.value,onClick:t=>(async e=>{if(confirm(`确定删除存档：${e.character_name} (${e.user_name}) #${e.id}？`)){d.value=!0;try{await Wx.delete(`/api/v1/admin/saves/${e.id}`),X.o.success("已删除存档"),await K()}catch(e){X.o.error(e?.message||"删除失败")}finally{d.value=!1}}})(e)},"删除",8,Nk)])]))),128))]))])):"characters"===v.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 角色管理标签页 "),(0,r.createElementVNode)("div",Sk,[t[23]||(t[23]=(0,r.createElementVNode)("div",{class:"section-head"},[(0,r.createElementVNode)("div",{class:"section-title"},"角色管理"),(0,r.createElementVNode)("div",{class:"section-sub"},"查看所有角色信息")],-1)),(0,r.createElementVNode)("div",Vk,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>M.value=e),class:"input",placeholder:"搜索角色名/用户名..."},null,512),[[r.vModelText,M.value]]),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:Q},"加载",8,_k)]),z.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ck,(0,r.toDisplayString)(z.value),1)):I.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ak,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Dk,[t[22]||(t[22]=(0,r.createStaticVNode)('<div class="row header" data-v-79c43826><div class="cell id" data-v-79c43826>ID</div><div class="cell name" data-v-79c43826>用户名</div><div class="cell name" data-v-79c43826>角色名</div><div class="cell" data-v-79c43826>世界</div><div class="cell" data-v-79c43826>境界</div><div class="cell num" data-v-79c43826>年龄</div><div class="cell time" data-v-79c43826>创建时间</div></div>',1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(re.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"row"},[(0,r.createElementVNode)("div",Tk,"#"+(0,r.toDisplayString)(e.id),1),(0,r.createElementVNode)("div",Bk,(0,r.toDisplayString)(e.user_name),1),(0,r.createElementVNode)("div",Ik,(0,r.toDisplayString)(e.character_name),1),(0,r.createElementVNode)("div",zk,(0,r.toDisplayString)(e.world),1),(0,r.createElementVNode)("div",Mk,(0,r.toDisplayString)(e.realm),1),(0,r.createElementVNode)("div",Pk,(0,r.toDisplayString)(e.age),1),(0,r.createElementVNode)("div",Rk,(0,r.toDisplayString)(G(e.created_at)),1)]))),128))]))])],2112)):"invitation_codes"===v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",$k,[t[25]||(t[25]=(0,r.createElementVNode)("div",{class:"section-head"},[(0,r.createElementVNode)("div",{class:"section-title"},"邀请码管理"),(0,r.createElementVNode)("div",{class:"section-sub"},"创建与查看邀请码")],-1)),(0,r.createElementVNode)("div",Ok,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>L.custom_code=e),class:"input",placeholder:"自定义邀请码（可选）"},null,512),[[r.vModelText,L.custom_code]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>L.max_uses=e),class:"input small",type:"number",min:"-1",placeholder:"可用次数(-1无限)"},null,512),[[r.vModelText,L.max_uses,void 0,{number:!0}]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>L.days_valid=e),class:"input small",type:"number",min:"0",placeholder:"有效天数(可选)"},null,512),[[r.vModelText,L.days_valid]]),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:te},"创建",8,Lk),(0,r.createElementVNode)("button",{class:"btn btn-secondary",disabled:d.value,onClick:ee},"加载",8,Fk)]),$.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",jk,(0,r.toDisplayString)($.value),1)):R.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Uk,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",qk,[t[24]||(t[24]=(0,r.createStaticVNode)('<div class="row header" data-v-79c43826><div class="cell id" data-v-79c43826>ID</div><div class="cell name" data-v-79c43826>邀请码</div><div class="cell" data-v-79c43826>状态</div><div class="cell num" data-v-79c43826>已用/上限</div><div class="cell time" data-v-79c43826>到期</div><div class="cell time" data-v-79c43826>创建时间</div><div class="cell actions" data-v-79c43826>操作</div></div>',1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(O.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"row"},[(0,r.createElementVNode)("div",Gk,"#"+(0,r.toDisplayString)(e.id),1),(0,r.createElementVNode)("div",Hk,(0,r.toDisplayString)(e.code),1),(0,r.createElementVNode)("div",Yk,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["pill",{banned:!e.is_active}])},(0,r.toDisplayString)(e.is_active?"启用":"停用"),3)]),(0,r.createElementVNode)("div",Wk,(0,r.toDisplayString)(e.times_used)+" / "+(0,r.toDisplayString)(e.max_uses<0?"∞":e.max_uses),1),(0,r.createElementVNode)("div",Xk,(0,r.toDisplayString)(e.expires_at?G(e.expires_at):"-"),1),(0,r.createElementVNode)("div",Jk,(0,r.toDisplayString)(e.created_at?G(e.created_at):"-"),1),(0,r.createElementVNode)("div",Kk,[(0,r.createElementVNode)("button",{class:"btn sm",disabled:d.value,onClick:t=>(async e=>{d.value=!0;try{await Wx.patch(`/api/v1/admin/invitation-codes/${e.id}`,{is_active:!e.is_active}),X.o.success(e.is_active?"已停用邀请码":"已启用邀请码"),await ee()}catch(e){X.o.error(e?.message||"操作失败")}finally{d.value=!1}})(e)},(0,r.toDisplayString)(e.is_active?"停用":"启用"),9,Zk),(0,r.createElementVNode)("button",{class:"btn sm danger",disabled:d.value,onClick:t=>(async e=>{if(confirm(`确定删除邀请码 ${e.code}？`)){d.value=!0;try{await Wx.delete(`/api/v1/admin/invitation-codes/${e.id}`),X.o.success("已删除邀请码"),await ee()}catch(e){X.o.error(e?.message||"删除失败")}finally{d.value=!1}}})(e)},"删除",8,Qk)])]))),128))]))])):"codes"===v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ew,[t[28]||(t[28]=(0,r.createElementVNode)("div",{class:"section-head"},[(0,r.createElementVNode)("div",{class:"section-title"},"兑换码"),(0,r.createElementVNode)("div",{class:"section-sub"},"创建与查看兑换码")],-1)),(0,r.createElementVNode)("div",tw,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>q.custom_code=e),class:"input",placeholder:"自定义兑换码（可选）"},null,512),[[r.vModelText,q.custom_code]]),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>q.reward_type=e),class:"input small"},t[26]||(t[26]=[(0,r.createElementVNode)("option",{value:"ai"},"AI",-1),(0,r.createElementVNode)("option",{value:"points"},"点数",-1),(0,r.createElementVNode)("option",{value:"item"},"道具",-1)]),512),[[r.vModelSelect,q.reward_type]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>q.reward_value=e),class:"input small",type:"number",min:"1",placeholder:"奖励数值"},null,512),[[r.vModelText,q.reward_value,void 0,{number:!0}]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>q.max_uses=e),class:"input small",type:"number",min:"-1",placeholder:"可用次数"},null,512),[[r.vModelText,q.max_uses,void 0,{number:!0}]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>q.days_valid=e),class:"input small",type:"number",min:"0",placeholder:"有效天数(可选)"},null,512),[[r.vModelText,q.days_valid]]),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:ae},"创建",8,nw),(0,r.createElementVNode)("button",{class:"btn btn-secondary",disabled:d.value,onClick:ne},"加载",8,aw)]),j.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",rw,(0,r.toDisplayString)(j.value),1)):F.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ow,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",iw,[t[27]||(t[27]=(0,r.createStaticVNode)('<div class="row header" data-v-79c43826><div class="cell id" data-v-79c43826>ID</div><div class="cell name" data-v-79c43826>兑换码</div><div class="cell" data-v-79c43826>奖励</div><div class="cell num" data-v-79c43826>已用/上限</div><div class="cell time" data-v-79c43826>到期</div><div class="cell time" data-v-79c43826>创建时间</div><div class="cell actions" data-v-79c43826>操作</div></div>',1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(U.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"row"},[(0,r.createElementVNode)("div",sw,"#"+(0,r.toDisplayString)(e.id),1),(0,r.createElementVNode)("div",lw,(0,r.toDisplayString)(e.code),1),(0,r.createElementVNode)("div",cw,(0,r.toDisplayString)(e.reward_type)+" × "+(0,r.toDisplayString)(e.reward_value),1),(0,r.createElementVNode)("div",dw,(0,r.toDisplayString)(e.times_used)+" / "+(0,r.toDisplayString)(e.max_uses<0?"∞":e.max_uses),1),(0,r.createElementVNode)("div",uw,(0,r.toDisplayString)(e.expires_at?G(e.expires_at):"-"),1),(0,r.createElementVNode)("div",mw,(0,r.toDisplayString)(e.created_at?G(e.created_at):"-"),1),(0,r.createElementVNode)("div",pw,[(0,r.createElementVNode)("button",{class:"btn sm danger",disabled:d.value,onClick:t=>(async e=>{if(confirm(`确定删除兑换码 ${e.code}？`)){d.value=!0;try{await Wx.delete(`/api/v1/admin/redemption-codes/${e.id}`),X.o.success("已删除兑换码"),await ne()}catch(e){X.o.error(e?.message||"删除失败")}finally{d.value=!1}}})(e)},"删除",8,gw)])]))),128))]))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",hw,[(0,r.createElementVNode)("div",fw,[(0,r.createElementVNode)("div",vw,(0,r.toDisplayString)(b.value),1),t[29]||(t[29]=(0,r.createElementVNode)("div",{class:"section-sub"},"增删改查（复杂字段用 JSON 编辑）",-1))]),(0,r.createElementVNode)("div",bw,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>y.value=e),class:"input",placeholder:"搜索名称..."},null,512),[[r.vModelText,y.value]]),(0,r.createElementVNode)("button",{class:"btn",disabled:d.value,onClick:W},"加载",8,yw),(0,r.createElementVNode)("button",{class:"btn primary",disabled:d.value,onClick:le},"新增",8,xw)]),k.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",kw,(0,r.toDisplayString)(k.value),1)):x.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ww,"加载中…")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ew,[t[30]||(t[30]=(0,r.createStaticVNode)('<div class="row header" data-v-79c43826><div class="cell id" data-v-79c43826>ID</div><div class="cell name" data-v-79c43826>名称</div><div class="cell desc" data-v-79c43826>描述</div><div class="cell actions" data-v-79c43826>操作</div></div>',1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(J.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"row"},[(0,r.createElementVNode)("div",Nw,"#"+(0,r.toDisplayString)(e.id),1),(0,r.createElementVNode)("div",Sw,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("div",Vw,(0,r.toDisplayString)(e.description||"-"),1),(0,r.createElementVNode)("div",_w,[(0,r.createElementVNode)("button",{class:"btn sm",disabled:d.value,onClick:t=>(e=>{ie.value=e,se.name=e.name||"",se.description=e.description||"";const t={...e};delete t.id,delete t.name,delete t.description,se.extraJson=Object.keys(t).length?JSON.stringify(t,null,2):"",oe.value=!0})(e)},"编辑",8,Cw),(0,r.createElementVNode)("button",{class:"btn sm danger",disabled:d.value,onClick:t=>(async e=>{const t=H();if(t&&confirm(`确定删除：${e.name} (#${e.id})？`)){d.value=!0;try{await Wx.delete(`${t}${e.id}`),X.o.success("已删除"),await W()}catch(e){X.o.error(e?.message||"删除失败")}finally{d.value=!1}}})(e)},"删除",8,Aw)])]))),128))]))]))]),oe.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(ce,["self"])},[(0,r.createElementVNode)("div",Dw,[(0,r.createElementVNode)("div",Tw,[(0,r.createElementVNode)("div",Bw,(0,r.toDisplayString)(ie.value?.id?"编辑":"新增")+" · "+(0,r.toDisplayString)(b.value),1),(0,r.createElementVNode)("button",{class:"btn sm",onClick:ce},"关闭")]),(0,r.createElementVNode)("div",Iw,[(0,r.createElementVNode)("label",zw,[t[31]||(t[31]=(0,r.createElementVNode)("span",{class:"label"},"名称",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>se.name=e),class:"input"},null,512),[[r.vModelText,se.name]])]),(0,r.createElementVNode)("label",Mw,[t[32]||(t[32]=(0,r.createElementVNode)("span",{class:"label"},"描述",-1)),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[12]||(t[12]=e=>se.description=e),class:"textarea",rows:"4"},null,512),[[r.vModelText,se.description]])]),(0,r.createElementVNode)("label",Pw,[t[33]||(t[33]=(0,r.createElementVNode)("span",{class:"label"},"附加 JSON（可空）",-1)),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>se.extraJson=e),class:"textarea mono",rows:"8",placeholder:"{ }"},null,512),[[r.vModelText,se.extraJson]])])]),(0,r.createElementVNode)("div",Rw,[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:ce},"取消"),(0,r.createElementVNode)("button",{class:"btn primary",disabled:d.value||!se.name,onClick:de},"保存",8,$w)])])])):(0,r.createCommentVNode)("v-if",!0)],64)):((0,r.openBlock)(),(0,r.createElementBlock)("div",tk,[t[18]||(t[18]=(0,r.createElementVNode)("p",null,"需要管理员权限才能访问后端管理。",-1)),t[19]||(t[19]=(0,r.createElementVNode)("p",{class:"hint"},'请在登录页面勾选"管理员登录"后重新登录。',-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:l},"返回"),(0,r.createElementVNode)("button",{class:"btn",onClick:c},"去登录")])]))],64)):((0,r.openBlock)(),(0,r.createElementBlock)("div",ek,[t[17]||(t[17]=(0,r.createElementVNode)("p",null,"后端未连接或不可用，请先确认后端运行正常。",-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:l},"返回"),(0,r.createElementVNode)("button",{class:"btn",onClick:s},"重试连接")])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Qx,[t[16]||(t[16]=(0,r.createElementVNode)("p",null,"未配置后端服务器，无法使用。",-1)),(0,r.createElementVNode)("div",{class:"actions"},[(0,r.createElementVNode)("button",{class:"btn btn-secondary",onClick:l},"返回")])]))])]))}});var Lw=n(1756),Fw={};Fw.styleTagTransform=k(),Fw.setAttributes=v(),Fw.insert=h().bind(null,"head"),Fw.domAPI=p(),Fw.insertStyleElement=y(),u()(Lw.A,Fw),Lw.A&&Lw.A.locals&&Lw.A.locals;const jw=(0,N.A)(Ow,[["__scopeId","data-v-79c43826"]]),Uw=(0,V.A)("brain-circuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]),qw=(0,V.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var Gw=n(5517),Hw=n(8381);const Yw=(0,V.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Ww=(0,V.A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var Xw=n(3310);const Jw=new class{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}async emit(e,t){const n=Array.from(this.listeners.get(e)||[]);for(const e of n)await e(t)}};function Kw(e,t=!0){return Jw.emit("send",{text:e,focus:t})}class Zw{static instance=null;undoActions=[];storageKey="dao_undo_actions";constructor(){this.loadUndoHistoryFromStorage()}static getInstance(){return this.instance||(this.instance=new Zw),this.instance}getEquipmentSlotItemId(e){if(!e)return null;if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&"物品ID"in e){const t=e.物品ID;return"string"==typeof t?t:null}return null}ensureEquipmentSlots(e){const t={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},n=e;n.角色||(n.角色={});const a=n.角色.装备??t,r={...t};for(let e=1;e<=6;e++){const t=`装备${e}`;r[t]=this.getEquipmentSlotItemId(a?.[t])??null}return n.角色.装备=r,r}ensureRoleBackpack(e){const t=e;return t.角色||(t.角色={}),t.角色.背包||(t.角色.背包={物品:{},灵石:{下品:0,中品:0,上品:0,极品:0}}),t.角色.背包.物品||(t.角色.背包.物品={}),t.角色.背包.灵石||(t.角色.背包.灵石={下品:0,中品:0,上品:0,极品:0}),t.角色.背包}ensureRoleCultivation(e){const t=e;return t.角色||(t.角色={}),t.角色.修炼||(t.角色.修炼={修炼功法:null,修炼状态:{模式:"未修炼"}}),t.角色.修炼}async equipItem(e){const t=(0,Xw.useActionQueueStore)();try{const a=(0,pu.useGameStateStore)(),r=a.toSaveData();if(!r)return X.o.error("存档数据不存在，无法装备"),!1;const o=this.ensureEquipmentSlots(r),i=this.ensureRoleBackpack(r).物品;if(!i||"object"!=typeof i)return X.o.error("背包数据异常"),!1;const s=i[e.物品ID];if(s&&!0===s.已装备)return X.o.info(`《${e.名称}》已经装备在身上了`),!1;this.removeConflictingActions(e.物品ID,"unequip");let l=null,c=null;for(let e=1;e<=6;e++){const t=`装备${e}`,n=o[t];if(!n||null===n){l=t;break}}if(!l){l="装备1";const e=o[l];e&&(c=i[e]||null,c&&(i[e]={...c,已装备:!1}))}o[l]=e.物品ID,s&&(i[e.物品ID]={...s,已装备:!0}),console.log("装备操作完成:",{槽位:l,物品:e,装备栏状态:o});const{applyEquipmentBonus:d}=await Promise.resolve().then(n.bind(n,651));d(r,e.物品ID),a.loadFromSaveData(r),await a.saveGame();const u={type:"equip",itemId:e.物品ID,itemName:e.名称,restoreData:{originalSlot:null,replacedItem:c}};return this.undoActions.push(u),this.saveUndoHistoryToStorage(),t.addAction({type:"equip",itemName:e.名称,itemType:e.类型,description:c?`装备了《${e.名称}》，替换了《${c.名称}》`:`装备了《${e.名称}》`}),!0}catch(e){return console.error("装备物品失败:",e),X.o.error("装备失败"),!1}}async unequipItem(e){const t=(0,Xw.useActionQueueStore)();try{const a=(0,pu.useGameStateStore)(),r=a.toSaveData();if(!r)return X.o.error("装备栏数据不存在"),!1;const o=this.ensureEquipmentSlots(r),i=this.ensureRoleBackpack(r).物品;if(!i||"object"!=typeof i)return X.o.error("背包数据异常"),!1;const s=i[e.物品ID];if(!s||!0!==s.已装备){X.o.info(`《${e.名称}》未装备，无法卸下`);let t=!1;for(let n=1;n<=6;n++){const a=`装备${n}`;o[a]===e.物品ID&&(o[a]=null,t=!0)}return t&&(a.loadFromSaveData(r),await a.saveGame()),!1}this.removeConflictingActions(e.物品ID,"equip");let l=null;for(let t=1;t<=6;t++){const n=`装备${t}`;if(o[n]===e.物品ID){l=n;break}}if(!l){X.o.error("装备栏中未找到该装备，数据可能不一致");const t=this.ensureRoleBackpack(r);return t?.物品?.[e.物品ID]&&(t.物品[e.物品ID].已装备=!1),a.loadFromSaveData(r),await a.saveGame(),!0}o[l]=null,s?(i[e.物品ID]={...s,已装备:!1},console.log("卸下装备完成:",{物品:e.名称,物品ID:e.物品ID,清空槽位:l,已装备状态:!1})):console.warn("背包中未找到物品:",e.物品ID);const{removeEquipmentBonus:c}=await Promise.resolve().then(n.bind(n,651));c(r,e.物品ID),a.loadFromSaveData(r),await a.saveGame();const d={type:"unequip",itemId:e.物品ID,itemName:e.名称,restoreData:{originalSlot:l}};return this.undoActions.push(d),this.saveUndoHistoryToStorage(),t.addAction({type:"unequip",itemName:e.名称,itemType:e.类型,description:`卸下了《${e.名称}》`}),!0}catch(e){return console.error("卸下装备失败:",e),X.o.error("卸下失败"),!1}}async useItem(e,t=1){const n=(0,Xw.useActionQueueStore)();try{const a=(0,pu.useGameStateStore)(),r=a.toSaveData();if(!r)return X.o.error("存档数据不存在"),!1;const o=this.ensureRoleBackpack(r),i=o?.物品?.[e.物品ID];if(!i||i.数量<t)return X.o.error("物品数量不足"),!1;const s=i.数量,l=JSON.parse(JSON.stringify(i));i.数量===t?delete o.物品[e.物品ID]:i.数量-=t,a.updateInventory({物品:o.物品}),await a.saveGame();const c={type:"use",itemId:e.物品ID,itemName:e.名称,quantity:t,restoreData:{originalQuantity:s},itemData:l};this.undoActions.push(c),this.saveUndoHistoryToStorage();const d=["丹药","材料","其他"].includes(e.类型)&&"使用效果"in e?e.使用效果:e.描述||"无特殊效果";return n.addAction({type:"use",itemName:e.名称,itemType:e.类型,description:`使用了 ${t} 个《${e.名称}》（效果：${d}）`}),!0}catch(e){return console.error("使用物品失败:",e),X.o.error("使用失败"),!1}}async cultivateItem(e){const t=(0,Xw.useActionQueueStore)();try{const n=(0,pu.useGameStateStore)(),a=n.toSaveData();if(!a)return X.o.error("存档数据不存在，无法修炼功法"),!1;if("功法"!==e.类型)return X.o.error("只能修炼功法类物品"),!1;const r=this.ensureRoleBackpack(a).物品;if(!r||"object"!=typeof r)return X.o.error("背包数据异常"),!1;let o=null;const i=this.ensureRoleCultivation(a),s=i.修炼功法;if(s&&s.物品ID!==e.物品ID){o={...s};const e=s.物品ID,t=r[e];t&&"功法"===t.类型&&(r[e]={...t,已装备:!1,修炼中:!1})}const l=r[e.物品ID];if(!l||"功法"!==l.类型)return X.o.error("物品不是功法类型"),!1;i.修炼功法={物品ID:l.物品ID,名称:l.名称},r[e.物品ID]={...l,已装备:!0,修炼中:!0},n.loadFromSaveData(a),await n.saveGame();const c={type:"cultivate",itemId:e.物品ID,itemName:e.名称,restoreData:{originalCultivationState:{previousTechnique:o,wasInInventory:!0}}};return this.undoActions.push(c),this.saveUndoHistoryToStorage(),t.addAction({type:"cultivate",itemName:e.名称,itemType:e.类型,description:o?`开始修炼《${e.名称}》功法，停止修炼《${o.名称}》`:`开始修炼《${e.名称}》功法`}),!0}catch(e){return console.error("修炼功法失败:",e),X.o.error("修炼功法失败"),!1}}async stopCultivation(e){const t=(0,Xw.useActionQueueStore)();try{const n=(0,pu.useGameStateStore)(),a=n.toSaveData();if(!a)return X.o.error("存档数据不存在"),!1;const r=this.ensureRoleCultivation(a);if(!r?.修炼功法)return X.o.error("当前没有正在修炼的功法"),!1;const o=r.修炼功法,i=o.物品ID;if(o.名称!==e.名称)return X.o.error("操作的功法与当前修炼的功法不符"),!1;const s=this.ensureRoleBackpack(a).物品;if(!s||"object"!=typeof s)return X.o.error("背包数据异常"),!1;const l=s[i];r.修炼功法=null,l&&"功法"===l.类型&&(s[i]={...l,已装备:!1,修炼中:!1}),n.loadFromSaveData(a),await n.saveGame();const c={type:"cultivate",itemId:e.物品ID,itemName:e.名称,restoreData:{originalCultivationState:{previousTechnique:o?{...o}:null,wasInInventory:!1}}};return this.undoActions.push(c),this.saveUndoHistoryToStorage(),t.addAction({type:"stop_cultivation",itemName:e.名称,itemType:e.类型,description:`停止修炼《${e.名称}》功法`}),!0}catch(e){return console.error("停止修炼失败:",e),X.o.error("停止修炼失败"),!1}}async undoLastAction(){if(0===this.undoActions.length)return X.o.info("未找到可撤回的动作记录，可能已清空或刷新后丢失"),!1;const e=this.undoActions.pop();this.saveUndoHistoryToStorage();const t=(0,Xw.useActionQueueStore)();try{const n=(0,pu.useGameStateStore)().toSaveData();if(!n)return X.o.error("存档数据不存在"),!1;switch(e.type){case"equip":await this.undoEquip(e,n);break;case"unequip":await this.undoUnequip(e,n);break;case"use":await this.undoUse(e,n);break;case"cultivate":await this.undoCultivate(e,n)}const a=t.pendingActions;for(let n=a.length-1;n>=0;n--)if(a[n].itemName===e.itemName&&a[n].type===e.type){t.removeAction(a[n].id);break}return!0}catch(e){return console.error("撤回动作失败:",e),X.o.error("撤回失败"),!1}}async undoByItemName(e,t){if(0===this.undoActions.length)return X.o.info("未找到可撤回的动作记录，可能已清空或刷新后丢失"),!1;let n=-1;for(let a=this.undoActions.length-1;a>=0;a--){const r=this.undoActions[a];if(r.type===e&&r.itemName===t){n=a;break}}if(-1===n)return X.o.info("未找到该动作的撤回记录"),!1;const a=this.undoActions.splice(n,1)[0];this.saveUndoHistoryToStorage();try{const n=(0,pu.useGameStateStore)(),r=n.toSaveData();if(!r)return X.o.error("当前存档不存在，无法撤回"),!1;switch(a.type){case"equip":await this.undoEquip(a,r);break;case"unequip":await this.undoUnequip(a,r);break;case"use":await this.undoUse(a,r);break;case"cultivate":await this.undoCultivate(a,r)}const o=(0,Xw.useActionQueueStore)(),i=o.pendingActions;for(let n=i.length-1;n>=0;n--)if(i[n].itemName===t&&i[n].type===e){o.removeAction(i[n].id);break}return n.loadFromSaveData(r),await n.saveGame(),!0}catch(e){return console.error("按名称撤回失败:",e),X.o.error("撤回失败"),!1}}async undoEquip(e,t){const a=this.ensureEquipmentSlots(t),r=this.ensureRoleBackpack(t).物品;for(let o=1;o<=6;o++){const i=`装备${o}`;if(a[i]===e.itemId){const{removeEquipmentBonus:o}=await Promise.resolve().then(n.bind(n,651));if(o(t,e.itemId),a[i]=null,r?.[e.itemId]){const t=r[e.itemId];r[e.itemId]={...t,已装备:!1}}if(e.restoreData?.replacedItem){const{applyEquipmentBonus:o}=await Promise.resolve().then(n.bind(n,651));if(o(t,e.restoreData.replacedItem.物品ID),a[i]=e.restoreData.replacedItem.物品ID,r?.[e.restoreData.replacedItem.物品ID]){const t=r[e.restoreData.replacedItem.物品ID];r[e.restoreData.replacedItem.物品ID]={...t,已装备:!0}}}break}}}removeUndoAction(e,t){const n=this.undoActions.findIndex(n=>n.type===e&&n.itemName===t);-1!==n&&(this.undoActions.splice(n,1),this.saveUndoHistoryToStorage(),console.log("[撤销历史] 移除了一个已抵消的动作:",{type:e,itemName:t}))}async undoUnequip(e,t){if(!e.restoreData?.originalSlot)return;const a=e.restoreData.originalSlot;this.ensureEquipmentSlots(t)[a]=e.itemId;const r=this.ensureRoleBackpack(t).物品;if(r?.[e.itemId]){const t=r[e.itemId];r[e.itemId]={...t,已装备:!0}}const{applyEquipmentBonus:o}=await Promise.resolve().then(n.bind(n,651));o(t,e.itemId)}async undoUse(e,t){e.itemData?this.ensureRoleBackpack(t).物品[e.itemId]=JSON.parse(JSON.stringify(e.itemData)):X.o.warning("物品已完全消失，且无备份数据，无法恢复")}async undoCultivate(e,t){const n=e.restoreData?.originalCultivationState;if(!n)return;const a=this.ensureRoleBackpack(t).物品;if(!a||"object"!=typeof a)return void console.error("背包数据异常，无法撤回修炼");const r=this.ensureRoleCultivation(t);if(n.previousTechnique){const e=n.previousTechnique.物品ID;r.修炼功法={...n.previousTechnique};const t=a[e];t&&"功法"===t.类型&&(a[e]={...t,已装备:!0,修炼中:!0})}else r.修炼功法=null}clearUndoHistory(){this.undoActions=[],this.saveUndoHistoryToStorage()}getUndoActionsCount(){return this.undoActions.length}removeConflictingActions(e,t){const n=(0,Xw.useActionQueueStore)(),a=n.pendingActions.filter(n=>n.itemName&&n.type===t&&this.findItemByName(n.itemName)?.物品ID===e);a.forEach(e=>{n.removeAction(e.id)}),this.undoActions=this.undoActions.filter(n=>!(n.itemId===e&&n.type===t)),this.saveUndoHistoryToStorage(),a.length>0&&X.o.info("已移除冲突的操作")}findItemByName(e){const t=(0,pu.useGameStateStore)().toSaveData();if(!t)return null;const n=this.ensureEquipmentSlots(t),a=this.ensureRoleBackpack(t).物品;if(a)for(const t of Object.values(a))if(t&&"object"==typeof t&&t.名称===e)return t;for(let t=1;t<=6;t++){const r=n[`装备${t}`];if(!r)continue;const o=a?.[r];if(o&&o.名称===e)return o}return null}async syncEquipmentToTavern(e){console.warn("[装备同步] syncEquipmentToTavern 已废弃，新架构中数据由 gameStateStore 统一管理")}async syncInventoryToTavern(e){console.warn("[背包同步] syncInventoryToTavern 已废弃，新架构中数据由 gameStateStore 统一管理")}saveUndoHistoryToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.undoActions))}catch(e){console.warn("[撤回历史] 保存失败:",e)}}loadUndoHistoryFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);Array.isArray(t)&&(this.undoActions=t)}}catch(e){console.warn("[撤回历史] 加载失败:",e)}}}var Qw=n(9852);const eE={class:"formatted-text"},tE={class:"card-icon"},nE={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},aE={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},rE={key:2,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},oE={class:"card-content"},iE={class:"card-header"},sE={class:"judgement-title"},lE={class:"header-right"},cE={class:"judgement-badge"},dE={class:"card-body"},uE={key:0,class:"stat-item"},mE={class:"stat-info"},pE={class:"stat-value"},gE={key:1,class:"stat-item difficulty-item"},hE={class:"stat-info"},fE={class:"stat-value"},vE={key:2,class:"stat-item"},bE={class:"stat-info"},yE={class:"stat-value"},xE={key:3,class:"stat-item"},kE={class:"stat-info"},wE={class:"stat-value"},EE={key:4,class:"details-list"},NE={class:"detail-label"},SE={class:"detail-value"},VE={key:0,class:"detail-source"},_E={class:"help-modal-header"},CE={class:"help-modal-content"},AE={class:"help-section"},DE={class:"formula-box"},TE={class:"note"},BE={class:"help-section"},IE={class:"formula-note"},zE={class:"result-list"},ME={class:"result-item perfect"},PE={class:"result-label"},RE={class:"result-desc"},$E={class:"result-item great-success"},OE={class:"result-label"},LE={class:"result-desc"},FE={class:"result-item success"},jE={class:"result-label"},UE={class:"result-desc"},qE={class:"result-item failure"},GE={class:"result-label"},HE={class:"result-desc"},YE={class:"result-item critical-failure"},WE={class:"result-label"},XE={class:"result-desc"},JE={class:"help-section"},KE={class:"judgement-types"},ZE={class:"type-item"},QE={class:"type-name"},eN={class:"type-attrs"},tN={class:"type-item"},nN={class:"type-name"},aN={class:"type-attrs"},rN={class:"type-item"},oN={class:"type-name"},iN={class:"type-attrs"},sN={class:"type-item"},lN={class:"type-name"},cN={class:"type-attrs"},dN={class:"type-item"},uN={class:"type-name"},mN={class:"type-attrs"},pN={class:"help-section"},gN={class:"attributes-desc"},hN={class:"attr-card"},fN={class:"attr-header"},vN={class:"attr-name"},bN={class:"attr-card"},yN={class:"attr-header"},xN={class:"attr-name"},kN={class:"attr-card"},wN={class:"attr-header"},EN={class:"attr-name"},NN={class:"attr-card"},SN={class:"attr-header"},VN={class:"attr-name"},_N={class:"attr-card"},CN={class:"attr-header"},AN={class:"attr-name"},DN={class:"attr-card"},TN={class:"attr-header"},BN={class:"attr-name"},IN={class:"help-section"},zN={class:"tips-list"},MN=(0,r.defineComponent)({__name:"FormattedText",props:{text:{}},setup(e){const t=(0,r.ref)(!1),n=()=>{t.value=!0},a=()=>{t.value=!1},o=e,i=(0,r.computed)(()=>{const e=[],t=o.text||"";if(!t.trim())return[{type:"normal",content:t}];let n=0;const a=t.replace(/\\\\/g,"\n").replace(/\\n/g,"\n").replace(/\r\n/g,"\n").replace(/\r/g,"\n");for(;n<a.length;){const t=[],r=a.indexOf("【",n);if(-1!==r){const e=a.indexOf("】",r+1);-1!==e&&t.push({start:r,end:e+1,type:"environment",contentStart:r+1,contentEnd:e})}const o=a.indexOf("`",n);if(-1!==o){const e=a.indexOf("`",o+1);-1!==e&&t.push({start:o,end:e+1,type:"psychology",contentStart:o+1,contentEnd:e})}const i=a.indexOf('"',n);if(-1!==i){const e=a.indexOf('"',i+1);-1!==e&&t.push({start:i,end:e+1,type:"dialogue",contentStart:i+1,contentEnd:e})}const s=a.indexOf("“",n);if(-1!==s){const e=a.indexOf("”",s+1);-1!==e&&t.push({start:s,end:e+1,type:"quote",contentStart:s,contentEnd:e+1})}const l=a.indexOf("「",n);if(-1!==l){const e=a.indexOf("」",l+1);-1!==e&&t.push({start:l,end:e+1,type:"dialogue",contentStart:l,contentEnd:e+1})}const c=a.indexOf("〖",n);if(-1!==c){const e=a.indexOf("〗",c+1);-1!==e&&t.push({start:c,end:e+1,type:"judgement",contentStart:c+1,contentEnd:e})}const d=t.filter(e=>e.start>=n&&e.contentStart<e.contentEnd).sort((e,t)=>e.start-t.start);if(0===d.length){n<a.length&&e.push({type:"normal",content:a.slice(n)});break}const u=d[0];if(u.start>n){const t=a.slice(n,u.start);t&&e.push({type:"normal",content:t})}const m=a.slice(u.contentStart,u.contentEnd);if(m.trim())if("judgement"===u.type){const t=m.split(",").map(e=>e.trim());if(t.length>=1){const n=t[0].split(":");if(2===n.length){const a={title:n[0].trim(),result:n[1].trim(),dice:"未知",attribute:"",details:[]};for(let e=1;e<t.length;e++){const n=t[e],[r,o]=n.split(":").map(e=>e.trim());r&&o&&(r.includes("难度")?a.difficulty=o:r.includes("判定值")?a.finalValue=o:r.includes("加成")?a.bonus=o:r.includes("最终值")||r.includes("总值")?a.finalValue=o:r.includes("造成伤害")?a.damage=o:r.includes("剩余气血")?a.remainingHp=o:a.details?.push(`${r}:${o}`))}e.push({type:"judgement-card",content:a})}else if(1===n.length){const n={title:"系统提示",result:m.trim(),dice:"",attribute:"",details:[]};for(let e=1;e<t.length;e++){const a=t[e],[r,o]=a.split(":").map(e=>e.trim());r&&o&&(r.includes("难度")?n.difficulty=o:r.includes("加成")?n.bonus=o:r.includes("最终值")||r.includes("总值")?n.finalValue=o:r.match(/^[^\d\s]+$/)?n.attribute?n.details?.push(`${r}:${o}`):n.attribute=`${r}:${o}`:n.details?.push(a))}e.push({type:"judgement-card",content:n})}else e.push({type:"normal",content:`〖${m}〗`})}else e.push({type:"normal",content:`〖${m}〗`})}else e.push({type:u.type,content:a.slice(u.start,u.end)});n=u.end}return e.length>0?e:[{type:"normal",content:t}]}),s=e=>["成功","大成功","完美","通过"].includes(e),l=e=>["失败","大失败","失败惨重","未通过"].includes(e),c=e=>e.split(":")[0]+":",d=e=>{const t=e.split(":");if(t.length<2)return"";const n=t[1],a=n.match(/^([+-]?\d+)/);return a?a[1]:n.split("(")[0].trim()},u=e=>{const t=e.split(":");if(t.length<2)return"";const n=t[1].match(/\(([^)]+)\)/);return n?`(${n[1]})`:""};return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createElementVNode)("div",eE,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:t},["judgement-card"!==e.type?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)((i=e.type,{"text-environment":"environment"===i,"text-psychology":"psychology"===i,"text-dialogue":"dialogue"===i,"text-quote":"quote"===i,"text-normal":"normal"===i}))},(0,r.toDisplayString)(e.content),3)):(a=e.content,"object"==typeof a&&null!==a&&"title"in a?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:(0,r.normalizeClass)(["judgement-card",{"is-success":s(e.content.result),"is-failure":l(e.content.result),"is-great-success":e.content.result?.includes("大成功"),"is-great-failure":e.content.result?.includes("大失败")}])},[(0,r.createElementVNode)("div",tE,[s(e.content.result)?((0,r.openBlock)(),(0,r.createElementBlock)("svg",nE,o[1]||(o[1]=[(0,r.createElementVNode)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),(0,r.createElementVNode)("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)]))):l(e.content.result)?((0,r.openBlock)(),(0,r.createElementBlock)("svg",aE,o[2]||(o[2]=[(0,r.createElementVNode)("circle",{cx:"12",cy:"12",r:"10"},null,-1),(0,r.createElementVNode)("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),(0,r.createElementVNode)("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)]))):((0,r.openBlock)(),(0,r.createElementBlock)("svg",rE,o[3]||(o[3]=[(0,r.createElementVNode)("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},null,-1),(0,r.createElementVNode)("line",{x1:"12",y1:"9",x2:"12",y2:"13"},null,-1),(0,r.createElementVNode)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"},null,-1)])))]),(0,r.createElementVNode)("div",oE,[(0,r.createElementVNode)("div",iE,[(0,r.createElementVNode)("span",sE,(0,r.toDisplayString)(e.content.title),1),(0,r.createElementVNode)("div",lE,[(0,r.createElementVNode)("span",cE,(0,r.toDisplayString)(e.content.result),1),(0,r.createElementVNode)("button",{class:"help-btn",onClick:(0,r.withModifiers)(n,["stop"]),title:"查看判定规则"},o[4]||(o[4]=[(0,r.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,r.createElementVNode)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.createElementVNode)("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),(0,r.createElementVNode)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)]))])]),(0,r.createElementVNode)("div",dE,[e.content.finalValue?((0,r.openBlock)(),(0,r.createElementBlock)("div",uE,[o[6]||(o[6]=(0,r.createElementVNode)("span",{class:"stat-icon"},"✨",-1)),(0,r.createElementVNode)("div",mE,[o[5]||(o[5]=(0,r.createElementVNode)("span",{class:"stat-label"},"判定值",-1)),(0,r.createElementVNode)("span",pE,(0,r.toDisplayString)(e.content.finalValue),1)])])):(0,r.createCommentVNode)("v-if",!0),e.content.difficulty?((0,r.openBlock)(),(0,r.createElementBlock)("div",gE,[o[8]||(o[8]=(0,r.createElementVNode)("span",{class:"stat-icon"},"🎯",-1)),(0,r.createElementVNode)("div",hE,[o[7]||(o[7]=(0,r.createElementVNode)("span",{class:"stat-label"},"难度",-1)),(0,r.createElementVNode)("span",fE,(0,r.toDisplayString)(e.content.difficulty),1)])])):(0,r.createCommentVNode)("v-if",!0),e.content.damage?((0,r.openBlock)(),(0,r.createElementBlock)("div",vE,[o[10]||(o[10]=(0,r.createElementVNode)("span",{class:"stat-icon"},"⚔️",-1)),(0,r.createElementVNode)("div",bE,[o[9]||(o[9]=(0,r.createElementVNode)("span",{class:"stat-label"},"伤害",-1)),(0,r.createElementVNode)("span",yE,(0,r.toDisplayString)(e.content.damage),1)])])):(0,r.createCommentVNode)("v-if",!0),e.content.remainingHp?((0,r.openBlock)(),(0,r.createElementBlock)("div",xE,[o[12]||(o[12]=(0,r.createElementVNode)("span",{class:"stat-icon"},"❤️",-1)),(0,r.createElementVNode)("div",kE,[o[11]||(o[11]=(0,r.createElementVNode)("span",{class:"stat-label"},"剩余气血",-1)),(0,r.createElementVNode)("span",wE,(0,r.toDisplayString)(e.content.remainingHp),1)])])):(0,r.createCommentVNode)("v-if",!0),e.content.details&&e.content.details.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",EE,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.content.details,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"detail-item",key:t},[(0,r.createElementVNode)("span",NE,(0,r.toDisplayString)(c(e)),1),(0,r.createElementVNode)("span",SE,(0,r.toDisplayString)(d(e)),1),u(e)?((0,r.openBlock)(),(0,r.createElementBlock)("span",VE,(0,r.toDisplayString)(u(e)),1)):(0,r.createCommentVNode)("v-if",!0)]))),128))])):(0,r.createCommentVNode)("v-if",!0)])])],2)):(0,r.createCommentVNode)("v-if",!0))],64);var a,i}),128))]),(0,r.createCommentVNode)(" 判定规则帮助弹窗 "),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:"body"},[t.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"help-modal-overlay",onClick:a},[(0,r.createElementVNode)("div",{class:"help-modal",onClick:o[0]||(o[0]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",_E,[(0,r.createElementVNode)("h3",null,"🎲 "+(0,r.toDisplayString)(e.$t("判定规则说明")),1),(0,r.createElementVNode)("button",{class:"close-btn",onClick:a},o[13]||(o[13]=[(0,r.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,r.createElementVNode)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,r.createElementVNode)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),(0,r.createElementVNode)("div",CE,[(0,r.createElementVNode)("div",AE,[(0,r.createElementVNode)("h4",null,"📊 "+(0,r.toDisplayString)(e.$t("判定计算公式"))+" (v6.0)",1),(0,r.createElementVNode)("div",DE,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("最终判定值")),1),(0,r.createTextVNode)(" = "+(0,r.toDisplayString)(e.$t("基础值"))+" + "+(0,r.toDisplayString)(e.$t("骰子加成"))+" + "+(0,r.toDisplayString)(e.$t("环境修正"))+" + "+(0,r.toDisplayString)(e.$t("状态修正")),1)]),(0,r.createElementVNode)("ol",null,[(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("基础值")),1),(0,r.createTextVNode)("："+(0,r.toDisplayString)(e.$t("先天属性加权 + 境界加成 + 技艺加成")),1)]),(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("骰子加成")),1),(0,r.createTextVNode)("："+(0,r.toDisplayString)(e.$t("(原始骰子 × 气运系数 - 50) ÷ 5"))+" ",1),(0,r.createElementVNode)("span",TE,"("+(0,r.toDisplayString)(e.$t("受【气运】影响，点数<50为负"))+")",1)]),(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("环境修正")),1),(0,r.createTextVNode)("："+(0,r.toDisplayString)(e.$t("灵气浓度影响（修炼/炼丹/战斗），探索社交不受影响")),1)]),(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("状态修正")),1),(0,r.createTextVNode)("："+(0,r.toDisplayString)(e.$t("生命状态（重伤/虚弱）及 Buff/Debuff 影响")),1)])])]),(0,r.createElementVNode)("div",BE,[(0,r.createElementVNode)("h4",null,"🎯 "+(0,r.toDisplayString)(e.$t("判定结果")),1),(0,r.createElementVNode)("div",IE,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.$t("判定规则")),1),(0,r.createTextVNode)(": "+(0,r.toDisplayString)(e.$t("判定值与难度对比，完全基于属性、境界和加成")),1)]),(0,r.createElementVNode)("div",zE,[(0,r.createElementVNode)("div",ME,[(0,r.createElementVNode)("span",PE,(0,r.toDisplayString)(e.$t("完美")),1),(0,r.createElementVNode)("span",RE,(0,r.toDisplayString)(e.$t("判定值 ≥ 难度+30")),1)]),(0,r.createElementVNode)("div",$E,[(0,r.createElementVNode)("span",OE,(0,r.toDisplayString)(e.$t("大成功")),1),(0,r.createElementVNode)("span",LE,(0,r.toDisplayString)(e.$t("判定值 ≥ 难度+15，超额完成")),1)]),(0,r.createElementVNode)("div",FE,[(0,r.createElementVNode)("span",jE,(0,r.toDisplayString)(e.$t("成功")),1),(0,r.createElementVNode)("span",UE,(0,r.toDisplayString)(e.$t("判定值 ≥ 难度，达成目标")),1)]),(0,r.createElementVNode)("div",qE,[(0,r.createElementVNode)("span",GE,(0,r.toDisplayString)(e.$t("失败")),1),(0,r.createElementVNode)("span",HE,(0,r.toDisplayString)(e.$t("判定值 < 难度，未达成")),1)]),(0,r.createElementVNode)("div",YE,[(0,r.createElementVNode)("span",WE,(0,r.toDisplayString)(e.$t("大失败")),1),(0,r.createElementVNode)("span",XE,(0,r.toDisplayString)(e.$t("判定值远低于难度（难度-15以下）")),1)])])]),(0,r.createElementVNode)("div",JE,[(0,r.createElementVNode)("h4",null,"⚔️ "+(0,r.toDisplayString)(e.$t("判定类型与属性配比")),1),(0,r.createElementVNode)("div",KE,[(0,r.createElementVNode)("div",ZE,[(0,r.createElementVNode)("span",QE,(0,r.toDisplayString)(e.$t("战斗判定")),1),(0,r.createElementVNode)("span",eN,(0,r.toDisplayString)(e.$t("根骨50% + 灵性30% + 气运20%")),1)]),(0,r.createElementVNode)("div",tN,[(0,r.createElementVNode)("span",nN,(0,r.toDisplayString)(e.$t("修炼判定")),1),(0,r.createElementVNode)("span",aN,(0,r.toDisplayString)(e.$t("悟性50% + 灵性30% + 心性20%")),1)]),(0,r.createElementVNode)("div",rN,[(0,r.createElementVNode)("span",oN,(0,r.toDisplayString)(e.$t("技艺判定")),1),(0,r.createElementVNode)("span",iN,(0,r.toDisplayString)(e.$t("悟性50% + 根骨30% + 灵性20%")),1)]),(0,r.createElementVNode)("div",sN,[(0,r.createElementVNode)("span",lN,(0,r.toDisplayString)(e.$t("社交判定")),1),(0,r.createElementVNode)("span",cN,(0,r.toDisplayString)(e.$t("魅力50% + 悟性30% + 心性20%")),1)]),(0,r.createElementVNode)("div",dN,[(0,r.createElementVNode)("span",uN,(0,r.toDisplayString)(e.$t("探索判定")),1),(0,r.createElementVNode)("span",mN,(0,r.toDisplayString)(e.$t("气运50% + 灵性30% + 悟性20%")),1)])])]),(0,r.createElementVNode)("div",pN,[(0,r.createElementVNode)("h4",null,"📖 "+(0,r.toDisplayString)(e.$t("六司属性说明")),1),(0,r.createElementVNode)("div",gN,[(0,r.createElementVNode)("div",hN,[(0,r.createElementVNode)("div",fN,[o[14]||(o[14]=(0,r.createElementVNode)("span",{class:"attr-icon"},"💪",-1)),(0,r.createElementVNode)("span",vN,(0,r.toDisplayString)(e.$t("根骨")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定气血上限、恢复速度、寿命上限。影响炼体修行、抗打击能力。")),1)]),(0,r.createElementVNode)("div",bN,[(0,r.createElementVNode)("div",yN,[o[15]||(o[15]=(0,r.createElementVNode)("span",{class:"attr-icon"},"✨",-1)),(0,r.createElementVNode)("span",xN,(0,r.toDisplayString)(e.$t("灵性")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定灵气上限、吸收效率。影响修炼速度、法术威力。")),1)]),(0,r.createElementVNode)("div",kN,[(0,r.createElementVNode)("div",wN,[o[16]||(o[16]=(0,r.createElementVNode)("span",{class:"attr-icon"},"🧠",-1)),(0,r.createElementVNode)("span",EN,(0,r.toDisplayString)(e.$t("悟性")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定神识上限、学习效率。影响功法领悟、技能掌握速度。")),1)]),(0,r.createElementVNode)("div",NN,[(0,r.createElementVNode)("div",SN,[o[17]||(o[17]=(0,r.createElementVNode)("span",{class:"attr-icon"},"🍀",-1)),(0,r.createElementVNode)("span",VN,(0,r.toDisplayString)(e.$t("气运")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定各种概率、物品掉落品质。影响天材地宝获取、贵人相助。")),1)]),(0,r.createElementVNode)("div",_N,[(0,r.createElementVNode)("div",CN,[o[18]||(o[18]=(0,r.createElementVNode)("span",{class:"attr-icon"},"🌺",-1)),(0,r.createElementVNode)("span",AN,(0,r.toDisplayString)(e.$t("魅力")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定初始好感度、社交加成。影响NPC互动、门派声望获取。")),1)]),(0,r.createElementVNode)("div",DN,[(0,r.createElementVNode)("div",TN,[o[19]||(o[19]=(0,r.createElementVNode)("span",{class:"attr-icon"},"💎",-1)),(0,r.createElementVNode)("span",BN,(0,r.toDisplayString)(e.$t("心性")),1)]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.$t("决定心魔抗性、意志力。影响走火入魔抵抗、关键抉择。")),1)])])]),(0,r.createElementVNode)("div",IN,[(0,r.createElementVNode)("h4",null,"💡 "+(0,r.toDisplayString)(e.$t("提升判定成功率")),1),(0,r.createElementVNode)("ul",zN,[(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("先天六司：天赋决定上限，无法改变但影响最大")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("提升境界：境界越高，判定基础加成越大（炼气+5，筑基+12...）")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("修炼后天：后天六司可提升，但权重仅20%")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("学习功法：高品质功法和技能熟练度提供显著加成")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("装备法器：合适的装备能大幅提升判定值")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("状态效果：buff增强判定，注意避免debuff")),1),(0,r.createElementVNode)("li",null,(0,r.toDisplayString)(e.$t("境界压制：高境界对低境界有明显优势，但不是绝对")),1)])])])])])):(0,r.createCommentVNode)("v-if",!0)]))],64))}});var PN=n(1321),RN={};RN.styleTagTransform=k(),RN.setAttributes=v(),RN.insert=h().bind(null,"head"),RN.domAPI=p(),RN.insertStyleElement=y(),u()(PN.A,RN),PN.A&&PN.A.locals&&PN.A.locals;const $N=(0,N.A)(MN,[["__scopeId","data-v-fa8db44c"]]),ON={class:"main-game-panel"},LN={key:0,class:"memory-section"},FN={class:"memory-title"},jN={key:0,class:"memory-dropdown"},UN={class:"memory-content"},qN={key:0,class:"no-memory"},GN={class:"current-narrative"},HN={key:0,class:"ai-processing-indicator"},YN={class:"streaming-meta"},WN={class:"narrative-time"},XN={class:"streaming-indicator"},JN={class:"streaming-text"},KN=["title"],ZN={key:1,class:"streaming-narrative-content"},QN={class:"streaming-text"},eS={class:"narrative-content"},tS={class:"narrative-meta"},nS={class:"narrative-time"},aS={class:"meta-buttons"},rS=["title"],oS=["disabled","title"],iS={class:"update-count"},sS={class:"narrative-text"},lS={key:0,class:"action-options"},cS=["onClick"],dS={key:3,class:"empty-narrative"},uS={class:"input-section"},mS={key:0,class:"action-queue-display"},pS={class:"queue-header"},gS={class:"queue-title"},hS=["title"],fS={class:"queue-actions"},vS={class:"action-text"},bS={class:"action-controls"},yS=["onClick","title"],xS={class:"input-wrapper"},kS={class:"input-container"},wS={key:0,class:"image-preview-container"},ES=["src","alt"],NS=["onClick","title"],SS=["placeholder","disabled"],VS=["disabled"],_S={class:"action-modal"},CS={class:"modal-header"},AS={class:"action-grid"},DS=["onClick"],TS={class:"action-icon"},BS={class:"action-text"},IS={class:"action-config-modal"},zS={class:"config-header"},MS={class:"config-content"},PS={class:"action-description"},RS={key:0,class:"config-section"},$S={class:"config-label"},OS={class:"time-selector"},LS=["onClick"],FS={class:"time-custom"},jS={key:1,class:"config-section"},US={class:"config-label"},qS={class:"action-options"},GS=["name","value"],HS={class:"config-actions"},YS="__mainGamePanel_eventListenersRegistered__",WS="__mainGamePanel_eventHandlers__",XS=(0,r.defineComponent)({__name:"MainGamePanel",setup(e,{expose:t}){const n=(0,r.computed)(()=>L.value?.stateChanges?.changes||[]),a=(0,r.computed)({get:()=>C.userInputText,set:e=>{C.userInputText=e}}),o=(0,r.ref)(!1),i=(0,r.computed)(()=>C.isAIProcessing),s=(0,r.computed)(()=>C.streamingContent),l=(0,r.computed)(()=>C.currentGenerationId),c=(0,r.computed)(()=>C.streamingContent.length),d=(0,r.ref)(),u=(0,r.ref)(),m=(0,r.ref)(!1),p=(0,r.ref)(!0),g=async({text:e,focus:t})=>{C.userInputText=e,!1!==t&&(await(0,r.nextTick)(),d.value?.focus())},h=async({text:e,focus:t})=>{C.isAIProcessing?X.o.warning(S("AI正在生成中，请稍后再试")):(C.userInputText=e,!1!==t&&(await(0,r.nextTick)(),d.value?.focus()),await(0,r.nextTick)(),le())},f=()=>{m.value=!m.value},v=()=>{"true"===sessionStorage.getItem("ai-processing-state")&&(C.setAIProcessing(!0),console.log("[状态恢复] 恢复AI处理状态"))},b=()=>{C.isAIProcessing?(sessionStorage.setItem("ai-processing-state","true"),sessionStorage.setItem("ai-processing-timestamp",Date.now().toString())):(sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp"))},y=()=>{console.log("[强制重置] 清除AI处理状态和会话存储"),C.resetStreamingState(),z.value=null,re.value="",b(),X.o.info(S("AI处理状态已重置"))},x=(0,r.ref)(!1),k=(0,r.ref)(null),w=(0,r.ref)(1),E=(0,r.ref)(1),N=(0,r.ref)(""),{t:S}=(0,K.s)(),V=(0,Jc.useCharacterStore)(),_=(0,Xw.useActionQueueStore)(),C=(0,A.useUIStore)(),D=(0,pu.useGameStateStore)(),T=(0,se.isTavernEnv)(),B=Zw.getInstance(),I=Qw.J,z=(0,r.ref)(null),M=(0,r.computed)({get:()=>C.useStreaming,set:e=>{C.useStreaming=e}}),P=window;P[YS]||(P[YS]=!1),P[WS]||(P[WS]={});const R=(0,r.ref)([]),$=(0,r.ref)(),O=e=>{const t=e.target;if(t.files&&t.files.length>0){const e=Array.from(t.files);R.value.push(...e),console.log("[图片上传] 已选择图片:",e.length,"张"),X.o.success(`已选择 ${e.length} 张图片`)}},L=(0,r.computed)(()=>{const e=D.narrativeHistory,t=D.memory?.短期记忆,n=ce();let a="";if(t&&t.length>0?a=t[t.length-1].replace(/^【.*?】\s*/,""):e&&e.length>0&&(a=e[e.length-1].content.replace(/^【.*?】\s*/,"")),e&&e.length>0){const t=e[e.length-1];return{type:t.type||"narrative",content:a||"...",time:n,stateChanges:t.stateChanges||{changes:[]},actionOptions:t.actionOptions||[]}}return{type:"system",content:a||"开局生成失败，请检查API上下文长度是否足够，是否使用支持流式的API，然后返回主页重新开始生成。",time:n,stateChanges:{changes:[]},actionOptions:[]}}),F=((0,r.ref)(!1),(0,r.ref)(!1),(0,r.ref)(""),(0,r.ref)(!1),(0,r.ref)(null)),j=(0,r.ref)(3),U=(0,r.ref)(25),q=(0,r.ref)(8);t({updateMemorySettings:(e,t)=>{void 0!==e&&e>0&&(j.value=e),void 0!==t&&t>0&&(U.value=t),(()=>{try{const e={maxShortTerm:j.value,maxMidTerm:U.value};localStorage.setItem("memory-settings",JSON.stringify(e)),console.log("[记忆设置] 已保存配置:",e)}catch(e){console.warn("[记忆设置] 保存配置失败:",e)}})(),console.log("[记忆设置] 配置已更新:",{短期记忆上限:j.value,中期记忆上限:U.value})},getMemorySettings:()=>({maxShortTerm:j.value,maxMidTerm:U.value})});const G=(0,r.computed)(()=>!!D.character),H=(0,r.computed)(()=>{const e=V.activeCharacterProfile;if(!e||"单机"!==e.模式)return!1;const t=e.存档列表?.["上次对话"];return null!=t?.存档数据}),Y=async()=>{H.value?C.showRetryDialog({title:"回滚确认",message:"确定要回滚到上次对话前的状态吗？当前进度将被替换。",confirmText:"确认回滚",cancelText:"取消",onConfirm:async()=>{try{await V.rollbackToLastConversation(),X.o.success("已回滚到上次对话前的状态")}catch(e){console.error("回滚失败:",e),X.o.error(`回滚失败: ${e instanceof Error?e.message:"未知错误"}`)}},onCancel:()=>{}}):X.o.warning("没有可回滚的存档")},W=(0,r.computed)(()=>{const e=[];return Z.value.forEach(t=>{e.push(...t.actions)}),e}),J=(0,r.ref)([{label:"1天",value:1},{label:"3天",value:3},{label:"7天",value:7},{label:"30天",value:30}]),Z=(0,r.ref)([{name:"修炼",icon:"",actions:[{name:"基础修炼",icon:"⚡",type:"cultivation",description:"吐纳天地灵气，淬炼自身修为，是提升境界的根本之法。",timeRequired:!0},{name:"炼体",icon:"Shield",iconComponent:um.A,type:"cultivation",description:"以灵气或外力锤炼肉身，强化筋骨皮膜，增强体魄与防御。",timeRequired:!0},{name:"冥想",icon:"BrainCircuit",iconComponent:Uw,type:"cultivation",description:"沉入心海，观想天地，可稳固心境，提升神识，偶有顿悟。",timeRequired:!0}]},{name:"探索",icon:"",actions:[{name:"野外探索",icon:"",type:"exploration",description:"前往野外探索，寻找机缘",options:[{key:"nearby",label:"附近区域"},{key:"far",label:"远方区域"},{key:"dangerous",label:"危险区域"}]},{name:"城镇逛街",icon:"",type:"exploration",description:"在城镇中闲逛，了解信息",options:[{key:"market",label:"集市"},{key:"tavern",label:"酒楼"},{key:"shop",label:"商铺"}]}]},{name:"交流",icon:"",actions:[{name:"拜访朋友",icon:"",type:"social",description:"拜访认识的朋友",options:[{key:"random",label:"随机拜访"},{key:"close",label:"亲密朋友"}]},{name:"结交新友",icon:"",type:"social",description:"主动结交新的朋友"}]},{name:"其他",icon:"",actions:[{name:"休息",icon:"",type:"other",description:"好好休息，恢复精神",timeRequired:!0},{name:"查看状态",icon:"",type:"other",description:"查看当前的详细状态"}]}]);T||(Z.value=Z.value.map(e=>({...e,actions:e.actions.map(e=>{const t=e.options?.filter(e=>"tavern"!==e.key);return t?{...e,options:t}:e})})));const Q=()=>{x.value=!1},ee=()=>{k.value=null,w.value=1,E.value=1,N.value=""},te=()=>{if(!k.value)return;let e=k.value.name;if(k.value.timeRequired&&(e+=`（${E.value>0?E.value:w.value}天）`),N.value&&k.value.options){const t=k.value.options.find(e=>e.key===N.value);t&&(e+=`（${t.label}）`)}a.value=e,ee(),(0,r.nextTick)(()=>{d.value?.focus()})},ne=(0,r.computed)(()=>{const e=D.memory?.短期记忆;return e&&e.length>0?e.slice():[]}),ae=e=>{const t=[];if(!e)return t.push("AI响应为空"),{isValid:!1,errors:t};const n=e;return n.text&&"string"==typeof n.text||t.push("缺少有效的text字段"),n.mid_term_memory&&"string"==typeof n.mid_term_memory?0===n.mid_term_memory.trim().length&&t.push("mid_term_memory字段不能为空"):t.push("缺少必要的mid_term_memory字段（中期记忆总结）"),n.tavern_commands&&(Array.isArray(n.tavern_commands)?n.tavern_commands.forEach((e,n)=>{const a=e;e&&"object"==typeof e?a.action&&a.key||t.push(`tavern_commands[${n}]缺少必要字段(action/key)`):t.push(`tavern_commands[${n}]不是有效对象`)}):t.push("tavern_commands字段必须是数组")),{isValid:0===t.length,errors:t}},re=(0,r.ref)(""),oe=e=>!!e.type&&(!["npc_trade","npc_request","npc_steal"].includes(e.type)&&["equip","unequip","use","cultivate"].includes(e.type)),ie=async()=>{_.clearActions(),X.o.success("操作记录已清空")},le=async()=>{if(!a.value.trim())return;if(i.value)return void X.o.warning("AI正在处理中，请稍等...");if(!G.value)return void X.o.error("请先选择或创建角色");const e=D.toSaveData();if(e){if(void 0!==e.角色?.属性?.气血?.当前&&e.角色.属性.气血.当前<=0)return void X.o.error("角色已死亡，气血耗尽。无法继续游戏，请重新开始或复活角色。");if(void 0!==e.角色?.属性?.寿命?.当前&&void 0!==e.角色?.属性?.寿命?.上限&&e.角色.属性.寿命.当前>=e.角色.属性.寿命.上限)return void X.o.error("角色已死亡，寿元耗尽。无法继续游戏，请重新开始或复活角色。")}if(D.conversationAutoSaveEnabled)try{await V.saveToSlot("上次对话"),console.log("[上次对话] 已在发送消息前备份当前状态")}catch(e){console.warn("[上次对话] 备份失败（非致命）:",e)}const t=a.value.trim();console.log("[前端] 用户输入 inputText.value:",a.value),console.log("[前端] 处理后 userMessage:",t);const n=_.getActionPrompt();console.log("[前端] 动作队列 actionQueueText:",n);let o="";o=t?`<行动趋向>${n?`${t}\n\n${n}`:t}</行动趋向>\n`:n?`<行动趋向>${n}</行动趋向>\n`:"",console.log("[前端] 最终发送 finalUserMessage:",o),n&&_.clearActions(),(0,r.nextTick)(()=>{ue()}),C.setAIProcessing(!0),b(),C.setStreamingContent(""),re.value="",z.value=1;let l=null,c=!1;try{const e=V.activeCharacterProfile;if(!e)throw new Error("角色数据缺失");try{const t={onProgressUpdate:e=>{console.log("[AI进度]",e)},useStreaming:M.value};T||(console.log("[网页版流式] 设置 onStreamChunk 回调"),t.onStreamChunk=e=>{M.value&&e&&(console.log("[网页版流式] 收到chunk:",e.length,"字符"),re.value+=e,C.setStreamingContent(re.value))});const n=`gen_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;if(C.setCurrentGenerationId(n),t.generation_id=n,R.value.length>0&&(t.image=R.value,console.log("[图片上传] 将发送",R.value.length,"张图片")),l=await I.processPlayerAction(o,e,t),l){const t=ae(l);if(!t.isValid){console.warn("[AI响应验证] 结构验证失败:",t.errors),X.o.warning("AI响应格式不正确，正在重试...");const n=await(async(e,t,n,a=2)=>{console.log("[AI响应重试] 开始重试，之前的错误:",n);for(let r=1;r<=a;r++)try{console.log(`[AI响应重试] 第${r}次尝试`),C.setStreamingContent(""),re.value="";const a=`gen_retry_${r}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;C.setCurrentGenerationId(a);const o=`${e}\n\n## 输出格式（必须严格遵守）\n\n**重要：以下3个字段都是必需的，缺一不可！**\n\n{\n  "text": "Narrative text(中文简体，字数越多越好1000-3000，往用户趋向去尝试行动)",\n  "mid_term_memory": "Brief summary",\n  "tavern_commands": [{"action": "Action", "key": "key.path", "value": Value/List}]\n}\n\n下面为tavern_commands的行动命令类型\n\n# Action Types\n\n| Action | Purpose | Example |\n|--------|---------|---------|\n| set | Replace/Set | Update state |\n| add | Increase/Decrease | Change numerical values |\n| push | Add to array | Record history |\n| delete | Remove field | Clear data |\n| pull | Remove from array | Remove array element |\n\n---\n\n\n上次响应的问题：${n.join(", ")}\n请修正这些问题并确保结构正确。`,i={onProgressUpdate:e=>{console.log("[AI重试进度]",e)},useStreaming:M.value,generation_id:a};T||(console.log("[网页版流式-重试] 设置 onStreamChunk 回调"),i.onStreamChunk=e=>{M.value&&e&&(console.log("[网页版流式-重试] 收到chunk:",e.length,"字符"),re.value+=e,C.setStreamingContent(re.value))});const s=await I.processPlayerAction(o,t,i);if(s){const e=ae(s);if(e.isValid)return console.log(`[AI响应重试] 第${r}次尝试成功`),s;console.warn(`[AI响应重试] 第${r}次尝试验证失败:`,e.errors),n=e.errors}}catch(e){console.error(`[AI响应重试] 第${r}次尝试出错:`,e)}return console.error("[AI响应重试] 所有重试尝试都失败了"),null})(o,e,t.errors);if(!n)throw new Error("AI响应格式错误，且多次重试失败");l=n,console.log("[AI响应验证] 重试成功")}}console.log("[流式输出] AI响应处理开始");let a="";const r=l;if(console.log("[AI响应处理] 开始处理AI响应文本"),console.log("[AI响应处理] aiResponse:",l),console.log("[AI响应处理] streamingContent:",s.value),r?.text&&"string"==typeof r.text?(a=r.text,console.log("[AI响应处理] 使用 gmResponse.text 作为最终文本，长度:",a.length)):s.value?(a=s.value,console.log("[AI响应处理] 使用 streamingContent 作为最终文本，长度:",a.length)):console.warn("[AI响应处理] 未找到任何有效的文本内容"),console.log("[AI响应处理] 最终文本内容预览:",a.substring(0,100)+"..."),a?(console.log("[AI响应处理] 文本处理完成，记忆已由 AIBidirectionalSystem 处理"),F.value=r?.text||null,L.value&&console.log("[AI响应处理] 已更新UI显示")):(F.value=null,console.error("[AI响应处理] 没有找到有效的文本内容")),l&&l.stateChanges){C.clearCurrentMessageStateChanges(),console.log("[日志清空] 收到新响应，已清空上一条消息的状态变更日志");const e=l.stateChanges&&"object"==typeof l.stateChanges&&"changes"in l.stateChanges?l.stateChanges:{changes:[]};console.log("[状态更新] AI指令已执行，状态变更数量:",e.changes.length),l.stateChanges&&(C.setCurrentMessageStateChanges(l.stateChanges),console.log("[日志面板] State changes received and stored in memory:",l.stateChanges));const t=D.toSaveData();t&&(void 0!==t.属性?.气血?.当前&&t.属性.气血.当前<=0&&X.o.error("角色已死亡，气血耗尽"),void 0!==t.属性?.寿命?.当前&&void 0!==t.属性?.寿命?.上限&&t.属性.寿命.当前>=t.属性.寿命.上限&&X.o.error("角色已死亡，寿元耗尽"))}else l&&console.log("[日志面板] No state changes received in this response.")}catch(e){console.error("[AI处理失败]",e),c=!0;const t=e instanceof Error?e.message:"未知错误";X.o.error(`AI处理失败: ${t}`),C.setAIProcessing(!1),z.value=null,C.setStreamingContent(""),re.value="",C.setCurrentGenerationId(null),b(),l=null}l&&l.system_messages&&Array.isArray(l.system_messages)&&l.system_messages.length,!c&&l&&(X.o.success("成功"),R.value=[],$.value&&($.value.value="")),c||(console.log("[AI响应处理] 处理完成，清除AI处理状态"),C.setAIProcessing(!1),z.value=null,C.setCurrentGenerationId(null),C.resetStreamingState(),re.value="",b())}catch(e){console.error("[AI交互] 处理失败:",e),c=!0;const t=e instanceof Error?e.message:"未知错误";X.o.error(`请求失败: ${t}`),C.setAIProcessing(!1),z.value=null,C.setStreamingContent(""),re.value="",C.setCurrentGenerationId(null),b()}finally{if(i.value&&(console.warn("[AI响应处理] finally块：状态未清除，强制清除（兜底）"),C.setAIProcessing(!1),z.value=null,C.resetStreamingState(),re.value="",C.setCurrentGenerationId(null),b()),l)try{console.log("[AI响应处理] 最终统一存档..."),await V.saveCurrentGame();const e=V.activeSaveSlot;e&&X.o.success(`存档【${e.存档名}】已保存`),console.log("[AI响应处理] 最终统一存档完成")}catch(e){console.error("[AI响应处理] 最终统一存档失败:",e),X.o.error("游戏存档失败，请尝试手动保存")}}},ce=()=>{const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},de=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),le())},ue=()=>{const e=d.value;if(e){const t=36.16;e.style.height=`${t}px`;const n=e.scrollHeight,a=120;if(n>t){const t=Math.min(n,a);e.style.height=`${t}px`}e.style.overflowY=n>a?"auto":"hidden"}},me=()=>{(0,r.nextTick)(()=>{ue()})},pe=async()=>{console.log("[主面板] 为当前存档初始化面板 (新逻辑)...");try{if(G.value){const e=D.memory?.短期记忆;if(console.log("[主面板-调试] 存档数据检查:",{有游戏数据:D.isGameLoaded,有叙事历史:!!D.narrativeHistory,叙事历史长度:D.narrativeHistory?.length||0,有短期记忆:!!e,短期记忆长度:e?.length||0,当前显示内容:L.value?.content?.substring(0,50)+"..."}),D.narrativeHistory&&D.narrativeHistory.length>0){const t=D.narrativeHistory[D.narrativeHistory.length-1];t.stateChanges&&(C.setCurrentMessageStateChanges(t.stateChanges),console.log("[主面板] ✅ 已同步指令日志到最新叙事",{变更数量:t.stateChanges.changes?.length||0})),e&&0!==e.length||t.content&&(D.addToShortTermMemory(t.content),console.log("[主面板] ✅ 已从叙事历史同步内容到短期记忆"))}else e&&e.length>0?console.log("[主面板] ⚠️ 从短期记忆加载（无叙事历史）"):console.log("[主面板] 未找到叙事记录，显示欢迎信息");await he()}(0,r.nextTick)(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})}catch(e){console.error("[主面板] 初始化存档数据失败:",e)}};(0,r.watch)(()=>V.rootState.当前激活存档,async(e,t)=>{e&&e!==t&&(console.log(`[主面板] 存档已切换: 从 ${t||"无"} 到 ${e}`),console.log("[主面板] 检测到存档切换，正在重置面板状态..."),_.clearActions(),a.value="",F.value=null,C.setAIProcessing(!1),b(),await pe())}),(0,r.onMounted)(async()=>{try{if((async()=>{try{const e=localStorage.getItem("memory-settings");if(e){const t=JSON.parse(e);t.maxShortTerm&&(j.value=t.maxShortTerm),t.maxMidTerm&&(U.value=t.maxMidTerm),t.midTermKeep&&(q.value=t.midTermKeep),console.log("[记忆设置] 已从localStorage加载配置:",{短期记忆上限:j.value,中期记忆触发阈值:U.value,中期记忆保留数量:q.value})}}catch(e){console.warn("[记忆设置] 加载配置失败，使用默认值:",e)}})(),v(),await ge(),(0,r.nextTick)(ue),await pe(),zu.on("memory-settings-updated",e=>{if(console.log("[记忆设置] 接收到配置更新事件:",e),e&&"object"==typeof e){const t=e;"number"==typeof t.shortTermLimit&&(j.value=t.shortTermLimit,console.log(`[记忆设置] 短期记忆上限已更新为: ${j.value}`)),"number"==typeof t.midTermTrigger&&(U.value=t.midTermTrigger,console.log(`[记忆设置] 中期记忆触发阈值已更新为: ${U.value}`)),"number"==typeof t.midTermKeep&&(q.value=t.midTermKeep,console.log(`[记忆设置] 中期记忆保留数量已更新为: ${q.value}`))}}),Jw.on("prefill",g),Jw.on("send",h),T)if((0,Qw.f)()){console.log("[主面板] 注册酒馆事件监听");const e=window.eventOn,t=window.TavernHelper,n=Boolean(P[YS]);if(e&&t&&"function"==typeof e&&!n){const n=t.iframe_events,a=P[WS],r=e=>{const t=l.value;return!(!t||!e)&&(e===t||e.startsWith(t+"_step"))};a.onGenerationStarted=e=>{if(r(e)){const t=l.value;if(t&&e.startsWith(`${t}_step2`))return;C.setStreamingContent(""),re.value="",console.log("[流式输出] GENERATION_STARTED - 已重置状态")}},a.onStreamToken=(e,t)=>{if(r(t)&&M.value&&e){const n=l.value;if(n&&t.startsWith(`${n}_step2`))return;re.value+=e,C.setStreamingContent(re.value)}},a.onGenerationEnded=e=>{r(e)&&console.log("[流式输出] GENERATION_ENDED 事件触发，清除AI处理状态")},e(n.GENERATION_STARTED,a.onGenerationStarted),e(n.STREAM_TOKEN_RECEIVED_INCREMENTALLY,a.onStreamToken),e(n.GENERATION_ENDED,a.onGenerationEnded),P[YS]=!0,console.log("[主面板] ✅ 流式事件监听器已注册（全局唯一）")}else n&&console.log("[主面板] ⏭️ 跳过事件监听器注册（全局已注册）");console.log("[主面板] ✅ 事件监听器注册完成")}else console.warn("[主面板] ⚠️ 酒馆助手不可用，事件监听未注册")}catch(e){console.error("[主面板] 首次挂载失败:",e)}}),(0,r.onActivated)(()=>{console.log("[主面板] 组件激活，恢复AI处理状态"),v()}),(0,r.onUnmounted)(()=>{if(console.log("[主面板] 组件卸载，清理事件监听器"),Jw.off("prefill",g),Jw.off("send",h),T)try{const e=window.eventOff,t=window.TavernHelper,n=Boolean(P[YS]);if(e&&t&&"function"==typeof e&&n){const n=t.iframe_events,a=P[WS];a.onGenerationStarted&&e(n.GENERATION_STARTED,a.onGenerationStarted),a.onStreamToken&&e(n.STREAM_TOKEN_RECEIVED_INCREMENTALLY,a.onStreamToken),a.onGenerationEnded&&e(n.GENERATION_ENDED,a.onGenerationEnded),P[YS]=!1,P[WS]={},console.log("[主面板] ✅ 事件监听器已清理（全局）")}}catch(e){console.warn("[主面板] ⚠️ 清理事件监听器失败:",e)}}),(0,r.watch)(()=>D.narrativeHistory,e=>{if(e&&e.length>0){const t=e[e.length-1];t.stateChanges?(C.setCurrentMessageStateChanges(t.stateChanges),console.log("[主面板] ✅ 已更新指令日志",{变更数量:t.stateChanges.changes?.length||0,前3条:t.stateChanges.changes?.slice(0,3).map(e=>e.key)||[]})):console.warn("[主面板] ⚠️ 最新叙事没有状态变更记录")}},{deep:!0});const ge=async()=>{try{console.log("[主面板] 初始化系统连接..."),console.log("[主面板] 系统连接初始化完成")}catch(e){console.error("[主面板] 系统连接初始化失败:",e)}},he=async()=>{try{if(!V.activeCharacterProfile)return;console.log("[主面板] 游戏状态同步完成")}catch(e){console.error("[主面板] 游戏状态同步失败:",e)}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",ON,[(0,r.createCommentVNode)(" 短期记忆区域 "),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",LN,[(0,r.createElementVNode)("div",{class:"memory-header",onClick:f},[(0,r.createElementVNode)("span",FN,(0,r.toDisplayString)((0,r.unref)(S)("短期记忆")),1),m.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(qw),{key:0,size:16,class:"memory-icon"})):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(dm),{key:1,size:16,class:"memory-icon"}))]),(0,r.createCommentVNode)(" 下拉悬浮的记忆内容 "),(0,r.createVNode)(r.Transition,{name:"memory-dropdown"},{default:(0,r.withCtx)(()=>[m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",jN,[(0,r.createElementVNode)("div",UN,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(ne.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"memory-item"},(0,r.toDisplayString)(e),1))),128)),0===ne.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",qN,(0,r.toDisplayString)((0,r.unref)(S)("脑海中一片清净，尚未留下修行痕迹...")),1)):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0)]),_:1})])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 文本显示区域 - 当前AI回复 "),(0,r.createElementVNode)("div",{class:"content-area",ref_key:"contentAreaRef",ref:u},[(0,r.createCommentVNode)(" 左侧：当前叙述 "),(0,r.createElementVNode)("div",GN,[(0,r.createCommentVNode)(" AI生成状态指示器（生成时显示在顶部） "),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",HN,[(0,r.createElementVNode)("div",YN,[(0,r.createElementVNode)("span",WN,(0,r.toDisplayString)(ce()),1),(0,r.createElementVNode)("div",XN,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"streaming-dot"},null,-1)),(0,r.createElementVNode)("span",JN,(0,r.toDisplayString)(s.value?`${c.value} ${(0,r.unref)(S)("字")}`:(0,r.unref)(S)("API连接中...")),1)]),(0,r.createCommentVNode)(" 重置按钮 - 右侧 "),(0,r.createElementVNode)("button",{onClick:y,class:"reset-state-btn",title:(0,r.unref)(S)("如果长时间无响应，点击此处重置状态")},[(0,r.createVNode)((0,r.unref)(Gw.A),{size:16})],8,KN)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 流式输出内容（生成时实时显示，优先级最高） "),i.value&&s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ZN,[(0,r.createElementVNode)("div",QN,[(0,r.createVNode)($N,{text:s.value},null,8,["text"])])])):L.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" 上一次的叙述内容（非生成时显示） "),(0,r.createElementVNode)("div",eS,[(0,r.createElementVNode)("div",tS,[(0,r.createElementVNode)("span",nS,(0,r.toDisplayString)(L.value.time),1),(0,r.createElementVNode)("div",aS,[(0,r.createCommentVNode)(" 回滚按钮 "),H.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:Y,class:"header-action-btn rollback-btn",title:(0,r.unref)(S)("回滚到上次对话前的状态")},[(0,r.createVNode)((0,r.unref)(Gw.A),{size:20})],8,rS)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 命令日志按钮 "),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>{var t;(t=L.value.stateChanges)&&t.changes&&0!==t.changes.length?C.openStateChangeViewer(t):X.o.info("本次对话无变更记录")}),class:(0,r.normalizeClass)(["variable-updates-toggle",{disabled:0===n.value.length}]),disabled:0===n.value.length,title:n.value.length>0?(0,r.unref)(S)("查看本次对话的变更日志"):(0,r.unref)(S)("本次对话无变更记录")},[(0,r.createVNode)((0,r.unref)(Hw.A),{size:16}),(0,r.createElementVNode)("span",iS,(0,r.toDisplayString)(n.value.length),1)],10,oS)])]),(0,r.createElementVNode)("div",sS,[(0,r.createVNode)($N,{text:L.value.content},null,8,["text"])]),(0,r.createCommentVNode)(" 行动选项 "),(0,r.unref)(C).enableActionOptions&&L.value.actionOptions?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",lS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(L.value.actionOptions,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:t,onClick:t=>(e=>{a.value=e})(e),class:"action-option-btn"},(0,r.toDisplayString)(e),9,cS))),128))])):(0,r.createCommentVNode)("v-if",!0)])],2112)):((0,r.openBlock)(),(0,r.createElementBlock)("div",dS,(0,r.toDisplayString)((0,r.unref)(S)("静待世界变化...")),1))])],512),(0,r.createCommentVNode)(" 输入区域 "),(0,r.createElementVNode)("div",uS,[(0,r.createCommentVNode)(" 动作队列显示区域 "),(0,r.unref)(_).pendingActions.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",mS,[(0,r.createElementVNode)("div",pS,[(0,r.createElementVNode)("span",gS,(0,r.toDisplayString)((0,r.unref)(S)("最近操作")),1),(0,r.createElementVNode)("button",{onClick:ie,class:"clear-queue-btn",title:(0,r.unref)(S)("清空记录")},t[7]||(t[7]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]),8,hS)]),(0,r.createElementVNode)("div",fS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(_).pendingActions,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"queue-action-item"},[(0,r.createElementVNode)("span",vS,(0,r.toDisplayString)(e.description),1),(0,r.createElementVNode)("div",bS,[(0,r.createElementVNode)("button",{onClick:e=>(async e=>{if(e>=0&&e<_.pendingActions.length){const t=_.pendingActions[e],n=["npc_trade","npc_request","npc_steal"];if(t.type&&n.includes(t.type))return _.removeAction(t.id),void X.o.success("已移除NPC交互动作");if(t.type&&["equip","unequip","use","cultivate"].includes(t.type)&&t.itemName&&await B.undoByItemName(t.type,t.itemName))return void X.o.success("已撤回并恢复");_.removeAction(t.id),X.o.success("已移除动作")}})(t),class:"remove-action-btn",title:oe(e)?(0,r.unref)(S)("撤回并恢复"):(0,r.unref)(S)("删除此动作")}," × ",8,yS)])]))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",xS,[(0,r.createCommentVNode)(" 隐藏的文件选择器 "),(0,r.createElementVNode)("input",{type:"file",ref_key:"imageInputRef",ref:$,onChange:O,multiple:"",accept:"image/*",style:{display:"none"}},null,544),(0,r.createCommentVNode)(" 图片上传按钮 - 已禁用 "),(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 快捷行动按钮 - 已禁用 "),(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",kS,[(0,r.createCommentVNode)(" 图片预览区域 "),R.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",wS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(R.value,(e,n)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"image-preview-item"},[(0,r.createElementVNode)("img",{src:(a=e,URL.createObjectURL(a)),alt:e.name},null,8,ES),(0,r.createElementVNode)("button",{onClick:e=>(e=>{R.value.splice(e,1),X.o.info("已移除图片")})(n),class:"remove-image-btn",title:(0,r.unref)(S)("移除图片")},t[9]||(t[9]=[(0,r.createElementVNode)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]),8,NS)]);var a}),128))])):(0,r.createCommentVNode)("v-if",!0),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.value=e),onFocus:t[2]||(t[2]=e=>o.value=!0),onBlur:t[3]||(t[3]=e=>o.value=!1),onKeydown:de,onInput:me,placeholder:G.value?(0,r.unref)(S)("请输入您的选择或行动..."):(0,r.unref)(S)("请先选择角色..."),class:"game-input",ref_key:"inputRef",ref:d,rows:"1",wrap:"soft",disabled:!G.value||i.value},null,40,SS),[[r.vModelText,a.value]])]),(0,r.createElementVNode)("button",{onClick:le,disabled:!a.value.trim()||i.value||!G.value,class:"send-button"},[i.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(Yw),{key:0,size:16,class:"animate-spin"})):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(Ww),{key:1,size:16}))],8,VS)]),(0,r.createCommentVNode)(" 行动选择弹窗 "),x.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"action-modal-overlay",onClick:(0,r.withModifiers)(Q,["self"])},[(0,r.createElementVNode)("div",_S,[(0,r.createElementVNode)("div",CS,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)((0,r.unref)(S)("快捷行动")),1),(0,r.createElementVNode)("button",{onClick:Q,class:"close-btn"},t[10]||(t[10]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]))]),(0,r.createElementVNode)("div",AS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(W.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.name,onClick:t=>(e=>{k.value=e,x.value=!1,w.value=1,E.value=1,N.value="",e.timeRequired||e.options||te()})(e),class:(0,r.normalizeClass)(["quick-action-btn",e.type])},[(0,r.createElementVNode)("div",TS,(0,r.toDisplayString)(e.icon),1),(0,r.createElementVNode)("div",BS,(0,r.toDisplayString)(e.name),1)],10,DS))),128))])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 行动配置弹窗 "),k.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:2,class:"action-config-overlay",onClick:(0,r.withModifiers)(ee,["self"])},[(0,r.createElementVNode)("div",IS,[(0,r.createElementVNode)("div",zS,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(k.value.icon)+" "+(0,r.toDisplayString)(k.value.name),1),(0,r.createElementVNode)("button",{onClick:ee,class:"close-btn"},"×")]),(0,r.createElementVNode)("div",MS,[(0,r.createElementVNode)("p",PS,(0,r.toDisplayString)(k.value.description),1),(0,r.createCommentVNode)(" 时间配置 "),k.value.timeRequired?((0,r.openBlock)(),(0,r.createElementBlock)("div",RS,[(0,r.createElementVNode)("label",$S,(0,r.toDisplayString)((0,r.unref)(S)("修炼时间")),1),(0,r.createElementVNode)("div",OS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(J.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.value,onClick:t=>w.value=e.value,class:(0,r.normalizeClass)(["time-btn",{active:w.value===e.value}])},(0,r.toDisplayString)(e.label),11,LS))),128))]),(0,r.createElementVNode)("div",FS,[(0,r.createElementVNode)("label",null,(0,r.toDisplayString)((0,r.unref)(S)("自定义：")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>E.value=e),type:"number",min:"1",max:"365",class:"time-input"},null,512),[[r.vModelText,E.value,void 0,{number:!0}]]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(S)("天")),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 其他配置选项 "),k.value.options?((0,r.openBlock)(),(0,r.createElementBlock)("div",jS,[(0,r.createElementVNode)("label",US,(0,r.toDisplayString)((0,r.unref)(S)("选项")),1),(0,r.createElementVNode)("div",qS,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(k.value.options,e=>((0,r.openBlock)(),(0,r.createElementBlock)("label",{key:e.key,class:"option-item"},[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"radio",name:"option-"+k.value.name,value:e.key,"onUpdate:modelValue":t[5]||(t[5]=e=>N.value=e)},null,8,GS),[[r.vModelRadio,N.value]]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.label),1)]))),128))])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",HS,[(0,r.createElementVNode)("button",{onClick:ee,class:"cancel-btn"},(0,r.toDisplayString)((0,r.unref)(S)("取消")),1),(0,r.createElementVNode)("button",{onClick:te,class:"confirm-btn"},(0,r.toDisplayString)((0,r.unref)(S)("确认")),1)])])])):(0,r.createCommentVNode)("v-if",!0)])]))}});var JS=n(7384),KS={};KS.styleTagTransform=k(),KS.setAttributes=v(),KS.insert=h().bind(null,"head"),KS.domAPI=p(),KS.insertStyleElement=y(),u()(JS.A,KS),JS.A&&JS.A.locals&&JS.A.locals;const ZS=(0,N.A)(XS,[["__scopeId","data-v-5e56b78d"]]),QS=(0,V.A)("chevrons-left",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),eV=(0,V.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),tV=(0,V.A)("chevrons-right",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);var nV=n(3302),aV=n(5184);const rV={class:"memory-center-panel game-panel"},oV={class:"filter-section"},iV={class:"filter-tabs"},sV=["onClick"],lV={class:"tab-icon"},cV={class:"tab-name"},dV={class:"tab-count"},uV=["title"],mV={key:0,class:"export-section"},pV=["title"],gV={class:"export-hint"},hV={key:1,class:"settings-section"},fV={class:"settings-header"},vV={class:"settings-title"},bV={class:"header-actions"},yV=["title"],xV={class:"settings-content"},kV={class:"setting-item"},wV={class:"setting-label"},EV={class:"setting-hint"},NV={class:"setting-item"},SV={class:"setting-label"},VV={class:"setting-hint"},_V={class:"setting-item"},CV={class:"setting-label"},AV={class:"setting-hint"},DV={class:"setting-item"},TV={class:"setting-label"},BV={class:"setting-hint"},IV={class:"setting-item"},zV={class:"setting-label"},MV=["placeholder"],PV={class:"setting-hint"},RV={class:"setting-item"},$V={class:"setting-label"},OV=["placeholder"],LV={class:"setting-hint"},FV={class:"settings-actions"},jV={class:"manual-summary-section"},UV={class:"summary-info"},qV={class:"info-text"},GV={class:"info-hint"},HV=["disabled","title"],YV={key:2,class:"panel-content"},WV={class:"vector-toolbar"},XV={class:"vector-status"},JV={class:"status-text"},KV={class:"vector-actions"},ZV=["disabled","title"],QV=["disabled"],e_=["disabled"],t_={key:0,class:"loading-state"},n_={class:"loading-text"},a_={key:1,class:"empty-state"},r_={class:"empty-text"},o_={key:2,class:"empty-state"},i_=["disabled"],s_={key:3,class:"vector-content"},l_={key:0,class:"vector-stats"},c_={class:"stats-item"},d_={class:"stats-value"},u_={key:0,class:"stats-item"},m_={class:"stats-value"},p_={key:0},g_={key:1,class:"pagination-controls"},h_={class:"pagination-info"},f_={class:"pagination-buttons"},v_=["disabled"],b_=["disabled"],y_=["disabled"],x_=["disabled"],k_={class:"pagination-jump"},w_=["max"],E_={class:"vector-list"},N_={class:"vector-card-header"},S_={class:"vector-badges"},V_={class:"vector-badge"},__={class:"vector-badge secondary"},C_={class:"vector-time"},A_={key:0,class:"vector-tags"},D_={class:"vector-text"},T_={key:0,class:"loading-state"},B_={class:"loading-text"},I_={key:1,class:"empty-state"},z_={class:"empty-text"},M_={key:2},P_={key:0,class:"pagination-controls"},R_={class:"pagination-info"},$_={class:"pagination-buttons"},O_=["disabled","title"],L_=["disabled","title"],F_=["disabled","title"],j_=["disabled","title"],U_={class:"pagination-jump"},q_=["placeholder","max"],G_={class:"memory-list"},H_={class:"memory-header"},Y_={class:"memory-actions"},W_=["onClick","title"],X_={class:"memory-time"},J_={class:"memory-content"},K_={key:0,class:"structured-memory"},Z_={key:0,class:"memory-title"},Q_={key:0,class:"memory-section-group"},eC={class:"memory-section"},tC={class:"memory-icon"},nC={class:"memory-section-title"},aC={key:1,class:"memory-item"},rC={key:1,class:"memory-section-group"},oC={class:"memory-section"},iC={class:"memory-section-title"},sC={key:1,class:"memory-item"},lC={key:1,class:"simple-memory"},cC={key:1,class:"pagination-controls bottom"},dC={class:"pagination-info"},uC={class:"pagination-buttons"},mC=["disabled"],pC=["disabled"],gC=["disabled"],hC=["disabled"],fC=(0,r.defineComponent)({__name:"MemoryCenterPanel",setup(e){const t=(0,Jc.useCharacterStore)(),n=(0,se.isTavernEnv)(),a=(0,pu.useGameStateStore)(),{t:o}=(0,K.s)(),i=(0,r.ref)(!1),s=(0,r.ref)("all"),l=(0,r.ref)(!1),c=(0,r.ref)(1),d=(0,r.ref)(10),u=(0,r.ref)(""),m=(0,r.ref)({shortTermLimit:3,midTermTrigger:25,midTermKeep:8,autoSummaryEnabled:!0,midTermFormat:"",longTermFormat:"",useRawMode:!0,useStreaming:!0}),p=(0,r.ref)([]),g=(0,r.ref)([]),h=(0,r.ref)([]),f=(0,r.ref)([]),v=(0,r.ref)(null),b=(0,r.ref)(!1),y=(0,r.ref)(""),x=(0,r.ref)(!1),k=(0,r.ref)({done:0,total:0}),w=(0,r.computed)(()=>aV.vectorMemoryService.getConfig().enabled),E=(0,r.computed)(()=>aV.vectorMemoryService.getEmbeddingStatus()),N=(0,r.computed)(()=>v.value?.total??f.value.length),S=(0,r.computed)(()=>Math.ceil(N.value/d.value)||1),V=(0,r.computed)(()=>{const e=(c.value-1)*d.value,t=e+d.value;return f.value.slice(e,t)}),_=(0,r.computed)(()=>{if(x.value){const{done:e,total:t}=k.value;return"正在向量化长期记忆..."+(t>0?`（${e}/${t}）`:"")}return"正在读取向量库..."}),C=(0,r.computed)(()=>[...h.value,...g.value,...p.value].sort((e,t)=>new Date(t.time).getTime()-new Date(e.time).getTime())),D=(0,r.computed)(()=>[{key:"all",name:o("全部"),icon:"🧠"},{key:"short",name:o("短期"),icon:"⚡"},{key:"medium",name:o("中期"),icon:"💭"},{key:"long",name:o("长期"),icon:"💾"},{key:"vector",name:"向量库",icon:"🧬"}]),T=(0,r.computed)(()=>{if("all"===s.value)return C.value;switch(s.value){case"short":return p.value;case"medium":return g.value;case"long":return h.value;default:return C.value}}),B=(0,r.computed)(()=>Math.ceil(T.value.length/d.value)||1),I=(0,r.computed)(()=>{const e=(c.value-1)*d.value,t=e+d.value;return T.value.slice(e,t)}),z=(0,r.computed)(()=>p.value.length+g.value.length+h.value.length),M=e=>{if("all"===e)return z.value;switch(e){case"short":return p.value.length;case"medium":return g.value.length;case"long":return h.value.length;case"vector":return N.value;default:return 0}},P=()=>{if("all"===s.value)return o("心如明镜，尚未记录任何修行感悟");const e=D.value.find(e=>e.key===s.value);return o("暂无{type}记忆",{type:e?.name})},R=e=>({short:o("短期记忆"),medium:o("中期记忆"),long:o("长期记忆")}[e]||o("未知")),$=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${t.getMinutes().toString().padStart(2,"0")}`},O=async()=>{try{a.memory||(nV.Yz.warn("记忆中心","gameStateStore.memory 不存在，无法保存记忆"),a.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),a.memory.短期记忆=p.value.map(e=>e.content),a.memory.中期记忆=g.value.map(e=>e.content),a.memory.长期记忆=h.value.map(e=>e.content),await t.saveCurrentGame(),nV.Yz.log("记忆中心","记忆数据已保存到存档")}catch(e){throw nV.Yz.error("记忆中心","保存记忆数据到存档失败:",e),e}},L=async()=>{if(!b.value){b.value=!0,y.value="";try{const[e,t]=await Promise.all([aV.vectorMemoryService.getAllMemories(),aV.vectorMemoryService.getStats()]);f.value=[...e].sort((e,t)=>t.timestamp-e.timestamp),v.value=t}catch(e){const t=e instanceof Error?e.message:String(e||"");y.value=t?`向量库读取失败：${t}`:"向量库读取失败"}finally{b.value=!1}}},F=()=>"vector"===s.value?S.value:B.value,j=e=>{const t=F();e>=1&&e<=t&&(c.value=e)},U=()=>{c.value=1},q=()=>{c.value=F()},G=()=>{const e=parseInt(u.value),t=F();!isNaN(e)&&e>=1&&e<=t?(c.value=e,u.value=""):X.o.warning(`请输入 1-${t} 之间的页码`)},H=(0,A.useUIStore)(),Y=async()=>{if(b.value||x.value)return;if(0===h.value.length)return void X.o.warning("当前没有长期记忆可转化");const e=h.value.length;H.showRetryDialog({title:"一键转化长期记忆",message:`将清空当前向量库，并把 ${e} 条长期记忆转化为向量（优先使用Embedding；未配置则回退本地向量）。此操作可能产生 Embedding API 调用与费用。`,confirmText:"开始转化",cancelText:"取消",onConfirm:async()=>{b.value=!0,x.value=!0,k.value={done:0,total:e};try{const e=h.value.map(e=>e.content).filter(Boolean),t=await aV.vectorMemoryService.rebuildFromLongTermMemories(e,{batchSize:24,onProgress:(e,t)=>{k.value={done:e,total:t}}});X.o.success("embedding"===t.vectorType?`转化完成：${t.imported} 条（Embedding: ${t.embeddingModel||"unknown"}）`:`转化完成：${t.imported} 条（本地向量）`)}catch(e){const t=e instanceof Error?e.message:String(e||"");X.o.error(t?`转化失败：${t}`:"转化失败")}finally{x.value=!1,b.value=!1,k.value={done:0,total:0},await L()}},onCancel:()=>{}})},W=async()=>{H.showRetryDialog({title:"清空向量库",message:"确定要清空向量库吗？此操作不可撤销。",confirmText:"确认清空",cancelText:"取消",onConfirm:async()=>{try{await aV.vectorMemoryService.clear(),await L(),X.o.success("向量库已清空")}catch(e){const t=e instanceof Error?e.message:String(e||"");X.o.error(t?`清空失败：${t}`:"清空失败")}},onCancel:()=>{}})},J=async()=>{try{nV.Yz.log("记忆中心","开始加载记忆数据");const e=[],t=[],n=[],r=a.memory;r?(nV.Yz.log("记忆中心","从存档数据加载记忆:",Object.keys(r)),Array.isArray(r.短期记忆)&&r.短期记忆.forEach((t,n)=>{if(t&&"string"==typeof t){const a={type:"short",content:t,time:$(Date.now()-3e5*n),importance:5};e.push(a)}}),Array.isArray(r.中期记忆)&&r.中期记忆.forEach((e,n)=>{if(e&&"string"==typeof e){const a={type:"medium",content:e,time:$(Date.now()-36e5*n),importance:7};t.push(a)}}),Array.isArray(r.长期记忆)?(nV.Yz.log("记忆中心",`发现长期记忆数组，长度: ${r.长期记忆.length}`),nV.Yz.log("记忆中心","长期记忆原始数据:",r.长期记忆),r.长期记忆.forEach((e,t)=>{if(e&&"string"==typeof e){const a={type:"long",content:e,time:$(Date.now()-864e5*t),importance:9};n.push(a),nV.Yz.log("记忆中心",`加载长期记忆 #${t}:`,e.substring(0,50))}})):nV.Yz.warn("记忆中心","长期记忆不是数组或不存在:",r.长期记忆),nV.Yz.log("记忆中心",`记忆加载完成: 短期${e.length}, 中期${t.length}, 长期${n.length}`)):nV.Yz.warn("记忆中心","未找到存档记忆数据"),p.value=e,g.value=t,h.value=n;const o=e.length+t.length+n.length;nV.Yz.log("记忆中心",`记忆加载完成：总计 ${o} 条记忆`)}catch(e){nV.Yz.error("记忆中心","加载记忆数据失败",e),X.o.error("加载记忆数据失败")}},Z=async()=>{try{localStorage.setItem("memory-settings",JSON.stringify(m.value)),zu.emit("memory-settings-updated",m.value),X.o.success("记忆系统配置已保存"),nV.Yz.log("记忆中心","配置已保存:",m.value)}catch(e){nV.Yz.error("记忆中心","保存配置失败:",e),X.o.error("保存配置失败")}},Q=()=>{m.value={shortTermLimit:3,midTermTrigger:20,midTermKeep:8,autoSummaryEnabled:!0,midTermFormat:"",longTermFormat:"",useRawMode:!0,useStreaming:!0},X.o.success("配置已重置为默认值")},ee=async()=>{const e=m.value.midTermKeep+5;g.value.length<e?X.o.warning(o("insufficientMemoriesForSummary",{minRequired:e})):await Qw.J.triggerMemorySummary({useRawMode:m.value.useRawMode,useStreaming:m.value.useStreaming})},te=()=>{try{const e=a.character?.名字||o("修仙者"),t=a.worldInfo?.世界名称||o("修仙世界"),n=a.narrativeHistory||[];if(0===n.length)return void X.o.warning(o("没有叙事历史可导出"));let r=o("novelTitle",{characterName:e})+"\n\n";r+=`${o("世界档案")}: ${t}\n`,r+=`${o("导出时间")}: ${(new Date).toLocaleString("zh-CN")}\n`,r+=`${o("总段落数")}: ${n.length}\n`,r+=`\n${"=".repeat(60)}\n\n`,n.forEach((e,t)=>{const n="user"===e.type||"player"===e.type,a=e.content.replace(/【.*?】/g,"").trim();r+=n?`${o("我说")}: "${a}"\n`:`${a}\n`,r+=`${"─".repeat(50)}\n\n`,(t+1)%10==0&&(r+=`\n${"═".repeat(50)}\n`,r+=`${o("第")} ${Math.floor((t+1)/10)}\n`,r+=`${"═".repeat(50)}\n\n`)});const i=new Blob([r],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(i),l=document.createElement("a");l.href=s,l.download=`${e}_修仙历程_${Date.now()}.txt`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s),X.o.success(o("narrativeHistoryExported",{count:n.length}))}catch(e){console.error("[记忆中心] 导出失败:",e),X.o.error(o("导出失败，请查看控制台"))}};(0,r.onMounted)(async()=>{await J(),await(async()=>{try{const e=localStorage.getItem("memory-settings");if(e){const t=JSON.parse(e);return m.value={...m.value,...t},void nV.Yz.log("记忆中心","已从localStorage加载配置",t)}nV.Yz.log("记忆中心","未找到配置，使用默认值")}catch(e){nV.Yz.error("记忆中心","加载记忆配置失败:",e)}})();try{v.value=await aV.vectorMemoryService.getStats()}catch{}zu.on("refresh",async()=>{i.value=!0;try{await J()}finally{i.value=!1}}),zu.on("test",()=>{((e,t,n=5,a)=>{const r={type:e,content:t,time:$(Date.now()),importance:n,parsedContent:a};switch(e){case"short":p.value.push(r);break;case"medium":g.value.push(r);break;case"long":h.value.push(r)}(()=>{let e=!1;if(p.value.length>=3){nV.Yz.log("记忆中心","短期记忆达到上限，开始转化为中期记忆");const t=p.value.shift();if(t){const n={...t,type:"medium",time:o("convertedAt",{time:$(Date.now())}),isConverted:!0};g.value.push(n),e=!0}}if(g.value.length>=25)if(nV.Yz.log("记忆中心","中期记忆达到上限，准备转化为长期记忆"),m.value.autoSummaryEnabled)nV.Yz.log("记忆中心","自动总结已启用，将在后台触发AI总结"),Qw.J.triggerMemorySummary({useRawMode:m.value.useRawMode,useStreaming:m.value.useStreaming}).catch(e=>{nV.Yz.error("记忆中心","自动总结失败:",e)});else{const t=g.value.shift();if(t){const n={...t,type:"long",time:o("archivedAt",{time:$(Date.now())}),importance:Math.max(t.importance||5,7),isConverted:!0};h.value.push(n),e=!0}}if(h.value.length>50){h.value.sort((e,t)=>(t.importance||5)-(e.importance||5));const e=h.value.splice(50);nV.Yz.log("记忆中心",`长期记忆超限，移除${e.length}条低重要性记忆`)}e&&X.o.success(o("记忆已重新整理，旧记忆已转化"))})()})("short","【测试记忆】用于检验转化与渲染。")}),zu.on("clear",async()=>{await(async()=>{H.showRetryDialog({title:o("清空记忆"),message:n?o("确定要清空所有记忆吗？此操作不可撤销，同时会清空酒馆数据。"):"确定要清空所有记忆吗？此操作不可撤销。",confirmText:o("确认清空"),cancelText:o("取消"),onConfirm:async()=>{try{p.value=[],g.value=[],h.value=[],a.memory&&(a.memory.短期记忆=[],a.memory.中期记忆=[],a.memory.长期记忆=[]),await t.saveCurrentGame(),X.o.success(n?o("记忆已清空并同步到酒馆"):"记忆已清空")}catch(e){console.error("[记忆中心] 清理记忆失败:",e),X.o.error(o("清空记忆失败，请重试"))}},onCancel:()=>{}})})()})});const ne=async()=>{try{const e={content:`测试中期记忆 ${Date.now()} - 这是一条用于测试的中期记忆记录。`,time:$(Date.now()),type:"medium",isConverted:!1,isSummarized:!1,parsedContent:{影响:"测试",sections:{}}};g.value.push(e),await O(),X.o.success(o("testMemoryAdded",{count:g.value.length})),nV.Yz.log("记忆中心","添加测试中期记忆成功",e)}catch(e){nV.Yz.error("记忆中心","添加测试记忆失败",e),X.o.error(o("添加测试记忆失败"))}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",rV,[(0,r.createCommentVNode)(" 记忆类型筛选 "),(0,r.createElementVNode)("div",oV,[(0,r.createElementVNode)("div",iV,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(D.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.key,class:(0,r.normalizeClass)(["filter-tab",{active:s.value===e.key}]),onClick:t=>(async e=>{s.value=e,c.value=1,u.value="","vector"===e&&await L()})(e.key)},[(0,r.createElementVNode)("span",lV,(0,r.toDisplayString)(e.icon),1),(0,r.createElementVNode)("span",cV,(0,r.toDisplayString)((0,r.unref)(o)(e.name)),1),(0,r.createElementVNode)("span",dV,(0,r.toDisplayString)(M(e.key)),1)],10,sV))),128)),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["settings-toggle-btn",{active:l.value}]),onClick:t[0]||(t[0]=e=>l.value=!l.value),title:(0,r.unref)(o)("记忆系统设置")},[(0,r.createVNode)((0,r.unref)(Wn.A),{size:16})],10,uV)])]),(0,r.createCommentVNode)(" 导出工具 "),l.value||"vector"===s.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",mV,[(0,r.createElementVNode)("button",{class:"export-btn-main",onClick:te,title:(0,r.unref)(o)("将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。")},(0,r.toDisplayString)((0,r.unref)(o)("📖 导出为小说")),9,pV),(0,r.createElementVNode)("div",gV,(0,r.toDisplayString)((0,r.unref)(o)("将完整的游戏对话历史（基于叙事历史）导出为小说格式，方便阅读和分享。")),1)])),(0,r.createCommentVNode)(" 记忆系统设置 "),l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",hV,[(0,r.createElementVNode)("div",fV,[(0,r.createElementVNode)("span",vV,"⚙️ "+(0,r.toDisplayString)((0,r.unref)(o)("记忆系统配置")),1),(0,r.createElementVNode)("div",bV,[(0,r.createElementVNode)("button",{class:"test-btn",onClick:ne,title:(0,r.unref)(o)("添加测试中期记忆")}," 🧪 "+(0,r.toDisplayString)((0,r.unref)(o)("测试")),9,yV),(0,r.createElementVNode)("button",{class:"settings-close-btn",onClick:t[1]||(t[1]=e=>l.value=!1)},"✕")])]),(0,r.createElementVNode)("div",xV,[(0,r.createElementVNode)("div",kV,[(0,r.createElementVNode)("label",wV,(0,r.toDisplayString)((0,r.unref)(o)("短期记忆上限（条）：")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>m.value.shortTermLimit=e),min:"3",max:"10",class:"setting-input"},null,512),[[r.vModelText,m.value.shortTermLimit,void 0,{number:!0}]]),(0,r.createElementVNode)("span",EV,(0,r.toDisplayString)((0,r.unref)(o)("默认"))+": 3",1)]),(0,r.createElementVNode)("div",NV,[(0,r.createElementVNode)("label",SV,(0,r.toDisplayString)((0,r.unref)(o)("中期记忆转化阈值（条）：")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>m.value.midTermTrigger=e),min:"10",max:"50",class:"setting-input"},null,512),[[r.vModelText,m.value.midTermTrigger,void 0,{number:!0}]]),(0,r.createElementVNode)("span",VV,(0,r.toDisplayString)((0,r.unref)(o)("中期记忆达到此数量时，转化为长期记忆。默认：25")),1)]),(0,r.createElementVNode)("div",_V,[(0,r.createElementVNode)("label",CV,(0,r.toDisplayString)((0,r.unref)(o)("中期记忆保留数量（条）：")),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>m.value.midTermKeep=e),min:"5",max:"15",class:"setting-input"},null,512),[[r.vModelText,m.value.midTermKeep,void 0,{number:!0}]]),(0,r.createElementVNode)("span",AV,(0,r.toDisplayString)((0,r.unref)(o)("转化为长期记忆时，保留最新的这么多条中期记忆。默认：8")),1)]),(0,r.createElementVNode)("div",DV,[(0,r.createElementVNode)("label",TV,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>m.value.autoSummaryEnabled=e),class:"setting-checkbox"},null,512),[[r.vModelCheckbox,m.value.autoSummaryEnabled]]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(o)("启用自动记忆转化")),1)]),(0,r.createElementVNode)("span",BV,(0,r.toDisplayString)((0,r.unref)(o)("启用后，自动将中期记忆转化为长期记忆。禁用则不转化。")),1)]),(0,r.createElementVNode)("div",IV,[(0,r.createElementVNode)("label",zV,(0,r.toDisplayString)((0,r.unref)(o)("自定义中期记忆格式：")),1),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>m.value.midTermFormat=e),class:"setting-textarea",placeholder:(0,r.unref)(o)("留空使用默认格式。可自定义AI提示词来控制记忆的生成格式..."),rows:"4"},null,8,MV),[[r.vModelText,m.value.midTermFormat]]),(0,r.createElementVNode)("span",PV,(0,r.toDisplayString)((0,r.unref)(o)("自定义中期记忆的AI提示词格式。留空使用系统默认。")),1)]),(0,r.createElementVNode)("div",RV,[(0,r.createElementVNode)("label",$V,(0,r.toDisplayString)((0,r.unref)(o)("自定义长期记忆格式：")),1),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>m.value.longTermFormat=e),class:"setting-textarea",placeholder:(0,r.unref)(o)("留空使用默认格式。可自定义AI提示词来控制记忆的生成格式..."),rows:"4"},null,8,OV),[[r.vModelText,m.value.longTermFormat]]),(0,r.createElementVNode)("span",LV,(0,r.toDisplayString)((0,r.unref)(o)("自定义长期记忆的AI提示词格式。留空使用系统默认。")),1)]),(0,r.createElementVNode)("div",FV,[(0,r.createElementVNode)("button",{class:"action-btn success",onClick:Z}," 💾 "+(0,r.toDisplayString)((0,r.unref)(o)("保存配置")),1),(0,r.createElementVNode)("button",{class:"action-btn info",onClick:Q},(0,r.toDisplayString)((0,r.unref)(o)("重置为默认")),1)]),(0,r.createCommentVNode)(" 手动总结触发 "),(0,r.createElementVNode)("div",jV,[(0,r.createElementVNode)("div",UV,[(0,r.createElementVNode)("span",qV,(0,r.toDisplayString)((0,r.unref)(o)("当前中期记忆："))+" "+(0,r.toDisplayString)(g.value.length)+" "+(0,r.toDisplayString)((0,r.unref)(o)("条")),1),(0,r.createElementVNode)("span",GV,(0,r.toDisplayString)((0,r.unref)(o)("达到{count}条时将自动触发总结",{count:m.value.midTermTrigger})),1)]),(0,r.createElementVNode)("button",{class:"action-btn warning",onClick:ee,disabled:g.value.length<m.value.midTermKeep+5,title:g.value.length<m.value.midTermKeep+5?(0,r.unref)(o)("manualSummaryRequirement",{count:m.value.midTermKeep+5}):(0,r.unref)(o)("手动触发AI总结")}," 📝 "+(0,r.toDisplayString)((0,r.unref)(o)("手动总结中期记忆")),9,HV)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 记忆列表 "),l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",YV,["vector"===s.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createElementVNode)("div",WV,[(0,r.createElementVNode)("div",XV,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status-dot",{enabled:w.value}])},null,2),(0,r.createElementVNode)("span",JV,(0,r.toDisplayString)(w.value?"向量检索已启用":"向量检索未启用（不会参与AI检索）"),1),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["status-subtext",{warning:!E.value.available}])},[E.value.available?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createTextVNode)(" Embedding："+(0,r.toDisplayString)(E.value.provider)+"/"+(0,r.toDisplayString)(E.value.model),1)],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createTextVNode)((0,r.toDisplayString)(E.value.reason),1)],64))],2)]),(0,r.createElementVNode)("div",KV,[(0,r.createElementVNode)("button",{class:"action-btn info",onClick:Y,disabled:b.value||x.value||0===h.value.length,title:0===h.value.length?"当前没有长期记忆可转化":"清空并重新生成向量库（优先使用Embedding）"}," 一键转化长期记忆 ",8,ZV),(0,r.createElementVNode)("button",{class:"action-btn info",onClick:L,disabled:b.value},"刷新",8,QV),(0,r.createElementVNode)("button",{class:"action-btn warning",onClick:W,disabled:b.value||0===N.value},"清空向量库",8,e_)])]),b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",t_,[t[16]||(t[16]=(0,r.createElementVNode)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.createElementVNode)("div",n_,(0,r.toDisplayString)(_.value),1)])):y.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",a_,[t[17]||(t[17]=(0,r.createElementVNode)("div",{class:"empty-icon"},"⚠️",-1)),(0,r.createElementVNode)("div",r_,(0,r.toDisplayString)(y.value),1)])):0===N.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",o_,[t[18]||(t[18]=(0,r.createElementVNode)("div",{class:"empty-icon"},"🧬",-1)),t[19]||(t[19]=(0,r.createElementVNode)("div",{class:"empty-text"},"向量库为空",-1)),(0,r.createElementVNode)("button",{class:"action-btn info",onClick:Y,disabled:x.value||0===h.value.length}," 一键转化长期记忆 ",8,i_)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",s_,[v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",l_,[(0,r.createElementVNode)("div",c_,[t[20]||(t[20]=(0,r.createElementVNode)("span",{class:"stats-label"},"总数",-1)),(0,r.createElementVNode)("span",d_,(0,r.toDisplayString)(v.value.total),1)]),Object.keys(v.value.byCategory).length?((0,r.openBlock)(),(0,r.createElementBlock)("div",u_,[t[21]||(t[21]=(0,r.createElementVNode)("span",{class:"stats-label"},"分类",-1)),(0,r.createElementVNode)("span",m_,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Object.entries(v.value.byCategory),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e[0],class:"stats-chip"},[(0,r.createTextVNode)((0,r.toDisplayString)(e[0])+": "+(0,r.toDisplayString)(e[1]),1),t<Object.keys(v.value.byCategory).length-1?((0,r.openBlock)(),(0,r.createElementBlock)("span",p_," · ")):(0,r.createCommentVNode)("v-if",!0)]))),128))])])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),N.value>d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",g_,[(0,r.createElementVNode)("div",h_,"第 "+(0,r.toDisplayString)(c.value)+" / "+(0,r.toDisplayString)(S.value)+" 页，共 "+(0,r.toDisplayString)(N.value)+" 条",1),(0,r.createElementVNode)("div",f_,[(0,r.createElementVNode)("button",{class:"page-btn",onClick:U,disabled:1===c.value},[(0,r.createVNode)((0,r.unref)(QS),{size:16})],8,v_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[8]||(t[8]=e=>j(c.value-1)),disabled:1===c.value},[(0,r.createVNode)((0,r.unref)(eV),{size:16})],8,b_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[9]||(t[9]=e=>j(c.value+1)),disabled:c.value===S.value},[(0,r.createVNode)((0,r.unref)(dm),{size:16})],8,y_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:q,disabled:c.value===S.value},[(0,r.createVNode)((0,r.unref)(tV),{size:16})],8,x_)]),(0,r.createElementVNode)("div",k_,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=e=>u.value=e),placeholder:"页",class:"jump-input",onKeyup:(0,r.withKeys)(G,["enter"]),min:"1",max:S.value},null,40,w_),[[r.vModelText,u.value]]),(0,r.createElementVNode)("button",{class:"jump-btn",onClick:G},"跳转")])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",E_,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(V.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:"vector-card"},[(0,r.createElementVNode)("div",N_,[(0,r.createElementVNode)("div",S_,[(0,r.createElementVNode)("span",V_,(0,r.toDisplayString)(e.category),1),(0,r.createElementVNode)("span",__,"重要: "+(0,r.toDisplayString)(e.importance),1)]),(0,r.createElementVNode)("div",C_,(0,r.toDisplayString)($(e.timestamp)),1)]),e.tags?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",A_,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.tags,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"vector-tag"},"#"+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",D_,(0,r.toDisplayString)(e.content),1)]))),128))])]))],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",T_,[t[22]||(t[22]=(0,r.createElementVNode)("div",{class:"loading-spinner"},"⏳",-1)),(0,r.createElementVNode)("div",B_,(0,r.toDisplayString)((0,r.unref)(o)("正在读取记忆...")),1)])):0===I.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",I_,[t[23]||(t[23]=(0,r.createElementVNode)("div",{class:"empty-icon"},"🧠",-1)),(0,r.createElementVNode)("div",z_,(0,r.toDisplayString)(P()),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",M_,[(0,r.createCommentVNode)(" 分页控制 "),T.value.length>d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",P_,[(0,r.createElementVNode)("div",R_,(0,r.toDisplayString)((0,r.unref)(o)("第 {currentPage} / {totalPages} 页，共 {total} 条记忆",{currentPage:c.value,totalPages:B.value,total:T.value.length})),1),(0,r.createElementVNode)("div",$_,[(0,r.createElementVNode)("button",{class:"page-btn",onClick:U,disabled:1===c.value,title:(0,r.unref)(o)("首页")},[(0,r.createVNode)((0,r.unref)(QS),{size:16})],8,O_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[11]||(t[11]=e=>j(c.value-1)),disabled:1===c.value,title:(0,r.unref)(o)("上一页")},[(0,r.createVNode)((0,r.unref)(eV),{size:16})],8,L_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[12]||(t[12]=e=>j(c.value+1)),disabled:c.value===B.value,title:(0,r.unref)(o)("下一页")},[(0,r.createVNode)((0,r.unref)(dm),{size:16})],8,F_),(0,r.createElementVNode)("button",{class:"page-btn",onClick:q,disabled:c.value===B.value,title:(0,r.unref)(o)("末页")},[(0,r.createVNode)((0,r.unref)(tV),{size:16})],8,j_)]),(0,r.createElementVNode)("div",U_,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=e=>u.value=e),placeholder:(0,r.unref)(o)("页"),class:"jump-input",onKeyup:(0,r.withKeys)(G,["enter"]),min:"1",max:B.value},null,40,q_),[[r.vModelText,u.value]]),(0,r.createElementVNode)("button",{class:"jump-btn",onClick:G},(0,r.toDisplayString)((0,r.unref)(o)("跳转")),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",G_,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(I.value,(e,n)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:(0,r.normalizeClass)(["memory-card",`memory-${e.type}`])},[(0,r.createElementVNode)("div",H_,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["memory-type-badge",`badge-${e.type}`])},(0,r.toDisplayString)((a=e.type,{short:"⚡",medium:"💭",long:"💾"}[a]||"🧠"))+" "+(0,r.toDisplayString)(R(e.type)),3),(0,r.createElementVNode)("div",Y_,[(0,r.createElementVNode)("button",{class:"delete-memory-btn",onClick:(0,r.withModifiers)(t=>(async e=>{H.showRetryDialog({title:o("删除记忆"),message:o("confirmDeleteMemory",{type:R(e.type),content:e.content.substring(0,50)}),confirmText:o("删除"),cancelText:o("取消"),onConfirm:async()=>{try{let t=-1;switch(e.type){case"short":t=p.value.findIndex(t=>t===e),-1!==t&&p.value.splice(t,1);break;case"medium":t=g.value.findIndex(t=>t===e),-1!==t&&g.value.splice(t,1);break;case"long":t=h.value.findIndex(t=>t===e),-1!==t&&h.value.splice(t,1)}if(-1===t)return void X.o.error(o("未找到要删除的记忆"));await O(),nV.Yz.log("记忆中心",`✅ 已删除${R(e.type)}并同步到存档`),X.o.success(o("memoryDeleted",{type:R(e.type)}))}catch(e){nV.Yz.error("记忆中心","删除记忆失败:",e);const t=e instanceof Error?e.message:"未知错误";X.o.error(o("deleteFailed",{error:t}))}},onCancel:()=>{}})})(e),["stop"]),title:(0,r.unref)(o)("删除此记忆")}," 🗑️ ",8,W_),(0,r.createElementVNode)("div",X_,(0,r.toDisplayString)(e.time),1)])]),(0,r.createElementVNode)("div",J_,[e.parsedContent&&e.parsedContent.format?((0,r.openBlock)(),(0,r.createElementBlock)("div",K_,[e.parsedContent.title?((0,r.openBlock)(),(0,r.createElementBlock)("div",Z_," 【"+(0,r.toDisplayString)(e.parsedContent.title)+"】 ",1)):(0,r.createCommentVNode)("v-if",!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.parsedContent.format.sections,t=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:t.key},[e.parsedContent.sections&&e.parsedContent.sections[t.key]?((0,r.openBlock)(),(0,r.createElementBlock)("div",Q_,[(0,r.createElementVNode)("div",eC,[(0,r.createElementVNode)("span",tC,(0,r.toDisplayString)(t.icon),1),(0,r.createElementVNode)("span",nC,(0,r.toDisplayString)(t.title),1)]),(0,r.createCommentVNode)(" 确保只在数组时才遍历，字符串直接显示 "),Array.isArray(e.parsedContent.sections[t.key])?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(e.parsedContent.sections[t.key],e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"memory-item"},(0,r.toDisplayString)(e),1))),128)):((0,r.openBlock)(),(0,r.createElementBlock)("div",aC,(0,r.toDisplayString)(e.parsedContent.sections[t.key]),1))])):(0,r.createCommentVNode)("v-if",!0)],64))),128)),(0,r.createCommentVNode)(" 未识别的通用内容 "),e.parsedContent.sections.general?((0,r.openBlock)(),(0,r.createElementBlock)("div",rC,[(0,r.createElementVNode)("div",oC,[t[24]||(t[24]=(0,r.createElementVNode)("span",{class:"memory-icon"},"📝",-1)),(0,r.createElementVNode)("span",iC,(0,r.toDisplayString)((0,r.unref)(o)("其他记录")),1)]),(0,r.createCommentVNode)(" 确保只在数组时才遍历，字符串直接显示 "),Array.isArray(e.parsedContent.sections.general)?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(e.parsedContent.sections.general,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"memory-item"},(0,r.toDisplayString)(e),1))),128)):((0,r.openBlock)(),(0,r.createElementBlock)("div",sC,(0,r.toDisplayString)(e.parsedContent.sections.general),1))])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",lC,(0,r.toDisplayString)(e.content),1))])],2);var a}),128))]),(0,r.createCommentVNode)(" 底部分页控制 "),T.value.length>d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",cC,[(0,r.createElementVNode)("div",dC,(0,r.toDisplayString)((0,r.unref)(o)("页"))+" "+(0,r.toDisplayString)(c.value)+" / "+(0,r.toDisplayString)(B.value),1),(0,r.createElementVNode)("div",uC,[(0,r.createElementVNode)("button",{class:"page-btn",onClick:U,disabled:1===c.value},[(0,r.createVNode)((0,r.unref)(QS),{size:16})],8,mC),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[14]||(t[14]=e=>j(c.value-1)),disabled:1===c.value},[(0,r.createVNode)((0,r.unref)(eV),{size:16})],8,pC),(0,r.createElementVNode)("button",{class:"page-btn",onClick:t[15]||(t[15]=e=>j(c.value+1)),disabled:c.value===B.value},[(0,r.createVNode)((0,r.unref)(dm),{size:16})],8,gC),(0,r.createElementVNode)("button",{class:"page-btn",onClick:q,disabled:c.value===B.value},[(0,r.createVNode)((0,r.unref)(tV),{size:16})],8,hC)])])):(0,r.createCommentVNode)("v-if",!0)]))],64))]))]))}});var vC=n(4881),bC={};bC.styleTagTransform=k(),bC.setAttributes=v(),bC.insert=h().bind(null,"head"),bC.domAPI=p(),bC.insertStyleElement=y(),u()(vC.A,bC),vC.A&&vC.A.locals&&vC.A.locals;const yC=(0,N.A)(fC,[["__scopeId","data-v-1ded3595"]]);function xC(e,t){const n=t.角色?.身份??null,a=n?.后天六司||{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0},r=function(e,t){const n={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0};return console.log("[装备加成计算] 开始计算装备加成"),console.log("[装备加成计算] 装备栏数据:",e),console.log("[装备加成计算] 背包物品数据:",t?.物品),Object.entries(e).forEach(([e,a])=>{if(console.log(`[装备加成计算] 检查槽位 ${e}, itemId: ${a}`),a&&t.物品&&t.物品[a]){const e=t.物品[a];if(console.log("[装备加成计算] 找到物品:",e),"装备"===e.类型&&e.装备增幅?.后天六司){console.log(`[装备加成计算] 物品 ${e.名称} 有装备增幅:`,e.装备增幅);const t=e.装备增幅.后天六司;Object.entries(t).forEach(([t,a])=>{if(t in n){const r=Number(a);isNaN(r)?console.warn(`[装备加成计算] 属性 ${t} 的值 "${a}" 不是一个有效的数字，已忽略。物品: ${e.名称}`):(console.log(`[装备加成计算] 添加属性加成: ${t} +${r} (原始值: ${a})`),n[t]+=r)}else console.warn(`[装备加成计算] 发现未知的后天六司属性 "${t}"，已忽略。物品: ${e.名称}`)})}else console.log(`[装备加成计算] 物品 ${e.名称} 没有装备增幅或后天六司属性`)}else console.log(`[装备加成计算] 槽位 ${e} 为空或物品不存在`)}),console.log("[装备加成计算] 最终装备加成:",n),n}(t.角色?.装备??null,t.角色?.背包??null),o=function(e){const t={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0},n=e.角色?.身份??null,a=n?.天赋||[];return a.map(e=>"string"==typeof e?e:e&&"object"==typeof e&&e.名称?e.名称:null).filter(Boolean),a.forEach(e=>{let n,a;if("string"==typeof e?(a=e,n=le.qS.find(e=>e.name===a)):e&&"object"==typeof e&&(a=e.名称||"",n=le.qS.find(e=>e.name===a),!n&&e.effects&&(n={id:0,name:a,description:e.描述||"",talent_cost:0,rarity:1,effects:e.effects})),n&&n.effects){const e=function(e){const t={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0};return e.forEach(e=>{e.effects&&Array.isArray(e.effects)&&e.effects.forEach(e=>{if("string"!=typeof e){if("后天六司"===e.类型){const n=e.目标,a=Number(e.数值)||0;let r=n;"神识"===n&&(r="悟性"),"惟性"===n&&(r="悟性"),"体质"===n&&(r="根骨"),"敏捷"===n&&(r="灵性"),r&&r in t&&(t[r]+=a)}if("type"in e&&"ATTRIBUTE_MODIFIER"===e.type){const n="target"in e?e.target:void 0,a="value"in e&&Number(e.value)||0;if(!n)return;const r={STR:"根骨",CON:"根骨",DEX:"灵性",INT:"悟性",SPI:"悟性",LUK:"气运"}[n];r&&r in t&&(t[r]+=a)}}})}),t}([n]);Object.keys(t).forEach(n=>{t[n]+=e[n]})}}),t}(t),i={根骨:a.根骨+r.根骨+o.根骨,灵性:a.灵性+r.灵性+o.灵性,悟性:a.悟性+r.悟性+o.悟性,气运:a.气运+r.气运+o.气运,魅力:a.魅力+r.魅力+o.魅力,心性:a.心性+r.心性+o.心性};return{先天六司:e,后天六司:i,最终六司:{根骨:e.根骨+i.根骨,灵性:e.灵性+i.灵性,悟性:e.悟性+i.悟性,气运:e.气运+i.气运,魅力:e.魅力+i.魅力,心性:e.心性+i.心性}}}const kC=(0,V.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),wC=(0,V.A)("file-question-mark",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]),EC=(0,V.A)("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),NC=(0,V.A)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),SC=(0,V.A)("flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),VC=(0,V.A)("stamp",[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]]),_C={class:"body-stats-panel"},CC={class:"privacy-notice"},AC={key:0,class:"empty-stats"},DC={class:"empty-icon"},TC={class:"sub-text"},BC={key:1,class:"stats-container"},IC={key:0,class:"stat-section lifespan-section"},zC={class:"section-title"},MC={class:"lifespan-display"},PC={class:"lifespan-info"},RC={class:"lifespan-current"},$C={class:"lifespan-max"},OC={class:"lifespan-unit"},LC={class:"lifespan-bar"},FC={class:"lifespan-hint"},jC={class:"stat-section"},UC={class:"section-title"},qC={class:"stats-grid"},GC={class:"stat-card"},HC={class:"label"},YC={class:"value"},WC={class:"stat-card"},XC={class:"label"},JC={class:"value"},KC={key:0,class:"stat-card"},ZC={class:"label"},QC={class:"value"},eA={key:0,class:"tags-container"},tA={key:1,class:"stat-section"},nA={class:"section-title"},aA={class:"measurements-display"},rA={class:"measurement-item"},oA={class:"measure-circle"},iA={class:"measure-val"},sA={class:"measure-label"},lA={class:"measurement-item"},cA={class:"measure-circle"},dA={class:"measure-val"},uA={class:"measure-label"},mA={class:"measurement-item"},pA={class:"measure-circle"},gA={class:"measure-val"},hA={class:"measure-label"},fA={key:0,class:"cup-display"},vA={class:"cup-label"},bA={class:"cup-value"},yA={key:2,class:"stat-section"},xA={class:"section-title"},kA={class:"description-list"},wA={key:0,class:"desc-item"},EA={class:"desc-label"},NA={class:"desc-content"},SA={key:1,class:"desc-item"},VA={class:"desc-label"},_A={class:"desc-content"},CA={key:2,class:"desc-item"},AA={class:"desc-label"},DA={class:"desc-content"},TA={key:3,class:"stat-section"},BA={class:"section-title"},IA={key:0,class:"sensitive-points"},zA={class:"sub-title"},MA={class:"points-list"},PA={key:1,class:"development-list"},RA={class:"dev-header"},$A={class:"dev-name"},OA={class:"dev-val"},LA={class:"dev-bar"},FA={key:4,class:"stat-section"},jA={class:"section-title"},UA={class:"markings-list"},qA=(0,r.defineComponent)({__name:"BodyStatsPanel",props:{bodyStats:{},lifespan:{}},setup(e){const t=e,{t:n}=(0,K.s)(),a=(0,r.computed)(()=>t.bodyStats),o=(0,r.ref)((0,se.isTavernEnv)()),i=(0,r.ref)(!0),s=()=>{o.value=(0,se.isTavernEnv)(),i.value=(0,Af.rW)().nsfwMode};(0,r.onMounted)(s),(0,r.onActivated)(s);const l=(0,r.computed)(()=>{const e=o.value?n("酒馆环境"):n("网页环境"),t=i.value?n("成人内容：开启"):n("成人内容：关闭");return`${n("私密档案")} · ${e} · ${t}`}),c=(0,r.computed)(()=>!!a.value&&(a.value.敏感点&&a.value.敏感点.length>0||a.value.开发度&&Object.keys(a.value.开发度).length>0)),d=(0,r.computed)(()=>t.lifespan?Math.min(100,Math.round(t.lifespan.current/t.lifespan.max*100)):0);return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",_C,[(0,r.createCommentVNode)(" 警告提示 (仅在开发/调试时显示，或者作为沉浸式提示) "),(0,r.createElementVNode)("div",CC,[(0,r.createVNode)((0,r.unref)(kC),{size:14}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(l.value),1)]),a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",BC,[(0,r.createCommentVNode)(" 寿元状态 "),e.lifespan?((0,r.openBlock)(),(0,r.createElementBlock)("div",IC,[(0,r.createElementVNode)("h3",zC,[(0,r.createVNode)((0,r.unref)(cm),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("寿元")),1)]),(0,r.createElementVNode)("div",MC,[(0,r.createElementVNode)("div",PC,[(0,r.createElementVNode)("span",RC,(0,r.toDisplayString)(e.lifespan.current),1),t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"lifespan-divider"},"/",-1)),(0,r.createElementVNode)("span",$C,(0,r.toDisplayString)(e.lifespan.max),1),(0,r.createElementVNode)("span",OC,(0,r.toDisplayString)((0,r.unref)(n)("岁")),1)]),(0,r.createElementVNode)("div",LC,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["lifespan-fill",{warning:d.value>70,danger:d.value>90}]),style:(0,r.normalizeStyle)({width:d.value+"%"})},null,6)]),(0,r.createElementVNode)("div",FC,(0,r.toDisplayString)((0,r.unref)(n)("剩余"))+" "+(0,r.toDisplayString)(e.lifespan.max-e.lifespan.current)+" "+(0,r.toDisplayString)((0,r.unref)(n)("年")),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 基础体格 "),(0,r.createElementVNode)("div",jC,[(0,r.createElementVNode)("h3",UC,[(0,r.createVNode)((0,r.unref)(EC),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("基础体格")),1)]),(0,r.createElementVNode)("div",qC,[(0,r.createElementVNode)("div",GC,[(0,r.createElementVNode)("span",HC,(0,r.toDisplayString)((0,r.unref)(n)("身高")),1),(0,r.createElementVNode)("span",YC,[(0,r.createTextVNode)((0,r.toDisplayString)(a.value.身高||"???")+" ",1),t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"unit"},"cm",-1))])]),(0,r.createElementVNode)("div",WC,[(0,r.createElementVNode)("span",XC,(0,r.toDisplayString)((0,r.unref)(n)("体重")),1),(0,r.createElementVNode)("span",JC,[(0,r.createTextVNode)((0,r.toDisplayString)(a.value.体重||"???")+" ",1),t[2]||(t[2]=(0,r.createElementVNode)("span",{class:"unit"},"kg",-1))])]),a.value.体脂率?((0,r.openBlock)(),(0,r.createElementBlock)("div",KC,[(0,r.createElementVNode)("span",ZC,(0,r.toDisplayString)((0,r.unref)(n)("体脂率")),1),(0,r.createElementVNode)("span",QC,[(0,r.createTextVNode)((0,r.toDisplayString)(a.value.体脂率)+" ",1),t[3]||(t[3]=(0,r.createElementVNode)("span",{class:"unit"},"%",-1))])])):(0,r.createCommentVNode)("v-if",!0)]),a.value.外观特征&&a.value.外观特征.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",eA,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value.外观特征,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"feature-tag"},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 三围数据 "),a.value.三围?((0,r.openBlock)(),(0,r.createElementBlock)("div",tA,[(0,r.createElementVNode)("h3",nA,[(0,r.createVNode)((0,r.unref)(NC),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("身材数据")),1)]),(0,r.createElementVNode)("div",aA,[(0,r.createElementVNode)("div",rA,[(0,r.createElementVNode)("div",oA,[(0,r.createElementVNode)("span",iA,(0,r.toDisplayString)(a.value.三围.胸围||"?"),1),(0,r.createElementVNode)("span",sA,(0,r.toDisplayString)((0,r.unref)(n)("胸围")),1)])]),t[4]||(t[4]=(0,r.createElementVNode)("div",{class:"measurement-divider"},"-",-1)),(0,r.createElementVNode)("div",lA,[(0,r.createElementVNode)("div",cA,[(0,r.createElementVNode)("span",dA,(0,r.toDisplayString)(a.value.三围.腰围||"?"),1),(0,r.createElementVNode)("span",uA,(0,r.toDisplayString)((0,r.unref)(n)("腰围")),1)])]),t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"measurement-divider"},"-",-1)),(0,r.createElementVNode)("div",mA,[(0,r.createElementVNode)("div",pA,[(0,r.createElementVNode)("span",gA,(0,r.toDisplayString)(a.value.三围.臀围||"?"),1),(0,r.createElementVNode)("span",hA,(0,r.toDisplayString)((0,r.unref)(n)("臀围")),1)])])]),a.value.罩杯?((0,r.openBlock)(),(0,r.createElementBlock)("div",fA,[(0,r.createElementVNode)("span",vA,(0,r.toDisplayString)((0,r.unref)(n)("罩杯")),1),(0,r.createElementVNode)("span",bA,(0,r.toDisplayString)(a.value.罩杯),1)])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 详细描述 "),a.value.胸部描述||a.value.私处描述||a.value.生殖器描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",yA,[(0,r.createElementVNode)("h3",xA,[(0,r.createVNode)((0,r.unref)(Vu),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("详细特征")),1)]),(0,r.createElementVNode)("div",kA,[a.value.胸部描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",wA,[(0,r.createElementVNode)("span",EA,(0,r.toDisplayString)((0,r.unref)(n)("胸部")),1),(0,r.createElementVNode)("p",NA,(0,r.toDisplayString)(a.value.胸部描述),1)])):(0,r.createCommentVNode)("v-if",!0),a.value.私处描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",SA,[(0,r.createElementVNode)("span",VA,(0,r.toDisplayString)((0,r.unref)(n)("私处")),1),(0,r.createElementVNode)("p",_A,(0,r.toDisplayString)(a.value.私处描述),1)])):(0,r.createCommentVNode)("v-if",!0),a.value.生殖器描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",CA,[(0,r.createElementVNode)("span",AA,(0,r.toDisplayString)((0,r.unref)(n)("生殖器")),1),(0,r.createElementVNode)("p",DA,(0,r.toDisplayString)(a.value.生殖器描述),1)])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 敏感点与开发 "),c.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",TA,[(0,r.createElementVNode)("h3",BA,[(0,r.createVNode)((0,r.unref)(SC),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("敏感与开发")),1)]),a.value.敏感点&&a.value.敏感点.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",IA,[(0,r.createElementVNode)("span",zA,(0,r.toDisplayString)((0,r.unref)(n)("敏感点"))+":",1),(0,r.createElementVNode)("div",MA,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value.敏感点,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"point-tag"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0),a.value.开发度?((0,r.openBlock)(),(0,r.createElementBlock)("div",PA,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value.开发度,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"dev-item"},[(0,r.createElementVNode)("div",RA,[(0,r.createElementVNode)("span",$A,(0,r.toDisplayString)(t),1),(0,r.createElementVNode)("span",OA,(0,r.toDisplayString)(e)+"%",1)]),(0,r.createElementVNode)("div",LA,[(0,r.createElementVNode)("div",{class:"dev-fill",style:(0,r.normalizeStyle)({width:e+"%"})},null,4)])]))),128))])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 纹身与印记 "),a.value.纹身与印记&&a.value.纹身与印记.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",FA,[(0,r.createElementVNode)("h3",jA,[(0,r.createVNode)((0,r.unref)(VC),{size:18,class:"title-icon"}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(n)("纹身与印记")),1)]),(0,r.createElementVNode)("ul",UA,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value.纹身与印记,e=>((0,r.openBlock)(),(0,r.createElementBlock)("li",{key:e,class:"marking-item"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",AC,[(0,r.createElementVNode)("div",DC,[(0,r.createVNode)((0,r.unref)(wC),{size:32})]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(n)("暂无详细身体数据")),1),(0,r.createElementVNode)("p",TC,(0,r.toDisplayString)((0,r.unref)(n)("请在酒馆中完善角色设定")),1)]))]))}});var GA=n(3830),HA={};HA.styleTagTransform=k(),HA.setAttributes=v(),HA.insert=h().bind(null,"head"),HA.domAPI=p(),HA.insertStyleElement=y(),u()(GA.A,HA),GA.A&&GA.A.locals&&GA.A.locals;const YA=(0,N.A)(qA,[["__scopeId","data-v-7f6fd3e6"]]);n(3943);const WA=(0,V.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),XA=(0,V.A)("mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]),JA=(0,V.A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),KA=(0,V.A)("sprout",[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]]),ZA=(0,V.A)("handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]),QA=(0,V.A)("backpack",[["path",{d:"M4 10a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z",key:"1ol0lm"}],["path",{d:"M8 10h8",key:"c7uz4u"}],["path",{d:"M8 18h8",key:"1no2b1"}],["path",{d:"M8 22v-6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v6",key:"1fr6do"}],["path",{d:"M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2",key:"donm21"}]]),eD=(0,V.A)("rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]),tD={class:"character-details-wrapper"},nD={key:0,class:"loading-container"},aD={key:1,class:"error-container"},rD={class:"error-icon"},oD={key:2,class:"character-details-content"},iD={class:"character-header-card"},sD={class:"header-content"},lD={class:"profile-section"},cD={class:"avatar-wrapper"},dD=["title"],uD={class:"avatar-text"},mD={class:"identity-info"},pD={class:"character-title"},gD={class:"character-subtitle"},hD={class:"subtitle-item race-text"},fD={class:"subtitle-item age-text"},vD={class:"subtitle-item origin-text"},bD={class:"core-stats-grid"},yD={class:"stat-card realm-card"},xD={class:"card-icon"},kD={class:"card-content"},wD={class:"card-label"},ED={class:"card-value realm-value"},ND={key:0,class:"stat-card spirit-card"},SD={class:"card-icon"},VD={class:"card-content"},_D={class:"card-label"},CD={class:"card-value spirit-value"},AD=["title"],DD={class:"card-icon"},TD={class:"card-content"},BD={class:"card-label"},ID={class:"card-value location-value"},zD=["title"],MD={class:"card-icon"},PD={class:"card-content"},RD={class:"card-label"},$D={class:"card-value body-value"},OD=["title"],LD={class:"card-icon"},FD={class:"card-content"},jD={class:"card-label"},UD={class:"card-value origin-value"},qD={class:"cultivation-section"},GD={key:0,class:"cultivation-status mortal-status"},HD={class:"status-text"},YD={key:1,class:"cultivation-progress-card"},WD={class:"progress-header"},XD={class:"progress-label"},JD={class:"progress-percentage"},KD={class:"progress-bar-container"},ZD={class:"progress-bar-bg"},QD={class:"progress-text"},eT={key:2,class:"cultivation-status waiting-status"},tT={class:"status-icon"},nT={class:"status-text"},aT={class:"tabs-nav"},rT=["onClick"],oT={key:0,class:"tab-content"},iT={class:"content-grid"},sT={class:"info-section"},lT={class:"section-title"},cT={class:"title-icon"},dT={class:"vitals-grid"},uT={class:"vital-label"},mT={class:"vital-bar"},pT={class:"bar-container"},gT={class:"vital-text"},hT={class:"vital-item reputation-item"},fT={class:"vital-label"},vT={class:"reputation-display"},bT={class:"reputation-value"},yT={class:"info-section"},xT={class:"section-title"},kT={class:"title-icon"},wT={class:"basic-info-grid"},ET={class:"basic-info-item"},NT={class:"info-label"},ST={class:"info-value realm"},VT={key:0,class:"basic-info-item"},_T={class:"info-label"},CT={class:"basic-info-item"},AT={class:"info-label"},DT={class:"basic-info-item"},TT={class:"info-label"},BT={class:"info-value"},IT={key:1,class:"basic-info-item"},zT={class:"info-label"},MT={class:"info-value location"},PT={key:2,class:"basic-info-item"},RT={class:"info-label"},$T={class:"info-value world"},OT={class:"info-section"},LT={class:"section-title"},FT={class:"title-icon"},jT={class:"talent-content"},UT={class:"talent-tier-card"},qT={class:"tier-header"},GT={class:"tier-icon"},HT={class:"tier-label"},YT={class:"tier-value-display"},WT={key:0,class:"tier-description"},XT={class:"root-header"},JT={class:"root-icon"},KT={class:"root-label"},ZT={class:"click-hint"},QT={class:"root-main-info"},eB={class:"property-badges"},tB={class:"prop-badge speed-badge"},nB={key:0,class:"root-description"},aB={key:1,class:"root-effects"},rB={class:"effects-tags"},oB={class:"talents-card"},iB={class:"talents-header"},sB={class:"talents-icon"},lB={class:"talents-label"},cB={key:0,class:"talents-count"},dB={key:0,class:"talents-container"},uB=["title"],mB={class:"talent-name"},pB={key:0,class:"talent-description-display"},gB={key:1,class:"talents-container no-talents"},hB={class:"talent-item no-talent"},fB={class:"talent-name"},vB={class:"info-section"},bB={class:"section-title"},yB={class:"title-icon"},xB={class:"attributes-display"},kB={class:"final-attributes"},wB={class:"attribute-group-title"},EB={class:"attributes-grid"},NB={class:"attr-name"},SB={class:"attr-value"},VB={class:"attribute-breakdown"},_B={class:"innate-attrs"},CB={class:"attribute-group-title"},AB={class:"attributes-grid compact"},DB={class:"attr-name"},TB={class:"attr-value"},BB={class:"acquired-attrs"},IB={class:"attribute-group-title"},zB={class:"attributes-grid compact"},MB={class:"attr-name"},PB={class:"attr-value"},RB={key:1,class:"tab-content"},$B={class:"content-grid"},OB={class:"info-section"},LB={class:"section-title"},FB={class:"title-icon"},jB={key:2,class:"tab-content"},UB={class:"content-grid"},qB={class:"info-section"},GB={class:"section-title"},HB={class:"title-icon"},YB={key:0,class:"empty-state"},WB={class:"empty-icon"},XB={key:1,class:"cultivation-display"},JB={class:"technique-info"},KB={class:"technique-main"},ZB={class:"technique-quality"},QB={class:"technique-toggle"},eI={class:"technique-details"},tI={class:"technique-description"},nI={key:0,class:"technique-effects"},aI={class:"effects-title"},rI={class:"effects-list"},oI={key:0,class:"effect-item"},iI={class:"effect-label"},sI={class:"effect-value"},lI={key:1,class:"effect-item"},cI={class:"effect-label"},dI={class:"attribute-bonuses"},uI={key:1,class:"technique-effects no-effects"},mI={class:"effects-title"},pI={class:"no-effects-text"},gI={class:"technique-progress"},hI={key:0,class:"progress-item"},fI={class:"progress-label"},vI={class:"progress-bar"},bI={class:"progress-text"},yI={key:0,class:"learned-skills"},xI={class:"skills-title"},kI={class:"skills-count"},wI={class:"skills-preview"},EI={class:"skills-list-compact"},NI={key:0,class:"more-skills"},SI={class:"skills-details"},VI={key:0,class:"skill-category"},_I={class:"category-title"},CI={class:"skills-grid"},AI=["onClick"],DI={class:"skill-name"},TI={class:"skill-type"},BI={class:"skill-source"},II={class:"skill-proficiency-mini"},zI={class:"skill-status"},MI={key:1,class:"skill-category"},PI={class:"category-title"},RI={class:"skills-grid"},$I=["onClick"],OI={class:"skill-name"},LI={class:"skill-type"},FI={class:"skill-unlock"},jI={class:"info-section"},UI={class:"section-title"},qI={class:"title-icon"},GI={key:0,class:"empty-state"},HI={class:"empty-icon"},YI={key:1,class:"dao-list"},WI={class:"dao-header-section"},XI={class:"dao-summary"},JI={class:"dao-count"},KI={class:"dao-preview"},ZI=["onClick"],QI={class:"dao-header"},ez={class:"dao-name"},tz={class:"dao-stage"},nz={class:"dao-progress"},az={class:"progress-bar small"},rz={class:"progress-text small"},oz={key:0,class:"more-dao"},iz={class:"dao-details"},sz=["onClick"],lz={class:"dao-header"},cz={class:"dao-name"},dz={class:"dao-stage"},uz={class:"dao-progress"},mz={class:"progress-bar small"},pz={class:"progress-text small"},gz={class:"dao-stats"},hz={class:"stat-item"},fz={class:"stat-label"},vz={class:"stat-value"},bz={class:"stat-item"},yz={class:"stat-label"},xz={class:"stat-value"},kz={key:3,class:"tab-content"},wz={class:"content-grid"},Ez={class:"info-section"},Nz={class:"section-title"},Sz={class:"title-icon"},Vz={key:0,class:"empty-state"},_z={class:"empty-icon"},Cz={key:1,class:"relationships-summary"},Az={class:"relationship-stats"},Dz={class:"stat-item"},Tz={class:"stat-label"},Bz={class:"stat-value"},Iz={class:"stat-item"},zz={class:"stat-label"},Mz={class:"stat-value"},Pz={class:"info-section"},Rz={class:"section-title"},$z={class:"title-icon"},Oz={class:"inventory-summary"},Lz={class:"inventory-stats"},Fz={class:"stat-group"},jz={class:"stat-item"},Uz={class:"stat-label"},qz={class:"stat-value"},Gz={class:"stat-item"},Hz={class:"stat-label"},Yz={class:"stat-value"},Wz={class:"stat-item"},Xz={class:"stat-label"},Jz={class:"stat-value"},Kz={class:"spirit-stones"},Zz={class:"stones-title"},Qz={class:"stones-grid"},eM={class:"stone-name"},tM={class:"stone-count"},nM={key:0,class:"info-section"},aM={class:"section-title"},rM={class:"title-icon"},oM={class:"sect-info"},iM={class:"sect-header"},sM={class:"sect-name"},lM={class:"sect-type"},cM={class:"sect-details"},dM={class:"detail-row"},uM={class:"detail-label"},mM={class:"detail-value"},pM={class:"detail-row"},gM={class:"detail-label"},hM={class:"detail-value"},fM={class:"detail-row"},vM={class:"detail-label"},bM={class:"modal-header"},yM={class:"modal-content"},xM={class:"skill-detail-grid"},kM={class:"skill-detail-item"},wM={class:"detail-label"},EM={class:"detail-value"},NM={class:"skill-detail-item"},SM={class:"detail-label"},VM={class:"skill-detail-item"},_M={class:"detail-label"},CM={class:"detail-value"},AM={class:"skill-detail-item"},DM={class:"detail-label"},TM={class:"detail-value"},BM={class:"skill-detail-item"},IM={class:"detail-label"},zM={class:"detail-value"},MM={class:"skill-description"},PM={class:"modal-header"},RM={class:"modal-content"},$M={class:"dao-progress-section"},OM={class:"dao-stage-info"},LM={class:"stage-label"},FM={class:"stage-value"},jM={class:"dao-progress-bar"},UM={class:"progress-bar-bg"},qM={class:"progress-text"},GM={class:"dao-stats-grid"},HM={class:"dao-stat-item"},YM={class:"stat-label"},WM={class:"stat-value"},XM={class:"dao-stat-item"},JM={class:"stat-label"},KM={class:"stat-value"},ZM={class:"dao-description"},QM={class:"modal-header"},eP={class:"modal-content"},tP={class:"spirit-root-detail-grid"},nP={class:"detail-card"},aP={class:"detail-header"},rP={class:"detail-icon"},oP={class:"detail-title"},iP={class:"detail-card"},sP={class:"detail-header"},lP={class:"detail-icon"},cP={class:"detail-title"},dP={class:"detail-card"},uP={class:"detail-header"},mP={class:"detail-icon"},pP={class:"detail-title"},gP={class:"detail-value speed-value"},hP={key:0,class:"spirit-root-effects-section"},fP={class:"effects-grid"},vP={key:1,class:"advanced-details"},bP={class:"advanced-grid"},yP={key:0,class:"advanced-item"},xP={class:"advanced-label"},kP={class:"advanced-value"},wP={key:1,class:"advanced-item"},EP={class:"advanced-label"},NP={class:"advanced-value"},SP=(0,r.defineComponent)({__name:"CharacterDetailsPanel",setup(e){const{t}=(0,K.s)(),n=(0,A.useUIStore)(),a=(0,Jc.useCharacterStore)(),o=(0,pu.useGameStateStore)(),i=(0,r.ref)((0,se.isTavernEnv)()),s=(0,r.ref)(!1);(0,r.onMounted)(()=>{i.value=(0,se.isTavernEnv)()}),(0,r.onActivated)(()=>{i.value=(0,se.isTavernEnv)()});const l=(0,r.computed)(()=>o.toSaveData()),c=(0,r.computed)(()=>o.character),d=(0,r.computed)(()=>o.attributes),u=(0,r.computed)(()=>o.location),m=(0,r.computed)(()=>o.sectMemberInfo),p=(0,r.computed)(()=>o.thousandDao),g=(0,r.computed)(()=>o.body||null),h=(0,r.computed)(()=>{const e=d.value?.寿命;if(!e)return;const t=Number(e.当前??0),n=Number(e.上限??0);return n?{current:t,max:n}:void 0}),f=(0,r.computed)(()=>{if(!i.value)return"";const e=g.value,n=Number(e?.身高),a=Number(e?.体重);return Number.isFinite(n)&&n>0&&Number.isFinite(a)&&a>0?`${n}cm · ${a}kg`:t(e&&"object"==typeof e?"待完善":"未建立")}),v=(0,r.ref)(!1),b=(0,r.ref)(!1),y=(0,r.ref)(!1),x=(0,r.ref)(!1),k=(0,r.ref)(!1),w=(0,r.ref)(!1),E=(0,r.ref)(null),N=(0,r.ref)(null),S=(0,r.ref)("character"),V=(0,r.computed)(()=>{const e=[{id:"character",label:"角色信息",icon:fu},{id:"cultivation",label:"修炼体系",icon:vu.A},{id:"social",label:"社交关系",icon:fu}];return i.value&&e.push({id:"body",label:"身体档案",icon:Xp}),e}),_=(0,r.computed)(()=>{const e=String(c.value?.名字||"").trim();return e?e.charAt(0):"?"}),C=(0,r.computed)(()=>{const e=c.value?.出生日期,t=l.value?.元数据?.时间;return e&&t?((e,t)=>{let n=t.年-e.年;return(t.月<e.月||t.月===e.月&&t.日<e.日)&&n--,Math.max(0,n)})({年:e.年,月:e.月,日:e.日,小时:e.小时??0,分钟:e.分钟??0},t):d.value?.寿命?.当前||0}),D=(0,r.computed)(()=>{if(!l.value?.角色?.修炼?.修炼功法||!l.value?.角色?.背包?.物品)return null;const e=l.value.角色?.修炼?.修炼功法?.物品ID;if(!e)return null;const t=l.value.角色.背包.物品[e];return t&&"功法"===t.类型?t:null}),T=(0,r.computed)(()=>p.value?.大道列表?Object.values(p.value.大道列表).filter(e=>e.是否解锁):[]),B=(0,r.computed)(()=>{if(!d.value)return[];const e=e=>("number"==typeof e?e:Number(e||0))||0,n=e=>{const t="number"==typeof e?e:Number(e||0);return isNaN(t)?0:Math.max(0,t)};return[{label:t("气血"),current:e(d.value.气血?.当前),max:n(d.value.气血?.上限),color:"red"},{label:t("灵气"),current:e(d.value.灵气?.当前),max:n(d.value.灵气?.上限),color:"blue"},{label:t("神识"),current:e(d.value.神识?.当前),max:n(d.value.神识?.上限),color:"gold"}]}),I=e=>{const t="number"==typeof e?e:Number(e||0);return isNaN(t)?0:Math.max(0,Math.min(10,Math.round(t)))},z=(0,r.computed)(()=>{const e=c.value?.先天六司||{};return{根骨:I(e.根骨),灵性:I(e.灵性),悟性:I(e.悟性),气运:I(e.气运),魅力:I(e.魅力),心性:I(e.心性)}}),M=(0,r.computed)(()=>{if(!l.value)return z.value;const e=xC(z.value,l.value);return e?.最终六司||z.value}),P=(0,r.computed)(()=>{const e={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0};if(!l.value)return e;const t=xC(z.value,l.value);return t?.后天六司||e}),R=(0,r.computed)(()=>{const e=D.value?.功法效果;if(!e)return!1;const t=e.修炼速度加成&&e.修炼速度加成>0,n=e.属性加成&&Object.keys(e.属性加成).length>0;return t||n}),$=(0,r.computed)(()=>{const e=D.value;return e&&e.功法技能?e.功法技能.filter(t=>{const n=(e.已解锁技能||[]).includes(t.技能名称),a=t.熟练度要求??100,r=(e.修炼进度||0)>=a;return!(n||r)}).map(e=>{const n=e.熟练度要求??100;return{name:e.技能名称,description:e.技能描述||"",type:t("功法技能"),unlockCondition:0===n?t("自动解锁"):t("需要熟练度 {0}%").replace("{0}",String(n)),unlocked:!1}}):[]}),O=(0,r.computed)(()=>{const e=l.value?.技能?.掌握技能||[];let n=[];if(D.value&&D.value.功法技能){const e=D.value;if(!e.功法技能)return[];n=e.功法技能.filter(t=>{const n=(e.已解锁技能||[]).includes(t.技能名称),a=(e.修炼进度||0)>=(t.熟练度要求??100);return n||a}).map(n=>({name:n.技能名称,proficiency:ce(n.技能名称,"technique"),source:e.名称||t("功法"),type:t("功法技能"),description:n.技能描述||t("通过功法修炼掌握"),unlocked:!0}))}const a=[...e.map(e=>({name:e.技能名称,proficiency:e.熟练度,source:e.来源,type:t("掌握技能"),description:e.技能描述,unlocked:!0})),...n],r=new Map;return a.forEach(e=>{r.has(e.name)||r.set(e.name,e)}),Array.from(r.values())}),L=(0,r.computed)(()=>O.value.length),F=(0,r.computed)(()=>{const e=l.value?.社交?.关系||{};return Object.values(e).filter(e=>e&&e.名字).length}),j=(0,r.computed)(()=>{if(!l.value?.社交?.关系)return 0;const e=Object.values(l.value.社交.关系).filter(e=>e&&e.名字);if(0===e.length)return 0;const t=e.reduce((e,t)=>e+(t.好感度||0),0);return Math.round(t/e.length)}),U=(0,r.computed)(()=>{const e=l.value?.角色?.背包?.物品||{};return Object.entries(e).filter(([e,t])=>!String(e).startsWith("_")&&t&&"object"==typeof t&&"string"==typeof t.名称).length}),q=[{name:t("下品"),class:"grade-common"},{name:t("中品"),class:"grade-rare"},{name:t("上品"),class:"grade-epic"},{name:t("极品"),class:"grade-legend"}],G=()=>{const e=d.value?.境界?.名称;switch(e){case"凡人":case"普通人":return t("等待仙缘");case"蛮兽":case"灵兽":return t("野性本能");case"动物":return t("自然状态");default:return t("等待觉醒")}},H=()=>{const e=d.value?.境界?.当前进度,t=d.value?.境界?.下一级所需;return"number"==typeof e&&"number"==typeof t&&t>0},Y=()=>{const e=d.value?.境界?.当前进度||0,t=d.value?.境界?.下一级所需||100;if(t>=1e4){const n=Math.floor(e/1e3),a=Math.floor(t/1e3);if(n>0&&a>0)return`${n}k/${a}k`}return`${e}/${t}`},W=e=>{if(e&&"object"==typeof e)return Fu({name:e.名称||"",阶段:e.阶段||"",当前进度:e.当前进度,下一级所需:e.下一级所需});const t="string"==typeof e?e:void 0,n=d.value?.境界?.当前进度,a=d.value?.境界?.下一级所需,r=d.value?.境界?.阶段;return Fu({name:t,阶段:r,当前进度:n,下一级所需:a})},X=()=>{const e=d.value?.境界?.当前进度||0,t=d.value?.境界?.下一级所需||100;return Math.round(e/t*100)},J=e=>e?"string"==typeof e?e:e.name||t("未知"):t("未知"),Z=e=>"object"==typeof e&&e&&e.description||"",Q=e=>{let n=[];if(!e)return[];if(Array.isArray(e))n=e;else if("string"==typeof e)try{const t=JSON.parse(e);Array.isArray(t)?n=t:"string"==typeof t&&(n=[{name:t,description:""}])}catch(t){n=[{name:e,description:""}]}else"object"==typeof e&&null!==e&&(n=[e]);return n.map(e=>{if("string"==typeof e)return{name:e,description:""};if("object"==typeof e&&null!==e){const n=e,a=n.name||n["名称"]||"",r=n.description||n["描述"]||"";return a||r?{name:a||t("未知天赋"),description:r}:null}return null}).filter(Boolean)},ee=(e,n="border")=>e?`${n}-quality-${e.品质?.quality||t("未知")}`:"",te=e=>p.value?.大道列表?.[e],ne=e=>te(e)?.当前阶段||0,ae=e=>{const t=te(e);if(!t)return 0;const n=t.当前阶段||0,a=t.阶段列表?.[n];if(!a)return 0;const r=a.突破经验;return r<=0?100:Math.min(100,Math.round(t.当前经验/r*100))},re=e=>te(e)?.当前经验||0,oe=e=>te(e)?.总经验||0,ie=e=>{const t=l.value?.角色?.背包?.物品||{};return Object.entries(t).filter(([e,t])=>!String(e).startsWith("_")&&t&&"object"==typeof t).map(([,e])=>e).filter(t=>t.类型===e).length},le=e=>l.value?.角色?.背包?.灵石?.[t(e)]||0,ce=(e,t)=>30+(e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)+t.length)%66,de=()=>{k.value=!k.value},ue=()=>{w.value=!w.value},me=()=>{v.value=!v.value},pe=e=>{N.value=e,y.value=!0},ge=e=>{E.value=e,b.value=!0},he=()=>{x.value=!0},fe=()=>{b.value=!1,y.value=!1,x.value=!1,E.value=null,N.value=null},ve=()=>{if(!N.value)return null;const e=te(N.value);if(!e)return{name:N.value,stage:t("初始阶段"),currentExp:0,totalExp:0,progressPercent:0,description:t("此大道已解锁，但尚未开始修炼")};const n=e.当前阶段||0,a=e.当前经验||0,r=e.总经验||0,o=ae(N.value);let i;return i=e.阶段列表?.[n]?e.阶段列表[n].名称:0===n?t("未门"):t("第{0}阶段").replace("{0}",String(n)),{name:N.value,stage:i,currentExp:a,totalExp:r,progressPercent:o,description:e.描述||t("此道深奥玄妙，需持之以恒方能有所成就")}},be=()=>{if(!E.value)return null;if("object"==typeof E.value&&"proficiency"in E.value){const e=E.value;return{name:e.name,type:e.type,status:t("已解锁"),condition:t("已掌握"),description:e.description,source:e.source,proficiency:e.proficiency}}if("string"==typeof E.value)return{name:E.value,type:t("功法技能"),status:t("已解锁"),condition:t("修炼完成"),description:t("通过修炼功法获得的技能"),source:t("功法修炼")};const e=E.value;return{name:e.name,type:e.type,status:e.unlocked?t("已解锁"):t("未解锁"),condition:e.unlocked?t("修炼完成"):e.unlockCondition,description:e.description,source:t("功法传承")}},ye=async()=>{s.value=!0;try{await a.reloadFromStorage();const e=(0,pu.useGameStateStore)(),n=e.getCurrentSaveData();n&&(e.loadFromSaveData(n),nV.Yz.log(t("人物详情"),t("已同步最新数据到 gameStateStore")))}catch(e){nV.Yz.error(t("人物详情"),t("刷新数据失败"),e)}finally{s.value=!1}};(0,r.onMounted)(async()=>{nV.Yz.log(t("人物详情"),t("组件挂载，同步数据"))}),(0,r.onActivated)(async()=>{nV.Yz.log(t("人物详情"),t("面板激活"))});const xe=e=>e?"string"==typeof e?e:e.名称||e.name||t("待定"):t("待定"),ke=e=>{if(!e)return t("未知");if("string"==typeof e)return e;const n=e.名称||e.name||t("未知");let a=e.品级||e.tier;return a&&"object"==typeof a&&(a=a.quality||a.grade||t("未知")),a&&a!==t("未知")&&a!==t("凡品")?`${n}(${t(a)})`:n},we=e=>"object"==typeof e&&e&&(e.品级||e.tier)||t("凡品"),Ee=e=>"object"==typeof e&&e&&(e.描述||e.description)||t("未知"),Ne=e=>{if("object"!=typeof e||!e)return"spirit-unknown";let t=e.品级||e.tier||"";"object"==typeof t&&t&&(t=t.quality||t.grade||"");const n=String(t).toLowerCase();return n.includes("神品")?"spirit-divine":n.includes("极品")?"spirit-supreme":n.includes("上品")?"spirit-superior":n.includes("中品")?"spirit-medium":n.includes("下品")?"spirit-inferior":n.includes("凡品")?"spirit-common":"spirit-unknown"},Se=e=>{const n=e?.灵根;if(n&&"object"==typeof n){const e=n;if("base_multiplier"in e&&e.base_multiplier)return`${e.base_multiplier}x`;if("cultivation_speed"in e&&e.cultivation_speed)return e.cultivation_speed}const a=we(n);return{凡品:"1.0x",下品:"1.1x",中品:"1.3x",上品:"1.6x",极品:"2.0x",神品:"2.8x",特殊:t("特殊")}[a]||"1.0x"},Ve=e=>{const t=e?.灵根;if(t&&"object"==typeof t){const e=t;if("special_effects"in e&&Array.isArray(e.special_effects))return e.special_effects}return[]};return(e,a)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",tD,[s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",nD,[a[5]||(a[5]=(0,r.createElementVNode)("div",{class:"loading-spinner"},null,-1)),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)("加载角色数据..")),1)])):c.value&&l.value?c.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",oD,[(0,r.createCommentVNode)(" 顶部角色信息卡片 - 全新设计 "),(0,r.createElementVNode)("div",iD,[(0,r.createCommentVNode)(" 背景装饰 "),a[12]||(a[12]=(0,r.createElementVNode)("div",{class:"header-bg-decoration"},null,-1)),(0,r.createCommentVNode)(" 主要信息区 "),(0,r.createElementVNode)("div",sD,[(0,r.createCommentVNode)(" 左侧：头像和基础信息 "),(0,r.createElementVNode)("div",lD,[(0,r.createElementVNode)("div",cD,[(0,r.createElementVNode)("div",{class:"avatar-circle",title:c.value.名字},[(0,r.createElementVNode)("span",uD,(0,r.toDisplayString)(_.value),1)],8,dD),a[6]||(a[6]=(0,r.createElementVNode)("div",{class:"avatar-glow"},null,-1))]),(0,r.createElementVNode)("div",mD,[(0,r.createElementVNode)("h1",pD,(0,r.toDisplayString)(c.value.名字),1),(0,r.createElementVNode)("div",gD,[c.value.性别?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["subtitle-item",`gender-badge gender-${c.value.性别}`])},(0,r.toDisplayString)(("男"===c.value.性别?"♂":"♀")+" "+(0,r.unref)(t)(c.value.性别)),3),a[7]||(a[7]=(0,r.createElementVNode)("span",{class:"subtitle-divider"},"·",-1))],64)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("span",hD,(0,r.toDisplayString)((0,r.unref)(t)(c.value.种族||"人族")),1),a[8]||(a[8]=(0,r.createElementVNode)("span",{class:"subtitle-divider"},"·",-1)),(0,r.createElementVNode)("span",fD,(0,r.toDisplayString)(C.value)+(0,r.toDisplayString)((0,r.unref)(t)("岁")),1),a[9]||(a[9]=(0,r.createElementVNode)("span",{class:"subtitle-divider"},"·",-1)),(0,r.createElementVNode)("span",vD,(0,r.toDisplayString)(xe(c.value.出生)),1)])])]),(0,r.createCommentVNode)(" 中间：核心数据卡片组 "),(0,r.createElementVNode)("div",bD,[(0,r.createCommentVNode)(" 境界卡片 "),(0,r.createElementVNode)("div",yD,[(0,r.createElementVNode)("div",xD,[(0,r.createVNode)((0,r.unref)(XA),{size:20})]),(0,r.createElementVNode)("div",kD,[(0,r.createElementVNode)("div",wD,(0,r.toDisplayString)((0,r.unref)(t)("境界")),1),(0,r.createElementVNode)("div",ED,(0,r.toDisplayString)(W(d.value?.境界?.名称)||(0,r.unref)(t)("凡人")),1)])]),(0,r.createCommentVNode)(" 灵根卡片 "),c.value.灵根?((0,r.openBlock)(),(0,r.createElementBlock)("div",ND,[(0,r.createElementVNode)("div",SD,[(0,r.createVNode)((0,r.unref)(Kp),{size:20})]),(0,r.createElementVNode)("div",VD,[(0,r.createElementVNode)("div",_D,(0,r.toDisplayString)((0,r.unref)(t)("灵根")),1),(0,r.createElementVNode)("div",CD,(0,r.toDisplayString)((p=c.value.灵根,p?"string"==typeof p?p:p.名称||p.name||t("未知"):t("未知"))),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 位置卡片 "),u.value?.描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"stat-card location-card",title:u.value.描述},[(0,r.createElementVNode)("div",DD,[(0,r.createVNode)((0,r.unref)(JA),{size:20})]),(0,r.createElementVNode)("div",TD,[(0,r.createElementVNode)("div",BD,(0,r.toDisplayString)((0,r.unref)(t)("位置")),1),(0,r.createElementVNode)("div",ID,(0,r.toDisplayString)(u.value.描述),1)])],8,AD)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 法身（仅酒馆端） "),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:2,class:"stat-card body-card clickable",onClick:a[0]||(a[0]=e=>S.value="body"),title:(0,r.unref)(t)("点击查看身体档案")},[(0,r.createElementVNode)("div",MD,[(0,r.createVNode)((0,r.unref)(Xp),{size:20})]),(0,r.createElementVNode)("div",PD,[(0,r.createElementVNode)("div",RD,(0,r.toDisplayString)((0,r.unref)(t)("法身")),1),(0,r.createElementVNode)("div",$D,(0,r.toDisplayString)(f.value),1)])],8,zD)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 出生卡片 "),c.value.出生?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:3,class:"stat-card origin-card clickable",onClick:a[1]||(a[1]=e=>(e=>{if(e&&"object"==typeof e){const a=e.名称||e.name,r=e.描述||e.description;n.showDetailModal({title:t("出身背景: {0}").replace("{0}",a),content:r})}})(c.value.出生)),title:"object"==typeof c.value.出生?(0,r.unref)(t)("点击查看详情"):""},[(0,r.createElementVNode)("div",LD,[(0,r.createVNode)((0,r.unref)(KA),{size:20})]),(0,r.createElementVNode)("div",FD,[(0,r.createElementVNode)("div",jD,(0,r.toDisplayString)((0,r.unref)(t)("出生")),1),(0,r.createElementVNode)("div",UD,(0,r.toDisplayString)(xe(c.value.出生)),1)])],8,OD)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 右侧：修为进度 "),(0,r.createElementVNode)("div",qD,[(o=d.value?.境界?.名称,!o||["凡人","蛮兽","灵兽","动物","凡物","普通人"].includes(o)?((0,r.openBlock)(),(0,r.createElementBlock)("div",GD,[a[10]||(a[10]=(0,r.createElementVNode)("div",{class:"status-icon"},"🌱",-1)),(0,r.createElementVNode)("div",HD,(0,r.toDisplayString)(G()),1)])):H()?((0,r.openBlock)(),(0,r.createElementBlock)("div",YD,[(0,r.createElementVNode)("div",WD,[(0,r.createElementVNode)("span",XD,(0,r.toDisplayString)((0,r.unref)(t)("修为进度")),1),(0,r.createElementVNode)("span",JD,(0,r.toDisplayString)(X())+"%",1)]),(0,r.createElementVNode)("div",KD,[(0,r.createElementVNode)("div",ZD,[(0,r.createElementVNode)("div",{class:"progress-bar-fill",style:(0,r.normalizeStyle)({width:X()+"%"})},a[11]||(a[11]=[(0,r.createElementVNode)("div",{class:"progress-bar-shine"},null,-1)]),4)])]),(0,r.createElementVNode)("div",QD,(0,r.toDisplayString)(Y()),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",eT,[(0,r.createElementVNode)("div",tT,[(0,r.createVNode)((0,r.unref)(Kp),{size:18})]),(0,r.createElementVNode)("div",nT,(0,r.toDisplayString)((0,r.unref)(t)("等待仙缘")),1)])))])])]),(0,r.createCommentVNode)(" 标签页导航 "),(0,r.createElementVNode)("div",aT,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(V.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.id,onClick:t=>S.value=e.id,class:(0,r.normalizeClass)(["tab-btn",{active:S.value===e.id}])},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:16})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)(e.label)),1)],10,rT))),128))]),(0,r.createCommentVNode)(" 角色信息标签页 "),"character"===S.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",oT,[(0,r.createElementVNode)("div",iT,[(0,r.createCommentVNode)(" 生命状态 "),(0,r.createElementVNode)("div",sT,[(0,r.createElementVNode)("h3",lT,[(0,r.createElementVNode)("div",cT,[(0,r.createVNode)((0,r.unref)(Xp),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("生命状态")),1)]),(0,r.createElementVNode)("div",dT,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(B.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"vital-item",key:e.label},[(0,r.createElementVNode)("div",uT,(0,r.toDisplayString)(e.label),1),(0,r.createElementVNode)("div",mT,[(0,r.createElementVNode)("div",pT,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["bar-fill",`bar-${e.color}`]),style:(0,r.normalizeStyle)({width:(t=e.current,n=e.max,Math.round(t/n*100)+"%")})},null,6)]),(0,r.createElementVNode)("div",gT,(0,r.toDisplayString)(e.current)+"/"+(0,r.toDisplayString)(e.max),1)])]);var t,n}),128)),(0,r.createCommentVNode)(" 声望显示 "),(0,r.createElementVNode)("div",hT,[(0,r.createElementVNode)("div",fT,(0,r.toDisplayString)((0,r.unref)(t)("声望")),1),(0,r.createElementVNode)("div",vT,[(0,r.createElementVNode)("span",bT,(0,r.toDisplayString)(d.value?.声望||(0,r.unref)(t)("籍籍无名")),1)])])])]),(0,r.createCommentVNode)(" 角色基础信息 "),(0,r.createElementVNode)("div",yT,[(0,r.createElementVNode)("h3",xT,[(0,r.createElementVNode)("div",kT,[(0,r.createVNode)((0,r.unref)(fu),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("角色背景")),1)]),(0,r.createElementVNode)("div",wT,[(0,r.createElementVNode)("div",ET,[(0,r.createElementVNode)("span",NT,(0,r.toDisplayString)((0,r.unref)(t)("境界")),1),(0,r.createElementVNode)("span",ST,(0,r.toDisplayString)(W(d.value?.境界)),1)]),c.value.性别?((0,r.openBlock)(),(0,r.createElementBlock)("div",VT,[(0,r.createElementVNode)("span",_T,(0,r.toDisplayString)((0,r.unref)(t)("性别")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["info-value gender",`gender-${c.value.性别}`])},(0,r.toDisplayString)((0,r.unref)(t)(c.value.性别)),3)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",CT,[(0,r.createElementVNode)("span",AT,(0,r.toDisplayString)((0,r.unref)(t)("灵根")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["info-value spirit-root",`root-${Ne(c.value.灵根)}`])},(0,r.toDisplayString)(ke(c.value.灵根)),3)]),(0,r.createElementVNode)("div",DT,[(0,r.createElementVNode)("span",TT,(0,r.toDisplayString)((0,r.unref)(t)("年龄")),1),(0,r.createElementVNode)("span",BT,(0,r.toDisplayString)(C.value)+(0,r.toDisplayString)((0,r.unref)(t)("岁")),1)]),u.value?.描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",IT,[(0,r.createElementVNode)("span",zT,(0,r.toDisplayString)((0,r.unref)(t)("位置")),1),(0,r.createElementVNode)("span",MT,(0,r.toDisplayString)(u.value.描述),1)])):c.value.世界?((0,r.openBlock)(),(0,r.createElementBlock)("div",PT,[(0,r.createElementVNode)("span",RT,(0,r.toDisplayString)((0,r.unref)(t)("世界")),1),(0,r.createElementVNode)("span",$T,(0,r.toDisplayString)(c.value.世界),1)])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 天赋与灵根 "),(0,r.createElementVNode)("div",OT,[(0,r.createElementVNode)("h3",LT,[(0,r.createElementVNode)("div",FT,[(0,r.createVNode)((0,r.unref)(Kp),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("天赋与灵根")),1)]),(0,r.createElementVNode)("div",jT,[(0,r.createCommentVNode)(" 天资等级卡片 "),(0,r.createElementVNode)("div",UT,[(0,r.createElementVNode)("div",qT,[(0,r.createElementVNode)("div",GT,[(0,r.createVNode)((0,r.unref)(Zp),{size:18})]),(0,r.createElementVNode)("span",HT,(0,r.toDisplayString)((0,r.unref)(t)("天资等级")),1)]),(0,r.createElementVNode)("div",YT,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["tier-value",`tier-${J(c.value.天资)}`])},(0,r.toDisplayString)(J(c.value.天资)),3)]),Z(c.value.天资)?((0,r.openBlock)(),(0,r.createElementBlock)("div",WT,(0,r.toDisplayString)(Z(c.value.天资)),1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 灵根属性卡片 (Re-designed) "),(0,r.createElementVNode)("div",{class:"spirit-root-card",onClick:he},[(0,r.createElementVNode)("div",XT,[(0,r.createElementVNode)("div",JT,[(0,r.createVNode)((0,r.unref)(bu),{size:18})]),(0,r.createElementVNode)("span",KT,(0,r.toDisplayString)((0,r.unref)(t)("灵根属性")),1),(0,r.createElementVNode)("span",ZT,(0,r.toDisplayString)((0,r.unref)(t)("点击查看详情")),1)]),(0,r.createElementVNode)("div",QT,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["root-name",`root-${Ne(c.value.灵根)}`])},(0,r.toDisplayString)(ke(c.value.灵根)),3),(0,r.createElementVNode)("div",eB,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["prop-badge grade-badge",`grade-${we(c.value.灵根)||"凡品"}`])},(0,r.toDisplayString)((0,r.unref)(t)(we(c.value.灵根)||"凡品")),3),(0,r.createElementVNode)("span",tB,(0,r.toDisplayString)(Se(c.value)),1)])]),Ee(c.value.灵根)?((0,r.openBlock)(),(0,r.createElementBlock)("div",nB,(0,r.toDisplayString)(Ee(c.value.灵根)),1)):(0,r.createCommentVNode)("v-if",!0),Ve(c.value).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",aB,[(0,r.createElementVNode)("div",rB,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Ve(c.value),e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"effect-tag"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 天赋列表卡片 "),(0,r.createElementVNode)("div",oB,[(0,r.createElementVNode)("div",iB,[(0,r.createElementVNode)("div",sB,[(0,r.createVNode)((0,r.unref)(Kp),{size:18})]),(0,r.createElementVNode)("span",lB,(0,r.toDisplayString)((0,r.unref)(t)("天赋特质")),1),Q(c.value.天赋)?.length?((0,r.openBlock)(),(0,r.createElementBlock)("span",cB,"("+(0,r.toDisplayString)(Q(c.value.天赋).length)+")",1)):(0,r.createCommentVNode)("v-if",!0)]),Q(c.value.天赋)?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",dB,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Q(c.value.天赋),e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.name,class:"talent-item",title:e.description},[(0,r.createElementVNode)("div",mB,[(0,r.createElementVNode)("strong",null,(0,r.toDisplayString)(e.name),1)]),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",pB,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0)],8,uB))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",gB,[(0,r.createElementVNode)("div",hB,[(0,r.createElementVNode)("div",fB,(0,r.toDisplayString)((0,r.unref)(t)("无")),1)])]))])])]),(0,r.createCommentVNode)(" 六司属性 "),(0,r.createElementVNode)("div",vB,[(0,r.createElementVNode)("h3",bB,[(0,r.createElementVNode)("div",yB,[(0,r.createVNode)((0,r.unref)(Tu),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("六司属性")),1)]),(0,r.createElementVNode)("div",xB,[(0,r.createCommentVNode)(" 最终属性 "),(0,r.createElementVNode)("div",kB,[(0,r.createElementVNode)("h4",wB,(0,r.toDisplayString)((0,r.unref)(t)("最终六司")),1),(0,r.createElementVNode)("div",EB,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(M.value,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"attribute-item final"},[(0,r.createElementVNode)("span",NB,(0,r.toDisplayString)((0,r.unref)(t)(String(n))),1),(0,r.createElementVNode)("span",SB,(0,r.toDisplayString)(e),1)]))),128))])]),(0,r.createCommentVNode)(" 属性详情 "),(0,r.createElementVNode)("div",VB,[(0,r.createElementVNode)("div",_B,[(0,r.createElementVNode)("h4",CB,(0,r.toDisplayString)((0,r.unref)(t)("先天六司")),1),(0,r.createElementVNode)("div",AB,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(z.value,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"attribute-item innate"},[(0,r.createElementVNode)("span",DB,(0,r.toDisplayString)((0,r.unref)(t)(String(n))),1),(0,r.createElementVNode)("span",TB,(0,r.toDisplayString)(e),1)]))),128))])]),(0,r.createElementVNode)("div",BB,[(0,r.createElementVNode)("h4",IB,(0,r.toDisplayString)((0,r.unref)(t)("后天六司")),1),(0,r.createElementVNode)("div",zB,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(P.value,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:(0,r.normalizeClass)(["attribute-item acquired",{"has-bonus":e>0}])},[(0,r.createElementVNode)("span",MB,(0,r.toDisplayString)((0,r.unref)(t)(String(n))),1),(0,r.createElementVNode)("span",PB,(0,r.toDisplayString)(e>0?`+${e}`:e),1)],2))),128))])])])])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 身体档案标签页（仅酒馆端） "),i.value&&"body"===S.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",RB,[(0,r.createElementVNode)("div",$B,[(0,r.createElementVNode)("div",OB,[(0,r.createElementVNode)("h3",LB,[(0,r.createElementVNode)("div",FB,[(0,r.createVNode)((0,r.unref)(Xp),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("身体档案")),1)]),(0,r.createVNode)(YA,{"body-stats":g.value,lifespan:h.value},null,8,["body-stats","lifespan"])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 修炼体系标签页 "),"cultivation"===S.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",jB,[(0,r.createElementVNode)("div",UB,[(0,r.createCommentVNode)(" 修炼功法 "),(0,r.createElementVNode)("div",qB,[(0,r.createElementVNode)("h3",GB,[(0,r.createElementVNode)("div",HB,[(0,r.createVNode)((0,r.unref)(vu.A),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("修炼功法")),1)]),D.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",XB,[(0,r.createElementVNode)("div",JB,[(0,r.createElementVNode)("div",{class:"technique-header",onClick:de},[(0,r.createElementVNode)("div",KB,[(0,r.createElementVNode)("h4",{class:(0,r.normalizeClass)(["technique-name",ee(D.value,"text")])},(0,r.toDisplayString)(D.value?.名称),3),(0,r.createElementVNode)("div",ZB,(0,r.toDisplayString)((0,r.unref)(t)(D.value?.品质?.quality||"未知"))+(0,r.toDisplayString)((0,r.unref)(t)("品"))+(0,r.toDisplayString)(D.value?.品质?.grade?`${D.value.品质.grade}${(0,r.unref)(t)("阶")}`:""),1)]),(0,r.createElementVNode)("div",QB,[(0,r.createVNode)((0,r.unref)(qw),{size:16,class:(0,r.normalizeClass)([{rotated:k.value},"toggle-icon"])},null,8,["class"])])]),(0,r.createCommentVNode)(" 功法详情（可折叠） "),(0,r.withDirectives)((0,r.createElementVNode)("div",eI,[(0,r.createElementVNode)("div",tI,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)(D.value?.描述||"此功法奥妙无穷，随修炼加深方可领悟其真意。")),1)]),R.value&&D.value?.功法效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",nI,[(0,r.createElementVNode)("h5",aI,(0,r.toDisplayString)((0,r.unref)(t)("功法效果")),1),(0,r.createElementVNode)("div",rI,[D.value.功法效果.修炼速度加成?((0,r.openBlock)(),(0,r.createElementBlock)("div",oI,[(0,r.createElementVNode)("span",iI,(0,r.toDisplayString)((0,r.unref)(t)("修炼加成：")),1),(0,r.createElementVNode)("span",sI,(0,r.toDisplayString)((100*D.value.功法效果.修炼速度加成).toFixed(0))+"%",1)])):(0,r.createCommentVNode)("v-if",!0),D.value.功法效果.属性加成?((0,r.openBlock)(),(0,r.createElementBlock)("div",lI,[(0,r.createElementVNode)("span",cI,(0,r.toDisplayString)((0,r.unref)(t)("属性提升：")),1),(0,r.createElementVNode)("div",dI,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(D.value.功法效果.属性加成,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:n,class:"bonus-tag"},(0,r.toDisplayString)((0,r.unref)(t)(String(n)))+" +"+(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0)])])):D.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",uI,[(0,r.createElementVNode)("h5",mI,(0,r.toDisplayString)((0,r.unref)(t)("功法效果")),1),(0,r.createElementVNode)("p",pI,(0,r.toDisplayString)((0,r.unref)(t)("此功法无特殊效果")),1)])):(0,r.createCommentVNode)("v-if",!0)],512),[[r.vShow,k.value]]),(0,r.createElementVNode)("div",gI,[D.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",hI,[(0,r.createElementVNode)("span",fI,(0,r.toDisplayString)((0,r.unref)(t)("修为进度")),1),(0,r.createElementVNode)("div",vI,[(0,r.createElementVNode)("div",{class:"progress-fill",style:(0,r.normalizeStyle)({width:Math.max(2,D.value.修炼进度||0)+"%"})},null,4)]),(0,r.createElementVNode)("span",bI,(0,r.toDisplayString)(D.value.修炼进度||0)+"%",1)])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 已学技能 "),O.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",yI,[(0,r.createElementVNode)("div",{class:"skills-header",onClick:ue},[(0,r.createElementVNode)("h4",xI,(0,r.toDisplayString)((0,r.unref)(t)("已掌握技能")),1),(0,r.createElementVNode)("div",kI,"("+(0,r.toDisplayString)(L.value)+(0,r.toDisplayString)((0,r.unref)(t)("个"))+")",1),(0,r.createVNode)((0,r.unref)(qw),{size:14,class:(0,r.normalizeClass)([{rotated:w.value},"toggle-icon"])},null,8,["class"])]),(0,r.withDirectives)((0,r.createElementVNode)("div",wI,[(0,r.createElementVNode)("div",EI,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(O.value.slice(0,3),e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e.name,class:"skill-tag compact"},(0,r.toDisplayString)(e.name),1))),128)),L.value>3?((0,r.openBlock)(),(0,r.createElementBlock)("span",NI,"...")):(0,r.createCommentVNode)("v-if",!0)])],512),[[r.vShow,!w.value]]),(0,r.withDirectives)((0,r.createElementVNode)("div",SI,[(0,r.createCommentVNode)(" 所有已掌握的技能 "),O.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",VI,[(0,r.createElementVNode)("h5",_I,(0,r.toDisplayString)((0,r.unref)(t)("所有技能")),1),(0,r.createElementVNode)("div",CI,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(O.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.name,class:"skill-card",onClick:t=>ge(e)},[(0,r.createElementVNode)("div",DI,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("div",TI,(0,r.toDisplayString)((0,r.unref)(t)(e.type)),1),(0,r.createElementVNode)("div",BI,(0,r.toDisplayString)(e.source),1),(0,r.createElementVNode)("div",II,(0,r.toDisplayString)((0,r.unref)(t)("熟练度"))+" "+(0,r.toDisplayString)(e.proficiency)+"% ",1),(0,r.createElementVNode)("div",zI,[(0,r.createVNode)((0,r.unref)(Zp),{size:12,class:"unlock-icon"})])],8,AI))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 未解锁的功法技能 "),$.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",MI,[(0,r.createElementVNode)("h5",PI,(0,r.toDisplayString)((0,r.unref)(t)("未解锁技能")),1),(0,r.createElementVNode)("div",RI,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)($.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.name,class:"skill-card skill-locked",onClick:t=>ge(e)},[(0,r.createElementVNode)("div",OI,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("div",LI,(0,r.toDisplayString)((0,r.unref)(t)(e.type)),1),(0,r.createElementVNode)("div",FI,(0,r.toDisplayString)(e.unlockCondition),1)],8,$I))),128))])])):(0,r.createCommentVNode)("v-if",!0)],512),[[r.vShow,w.value]])])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",YB,[(0,r.createElementVNode)("div",WB,[(0,r.createVNode)((0,r.unref)(vu.A),{size:32})]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("尚未修炼功法")),1)]))]),(0,r.createCommentVNode)(" 三千大道 "),(0,r.createElementVNode)("div",jI,[(0,r.createElementVNode)("h3",UI,[(0,r.createElementVNode)("div",qI,[(0,r.createVNode)((0,r.unref)(bu),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("三千大道")),1)]),T.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",YI,[(0,r.createElementVNode)("div",WI,[(0,r.createElementVNode)("div",XI,[(0,r.createElementVNode)("span",JI,(0,r.toDisplayString)((0,r.unref)(t)("已解"))+" "+(0,r.toDisplayString)(T.value.length)+" "+(0,r.toDisplayString)((0,r.unref)(t)("条大道")),1),(0,r.createElementVNode)("button",{class:"dao-expand-btn",onClick:me},[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(v.value?(0,r.unref)(t)("收起"):(0,r.unref)(t)("展开")),1),(0,r.createVNode)((0,r.unref)(qw),{size:14,class:(0,r.normalizeClass)([{rotated:v.value},"toggle-icon"])},null,8,["class"])])])]),(0,r.withDirectives)((0,r.createElementVNode)("div",KI,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(T.value.slice(0,2).map(e=>e.道名),e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"dao-item compact",onClick:t=>pe(e)},[(0,r.createElementVNode)("div",QI,[(0,r.createElementVNode)("span",ez,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)("span",tz,(0,r.toDisplayString)((0,r.unref)(t)("第"))+(0,r.toDisplayString)(ne(e))+(0,r.toDisplayString)((0,r.unref)(t)("阶段")),1)]),(0,r.createElementVNode)("div",nz,[(0,r.createElementVNode)("div",az,[(0,r.createElementVNode)("div",{class:"progress-fill",style:(0,r.normalizeStyle)({width:ae(e)+"%"})},null,4)]),(0,r.createElementVNode)("span",rz,(0,r.toDisplayString)(ae(e))+"%",1)])],8,ZI))),128)),T.value.length>2?((0,r.openBlock)(),(0,r.createElementBlock)("div",oz,(0,r.toDisplayString)((0,r.unref)(t)("还有"))+" "+(0,r.toDisplayString)(T.value.length-2)+" "+(0,r.toDisplayString)((0,r.unref)(t)("条大道..")),1)):(0,r.createCommentVNode)("v-if",!0)],512),[[r.vShow,!v.value]]),(0,r.withDirectives)((0,r.createElementVNode)("div",iz,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(T.value.map(e=>e.道名),e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"dao-item detailed",onClick:t=>pe(e)},[(0,r.createElementVNode)("div",lz,[(0,r.createElementVNode)("span",cz,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)("span",dz,(0,r.toDisplayString)((0,r.unref)(t)("第"))+(0,r.toDisplayString)(ne(e))+(0,r.toDisplayString)((0,r.unref)(t)("阶段")),1)]),(0,r.createElementVNode)("div",uz,[(0,r.createElementVNode)("div",mz,[(0,r.createElementVNode)("div",{class:"progress-fill",style:(0,r.normalizeStyle)({width:ae(e)+"%"})},null,4)]),(0,r.createElementVNode)("span",pz,(0,r.toDisplayString)(ae(e))+"%",1)]),(0,r.createElementVNode)("div",gz,[(0,r.createElementVNode)("div",hz,[(0,r.createElementVNode)("span",fz,(0,r.toDisplayString)((0,r.unref)(t)("当前经验")),1),(0,r.createElementVNode)("span",vz,(0,r.toDisplayString)(re(e)),1)]),(0,r.createElementVNode)("div",bz,[(0,r.createElementVNode)("span",yz,(0,r.toDisplayString)((0,r.unref)(t)("总经验")),1),(0,r.createElementVNode)("span",xz,(0,r.toDisplayString)(oe(e)),1)])])],8,sz))),128))],512),[[r.vShow,v.value]])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",GI,[(0,r.createElementVNode)("div",HI,[(0,r.createVNode)((0,r.unref)(KA),{size:32})]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("尚未解锁大道")),1)]))])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 社交关系标签页 "),"social"===S.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",kz,[(0,r.createElementVNode)("div",wz,[(0,r.createCommentVNode)(" 人际关系 "),(0,r.createElementVNode)("div",Ez,[(0,r.createElementVNode)("h3",Nz,[(0,r.createElementVNode)("div",Sz,[(0,r.createVNode)((0,r.unref)(fu),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("人际关系")),1)]),F.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Cz,[(0,r.createElementVNode)("div",Az,[(0,r.createElementVNode)("div",Dz,[(0,r.createElementVNode)("span",Tz,(0,r.toDisplayString)((0,r.unref)(t)("总人数")),1),(0,r.createElementVNode)("span",Bz,(0,r.toDisplayString)(F.value),1)]),(0,r.createElementVNode)("div",Iz,[(0,r.createElementVNode)("span",zz,(0,r.toDisplayString)((0,r.unref)(t)("平均好感")),1),(0,r.createElementVNode)("span",Mz,(0,r.toDisplayString)(j.value)+"%",1)])])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Vz,[(0,r.createElementVNode)("div",_z,[(0,r.createVNode)((0,r.unref)(ZA),{size:32})]),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("暂无人际关系")),1)]))]),(0,r.createCommentVNode)(" 背包概览 "),(0,r.createElementVNode)("div",Pz,[(0,r.createElementVNode)("h3",Rz,[(0,r.createElementVNode)("div",$z,[(0,r.createVNode)((0,r.unref)(QA),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("背包概览")),1)]),(0,r.createElementVNode)("div",Oz,[(0,r.createElementVNode)("div",Lz,[(0,r.createElementVNode)("div",Fz,[(0,r.createElementVNode)("div",jz,[(0,r.createElementVNode)("span",Uz,(0,r.toDisplayString)((0,r.unref)(t)("物品总数")),1),(0,r.createElementVNode)("span",qz,(0,r.toDisplayString)(U.value),1)]),(0,r.createElementVNode)("div",Gz,[(0,r.createElementVNode)("span",Hz,(0,r.toDisplayString)((0,r.unref)(t)("法宝数量")),1),(0,r.createElementVNode)("span",Yz,(0,r.toDisplayString)(ie("法宝")),1)]),(0,r.createElementVNode)("div",Wz,[(0,r.createElementVNode)("span",Xz,(0,r.toDisplayString)((0,r.unref)(t)("功法数量")),1),(0,r.createElementVNode)("span",Jz,(0,r.toDisplayString)(ie("功法")),1)])])]),(0,r.createElementVNode)("div",Kz,[(0,r.createElementVNode)("h4",Zz,(0,r.toDisplayString)((0,r.unref)(t)("灵石储备")),1),(0,r.createElementVNode)("div",Qz,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(q,e=>(0,r.createElementVNode)("div",{key:e.name,class:(0,r.normalizeClass)(["stone-item",e.class])},[(0,r.createElementVNode)("span",eM,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",tM,(0,r.toDisplayString)(le(e.name)),1)],2)),64))])])])]),(0,r.createCommentVNode)(" 宗门信息 "),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",nM,[(0,r.createElementVNode)("h3",aM,[(0,r.createElementVNode)("div",rM,[(0,r.createVNode)((0,r.unref)(XA),{size:18})]),(0,r.createTextVNode)(" "+(0,r.toDisplayString)((0,r.unref)(t)("宗门信息")),1)]),(0,r.createElementVNode)("div",oM,[(0,r.createElementVNode)("div",iM,[(0,r.createElementVNode)("h4",sM,(0,r.toDisplayString)(m.value?.宗门名称),1),(0,r.createElementVNode)("span",lM,(0,r.toDisplayString)(m.value?.宗门类型),1)]),(0,r.createElementVNode)("div",cM,[(0,r.createElementVNode)("div",dM,[(0,r.createElementVNode)("span",uM,(0,r.toDisplayString)((0,r.unref)(t)("职位")),1),(0,r.createElementVNode)("span",mM,(0,r.toDisplayString)(m.value?.职位),1)]),(0,r.createElementVNode)("div",pM,[(0,r.createElementVNode)("span",gM,(0,r.toDisplayString)((0,r.unref)(t)("贡献值")),1),(0,r.createElementVNode)("span",hM,(0,r.toDisplayString)(m.value?.贡献),1)]),(0,r.createElementVNode)("div",fM,[(0,r.createElementVNode)("span",vM,(0,r.toDisplayString)((0,r.unref)(t)("关系")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["detail-value",`relationship-${m.value?.关系}`])},(0,r.toDisplayString)(m.value?.关系),3)])])])])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 技能详情弹窗 "),b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:4,class:"modal-overlay",onClick:fe},[(0,r.createElementVNode)("div",{class:"skill-modal",onClick:a[2]||(a[2]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",bM,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(be()?.name),1),(0,r.createElementVNode)("button",{class:"modal-close-btn",onClick:fe},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",yM,[(0,r.createElementVNode)("div",xM,[(0,r.createElementVNode)("div",kM,[(0,r.createElementVNode)("span",wM,(0,r.toDisplayString)((0,r.unref)(t)("类型")),1),(0,r.createElementVNode)("span",EM,(0,r.toDisplayString)((0,r.unref)(t)(be()?.type??"未知")),1)]),(0,r.createElementVNode)("div",NM,[(0,r.createElementVNode)("span",SM,(0,r.toDisplayString)((0,r.unref)(t)("状态")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["detail-value","status-"+("已解锁"===be()?.status?"unlocked":"locked")])},(0,r.toDisplayString)((0,r.unref)(t)(be()?.status??"未知")),3)]),(0,r.createElementVNode)("div",VM,[(0,r.createElementVNode)("span",_M,(0,r.toDisplayString)((0,r.unref)(t)("熟练度")),1),(0,r.createElementVNode)("span",CM,(0,r.toDisplayString)(be()?.proficiency?be()?.proficiency+"%":(0,r.unref)(t)("未知")),1)]),(0,r.createElementVNode)("div",AM,[(0,r.createElementVNode)("span",DM,(0,r.toDisplayString)((0,r.unref)(t)("解锁条件")),1),(0,r.createElementVNode)("span",TM,(0,r.toDisplayString)(be()?.condition),1)]),(0,r.createElementVNode)("div",BM,[(0,r.createElementVNode)("span",IM,(0,r.toDisplayString)((0,r.unref)(t)("技能来源")),1),(0,r.createElementVNode)("span",zM,(0,r.toDisplayString)(be()?.source),1)])]),(0,r.createElementVNode)("div",MM,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("技能描述")),1),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(be()?.description),1)])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 大道详情弹窗 "),y.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:5,class:"modal-overlay",onClick:fe},[(0,r.createElementVNode)("div",{class:"dao-modal",onClick:a[3]||(a[3]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",PM,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(ve()?.name),1),(0,r.createElementVNode)("button",{class:"modal-close-btn",onClick:fe},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",RM,[(0,r.createElementVNode)("div",$M,[(0,r.createElementVNode)("div",OM,[(0,r.createElementVNode)("span",LM,(0,r.toDisplayString)((0,r.unref)(t)("当前阶段")),1),(0,r.createElementVNode)("span",FM,(0,r.toDisplayString)(ve()?.stage),1)]),(0,r.createElementVNode)("div",jM,[(0,r.createElementVNode)("div",UM,[(0,r.createElementVNode)("div",{class:"progress-bar-fill",style:(0,r.normalizeStyle)({width:(ve()?.progressPercent||0)+"%"})},null,4)]),(0,r.createElementVNode)("span",qM,(0,r.toDisplayString)(ve()?.progressPercent)+"%",1)])]),(0,r.createElementVNode)("div",GM,[(0,r.createElementVNode)("div",HM,[(0,r.createElementVNode)("span",YM,(0,r.toDisplayString)((0,r.unref)(t)("当前经验")),1),(0,r.createElementVNode)("span",WM,(0,r.toDisplayString)(ve()?.currentExp),1)]),(0,r.createElementVNode)("div",XM,[(0,r.createElementVNode)("span",JM,(0,r.toDisplayString)((0,r.unref)(t)("总经验")),1),(0,r.createElementVNode)("span",KM,(0,r.toDisplayString)(ve()?.totalExp),1)])]),(0,r.createElementVNode)("div",ZM,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("修炼感悟")),1),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(ve()?.description),1)])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 灵根详情弹窗 (Re-designed) "),x.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:6,class:"modal-overlay",onClick:fe},[(0,r.createElementVNode)("div",{class:"spirit-root-modal",onClick:a[4]||(a[4]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",QM,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(ke(c.value.灵根))+" "+(0,r.toDisplayString)((0,r.unref)(t)("详情")),1),(0,r.createElementVNode)("button",{class:"modal-close-btn",onClick:fe},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",eP,[(0,r.createElementVNode)("div",tP,[(0,r.createElementVNode)("div",nP,[(0,r.createElementVNode)("div",aP,[(0,r.createElementVNode)("span",rP,[(0,r.createVNode)((0,r.unref)(bu),{size:14})]),(0,r.createElementVNode)("span",oP,(0,r.toDisplayString)((0,r.unref)(t)("灵根类型")),1)]),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["detail-value type-value",`root-${Ne(c.value.灵根)}`])},(0,r.toDisplayString)(ke(c.value.灵根)),3)]),(0,r.createElementVNode)("div",iP,[(0,r.createElementVNode)("div",sP,[(0,r.createElementVNode)("span",lP,[(0,r.createVNode)((0,r.unref)(Zp),{size:14})]),(0,r.createElementVNode)("span",cP,(0,r.toDisplayString)((0,r.unref)(t)("灵根品级")),1)]),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["detail-value grade-value",`grade-${we(c.value.灵根)||"凡品"}`])},(0,r.toDisplayString)((0,r.unref)(t)(we(c.value.灵根)||"凡品")),3)]),(0,r.createElementVNode)("div",dP,[(0,r.createElementVNode)("div",uP,[(0,r.createElementVNode)("span",mP,[(0,r.createVNode)((0,r.unref)(eD),{size:14})]),(0,r.createElementVNode)("span",pP,(0,r.toDisplayString)((0,r.unref)(t)("修炼速度")),1)]),(0,r.createElementVNode)("div",gP,(0,r.toDisplayString)(Se(c.value)),1)])]),Ve(c.value).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",hP,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("特殊效果")),1),(0,r.createElementVNode)("div",fP,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Ve(c.value),e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"effect-tag-modal"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0),"object"==typeof c.value.灵根&&c.value.灵根?((0,r.openBlock)(),(0,r.createElementBlock)("div",vP,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("详细信息")),1),(0,r.createElementVNode)("div",bP,["object"==typeof c.value.灵根&&c.value.灵根.base_multiplier?((0,r.openBlock)(),(0,r.createElementBlock)("div",yP,[(0,r.createElementVNode)("span",xP,(0,r.toDisplayString)((0,r.unref)(t)("基础倍率:")),1),(0,r.createElementVNode)("span",kP,(0,r.toDisplayString)(c.value.灵根.base_multiplier)+"x",1)])):(0,r.createCommentVNode)("v-if",!0),"object"==typeof c.value.灵根&&c.value.灵根.cultivation_speed?((0,r.openBlock)(),(0,r.createElementBlock)("div",wP,[(0,r.createElementVNode)("span",EP,(0,r.toDisplayString)((0,r.unref)(t)("修炼速度:")),1),(0,r.createElementVNode)("span",NP,(0,r.toDisplayString)(c.value.灵根.cultivation_speed),1)])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0)])])])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",aD,[(0,r.createElementVNode)("div",rD,[(0,r.createVNode)((0,r.unref)(WA),{size:48})]),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)("无法加载角色数据")),1),(0,r.createElementVNode)("button",{class:"retry-btn",onClick:ye},(0,r.toDisplayString)((0,r.unref)(t)("重试")),1)]))]);var o,p}}});var VP=n(5205),_P={};_P.styleTagTransform=k(),_P.setAttributes=v(),_P.insert=h().bind(null,"head"),_P.domAPI=p(),_P.insertStyleElement=y(),u()(VP.A,_P),VP.A&&VP.A.locals&&VP.A.locals;const CP=(0,N.A)(SP,[["__scopeId","data-v-48aca378"]]),AP=(0,V.A)("sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),DP=(0,V.A)("gem",[["path",{d:"M10.5 3 8 9l4 13 4-13-2.5-6",key:"b3dvk1"}],["path",{d:"M17 3a2 2 0 0 1 1.6.8l3 4a2 2 0 0 1 .013 2.382l-7.99 10.986a2 2 0 0 1-3.247 0l-7.99-10.986A2 2 0 0 1 2.4 7.8l2.998-3.997A2 2 0 0 1 7 3z",key:"7w4byz"}],["path",{d:"M2 9h20",key:"16fsjt"}]]),TP=(0,V.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),BP=(0,V.A)("square-dashed",[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]]),IP={class:"modal-header"},zP={class:"modal-body"},MP={class:"item-info"},PP={class:"item-icon"},RP={class:"item-details"},$P={class:"item-name"},OP={class:"item-type"},LP={class:"available-quantity"},FP={key:0,class:"item-description"},jP={class:"quantity-selector"},UP={for:"quantity"},qP={class:"quantity-controls"},GP=["disabled"],HP=["max"],YP=["disabled"],WP={class:"quantity-shortcuts"},XP=["onClick","disabled"],JP={class:"modal-footer"},KP=["disabled"],ZP=(0,r.defineComponent)({__name:"QuantitySelectModal",props:{visible:{type:Boolean},item:{},title:{},actionLabel:{},actionType:{},confirmText:{},description:{}},emits:["close","confirm"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)(1),i=(0,r.computed)(()=>{const e=n.item?.数量||1;return[{label:"1个",value:1},{label:"5个",value:5},{label:"10个",value:10},{label:"全部",value:e}].filter(t=>t.value<=e)});function s(){o.value<(n.item?.数量||1)&&o.value++}function l(){o.value>1&&o.value--}function c(){o.value>0&&o.value<=(n.item?.数量||1)&&a("confirm",o.value)}function d(){a("close")}return(0,r.watch)(()=>n.item,e=>{e&&(o.value=1)}),(e,t)=>{return e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"quantity-modal-overlay",onClick:d},[(0,r.createElementVNode)("div",{class:"quantity-modal",onClick:t[3]||(t[3]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",IP,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.title||"选择数量"),1),(0,r.createElementVNode)("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))},[t[4]||(t[4]=(0,r.createElementVNode)("span",null,"关闭",-1)),(0,r.createVNode)((0,r.unref)(Iu.A),{size:16})])]),(0,r.createElementVNode)("div",zP,[(0,r.createElementVNode)("div",MP,[(0,r.createElementVNode)("div",PP,(0,r.toDisplayString)((a=e.item?.类型,{装备:"⚔️",功法:"📜",丹药:"💊",材料:"💎",其他:"📦"}[a||"其他"]||"📦")),1),(0,r.createElementVNode)("div",RP,[(0,r.createElementVNode)("div",$P,(0,r.toDisplayString)(e.item?.名称),1),(0,r.createElementVNode)("div",OP,(0,r.toDisplayString)(e.item?.类型),1),(0,r.createElementVNode)("div",LP,"可用数量："+(0,r.toDisplayString)(e.item?.数量||0),1),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",FP,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",jP,[(0,r.createElementVNode)("label",UP,(0,r.toDisplayString)(e.actionLabel||"选择数量")+"：",1),(0,r.createElementVNode)("div",qP,[(0,r.createElementVNode)("button",{class:"quantity-btn",onClick:l,disabled:o.value<=1}," - ",8,GP),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"quantity","onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),type:"number",min:1,max:e.item?.数量||1,class:"quantity-input"},null,8,HP),[[r.vModelText,o.value,void 0,{number:!0}]]),(0,r.createElementVNode)("button",{class:"quantity-btn",onClick:s,disabled:o.value>=(e.item?.数量||1)}," + ",8,YP)])]),(0,r.createElementVNode)("div",WP,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:t.value,class:"preset-btn",onClick:e=>{return a=t.value,void(o.value=Math.min(a,n.item?.数量||1));var a},disabled:t.value>(e.item?.数量||1)},(0,r.toDisplayString)(t.label),9,XP))),128))])]),(0,r.createElementVNode)("div",JP,[(0,r.createElementVNode)("button",{class:"cancel-btn",onClick:t[2]||(t[2]=t=>e.$emit("close"))},"取消"),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["confirm-btn","discard"===e.actionType?"discard-confirm":""]),onClick:c,disabled:o.value<=0},(0,r.toDisplayString)(e.confirmText||"确定"),11,KP)])])])):(0,r.createCommentVNode)("v-if",!0);var a}}});var QP=n(7136),eR={};eR.styleTagTransform=k(),eR.setAttributes=v(),eR.insert=h().bind(null,"head"),eR.domAPI=p(),eR.insertStyleElement=y(),u()(QP.A,eR),QP.A&&QP.A.locals&&QP.A.locals;const tR=(0,N.A)(ZP,[["__scopeId","data-v-76ad986e"]]),nR={class:"inventory-content"},aR={class:"tabs-header"},rR={class:"tabs-nav"},oR=["onClick"],iR={key:0,class:"tools-section"},sR={class:"search-box"},lR=["placeholder"],cR={class:"filter-buttons"},dR={value:"all"},uR=["value"],mR={value:"default"},pR={value:"quality"},gR={value:"name"},hR=["disabled","title"],fR={class:"tab-content"},vR={key:0,class:"items-tab"},bR={class:"confirm-header"},yR={class:"confirm-content"},xR={class:"confirm-actions"},kR={class:"modal-header"},wR={class:"modal-content"},ER={class:"item-type-text"},NR={class:"modal-info"},SR={class:"modal-meta"},VR={class:"modal-description"},_R={key:0,class:"modal-attributes"},CR={class:"attribute-text"},AR={key:1,class:"modal-attributes"},DR={class:"attribute-text"},TR={class:"modal-actions"},BR=["disabled"],IR=["disabled"],zR={class:"items-grid"},MR={key:0,class:"grid-placeholder"},PR={key:1,class:"grid-placeholder"},RR={key:0},$R={key:1},OR={key:2},LR={key:3},FR={key:4},jR={key:5,class:"filter-tip"},UR=["onClick"],qR={class:"item-top-section"},GR={class:"item-type-icon"},HR={key:0,class:"item-quantity-display"},YR={class:"item-name-section"},WR=["title"],XR={class:"item-bottom-section"},JR={class:"item-type-label"},KR={key:2,class:"item-details-sidebar"},ZR={key:0,class:"details-content"},QR={class:"details-header"},e$={class:"item-type-text-large"},t$={class:"details-title-area"},n$={class:"details-meta"},a$={class:"details-body"},r$={class:"details-description"},o$={key:0,class:"details-attributes"},i$={class:"attribute-text"},s$={key:1,class:"details-attributes"},l$={class:"technique-skills"},c$={class:"skill-header"},d$={class:"skill-name"},u$={key:0,class:"skill-unlock-requirement"},m$={class:"skill-description"},p$={key:0,class:"skill-cost"},g$={key:1,class:"details-attributes"},h$={class:"attribute-text"},f$={key:2,class:"details-attributes"},v$={class:"attribute-text"},b$={class:"details-actions"},y$=["disabled"],x$=["disabled"],k$={key:1,class:"details-placeholder"},w$={key:1,class:"equipment-tab"},E$={class:"equipment-content"},N$={class:"equipment-grid"},S$={class:"slot-header"},V$={class:"slot-name"},_$={key:0,class:"slot-actions"},C$=["disabled","onClick","title"],A$={class:"item-type-text"},D$={class:"item-info"},T$=["title"],B$={class:"item-quality"},I$=["title"],z$={key:1,class:"item-effects"},M$={class:"effects-title"},P$={class:"effects-text"},R$={key:2,class:"item-effects"},$$={class:"effects-title"},O$={class:"effects-text"},L$={key:1,class:"empty-equipment-slot"},F$={class:"empty-icon"},j$={class:"empty-text"},U$={class:"empty-hint"},q$={key:2,class:"currency-tab"},G$={class:"currency-grid"},H$={class:"currency-card-top"},Y$={class:"currency-info"},W$={class:"currency-amount"},X$={class:"currency-label"},J$={key:0,class:"currency-exchange"},K$=["onClick","disabled","title"],Z$=["onClick","disabled","title"],Q$=(0,r.defineComponent)({__name:"InventoryPanel",setup(e){const{t}=(0,K.s)(),a=(0,Jc.useCharacterStore)(),o=(0,pu.useGameStateStore)(),i=(0,Xw.useActionQueueStore)(),s=Zw.getInstance(),l=(0,se.isTavernEnv)(),c=(0,r.ref)(!1),d=(0,r.ref)(!1),u=(0,r.ref)(null),m=(0,r.ref)(""),p=(0,r.ref)("all"),g=(0,r.ref)("default"),h=(0,r.ref)("items"),f=(0,r.ref)(!1),v=(0,r.ref)(""),b=(0,r.ref)(""),y=(0,r.ref)(!1),x=(0,r.ref)(null),k=(0,r.ref)(""),w=(0,r.ref)(""),E=(0,r.ref)("use"),N=(0,r.ref)(""),S=(0,r.ref)(""),V=(0,r.ref)(null),_=(0,r.ref)(!1),C=(0,r.ref)(null),A=(0,r.ref)(!1),D=(0,r.ref)(!1),T=(0,r.computed)(()=>window.innerWidth<=768),B=(0,r.computed)(()=>[{id:"items",label:"物品",icon:gu},{id:"equipment",label:"装备",icon:AP},{id:"currency",label:"灵石",icon:DP}]),I=(0,r.computed)(()=>{const e=o.equipment,n=["装备1","装备2","装备3","装备4","装备5","装备6"];return e?n.map(n=>{const a=e[n];let r=null;const i="string"==typeof a?a:"object"==typeof a&&null!==a&&"物品ID"in a?String(a.物品ID||""):"";if(i){const e=(o.inventory?.物品||{})[i];r=e&&"object"==typeof e?e:{物品ID:i,名称:"object"==typeof a&&null!==a&&"名称"in a?String(a.名称||i):i,类型:"装备",品质:{quality:"凡",grade:1},描述:"装备数据缺失",数量:1,已装备:!0}}else r=null;return{name:t(n),slotKey:n,item:r}}):n.map(e=>({name:t(e),slotKey:e,item:null}))}),z=(0,r.computed)(()=>{const e=o.inventory?.物品||{};return Object.entries(e).filter(([e,t])=>!e.startsWith("_")&&t&&"object"==typeof t).map(([,e])=>{const n=e;return n.品质||"功法"!==n.类型&&"装备"!==n.类型||console.warn(t("[背包面板-警告] 物品缺少品质数据:"),{物品ID:n.物品ID,名称:n.名称,类型:n.类型,完整数据:n}),{...n,物品ID:String(n.物品ID||""),名称:String(n.名称||""),类型:String(n.类型||"其他"),品质:n.品质||{quality:"凡",grade:1},描述:String(n.描述||""),数量:Number(n.数量||1)}}).filter(e=>e.名称&&e.类型)}),M=(0,r.computed)(()=>["装备","功法","丹药","材料","其他"]),P={凡:1,凡阶:1,黄:2,黄阶:2,玄:3,玄阶:3,地:4,地阶:4,天:5,天阶:5,仙:6,仙阶:6,神:7,神阶:7},R=(0,r.computed)(()=>{let e=[...z.value];const t=["装备","功法","丹药","材料","其他"];if(e=e.map(e=>{const n=t.includes(e.类型)?e.类型:"其他";let a=e.品质;return a&&"object"==typeof a?(a.quality&&["凡","黄","玄","地","天","仙","神"].includes(a.quality)||(a.quality="凡"),("number"!=typeof a.grade||a.grade<0||a.grade>10)&&(a.grade=1)):a={quality:"凡",grade:1},{...e,类型:n,品质:a}}),m.value&&(e=e.filter(e=>e.名称.includes(m.value))),"all"!==p.value&&(e=e.filter(e=>e.类型===p.value)),"quality"===g.value){const t=e=>P[String(e??"凡")]||0;e.sort((e,n)=>t(n.品质?.quality)-t(e.品质?.quality))}else"name"===g.value&&e.sort((e,t)=>e.名称.localeCompare(t.名称));return e}),$=e=>{if(!e||"object"!=typeof e)return"无特殊属性";const t=[];for(const[n,a]of Object.entries(e))if(null!=a)if("object"!=typeof a||Array.isArray(a))t.push(`${n}+${a}`);else{const e=Object.entries(a).filter(([,e])=>"number"==typeof e||"string"==typeof e).map(([e,t])=>`${e}+${t}`).join("、");e&&t.push(`${n}(${e})`)}return t.length?t.join("、"):"无特殊属性"},O=e=>0===e?"残缺":e>=1&&e<=3?"下品":e>=4&&e<=6?"中品":e>=7&&e<=9?"上品":10===e?"极品":"未知",L=e=>0===e?"grade-broken":e>=1&&e<=3?"grade-low":e>=4&&e<=6?"grade-mid":e>=7&&e<=9?"grade-high":10===e?"grade-perfect":"grade-unknown",F=async e=>{if(!D.value)if("功法"===e.类型){D.value=!0;try{Z(e)?await s.stopCultivation(e):await s.cultivateItem(e)}finally{D.value=!1}}else X.o.error(t("只有功法才能修炼"))},j=async e=>{if(e){if(nV.Yz.log(t("背包面板"),t("使用物品"),e.名称),e.数量>1){x.value=e,k.value=t("使用物品"),w.value=t("使用数量"),E.value="use",N.value=t("确定使用");const n=["丹药","材料","其他"];return S.value=(n.includes(e.类型)&&"使用效果"in e?e.使用效果:"")||t("暂无特殊效果"),V.value=t=>U(e,t),void(y.value=!0)}await U(e,1)}},U=async(e,n)=>{try{if(!["丹药","材料","其他"].includes(e.类型))return void X.o.error(t("该物品无法直接使用"));await s.useItem(e,n),T.value&&(_.value=!1),u.value=null,nV.Yz.log(t("背包面板"),t("使用物品成功"),e.名称)}catch(e){nV.Yz.error(t("背包面板"),t("使用物品失败"),e),X.o.error(t("使用物品失败"))}},q=async e=>{V.value&&await V.value(e),G()},G=()=>{y.value=!1,x.value=null,k.value="",w.value="",E.value="use",N.value="",S.value="",V.value=null},H=async e=>{if(!e)return;if(e.数量>1){const n=e.品质?.quality||"凡",a="凡"===n?"":`【${t(n)}】`;return x.value=e,k.value=t("丢弃物品"),w.value=t("丢弃数量"),E.value="discard",N.value=t("确定丢弃"),S.value=`${a}${e.名称} - ${t("此操作不可撤销！")}`,V.value=t=>Y(e,t),void(y.value=!0)}const n=e.品质?.quality||"凡",a="凡"===n?"":`【${t(n)}】`;v.value=t("丢弃物品"),b.value=t("确定要丢弃 {0}{1} 吗？\n\n此操作不可撤销！").replace("{0}",a).replace("{1}",e.名称),C.value=async()=>{await Y(e,1)},f.value=!0},Y=async(e,n)=>{nV.Yz.log(t("背包面板"),t("丢弃物品"),{物品名称:e.名称,数量:n});try{if(n>=e.数量)await(async e=>{const n=o.inventory?.物品;if(!n||"object"!=typeof n)throw new Error(t("背包数据不存在或格式不正确"));delete n[e.物品ID],await a.saveCurrentGame(),nV.Yz.log(t("背包面板"),t("物品移除成功"),e.名称),u.value?.物品ID===e.物品ID&&(u.value=null),T.value&&(_.value=!1)})(e),X.o.success(t("已丢弃《{0}》").replace("{0}",e.名称));else{const r={...e,数量:e.数量-n};await(async e=>{const n=o.inventory?.物品;if(!n||"object"!=typeof n)throw new Error(t("背包数据不存在或格式不正确"));if(!n[e.物品ID])throw new Error(t("尝试更新一个不存在于背包的物品: {0}").replace("{0}",e.名称));n[e.物品ID]=e,await a.saveCurrentGame(),nV.Yz.log(t("背包面板"),t("物品更新成功"),e.名称),u.value?.物品ID===e.物品ID&&(u.value=e)})(r),X.o.success(t("已丢弃 {0} 个《{1}》").replace("{0}",n.toString()).replace("{1}",e.名称))}T.value&&(_.value=!1),u.value=null}catch(e){nV.Yz.error(t("背包面板"),t("丢弃失败"),e),X.o.error(t("丢弃物品失败"))}},W=async e=>{if(e&&!A.value)if("装备"===e.类型){A.value=!0;try{J(e)?await s.unequipItem(e):await s.equipItem(e)}catch(e){console.error("装备切换失败:",e),X.o.error(t("装备操作失败，请稍后重试"))}finally{A.value=!1}}else X.o.error(t("只有装备才能穿戴"))},J=e=>{if(!e||!e.物品ID)return!1;const t=o.inventory?.物品;if(!t)return!1;const n=t[e.物品ID];return!!n&&!0===n.已装备},Z=e=>{if(!e||!e.物品ID)return!1;const t=o.cultivation?.修炼功法?.物品ID;return t===e.物品ID},Q=(e,t="border")=>{if(!e)return"";const n=(e=>{const t=String(e||"").trim();if(!t)return"未知";const n=t.endsWith("阶")?t.slice(0,-1):t;return["凡","黄","玄","地","天","仙","神"].includes(n)?n:"未知"})(e.品质?.quality);return"未知"===n?"":`${t}-quality-${n}`},ee=[{name:"极品",colorClass:"grade-legend",canExchange:!1,canExchangeDown:!0,exchangeDown:"上品"},{name:"上品",colorClass:"grade-epic",canExchange:!0,canExchangeDown:!0,exchangeUp:"极品",exchangeDown:"中品"},{name:"中品",colorClass:"grade-rare",canExchange:!0,canExchangeDown:!0,exchangeUp:"上品",exchangeDown:"下品"},{name:"下品",colorClass:"grade-common",canExchange:!0,canExchangeDown:!1,exchangeUp:"中品"}],te=()=>{C.value&&C.value(),f.value=!1},ne=()=>{_.value=!1},ae=async(e,t)=>{const n=ee.find(t=>t.name===e);if(n)if("up"===t&&n.canExchange&&n.exchangeUp){const t=o.inventory?.灵石?.[e]||0;if(t>=100&&o.inventory?.灵石){o.inventory.灵石[e]=t-100;const r=n.exchangeUp,i=o.inventory.灵石[r]||0;o.inventory.灵石[r]=i+1,await a.saveCurrentGame()}}else if("down"===t&&n.canExchangeDown&&n.exchangeDown){const t=o.inventory?.灵石?.[e]||0;if(t>=1&&o.inventory?.灵石){o.inventory.灵石[e]=t-1;const r=n.exchangeDown,i=o.inventory.灵石[r]||0;o.inventory.灵石[r]=i+100,await a.saveCurrentGame()}}},re=async()=>{if(!d.value){d.value=!0;try{nV.Yz.log(t("背包面板"),t("手动刷新酒馆数据")),await a.reloadFromStorage()}catch(e){nV.Yz.error(t("背包面板"),t("刷新数据失败"),e)}finally{d.value=!1}}};return(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createCommentVNode)(" 移除容器，让内容直接填充GameView提供的panel-content区域 "),(0,r.createElementVNode)("div",nR,[(0,r.createCommentVNode)(" 标签页导航 "),(0,r.createElementVNode)("div",aR,[(0,r.createElementVNode)("div",rR,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(B.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.id,class:(0,r.normalizeClass)(["tab-btn",{active:h.value===e.id}]),onClick:t=>h.value=e.id},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:16})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)(e.label)),1)],10,oR))),128))]),(0,r.createCommentVNode)(" 搜索和筛选区域 "),"items"===h.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",iR,[(0,r.createElementVNode)("div",sR,[(0,r.createVNode)((0,r.unref)(TP),{size:16,class:"search-icon"}),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),placeholder:T.value?(0,r.unref)(t)("搜索..."):(0,r.unref)(t)("搜索物品...")},null,8,lR),[[r.vModelText,m.value]])]),(0,r.createElementVNode)("div",cR,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),class:"filter-select"},[(0,r.createElementVNode)("option",dR,(0,r.toDisplayString)((0,r.unref)(t)("全部物品")),1),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(M.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e,value:e},(0,r.toDisplayString)((0,r.unref)(t)(e)),9,uR))),128))],512),[[r.vModelSelect,p.value]]),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),class:"filter-select"},[(0,r.createElementVNode)("option",mR,(0,r.toDisplayString)((0,r.unref)(t)("默认排序")),1),(0,r.createElementVNode)("option",pR,(0,r.toDisplayString)((0,r.unref)(t)("品质排序")),1),(0,r.createElementVNode)("option",gR,(0,r.toDisplayString)((0,r.unref)(t)("名称排序")),1)],512),[[r.vModelSelect,g.value]]),(0,r.unref)(l)?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"refresh-btn",onClick:re,disabled:d.value,title:(0,r.unref)(t)("从酒馆同步最新数据")},[(0,r.createVNode)((0,r.unref)(Gw.A),{size:16,class:(0,r.normalizeClass)({spinning:d.value})},null,8,["class"])],8,hR)):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 标签内容 "),(0,r.createElementVNode)("div",fR,[(0,r.createCommentVNode)(" 物品标签 "),"items"===h.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",vR,[(0,r.createCommentVNode)(" 自定义确认弹窗 "),f.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"custom-confirm-overlay",onClick:a[6]||(a[6]=e=>f.value=!1)},[(0,r.createElementVNode)("div",{class:"custom-confirm-modal",onClick:a[5]||(a[5]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",bR,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(v.value),1),(0,r.createElementVNode)("button",{class:"confirm-close-btn",onClick:a[3]||(a[3]=e=>f.value=!1)},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",yR,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(b.value),1)]),(0,r.createElementVNode)("div",xR,[(0,r.createElementVNode)("button",{class:"confirm-btn cancel-btn",onClick:a[4]||(a[4]=e=>f.value=!1)},(0,r.toDisplayString)((0,r.unref)(t)("取消")),1),(0,r.createElementVNode)("button",{class:"confirm-btn confirm-btn",onClick:te},(0,r.toDisplayString)((0,r.unref)(t)("确定")),1)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 移动端：模态框详情 "),_.value&&T.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"item-modal-overlay",onClick:ne},[(0,r.createElementVNode)("div",{class:"item-modal",onClick:a[13]||(a[13]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",kR,[(0,r.createElementVNode)("h3",{class:(0,r.normalizeClass)(Q(u.value,"text"))},(0,r.toDisplayString)(u.value?.名称),3),(0,r.createElementVNode)("button",{class:"modal-close-btn",onClick:ne},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",wR,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["modal-icon-simple",Q(u.value)])},[(0,r.createElementVNode)("div",ER,(0,r.toDisplayString)(u.value?.类型),1)],2),(0,r.createElementVNode)("div",NR,[(0,r.createElementVNode)("div",SR,[(0,r.createTextVNode)((0,r.toDisplayString)((0,r.unref)(t)(u.value?.类型??"未知"))+" / "+(0,r.toDisplayString)(u.value?.品质?.quality?(0,r.unref)(t)(u.value.品质.quality):(0,r.unref)(t)("未知"))+" ",1),void 0!==u.value?.品质?.grade?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["grade-display",L(u.value.品质.grade)])},(0,r.toDisplayString)((0,r.unref)(t)(O(u.value.品质.grade)))+"("+(0,r.toDisplayString)(u.value.品质.grade)+") ",3)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("p",VR,(0,r.toDisplayString)(u.value?.描述),1),"装备"===u.value?.类型&&u.value?.装备增幅?((0,r.openBlock)(),(0,r.createElementBlock)("div",_R,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("装备增幅:")),1),(0,r.createElementVNode)("div",CR,(0,r.toDisplayString)("string"==typeof u.value.装备增幅?u.value.装备增幅:$(u.value.装备增幅)),1)])):(0,r.createCommentVNode)("v-if",!0),"装备"===u.value?.类型&&u.value?.特殊效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",AR,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("特殊效果:")),1),(0,r.createElementVNode)("div",DR,(0,r.toDisplayString)("string"==typeof u.value.特殊效果?u.value.特殊效果:$(u.value.特殊效果)),1)])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",TR,[(0,r.createCommentVNode)(" 装备：装备和丢弃 "),"装备"===u.value?.类型?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["action-btn",J(u.value)?"unequip-btn":"equip-btn"]),disabled:A.value,onClick:a[7]||(a[7]=e=>W(u.value))},(0,r.toDisplayString)(J(u.value)?(0,r.unref)(t)("卸下"):(0,r.unref)(t)("装备")),11,BR),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[8]||(a[8]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64)):"功法"===u.value?.类型?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 功法：修炼和丢弃 "),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["action-btn",Z(u.value)?"stop-cultivate-btn":"cultivate-btn"]),disabled:D.value,onClick:a[9]||(a[9]=e=>F(u.value))},(0,r.toDisplayString)(Z(u.value)?(0,r.unref)(t)("停止修炼"):(0,r.unref)(t)("修炼")),11,IR),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[10]||(a[10]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64)):u.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" 其他物品：使用和丢弃 "),(0,r.createElementVNode)("button",{class:"action-btn use-btn",onClick:a[11]||(a[11]=e=>j(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("使用")),1),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[12]||(a[12]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64)):(0,r.createCommentVNode)("v-if",!0)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",zR,[c.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",MR,[a[20]||(a[20]=(0,r.createElementVNode)("div",{class:"loading-spinner"},null,-1)),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)("加载中...")),1)])):0===R.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",PR,[(0,r.createVNode)((0,r.unref)(BP),{size:48}),"all"===p.value?((0,r.openBlock)(),(0,r.createElementBlock)("p",RR,(0,r.toDisplayString)((0,r.unref)(t)("空空如也")),1)):"装备"===p.value?((0,r.openBlock)(),(0,r.createElementBlock)("p",$R,(0,r.toDisplayString)((0,r.unref)(t)("暂无装备")),1)):"功法"===p.value?((0,r.openBlock)(),(0,r.createElementBlock)("p",OR,(0,r.toDisplayString)((0,r.unref)(t)("暂无功法")),1)):"其他"===p.value?((0,r.openBlock)(),(0,r.createElementBlock)("p",LR,(0,r.toDisplayString)((0,r.unref)(t)("暂无其他物品")),1)):((0,r.openBlock)(),(0,r.createElementBlock)("p",FR,(0,r.toDisplayString)((0,r.unref)(t)("暂无{0}").replace("{0}",(0,r.unref)(t)(p.value))),1)),"all"!==p.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",jR,(0,r.toDisplayString)((0,r.unref)(t)("可以试试搜索其他分类")),1)):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:2},(0,r.renderList)(R.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.物品ID,class:(0,r.normalizeClass)(["item-card",Q(e,"card")]),onClick:t=>(e=>{u.value=e,T.value&&(_.value=!0)})(e)},[(0,r.createCommentVNode)(" 物品图标和品质 "),(0,r.createElementVNode)("div",qR,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["item-icon-area",Q(e,"border")])},[(0,r.createElementVNode)("div",GR,(0,r.toDisplayString)((n=e.类型,{装备:"⚔️",功法:"📜",丹药:"💊",材料:"💎",其他:"📦"}[n]||"📦")),1),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["item-quality-badge",Q(e,"text")])},(0,r.toDisplayString)(e.品质?.quality?(0,r.unref)(t)(e.品质.quality):(0,r.unref)(t)("未知")),3)],2)]),(0,r.createCommentVNode)(" 数量显示 "),e.数量>1?((0,r.openBlock)(),(0,r.createElementBlock)("div",HR,"×"+(0,r.toDisplayString)(e.数量),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 物品名称 "),(0,r.createElementVNode)("div",YR,[(0,r.createElementVNode)("div",{class:"item-name",title:e.名称},(0,r.toDisplayString)(e.名称),9,WR)]),(0,r.createCommentVNode)(" 底部信息：类型和品级 "),(0,r.createElementVNode)("div",XR,[(0,r.createElementVNode)("div",JR,(0,r.toDisplayString)((0,r.unref)(t)(e.类型)),1),void 0!==e.品质?.grade?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)(["item-grade-info",L(e.品质.grade)])},(0,r.toDisplayString)((0,r.unref)(t)(O(e.品质.grade)))+"("+(0,r.toDisplayString)(e.品质.grade)+") ",3)):(0,r.createCommentVNode)("v-if",!0)])],10,UR);var n}),128))]),(0,r.createCommentVNode)(" 桌面端物品详情侧边栏 "),T.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",KR,[u.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ZR,[(0,r.createElementVNode)("div",QR,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["details-icon-large",Q(u.value)])},[(0,r.createElementVNode)("div",e$,(0,r.toDisplayString)(u.value.类型),1)],2),(0,r.createElementVNode)("div",t$,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(u.value.名称),1),(0,r.createElementVNode)("div",n$,[(0,r.createTextVNode)((0,r.toDisplayString)((0,r.unref)(t)(u.value.类型))+" / "+(0,r.toDisplayString)(u.value.品质?.quality?(0,r.unref)(t)(u.value.品质.quality):(0,r.unref)(t)("未知"))+" ",1),void 0!==u.value.品质?.grade?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["grade-display",L(u.value.品质.grade)])},(0,r.toDisplayString)((0,r.unref)(t)(O(u.value.品质.grade)))+"("+(0,r.toDisplayString)(u.value.品质.grade)+") ",3)):(0,r.createCommentVNode)("v-if",!0)])])]),(0,r.createElementVNode)("div",a$,[(0,r.createElementVNode)("p",r$,(0,r.toDisplayString)(u.value.描述),1),(0,r.createCommentVNode)(" 功法特有属性 "),"功法"===u.value.类型?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createCommentVNode)(" 功法效果 "),u.value.功法效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",o$,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("功法效果:")),1),(0,r.createElementVNode)("div",i$,(0,r.toDisplayString)("string"==typeof u.value.功法效果?u.value.功法效果:JSON.stringify(u.value.功法效果)),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 功法技能 "),u.value.功法技能&&Array.isArray(u.value.功法技能)&&u.value.功法技能.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",s$,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("功法技能:")),1),(0,r.createElementVNode)("div",l$,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value.功法技能,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"skill-item"},[(0,r.createElementVNode)("div",c$,[(0,r.createElementVNode)("span",d$,(0,r.toDisplayString)(e.技能名称),1),e.解锁需要熟练度?((0,r.openBlock)(),(0,r.createElementBlock)("span",u$,(0,r.toDisplayString)((0,r.unref)(t)("需要:"))+" "+(0,r.toDisplayString)(e.解锁需要熟练度)+"% ",1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",m$,(0,r.toDisplayString)(e.技能描述),1),e.消耗?((0,r.openBlock)(),(0,r.createElementBlock)("div",p$,(0,r.toDisplayString)((0,r.unref)(t)("消耗:"))+" "+(0,r.toDisplayString)(e.消耗),1)):(0,r.createCommentVNode)("v-if",!0)]))),128))])])):(0,r.createCommentVNode)("v-if",!0)],64)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 装备装备增幅 "),"装备"===u.value.类型&&u.value.装备增幅?((0,r.openBlock)(),(0,r.createElementBlock)("div",g$,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("装备增幅:")),1),(0,r.createElementVNode)("div",h$,(0,r.toDisplayString)("string"==typeof u.value.装备增幅?u.value.装备增幅:$(u.value.装备增幅)),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 装备特殊效果 "),"装备"===u.value.类型&&u.value.特殊效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",f$,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)((0,r.unref)(t)("特殊效果:")),1),(0,r.createElementVNode)("div",v$,(0,r.toDisplayString)("string"==typeof u.value.特殊效果?u.value.特殊效果:$(u.value.特殊效果)),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",b$,[(0,r.createCommentVNode)(" 装备：装备和丢弃 "),"装备"===u.value?.类型?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["action-btn",J(u.value)?"unequip-btn":"equip-btn"]),disabled:A.value,onClick:a[14]||(a[14]=e=>W(u.value))},(0,r.toDisplayString)(J(u.value)?(0,r.unref)(t)("卸下"):(0,r.unref)(t)("装备")),11,y$),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[15]||(a[15]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64)):"功法"===u.value?.类型?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 功法：修炼和丢弃 "),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["action-btn",Z(u.value)?"stop-cultivate-btn":"cultivate-btn"]),disabled:D.value,onClick:a[16]||(a[16]=e=>F(u.value))},(0,r.toDisplayString)(Z(u.value)?(0,r.unref)(t)("停止修炼"):(0,r.unref)(t)("修炼")),11,x$),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[17]||(a[17]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" 其他物品：使用和丢弃 "),(0,r.createElementVNode)("button",{class:"action-btn use-btn",onClick:a[18]||(a[18]=e=>j(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("使用")),1),(0,r.createElementVNode)("button",{class:"action-btn discard-btn",onClick:a[19]||(a[19]=e=>H(u.value))},(0,r.toDisplayString)((0,r.unref)(t)("丢弃")),1)],64))])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",k$,[(0,r.createVNode)((0,r.unref)(BP),{size:48}),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)("选择物品查看详情")),1)]))]))])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 装备标签 "),"equipment"===h.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",w$,[(0,r.createElementVNode)("div",E$,[(0,r.createElementVNode)("div",N$,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(I.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:a,class:(0,r.normalizeClass)(["equipment-slot",{"has-equipment":e.item,"empty-slot":!e.item}])},[(0,r.createElementVNode)("div",S$,[(0,r.createElementVNode)("div",V$,(0,r.toDisplayString)(e.name),1),e.item?((0,r.openBlock)(),(0,r.createElementBlock)("div",_$,[(0,r.createElementVNode)("button",{class:"action-btn unequip-btn",disabled:A.value,onClick:a=>(async e=>{if(A.value)return;if(!e.item)return;A.value=!0;const a=e.item;nV.Yz.log(t("背包面板"),t("卸下装备"),a.名称);try{if(!o.equipment)return void X.o.error(t("装备栏数据不存在"));if(!o.inventory?.物品)return void X.o.error(t("背包数据不存在"));const r=o.toSaveData();if(!r)return void X.o.error(t("存档数据不存在"));const s=r;s.角色||(s.角色={}),s.角色.装备||(s.角色.装备={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null});const l=e.slotKey;s.角色.装备[l]=null,s.角色?.背包?.物品?.[a.物品ID]&&(s.角色.背包.物品[a.物品ID].已装备=!1);const{removeEquipmentBonus:c}=await Promise.resolve().then(n.bind(n,651));c(r,a.物品ID),o.loadFromSaveData(r),await o.saveGame(),i.addAction({type:"unequip",itemName:a.名称,itemType:a.类型,description:t("卸下了《{0}》装备").replace("{0}",a.名称)}),X.o.success(t("已卸下《{0}》").replace("{0}",a.名称)),nV.Yz.log(t("背包面板"),t("装备卸下成功"),a.名称)}catch(e){nV.Yz.error(t("背包面板"),t("卸下装备失败"),e),X.o.error(t("卸下装备失败"))}finally{A.value=!1}})(e),title:(0,r.unref)(t)("卸下装备")},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:12})],8,C$)])):(0,r.createCommentVNode)("v-if",!0)]),e.item?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)(["equipment-item",Q(e.item)])},[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["item-icon",Q(e.item,"border")])},[(0,r.createElementVNode)("div",A$,(0,r.toDisplayString)((0,r.unref)(t)("装备")),1)],2),(0,r.createElementVNode)("div",D$,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["item-name",Q(e.item,"text")]),title:e.item.名称},(0,r.toDisplayString)(e.item.名称),11,T$),(0,r.createElementVNode)("div",B$,[(0,r.createTextVNode)((0,r.toDisplayString)(e.item.品质?.quality?(0,r.unref)(t)(e.item.品质.quality):"？")+(0,r.toDisplayString)((0,r.unref)(t)("品"))+" ",1),void 0!==e.item.品质?.grade?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,class:(0,r.normalizeClass)(["item-grade",L(e.item.品质.grade)])},(0,r.toDisplayString)((0,r.unref)(t)(O(e.item.品质.grade)))+"("+(0,r.toDisplayString)(e.item.品质.grade)+") ",3)):(0,r.createCommentVNode)("v-if",!0)]),e.item.描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"item-description",title:e.item.描述},(0,r.toDisplayString)(e.item.描述),9,I$)):(0,r.createCommentVNode)("v-if",!0),"装备"===e.item.类型&&e.item.装备增幅?((0,r.openBlock)(),(0,r.createElementBlock)("div",z$,[(0,r.createElementVNode)("div",M$,(0,r.toDisplayString)((0,r.unref)(t)("增幅效果：")),1),(0,r.createElementVNode)("div",P$,(0,r.toDisplayString)("string"==typeof e.item.装备增幅?e.item.装备增幅:$(e.item.装备增幅)),1)])):(0,r.createCommentVNode)("v-if",!0),"装备"===e.item.类型&&e.item.特殊效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",R$,[(0,r.createElementVNode)("div",$$,(0,r.toDisplayString)((0,r.unref)(t)("特殊效果：")),1),(0,r.createElementVNode)("div",O$,(0,r.toDisplayString)("string"==typeof e.item.特殊效果?e.item.特殊效果:$(e.item.特殊效果)),1)])):(0,r.createCommentVNode)("v-if",!0)])],2)):((0,r.openBlock)(),(0,r.createElementBlock)("div",L$,[(0,r.createElementVNode)("div",F$,[(0,r.createVNode)((0,r.unref)(gu),{size:24})]),(0,r.createElementVNode)("div",j$,(0,r.toDisplayString)((0,r.unref)(t)("空槽位")),1),(0,r.createElementVNode)("div",U$,(0,r.toDisplayString)((0,r.unref)(t)("可装备装备")),1)]))],2))),128))])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 灵石标签 "),"currency"===h.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",q$,[(0,r.createElementVNode)("div",G$,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(ee,e=>(0,r.createElementVNode)("div",{key:e.name,class:(0,r.normalizeClass)(["currency-card",e.colorClass])},[(0,r.createElementVNode)("div",H$,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["currency-icon",`icon-${e.colorClass}`])},[(0,r.createVNode)((0,r.unref)(DP),{size:T.value?32:40},null,8,["size"])],2),(0,r.createElementVNode)("div",Y$,[(0,r.createElementVNode)("div",W$,(0,r.toDisplayString)((0,r.unref)(o).inventory?.灵石?.[e.name]||0),1),(0,r.createElementVNode)("div",X$,(0,r.toDisplayString)((0,r.unref)(t)(e.name))+(0,r.toDisplayString)((0,r.unref)(t)("灵石")),1)])]),e.canExchange||e.canExchangeDown?((0,r.openBlock)(),(0,r.createElementBlock)("div",J$,[e.canExchange?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"exchange-btn",onClick:t=>ae(e.name,"up"),disabled:((0,r.unref)(o).inventory?.灵石?.[e.name]||0)<100,title:(0,r.unref)(t)("兑换为{0}灵石 (100:1)").replace("{0}",(0,r.unref)(t)(e.exchangeUp))},(0,r.toDisplayString)((0,r.unref)(t)("↑ 兑换")),9,K$)):(0,r.createCommentVNode)("v-if",!0),e.canExchangeDown?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"exchange-btn down",onClick:t=>ae(e.name,"down"),disabled:((0,r.unref)(o).inventory?.灵石?.[e.name]||0)<1,title:(0,r.unref)(t)("分解为{0}灵石 (1:100)").replace("{0}",(0,r.unref)(t)(e.exchangeDown))},(0,r.toDisplayString)((0,r.unref)(t)("↓ 分解")),9,Z$)):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0)],2)),64))])])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 数量选择弹窗 "),(0,r.createVNode)(tR,{visible:y.value,item:x.value,title:k.value,"action-label":w.value,"action-type":E.value,"confirm-text":N.value,description:S.value,onClose:G,onConfirm:q},null,8,["visible","item","title","action-label","action-type","confirm-text","description"])],64))}});var eO=n(5032),tO={};tO.styleTagTransform=k(),tO.setAttributes=v(),tO.insert=h().bind(null,"head"),tO.domAPI=p(),tO.insertStyleElement=y(),u()(eO.A,tO),eO.A&&eO.A.locals&&eO.A.locals;const nO=(0,N.A)(Q$,[["__scopeId","data-v-28a5e031"]]),aO=(0,V.A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),rO=(0,V.A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),oO=(0,V.A)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),iO=e=>"",sO=e=>"string"==typeof e?e:"",lO={class:"relationship-network-panel"},cO={class:"panel-content"},dO={class:"relationship-list"},uO={class:"list-header"},mO={class:"search-bar"},pO={class:"list-content"},gO={key:0,class:"loading-state"},hO={key:1,class:"empty-state"},fO={class:"empty-text"},vO={key:0,class:"empty-hint"},bO={key:1,class:"empty-hint"},yO={key:2,class:"person-list"},xO=["onClick"],kO={class:"person-avatar"},wO={class:"avatar-text"},EO={class:"person-info"},NO={class:"person-name"},SO={class:"person-meta"},VO={class:"relationship-type"},_O=["onClick","title"],CO=["onClick"],AO={key:0,class:"person-realm"},DO={class:"realm-value"},TO={class:"intimacy-info"},BO={class:"intimacy-bar"},IO={class:"intimacy-value"},zO={class:"relationship-detail"},MO={class:"detail-header"},PO={class:"detail-avatar"},RO={class:"avatar-text"},$O={class:"detail-info"},OO={class:"name-and-actions"},LO={class:"detail-name"},FO={class:"action-buttons"},jO={class:"detail-badges"},UO={class:"relationship-badge"},qO={class:"race-badge"},GO={key:0,class:"faction-badge"},HO={class:"detail-body"},YO={class:"detail-tabs"},WO=["onClick"],XO={class:"tab-content"},JO={class:"tab-panel"},KO={class:"detail-section"},ZO={class:"info-grid-responsive"},QO={class:"info-item-row"},eL={class:"info-value"},tL={class:"info-item-row"},nL={class:"info-value"},aL={class:"info-item-row"},rL={class:"info-value"},oL={class:"info-item-row"},iL={class:"info-value"},sL={key:0,class:"info-item-row"},lL={class:"info-value"},cL={key:1,class:"info-item-row"},dL={class:"info-value"},uL={key:0,class:"detail-section"},mL={key:0,class:"appearance-description"},pL={class:"description-text"},gL={key:1,class:"talents-grid",style:{"margin-top":"1rem"}},hL={key:1,class:"detail-section"},fL={key:0},vL={class:"talents-grid"},bL=["onClick"],yL={key:1,style:{"margin-top":"1rem"}},xL={class:"attributes-grid"},kL={class:"attribute-item"},wL={class:"attr-value"},EL={class:"attribute-item"},NL={class:"attr-value"},SL={class:"attribute-item"},VL={class:"attr-value"},_L={class:"attribute-item"},CL={class:"attr-value"},AL={class:"attribute-item"},DL={class:"attr-value"},TL={class:"attribute-item"},BL={class:"attr-value"},IL={key:2,class:"detail-section"},zL={class:"npc-memories-list"},ML={class:"npc-memory-content"},PL={class:"detail-section personality-section"},RL={class:"personality-bottomlines"},$L={key:0,class:"bottomline-tags"},OL={key:1,class:"bottomline-empty"},LL={class:"tab-panel"},FL={class:"detail-section highlight-section"},jL={class:"realtime-status"},UL={class:"status-item"},qL={class:"status-content"},GL={class:"status-text"},HL={class:"status-item"},YL={class:"status-content"},WL={class:"status-text"},XL={key:0,class:"tab-panel"},JL={class:"detail-section nsfw-section"},KL={key:0,class:"bottomline-empty"},ZL={key:1},QL={class:"nsfw-subsection"},eF={class:"info-grid-responsive"},tF={class:"info-item-row"},nF={class:"info-value"},aF={class:"info-item-row"},rF={class:"info-value"},oF={class:"info-item-row"},iF={class:"info-value"},sF={class:"info-item-row"},lF={class:"info-value"},cF={class:"info-item-row"},dF={class:"info-value"},uF={class:"info-item-row"},mF={class:"info-value"},pF={class:"development-bars",style:{"margin-top":"0.75rem"}},gF={class:"dev-bar-item"},hF={class:"dev-bar-header"},fF={class:"dev-value"},vF={class:"dev-bar-track"},bF={key:0,class:"last-time-info"},yF={class:"last-time-value"},xF={key:0,class:"nsfw-subsection"},kF={key:0,class:"bottomline-tags"},wF={key:1,class:"bottomline-tags",style:{"margin-top":"0.5rem"}},EF={key:1,class:"nsfw-subsection"},NF={class:"bottomline-tags partner-list"},SF={key:2,class:"nsfw-subsection"},VF={class:"body-parts-list"},_F={class:"part-header"},CF={class:"part-name"},AF={key:0,class:"part-mark"},DF={key:0,class:"part-description"},TF={class:"part-stats"},BF={class:"part-stat"},IF={class:"stat-bar-mini"},zF={class:"stat-value"},MF={class:"part-stat"},PF={class:"stat-bar-mini"},RF={class:"stat-value"},$F={key:2,class:"bottomline-empty"},OF={class:"tab-panel"},LF={key:0,class:"detail-section"},FF={class:"memory-header"},jF={class:"memory-actions-header"},UF={class:"memory-count"},qF={class:"memory-controls-group"},GF={key:0,class:"summarize-controls"},HF=["max"],YF=["disabled"],WF={class:"memory-list"},XF={class:"memory-content"},JF={key:0,class:"memory-time"},KF={class:"memory-event"},ZF={class:"memory-actions"},QF=["onClick"],ej=["onClick"],tj={key:0,class:"memory-pagination"},nj=["disabled"],aj={class:"pagination-controls"},rj={class:"pagination-info"},oj={class:"jump-to-page"},ij=["max"],sj=["disabled"],lj={key:1,class:"detail-section memory-summary-section"},cj={class:"memory-summary-list"},dj={class:"summary-text"},uj={key:2,class:"detail-section"},mj={class:"empty-state-small"},pj={class:"tab-panel"},gj={class:"detail-section"},hj={key:0,class:"spirit-stones-grid"},fj={class:"spirit-stone-item"},vj={class:"spirit-stone-item"},bj={class:"spirit-stone-item"},yj={class:"spirit-stone-item"},xj={class:"npc-inventory",style:{"margin-top":"1rem"}},kj={key:0,class:"npc-items-grid"},wj={class:"item-header"},Ej={class:"item-name"},Nj={class:"item-type"},Sj={key:0,class:"item-quality"},Vj={class:"quality-text"},_j={key:1,class:"item-quantity"},Cj={key:2,class:"item-description"},Aj={class:"item-actions"},Dj=["onClick"],Tj=["onClick"],Bj=["onClick"],Ij={key:1,class:"empty-inventory"},zj={class:"tab-panel"},Mj={class:"detail-section"},Pj={class:"raw-data-container"},Rj={key:1,class:"no-selection"},$j=(0,r.defineComponent)({__name:"RelationshipNetworkPanel",setup(e){function t(e){const t="number"==typeof e&&Number.isFinite(e)?e:0;return Math.max(0,Math.min(100,t))}function a(e){if("string"!=typeof e)return null;return e.trim()||null}function o(e){const t=e=>{const t=new Set;return e.filter(e=>!t.has(e)&&(t.add(e),!0))};if(Array.isArray(e))return t(e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean));const n=a(e);return n?/[、,，;；\n]/.test(n)?t(n.split(/[、,，;；\n]/).map(e=>e.trim()).filter(Boolean)):[n]:[]}const i=(0,pu.useGameStateStore)(),s=(0,r.ref)((0,se.isTavernEnv)());(0,r.onMounted)(()=>{s.value=(0,se.isTavernEnv)()}),(0,r.onActivated)(()=>{s.value=(0,se.isTavernEnv)()});const{t:l}=(0,K.s)(),c=(0,r.computed)(()=>i.getCurrentSaveData()),d=(0,Xw.useActionQueueStore)(),u=(0,A.useUIStore)(),m=(0,Jc.useCharacterStore)(),p=(0,r.ref)(!1),g=(0,r.ref)(null),h=(0,r.ref)(""),f=(0,r.ref)(!1),v=(0,r.computed)(()=>g.value?.私密信息??null),b=(0,r.computed)(()=>a(v.value?.最近一次性行为时间)??""),y=(0,r.computed)(()=>o(v.value?.性癖好)),x=(0,r.computed)(()=>o(v.value?.特殊体质)),k=(0,r.ref)(!1),w=(0,r.computed)(()=>o(v.value?.性伴侣名单)),E=(0,r.computed)(()=>k.value?w.value:w.value.slice(0,10)),N=(0,r.ref)(!1),S=(0,r.computed)(()=>function(e){if(Array.isArray(e)){const t=e.filter(e=>"object"==typeof e&&null!==e),n=new Set;return t.filter((e,t)=>{const r=a(e.部位名称)??`__index_${t}`;return!n.has(r)&&(n.add(r),!0)})}if("object"==typeof e&&null!==e){const t=Object.values(e).filter(e=>"object"==typeof e&&null!==e),n=new Set;return t.filter((e,t)=>{const r=a(e.部位名称)??`__index_${t}`;return!n.has(r)&&(n.add(r),!0)})}return[]}(v.value?.身体部位)),V=(0,r.computed)(()=>N.value?S.value:S.value.slice(0,6)),_=(0,r.computed)(()=>{try{const e=localStorage.getItem("dad_game_settings");return!e||!1!==JSON.parse(e).enableNsfwMode}catch{return!0}}),C=(0,r.ref)("basic"),D=(0,r.computed)(()=>{const e=[{id:"basic",label:"基本信息",icon:"📋"},{id:"status",label:"实时状态",icon:"💭"}];return s.value&&e.push({id:"nsfw",label:"私密信息",icon:"🔞"}),e.push({id:"memory",label:"记忆档案",icon:"📝"}),e.push({id:"inventory",label:"背包",icon:"🎒"}),e.push({id:"raw",label:"原始数据(JSON)",icon:"🔧"}),e}),T=(0,r.ref)(!1),B=(0,r.ref)(10),I=(0,r.ref)(5),z=(0,r.ref)(1),M=(0,r.ref)(null),P=(0,r.computed)(()=>{if(!g.value?.记忆?.length)return[];const e=g.value.记忆,t=(z.value-1)*I.value,n=t+I.value;return e.slice(t,n)}),R=(0,r.computed)(()=>g.value?.记忆?.length?Math.ceil(g.value.记忆.length/I.value):0),$=e=>{e>=1&&e<=R.value&&(z.value=e)},O=()=>{M.value&&M.value>=1&&M.value<=R.value&&(z.value=M.value,M.value=null)},L=()=>{z.value=1},F=e=>{const t=e.境界;if(!t)return"未知";if("object"==typeof t&&null!==t){const e=t.名称||"",n=t.阶段||"";if(e)return n?`${e}${n}`:e}return"string"==typeof t?t:"未知"},j=e=>G(e.灵根),U=e=>e?"string"==typeof e?e:"object"==typeof e&&(e.描述||e.description||e.名称||e.name)||"未知":"未知",q=e=>e.记忆&&Array.isArray(e.记忆)?e.记忆.slice(-3).reverse().map(e=>"string"==typeof e?e:"object"==typeof e&&e.事件?e.事件:"").filter(e=>e.length>0):[],G=e=>{if(!e)return"未知";if("string"==typeof e)return e;if("object"==typeof e){const t=e,n=t.name||t.名称,a=(e=>{if(!e)return"";if("string"==typeof e)return e;if("object"==typeof e){const t=e,n=t.quality??t.品质??t.品级??t.quality_name??t.name??t.名称,a=t.grade??t.阶??t.等级??t.level,r="string"==typeof n?n.trim():"",o=r?r.replace(/\d+/g,"").replace(/[阶品级]/g,"").trim():"",i="number"==typeof a||"string"==typeof a?String(a).trim():"";if(o)return`${o.endsWith("品级")?o:`${o}品质`}${i?`${i}阶`:""}`.trim()}return""})(t.tier??t.品级??t.quality??t.grade);if(n&&a)return`${n}(${a})`;if(n)return`${n}(未知品级)`;if(a)return a}return"格式错误"},H=e=>{const t=c.value?.元数据?.时间;if(!e||!e.出生日期||!t)return"未知";const n=e.出生日期.年,a=t.年-n;return a>0?`${a}岁`:"1岁以内"},Y=(0,r.computed)(()=>{const e=c.value?.社交?.关系;if(!e||"object"!=typeof e)return{total:0,valid:0,invalid:0,list:[]};const t=Object.entries(e).filter(([e])=>!e.startsWith("_")),n=t.length,a=[];let r=0;for(const[e,n]of t){if(!n||"object"!=typeof n){r+=1;continue}const t=n,o="string"==typeof t.名字?t.名字.trim():"",i="string"==typeof e?e.trim():"",s=o||i;s?a.push({...t,名字:s}):r+=1}return{total:n,valid:a.length,invalid:r,list:a}}),W=(0,r.computed)(()=>Y.value.list),X=(0,r.computed)(()=>{let e=[...W.value];if(h.value.trim()){const t=h.value.toLowerCase();e=e.filter(e=>e.名字.toLowerCase().includes(t)||(e.与玩家关系||"").toLowerCase().includes(t))}return e.sort((e,t)=>(t.好感度||0)-(e.好感度||0))}),J=e=>`intimacy-${(e=>{const t=e||0;return t>=80?"high":t>=60?"good":t>=40?"medium":t>=20?"low":t>=0?"neutral":t>=-20?"dislike":t>=-40?"hostile":"enemy"})(e)}`;(0,r.watch)(g,e=>{e&&L()}),(0,r.onMounted)(async()=>{console.log("[人脉系统] 人物关系面板已载入，开始同步数据"),p.value=!0;try{X.value.length>0&&(g.value=X.value[0])}catch(e){console.error("[人脉系统] 同步数据失败:",e),u.showToast("人脉数据同步失败",{type:"error"})}finally{p.value=!1}});const Z=e=>{const t=c.value?.社交?.关系;return t&&Object.keys(t).find(n=>t[n]?.名字===e)||null},Q=e=>{const t=e.背包?.物品;return!!t&&Object.keys(t).length>0},ee=e=>e.实时关注||!1,te=async()=>{if(!g.value)return;const e=g.value.名字;T.value=!0;try{const t=g.value.记忆||[];if(t.length<3)return void u.showToast("至少需要3条记忆才能进行总结",{type:"warning"});const a=Math.min(Math.max(3,B.value||10),t.length),r=t.slice(0,a),o=t.slice(a),s=r.map((e,t)=>`${t+1}. ${e}`).join("\n"),l=function(e){if(!e)return{};const t=(0,Mu.cloneDeep)(e);return t.系统?.历史?.叙事&&delete t.系统.历史.叙事,t.社交?.记忆&&(delete t.社交.记忆.短期记忆,delete t.社交.记忆.隐式中期记忆),t}(i.toSaveData()),c=JSON.stringify(l,null,2),d=`这是一个纯粹的文本总结任务，不是游戏对话。请严格按照以下记忆内容进行总结，不要编造新内容。\n\n【待总结的记忆内容】：\n${s}\n\n现在请严格根据上述记忆内容进行总结，不要偏离。游戏存档数据仅供参考，帮助你理解背景。`;u.showToast("正在调用AI总结记忆...",{type:"info"});const m=(await Promise.resolve().then(n.bind(n,8651))).getTavernHelper();if(!m)throw new Error("TavernHelper 未初始化");let p,h,f=!0,v=!1;try{const e=localStorage.getItem("memory-settings");if(e){const t=JSON.parse(e);f=!1!==t.useRawMode,v=!0===t.useStreaming}}catch(e){console.warn("[NPC记忆总结] 读取配置失败，使用默认值:",e)}if(console.log(`[NPC记忆总结] ${e} - 模式: ${f?"Raw模式（纯净总结）":"标准模式（推荐）"}, 传输: ${v?"流式":"非流式"}`),f){const t=await m.generateRaw({ordered_prompts:[{role:"system",content:`你是${e}的记忆总结助手。这是一个纯文本总结任务，不是游戏对话或故事续写。`},{role:"system",content:`【游戏存档数据】（供参考）：\n${c}`},{role:"system",content:"【关键约束】：\n1. 这不是游戏推进，不要生成新剧情\n2. 这不是对话任务，不要生成角色对话\n3. 只总结用户提供的记忆内容，不要编造\n4. 必须严格基于原文，不要添加原文没有的内容"},{role:"system",content:'【输出格式】：\n```json\n{"text": "总结内容"}\n```'},{role:"system",content:`【总结要求】：\n- 第一人称"我"（${e}的视角）\n- 150-250字\n- 连贯的现代修仙小说叙述风格\n- 仅输出JSON，不要thinking/commands/options`},{role:"system",content:"【必须保留】：\n- 原文中的人名（特别是玩家名字）\n- 原文中的地名\n- 原文中的事件\n- 原文中的物品交换\n- 原文中的情感变化"},{role:"system",content:"【必须忽略】：\n- 对话内容\n- 详细情绪描写\n- 过程细节"},{role:"system",content:'【示例】：\n原文："青云峰遇千夜。他帮我击退魔修。我很感激。他送我聚气丹。我们成为朋友。三天后藏经阁再遇。他求教剑法。我教他基础剑诀。"\n正确："三日前我在青云峰遇到了千夜，当时有魔修来袭，千夜出手相助，我才得以脱险。我很感激他的恩德，于是我们结为道友。千夜还赠予我一枚聚气丹，我们的情谊更加深厚。后来在藏经阁重逢，千夜向我求教剑法，我便传授了他基础剑诀。"\n错误："我继续修炼，又遇到了新的机缘..."（❌ 编造了原文没有的内容）'},{role:"system",content:"【重要提醒】：\n- 不要把这当成游戏对话\n- 不要推进故事\n- 不要编造新内容\n- 严格基于用户提供的记忆进行总结"},{role:"user",content:d},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]},{role:"assistant",content:"</input>"}],should_stream:v,usageType:"memory_summary"});p=String(t)}else{const t=`你是${e}的记忆总结助手。这是一个纯文本总结任务，不是游戏对话或故事续写。\n\n【游戏存档数据】（供参考）：\n${c}\n\n【关键约束】：\n1. 这不是游戏推进，不要生成新剧情\n2. 这不是对话任务，不要生成角色对话\n3. 只总结用户提供的记忆内容，不要编造\n4. 必须严格基于原文，不要添加原文没有的内容\n\n【输出格式】：\n\`\`\`json\n{"text": "总结内容"}\n\`\`\`\n\n【总结要求】：\n- 第一人称"我"（${e}的视角）\n- 150-250字\n- 连贯的现代修仙小说叙述风格\n- 仅输出JSON，不要thinking/commands/options\n\n【必须保留】：\n- 原文中的人名（特别是玩家名字）\n- 原文中的地名\n- 原文中的事件\n- 原文中的物品交换\n- 原文中的情感变化\n\n【必须忽略】：\n- 对话内容\n- 详细情绪描写\n- 过程细节\n\n【示例】：\n原文："青云峰遇千夜。他帮我击退魔修。我很感激。他送我聚气丹。我们成为朋友。三天后藏经阁再遇。他求教剑法。我教他基础剑诀。"\n正确："三日前我在青云峰遇到了千夜，当时有魔修来袭，千夜出手相助，我才得以脱险。我很感激他的恩德，于是我们结为道友。千夜还赠予我一枚聚气丹，我们的情谊更加深厚。后来在藏经阁重逢，千夜向我求教剑法，我便传授了他基础剑诀。"\n错误："我继续修炼，又遇到了新的机缘..."（❌ 编造了原文没有的内容）\n\n【重要提醒】：\n- 不要把这当成游戏对话\n- 不要推进故事\n- 不要编造新内容\n- 严格基于用户提供的记忆进行总结`,n=await m.generate({user_input:d,should_stream:v,generation_id:`npc_memory_summary_${e}_${Date.now()}`,usageType:"memory_summary",injects:[{content:t,role:"system",depth:4,position:"in_chat"},{content:"</input>",role:"assistant",depth:0,position:"in_chat"}]});p=String(n)}const b=String(p).trim(),y=b.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(y?.[1])try{h=JSON.parse(y[1].trim()).text?.trim()||""}catch{h=""}else try{h=JSON.parse(b).text?.trim()||""}catch{h=b.trim()}if(!h||0===h.length)throw new Error("AI返回了空的总结结果");const x=i.getCurrentSaveData(),k=x?.社交?.关系;if(!k)throw new Error("社交.关系 数据不存在");const w=Object.keys(k).find(t=>k[t]?.名字===e);if(!w)throw new Error(`找不到名为 ${e} 的人物`);const E=k[w];E.记忆总结||(E.记忆总结=[]),E.记忆总结.push(h.trim()),E.记忆=o,i.relationships&&i.relationships[w]&&(i.relationships[w]={...E}),await i.saveGame(),g.value?.名字===e&&(g.value={...E}),u.showToast(`✅ 已成功总结 ${a} 条记忆`,{type:"success"})}catch(e){const t=e instanceof Error?e.message:"未知错误";u.showToast(`总结失败: ${t}`,{type:"error"}),console.error("[RelationshipNetworkPanel] 记忆总结失败:",e)}finally{T.value=!1}},ne=()=>{if(g.value)try{const e=g.value.名字,t={人物名称:e,导出时间:(new Date).toLocaleString("zh-CN"),详细记忆:g.value.记忆||[],记忆总结:g.value.记忆总结||[],记忆总数:(g.value.记忆?.length||0)+(g.value.记忆总结?.length||0)},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`${e}_记忆_${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),u.showToast(`✅ 已下载 ${e} 的记忆`,{type:"success"})}catch(e){console.error("[下载记忆] 失败:",e),u.showToast("下载记忆失败",{type:"error"})}else u.showToast("未选择人物",{type:"warning"})},ae=()=>{if(g.value)try{const e=g.value.名字,t={导出信息:{人物名称:e,导出时间:(new Date).toLocaleString("zh-CN"),数据版本:"1.0"},人物数据:g.value},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`${e}_完整数据_${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),u.showToast(`✅ 已下载 ${e} 的完整数据`,{type:"success"})}catch(e){console.error("[下载人物数据] 失败:",e),u.showToast("下载人物数据失败",{type:"error"})}else u.showToast("未选择人物",{type:"warning"})},re=async()=>{if(g.value)try{const e=g.value,t=e.名字,a=(await Promise.resolve().then(n.bind(n,8651))).getTavernHelper();if(!a)return void u.showToast(s.value?"酒馆助手未初始化":"当前环境不可用",{type:"error"});const r=await a.getLorebooks(),o="超凡新生_人物";r.includes(o)||await a.createLorebook(o);let i=`# ${t}\n\n`;if(i+="**基础档案**\n",i+=`- 性别：${e.性别||"未知"}\n`,i+=`- 种族：${e.种族||"未知"}\n`,e.出生日期){const t=e.出生日期;i+=`- 出生日期：${t.年}年${t.月}月${t.日}日\n`}if(i+=`- 境界：${F(e)}\n`,i+=`- 灵根：${j(e)}\n`,e.势力归属&&(i+=`- 势力：${e.势力归属}\n`),e.出生&&(i+=`- 出生地：${U(e.出生)}\n`),e.当前位置?.描述&&(i+=`- 当前位置：${e.当前位置.描述}\n`),i+="\n**外貌与性格**\n",i+=`${e.外貌描述||e.外貌||"未描述"}\n`,e.性格特征&&Array.isArray(e.性格特征)&&e.性格特征.length>0?i+=`\n**性格特征**\n${e.性格特征.map(e=>`- ${e}`).join("\n")}\n`:e.性格&&(i+=`\n**性格特点**\n${e.性格}\n`),e.天赋&&Array.isArray(e.天赋)&&e.天赋.length>0&&(i+=`\n**天赋能力**\n${e.天赋.map(e=>`- ${oe(e)}${ie(e)?": "+ie(e):""}`).join("\n")}\n`),e.先天六司&&(i+="\n**先天六司**\n",i+=`- 根骨：${e.先天六司.根骨||0}\n`,i+=`- 灵性：${e.先天六司.灵性||0}\n`,i+=`- 悟性：${e.先天六司.悟性||0}\n`,i+=`- 气运：${e.先天六司.气运||0}\n`,i+=`- 魅力：${e.先天六司.魅力||0}\n`,i+=`- 心性：${e.先天六司.心性||0}\n`),e.人格底线&&Array.isArray(e.人格底线)&&e.人格底线.length>0?i+=`\n**人格底线**\n${e.人格底线.map(e=>`- ${e}`).join("\n")}\n`:e.人格底线&&"string"==typeof e.人格底线&&(i+=`\n**人格底线**\n${e.人格底线}\n`),i+="\n**当前状态（实时）**\n",e.当前外貌状态&&(i+=`- 外貌状态：${e.当前外貌状态}\n`),e.当前内心想法&&(i+=`- 内心想法：${e.当前内心想法}\n`),e.背包?.物品&&Object.keys(e.背包.物品).length>0&&(i+="\n**背包物品**\n",Object.values(e.背包.物品).forEach(e=>{i+=`- ${e.名称}`,e.数量>1&&(i+=` x${e.数量}`),e.描述&&(i+=`：${e.描述}`),i+="\n"})),e.背包?.灵石){const t=e.背包.灵石;(t.下品||0)+(t.中品||0)+(t.上品||0)+(t.极品||0)>0&&(i+="\n**灵石**\n",t.下品&&(i+=`- 下品：${t.下品}\n`),t.中品&&(i+=`- 中品：${t.中品}\n`),t.上品&&(i+=`- 上品：${t.上品}\n`),t.极品&&(i+=`- 极品：${t.极品}\n`))}i+="\n**与玩家关系**\n",i+=`- 关系：${e.与玩家关系||"相识"}\n`,i+=`- 好感度：${e.好感度||0}\n`,e.实时关注&&(i+="- 实时关注：已启用（AI会主动更新此人物状态）\n");const l={name:t,enabled:!0,strategy:{type:"selective",keys:[t,e.种族||"",e.势力归属||""].filter(Boolean),keys_secondary:{logic:"and_any",keys:[]},scan_depth:"same_as_global"},position:{type:"after_character_definition",role:"system",depth:4,order:100},content:i,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{来源:"超凡新生",导出时间:(new Date).toLocaleString("zh-CN"),人物ID:t}};await a.createLorebookEntries(o,[l]),u.showToast(`✅ 已将 ${t} 添加到世界书「${o}」`,{type:"success"})}catch(e){console.error("[导出世界书] 失败:",e);const t=e instanceof Error?e.message:"未知错误";u.showToast(`导出世界书失败: ${t}`,{type:"error"})}else u.showToast("未选择人物",{type:"warning"})},oe=e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e){const t=e;return String(t["名称"]||t.name||"未知天赋")}return"未知天赋"},ie=e=>{if("string"==typeof e)return"";if("object"==typeof e&&null!==e){const t=e;return String(t["描述"]||t.description||"")}return""},le=e=>{e&&u.showRetryDialog({title:"删除人物",message:`你确定要从这个世界中永久删除【${e.名字}】吗？此操作无法撤销，所有与该人物相关的数据都将消失。`,confirmText:"确认删除",cancelText:"取消",onConfirm:async()=>{const t=e.名字,n=g.value?.名字===t;n&&(g.value=null,f.value=!1);try{await m.deleteNpc(t)}catch(e){const a=e instanceof Error?e.message:"未知错误";if(u.showToast(`删除失败: ${a}`,{type:"error"}),console.error("删除NPC失败:",e),n){const e=W.value.find(e=>e.名字===t);e&&(g.value=e,f.value=!0)}}},onCancel:()=>{}})};return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",lO,[(0,r.createElementVNode)("div",cO,[(0,r.createCommentVNode)(" 人物关系列表 "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["relationships-container",{"details-active":f.value}])},[(0,r.createCommentVNode)(" 左侧：人物列表 "),(0,r.createElementVNode)("div",dO,[(0,r.createElementVNode)("div",uO,[n[12]||(n[12]=(0,r.createElementVNode)("h3",{class:"panel-title"},"人物关系",-1)),(0,r.createElementVNode)("div",mO,[(0,r.createVNode)((0,r.unref)(TP),{size:16}),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>h.value=e),placeholder:"搜索人物...",class:"search-input"},null,512),[[r.vModelText,h.value]])])]),(0,r.createElementVNode)("div",pO,[p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",gO,[(0,r.createVNode)((0,r.unref)(Yw),{size:32,class:"animate-spin"}),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(l)("正在读取人际关系...")),1)])):0===X.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",hO,[(0,r.createVNode)((0,r.unref)(Bu),{size:48,class:"empty-icon"}),(0,r.createElementVNode)("p",fO,(0,r.toDisplayString)(Y.value.total>0?"人物关系数据不完整或未能解析":(0,r.unref)(l)("尚未建立人际关系")),1),Y.value.total>0?((0,r.openBlock)(),(0,r.createElementBlock)("p",vO," 已检测到 "+(0,r.toDisplayString)(Y.value.total)+" 条关系记录，但有效NPC为 0；建议继续进行一回合以触发数据修复，或在「调试信息」里执行同步/强制刷新。 ",1)):((0,r.openBlock)(),(0,r.createElementBlock)("p",bO,(0,r.toDisplayString)((0,r.unref)(l)("在游戏中与更多人物互动建立关系")),1))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",yO,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(X.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.名字,class:(0,r.normalizeClass)(["person-card",{selected:g.value?.名字===e.名字}]),onClick:t=>(e=>{const t=g.value?.名字!==e.名字;e&&e.记忆总结&&("string"==typeof e.记忆总结?e.记忆总结=[e.记忆总结]:Array.isArray(e.记忆总结)||(e.记忆总结=[])),g.value=g.value?.名字===e.名字?null:e,t&&g.value&&(L(),C.value="basic"),g.value?f.value=!0:f.value=!1})(e)},[(0,r.createElementVNode)("div",kO,[(0,r.createElementVNode)("span",wO,(0,r.toDisplayString)(e.名字.charAt(0)),1)]),(0,r.createElementVNode)("div",EO,[(0,r.createElementVNode)("div",NO,(0,r.toDisplayString)(e.名字),1),(0,r.createElementVNode)("div",SO,[(0,r.createElementVNode)("span",VO,(0,r.toDisplayString)(e.与玩家关系||"相识"),1),(0,r.createElementVNode)("div",{class:"card-actions",onClick:n[1]||(n[1]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("button",{class:"attention-toggle",onClick:(0,r.withModifiers)(t=>(async e=>{console.log("[关注按钮] 点击了关注按钮，人物:",e.名字);const t=e.名字;try{const e=i.relationships;if(!e)return void u.showToast("人物关系数据不存在",{type:"error"});const n=Object.keys(e).find(n=>e[n]?.名字===t);if(!n)return void u.showToast(`找不到名为 ${t} 的人物`,{type:"error"});const a=e[n],r=!a.实时关注;a.实时关注=r,console.log("[关注按钮] 切换状态:",r,"保存前的数据:",a.实时关注),await i.saveGame(),console.log("[关注按钮] 保存完成"),u.showToast(r?`已关注 ${t}`:`已取消关注 ${t}`,{type:"success"}),g.value?.名字===t&&(g.value={...e[n]})}catch(e){const t=e instanceof Error?e.message:"未知错误";u.showToast(`操作失败: ${t}`,{type:"error"}),console.error("[关注按钮] 错误:",e)}})(e),["stop"]),title:ee(e)?"取消关注":"添加关注"},[ee(e)?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(aO),{key:0,size:14,class:"attention-icon active"})):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(rO),{key:1,size:14,class:"attention-icon inactive"}))],8,_O),(0,r.createElementVNode)("button",{onClick:(0,r.withModifiers)(t=>le(e),["stop"]),class:"delete-btn-card",title:"删除人物"},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,CO)])]),"未知"!==F(e)?((0,r.openBlock)(),(0,r.createElementBlock)("div",AO,[n[13]||(n[13]=(0,r.createElementVNode)("span",{class:"realm-label"},"境界:",-1)),(0,r.createElementVNode)("span",DO,(0,r.toDisplayString)(F(e)),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",TO,[(0,r.createElementVNode)("div",BO,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["intimacy-fill",J(e.好感度)]),style:(0,r.normalizeStyle)({width:Math.max(5,Math.abs(e.好感度||0))+"%"})},null,6)]),(0,r.createElementVNode)("span",IO,(0,r.toDisplayString)(e.好感度||0),1)])]),(0,r.createVNode)((0,r.unref)(dm),{size:16,class:"arrow-icon"})],10,xO))),128))]))])]),(0,r.createCommentVNode)(" 右侧：人物详情 "),(0,r.createElementVNode)("div",zO,[g.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createCommentVNode)(" 详情头部 "),(0,r.createElementVNode)("div",MO,[(0,r.createElementVNode)("button",{onClick:n[2]||(n[2]=e=>f.value=!1),class:"back-to-list-btn"},[(0,r.createVNode)((0,r.unref)(Yh),{size:20})]),(0,r.createElementVNode)("div",PO,[(0,r.createElementVNode)("span",RO,(0,r.toDisplayString)(g.value.名字.charAt(0)),1)]),(0,r.createElementVNode)("div",$O,[(0,r.createElementVNode)("div",OO,[(0,r.createElementVNode)("h3",LO,(0,r.toDisplayString)(g.value.名字),1),(0,r.createElementVNode)("div",FO,[(0,r.createElementVNode)("button",{onClick:ae,class:"action-btn download-btn",title:"下载完整人物数据"},[(0,r.createVNode)((0,r.unref)(Jh.A),{size:16})]),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,onClick:re,class:"action-btn export-btn",title:"导出到世界书（不含记忆）"},[(0,r.createVNode)((0,r.unref)(vu.A),{size:16})])):(0,r.createCommentVNode)("v-if",!0),g.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,onClick:n[3]||(n[3]=(0,r.withModifiers)(e=>le(g.value),["stop"])),class:"delete-npc-btn",title:"删除此人物"},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:16})])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",jO,[(0,r.createElementVNode)("span",UO,(0,r.toDisplayString)(g.value.与玩家关系||"相识"),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["intimacy-badge",J(g.value.好感度)])}," 好感 "+(0,r.toDisplayString)(g.value.好感度||0),3),(0,r.createElementVNode)("span",qO,(0,r.toDisplayString)(g.value.种族||"人族"),1),g.value.势力归属?((0,r.openBlock)(),(0,r.createElementBlock)("span",GO,(0,r.toDisplayString)(g.value.势力归属),1)):(0,r.createCommentVNode)("v-if",!0)])])]),(0,r.createCommentVNode)(" 详情主体 "),(0,r.createElementVNode)("div",HO,[(0,r.createCommentVNode)(" 选项卡导航 "),(0,r.createElementVNode)("div",YO,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(D.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.id,class:(0,r.normalizeClass)(["tab-btn",{active:C.value===e.id}]),onClick:t=>C.value=e.id},(0,r.toDisplayString)(e.icon)+" "+(0,r.toDisplayString)(e.label),11,WO))),128))]),(0,r.createCommentVNode)(" 选项卡内容 "),(0,r.createElementVNode)("div",XO,[(0,r.createCommentVNode)(" Tab 1: 基本信息 "),(0,r.withDirectives)((0,r.createElementVNode)("div",JO,[(0,r.createCommentVNode)(" 基础档案 "),(0,r.createElementVNode)("div",KO,[n[20]||(n[20]=(0,r.createElementVNode)("h5",{class:"section-title"},"基础档案",-1)),(0,r.createElementVNode)("div",ZO,[(0,r.createElementVNode)("div",QO,[n[14]||(n[14]=(0,r.createElementVNode)("span",{class:"info-label"},"境界",-1)),(0,r.createElementVNode)("span",eL,(0,r.toDisplayString)(F(g.value)),1)]),(0,r.createElementVNode)("div",tL,[n[15]||(n[15]=(0,r.createElementVNode)("span",{class:"info-label"},"性别",-1)),(0,r.createElementVNode)("span",nL,(0,r.toDisplayString)(g.value.性别||"未知"),1)]),(0,r.createElementVNode)("div",aL,[n[16]||(n[16]=(0,r.createElementVNode)("span",{class:"info-label"},"年龄",-1)),(0,r.createElementVNode)("span",rL,(0,r.toDisplayString)(H(g.value)),1)]),(0,r.createElementVNode)("div",oL,[n[17]||(n[17]=(0,r.createElementVNode)("span",{class:"info-label"},"灵根",-1)),(0,r.createElementVNode)("span",iL,(0,r.toDisplayString)(j(g.value)),1)]),g.value.当前位置?((0,r.openBlock)(),(0,r.createElementBlock)("div",sL,[n[18]||(n[18]=(0,r.createElementVNode)("span",{class:"info-label"},"位置",-1)),(0,r.createElementVNode)("span",lL,(0,r.toDisplayString)(g.value.当前位置.描述),1)])):(0,r.createCommentVNode)("v-if",!0),g.value.出生?((0,r.openBlock)(),(0,r.createElementBlock)("div",cL,[n[19]||(n[19]=(0,r.createElementVNode)("span",{class:"info-label"},"出生",-1)),(0,r.createElementVNode)("span",dL,(0,r.toDisplayString)(U(g.value.出生)),1)])):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 外貌与性格 "),g.value.外貌描述||g.value.性格特征?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",uL,[n[21]||(n[21]=(0,r.createElementVNode)("h5",{class:"section-title"},"外貌与性格",-1)),g.value.外貌描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",mL,[(0,r.createElementVNode)("p",pL,(0,r.toDisplayString)(g.value.外貌描述),1)])):(0,r.createCommentVNode)("v-if",!0),g.value.性格特征?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",gL,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value.性格特征,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"talent-tag"},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 天赋与六司 "),g.value.天赋?.length||g.value.先天六司?((0,r.openBlock)(),(0,r.createElementBlock)("div",hL,[n[30]||(n[30]=(0,r.createElementVNode)("h5",{class:"section-title"},"天赋与六司",-1)),g.value.天赋?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",fL,[n[22]||(n[22]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"天赋能力",-1)),(0,r.createElementVNode)("div",vL,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value.天赋,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:t,class:"talent-tag",onClick:t=>(e=>{const t=oe(e),n=ie(e);n&&u.showDetailModal({title:t,content:n})})(e),style:{cursor:"pointer"}},(0,r.toDisplayString)(oe(e)),9,bL))),128))])])):(0,r.createCommentVNode)("v-if",!0),g.value.先天六司?((0,r.openBlock)(),(0,r.createElementBlock)("div",yL,[n[29]||(n[29]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"先天六司",-1)),(0,r.createElementVNode)("div",xL,[(0,r.createElementVNode)("div",kL,[n[23]||(n[23]=(0,r.createElementVNode)("span",{class:"attr-label"},"根骨",-1)),(0,r.createElementVNode)("span",wL,(0,r.toDisplayString)(g.value.先天六司.根骨||0),1)]),(0,r.createElementVNode)("div",EL,[n[24]||(n[24]=(0,r.createElementVNode)("span",{class:"attr-label"},"灵性",-1)),(0,r.createElementVNode)("span",NL,(0,r.toDisplayString)(g.value.先天六司.灵性||0),1)]),(0,r.createElementVNode)("div",SL,[n[25]||(n[25]=(0,r.createElementVNode)("span",{class:"attr-label"},"悟性",-1)),(0,r.createElementVNode)("span",VL,(0,r.toDisplayString)(g.value.先天六司.悟性||0),1)]),(0,r.createElementVNode)("div",_L,[n[26]||(n[26]=(0,r.createElementVNode)("span",{class:"attr-label"},"气运",-1)),(0,r.createElementVNode)("span",CL,(0,r.toDisplayString)(g.value.先天六司.气运||0),1)]),(0,r.createElementVNode)("div",AL,[n[27]||(n[27]=(0,r.createElementVNode)("span",{class:"attr-label"},"魅力",-1)),(0,r.createElementVNode)("span",DL,(0,r.toDisplayString)(g.value.先天六司.魅力||0),1)]),(0,r.createElementVNode)("div",TL,[n[28]||(n[28]=(0,r.createElementVNode)("span",{class:"attr-label"},"心性",-1)),(0,r.createElementVNode)("span",BL,(0,r.toDisplayString)(g.value.先天六司.心性||0),1)])])])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 最近记忆 "),q(g.value).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",IL,[n[31]||(n[31]=(0,r.createElementVNode)("h5",{class:"section-title"},"📝 最近记忆",-1)),(0,r.createElementVNode)("div",zL,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(q(g.value),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"npc-memory-item"},[(0,r.createElementVNode)("div",ML,(0,r.toDisplayString)(e),1)]))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 人格底线（所有NPC都有）"),(0,r.createElementVNode)("div",PL,[n[32]||(n[32]=(0,r.createElementVNode)("h5",{class:"section-title"},"⚠️ 人格底线",-1)),(0,r.createElementVNode)("div",RL,[g.value.人格底线?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",$L,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value.人格底线,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:t,class:"bottomline-tag"},(0,r.toDisplayString)(e),1))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",OL,"未记录人格底线"))]),n[33]||(n[33]=(0,r.createElementVNode)("div",{class:"bottomline-warning"},[(0,r.createElementVNode)("span",{class:"warning-icon"},"⚡"),(0,r.createElementVNode)("span",{class:"warning-text"},"触犯人格底线将导致好感度断崖式下跌（-30 ~ -60），关系破裂且极难修复")],-1))])],512),[[r.vShow,"basic"===C.value]]),(0,r.createCommentVNode)(" Tab 2: 实时状态 "),(0,r.withDirectives)((0,r.createElementVNode)("div",LL,[(0,r.createElementVNode)("div",FL,[n[38]||(n[38]=(0,r.createElementVNode)("h5",{class:"section-title"},"💭 当前状态（实时）",-1)),(0,r.createElementVNode)("div",jL,[(0,r.createElementVNode)("div",UL,[n[35]||(n[35]=(0,r.createElementVNode)("span",{class:"status-icon"},"😶",-1)),(0,r.createElementVNode)("div",qL,[n[34]||(n[34]=(0,r.createElementVNode)("div",{class:"status-label"},"外貌状态",-1)),(0,r.createElementVNode)("div",GL,(0,r.toDisplayString)(g.value.当前外貌状态||"神态自然，衣衫整洁"),1)])]),(0,r.createElementVNode)("div",HL,[n[37]||(n[37]=(0,r.createElementVNode)("span",{class:"status-icon"},"💭",-1)),(0,r.createElementVNode)("div",YL,[n[36]||(n[36]=(0,r.createElementVNode)("div",{class:"status-label"},"内心想法",-1)),(0,r.createElementVNode)("div",WL,(0,r.toDisplayString)(g.value.当前内心想法||"心如止水，平静无波"),1)])])])])],512),[[r.vShow,"status"===C.value]]),(0,r.createCommentVNode)(" Tab: 私密信息（仅酒馆环境） "),s.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",XL,[(0,r.createElementVNode)("div",JL,[n[53]||(n[53]=(0,r.createElementVNode)("h5",{class:"section-title"},"🔞 私密信息",-1)),_.value?v.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ZL,[(0,r.createCommentVNode)(" 概览 "),(0,r.createElementVNode)("div",QL,[n[47]||(n[47]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"概览",-1)),(0,r.createElementVNode)("div",eF,[(0,r.createElementVNode)("div",tF,[n[39]||(n[39]=(0,r.createElementVNode)("span",{class:"info-label"},"是否为处女",-1)),(0,r.createElementVNode)("span",nF,(0,r.toDisplayString)(v.value.是否为处女?"是":"否"),1)]),(0,r.createElementVNode)("div",aF,[n[40]||(n[40]=(0,r.createElementVNode)("span",{class:"info-label"},"性格倾向",-1)),(0,r.createElementVNode)("span",rF,(0,r.toDisplayString)(v.value.性格倾向||"无"),1)]),(0,r.createElementVNode)("div",oF,[n[41]||(n[41]=(0,r.createElementVNode)("span",{class:"info-label"},"性取向",-1)),(0,r.createElementVNode)("span",iF,(0,r.toDisplayString)(v.value.性取向||"无"),1)]),(0,r.createElementVNode)("div",sF,[n[42]||(n[42]=(0,r.createElementVNode)("span",{class:"info-label"},"当前性状态",-1)),(0,r.createElementVNode)("span",lF,(0,r.toDisplayString)(v.value.当前性状态||"无"),1)]),(0,r.createElementVNode)("div",cF,[n[43]||(n[43]=(0,r.createElementVNode)("span",{class:"info-label"},"体液分泌状态",-1)),(0,r.createElementVNode)("span",dF,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status-badge",`status-${v.value.体液分泌状态||"正常"}`])},(0,r.toDisplayString)(v.value.体液分泌状态||"正常"),3)])]),(0,r.createElementVNode)("div",uF,[n[44]||(n[44]=(0,r.createElementVNode)("span",{class:"info-label"},"性交总次数",-1)),(0,r.createElementVNode)("span",mF,(0,r.toDisplayString)(v.value.性交总次数??0),1)])]),(0,r.createElementVNode)("div",pF,[(0,r.createElementVNode)("div",gF,[(0,r.createElementVNode)("div",hF,[n[45]||(n[45]=(0,r.createElementVNode)("span",{class:"dev-label"},"性渴望程度",-1)),(0,r.createElementVNode)("span",fF,(0,r.toDisplayString)(v.value.性渴望程度??0)+"/100",1)]),(0,r.createElementVNode)("div",vF,[(0,r.createElementVNode)("div",{class:"dev-bar-fill desire-fill",style:(0,r.normalizeStyle)({width:`${t(v.value.性渴望程度)}%`})},null,4)])])]),b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",bF,[n[46]||(n[46]=(0,r.createElementVNode)("span",{class:"last-time-label"},"最近一次：",-1)),(0,r.createElementVNode)("span",yF,(0,r.toDisplayString)(b.value),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 偏好/体质 "),y.value.length||x.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",xF,[n[48]||(n[48]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"偏好与体质",-1)),y.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",kF,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(y.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:`${e}-${t}`,class:"fetish-tag"},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0),x.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",wF,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(x.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:`${e}-${t}`,class:"special-trait-tag"},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 性伴侣名单 "),w.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",EF,[n[49]||(n[49]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"性伴侣名单",-1)),(0,r.createElementVNode)("div",NF,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(E.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:`${e}-${t}`,class:"partner-tag"},(0,r.toDisplayString)(e),1))),128))]),w.value.length>E.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"toggle-more-btn",onClick:n[4]||(n[4]=e=>k.value=!0),type:"button"}," 显示全部（"+(0,r.toDisplayString)(w.value.length)+"） ",1)):w.value.length>10&&k.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"toggle-more-btn",onClick:n[5]||(n[5]=e=>k.value=!1),type:"button"}," 收起 ")):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 身体部位 "),S.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",SF,[n[52]||(n[52]=(0,r.createElementVNode)("h6",{class:"subsection-title"},"身体部位",-1)),(0,r.createElementVNode)("div",VF,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(V.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:`${e.部位名称}-${a}`,class:"body-part-item"},[(0,r.createElementVNode)("div",_F,[(0,r.createElementVNode)("span",CF,(0,r.toDisplayString)(e.部位名称||`部位${a+1}`),1),e.特殊印记?((0,r.openBlock)(),(0,r.createElementBlock)("span",AF,(0,r.toDisplayString)(e.特殊印记),1)):(0,r.createCommentVNode)("v-if",!0)]),e.特征描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",DF,(0,r.toDisplayString)(e.特征描述),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",TF,[(0,r.createElementVNode)("div",BF,[n[50]||(n[50]=(0,r.createElementVNode)("span",{class:"stat-label"},"敏感度",-1)),(0,r.createElementVNode)("div",IF,[(0,r.createElementVNode)("div",{class:"stat-bar-fill sensitivity",style:(0,r.normalizeStyle)({width:`${t(e.敏感度)}%`})},null,4)]),(0,r.createElementVNode)("span",zF,(0,r.toDisplayString)(e.敏感度??0),1)]),(0,r.createElementVNode)("div",MF,[n[51]||(n[51]=(0,r.createElementVNode)("span",{class:"stat-label"},"开发度",-1)),(0,r.createElementVNode)("div",PF,[(0,r.createElementVNode)("div",{class:"stat-bar-fill development",style:(0,r.normalizeStyle)({width:`${t(e.开发度)}%`})},null,4)]),(0,r.createElementVNode)("span",RF,(0,r.toDisplayString)(e.开发度??0),1)])])]))),128))]),S.value.length>V.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"toggle-more-btn",onClick:n[6]||(n[6]=e=>N.value=!0),type:"button"}," 显示全部（"+(0,r.toDisplayString)(S.value.length)+"） ",1)):S.value.length>6&&N.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"toggle-more-btn",onClick:n[7]||(n[7]=e=>N.value=!1),type:"button"}," 收起 ")):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",$F,"暂无私密信息（等待AI生成）")):((0,r.openBlock)(),(0,r.createElementBlock)("div",KL," 成人内容未启用（可在设置面板开启） "))])],512)),[[r.vShow,"nsfw"===C.value]]):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" Tab 3: 记忆档案 "),(0,r.withDirectives)((0,r.createElementVNode)("div",OF,[(0,r.createCommentVNode)(" 详细记忆区域 "),g.value.记忆?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",LF,[(0,r.createElementVNode)("div",FF,[n[54]||(n[54]=(0,r.createElementVNode)("h5",{class:"section-title",style:{border:"none",padding:"0",margin:"0"}}," 📝 详细记忆 ",-1)),(0,r.createElementVNode)("div",jF,[(0,r.createElementVNode)("div",UF,(0,r.toDisplayString)(g.value.记忆?.length||0)+" 条",1),(0,r.createElementVNode)("div",qF,[(0,r.createElementVNode)("button",{class:"download-memory-btn",onClick:ne,title:"下载所有记忆"}," 💾 下载记忆 "),(g.value.记忆?.length||0)>=3?((0,r.openBlock)(),(0,r.createElementBlock)("div",GF,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":n[8]||(n[8]=e=>B.value=e),min:3,max:g.value.记忆?.length||3,class:"summarize-input",placeholder:"条数",title:"从最旧开始总结的记忆条数"},null,8,HF),[[r.vModelText,B.value,void 0,{number:!0}]]),(0,r.createElementVNode)("button",{class:"summarize-btn",onClick:te,disabled:T.value,title:"总结最旧的记忆"},(0,r.toDisplayString)(T.value?"总结中...":"📝 总结"),9,YF)])):(0,r.createCommentVNode)("v-if",!0)])])]),(0,r.createCommentVNode)(" 总结模式提示 "),n[55]||(n[55]=(0,r.createElementVNode)("div",{class:"summary-mode-hint"},[(0,r.createTextVNode)(" ℹ️ 总结模式配置（Raw/标准、流式/非流式）请前往 "),(0,r.createElementVNode)("strong",null,"记忆中心面板"),(0,r.createTextVNode)(" → 设置 ")],-1)),(0,r.createElementVNode)("div",WF,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(P.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"memory-item"},[(0,r.createElementVNode)("div",XF,[(0,r.unref)(iO)(e)?((0,r.openBlock)(),(0,r.createElementBlock)("div",JF,(0,r.toDisplayString)((0,r.unref)(iO)(e)),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",KF,(0,r.toDisplayString)((0,r.unref)(sO)(e)),1)]),(0,r.createElementVNode)("div",ZF,[(0,r.createElementVNode)("button",{class:"memory-btn edit",onClick:e=>(async e=>{if(!g.value)return;const t=g.value.名字,n=Z(t);if(!n)return;if(!i.relationships?.[n]?.记忆)return;const a=i.relationships[n].记忆[e];if("string"==typeof a){const t=window.prompt("编辑记忆内容",a);if(null===t||""===t.trim())return;return i.relationships[n].记忆[e]=t.trim(),g.value={...i.relationships[n]},await i.saveGame(),void u.showToast("记忆已更新",{type:"success"})}if(a&&"object"==typeof a){const t=a.时间||"未知时间",r=a.事件||"",o=window.prompt("编辑记忆时间",t);if(null===o)return;const s=window.prompt("编辑记忆事件",r);if(null===s)return;i.relationships[n].记忆[e]={时间:o.trim(),事件:s.trim()},g.value={...i.relationships[n]},await i.saveGame(),u.showToast("记忆已更新",{type:"success"})}})((z.value-1)*I.value+t)}," 编辑 ",8,QF),(0,r.createElementVNode)("button",{class:"memory-btn delete",onClick:e=>(async e=>{g.value&&u.showRetryDialog({title:"删除记忆",message:"确定要删除这条记忆吗？",confirmText:"删除",cancelText:"取消",onConfirm:async()=>{const t=g.value.名字,n=Z(t);n&&i.relationships?.[n]?.记忆&&(i.relationships[n].记忆.splice(e,1),g.value={...i.relationships[n]},await i.saveGame(),u.showToast("记忆已删除",{type:"success"}))},onCancel:()=>{}})})((z.value-1)*I.value+t)}," 删除 ",8,ej)])]))),128))]),R.value>1?((0,r.openBlock)(),(0,r.createElementBlock)("div",tj,[(0,r.createElementVNode)("button",{class:"pagination-btn",disabled:z.value<=1,onClick:n[9]||(n[9]=e=>$(z.value-1))}," 上一页 ",8,nj),(0,r.createElementVNode)("div",aj,[(0,r.createElementVNode)("span",rj,(0,r.toDisplayString)(z.value)+" / "+(0,r.toDisplayString)(R.value),1),(0,r.createElementVNode)("div",oj,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number","onUpdate:modelValue":n[10]||(n[10]=e=>M.value=e),min:1,max:R.value,class:"page-input",placeholder:"页码",onKeyup:(0,r.withKeys)(O,["enter"])},null,40,ij),[[r.vModelText,M.value,void 0,{number:!0}]]),(0,r.createElementVNode)("button",{class:"jump-btn",onClick:O},"跳转")])]),(0,r.createElementVNode)("button",{class:"pagination-btn",disabled:z.value>=R.value,onClick:n[11]||(n[11]=e=>$(z.value+1))}," 下一页 ",8,sj)])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 记忆总结区域 "),g.value.记忆总结?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",lj,[n[57]||(n[57]=(0,r.createElementVNode)("h5",{class:"section-title"},"📜 记忆总结",-1)),(0,r.createElementVNode)("div",cj,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value.记忆总结,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"memory-summary-item"},[n[56]||(n[56]=(0,r.createElementVNode)("div",{class:"summary-icon"},"📜",-1)),(0,r.createElementVNode)("div",dj,(0,r.toDisplayString)(e),1)]))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 空状态提示 "),g.value.记忆?.length||g.value.记忆总结?.length?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",uj,[(0,r.createElementVNode)("div",mj,[(0,r.createVNode)((0,r.unref)(vu.A),{size:24,class:"empty-icon"}),n[58]||(n[58]=(0,r.createElementVNode)("p",null,"此人暂无记忆",-1)),n[59]||(n[59]=(0,r.createElementVNode)("p",{class:"empty-hint"},"在游戏中与该人物互动会生成记忆",-1))])]))],512),[[r.vShow,"memory"===C.value]]),(0,r.createCommentVNode)(" End of Tab 4: 记忆档案 "),(0,r.createCommentVNode)(" Tab 5: 背包 "),(0,r.withDirectives)((0,r.createElementVNode)("div",pj,[(0,r.createElementVNode)("div",gj,[n[66]||(n[66]=(0,r.createElementVNode)("h5",{class:"section-title"},"背包",-1)),g.value.背包?.灵石?((0,r.openBlock)(),(0,r.createElementBlock)("div",hj,[(0,r.createElementVNode)("div",fj,[n[60]||(n[60]=(0,r.createElementVNode)("span",null,"下品灵石",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(g.value.背包.灵石.下品||0),1)]),(0,r.createElementVNode)("div",vj,[n[61]||(n[61]=(0,r.createElementVNode)("span",null,"中品灵石",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(g.value.背包.灵石.中品||0),1)]),(0,r.createElementVNode)("div",bj,[n[62]||(n[62]=(0,r.createElementVNode)("span",null,"上品灵石",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(g.value.背包.灵石.上品||0),1)]),(0,r.createElementVNode)("div",yj,[n[63]||(n[63]=(0,r.createElementVNode)("span",null,"极品灵石",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(g.value.背包.灵石.极品||0),1)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",xj,[Q(g.value)?((0,r.openBlock)(),(0,r.createElementBlock)("div",kj,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value.背包.物品,(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:(0,r.normalizeClass)(["npc-item-card",(o=e.品质?.quality,o?`quality-${o.toLowerCase()}`:"quality-unknown")])},[(0,r.createElementVNode)("div",wj,[(0,r.createElementVNode)("span",Ej,(0,r.toDisplayString)(e.名称||t),1),(0,r.createElementVNode)("span",Nj,(0,r.toDisplayString)(e.类型||"其他"),1)]),e.品质?((0,r.openBlock)(),(0,r.createElementBlock)("div",Sj,[(0,r.createElementVNode)("span",Vj,(0,r.toDisplayString)(e.品质?.quality||"未知")+(0,r.toDisplayString)(e.品质?.grade?(a=e.品质.grade,null==a?"":0===a?"残缺":a>=1&&a<=3?"下品":a>=4&&a<=6?"中品":a>=7&&a<=9?"上品":10===a?"极品":""):""),1)])):(0,r.createCommentVNode)("v-if",!0),e.数量>1?((0,r.openBlock)(),(0,r.createElementBlock)("div",_j,[(0,r.createElementVNode)("span",null,"x"+(0,r.toDisplayString)(e.数量),1)])):(0,r.createCommentVNode)("v-if",!0),e.描述?((0,r.openBlock)(),(0,r.createElementBlock)("div",Cj,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.描述),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Aj,[(0,r.createElementVNode)("button",{class:"trade-btn",onClick:t=>((e,t)=>{const n=`尝试与 ${e.名字} 交易 ${t.名称}`;d.addAction({type:"npc_trade",itemName:t.名称,itemType:"NPC交易",description:n,npcName:e.名字,itemId:t.物品ID||t.名称,tradeType:"trade"}),u.showToast(`已将与 ${e.名字} 的交易请求加入动作队列`,{type:"success"})})(g.value,e),title:"尝试交易此物品"},[(0,r.createVNode)((0,r.unref)(oO),{size:12}),n[64]||(n[64]=(0,r.createTextVNode)("交易 ",-1))],8,Dj),(0,r.createElementVNode)("button",{class:"request-btn",onClick:t=>((e,t)=>{const n=`向 ${e.名字} 索要 ${t.名称}`;d.addAction({type:"npc_request",itemName:t.名称,itemType:"NPC索要",description:n,npcName:e.名字,itemId:t.物品ID||t.名称,tradeType:"request"}),u.showToast(`已将向 ${e.名字} 索要物品的请求加入动作队列`,{type:"success"})})(g.value,e),title:"请求获得此物品"}," 🙏 索要 ",8,Tj),(0,r.createElementVNode)("button",{class:"steal-btn",onClick:t=>((e,t)=>{const n=`尝试从 ${e.名字} 身上偷取 ${t.名称}`;d.addAction({type:"npc_steal",itemName:t.名称,itemType:"NPC偷窃",description:n,npcName:e.名字,itemId:t.物品ID||t.名称,tradeType:"steal"}),u.showToast(`已将偷窃 ${e.名字} 物品的计划加入动作队列`,{type:"success"})})(g.value,e),title:"尝试偷取此物品"}," 🥷 偷窃 ",8,Bj)])],2);var a,o}),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ij,[(0,r.createVNode)((0,r.unref)(gu),{size:24,class:"empty-icon"}),n[65]||(n[65]=(0,r.createElementVNode)("p",null,"此人身上没有物品",-1))]))])])],512),[[r.vShow,"inventory"===C.value]]),(0,r.createCommentVNode)(" End of Tab 5: 背包 "),(0,r.createCommentVNode)(" Tab 6: 原始数据 "),(0,r.withDirectives)((0,r.createElementVNode)("div",zj,[(0,r.createElementVNode)("div",Mj,[n[67]||(n[67]=(0,r.createElementVNode)("h5",{class:"section-title"},"原始数据 (JSON)",-1)),(0,r.createElementVNode)("div",Pj,[(0,r.createElementVNode)("pre",null,[(0,r.createElementVNode)("code",null,(0,r.toDisplayString)(JSON.stringify(g.value,null,2)),1)])])])],512),[[r.vShow,"raw"===C.value]]),(0,r.createCommentVNode)(" End of Tab 7: 原始数据 ")]),(0,r.createCommentVNode)(" End of tab-content ")]),(0,r.createCommentVNode)(" End of detail-body ")],64)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Rj,[(0,r.createVNode)((0,r.unref)(Bu),{size:64,class:"placeholder-icon"}),n[68]||(n[68]=(0,r.createElementVNode)("p",{class:"placeholder-text"},"选择一个人物查看详细信息",-1)),n[69]||(n[69]=(0,r.createElementVNode)("p",{class:"placeholder-hint"},"在游戏中与人物互动会建立关系记录",-1))]))])],2)])]))}});var Oj=n(4917),Lj={};Lj.styleTagTransform=k(),Lj.setAttributes=v(),Lj.insert=h().bind(null,"head"),Lj.domAPI=p(),Lj.insertStyleElement=y(),u()(Oj.A,Lj),Oj.A&&Oj.A.locals&&Oj.A.locals;const Fj=(0,N.A)($j,[["__scopeId","data-v-0718c71e"]]),jj=(0,V.A)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]),Uj=(0,V.A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),qj={class:"deep-cultivation-modal"},Gj={class:"modal-header"},Hj={class:"modal-content"},Yj={key:0,class:"technique-info-section"},Wj={class:"info-header"},Xj={class:"technique-details"},Jj={class:"technique-quality"},Kj={class:"progress-section"},Zj={class:"progress-label"},Qj={class:"progress-percent"},eU={class:"progress-bar-bg"},tU={key:0,class:"effects-section"},nU={class:"effects-list"},aU={key:0},rU={key:1},oU={class:"cultivation-days-section"},iU={class:"section-label"},sU={class:"section-hint"},lU={class:"input-group"},cU=["placeholder"],dU={class:"input-unit"},uU={class:"preset-buttons"},mU=["onClick"],pU={class:"modal-footer"},gU=["disabled"],hU=(0,r.defineComponent)({__name:"DeepCultivationModal",props:{visible:{type:Boolean},technique:{},currentProgress:{default:0}},emits:["close","confirm"],setup(e,{emit:t}){const{t:n}=(0,K.s)(),a=e,o=t,i=(0,r.ref)(7),s=[{label:"1天",value:1},{label:"7天",value:7},{label:"30天",value:30},{label:"90天",value:90},{label:"180天",value:180},{label:"365天",value:365}],l=(0,r.computed)(()=>i.value>=1&&i.value<=3650),c=(0,r.computed)(()=>`quality-${a.technique?.品质?.quality||"凡"}`),d=()=>{o("close")},u=()=>{l.value&&o("confirm",i.value)};return(0,r.watch)(()=>a.visible,e=>{e||(i.value=7)}),(e,t)=>e.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,r.withModifiers)(d,["self"])},[(0,r.createElementVNode)("div",qj,[(0,r.createElementVNode)("div",Gj,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(e.$t("深度修炼")),1),(0,r.createElementVNode)("button",{class:"close-btn",onClick:d},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",Hj,[(0,r.createCommentVNode)(" 功法信息 "),e.technique?((0,r.openBlock)(),(0,r.createElementBlock)("div",Yj,[(0,r.createElementVNode)("div",Wj,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["technique-icon",c.value])},"📖",2),(0,r.createElementVNode)("div",Xj,[(0,r.createElementVNode)("h4",{class:(0,r.normalizeClass)(["technique-name",c.value])},(0,r.toDisplayString)(e.technique.名称),3),(0,r.createElementVNode)("div",Jj,(0,r.toDisplayString)(e.technique.品质?.quality||"凡")+"品 "+(0,r.toDisplayString)(e.technique.品质?.grade||0)+"阶 ",1)])]),(0,r.createCommentVNode)(" 当前修炼进度 "),(0,r.createElementVNode)("div",Kj,[(0,r.createElementVNode)("div",Zj,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.$t("当前修炼进度")),1),(0,r.createElementVNode)("span",Qj,(0,r.toDisplayString)(e.currentProgress)+"%",1)]),(0,r.createElementVNode)("div",eU,[(0,r.createElementVNode)("div",{class:"progress-bar-fill",style:(0,r.normalizeStyle)({width:e.currentProgress+"%"})},null,4)])]),(0,r.createCommentVNode)(" 功法效果 "),e.technique.功法效果?((0,r.openBlock)(),(0,r.createElementBlock)("div",tU,[(0,r.createElementVNode)("h5",null,(0,r.toDisplayString)(e.$t("功法效果")),1),(0,r.createElementVNode)("ul",nU,[e.technique.功法效果.修炼速度加成?((0,r.openBlock)(),(0,r.createElementBlock)("li",aU,[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"effect-icon"},"🚀",-1)),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.$t("修炼速度: +{0}%").replace("{0}",(100*(e.technique.功法效果.修炼速度加成-1)).toFixed(0))),1)])):(0,r.createCommentVNode)("v-if",!0),e.technique.功法效果.属性加成?((0,r.openBlock)(),(0,r.createElementBlock)("li",rU,[t[2]||(t[2]=(0,r.createElementVNode)("span",{class:"effect-icon"},"💪",-1)),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.$t("属性加成:"))+" ",1),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.technique.功法效果.属性加成,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:t,class:"attr-bonus"},(0,r.toDisplayString)(t)+"+"+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 修炼天数选择 "),(0,r.createElementVNode)("div",oU,[(0,r.createElementVNode)("label",iU,(0,r.toDisplayString)(e.$t("选择修炼天数")),1),(0,r.createElementVNode)("p",sU,(0,r.toDisplayString)(e.$t("AI将根据修炼天数生成详细的修炼过程和结果")),1),(0,r.createElementVNode)("div",lU,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),type:"number",min:1,max:3650,step:1,class:"days-input",placeholder:e.$t("输入天数")},null,8,cU),[[r.vModelText,i.value,void 0,{number:!0}]]),(0,r.createElementVNode)("span",dU,(0,r.toDisplayString)(e.$t("天")),1)]),(0,r.createCommentVNode)(" 快捷选择 "),(0,r.createElementVNode)("div",uU,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s,e=>(0,r.createElementVNode)("button",{key:e.value,class:(0,r.normalizeClass)(["preset-btn",{active:i.value===e.value}]),onClick:t=>i.value=e.value},(0,r.toDisplayString)(e.label),11,mU)),64))])])]),(0,r.createElementVNode)("div",pU,[(0,r.createElementVNode)("button",{class:"btn btn-cancel",onClick:d},(0,r.toDisplayString)(e.$t("取消")),1),(0,r.createElementVNode)("button",{class:"btn btn-confirm",disabled:!l.value,onClick:u},(0,r.toDisplayString)(e.$t("开始修炼")),9,gU)])])])):(0,r.createCommentVNode)("v-if",!0)}});var fU=n(2031),vU={};vU.styleTagTransform=k(),vU.setAttributes=v(),vU.insert=h().bind(null,"head"),vU.domAPI=p(),vU.insertStyleElement=y(),u()(fU.A,vU),fU.A&&fU.A.locals&&fU.A.locals;const bU=(0,N.A)(hU,[["__scopeId","data-v-57971540"]]),yU={class:"skills-panel"},xU={class:"panel-tabs"},kU={key:0,class:"tab-count"},wU={key:0,class:"tab-count"},EU={key:0,class:"tab-content"},NU={class:"cultivation-header"},SU={class:"cultivation-info"},VU={class:"technique-meta"},_U={class:"meta-label"},CU={class:"cultivation-actions"},AU=["title"],DU=["title"],TU=["title"],BU=["title"],IU=["title"],zU={key:0,class:"cultivation-stats"},MU={class:"stat-item"},PU={class:"stat-label"},RU={class:"stat-item"},$U={class:"stat-label"},OU={class:"stat-value"},LU={class:"stat-item"},FU={class:"stat-label"},jU={class:"stat-value"},UU={class:"stat-item"},qU={class:"stat-label"},GU={class:"stat-value success"},HU={key:0,class:"stat-item highlight"},YU={class:"stat-label"},WU={class:"stat-value warning"},XU={key:1,class:"progress-bar"},JU={key:0,class:"skills-section"},KU={class:"section-header"},ZU={class:"section-count"},QU={class:"skills-grid"},eq={class:"skill-header"},tq={class:"skill-name"},nq={class:"skill-desc"},aq={key:0,class:"skill-progress"},rq={class:"progress-info"},oq={class:"progress-track"},iq={key:1,class:"skill-cost"},sq={class:"tab-content"},lq={class:"search-bar"},cq=["placeholder"],dq={key:0,class:"empty-state"},uq={key:1,class:"mastered-grid"},mq=["onClick"],pq={class:"mastered-header"},gq={class:"mastered-name"},hq={class:"mastered-badge"},fq={class:"mastered-desc"},vq={class:"mastered-meta"},bq={class:"meta-tag"},yq={class:"meta-stat"},xq={class:"tab-content"},kq={class:"search-bar"},wq=["placeholder"],Eq={key:0,class:"empty-state"},Nq={key:1,class:"library-grid"},Sq={class:"technique-header"},Vq={key:0,class:"equipped-badge"},_q={class:"technique-desc"},Cq={class:"technique-footer"},Aq={class:"skill-count"},Dq={class:"technique-actions"},Tq={key:0,class:"tech-btn",disabled:""},Bq=["onClick"],Iq=(0,r.defineComponent)({__name:"SkillsPanel",setup(e){const{t}=(0,K.s)(),a=(0,pu.useGameStateStore)(),o=(0,Jc.useCharacterStore)(),i=(0,A.useUIStore)(),s=(0,r.ref)("cultivation"),l=(0,r.ref)(!1),c=(0,r.ref)(""),d=(0,r.ref)(""),u=(0,r.ref)(null),m=(0,r.computed)(()=>{const e=a.inventory?.物品;if(!e)return null;const t=a.cultivationTechnique?.物品ID;return t&&e[t]?e[t]:Object.values(e).find(e=>{const t=e?.类型||e?.type;return("功法"===t||String(t||"").includes("功法"))&&(!0===e?.已装备||!0===e?.修炼中)})||null}),p=(0,r.computed)(()=>{const e=a.inventory?.物品;return e?Object.values(e).filter(e=>{const t=e?.类型||e?.type;return"功法"===t||String(t||"").includes("功法")}):[]}),g=((0,r.computed)(()=>p.value.filter(e=>!e.已装备&&!e.修炼中)),(0,r.computed)(()=>p.value.length)),h=(0,r.computed)(()=>m.value?.功法技能?[...m.value.功法技能].sort((e,t)=>v(e)-v(t)):[]),f=(0,r.computed)(()=>{if(!m.value?.功法技能)return[];const e=m.value.已解锁技能||[];return m.value.功法技能.filter(t=>e.includes(t.技能名称))}),v=e=>{const t=e.熟练度要求??e.解锁需要熟练度,n="number"==typeof t?t:Number(t||0);return isNaN(n)?0:Math.max(0,Math.min(100,Math.round(n)))},b=e=>m.value?.已解锁技能?.includes(e)||!1,y=e=>{const t=m.value?.修炼进度||0,n=v(e)||100;return Math.min(100,t/n*100)},x=(0,r.computed)(()=>a.masteredSkills||[]),k=(0,r.computed)(()=>{const e=d.value.trim().toLowerCase();return e?x.value.filter(t=>`${t.技能名称} ${t.技能描述||""} ${t.来源||""}`.toLowerCase().includes(e)):x.value}),w=(0,r.computed)(()=>!!m.value&&(m.value.修炼进度||0)>=100),E=(0,r.computed)(()=>{const e=m.value;return e?(1*(t=e.品质?.quality,{仙:3,神:2.5,圣:2,天:1.8,地:1.5,玄:1.3,黄:1.1,凡:1}[t||"凡"]||1)*(e.功法效果?.修炼速度加成||1)).toFixed(1):"0";var t}),N=(0,r.computed)(()=>{if(!w.value)return 0;const e=m.value;if(!e)return 0;const t={仙:30,神:40,圣:50,天:60,地:70,玄:75,黄:80,凡:85}[e.品质?.quality||"凡"]||70;return Math.min(95,t)}),S=async e=>{if(!m.value)return;const{useActionQueueStore:a}=await Promise.resolve().then(n.bind(n,3310)),r=a();"normal"===e?(r.addAction({type:"cultivate",itemName:m.value.名称,itemType:t("功法"),description:`开始修炼《${m.value.名称}》，提升功法熟练度`}),i.showToast(`开始修炼《${m.value.名称}》`,{type:"success"})):(r.addAction({type:"secluded_cultivation",itemName:m.value.名称,itemType:t("闭关"),description:`进入闭关状态，专心修炼《${m.value.名称}》，效率大幅提升`}),i.showToast(`进入闭关修炼《${m.value.名称}》`,{type:"info"}))},V=async()=>{if(!m.value||!w.value)return;const{useActionQueueStore:e}=await Promise.resolve().then(n.bind(n,3310));e().addAction({type:"breakthrough",itemName:m.value.名称,itemType:t("突破"),description:`尝试突破《${m.value.名称}》的当前境界，进入更高层次`}),i.showToast(`尝试突破《${m.value.名称}》`,{type:"warning"})},_=(0,r.computed)(()=>m.value),C=e=>Math.min(100,Math.max(0,e||0)).toFixed(1),D=e=>`text-quality-${e?.品质?.quality||"凡"}`,T=e=>`border-quality-${e?.品质?.quality||"凡"}`,B=e=>!0===e.已装备||!0===e.修炼中,I=Zw.getInstance(),z=async()=>{if(!m.value?.物品ID)return;const e=m.value;i.showRetryDialog({title:t("卸下功法"),message:`${t("确定要卸下")}《${e.名称}》${t("吗")}？`,confirmText:t("确定卸下"),cancelText:t("取消"),onConfirm:async()=>{try{const t=a.cultivation?.修炼功法?.物品ID;t===e.物品ID&&await I.stopCultivation(e),await o.unequipTechnique(e.物品ID)}catch(e){console.error("[SkillsPanel] Unequip technique failed:",e)}},onCancel:()=>{}})},M=()=>{m.value&&(l.value=!0)},P=()=>{l.value=!1},R=async e=>{if(l.value=!1,m.value)try{const{useActionQueueStore:a}=await Promise.resolve().then(n.bind(n,3310));a().addAction({type:"cultivate",itemName:m.value.名称,itemType:t("功法"),description:`对《${m.value.名称}》进行${e}天的深度修炼`})}catch(e){console.error("[SkillsPanel] Add deep cultivation action failed:",e)}};(0,r.watch)(m,()=>{(()=>{if(!m.value)return;const e=m.value;if(!e.功法技能||!Array.isArray(e.功法技能))return;const t=e.修炼进度||0;let n=!1;e.已解锁技能||(e.已解锁技能=[]),e.功法技能.forEach(a=>{const r=a.熟练度要求||0;t>=r&&!e.已解锁技能.includes(a.技能名称)&&(e.已解锁技能.push(a.技能名称),n=!0)}),n&&o.saveCurrentGame()})()},{immediate:!0});const $=(0,r.computed)(()=>{const e=c.value.trim().toLowerCase(),t=p.value.filter(t=>{if(!e)return!0;const n=String(t.名称||"").toLowerCase(),a=String(t.描述||"").toLowerCase();return n.includes(e)||a.includes(e)}),n={仙:1,神:2,圣:3,道:4,天:5,地:6,玄:7,黄:8,凡:9};return[...t].sort((e,t)=>{const a=!0===e.已装备||!0===e.修炼中;if(a!==(!0===t.已装备||!0===t.修炼中))return a?-1:1;const r=n[e.品质?.quality||"凡"]??99,o=n[t.品质?.quality||"凡"]??99;return r!==o?r-o:String(e.名称||"").localeCompare(String(t.名称||""),"zh-Hans-CN")})});return(e,n)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",yU,[(0,r.createCommentVNode)(" 标签页导航 "),(0,r.createElementVNode)("div",xU,[(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["panel-tab",{active:"cultivation"===s.value}]),onClick:n[0]||(n[0]=e=>s.value="cultivation")},[(0,r.createVNode)((0,r.unref)(bu),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("修炼")),1)],2),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["panel-tab",{active:"mastered"===s.value}]),onClick:n[1]||(n[1]=e=>s.value="mastered")},[(0,r.createVNode)((0,r.unref)(Kp),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("掌握技能")),1),x.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("span",kU,(0,r.toDisplayString)(x.value.length),1)):(0,r.createCommentVNode)("v-if",!0)],2),(0,r.createElementVNode)("button",{class:(0,r.normalizeClass)(["panel-tab",{active:"library"===s.value}]),onClick:n[2]||(n[2]=e=>s.value="library")},[(0,r.createVNode)((0,r.unref)(vu.A),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("功法库")),1),g.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",wU,(0,r.toDisplayString)(g.value),1)):(0,r.createCommentVNode)("v-if",!0)],2)]),(0,r.createCommentVNode)(" 修炼页面 "),"cultivation"===s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",EU,[(0,r.createCommentVNode)(" 当前修炼功法 "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["cultivation-card",m.value?T(m.value):""])},[(0,r.createElementVNode)("div",NU,[(0,r.createElementVNode)("div",SU,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["technique-icon",m.value?(a=m.value,`bg-quality-${a?.品质?.quality||"凡"}`):""])},[(0,r.createVNode)((0,r.unref)(Hw.A),{size:20})],2),(0,r.createElementVNode)("div",VU,[(0,r.createElementVNode)("span",_U,(0,r.toDisplayString)(m.value?(0,r.unref)(t)("当前修炼"):(0,r.unref)(t)("未在修炼")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["technique-name",m.value?D(m.value):""])},(0,r.toDisplayString)(m.value?.名称||(0,r.unref)(t)("请从功法库选择功法")),3)])]),(0,r.createElementVNode)("div",CU,[m.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createElementVNode)("button",{class:"action-btn primary",onClick:n[3]||(n[3]=e=>S("normal")),title:(0,r.unref)(t)("修炼")},[(0,r.createVNode)((0,r.unref)(bu),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("修炼")),1)],8,AU),(0,r.createElementVNode)("button",{class:"action-btn",onClick:n[4]||(n[4]=e=>S("secluded")),title:(0,r.unref)(t)("闭关")},[(0,r.createVNode)((0,r.unref)(jj),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("闭关")),1)],8,DU),(0,r.createElementVNode)("button",{class:"action-btn",onClick:M,title:(0,r.unref)(t)("深修")},[(0,r.createVNode)((0,r.unref)(cm),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("深修")),1)],8,TU),w.value?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"action-btn warning",onClick:V,title:(0,r.unref)(t)("突破")},[(0,r.createVNode)((0,r.unref)(Uj),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("突破")),1)],8,BU)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{class:"action-btn danger",onClick:z,title:(0,r.unref)(t)("卸下")},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("卸下")),1)],8,IU)],64)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" 修炼统计 "),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",zU,[(0,r.createElementVNode)("div",MU,[(0,r.createElementVNode)("span",PU,(0,r.toDisplayString)((0,r.unref)(t)("品质")),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["stat-value",D(m.value)])},(0,r.toDisplayString)(m.value.品质?.quality||"凡")+"品",3)]),(0,r.createElementVNode)("div",RU,[(0,r.createElementVNode)("span",$U,(0,r.toDisplayString)((0,r.unref)(t)("进度")),1),(0,r.createElementVNode)("span",OU,(0,r.toDisplayString)(C(m.value.修炼进度))+"%",1)]),(0,r.createElementVNode)("div",LU,[(0,r.createElementVNode)("span",FU,(0,r.toDisplayString)((0,r.unref)(t)("速度")),1),(0,r.createElementVNode)("span",jU,(0,r.toDisplayString)(E.value)+"%/日",1)]),(0,r.createElementVNode)("div",UU,[(0,r.createElementVNode)("span",qU,(0,r.toDisplayString)((0,r.unref)(t)("已解锁")),1),(0,r.createElementVNode)("span",GU,(0,r.toDisplayString)(f.value.length)+"/"+(0,r.toDisplayString)(h.value.length),1)]),w.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",HU,[(0,r.createElementVNode)("span",YU,(0,r.toDisplayString)((0,r.unref)(t)("突破率")),1),(0,r.createElementVNode)("span",WU,(0,r.toDisplayString)(N.value)+"%",1)])):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 进度条 "),m.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",XU,[(0,r.createElementVNode)("div",{class:"progress-fill",style:(0,r.normalizeStyle)({width:C(m.value.修炼进度)+"%"})},null,4)])):(0,r.createCommentVNode)("v-if",!0)],2),(0,r.createCommentVNode)(" 功法技能列表 "),m.value&&h.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",JU,[(0,r.createElementVNode)("div",KU,[(0,r.createVNode)((0,r.unref)(Kp),{size:16}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("功法技能")),1),(0,r.createElementVNode)("span",ZU,(0,r.toDisplayString)(f.value.length)+"/"+(0,r.toDisplayString)(h.value.length),1)]),(0,r.createElementVNode)("div",QU,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(h.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.技能名称,class:(0,r.normalizeClass)(["skill-card",{unlocked:b(e.技能名称)}])},[(0,r.createElementVNode)("div",eq,[(0,r.createElementVNode)("span",tq,(0,r.toDisplayString)(e.技能名称),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["skill-badge",b(e.技能名称)?"success":"locked"])},(0,r.toDisplayString)(b(e.技能名称)?(0,r.unref)(t)("已解锁"):(0,r.unref)(t)("未解锁")),3)]),(0,r.createElementVNode)("p",nq,(0,r.toDisplayString)(e.技能描述||(0,r.unref)(t)("暂无描述")),1),b(e.技能名称)?((0,r.openBlock)(),(0,r.createElementBlock)("div",iq,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)((0,r.unref)(t)("消耗"))+": "+(0,r.toDisplayString)(e.消耗||(0,r.unref)(t)("无")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",aq,[(0,r.createElementVNode)("div",rq,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(C(m.value.修炼进度))+"%",1),n[7]||(n[7]=(0,r.createElementVNode)("span",null,"/",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(v(e))+"%",1)]),(0,r.createElementVNode)("div",oq,[(0,r.createElementVNode)("div",{class:"progress-fill",style:(0,r.normalizeStyle)({width:y(e)+"%"})},null,4)])]))],2))),128))])])):(0,r.createCommentVNode)("v-if",!0)])):"mastered"===s.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 掌握技能 "),(0,r.createElementVNode)("div",sq,[(0,r.createCommentVNode)(" 搜索栏 "),(0,r.createElementVNode)("div",lq,[(0,r.createVNode)((0,r.unref)(TP),{size:16}),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>d.value=e),type:"text",placeholder:(0,r.unref)(t)("搜索技能...")},null,8,cq),[[r.vModelText,d.value]])]),0===k.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",dq,[(0,r.createVNode)((0,r.unref)(Kp),{size:32,class:"empty-icon"}),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(d.value.trim()?(0,r.unref)(t)("没有匹配的技能"):(0,r.unref)(t)("暂无掌握技能")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",uq,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(k.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.技能名称+"::"+(e.来源||""),class:(0,r.normalizeClass)(["mastered-card",{active:u.value===e.技能名称+"::"+(e.来源||"")}]),onClick:t=>(e=>{u.value=e.技能名称+"::"+(e.来源||"")})(e)},[(0,r.createElementVNode)("div",pq,[(0,r.createElementVNode)("span",gq,(0,r.toDisplayString)(e.技能名称),1),(0,r.createElementVNode)("span",hq,(0,r.toDisplayString)((0,r.unref)(t)("已掌握")),1)]),(0,r.createElementVNode)("p",fq,(0,r.toDisplayString)(e.技能描述||(0,r.unref)(t)("暂无描述")),1),(0,r.createElementVNode)("div",vq,[(0,r.createElementVNode)("span",bq,(0,r.toDisplayString)(e.来源||(0,r.unref)(t)("未知来源")),1),(0,r.createElementVNode)("span",yq,(0,r.toDisplayString)((0,r.unref)(t)("熟练度"))+" "+(0,r.toDisplayString)(e.熟练度??0),1)])],10,mq))),128))]))])],2112)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(" 功法库 "),(0,r.createElementVNode)("div",xq,[(0,r.createCommentVNode)(" 搜索栏 "),(0,r.createElementVNode)("div",kq,[(0,r.createVNode)((0,r.unref)(TP),{size:16}),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":n[6]||(n[6]=e=>c.value=e),type:"text",placeholder:(0,r.unref)(t)("搜索功法...")},null,8,wq),[[r.vModelText,c.value]])]),0===$.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Eq,[(0,r.createVNode)((0,r.unref)(vu.A),{size:32,class:"empty-icon"}),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(t)("功法库为空或无匹配结果")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Nq,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)($.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.物品ID,class:(0,r.normalizeClass)(["technique-card",[{equipped:B(e)},T(e)]])},[(0,r.createElementVNode)("div",Sq,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["technique-name",D(e)])},(0,r.toDisplayString)(e.名称),3),B(e)?((0,r.openBlock)(),(0,r.createElementBlock)("span",Vq,(0,r.toDisplayString)((0,r.unref)(t)("修炼中")),1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("p",_q,(0,r.toDisplayString)(e.描述||(0,r.unref)(t)("暂无描述")),1),(0,r.createElementVNode)("div",Cq,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["quality-tag",D(e)])},(0,r.toDisplayString)(e.品质?.quality||"凡")+"品",3),(0,r.createElementVNode)("span",Aq,(0,r.toDisplayString)(e.功法技能?.length||0)+" "+(0,r.toDisplayString)((0,r.unref)(t)("技能")),1)]),(0,r.createElementVNode)("div",Dq,[B(e)?((0,r.openBlock)(),(0,r.createElementBlock)("button",Tq,(0,r.toDisplayString)((0,r.unref)(t)("修炼中")),1)):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"tech-btn primary",onClick:(0,r.withModifiers)(n=>(async e=>{if(!e?.物品ID)return;if(!0===e.已装备||!0===e.修炼中)return;const n=async()=>{try{await o.equipTechnique(e.物品ID),s.value="cultivation"}catch(e){console.error("[SkillsPanel] Equip technique failed:",e)}};m.value?i.showRetryDialog({title:t("切换功法"),message:`${t("当前正在修炼")}《${m.value.名称}》，${t("确定要切换到")}《${e.名称}》${t("吗")}？`,onConfirm:n,onCancel:()=>{}}):await n()})(e),["stop"])},(0,r.toDisplayString)((0,r.unref)(t)("装备")),9,Bq))])],2))),128))]))])],2112)),(0,r.createVNode)(bU,{visible:l.value,technique:_.value,"current-progress":m.value?.修炼进度||0,onClose:P,onConfirm:R},null,8,["visible","technique","current-progress"])]);var a}}});var zq=n(6963),Mq={};Mq.styleTagTransform=k(),Mq.setAttributes=v(),Mq.insert=h().bind(null,"head"),Mq.domAPI=p(),Mq.insertStyleElement=y(),u()(zq.A,Mq),zq.A&&zq.A.locals&&zq.A.locals;const Pq=(0,N.A)(Iq,[["__scopeId","data-v-04f7ac5f"]]),Rq=(0,V.A)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),$q=(0,V.A)("scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),Oq=(0,V.A)("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Lq=(0,V.A)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),Fq=(0,V.A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),jq=(0,V.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Uq={class:"dao-panel"},qq={class:"dao-stats-header"},Gq={class:"stats-card"},Hq={class:"stats-icon enlightened"},Yq={class:"stats-info"},Wq={class:"stats-value"},Xq={class:"stats-card"},Jq={class:"stats-icon experience"},Kq={class:"stats-info"},Zq={class:"stats-value"},Qq={class:"stats-actions"},eG={key:0,class:"dao-filter-bar"},tG={class:"filter-tags"},nG=["onClick"],aG={class:"tag-count"},rG={class:"sort-dropdown"},oG=["value"],iG={class:"dao-content"},sG={key:0,class:"dao-empty"},lG={class:"empty-illustration"},cG={class:"empty-icon-wrapper"},dG={class:"quick-actions"},uG={class:"dao-list"},mG=["onClick"],pG={class:"dao-card-header"},gG={class:"dao-icon"},hG={class:"dao-title-group"},fG={class:"dao-name"},vG={class:"dao-card-body"},bG={class:"dao-progress-wrapper"},yG={class:"dao-progress-bar"},xG={class:"dao-progress-text"},kG={class:"dao-exp-info"},wG={class:"exp-current"},EG={class:"exp-required"},NG=["onClick"],SG=["onClick"],VG=["onClick"],_G={key:2,class:"dao-detail-panel"},CG={class:"detail-header"},AG={class:"detail-title-group"},DG={class:"detail-icon"},TG={class:"detail-title"},BG={class:"detail-stage"},IG={class:"detail-body"},zG={class:"detail-stats-grid"},MG={class:"detail-stat-card"},PG={class:"stat-card-icon"},RG={class:"stat-card-content"},$G={class:"stat-card-value"},OG={class:"detail-stat-card"},LG={class:"stat-card-icon"},FG={class:"stat-card-content"},jG={class:"stat-card-value"},UG={class:"detail-stat-card"},qG={class:"stat-card-icon"},GG={class:"stat-card-content"},HG={class:"stat-card-value"},YG={class:"detail-stat-card"},WG={class:"stat-card-icon progress-icon"},XG={class:"stat-card-content"},JG={class:"stat-card-value"},KG={key:0,class:"stage-progress-section"},ZG={class:"stage-timeline"},QG={class:"node-marker"},eH={key:1,class:"node-number"},tH={class:"node-content"},nH={class:"node-name"},aH={class:"node-desc"},rH={key:1,class:"breakthrough-guide"},oH={class:"guide-header"},iH={class:"guide-content"},sH={class:"breakthrough-chance"},lH={class:"chance-value"},cH={class:"detail-actions"},dH=(0,r.defineComponent)({__name:"ThousandDaoPanel",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,Xw.useActionQueueStore)(),a=(0,r.ref)(null),o=(0,r.ref)("all"),i=(0,r.ref)("progress"),s=[{key:"all",label:"全部",icon:Kp},{key:"nature",label:"自然",icon:Rq},{key:"concept",label:"法则",icon:$q},{key:"combat",label:"战斗",icon:AP},{key:"cultivation",label:"修行",icon:SC}],l=[{key:"progress",label:"按进度"},{key:"stage",label:"按阶段"},{key:"experience",label:"按经验"},{key:"name",label:"按名称"}],c=e=>{const t={剑:"combat",刀:"combat",拳:"combat",枪:"combat",戟:"combat",金:"nature",木:"nature",水:"nature",火:"nature",土:"nature",风:"nature",雷:"nature",冰:"nature",雪:"nature",因果:"concept",轮回:"concept",时间:"concept",空间:"concept",命运:"concept",丹:"cultivation",炼器:"cultivation",阵:"cultivation",符:"cultivation"};for(const[n,a]of Object.entries(t))if(e.includes(n))return a;return"other"},d=e=>e>=1e4?(e/1e4).toFixed(1)+"万":e>=1e3?(e/1e3).toFixed(1)+"k":e.toString(),u=(0,r.computed)(()=>t.thousandDao||{大道列表:{}}),m=(0,r.computed)(()=>Object.entries(u.value.大道列表).filter(([e,t])=>t.是否解锁).map(([e])=>e)),p=(0,r.computed)(()=>m.value.length),g=(0,r.computed)(()=>"all"===o.value?m.value:m.value.filter(e=>c(e)===o.value)),h=(0,r.computed)(()=>{const e=[...g.value];switch(i.value){case"progress":return e.sort((e,t)=>k(t)-k(e));case"stage":return e.sort((e,t)=>{const n=b(e)?.当前阶段??0;return(b(t)?.当前阶段??0)-n});case"experience":return e.sort((e,t)=>{const n=b(e)?.总经验??0;return(b(t)?.总经验??0)-n});case"name":return e.sort((e,t)=>e.localeCompare(t,"zh-CN"));default:return e}}),f=(0,r.computed)(()=>a.value&&u.value.大道列表[a.value]||null),v=(0,r.computed)(()=>Object.values(u.value.大道列表).reduce((e,t)=>e+(t.总经验??0),0)),b=e=>u.value.大道列表[e]||null,y=e=>{const t=b(e);if(!t)return"stage-0";const n=t.当前阶段??0;return n>=5?"stage-max":n>=3?"stage-high":n>=1?"stage-mid":"stage-low"},x=e=>{const t=b(e);if(!t)return"未悟";const n=t.当前阶段??0;return t.阶段列表?.[n]?.名称||`第${n}阶`},k=e=>{const t=b(e);if(!t)return 0;const n=t.当前经验??0,a=w(e);return Math.min(100,Math.round(n/a*100))},w=e=>{const t=b(e);if(!t)return 100;const n=t.当前阶段??0;return t.阶段列表?.[n]?.突破经验??100*(n+1)},E=e=>{const t=b(e);if(!t)return 0;const n=t.当前阶段??0;return Math.max(30,90-10*n)},N=e=>{const t=b(e);return!!t&&(t.当前经验??0)>=w(e)},S=e=>{n.addAction({type:"comprehend",itemName:e,itemType:"大道",description:`感悟《${e}》`}),X.o.success(`开始感悟《${e}》`)},V=e=>{n.addAction({type:"meditate",itemName:e,itemType:"参悟",description:`深度参悟《${e}》`}),X.o.info(`进入《${e}》参悟状态`)},_=e=>{n.addAction({type:"dao_breakthrough",itemName:e,itemType:"突破",description:`尝试突破《${e}》境界`}),X.o.warning(`尝试突破《${e}》`)},C=()=>{n.addAction({type:"explore",itemName:"大道",itemType:"探索",description:"探索未知大道，寻求新的感悟"}),X.o.info("开始探索新的大道...")},A=()=>{n.addAction({type:"meditate",itemName:"天地",itemType:"冥想",description:"静心冥想，感悟天地法则"}),X.o.info("进入冥想状态...")},D=()=>{n.addAction({type:"comprehend",itemName:"功法",itemType:"领悟",description:"从已修炼的功法中领悟大道"}),X.o.info("尝试从功法中领悟大道...")},T=()=>{n.addAction({type:"comprehend",itemName:"天地",itemType:"悟道",description:"观察天地自然，感悟大道法则"}),X.o.info("开始观天地悟道...")};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Uq,[(0,r.createCommentVNode)(" 顶部统计卡片 "),(0,r.createElementVNode)("div",qq,[(0,r.createElementVNode)("div",Gq,[(0,r.createElementVNode)("div",Hq,[(0,r.createVNode)((0,r.unref)(Kp),{size:20})]),(0,r.createElementVNode)("div",Yq,[(0,r.createElementVNode)("span",Wq,(0,r.toDisplayString)(p.value),1),t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"stats-label"},"已悟大道",-1))])]),(0,r.createElementVNode)("div",Xq,[(0,r.createElementVNode)("div",Jq,[(0,r.createVNode)((0,r.unref)(bu),{size:20})]),(0,r.createElementVNode)("div",Kq,[(0,r.createElementVNode)("span",Zq,(0,r.toDisplayString)(d(v.value)),1),t[7]||(t[7]=(0,r.createElementVNode)("span",{class:"stats-label"},"总悟道值",-1))])]),(0,r.createElementVNode)("div",Qq,[(0,r.createElementVNode)("button",{class:"action-btn-icon",onClick:C,title:"探索新道"},[(0,r.createVNode)((0,r.unref)(Oq),{size:18})]),(0,r.createElementVNode)("button",{class:"action-btn-icon",onClick:A,title:"冥想感悟"},[(0,r.createVNode)((0,r.unref)(jj),{size:18})])])]),(0,r.createCommentVNode)(" 筛选和排序栏 "),p.value>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",eG,[(0,r.createElementVNode)("div",tG,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s,e=>{return(0,r.createElementVNode)("button",{key:e.key,class:(0,r.normalizeClass)(["filter-tag",{active:o.value===e.key}]),onClick:t=>o.value=e.key},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:14})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.label),1),(0,r.createElementVNode)("span",aG,(0,r.toDisplayString)((t=e.key,"all"===t?m.value.length:m.value.filter(e=>c(e)===t).length)),1)],10,nG);var t}),64))]),(0,r.createElementVNode)("div",rG,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"sort-select"},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l,e=>(0,r.createElementVNode)("option",{key:e.key,value:e.key},(0,r.toDisplayString)(e.label),9,oG)),64))],512),[[r.vModelSelect,i.value]])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 主内容区 "),(0,r.createElementVNode)("div",iG,[(0,r.createCommentVNode)(" 无大道时的快速入门 "),0===p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",sG,[(0,r.createElementVNode)("div",lG,[(0,r.createElementVNode)("div",cG,[(0,r.createVNode)((0,r.unref)(Kp),{size:48})]),t[8]||(t[8]=(0,r.createElementVNode)("div",{class:"empty-rings"},[(0,r.createElementVNode)("div",{class:"ring ring-1"}),(0,r.createElementVNode)("div",{class:"ring ring-2"}),(0,r.createElementVNode)("div",{class:"ring ring-3"})],-1))]),t[11]||(t[11]=(0,r.createElementVNode)("h3",{class:"empty-title"},"尚未领悟任何大道",-1)),t[12]||(t[12]=(0,r.createElementVNode)("p",{class:"empty-desc"},"天地法则蕴含无穷奥秘，静心感悟方能窥见一二",-1)),(0,r.createElementVNode)("div",dG,[(0,r.createElementVNode)("button",{class:"action-btn primary",onClick:D},[(0,r.createVNode)((0,r.unref)(vu.A),{size:16}),t[9]||(t[9]=(0,r.createTextVNode)(" 从功法领悟 ",-1))]),(0,r.createElementVNode)("button",{class:"action-btn secondary",onClick:T},[(0,r.createVNode)((0,r.unref)(Kp),{size:16}),t[10]||(t[10]=(0,r.createTextVNode)(" 观天地悟道 ",-1))])])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" 大道列表 "),(0,r.createElementVNode)("div",uG,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(h.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:(0,r.normalizeClass)(["dao-card",{active:a.value===e}]),onClick:t=>(e=>{a.value=a.value===e?null:e})(e)},[(0,r.createElementVNode)("div",pG,[(0,r.createElementVNode)("div",gG,[(0,r.createVNode)((0,r.unref)(Kp),{size:18})]),(0,r.createElementVNode)("div",hG,[(0,r.createElementVNode)("span",fG,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["dao-stage-badge",y(e)])},(0,r.toDisplayString)(x(e)),3)])]),(0,r.createElementVNode)("div",vG,[(0,r.createElementVNode)("div",bG,[(0,r.createElementVNode)("div",yG,[(0,r.createElementVNode)("div",{class:"dao-progress-fill",style:(0,r.normalizeStyle)({width:k(e)+"%"})},null,4),t[13]||(t[13]=(0,r.createElementVNode)("div",{class:"dao-progress-glow"},null,-1))]),(0,r.createElementVNode)("span",xG,(0,r.toDisplayString)(k(e))+"%",1)]),(0,r.createElementVNode)("div",kG,[(0,r.createElementVNode)("span",wG,(0,r.toDisplayString)(d(b(e)?.当前经验??0)),1),t[14]||(t[14]=(0,r.createElementVNode)("span",{class:"exp-divider"},"/",-1)),(0,r.createElementVNode)("span",EG,(0,r.toDisplayString)(d(w(e))),1)])]),(0,r.createCommentVNode)(" 快捷操作 "),(0,r.createElementVNode)("div",{class:"dao-card-actions",onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("button",{class:"dao-action-btn cultivate",onClick:t=>S(e),title:"感悟"},[(0,r.createVNode)((0,r.unref)(bu),{size:14})],8,NG),(0,r.createElementVNode)("button",{class:"dao-action-btn meditate",onClick:t=>V(e),title:"参悟"},[(0,r.createVNode)((0,r.unref)(jj),{size:14})],8,SG),N(e)?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"dao-action-btn breakthrough",onClick:t=>_(e),title:"突破"},[(0,r.createVNode)((0,r.unref)(Uj),{size:14})],8,VG)):(0,r.createCommentVNode)("v-if",!0)])],10,mG))),128))])],2112)),(0,r.createCommentVNode)(" 选中大道的详情面板 "),a.value&&f.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",_G,[(0,r.createElementVNode)("div",CG,[(0,r.createElementVNode)("div",AG,[(0,r.createElementVNode)("div",DG,[(0,r.createVNode)((0,r.unref)(Kp),{size:24})]),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("h3",TG,(0,r.toDisplayString)(a.value),1),(0,r.createElementVNode)("span",BG,(0,r.toDisplayString)(x(a.value)),1)])]),(0,r.createElementVNode)("button",{class:"close-btn",onClick:t[2]||(t[2]=e=>a.value=null)},[t[15]||(t[15]=(0,r.createElementVNode)("span",null,"关闭",-1)),(0,r.createVNode)((0,r.unref)(Iu.A),{size:16})])]),(0,r.createElementVNode)("div",IG,[(0,r.createCommentVNode)(" 核心数据卡片 "),(0,r.createElementVNode)("div",zG,[(0,r.createElementVNode)("div",MG,[(0,r.createElementVNode)("div",PG,[(0,r.createVNode)((0,r.unref)(Lq),{size:16})]),(0,r.createElementVNode)("div",RG,[(0,r.createElementVNode)("span",$G,(0,r.toDisplayString)(x(a.value)),1),t[16]||(t[16]=(0,r.createElementVNode)("span",{class:"stat-card-label"},"当前阶段",-1))])]),(0,r.createElementVNode)("div",OG,[(0,r.createElementVNode)("div",LG,[(0,r.createVNode)((0,r.unref)(bu),{size:16})]),(0,r.createElementVNode)("div",FG,[(0,r.createElementVNode)("span",jG,(0,r.toDisplayString)(d(f.value.当前经验??0)),1),t[17]||(t[17]=(0,r.createElementVNode)("span",{class:"stat-card-label"},"当前经验",-1))])]),(0,r.createElementVNode)("div",UG,[(0,r.createElementVNode)("div",qG,[(0,r.createVNode)((0,r.unref)(Fq),{size:16})]),(0,r.createElementVNode)("div",GG,[(0,r.createElementVNode)("span",HG,(0,r.toDisplayString)(d(w(a.value))),1),t[18]||(t[18]=(0,r.createElementVNode)("span",{class:"stat-card-label"},"突破所需",-1))])]),(0,r.createElementVNode)("div",YG,[(0,r.createElementVNode)("div",WG,[(0,r.createVNode)((0,r.unref)(Uj),{size:16})]),(0,r.createElementVNode)("div",XG,[(0,r.createElementVNode)("span",JG,(0,r.toDisplayString)(k(a.value))+"%",1),t[19]||(t[19]=(0,r.createElementVNode)("span",{class:"stat-card-label"},"进度",-1))])])]),(0,r.createCommentVNode)(" 阶段进度轨道 "),b(a.value)?.阶段列表?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",KG,[t[20]||(t[20]=(0,r.createElementVNode)("h4",{class:"section-title"},"修炼阶段",-1)),(0,r.createElementVNode)("div",ZG,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(b(a.value)?.阶段列表,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:(0,r.normalizeClass)(["stage-node",{done:t<(f.value?.当前阶段??0),current:t===(f.value?.当前阶段??0),locked:t>(f.value?.当前阶段??0)}])},[(0,r.createElementVNode)("div",QG,[t<(f.value?.当前阶段??0)?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(jq),{key:0,size:12})):((0,r.openBlock)(),(0,r.createElementBlock)("span",eH,(0,r.toDisplayString)(t+1),1))]),(0,r.createElementVNode)("div",tH,[(0,r.createElementVNode)("span",nH,(0,r.toDisplayString)(e.名称),1),(0,r.createElementVNode)("span",aH,(0,r.toDisplayString)(e.描述),1)])],2))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 突破指引 "),N(a.value)?((0,r.openBlock)(),(0,r.createElementBlock)("div",rH,[(0,r.createElementVNode)("div",oH,[(0,r.createVNode)((0,r.unref)(Uj),{size:16}),t[21]||(t[21]=(0,r.createElementVNode)("span",null,"突破指引",-1))]),(0,r.createElementVNode)("div",iH,[t[23]||(t[23]=(0,r.createElementVNode)("p",{class:"guide-desc"},"当前悟道值已达到突破要求，可尝试突破至下一阶段",-1)),t[24]||(t[24]=(0,r.createElementVNode)("ul",{class:"guide-tips"},[(0,r.createElementVNode)("li",null,"确保状态良好，无负面效果干扰"),(0,r.createElementVNode)("li",null,"选择灵气充沛之地进行突破"),(0,r.createElementVNode)("li",null,"准备护道丹药以防万一")],-1)),(0,r.createElementVNode)("div",sH,[t[22]||(t[22]=(0,r.createElementVNode)("span",{class:"chance-label"},"预估成功率:",-1)),(0,r.createElementVNode)("span",lH,(0,r.toDisplayString)(E(a.value))+"%",1)])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 操作按钮 "),(0,r.createElementVNode)("div",cH,[(0,r.createElementVNode)("button",{class:"action-btn primary large",onClick:t[3]||(t[3]=e=>S(a.value))},[(0,r.createVNode)((0,r.unref)(bu),{size:18}),t[25]||(t[25]=(0,r.createTextVNode)(" 感悟此道 ",-1))]),(0,r.createElementVNode)("button",{class:"action-btn secondary large",onClick:t[4]||(t[4]=e=>V(a.value))},[(0,r.createVNode)((0,r.unref)(jj),{size:18}),t[26]||(t[26]=(0,r.createTextVNode)(" 深度参悟 ",-1))]),N(a.value)?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"action-btn warning large",onClick:t[5]||(t[5]=e=>_(a.value))},[(0,r.createVNode)((0,r.unref)(Uj),{size:18}),t[27]||(t[27]=(0,r.createTextVNode)(" 尝试突破 ",-1))])):(0,r.createCommentVNode)("v-if",!0)])])])):(0,r.createCommentVNode)("v-if",!0)])]))}});var uH=n(7426),mH={};mH.styleTagTransform=k(),mH.setAttributes=v(),mH.insert=h().bind(null,"head"),mH.domAPI=p(),mH.insertStyleElement=y(),u()(uH.A,mH),uH.A&&uH.A.locals&&uH.A.locals;const pH=(0,N.A)(dH,[["__scopeId","data-v-31dbed5e"]]);var gH=n(6896),hH=n(6680);const fH=(0,V.A)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),vH={class:"save-panel"},bH={class:"saves-container"},yH={key:0,class:"current-save-section"},xH={class:"section-header"},kH={class:"section-title"},wH={class:"current-save-card"},EH={class:"save-preview"},NH={class:"preview-avatar"},SH={class:"preview-info"},VH={class:"character-name"},_H={class:"character-details"},CH={class:"detail-item"},AH={class:"detail-item"},DH={key:0,class:"current-save-hint last"},TH={key:1,class:"current-save-hint time"},BH={class:"save-stats"},IH={class:"stat-item"},zH={class:"stat-label"},MH={class:"stat-value"},PH={class:"stat-item"},RH={class:"stat-label"},$H={class:"stat-value"},OH={class:"saves-section"},LH={class:"section-header"},FH={class:"header-actions"},jH=["disabled"],UH={key:1,class:"saves-count"},qH={key:2,class:"saves-count online-badge"},GH={key:0,class:"loading-state"},HH={class:"loading-spinner"},YH={class:"loading-text"},WH={key:1,class:"empty-state"},XH={class:"empty-icon"},JH={class:"empty-text"},KH={class:"empty-hint"},ZH={key:2,class:"saves-list"},QH=["onClick"],eY={class:"card-header"},tY={class:"save-preview small"},nY={class:"preview-avatar small"},aY={class:"preview-info"},rY={class:"save-name"},oY={class:"character-name-small"},iY={class:"save-time"},sY={class:"card-actions"},lY=["onClick","disabled"],cY=["onClick","disabled"],dY=["onClick","disabled"],uY=["onClick","disabled"],mY=["onClick","disabled","title"],pY={class:"card-content"},gY={class:"save-details"},hY={class:"detail-row"},fY={class:"detail-value"},vY={class:"detail-row"},bY={class:"detail-value"},yY={class:"detail-row"},xY={class:"detail-value"},kY={key:1,class:"auto-save-settings-section"},wY={class:"section-header"},EY={class:"section-title"},NY={class:"settings-list"},SY={class:"setting-item"},VY={class:"setting-info"},_Y={class:"setting-name"},CY={class:"setting-control"},AY={class:"setting-switch"},DY={class:"setting-item"},TY={class:"setting-info"},BY={class:"setting-name"},IY={class:"setting-control"},zY={class:"setting-switch"},MY={key:0,class:"setting-item"},PY={class:"setting-info"},RY={class:"setting-name"},$Y={class:"setting-control"},OY={class:"operations-section"},LY={class:"section-header"},FY={class:"section-title"},jY={class:"operations-list"},UY=["disabled"],qY=["disabled"],GY={class:"btn-content"},HY={class:"btn-desc"},YY=["disabled"],WY={class:"btn-content"},XY={class:"btn-desc"},JY=["disabled"],KY={class:"btn-content"},ZY={class:"btn-title"},QY={class:"btn-desc"},eW=(0,r.defineComponent)({__name:"SavePanel",setup(e){const{t}=(0,K.s)(),a=(0,Jc.useCharacterStore)(),o=(0,pu.useGameStateStore)(),i=(0,r.ref)(!1),s=(0,r.ref)(),l=(0,r.computed)(()=>"联机"===a.activeCharacterProfile?.模式),c=(0,r.computed)({get:()=>o.conversationAutoSaveEnabled,set:e=>{o.setConversationAutoSaveEnabled(e),X.o.info("对话前自动备份已"+(e?"开启":"关闭"))}}),d=(0,r.computed)({get:()=>o.timeBasedSaveEnabled,set:e=>{o.setTimeBasedSaveEnabled(e),e?X.o.success(`时间点存档已启用，间隔${u.value}分钟`):X.o.info("时间点存档已禁用")}}),u=(0,r.computed)({get:()=>o.timeBasedSaveInterval,set:e=>{o.setTimeBasedSaveInterval(e),X.o.success(`存档间隔已设置为${e}分钟`)}}),m=(0,r.computed)(()=>a.saveSlots.filter(e=>!!e&&(e.存档名||e.id))),p=(0,r.computed)(()=>a.activeSaveSlot),g=(0,r.computed)(()=>null!==a.activeCharacterProfile||null!==o.character&&void 0!==o.character),h=(0,r.computed)(()=>{const e=new Set([p.value?.存档名,"上次对话","时间点存档"]);return m.value.filter(t=>!e.has(t.存档名)).length}),f=e=>"上次对话"===e.存档名||"时间点存档"===e.存档名||e.id===p.value?.id||h.value<=1,v=e=>"上次对话"===e.存档名?"上次对话存档不可删除（用于重roll）":"时间点存档"===e.存档名?"时间点存档不可删除（定时自动覆盖）":e.id===p.value?.id?"当前激活存档不可删除":h.value<=1?"最后一个普通存档不可删除":"删除存档",b=async()=>{i.value=!0;try{await a.loadSaves()}catch(e){nV.Yz.error("存档面板","刷新失败",e),X.o.error("刷新存档列表失败")}finally{i.value=!1}},y=async()=>{if(!g.value)return void X.o.warning("当前没有可存档的游戏状态");const e=window.prompt("请输入新存档的名称：",`存档_${(new Date).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})}`);if(e&&""!==e.trim()){i.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),await a.saveAsNewSlot(e.trim())&&await b()}catch(e){nV.Yz.error("存档面板","新建存档失败",e),X.o.error("新建存档失败")}finally{i.value=!1}}else X.o.info("已取消新建存档")},x=(0,A.useUIStore)(),k=async()=>{try{console.log("[角色导出] 开始导出角色...");const e=a.rootState.当前激活存档?.角色ID;if(!e)return void X.o.error("无法获取角色ID");const t=a.activeCharacterProfile;if(!t)return void X.o.error("无法获取角色信息");const{loadSaveData:r}=await Promise.resolve().then(n.bind(n,5099)),o=await Promise.all(m.value.filter(e=>"上次对话"!==e.存档名).map(async t=>{const n=t.id||t.存档名,a=await r(e,n);return{...t,存档数据:a}})),i=o.map(e=>{const t=e.存档数据;if(!t)throw new Error(`存档「${e.存档名}」缺少存档数据，无法导出`);const n=(0,Zc.ru)(t)?t:(0,Zc.jj)(t).migrated,a=(0,Qc.$)(n);if(!a.isValid)throw new Error(`存档「${e.存档名}」校验失败：${a.errors[0]||"未知原因"}`);return{...e,存档数据:n}}),s=(0,Kc.q3)("character",{角色ID:e,角色信息:JSON.parse(JSON.stringify(t)),存档列表:i}),l=JSON.stringify(s,null,2),c=new Blob([l],{type:"application/json"});console.log("[角色导出] 数据大小:",(l.length/1024).toFixed(2),"KB");const d=document.createElement("a");d.href=URL.createObjectURL(c);const u=t.角色?.名字||"未命名角色",p=`超凡新生-角色-${u}-${(new Date).toISOString().split("T")[0]}.json`;d.download=p,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(d.href)},100),console.log("[角色导出] 导出成功，文件名:",p),X.o.success(`已导出角色: ${u} (含 ${o.length} 个存档)`)}catch(e){console.error("[角色导出] 导出失败:",e),X.o.error(`导出角色失败: ${e instanceof Error?e.message:"未知错误"}`)}},w=async()=>{try{if(console.log("[存档导出] 开始导出存档..."),console.log("[存档导出] savesList.value:",m.value),console.log("[存档导出] savesList 数量:",m.value.length),!m.value||0===m.value.length)return X.o.warning("没有可导出的存档"),void console.warn("[存档导出] 没有可导出的存档");const e=a.rootState.当前激活存档?.角色ID;if(!e)return void X.o.error("无法获取角色ID");const{loadSaveData:t}=await Promise.resolve().then(n.bind(n,5099)),r=(await Promise.all(m.value.map(async n=>{const a=await t(e,n.存档名);return{...n,存档数据:a}}))).map(e=>{const t=e.存档数据,n=(0,Zc.ru)(t)?t:(0,Zc.jj)(t).migrated,a=(0,Qc.$)(n);if(!a.isValid)throw new Error(`存档「${e.存档名}」校验失败：${a.errors[0]||"未知原因"}`);return{...e,存档数据:n}}),o=(0,Kc.q3)("saves",{characterId:e,characterName:a.activeCharacterProfile?.角色?.名字,saves:r});console.log("[存档导出] 导出数据:",o);const i=JSON.stringify(o,null,2),s=new Blob([i],{type:"application/json"});console.log("[存档导出] 数据大小:",(i.length/1024).toFixed(2),"KB");const l=document.createElement("a");l.href=URL.createObjectURL(s);const c=`超凡新生-存档备份-${(new Date).toISOString().split("T")[0]}.json`;l.download=c,document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(l.href)},100),console.log("[存档导出] 导出成功，文件名:",c),X.o.success(`已导出 ${m.value.length} 个存档`)}catch(e){console.error("[存档导出] 导出失败:",e),nV.Yz.error("存档面板","导出失败",e),X.o.error(`导出存档失败: ${e instanceof Error?e.message:"未知错误"}`)}},E=()=>{s.value?.click()},N=async e=>{const t=e.target.files?.[0];if(t){i.value=!0;try{const e=await t.text(),n=JSON.parse(e),r=(0,Kc.ZT)(n);if("saves"!==r.type||!Array.isArray(r.payload?.saves))throw new Error("无效的存档文件格式，请使用本游戏导出的存档文件");const o=r.payload.saves;if(0===o.length)throw new Error("文件中没有找到有效的存档数据");const i=a.rootState.当前激活存档?.角色ID;if(!i)throw new Error("无法导入存档，当前没有激活的角色");for(const e of o)await a.importSave(i,e);await b(),X.o.success(`成功导入 ${o.length} 个存档`)}catch(e){nV.Yz.error("存档面板","导入失败",e),X.o.error("导入存档失败: "+e.message)}finally{i.value=!1,s.value&&(s.value.value="")}}},S=async()=>{x.showRetryDialog({title:"清空所有存档",message:"确定要删除所有存档吗？此操作不可撤销！",confirmText:"继续",cancelText:"取消",onConfirm:()=>{x.showRetryDialog({title:"再次确认",message:"再次确认：这将永久删除所有存档数据！",confirmText:"确认清空",cancelText:"取消",onConfirm:async()=>{i.value=!0;try{await a.clearAllSaves(),X.o.success("所有存档已清空")}catch(e){nV.Yz.error("存档面板","清空失败",e),X.o.error("清空存档失败")}finally{i.value=!1}},onCancel:()=>{}})},onCancel:()=>{}})},V=e=>{if(!e)return"未知";const t=new Date(e);if(isNaN(t.getTime()))return"未知";const n=(new Date).getTime()-t.getTime();return n<6e4?"刚刚":n<36e5?`${Math.floor(n/6e4)}分钟前`:n<864e5?`${Math.floor(n/36e5)}小时前`:t.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return(0,r.onMounted)(()=>{b(),zu.on("refresh",()=>b()),zu.on("save",()=>(async()=>{if(g.value){i.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),X.o.success("快速存档完成")}catch(e){nV.Yz.error("存档面板","快速存档失败",e),X.o.error("快速存档失败")}finally{i.value=!1}}else X.o.warning("当前没有可存档的游戏状态")})())}),(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",vH,[(0,r.createCommentVNode)(" 存档容器 "),(0,r.createElementVNode)("div",bH,[(0,r.createCommentVNode)(" 当前存档状态 "),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",yH,[(0,r.createElementVNode)("div",xH,[(0,r.createElementVNode)("h4",kH,["上次对话"===p.value.存档名?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(C),{key:0,size:16,class:"last-save-icon"})):"时间点存档"===p.value.存档名?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(cm),{key:1,size:16,class:"time-save-icon"})):(0,r.createCommentVNode)("v-if",!0),(0,r.createTextVNode)(" 当前进度 - "+(0,r.toDisplayString)(p.value.存档名),1)])]),(0,r.createElementVNode)("div",wH,[(0,r.createElementVNode)("div",EH,[(0,r.createElementVNode)("div",NH,(0,r.toDisplayString)(p.value.角色名字?.[0]||"道"),1),(0,r.createElementVNode)("div",SH,[(0,r.createElementVNode)("div",VH,(0,r.toDisplayString)(p.value.角色名字||"无名道友"),1),(0,r.createElementVNode)("div",_H,[(0,r.createElementVNode)("span",CH,(0,r.toDisplayString)(p.value.境界||"凡人"),1),o[3]||(o[3]=(0,r.createElementVNode)("span",{class:"detail-separator"},"·",-1)),(0,r.createElementVNode)("span",AH,(0,r.toDisplayString)(p.value.位置||"未知"),1)]),(0,r.createCommentVNode)(" 特殊存档说明 "),"上次对话"===p.value.存档名?((0,r.openBlock)(),(0,r.createElementBlock)("div",DH," 每次对话前自动备份，可用于回退到上次对话前的状态 ")):"时间点存档"===p.value.存档名?((0,r.openBlock)(),(0,r.createElementBlock)("div",TH," 按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失 ")):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createElementVNode)("div",BH,[(0,r.createElementVNode)("div",IH,[(0,r.createElementVNode)("span",zH,(0,r.toDisplayString)((0,r.unref)(t)("创建时间")),1),(0,r.createElementVNode)("span",MH,(0,r.toDisplayString)(V(p.value.保存时间||"")),1)]),(0,r.createElementVNode)("div",PH,[(0,r.createElementVNode)("span",RH,(0,r.toDisplayString)((0,r.unref)(t)("最后保存")),1),(0,r.createElementVNode)("span",$H,(0,r.toDisplayString)(V(p.value.最后保存时间??p.value.保存时间??"")),1)])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 存档列表 "),(0,r.createElementVNode)("div",OH,[(0,r.createElementVNode)("div",LH,[o[4]||(o[4]=(0,r.createElementVNode)("h4",{class:"section-title"},"存档列表",-1)),(0,r.createElementVNode)("div",FH,[l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"new-save-btn",onClick:y,disabled:i.value,title:"新建存档"},[(0,r.createVNode)((0,r.unref)(hH.A),{size:16})],8,jH)),l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",qH,"☁️ 云端存档")):((0,r.openBlock)(),(0,r.createElementBlock)("div",UH,(0,r.toDisplayString)(m.value.length)+"/10",1))])]),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",GH,[(0,r.createElementVNode)("div",HH,[(0,r.createVNode)((0,r.unref)(Au.A),{size:18,class:"animate-spin"})]),(0,r.createElementVNode)("div",YH,(0,r.toDisplayString)((0,r.unref)(t)("正在加载存档...")),1)])):0===m.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",WH,[(0,r.createElementVNode)("div",XH,[(0,r.createVNode)((0,r.unref)(xu.A),{size:32})]),(0,r.createElementVNode)("div",JH,(0,r.toDisplayString)((0,r.unref)(t)("修仙路上尚未留存，创建存档记录道途")),1),(0,r.createElementVNode)("div",KH,(0,r.toDisplayString)((0,r.unref)(t)("开始游戏后可以创建存档")),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",ZH,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:(0,r.normalizeClass)(["save-card",{active:e.id===p.value?.id}]),onClick:t=>(e=>{nV.Yz.log("存档面板","选择存档",e)})(e)},[(0,r.createElementVNode)("div",eY,[(0,r.createElementVNode)("div",tY,[(0,r.createElementVNode)("div",nY,(0,r.toDisplayString)(e.角色名字?.[0]||"道"),1),(0,r.createElementVNode)("div",aY,[(0,r.createElementVNode)("div",rY,["上次对话"===e.存档名?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(C),{key:0,size:14,class:"last-save-icon"})):"时间点存档"===e.存档名?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(cm),{key:1,size:14,class:"time-save-icon"})):(0,r.createCommentVNode)("v-if",!0),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.存档名||e.id||`存档${t+1}`),1)]),(0,r.createElementVNode)("div",oY,(0,r.toDisplayString)(e.角色名字||"无名道友"),1),(0,r.createCommentVNode)(" 显示最后保存时间 "),(0,r.createElementVNode)("div",iY,(0,r.toDisplayString)(V(e.最后保存时间??e.保存时间??null)),1)])]),(0,r.createElementVNode)("div",sY,[e.id!==p.value?.id&&"上次对话"!==e.存档名&&"时间点存档"!==e.存档名?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"card-btn",onClick:(0,r.withModifiers)(t=>(async e=>{if(e){i.value=!0;try{await a.loadGameById(e.存档名),X.o.success(`已加载存档: ${e.存档名}`)}catch(e){nV.Yz.error("存档面板","加载失败",e),X.o.error("加载存档失败")}finally{i.value=!1}}})(e),["stop"]),disabled:i.value,title:"读取存档"},[(0,r.createVNode)((0,r.unref)(fH),{size:14})],8,lY)):(0,r.createCommentVNode)("v-if",!0),"上次对话"!==e.存档名||l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"card-btn warning",onClick:(0,r.withModifiers)(t=>(async e=>{if(!p.value)return void X.o.warning("没有当前激活的存档");const{useUIStore:t}=await Promise.resolve().then(n.bind(n,9173));t().showRetryDialog({title:"回滚到上次对话",message:`确定要将"${e.存档名}"的数据覆盖到当前存档"${p.value.存档名}"吗？当前进度将被替换为上次对话前的状态。`,confirmText:"确认回滚",cancelText:"取消",onConfirm:async()=>{i.value=!0;try{await a.rollbackToLastConversation(),X.o.success("已回滚到上次对话前的状态"),await b()}catch(e){nV.Yz.error("存档面板","回滚失败",e),X.o.error(`回滚失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{i.value=!1}},onCancel:()=>{}})})(e),["stop"]),disabled:i.value||!p.value,title:"用上次对话的数据覆盖当前存档（回滚）"},[(0,r.createVNode)((0,r.unref)(Au.A),{size:14})],8,cY)),(0,r.createElementVNode)("button",{class:"card-btn info",onClick:(0,r.withModifiers)(t=>(async e=>{try{console.log("[单个存档导出] 开始导出存档:",e.存档名);const t=a.rootState.当前激活存档?.角色ID;if(!t)return void X.o.error("无法获取角色ID");const{loadSaveData:r}=await Promise.resolve().then(n.bind(n,5099)),o=e.id||e.存档名,i=await r(t,o);if(!i)return void X.o.error("无法加载存档数据");const s=(0,Zc.ru)(i)?i:(0,Zc.jj)(i).migrated,l=(0,Qc.$)(s);if(!l.isValid)throw new Error(l.errors[0]||"存档结构校验失败");const c=(0,Kc.q3)("saves",{characterId:t,characterName:a.activeCharacterProfile?.角色?.名字,saves:[{...e,存档数据:s}]}),d=JSON.stringify(c,null,2),u=new Blob([d],{type:"application/json"}),m=document.createElement("a");m.href=URL.createObjectURL(u);const p=`超凡新生-${e.存档名}-${(new Date).toISOString().split("T")[0]}.json`;m.download=p,document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.removeChild(m),URL.revokeObjectURL(m.href)},100),console.log("[单个存档导出] 导出成功，文件名:",p),X.o.success(`已导出存档: ${e.存档名}`)}catch(e){console.error("[单个存档导出] 导出失败:",e),X.o.error(`导出存档失败: ${e instanceof Error?e.message:"未知错误"}`)}})(e),["stop"]),disabled:i.value,title:"导出此存档"},[(0,r.createVNode)((0,r.unref)(Jh.A),{size:14})],8,dY),"上次对话"!==e.存档名&&"时间点存档"!==e.存档名?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:2,class:"card-btn primary",onClick:(0,r.withModifiers)(t=>(async e=>{g.value?x.showRetryDialog({title:"覆盖存档",message:`确定要用当前游戏进度覆盖存档"${e.存档名}"吗？原存档数据将丢失。`,confirmText:"确认覆盖",cancelText:"取消",onConfirm:async()=>{i.value=!0;try{await a.saveCurrentGame({notifyIfNoActive:!0}),await a.saveToSlot(e.存档名),X.o.success(`已覆盖存档: ${e.存档名}`),await b()}catch(e){nV.Yz.error("存档面板","覆盖存档失败",e),X.o.error("覆盖存档失败")}finally{i.value=!1}},onCancel:()=>{}}):X.o.warning("当前没有可存档的游戏状态")})(e),["stop"]),disabled:i.value||!p.value,title:"用当前进度覆盖此存档"},[(0,r.createVNode)((0,r.unref)(xu.A),{size:14})],8,uY)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("button",{class:"card-btn danger",onClick:(0,r.withModifiers)(t=>(async e=>{x.showRetryDialog({title:"删除存档",message:`确定要删除存档"${e.存档名||"存档"}"吗？此操作不可撤销。`,confirmText:"确认删除",cancelText:"取消",onConfirm:async()=>{i.value=!0;try{await a.deleteSaveById(e.存档名),X.o.success("存档已删除"),await b()}catch(e){nV.Yz.error("存档面板","删除失败",e),X.o.error("删除存档失败")}finally{i.value=!1}},onCancel:()=>{}})})(e),["stop"]),disabled:i.value||f(e),title:v(e)},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:14})],8,mY)])]),(0,r.createElementVNode)("div",pY,[(0,r.createElementVNode)("div",gY,[(0,r.createElementVNode)("div",hY,[o[5]||(o[5]=(0,r.createElementVNode)("span",{class:"detail-label"},"境界:",-1)),(0,r.createElementVNode)("span",fY,(0,r.toDisplayString)(e.境界||"凡人"),1)]),(0,r.createElementVNode)("div",vY,[o[6]||(o[6]=(0,r.createElementVNode)("span",{class:"detail-label"},"位置:",-1)),(0,r.createElementVNode)("span",bY,(0,r.toDisplayString)(e.位置||"未知"),1)]),(0,r.createElementVNode)("div",yY,[o[7]||(o[7]=(0,r.createElementVNode)("span",{class:"detail-label"},"修改:",-1)),(0,r.createElementVNode)("span",xY,(0,r.toDisplayString)(V(e.最后保存时间??e.保存时间??"")),1)])])])],10,QH))),128))]))]),(0,r.createCommentVNode)(" 自动存档设置 (仅单机模式) "),l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",kY,[(0,r.createElementVNode)("div",wY,[(0,r.createElementVNode)("h4",EY,(0,r.toDisplayString)((0,r.unref)(t)("自动存档设置")),1)]),(0,r.createElementVNode)("div",NY,[(0,r.createElementVNode)("div",SY,[(0,r.createElementVNode)("div",VY,[(0,r.createElementVNode)("label",_Y,(0,r.toDisplayString)((0,r.unref)(t)("对话前自动备份")),1),o[8]||(o[8]=(0,r.createElementVNode)("span",{class:"setting-desc"},"每次对话前自动备份，用于回退到上次对话前的状态",-1))]),(0,r.createElementVNode)("div",CY,[(0,r.createElementVNode)("label",AY,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e)},null,512),[[r.vModelCheckbox,c.value]]),o[9]||(o[9]=(0,r.createElementVNode)("span",{class:"switch-slider"},null,-1))])])]),(0,r.createElementVNode)("div",DY,[(0,r.createElementVNode)("div",TY,[(0,r.createElementVNode)("label",BY,(0,r.toDisplayString)((0,r.unref)(t)("时间点存档")),1),o[10]||(o[10]=(0,r.createElementVNode)("span",{class:"setting-desc"},"按设定时间间隔自动覆盖保存，防止长时间游玩数据丢失",-1))]),(0,r.createElementVNode)("div",IY,[(0,r.createElementVNode)("label",zY,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e)},null,512),[[r.vModelCheckbox,d.value]]),o[11]||(o[11]=(0,r.createElementVNode)("span",{class:"switch-slider"},null,-1))])])]),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",MY,[(0,r.createElementVNode)("div",PY,[(0,r.createElementVNode)("label",RY,(0,r.toDisplayString)((0,r.unref)(t)("存档间隔")),1),o[12]||(o[12]=(0,r.createElementVNode)("span",{class:"setting-desc"},"自动存档的时间间隔（真实时间）",-1))]),(0,r.createElementVNode)("div",$Y,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",min:"1","onUpdate:modelValue":o[2]||(o[2]=e=>u.value=e),class:"interval-input"},null,512),[[r.vModelText,u.value,void 0,{number:!0}]]),o[13]||(o[13]=(0,r.createElementVNode)("span",{class:"unit-label"},"分钟",-1))])])):(0,r.createCommentVNode)("v-if",!0)])])),(0,r.createCommentVNode)(" 存档操作 "),(0,r.createElementVNode)("div",OY,[(0,r.createElementVNode)("div",LY,[(0,r.createElementVNode)("h4",FY,(0,r.toDisplayString)((0,r.unref)(t)("存档操作")),1)]),(0,r.createElementVNode)("div",jY,[(0,r.createElementVNode)("button",{class:"operation-btn",onClick:k,disabled:i.value||!(0,r.unref)(a).activeCharacterProfile},[(0,r.createVNode)((0,r.unref)(Jh.A),{size:16}),o[14]||(o[14]=(0,r.createElementVNode)("div",{class:"btn-content"},[(0,r.createElementVNode)("span",{class:"btn-title"},"导出角色"),(0,r.createElementVNode)("span",{class:"btn-desc"},"导出当前角色及其所有存档")],-1))],8,UY),(0,r.createElementVNode)("button",{class:"operation-btn",onClick:w,disabled:i.value||0===m.value.length},[(0,r.createVNode)((0,r.unref)(Jh.A),{size:16}),(0,r.createElementVNode)("div",GY,[o[15]||(o[15]=(0,r.createElementVNode)("span",{class:"btn-title"},"导出所有存档",-1)),(0,r.createElementVNode)("span",HY,(0,r.toDisplayString)((0,r.unref)(t)("备份所有存档到文件")),1)])],8,qY),l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"operation-btn",onClick:E,disabled:i.value},[(0,r.createVNode)((0,r.unref)(Wh.A),{size:16}),(0,r.createElementVNode)("div",WY,[o[16]||(o[16]=(0,r.createElementVNode)("span",{class:"btn-title"},"导入存档",-1)),(0,r.createElementVNode)("span",XY,(0,r.toDisplayString)((0,r.unref)(t)("从文件恢复存档")),1)])],8,YY)),l.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"operation-btn danger",onClick:S,disabled:i.value||0===m.value.length},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:16}),(0,r.createElementVNode)("div",KY,[(0,r.createElementVNode)("span",ZY,(0,r.toDisplayString)((0,r.unref)(t)("清空存档")),1),(0,r.createElementVNode)("span",QY,(0,r.toDisplayString)((0,r.unref)(t)("删除所有存档数据")),1)])],8,JY))])])]),(0,r.createCommentVNode)(" 隐藏的文件输入 "),(0,r.createElementVNode)("input",{ref_key:"fileInput",ref:s,type:"file",accept:".json",onChange:N,style:{display:"none"}},null,544)]))}});var tW=n(6689),nW={};nW.styleTagTransform=k(),nW.setAttributes=v(),nW.insert=h().bind(null,"head"),nW.domAPI=p(),nW.insertStyleElement=y(),u()(tW.A,nW),tW.A&&tW.A.locals&&tW.A.locals;const aW=(0,N.A)(eW,[["__scopeId","data-v-7497a97e"]]),rW=(0,V.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),oW=(0,V.A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),iW=(0,V.A)("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]]);var sW=n(31),lW=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(lW||{}),cW=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(cW||{}),dW=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(dW||{}),uW=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(uW||{}),mW=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(mW||{}),pW=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(pW||{}),gW=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(gW||{}),hW=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(hW||{}),fW=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(fW||{}),vW=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(vW||{}),bW=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(bW||{}),yW=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(yW||{}),xW=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(xW||{}),kW=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(kW||{}),wW=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(wW||{}),EW=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(EW||{}),NW=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(NW||{}),SW=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(SW||{}),VW=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(VW||{});const _W={createCanvas:(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},CW={ADAPTER:_W,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var AW=/iPhone/i,DW=/iPod/i,TW=/iPad/i,BW=/\biOS-universal(?:.+)Mac\b/i,IW=/\bAndroid(?:.+)Mobile\b/i,zW=/Android/i,MW=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,PW=/Silk/i,RW=/Windows Phone/i,$W=/\bWindows(?:.+)ARM\b/i,OW=/BlackBerry/i,LW=/BB10/i,FW=/Opera Mini/i,jW=/\b(CriOS|Chrome)(?:.+)Mobile/i,UW=/Mobile(?:.+)Firefox\b/i,qW=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function GW(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=t.userAgent,a=n.split("[FBAN");void 0!==a[1]&&(n=a[0]),void 0!==(a=n.split("Twitter"))[1]&&(n=a[0]);var r=function(e){return function(t){return t.test(e)}}(n),o={apple:{phone:r(AW)&&!r(RW),ipod:r(DW),tablet:!r(AW)&&(r(TW)||qW(t))&&!r(RW),universal:r(BW),device:(r(AW)||r(DW)||r(TW)||r(BW)||qW(t))&&!r(RW)},amazon:{phone:r(MW),tablet:!r(MW)&&r(PW),device:r(MW)||r(PW)},android:{phone:!r(RW)&&r(MW)||!r(RW)&&r(IW),tablet:!r(RW)&&!r(MW)&&!r(IW)&&(r(PW)||r(zW)),device:!r(RW)&&(r(MW)||r(PW)||r(IW)||r(zW))||r(/\bokhttp\b/i)},windows:{phone:r(RW),tablet:r($W),device:r(RW)||r($W)},other:{blackberry:r(OW),blackberry10:r(LW),opera:r(FW),firefox:r(UW),chrome:r(jW),device:r(OW)||r(LW)||r(FW)||r(UW)||r(jW)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const HW=(GW.default??GW)(globalThis.navigator);CW.RETINA_PREFIX=/@([0-9\.]+)x/,CW.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var YW=n(228),WW=n(6570);n(8835);const XW={};function JW(e,t,n=3){if(XW[t])return;let a=(new Error).stack;typeof a>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`):(a=a.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${e}`),console.warn(a),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`),console.warn(a))),XW[t]=!0}function KW(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function ZW(e){return e.split("?")[0].split("#")[0]}const QW={toPosix:e=>e.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/"),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){KW(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const n=/^[^/:]+:\/{0,2}/.exec(e);return n?n[0]:""},toAbsolute(e,t,n){if(KW(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const a=ZW(this.toPosix(t??CW.ADAPTER.getBaseUrl())),r=ZW(this.toPosix(n??this.rootname(a)));return(e=this.toPosix(e)).startsWith("/")?QW.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(a,e)},normalize(e){if(KW(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let t="";const n=(e=this.toPosix(e)).startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const a=e.endsWith("/");return e=function(e){let t="",n=0,a=-1,r=0,o=-1;for(let i=0;i<=e.length;++i){if(i<e.length)o=e.charCodeAt(i);else{if(47===o)break;o=47}if(47===o){if(a!==i-1&&1!==r)if(a!==i-1&&2===r){if(t.length<2||2!==n||46!==t.charCodeAt(t.length-1)||46!==t.charCodeAt(t.length-2))if(t.length>2){const e=t.lastIndexOf("/");if(e!==t.length-1){-1===e?(t="",n=0):(t=t.slice(0,e),n=t.length-1-t.lastIndexOf("/")),a=i,r=0;continue}}else if(2===t.length||1===t.length){t="",n=0,a=i,r=0;continue}}else t.length>0?t+=`/${e.slice(a+1,i)}`:t=e.slice(a+1,i),n=i-a-1;a=i,r=0}else 46===o&&-1!==r?++r:r=-1}return t}(e),e.length>0&&a&&(e+="/"),n?`/${e}`:t+e},isAbsolute(e){return KW(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){if(0===e.length)return".";let t;for(let n=0;n<e.length;++n){const a=e[n];if(KW(a),a.length>0)if(void 0===t)t=a;else{const r=e[n-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${a}`:t+=`/${a}`}}return void 0===t?".":this.normalize(t)},dirname(e){if(KW(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0);const n=47===t;let a=-1,r=!0;const o=this.getProtocol(e),i=e;for(let n=(e=e.slice(o.length)).length-1;n>=1;--n)if(t=e.charCodeAt(n),47===t){if(!r){a=n;break}}else r=!1;return-1===a?n?"/":this.isUrl(i)?o+e:o:n&&1===a?"//":o+e.slice(0,a)},rootname(e){KW(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const n=e.indexOf("/",t.length);t=-1!==n?e.slice(0,n):e,t.endsWith("/")||(t+="/")}return t},basename(e,t){KW(e),t&&KW(t),e=ZW(this.toPosix(e));let n,a=0,r=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let i=t.length-1,s=-1;for(n=e.length-1;n>=0;--n){const l=e.charCodeAt(n);if(47===l){if(!o){a=n+1;break}}else-1===s&&(o=!1,s=n+1),i>=0&&(l===t.charCodeAt(i)?-1===--i&&(r=n):(i=-1,r=s))}return a===r?r=s:-1===r&&(r=e.length),e.slice(a,r)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){a=n+1;break}}else-1===r&&(o=!1,r=n+1);return-1===r?"":e.slice(a,r)},extname(e){KW(e);let t=-1,n=0,a=-1,r=!0,o=0;for(let i=(e=ZW(this.toPosix(e))).length-1;i>=0;--i){const s=e.charCodeAt(i);if(47!==s)-1===a&&(r=!1,a=i+1),46===s?-1===t?t=i:1!==o&&(o=1):-1!==t&&(o=-1);else if(!r){n=i+1;break}}return-1===t||-1===a||0===o||1===o&&t===a-1&&t===n+1?"":e.slice(t,a)},parse(e){KW(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;let n=(e=ZW(this.toPosix(e))).charCodeAt(0);const a=this.isAbsolute(e);let r;t.root=this.rootname(e),r=a||this.hasProtocol(e)?1:0;let o=-1,i=0,s=-1,l=!0,c=e.length-1,d=0;for(;c>=r;--c)if(n=e.charCodeAt(c),47!==n)-1===s&&(l=!1,s=c+1),46===n?-1===o?o=c:1!==d&&(d=1):-1!==o&&(d=-1);else if(!l){i=c+1;break}return-1===o||-1===s||0===d||1===d&&o===s-1&&o===i+1?-1!==s&&(t.base=t.name=0===i&&a?e.slice(1,s):e.slice(i,s)):(0===i&&a?(t.name=e.slice(1,o),t.base=e.slice(1,s)):(t.name=e.slice(i,o),t.base=e.slice(i,s)),t.ext=e.slice(o,s)),t.dir=this.dirname(e),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let eX,tX;async function nX(){return eX??(eX=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return xW.UNPACK;const t=await new Promise(e=>{const t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()});if(!t)return xW.UNPACK;const n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(a),e.deleteTexture(n),e.getExtension("WEBGL_lose_context")?.loseContext(),r[0]<=r[3]?xW.PMA:xW.UNPACK})()),eX}var aX={grad:.9,turn:360,rad:360/(2*Math.PI)},rX=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},oX=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},iX=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e>t?e:t},sX=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},lX=function(e){return{r:iX(e.r,0,255),g:iX(e.g,0,255),b:iX(e.b,0,255),a:iX(e.a)}},cX=function(e){return{r:oX(e.r),g:oX(e.g),b:oX(e.b),a:oX(e.a,3)}},dX=/^#([0-9a-f]{3,8})$/i,uX=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},mX=function(e){var t=e.r,n=e.g,a=e.b,r=e.a,o=Math.max(t,n,a),i=o-Math.min(t,n,a),s=i?o===t?(n-a)/i:o===n?2+(a-t)/i:4+(t-n)/i:0;return{h:60*(s<0?s+6:s),s:o?i/o*100:0,v:o/255*100,a:r}},pX=function(e){var t=e.h,n=e.s,a=e.v,r=e.a;t=t/360*6,n/=100,a/=100;var o=Math.floor(t),i=a*(1-n),s=a*(1-(t-o)*n),l=a*(1-(1-t+o)*n),c=o%6;return{r:255*[a,s,i,i,l,a][c],g:255*[l,a,a,s,i,i][c],b:255*[i,i,l,a,a,s][c],a:r}},gX=function(e){return{h:sX(e.h),s:iX(e.s,0,100),l:iX(e.l,0,100),a:iX(e.a)}},hX=function(e){return{h:oX(e.h),s:oX(e.s),l:oX(e.l),a:oX(e.a,3)}},fX=function(e){return pX((n=(t=e).s,{h:t.h,s:(n*=((a=t.l)<50?a:100-a)/100)>0?2*n/(a+n)*100:0,v:a+n,a:t.a}));var t,n,a},vX=function(e){return{h:(t=mX(e)).h,s:(r=(200-(n=t.s))*(a=t.v)/100)>0&&r<200?n*a/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,n,a,r},bX=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yX=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xX=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kX=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wX={string:[[function(e){var t=dX.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?oX(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?oX(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=xX.exec(e)||kX.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:lX({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=bX.exec(e)||yX.exec(e);if(!t)return null;var n,a,r=gX({h:(n=t[1],a=t[2],void 0===a&&(a="deg"),Number(n)*(aX[a]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return fX(r)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,a=e.b,r=e.a,o=void 0===r?1:r;return rX(t)&&rX(n)&&rX(a)?lX({r:Number(t),g:Number(n),b:Number(a),a:Number(o)}):null},"rgb"],[function(e){var t=e.h,n=e.s,a=e.l,r=e.a,o=void 0===r?1:r;if(!rX(t)||!rX(n)||!rX(a))return null;var i=gX({h:Number(t),s:Number(n),l:Number(a),a:Number(o)});return fX(i)},"hsl"],[function(e){var t=e.h,n=e.s,a=e.v,r=e.a,o=void 0===r?1:r;if(!rX(t)||!rX(n)||!rX(a))return null;var i=function(e){return{h:sX(e.h),s:iX(e.s,0,100),v:iX(e.v,0,100),a:iX(e.a)}}({h:Number(t),s:Number(n),v:Number(a),a:Number(o)});return pX(i)},"hsv"]]},EX=function(e,t){for(var n=0;n<t.length;n++){var a=t[n][0](e);if(a)return[a,t[n][1]]}return[null,void 0]},NX=function(e,t){var n=vX(e);return{h:n.h,s:iX(n.s+100*t,0,100),l:n.l,a:n.a}},SX=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},VX=function(e,t){var n=vX(e);return{h:n.h,s:n.s,l:iX(n.l+100*t,0,100),a:n.a}},_X=function(){function e(e){this.parsed=function(e){return"string"==typeof e?EX(e.trim(),wX.string):"object"==typeof e&&null!==e?EX(e,wX.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return oX(SX(this.rgba),2)},e.prototype.isDark=function(){return SX(this.rgba)<.5},e.prototype.isLight=function(){return SX(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=cX(this.rgba)).r,n=e.g,a=e.b,o=(r=e.a)<1?uX(oX(255*r)):"","#"+uX(t)+uX(n)+uX(a)+o;var e,t,n,a,r,o},e.prototype.toRgb=function(){return cX(this.rgba)},e.prototype.toRgbString=function(){return t=(e=cX(this.rgba)).r,n=e.g,a=e.b,(r=e.a)<1?"rgba("+t+", "+n+", "+a+", "+r+")":"rgb("+t+", "+n+", "+a+")";var e,t,n,a,r},e.prototype.toHsl=function(){return hX(vX(this.rgba))},e.prototype.toHslString=function(){return t=(e=hX(vX(this.rgba))).h,n=e.s,a=e.l,(r=e.a)<1?"hsla("+t+", "+n+"%, "+a+"%, "+r+")":"hsl("+t+", "+n+"%, "+a+"%)";var e,t,n,a,r},e.prototype.toHsv=function(){return e=mX(this.rgba),{h:oX(e.h),s:oX(e.s),v:oX(e.v),a:oX(e.a,3)};var e},e.prototype.invert=function(){return CX({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),CX(NX(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),CX(NX(this.rgba,-e))},e.prototype.grayscale=function(){return CX(NX(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),CX(VX(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),CX(VX(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?CX({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):oX(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=vX(this.rgba);return"number"==typeof e?CX({h:e,s:t.s,l:t.l,a:t.a}):oX(t.h)},e.prototype.isEqual=function(e){return this.toHex()===CX(e).toHex()},e}(),CX=function(e){return e instanceof _X?e:new _X(e)},AX=[];!function(e){e.forEach(function(e){AX.indexOf(e)<0&&(e(_X,wX),AX.push(e))})}([function(e,t){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},a={};for(var r in n)a[n[r]]=r;var o={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,i,s=a[this.toHex()];if(s)return s;if(null==t?void 0:t.closest){var l=this.toRgb(),c=1/0,d="black";if(!o.length)for(var u in n)o[u]=new e(n[u]).toRgb();for(var m in n){var p=(r=l,i=o[m],Math.pow(r.r-i.r,2)+Math.pow(r.g-i.g,2)+Math.pow(r.b-i.b,2));p<c&&(c=p,d=m)}return d}},t.string.push([function(t){var a=t.toLowerCase(),r="transparent"===a?"#0000":n[a];return r?new e(r).toRgb():null},"name"])}]);const DX=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}isSourceEqual(e,t){const n=typeof e;if(n!==typeof t)return!1;if("number"===n||"string"===n||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every((e,n)=>e===t[n]);if(null!==e&&null!==t){const n=Object.keys(e),a=Object.keys(t);return n.length===a.length&&n.every(n=>e[n]===t[n])}return e===t}toRgba(){const[e,t,n,a]=this._components;return{r:e,g:t,b:n,a}}toRgb(){const[e,t,n]=this._components;return{r:e,g:t,b:n}}toRgbaString(){const[e,t,n]=this.toUint8RgbArray();return`rgba(${e},${t},${n},${this.alpha})`}toUint8RgbArray(e){const[t,n,a]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*n),e[2]=Math.round(255*a),e}toRgbArray(e){e=e??[];const[t,n,a]=this._components;return e[0]=t,e[1]=n,e[2]=a,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){const[n,a,r,o]=e.temp.setValue(t)._components;return this._components[0]*=n,this._components[1]*=a,this._components[2]*=r,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return(255<<24)+this._int;if(0===e)return t?0:this._int;let n=this._int>>16&255,a=this._int>>8&255,r=255&this._int;return t&&(n=n*e+.5|0,a=a*e+.5|0,r=r*e+.5|0),(255*e<<24)+(n<<16)+(a<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,n,a]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(n*e)/e,this._components[2]=Math.round(a*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,n,a,r]=this._components;return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e}normalize(t){let n,a,r,o;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215)n=(t>>16&255)/255,a=(t>>8&255)/255,r=(255&t)/255,o=1;else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[n,a,r,o=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[n,a,r,o=255]=t,n/=255,a/=255,r/=255,o/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const n=e.HEX_PATTERN.exec(t);n&&(t=`#${n[2]}`)}const i=CX(t);i.isValid()&&(({r:n,g:a,b:r,a:o}=i.rgba),n/=255,a/=255,r/=255)}if(void 0===n)throw new Error(`Unable to convert color ${t}`);this._components[0]=n,this._components[1]=a,this._components[2]=r,this._components[3]=o,this.refreshInt()}refreshInt(){this._clamp(this._components);const[e,t,n]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*n|0)}_clamp(e,t=0,n=1){return"number"==typeof e?Math.min(Math.max(e,t),n):(e.forEach((a,r)=>{e[r]=Math.min(Math.max(a,t),n)}),e)}};DX.shared=new DX,DX.temp=new DX,DX.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let TX=DX;const BX=function(){const e=[],t=[];for(let n=0;n<32;n++)e[n]=n,t[n]=n;e[uW.NORMAL_NPM]=uW.NORMAL,e[uW.ADD_NPM]=uW.ADD,e[uW.SCREEN_NPM]=uW.SCREEN,t[uW.NORMAL]=uW.NORMAL_NPM,t[uW.ADD]=uW.ADD_NPM,t[uW.SCREEN]=uW.SCREEN_NPM;const n=[];return n.push(t),n.push(e),n}();function IX(e,t){return BX[t?1:0][e]}function zX(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}function MX(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}function PX(e){return!(e&e-1||!e)}function RX(e){let t=(e>65535?1:0)<<4,n=((e>>>=t)>255?1:0)<<3;return t|=n,n=((e>>>=n)>15?1:0)<<2,t|=n,n=((e>>>=n)>3?1:0)<<1,t|=n,t|(e>>>=n)>>1}function $X(e,t,n){const a=e.length;let r;if(t>=a||0===n)return;const o=a-(n=t+n>a?a-t:n);for(r=t;r<o;++r)e[r]=e[r+n];e.length=o}function OX(e){return 0===e?0:e<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let LX=0;function FX(){return++LX}const jX=class{constructor(e,t,n,a){this.left=e,this.top=t,this.right=n,this.bottom=a}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};jX.EMPTY=new jX(0,0,0,0);let UX=jX;const qX={},GX=Object.create(null),HX=Object.create(null);class YX{constructor(e,t,n){this._canvas=CW.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||CW.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function WX(e,t,n){for(let a=0,r=4*n*t;a<t;++a,r+=4)if(0!==e[r+3])return!1;return!0}function XX(e,t,n,a,r){const o=4*t;for(let t=a,i=a*o+4*n;t<=r;++t,i+=o)if(0!==e[i+3])return!1;return!0}function JX(e,t=1){const n=CW.RETINA_PREFIX?.exec(e);return n?parseFloat(n[1]):t}var KX=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(KX||{});const ZX=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},QX=(e,t)=>ZX(e).priority??t,eJ={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(ZX).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...e){return e.map(ZX).forEach(e=>{e.type.forEach(t=>{const n=this._addHandlers,a=this._queue;n[t]?n[t]?.(e):(a[t]=a[t]||[],a[t]?.push(e))})}),this},handle(e,t,n){const a=this._addHandlers,r=this._removeHandlers;if(a[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);a[e]=t,r[e]=n;const o=this._queue;return o[e]&&(o[e]?.forEach(e=>t(e)),delete o[e]),this},handleByMap(e,t){return this.handle(e,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(e,t,n=-1){return this.handle(e,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((e,t)=>QX(t,n)-QX(e,n)))},e=>{const n=t.indexOf(e.ref);-1!==n&&t.splice(n,1)})}};class tJ{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const nJ=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function aJ(e){let t="";for(let n=0;n<e;++n)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(test == ${n}.0){}`);return t}class rJ{constructor(){this.data=0,this.blendMode=uW.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==uW.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new rJ;return e.depthTest=!1,e.blend=!0,e}}rJ.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const oJ=[];function iJ(e,t){if(!e)return null;let n="";if("string"==typeof e){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(n=t[1].toLowerCase())}for(let a=oJ.length-1;a>=0;--a){const r=oJ[a];if(r.test&&r.test(e,n))return new r(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class sJ{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,n,a,r,o,i,s){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let d=0,u=c.length;d<u;d++)c[d][l](e,t,n,a,r,o,i,s);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(sJ.prototype,{dispatch:{value:sJ.prototype.emit},run:{value:sJ.prototype.emit}});class lJ{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new sJ("setRealSize"),this.onUpdate=new sJ("update"),this.onError=new sJ("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class cJ extends lJ{constructor(e,t){const{width:n,height:a}=t||{};if(!n||!a)throw new Error("BufferResource width or height invalid");super(n,a),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,n){const a=e.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,this.unpackAlignment),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===xW.UNPACK);const r=t.realWidth,o=t.realHeight;return n.width===r&&n.height===o?a.texSubImage2D(t.target,0,0,0,r,o,t.format,n.type,this.data):(n.width=r,n.height=o,a.texImage2D(t.target,0,n.internalFormat,r,o,0,t.format,n.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const dJ={scaleMode:vW.NEAREST,alphaMode:xW.NPM},uJ=class e extends YW{constructor(t=null,n=null){super(),n=Object.assign({},e.defaultOptions,n);const{alphaMode:a,mipmap:r,anisotropicLevel:o,scaleMode:i,width:s,height:l,wrapMode:c,format:d,type:u,target:m,resolution:p,resourceOptions:g}=n;t&&!(t instanceof lJ)&&((t=iJ(t,g)).internal=!0),this.resolution=p||CW.RESOLUTION,this.width=Math.round((s||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=o,this._wrapMode=c,this._scaleMode=i,this.format=d,this.type=u,this.target=m,this.alphaMode=a,this.uid=FX(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=s>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let n;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,n=!0),n&&this.dirtyStyleId++,this}setSize(e,t,n){return n=n||this.resolution,this.setRealSize(e*n,t*n,n)}setRealSize(e,t,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=PX(this.realWidth)&&PX(this.realHeight)}setResolution(e){const t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete HX[this.cacheId],delete GX[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,n,a=CW.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let o=null;if(r)o=t;else{if(!t._pixiId){const e=n?.pixiIdPrefix||"pixiid";t._pixiId=`${e}_${FX()}`}o=t._pixiId}let i=HX[o];if(r&&a&&!i)throw new Error(`The cacheId "${o}" does not exist in BaseTextureCache.`);return i||(i=new e(t,n),i.cacheId=o,e.addToCache(i,o)),i}static fromBuffer(t,n,a,r){t=t||new Float32Array(n*a*4);const o=new cJ(t,{width:n,height:a,...r?.resourceOptions});let i,s;return t instanceof Float32Array?(i=pW.RGBA,s=hW.FLOAT):t instanceof Int32Array?(i=pW.RGBA_INTEGER,s=hW.INT):t instanceof Uint32Array?(i=pW.RGBA_INTEGER,s=hW.UNSIGNED_INT):t instanceof Int16Array?(i=pW.RGBA_INTEGER,s=hW.SHORT):t instanceof Uint16Array?(i=pW.RGBA_INTEGER,s=hW.UNSIGNED_SHORT):t instanceof Int8Array?(i=pW.RGBA,s=hW.BYTE):(i=pW.RGBA,s=hW.UNSIGNED_BYTE),o.internal=!0,new e(o,Object.assign({},dJ,{type:s,format:i},r))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),HX[t]&&HX[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),HX[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=HX[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete HX[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete HX[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};uJ.defaultOptions={mipmap:yW.POW2,anisotropicLevel:0,scaleMode:vW.LINEAR,wrapMode:bW.CLAMP,alphaMode:xW.UNPACK,target:gW.TEXTURE_2D,format:pW.RGBA,type:hW.UNSIGNED_BYTE},uJ._globalBatch=0;let mJ=uJ;class pJ{constructor(){this.texArray=null,this.blend=0,this.type=mW.TRIANGLES,this.start=0,this.size=0,this.data=null}}let gJ=0;class hJ{constructor(e,t=!0,n=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=t,this.id=gJ++,this.disposeRunner=new sJ("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?VW.ELEMENT_ARRAY_BUFFER:VW.ARRAY_BUFFER}get index(){return this.type===VW.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new hJ(e)}}class fJ{constructor(e,t=0,n=!1,a=hW.FLOAT,r,o,i,s=1){this.buffer=e,this.size=t,this.normalized=n,this.type=a,this.stride=r,this.start=o,this.instance=i,this.divisor=s}destroy(){this.buffer=null}static from(e,t,n,a,r){return new fJ(e,t,n,a,r)}}const vJ={Float32Array,Uint32Array,Int32Array,Uint8Array},bJ={5126:4,5123:2,5121:1};let yJ=0;const xJ={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class kJ{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=yJ++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new sJ("disposeGeometry"),this.refCount=0}addAttribute(e,t,n=0,a=!1,r,o,i,s=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof hJ||(t instanceof Array&&(t=new Float32Array(t)),t=new hJ(t));const l=e.split("|");if(l.length>1){for(let e=0;e<l.length;e++)this.addAttribute(l[e],t,n,a,r);return this}let c=this.buffers.indexOf(t);return-1===c&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new fJ(c,n,a,r,o,i,s),this.instanced=this.instanced||s,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof hJ||(e instanceof Array&&(e=new Uint16Array(e)),e=new hJ(e)),e.type=VW.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],t=[],n=new hJ;let a;for(a in this.attributes){const n=this.attributes[a],r=this.buffers[n.buffer];e.push(r.data),t.push(n.size*bJ[n.type]/4),n.buffer=0}for(n.data=function(e,t){let n=0,a=0;const r={};for(let r=0;r<e.length;r++)a+=t[r],n+=e[r].length;const o=new ArrayBuffer(4*n);let i=null,s=0;for(let n=0;n<e.length;n++){const l=t[n],c=e[n],d=zX(c);r[d]||(r[d]=new vJ[d](o)),i=r[d];for(let e=0;e<c.length;e++)i[(e/l|0)*a+s+e%l]=c[e];s+=l}return new Float32Array(o)}(e,t),a=0;a<this.buffers.length;a++)this.buffers[a]!==this.indexBuffer&&this.buffers[a].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new kJ;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new hJ(this.buffers[t].data.slice(0));for(const t in this.attributes){const n=this.attributes[t];e.attributes[t]=new fJ(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=VW.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new kJ,n=[],a=[],r=[];let o;for(let t=0;t<e.length;t++){o=e[t];for(let e=0;e<o.buffers.length;e++)a[e]=a[e]||0,a[e]+=o.buffers[e].data.length,r[e]=0}for(let e=0;e<o.buffers.length;e++)n[e]=new(xJ[zX(o.buffers[e].data)])(a[e]),t.buffers[e]=new hJ(n[e]);for(let t=0;t<e.length;t++){o=e[t];for(let e=0;e<o.buffers.length;e++)n[e].set(o.buffers[e].data,r[e]),r[e]+=o.buffers[e].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=VW.ELEMENT_ARRAY_BUFFER;let n=0,a=0,r=0,i=0;for(let e=0;e<o.buffers.length;e++)if(o.buffers[e]!==o.indexBuffer){i=e;break}for(const e in o.attributes){const t=o.attributes[e];(0|t.buffer)===i&&(a+=t.size*bJ[t.type]/4)}for(let o=0;o<e.length;o++){const s=e[o].indexBuffer.data;for(let e=0;e<s.length;e++)t.indexBuffer.data[e+r]+=n;n+=e[o].buffers[i].data.length/a,r+=s.length}}return t}}class wJ extends kJ{constructor(e=!1){super(),this._buffer=new hJ(null,e,!1),this._indexBuffer=new hJ(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,hW.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,hW.FLOAT).addAttribute("aColor",this._buffer,4,!0,hW.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,hW.FLOAT).addIndex(this._indexBuffer)}}const EJ=2*Math.PI,NJ=180/Math.PI,SJ=Math.PI/180;var VJ=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(VJ||{});class _J{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new _J(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}_J.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const CJ=[new _J,new _J,new _J,new _J];class AJ{constructor(e=0,t=0,n=0,a=0){this.x=Number(e),this.y=Number(t),this.width=Number(n),this.height=Number(a),this.type=VJ.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new AJ(0,0,0,0)}clone(){return new AJ(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const n=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>n}const n=this.left,a=this.right,r=this.top,o=this.bottom;if(a<=n||o<=r)return!1;const i=CJ[0].set(e.left,e.top),s=CJ[1].set(e.left,e.bottom),l=CJ[2].set(e.right,e.top),c=CJ[3].set(e.right,e.bottom);if(l.x<=i.x||s.y<=i.y)return!1;const d=Math.sign(t.a*t.d-t.b*t.c);if(0===d||(t.apply(i,i),t.apply(s,s),t.apply(l,l),t.apply(c,c),Math.max(i.x,s.x,l.x,c.x)<=n||Math.min(i.x,s.x,l.x,c.x)>=a||Math.max(i.y,s.y,l.y,c.y)<=r||Math.min(i.y,s.y,l.y,c.y)>=o))return!1;const u=d*(s.y-i.y),m=d*(i.x-s.x),p=u*n+m*r,g=u*a+m*r,h=u*n+m*o,f=u*a+m*o;if(Math.max(p,g,h,f)<=u*i.x+m*i.y||Math.min(p,g,h,f)>=u*c.x+m*c.y)return!1;const v=d*(i.y-l.y),b=d*(l.x-i.x),y=v*n+b*r,x=v*a+b*r,k=v*n+b*o,w=v*a+b*o;return!(Math.max(y,x,k,w)<=v*i.x+b*i.y||Math.min(y,x,k,w)>=v*c.x+b*c.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),n=Math.min(this.x+this.width,e.x+e.width),a=Math.max(this.y,e.y),r=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(n-t,0),this.y=a,this.height=Math.max(r-a,0),this}ceil(e=1,t=.001){const n=Math.ceil((this.x+this.width-t)*e)/e,a=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=n-this.x,this.height=a-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),n=Math.max(this.x+this.width,e.x+e.width),a=Math.min(this.y,e.y),r=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=n-t,this.y=a,this.height=r-a,this}}AJ.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class DJ{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.radius=n,this.type=VJ.CIRC}clone(){return new DJ(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const n=this.radius*this.radius;let a=this.x-e,r=this.y-t;return a*=a,r*=r,a+r<=n}getBounds(){return new AJ(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}DJ.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class TJ{constructor(e=0,t=0,n=0,a=0){this.x=e,this.y=t,this.width=n,this.height=a,this.type=VJ.ELIP}clone(){return new TJ(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let n=(e-this.x)/this.width,a=(t-this.y)/this.height;return n*=n,a*=a,n+a<=1}getBounds(){return new AJ(this.x-this.width,this.y-this.height,this.width,this.height)}}TJ.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class BJ{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){const e=[];for(let n=0,a=t.length;n<a;n++)e.push(t[n].x,t[n].y);t=e}this.points=t,this.type=VJ.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new BJ(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let n=!1;const a=this.points.length/2;for(let r=0,o=a-1;r<a;o=r++){const a=this.points[2*r],i=this.points[2*r+1],s=this.points[2*o],l=this.points[2*o+1];i>t!=l>t&&e<(t-i)/(l-i)*(s-a)+a&&(n=!n)}return n}}BJ.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`};class IJ{constructor(e=0,t=0,n=0,a=0,r=20){this.x=e,this.y=t,this.width=n,this.height=a,this.radius=r,this.type=VJ.RREC}clone(){return new IJ(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+n&&t<=this.y+this.height-n||e>=this.x+n&&e<=this.x+this.width-n)return!0;let a=e-(this.x+n),r=t-(this.y+n);const o=n*n;if(a*a+r*r<=o||(a=e-(this.x+this.width-n),a*a+r*r<=o)||(r=t-(this.y+this.height-n),a*a+r*r<=o)||(a=e-(this.x+n),a*a+r*r<=o))return!0}return!1}}IJ.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class zJ{constructor(e=1,t=0,n=0,a=1,r=0,o=0){this.array=null,this.a=e,this.b=t,this.c=n,this.d=a,this.tx=r,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,n,a,r,o){return this.a=e,this.b=t,this.c=n,this.d=a,this.tx=r,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const n=t||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(e,t){t=t||new _J;const n=e.x,a=e.y;return t.x=this.a*n+this.c*a+this.tx,t.y=this.b*n+this.d*a+this.ty,t}applyInverse(e,t){t=t||new _J;const n=1/(this.a*this.d+this.c*-this.b),a=e.x,r=e.y;return t.x=this.d*n*a+-this.c*n*r+(this.ty*this.c-this.tx*this.d)*n,t.y=this.a*n*r+-this.b*n*a+(-this.ty*this.a+this.tx*this.b)*n,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),a=this.a,r=this.c,o=this.tx;return this.a=a*t-this.b*n,this.b=a*n+this.b*t,this.c=r*t-this.d*n,this.d=r*n+this.d*t,this.tx=o*t-this.ty*n,this.ty=o*n+this.ty*t,this}append(e){const t=this.a,n=this.b,a=this.c,r=this.d;return this.a=e.a*t+e.b*a,this.b=e.a*n+e.b*r,this.c=e.c*t+e.d*a,this.d=e.c*n+e.d*r,this.tx=e.tx*t+e.ty*a+this.tx,this.ty=e.tx*n+e.ty*r+this.ty,this}setTransform(e,t,n,a,r,o,i,s,l){return this.a=Math.cos(i+l)*r,this.b=Math.sin(i+l)*r,this.c=-Math.sin(i-s)*o,this.d=Math.cos(i-s)*o,this.tx=e-(n*this.a+a*this.c),this.ty=t-(n*this.b+a*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,n=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,n=this.b,a=this.c,r=this.d,o=e.pivot,i=-Math.atan2(-a,r),s=Math.atan2(n,t),l=Math.abs(i+s);return l<1e-5||Math.abs(EJ-l)<1e-5?(e.rotation=s,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=i,e.skew.y=s),e.scale.x=Math.sqrt(t*t+n*n),e.scale.y=Math.sqrt(a*a+r*r),e.position.x=this.tx+(o.x*t+o.y*a),e.position.y=this.ty+(o.x*n+o.y*r),e}invert(){const e=this.a,t=this.b,n=this.c,a=this.d,r=this.tx,o=e*a-t*n;return this.a=a/o,this.b=-t/o,this.c=-n/o,this.d=e/o,this.tx=(n*this.ty-a*r)/o,this.ty=-(e*this.ty-t*r)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new zJ;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new zJ}static get TEMP_MATRIX(){return new zJ}}zJ.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const MJ=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],PJ=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],RJ=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$J=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],OJ=[],LJ=[],FJ=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];OJ.push(t);for(let n=0;n<16;n++){const a=FJ(MJ[e]*MJ[n]+RJ[e]*PJ[n]),r=FJ(PJ[e]*MJ[n]+$J[e]*PJ[n]),o=FJ(MJ[e]*RJ[n]+RJ[e]*$J[n]),i=FJ(PJ[e]*RJ[n]+$J[e]*$J[n]);for(let e=0;e<16;e++)if(MJ[e]===a&&PJ[e]===r&&RJ[e]===o&&$J[e]===i){t.push(e);break}}}for(let e=0;e<16;e++){const t=new zJ;t.set(MJ[e],PJ[e],RJ[e],$J[e],0,0),LJ.push(t)}}();const jJ={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>MJ[e],uY:e=>PJ[e],vX:e=>RJ[e],vY:e=>$J[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>OJ[e][t],sub:(e,t)=>OJ[e][jJ.inv(t)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?jJ.S:jJ.N:2*Math.abs(t)<=Math.abs(e)?e>0?jJ.E:jJ.W:t>0?e>0?jJ.SE:jJ.SW:e>0?jJ.NE:jJ.NW,matrixAppendRotationInv:(e,t,n=0,a=0)=>{const r=LJ[jJ.inv(t)];r.tx=n,r.ty=a,e.append(r)}};class UJ{constructor(e,t,n=0,a=0){this._x=n,this._y=a,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new UJ(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}UJ.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const qJ=class{constructor(){this.worldTransform=new zJ,this.localTransform=new zJ,this.position=new UJ(this.onChange,this,0,0),this.scale=new UJ(this.onChange,this,1,1),this.pivot=new UJ(this.onChange,this,0,0),this.skew=new UJ(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const n=e.worldTransform,a=this.worldTransform;a.a=t.a*n.a+t.b*n.c,a.b=t.a*n.b+t.b*n.d,a.c=t.c*n.a+t.d*n.c,a.d=t.c*n.b+t.d*n.d,a.tx=t.tx*n.a+t.ty*n.c+n.tx,a.ty=t.tx*n.b+t.ty*n.d+n.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};qJ.IDENTITY=new qJ;let GJ=qJ;GJ.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const HJ=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,t)=>!("sampler2D"!==e.type&&"samplerCube"!==e.type&&"sampler2DArray"!==e.type||1!==e.size||e.isArray||null!=t&&void 0===t.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,t)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,t)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,t)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],YJ={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},WJ={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},XJ={};let JJ,KJ=XJ;const ZJ={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function QJ(e){return ZJ[e]}let eK=null;const tK={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function nK(e,t){if(!eK){const t=Object.keys(tK);eK={};for(let n=0;n<t.length;++n){const a=t[n];eK[e[a]]=tK[a]}}return eK[t]}function aK(e,t,n){if("precision"!==e.substring(0,9)){let a=t;return t===EW.HIGH&&n!==EW.HIGH&&(a=EW.MEDIUM),`precision ${a} float;\n${e}`}return n!==EW.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let rK=0;const oK={},iK=class e{constructor(t,n,a="pixi-shader",r={}){this.extra={},this.id=rK++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=n||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(a=a.replace(/\s+/g,"-"),oK[a]?(oK[a]++,a+=`-${oK[a]}`):oK[a]=1,this.vertexSrc=`#define SHADER_NAME ${a}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${a}\n${this.fragmentSrc}`,this.vertexSrc=aK(this.vertexSrc,e.defaultVertexPrecision,EW.HIGH),this.fragmentSrc=aK(this.fragmentSrc,e.defaultFragmentPrecision,function(){if(!JJ){JJ=EW.MEDIUM;const e=function(){if(KJ===XJ||KJ?.isContextLost()){const e=CW.ADAPTER.createCanvas();let t;CW.PREFER_ENV>=lW.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),KJ=t}return KJ}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(JJ=t.precision?EW.HIGH:EW.MEDIUM)}}return JJ}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,n,a){const r=t+n;let o=qX[r];return o||(qX[r]=o=new e(t,n,a)),o}};iK.defaultVertexPrecision=EW.HIGH,iK.defaultFragmentPrecision=HW.apple.device?EW.HIGH:EW.MEDIUM;let sK=iK,lK=0;class cK{constructor(e,t,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=lK++,this.static=!!t,this.ubo=!!n,e instanceof hJ?(this.buffer=e,this.buffer.type=VW.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new hJ(new Float32Array(1)),this.buffer.type=VW.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new cK(t,n)}static from(e,t,n){return new cK(e,t,n)}static uboFrom(e,t){return new cK(e,t??!0,!0)}}class dK{constructor(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof cK?t:new cK(t):new cK({}),this.disposeRunner=new sJ("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const n in t.uniforms){const a=t.uniforms[n];if(!0===a.group&&this.checkUniformExists(e,a))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,n){const a=sK.from(e,t);return new dK(a,n)}}class uK{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=n;this.defaultGroupCache[e]=cK.from({uSamplers:t},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new sK(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new zJ,default:this.defaultGroupCache[e]};return new dK(this.programCache[e],t)}generateSampleSrc(e){let t="";t+="\n",t+="\n";for(let n=0;n<e;n++)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(vTextureId < ${n}.5)`),t+="\n{",t+=`\n\tcolor = texture2D(uSamplers[${n}], vTextureCoord);`,t+="\n}";return t+="\n",t+="\n",t}}class mK{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class pK{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const gK=class e extends pK{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=wJ,this.vertexSize=6,this.state=rJ.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(){let e=!0;const t=CW.ADAPTER.getNavigator();if(HW.tablet||HW.phone){if(HW.apple.device){const n=t.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(e=!1)}if(HW.android.device){const n=t.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!HW.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return JW("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=e.defaultVertexSrc,fragment:n=e.defaultFragmentTemplate}={}){this.shaderGenerator=new uK(t,n)}contextChange(){const t=this.renderer.gl;CW.PREFER_ENV===lW.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=function(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=t.createShader(t.FRAGMENT_SHADER);for(;;){const a=nJ.replace(/%forloop%/gi,aJ(e));if(t.shaderSource(n,a),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:n}=e,a=this.size/4,r=Math.floor(a/this.maxTextures)+1;for(;t.length<a;)t.push(new pJ);for(;n.length<r;)n.push(new mK);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:n}=this,a=e._textureArrayPool,r=this.renderer.batch,o=this._tempBoundTextures,i=this.renderer.textureGC.count;let s=++mJ._globalBatch,l=0,c=a[0],d=0;r.copyBoundTextures(o,n);for(let e=0;e<this._bufferSize;++e){const u=t[e];t[e]=null,u._batchEnabled!==s&&(c.count>=n&&(r.boundArray(c,o,s,n),this.buildDrawCalls(c,d,e),d=e,c=a[++l],++s),u._batchEnabled=s,u.touched=i,c.elements[c.count++]=u)}c.count>0&&(r.boundArray(c,o,s,n),this.buildDrawCalls(c,d,this._bufferSize),++l,++s);for(let e=0;e<o.length;e++)o[e]=null;mJ._globalBatch=s}buildDrawCalls(t,n,a){const{_bufferedElements:r,_attributeBuffer:o,_indexBuffer:i,vertexSize:s}=this,l=e._drawCallPool;let c=this._dcIndex,d=this._aIndex,u=this._iIndex,m=l[c];m.start=this._iIndex,m.texArray=t;for(let e=n;e<a;++e){const a=r[e],p=a._texture.baseTexture,g=BX[p.alphaMode?1:0][a.blendMode];r[e]=null,n<e&&m.blend!==g&&(m.size=u-m.start,n=e,m=l[++c],m.texArray=t,m.start=u),this.packInterleavedGeometry(a,o,i,d,u),d+=a.vertexData.length/2*s,u+=a.indices.length,m.blend=g}n<a&&(m.size=u-m.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=u}bindAndClearTexArray(e){const t=this.renderer.texture;for(let n=0;n<e.count;n++)t.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:n,_indexBuffer:a}=this;e.canUploadSameBuffer?(t[this._flushId]._buffer.update(n.rawBinaryData),t[this._flushId]._indexBuffer.update(a),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(n.rawBinaryData),t[this._flushId]._indexBuffer.update(a),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:n,state:a}=this.renderer,r=e._drawCallPool;let o=null;for(let e=0;e<t;e++){const{texArray:t,type:i,size:s,start:l,blend:c}=r[e];o!==t&&(o=t,this.bindAndClearTexArray(t)),this.state.blendMode=c,a.set(this.state),n.drawElements(i,s,n.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=MX(Math.ceil(e/8)),n=RX(t),a=8*t;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let r=this._aBuffers[a];return r||(this._aBuffers[a]=r=new tJ(a*this.vertexSize*4)),r}getIndexBuffer(e){const t=MX(Math.ceil(e/12)),n=RX(t),a=12*t;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let r=this._iBuffers[n];return r||(this._iBuffers[n]=r=new Uint16Array(a)),r}packInterleavedGeometry(e,t,n,a,r){const{uint32View:o,float32View:i}=t,s=a/this.vertexSize,l=e.uvs,c=e.indices,d=e.vertexData,u=e._texture.baseTexture._batchLocation,m=Math.min(e.worldAlpha,1),p=TX.shared.setValue(e._tintRGB).toPremultiplied(m,e._texture.baseTexture.alphaMode>0);for(let e=0;e<d.length;e+=2)i[a++]=d[e],i[a++]=d[e+1],i[a++]=l[e],i[a++]=l[e+1],o[a++]=p,i[a++]=u;for(let e=0;e<c.length;e++)n[r++]=s+c[e]}};gK.defaultBatchSize=4096,gK.extension={name:"batch",type:KX.RendererPlugin},gK._drawCallPool=[],gK._textureArrayPool=[];let hK=gK;eJ.add(hK);const fK=class e extends dK{constructor(t,n,a){super(sK.from(t||e.defaultVertexSrc,n||e.defaultFragmentSrc),a),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new rJ}apply(e,t,n,a,r){e.applyFilter(this,t,n,a)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};fK.defaultResolution=1,fK.defaultMultisample=SW.NONE;let vK=fK;class bK{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new TX(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:n,backgroundAlpha:a}=e,r=n??t;void 0!==r&&(this.color=r),this.alpha=a}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}bK.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},bK.extension={type:[KX.RendererSystem,KX.CanvasRendererSystem],name:"background"},eJ.add(bK);class yK{constructor(e){this.renderer=e,this.emptyRenderer=new pK(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:n}=this.renderer.texture;for(let a=t-1;a>=0;--a)e[a]=n[a]||null,e[a]&&(e[a]._batchLocation=a)}boundArray(e,t,n,a){const{elements:r,ids:o,count:i}=e;let s=0;for(let e=0;e<i;e++){const i=r[e],l=i._batchLocation;if(l>=0&&l<a&&t[l]===i)o[e]=l;else for(;s<a;){const a=t[s];if(!a||a._batchEnabled!==n||a._batchLocation!==s){o[e]=s,i._batchLocation=s,t[s]=i;break}s++}}}destroy(){this.renderer=null}}yK.extension={type:KX.RendererSystem,name:"batch"},eJ.add(yK);let xK=0;class kK{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=xK++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,n=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:n,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=xK++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let n;if(CW.PREFER_ENV>=lW.WEBGL2&&(n=e.getContext("webgl2",t)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const a=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=a,a||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}kK.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},kK.extension={type:KX.RendererSystem,name:"context"},eJ.add(kK);class wK{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new sJ("disposeFramebuffer"),this.multisample=SW.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new mJ(null,{scaleMode:vW.NEAREST,resolution:1,mipmap:yW.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new mJ(null,{scaleMode:vW.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:yW.OFF,format:pW.DEPTH_COMPONENT,type:hW.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const a=this.colorTextures[n],r=a.resolution;a.setSize(e/r,t/r)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(e/n,t/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class EK extends mJ{constructor(e={}){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=SW.NONE),super(null,e),this.mipmap=yW.OFF,this.valid=!0,this._clear=new TX([0,0,0,0]),this.framebuffer=new wK(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class NK extends lJ{constructor(e){const t=e;super(t.naturalWidth||t.videoWidth||t.displayWidth||t.width,t.naturalHeight||t.videoHeight||t.displayHeight||t.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,n){void 0!==n||t.startsWith("data:")?!1!==n&&(e.crossOrigin="string"==typeof n?n:"anonymous"):e.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;const n=new URL(e,document.baseURI);return n.hostname!==t.hostname||n.port!==t.port||n.protocol!==t.protocol?"anonymous":""}(t)}upload(e,t,n,a){const r=e.gl,o=t.realWidth,i=t.realHeight;if(a=a||this.source,typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement){if(!a.complete||0===a.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement&&a.readyState<=1)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===xW.UNPACK),this.noSubImage||t.target!==r.TEXTURE_2D||n.width!==o||n.height!==i?(n.width=o,n.height=i,r.texImage2D(t.target,0,n.internalFormat,t.format,n.type,a)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,n.type,a),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(t,n),super.update()}dispose(){this.source=null}}class SK extends NK{constructor(e,t){if(t=t||{},"string"==typeof e){const n=new Image;NK.crossOrigin(n,e,t.crossorigin),n.src=e,e=n}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??CW.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise((e,t)=>{const n=this.source;this.url=n.src;const a=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?a():(n.onload=a,n.onerror=e=>{t(e),this.onError.emit(e)})})),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,n=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:n?"cors":"no-cors"}).then(e=>e.blob()).then(n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===xW.UNPACK?"premultiply":"none"})).then(e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,n){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,n,this.bitmap),!this.preserveBitmap){let e=!0;const a=t._glTextures;for(const r in a){const o=a[r];if(o!==n&&o.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&("string"==typeof e||e instanceof HTMLImageElement)}}class VK{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,n){const a=t.width,r=t.height;if(n){const t=e.width/2/a,o=e.height/2/r,i=e.x/a+t,s=e.y/r+o;n=jJ.add(n,jJ.NW),this.x0=i+t*jJ.uX(n),this.y0=s+o*jJ.uY(n),n=jJ.add(n,2),this.x1=i+t*jJ.uX(n),this.y1=s+o*jJ.uY(n),n=jJ.add(n,2),this.x2=i+t*jJ.uX(n),this.y2=s+o*jJ.uY(n),n=jJ.add(n,2),this.x3=i+t*jJ.uX(n),this.y3=s+o*jJ.uY(n)}else this.x0=e.x/a,this.y0=e.y/r,this.x1=(e.x+e.width)/a,this.y1=e.y/r,this.x2=(e.x+e.width)/a,this.y2=(e.y+e.height)/r,this.x3=e.x/a,this.y3=(e.y+e.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}VK.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const _K=new VK;function CK(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class AK extends YW{constructor(e,t,n,a,r,o,i){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new AJ(0,0,1,1)),e instanceof AK&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=a,this.valid=!1,this.destroyed=!1,this._uvs=_K,this.uvMatrix=null,this.orig=n||t,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new _J(o.x,o.y):new _J(0,0),this.defaultBorders=i,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&GX[e.url]&&AK.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,AK.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),n=new AK(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=e),n}updateUvs(){this._uvs===_K&&(this._uvs=new VK),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},n=CW.STRICT_TEXTURE_CACHE){const a="string"==typeof e;let r=null;if(a)r=e;else if(e instanceof mJ){if(!e.cacheId){const n=t?.pixiIdPrefix||"pixiid";e.cacheId=`${n}-${FX()}`,mJ.addToCache(e,e.cacheId)}r=e.cacheId}else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${FX()}`}r=e._pixiId}let o=GX[r];if(a&&n&&!o)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return o||e instanceof mJ?!o&&e instanceof mJ&&(o=new AK(e),AK.addToCache(o,r)):(t.resolution||(t.resolution=JX(e)),o=new AK(new mJ(e,t)),o.baseTexture.cacheId=r,mJ.addToCache(o.baseTexture,r),AK.addToCache(o,r)),o}static fromURL(e,t){const n=Object.assign({autoLoad:!1},t?.resourceOptions),a=AK.from(e,Object.assign({resourceOptions:n},t),!1),r=a.baseTexture.resource;return a.baseTexture.valid?Promise.resolve(a):r.load().then(()=>Promise.resolve(a))}static fromBuffer(e,t,n,a){return new AK(mJ.fromBuffer(e,t,n,a))}static fromLoader(e,t,n,a){const r=new mJ(e,Object.assign({scaleMode:mJ.defaultOptions.scaleMode,resolution:JX(t)},a)),{resource:o}=r;o instanceof SK&&(o.url=t);const i=new AK(r);return n||(n=t),mJ.addToCache(i.baseTexture,n),AK.addToCache(i,n),n!==t&&(mJ.addToCache(i.baseTexture,t),AK.addToCache(i,t)),i.baseTexture.valid?Promise.resolve(i):new Promise(e=>{i.baseTexture.once("loaded",()=>e(i))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),GX[t]&&GX[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),GX[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=GX[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete GX[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)GX[e.textureCacheIds[t]]===e&&delete GX[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:n,width:a,height:r}=e,o=t+a>this.baseTexture.width,i=n+r>this.baseTexture.height;if(o||i){const e=o&&i?"and":"or",s=`X: ${t} + ${a} = ${t+a} > ${this.baseTexture.width}`,l=`Y: ${n} + ${r} = ${n+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${s} ${e} ${l}`)}this.valid=a&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return AK._EMPTY||(AK._EMPTY=new AK(new mJ),CK(AK._EMPTY),CK(AK._EMPTY.baseTexture)),AK._EMPTY}static get WHITE(){if(!AK._WHITE){const e=CW.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),AK._WHITE=new AK(mJ.from(e)),CK(AK._WHITE),CK(AK._WHITE.baseTexture)}return AK._WHITE}}class DK extends AK{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,n=!0){const a=this.baseTexture.resolution,r=Math.round(e*a)/a,o=Math.round(t*a)/a;this.valid=r>0&&o>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=o,n&&this.baseTexture.resize(r,o),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new DK(new EK(e))}}class TK{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,n=SW.NONE){const a=new EK(Object.assign({width:e,height:t,resolution:1,multisample:n},this.textureOptions));return new DK(a)}getOptimalTexture(e,t,n=1,a=SW.NONE){let r;e=Math.max(Math.ceil(e*n-1e-6),1),t=Math.max(Math.ceil(t*n-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?r=a>1?-a:-1:(r=((65535&(e=MX(e)))<<16|65535&(t=MX(t)))>>>0,a>1&&(r+=4294967296*a)),this.texturePool[r]||(this.texturePool[r]=[]);let o=this.texturePool[r].pop();return o||(o=this.createTexture(e,t,a)),o.filterPoolKey=r,o.setResolution(n),o}getFilterTexture(e,t,n){const a=this.getOptimalTexture(e.width,e.height,t||e.resolution,n||SW.NONE);return a.filterFrame=e.filterFrame,a}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}TK.SCREEN_KEY=-1;class BK extends kJ{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class IK extends kJ{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new hJ(this.vertices),this.uvBuffer=new hJ(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let n=0,a=0;return this.uvs[0]=n,this.uvs[1]=a,this.uvs[2]=n+t.width/e.width,this.uvs[3]=a,this.uvs[4]=n+t.width/e.width,this.uvs[5]=a+t.height/e.height,this.uvs[6]=n,this.uvs[7]=a+t.height/e.height,n=t.x,a=t.y,this.vertices[0]=n,this.vertices[1]=a,this.vertices[2]=n+t.width,this.vertices[3]=a,this.vertices[4]=n+t.width,this.vertices[5]=a+t.height,this.vertices[6]=n,this.vertices[7]=a+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class zK{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=SW.NONE,this.sourceFrame=new AJ,this.destinationFrame=new AJ,this.bindingSourceFrame=new AJ,this.bindingDestinationFrame=new AJ,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const MK=[new _J,new _J,new _J,new _J],PK=new zJ;class RK{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new TK,this.statePool=[],this.quad=new BK,this.quadUv=new IK,this.tempRect=new AJ,this.activeState={},this.globalUniforms=new cK({outputFrame:new AJ,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const n=this.renderer,a=this.defaultFilterStack,r=this.statePool.pop()||new zK,o=n.renderTexture;let i,s;if(o.current){const e=o.current;i=e.resolution,s=e.multisample}else i=n.resolution,s=n.multisample;let l=t[0].resolution||i,c=t[0].multisample??s,d=t[0].padding,u=t[0].autoFit,m=t[0].legacy??!0;for(let e=1;e<t.length;e++){const n=t[e];l=Math.min(l,n.resolution||i),c=Math.min(c,n.multisample??s),d=this.useMaxPadding?Math.max(d,n.padding):d+n.padding,u=u&&n.autoFit,m=m||(n.legacy??!0)}1===a.length&&(this.defaultFilterStack[0].renderTexture=o.current),a.push(r),r.resolution=l,r.multisample=c,r.legacy=m,r.target=e,r.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),r.sourceFrame.pad(d);const p=this.tempRect.copyFrom(o.sourceFrame);n.projection.transform&&this.transformAABB(PK.copyFrom(n.projection.transform).invert(),p),u?(r.sourceFrame.fit(p),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(p)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,o.current?o.current.resolution:n.resolution,o.sourceFrame,o.destinationFrame,n.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,l,c),r.filters=t,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=r.sourceFrame.width,g.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(o.sourceFrame),r.bindingDestinationFrame.copyFrom(o.destinationFrame),r.transform=n.projection.transform,n.projection.transform=null,o.bind(r.renderTexture,r.sourceFrame,g),n.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),n=t.filters;this.activeState=t;const a=this.globalUniforms.uniforms;a.outputFrame=t.sourceFrame,a.resolution=t.resolution;const r=a.inputSize,o=a.inputPixel,i=a.inputClamp;if(r[0]=t.destinationFrame.width,r[1]=t.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],o[0]=Math.round(r[0]*t.resolution),o[1]=Math.round(r[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],i[0]=.5*o[2],i[1]=.5*o[3],i[2]=t.sourceFrame.width*r[2]-.5*o[2],i[3]=t.sourceFrame.height*r[3]-.5*o[3],t.legacy){const e=a.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,a.filterClamp=a.inputClamp}this.globalUniforms.update();const s=e[e.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,t.renderTexture,s.renderTexture,kW.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,a=this.getOptimalFilterTexture(e.width,e.height,t.resolution);a.filterFrame=e.filterFrame;let r=0;for(r=0;r<n.length-1;++r){1===r&&t.multisample>1&&(a=this.getOptimalFilterTexture(e.width,e.height,t.resolution),a.filterFrame=e.filterFrame),n[r].apply(this,e,a,kW.CLEAR,t);const o=e;e=a,a=o}n[r].apply(this,e,s.renderTexture,kW.BLEND,t),r>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(a)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=kW.CLEAR){const{renderTexture:n,state:a}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,n.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&a.stateId||this.forceClear;(t===kW.CLEAR||t===kW.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,n,a){const r=this.renderer;r.state.set(e.state),this.bindAndClear(n,a),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(mW.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(mW.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:n,destinationFrame:a}=this.activeState,{orig:r}=t._texture,o=e.set(a.width,0,0,a.height,n.x,n.y),i=t.worldTransform.copyTo(zJ.TEMP_MATRIX);return i.invert(),o.prepend(i),o.scale(1/r.width,1/r.height),o.translate(t.anchor.x,t.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,n=1,a=SW.NONE){return this.texturePool.getOptimalTexture(e,t,n,a)}getFilterTexture(e,t,n){if("number"==typeof e){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const a=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,n||SW.NONE);return a.filterFrame=e.filterFrame,a}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const n=MK[0],a=MK[1],r=MK[2],o=MK[3];n.set(t.left,t.top),a.set(t.left,t.bottom),r.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(n,n),e.apply(a,a),e.apply(r,r),e.apply(o,o);const i=Math.min(n.x,a.x,r.x,o.x),s=Math.min(n.y,a.y,r.y,o.y),l=Math.max(n.x,a.x,r.x,o.x),c=Math.max(n.y,a.y,r.y,o.y);t.x=i,t.y=s,t.width=l-i,t.height=c-s}roundFrame(e,t,n,a,r){if(!(e.width<=0||e.height<=0||n.width<=0||n.height<=0)){if(r){const{a:e,b:t,c:n,d:a}=r;if((Math.abs(t)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(a)>1e-4))return}(r=r?PK.copyFrom(r):PK.identity()).translate(-n.x,-n.y).scale(a.width/n.width,a.height/n.height).translate(a.x,a.y),this.transformAABB(r,e),e.ceil(t),this.transformAABB(r.invert(),e)}}}RK.extension={type:KX.RendererSystem,name:"filter"},eJ.add(RK);class $K{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=SW.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const OK=new AJ;class LK{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new wK(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new AJ,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;CW.PREFER_ENV===lW.WEBGL_LEGACY&&(t=null,n=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,n=0){const{gl:a}=this;if(e){const r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,a.bindFramebuffer(a.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==n&&(e.dirtyId++,e.dirtyFormat++,r.mipLevel=n),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,r.dirtySize=e.dirtySize,this.updateFramebuffer(e,n)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const n=e.colorTextures[t];this.renderer.texture.unbind(n.parentTextureArray||n)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>n,a=t.height>>n,r=e/t.width;this.setViewport(t.x*r,t.y*r,e,a)}else{const t=e.width>>n,a=e.height>>n;this.setViewport(0,0,t,a)}}else this.current&&(this.current=null,a.bindFramebuffer(a.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,n,a){const r=this.viewport;e=Math.round(e),t=Math.round(t),n=Math.round(n),a=Math.round(a),(r.width!==n||r.height!==a||r.x!==e||r.y!==t)&&(r.x=e,r.y=t,r.width=n,r.height=a,this.gl.viewport(e,t,n,a))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,n,a,r=dW.COLOR|dW.DEPTH){const{gl:o}=this;o.clearColor(e,t,n,a),o.clear(r)}initFramebuffer(e){const{gl:t}=this,n=new $K(t.createFramebuffer());return n.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(e),e.disposeRunner.add(this),n}resizeFramebuffer(e){const{gl:t}=this,n=e.glFramebuffers[this.CONTEXT_UID];if(n.stencil){let a;t.bindRenderbuffer(t.RENDERBUFFER,n.stencil),a=1===this.renderer.context.webGLVersion?t.DEPTH_STENCIL:e.depth&&e.stencil?t.DEPTH24_STENCIL8:e.depth?t.DEPTH_COMPONENT24:t.STENCIL_INDEX8,n.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,a,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}const a=e.colorTextures;let r=a.length;t.drawBuffers||(r=Math.min(r,1));for(let o=0;o<r;o++){const r=a[o],i=r.parentTextureArray||r;this.renderer.texture.bind(i,0),0===o&&n.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,n.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,i._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:n}=this,a=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures;let o=r.length;n.drawBuffers||(o=Math.min(o,1)),a.multisample>1&&this.canMultisampleFramebuffer(e)?a.msaaBuffer=a.msaaBuffer||n.createRenderbuffer():a.msaaBuffer&&(n.deleteRenderbuffer(a.msaaBuffer),a.msaaBuffer=null,a.blitFramebuffer&&(a.blitFramebuffer.dispose(),a.blitFramebuffer=null));const i=[];for(let s=0;s<o;s++){const o=r[s],l=o.parentTextureArray||o;this.renderer.texture.bind(l,0),0===s&&a.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,a.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,a.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,a.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+s,o.target,l._glTextures[this.CONTEXT_UID].texture,t),i.push(n.COLOR_ATTACHMENT0+s))}if(i.length>1&&n.drawBuffers(i),e.depthTexture&&this.writeDepthTexture){const a=e.depthTexture;this.renderer.texture.bind(a,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,t)}if(!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture)a.stencil&&(n.deleteRenderbuffer(a.stencil),a.stencil=null);else{let t,r;a.stencil=a.stencil||n.createRenderbuffer(),1===this.renderer.context.webGLVersion?(t=n.DEPTH_STENCIL_ATTACHMENT,r=n.DEPTH_STENCIL):e.depth&&e.stencil?(t=n.DEPTH_STENCIL_ATTACHMENT,r=n.DEPTH24_STENCIL8):e.depth?(t=n.DEPTH_ATTACHMENT,r=n.DEPTH_COMPONENT24):(t=n.STENCIL_ATTACHMENT,r=n.STENCIL_INDEX8),n.bindRenderbuffer(n.RENDERBUFFER,a.stencil),a.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,a.multisample,r,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,r,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,a.stencil)}}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let n=SW.NONE;if(e<=1||null===t)return n;for(let a=0;a<t.length;a++)if(t[a]<=e){n=t[a];break}return 1===n&&(n=SW.NONE),n}blit(e,t,n){const{current:a,renderer:r,gl:o,CONTEXT_UID:i}=this;if(2!==r.context.webGLVersion||!a)return;const s=a.glFramebuffers[i];if(!s)return;if(!e){if(!s.msaaBuffer)return;const t=a.colorTextures[0];if(!t)return;s.blitFramebuffer||(s.blitFramebuffer=new wK(a.width,a.height),s.blitFramebuffer.addColorTexture(0,t)),(e=s.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==a.width||e.height!==a.height)&&(e.width=a.width,e.height=a.height,e.dirtyId++,e.dirtySize++)}t||((t=OK).width=a.width,t.height=a.height),n||(n=t);const l=t.width===n.width&&t.height===n.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,s.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,n.left,n.top,n.right,n.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const n=e.glFramebuffers[this.CONTEXT_UID],a=this.gl;if(!n)return;delete e.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(e);r>=0&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),t||(a.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&a.deleteRenderbuffer(n.msaaBuffer),n.stencil&&a.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<t.length;n++)this.disposeFramebuffer(t[n],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const n=e.width,a=e.height,r=this.gl,o=t.stencil=r.createRenderbuffer();let i,s;r.bindRenderbuffer(r.RENDERBUFFER,o),1===this.renderer.context.webGLVersion?(i=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH_STENCIL):e.depth?(i=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH24_STENCIL8):(i=r.STENCIL_ATTACHMENT,s=r.STENCIL_INDEX8),t.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,t.multisample,s,n,a):r.renderbufferStorage(r.RENDERBUFFER,s,n,a),r.framebufferRenderbuffer(r.FRAMEBUFFER,i,r.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new AJ}destroy(){this.renderer=null}}LK.extension={type:KX.RendererSystem,name:"framebuffer"},eJ.add(LK);const FK={5126:4,5123:2,5121:1};class jK{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;CW.PREFER_ENV===lW.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,n)=>t.vertexAttribDivisorANGLE(e,n),e.drawElementsInstanced=(e,n,a,r,o)=>t.drawElementsInstancedANGLE(e,n,a,r,o),e.drawArraysInstanced=(e,n,a,r)=>t.drawArraysInstancedANGLE(e,n,a,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:n}=this;let a=e.glVertexArrayObjects[this.CONTEXT_UID],r=!1;a||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=a={},r=!0);const o=a[t.program.id]||this.initGeometryVao(e,t,r);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?n.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let n=0;n<e.buffers.length;n++){const a=e.buffers[n];t.update(a)}}checkCompatibility(e,t){const n=e.attributes,a=t.attributeData;for(const e in a)if(!n[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){const n=e.attributes,a=t.attributeData,r=["g",e.id];for(const e in n)a[e]&&r.push(e,a[e].location);return r.join("-")}initGeometryVao(e,t,n=!0){const a=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,i=t.program;i.glPrograms[r]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,i);const s=this.getSignature(e,i),l=e.glVertexArrayObjects[this.CONTEXT_UID];let c=l[s];if(c)return l[i.id]=c,c;const d=e.buffers,u=e.attributes,m={},p={};for(const e in d)m[e]=0,p[e]=0;for(const e in u)!u[e].size&&i.attributeData[e]?u[e].size=i.attributeData[e].size:u[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),m[u[e].buffer]+=u[e].size*FK[u[e].type];for(const e in u){const t=u[e],n=t.size;void 0===t.stride&&(m[t.buffer]===n*FK[t.type]?t.stride=0:t.stride=m[t.buffer]),void 0===t.start&&(t.start=p[t.buffer],p[t.buffer]+=n*FK[t.type])}c=a.createVertexArray(),a.bindVertexArray(c);for(let e=0;e<d.length;e++){const t=d[e];o.bind(t),n&&t._glBuffers[r].refCount++}return this.activateVao(e,i),l[i.id]=c,l[s]=c,a.bindVertexArray(null),o.unbind(VW.ARRAY_BUFFER),c}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const n=e.glVertexArrayObjects[this.CONTEXT_UID],a=this.gl,r=e.buffers,o=this.renderer?.buffer;if(e.disposeRunner.remove(this),n){if(o)for(let e=0;e<r.length;e++){const n=r[e]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0===n.refCount&&!t&&o.dispose(r[e],t))}if(!t)for(const e in n)if("g"===e[0]){const t=n[e];this._activeVao===t&&this.unbind(),a.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let n=0;n<t.length;n++)this.disposeGeometry(this.managedGeometries[t[n]],e)}activateVao(e,t){const n=this.gl,a=this.CONTEXT_UID,r=this.renderer.buffer,o=e.buffers,i=e.attributes;e.indexBuffer&&r.bind(e.indexBuffer);let s=null;for(const e in i){const l=i[e],c=o[l.buffer],d=c._glBuffers[a];if(t.attributeData[e]){s!==d&&(r.bind(c),s=d);const a=t.attributeData[e].location;if(n.enableVertexAttribArray(a),n.vertexAttribPointer(a,l.size,l.type||n.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(a,l.divisor)}}}}draw(e,t,n,a){const{gl:r}=this,o=this._activeGeometry;if(o.indexBuffer){const i=o.indexBuffer.data.BYTES_PER_ELEMENT,s=2===i?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===i||4===i&&this.canUseUInt32ElementIndex?o.instanced?r.drawElementsInstanced(e,t||o.indexBuffer.data.length,s,(n||0)*i,a||1):r.drawElements(e,t||o.indexBuffer.data.length,s,(n||0)*i):console.warn("unsupported index buffer type: uint32")}else o.instanced?r.drawArraysInstanced(e,n,t||o.getSize(),a||1):r.drawArrays(e,n,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}jK.extension={type:KX.RendererSystem,name:"geometry"},eJ.add(jK);const UK=new zJ;class qK{constructor(e,t){this._texture=e,this.mapCoord=new zJ,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);const n=this.mapCoord;for(let a=0;a<e.length;a+=2){const r=e[a],o=e[a+1];t[a]=r*n.a+o*n.c+n.tx,t[a+1]=r*n.b+o*n.d+n.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const n=t._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const a=t.orig,r=t.trim;r&&(UK.set(a.width/r.width,0,0,a.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(UK));const o=t.baseTexture,i=this.uClampFrame,s=this.clampMargin/o.resolution,l=this.clampOffset;return i[0]=(t._frame.x+s+l)/o.width,i[1]=(t._frame.y+s+l)/o.height,i[2]=(t._frame.x+t._frame.width-s+l)/o.width,i[3]=(t._frame.y+t._frame.height-s+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&0===t.rotate,!0}}class GK extends vK{constructor(e,t,n){let a=null;"string"!=typeof e&&void 0===t&&void 0===n&&(a=e,e=void 0,t=void 0,n=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",t||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",n),this.maskSprite=a,this.maskMatrix=new zJ}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,n,a){const r=this._maskSprite,o=r._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new qK(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,r).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,n,a))}}class HK{constructor(e=null){this.type=NW.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=vK.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=NW.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class YK{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let n=t;if(!n.isMaskData){const e=this.maskDataPool.pop()||new HK;e.pooled=!0,e.maskObject=t,n=e}const a=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(a),n._colorMask=a?a._colorMask:15,n.autoDetect&&this.detect(n),n._target=e,n.type!==NW.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case NW.SCISSOR:this.renderer.scissor.push(n);break;case NW.STENCIL:this.renderer.stencil.push(n);break;case NW.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case NW.COLOR:this.pushColorMask(n)}n.type===NW.SPRITE&&this.maskStack.push(n)}pop(e){const t=this.maskStack.pop();if(t&&t._target===e){if(t.enabled)switch(t.type){case NW.SCISSOR:this.renderer.scissor.pop(t);break;case NW.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case NW.SPRITE:this.popSpriteMask(t);break;case NW.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===NW.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=NW.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=NW.SCISSOR:e.type=NW.STENCIL:e.type=NW.COLOR}pushSpriteMask(e){const{maskObject:t}=e,n=e._target;let a=e._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new GK])),a[0].resolution=e.resolution,a[0].multisample=e.multisample,a[0].maskSprite=t;const r=n.filterArea;n.filterArea=t.getBounds(!0),this.renderer.filter.push(n,a),n.filterArea=r,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,n=e._colorMask=t&e.colorMask;n!==t&&this.renderer.gl.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}popColorMask(e){const t=e._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==t&&this.renderer.gl.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}destroy(){this.renderer=null}}YK.extension={type:KX.RendererSystem,name:"mask"},eJ.add(YK);class WK{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,n=this.getStackLength();this.maskStack=e;const a=this.getStackLength();a!==n&&(0===a?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const XK=new zJ,JK=[],KK=class e extends WK{constructor(e){super(e),this.glConst=CW.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:n}=e,{renderer:a}=this,r=a.renderTexture,o=n.getBounds(!0,JK.pop()??new AJ);this.roundFrameToPixels(o,r.current?r.current.resolution:a.resolution,r.sourceFrame,r.destinationFrame,a.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:n,c:a,d:r}=e;return(Math.abs(n)>1e-4||Math.abs(a)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:n}=t;if(!n.isFastRect||!n.isFastRect()||e.isMatrixRotated(n.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const a=t._scissorRectLocal;return a.width>0&&a.height>0}roundFrameToPixels(t,n,a,r,o){e.isMatrixRotated(o)||((o=o?XK.copyFrom(o):XK.identity()).translate(-a.x,-a.y).scale(r.width/a.width,r.height/a.height).translate(r.x,r.y),this.renderer.filter.transformAABB(o,t),t.fit(r),t.x=Math.round(t.x*n),t.y=Math.round(t.y*n),t.width=Math.round(t.width*n),t.height=Math.round(t.height*n))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&JK.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};KK.extension={type:KX.RendererSystem,name:"scissor"};let ZK=KK;eJ.add(ZK);class QK extends WK{constructor(e){super(e),this.glConst=CW.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:n}=this.renderer,a=e._stencilCounter;0===a&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),e._stencilCounter++;const r=e._colorMask;0!==r&&(e._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,a,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(e._colorMask=r,n.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}pop(e){const t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,a=n?n._colorMask:15;0!==a&&(n._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==a&&(n._colorMask=a,t.colorMask(!!(1&a),!!(2&a),!!(4&a),!!(8&a))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}QK.extension={type:KX.RendererSystem,name:"stencil"},eJ.add(QK);class eZ{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(JW("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(JW("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(JW("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}eZ.extension={type:[KX.RendererSystem,KX.CanvasRendererSystem],name:"_plugin"},eJ.add(eZ);class tZ{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new zJ,this.transform=null}update(e,t,n,a){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,a),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(e,t,n,a){const r=this.projectionMatrix,o=a?-1:1;r.identity(),r.a=1/t.width*2,r.d=o*(1/t.height*2),r.tx=-1-t.x*r.a,r.ty=-o-t.y*r.d}setTransform(e){}destroy(){this.renderer=null}}tZ.extension={type:KX.RendererSystem,name:"projection"},eJ.add(tZ);const nZ=new GJ,aZ=new AJ;class rZ{constructor(e){this.renderer=e,this._tempMatrix=new zJ}generateTexture(e,t){const{region:n,...a}=t||{},r=n?.copyTo(aZ)||e.getLocalBounds(aZ,!0),o=a.resolution||this.renderer.resolution;r.width=Math.max(r.width,1/o),r.height=Math.max(r.height,1/o),a.width=r.width,a.height=r.height,a.resolution=o,a.multisample??(a.multisample=this.renderer.multisample);const i=DK.create(a);this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const s=e.transform;return e.transform=nZ,this.renderer.render(e,{renderTexture:i,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=s,i}destroy(){}}rZ.extension={type:[KX.RendererSystem,KX.CanvasRendererSystem],name:"textureGenerator"},eJ.add(rZ);const oZ=new AJ,iZ=new AJ;class sZ{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new AJ,this.destinationFrame=new AJ,this.viewportFrame=new AJ}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,n){const a=this.renderer;let r,o,i;this.current=e,e?(r=e.baseTexture,i=r.resolution,t||(oZ.width=e.frame.width,oZ.height=e.frame.height,t=oZ),n||(iZ.x=e.frame.x,iZ.y=e.frame.y,iZ.width=t.width,iZ.height=t.height,n=iZ),o=r.framebuffer):(i=a.resolution,t||(oZ.width=a._view.screen.width,oZ.height=a._view.screen.height,t=oZ),n||((n=oZ).width=t.width,n.height=t.height));const s=this.viewportFrame;s.x=n.x*i,s.y=n.y*i,s.width=n.width*i,s.height=n.height*i,e||(s.y=a.view.height-(s.y+s.height)),s.ceil(),this.renderer.framebuffer.bind(o,s),this.renderer.projection.update(n,t,i,!o),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(n)}clear(e,t){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,a=TX.shared.setValue(e||n);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&a.premultiply(a.alpha);const r=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,i=r.width!==o.width||r.height!==o.height;if(i){let{x:e,y:t,width:n,height:a}=this.viewportFrame;e=Math.round(e),t=Math.round(t),n=Math.round(n),a=Math.round(a),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,n,a)}this.renderer.framebuffer.clear(a.red,a.green,a.blue,a.alpha,t),i&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}sZ.extension={type:KX.RendererSystem,name:"renderTexture"},eJ.add(sZ);class lZ{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function cZ(e,t,n){const a=e.createShader(t);return e.shaderSource(a,n),e.compileShader(a),a}function dZ(e){const t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function uZ(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return dZ(2*t);case"bvec3":return dZ(3*t);case"bvec4":return dZ(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function mZ(e,t){const n=e.getShaderSource(t).split("\n").map((e,t)=>`${t}: ${e}`),a=e.getShaderInfoLog(t),r=a.split("\n"),o={},i=r.map(e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(e=>!(!e||o[e]||(o[e]=!0,0))),s=[""];i.forEach(e=>{n[e-1]=`%c${n[e-1]}%c`,s.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=n.join("\n");s[0]=l,console.error(a),console.groupCollapsed("click to view full shader code"),console.warn(...s),console.groupEnd()}function pZ(e,t,n,a,r){n.buffer.update(r)}const gZ={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},hZ={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let fZ,vZ=0;const bZ={textureCount:0,uboCount:0};class yZ{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=vZ++}systemCheck(){if(!function(){if("boolean"==typeof fZ)return fZ;try{fZ=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{fZ=!1}return fZ}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const n=e.program,a=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==n&&(this.program=n,this.gl.useProgram(a.program)),t||(bZ.textureCount=0,bZ.uboCount=0,this.syncUniformGroup(e.uniformGroup,bZ)),a}setUniforms(e){const t=this.shader.program,n=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(n.uniformData,e,this.renderer)}syncUniformGroup(e,t){const n=this.getGlProgram();(!e.static||e.dirtyId!==n.uniformDirtyGroups[e.id])&&(n.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,n,t))}syncUniforms(e,t,n){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,n)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const a in e.uniforms){const r=t[a];if(!r){!0===e.uniforms[a]?.group&&(e.uniforms[a].ubo?n.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${a}, '${a}');\n                    `):n.push(`\n                        renderer.shader.syncUniformGroup(uv.${a}, syncData);\n                    `));continue}const o=e.uniforms[a];let i=!1;for(let e=0;e<HJ.length;e++)if(HJ[e].test(r,o)){n.push(HJ[e].code(a,o)),i=!0;break}if(!i){const e=(1!==r.size||r.isArray?WJ:YJ)[r.type].replace("location",`ud["${a}"].location`);n.push(`\n            cu = ud["${a}"];\n            cv = cu.value;\n            v = uv["${a}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const n=this.getGlProgram();if(!e.static||0!==e.dirtyId||!n.uniformGroups[e.id]){e.dirtyId=0;const a=n.uniformGroups[e.id]||this.createSyncBufferGroup(e,n,t);e.buffer.update(),a(n.uniformData,e.uniforms,this.renderer,bZ,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,n.uniformBufferBindings[t])}createSyncBufferGroup(e,t,n){const{gl:a}=this.renderer;this.renderer.buffer.bind(e.buffer);const r=this.gl.getUniformBlockIndex(t.program,n);t.uniformBufferBindings[n]=this.shader.uniformBindCount,a.uniformBlockBinding(t.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let i=this._uboCache[o];if(i||(i=this._uboCache[o]=function(e,t){if(!e.autoManage)return{size:0,syncFunc:pZ};const n=function(e,t){const n=[];for(const a in e)t[a]&&n.push(t[a]);return n.sort((e,t)=>e.index-t.index),n}(e.uniforms,t),{uboElements:a,size:r}=function(e){const t=e.map(e=>({data:e,offset:0,dataLen:0,dirty:0}));let n=0,a=0,r=0;for(let e=0;e<t.length;e++){const o=t[e];if(n=hZ[o.data.type],o.data.size>1&&(n=Math.max(n,16)*o.data.size),o.dataLen=n,a%n!==0&&a<16){const e=a%n%16;a+=e,r+=e}a+n>16?(r=16*Math.ceil(r/16),o.offset=r,r+=n,a=n):(o.offset=r,a+=n,r+=n)}return r=16*Math.ceil(r/16),{uboElements:t,size:r}}(n),o=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let t=0;t<a.length;t++){const n=a[t],r=e.uniforms[n.data.name],i=n.data.name;let s=!1;for(let e=0;e<HJ.length;e++){const t=HJ[e];if(t.codeUbo&&t.test(n.data,r)){o.push(`offset = ${n.offset/4};`,HJ[e].codeUbo(n.data.name,r)),s=!0;break}}if(!s)if(n.data.size>1){const e=QJ(n.data.type),t=Math.max(hZ[n.data.type]/16,1),a=e/t,r=(4-a%4)%4;o.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${n.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${n.data.size*t}; i++)\n                {\n                    for(var j = 0; j < ${a}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const e=gZ[n.data.type];o.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${n.offset/4};\n                ${e};\n                `)}}return o.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join("\n"))}}(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(i.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=i.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,n){const a=e.uniforms,r=[`${n}-`];for(const e in a)r.push(e),t[e]&&r.push(t[e].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,n=e.program,a=function(e,t){const n=cZ(e,e.VERTEX_SHADER,t.vertexSrc),a=cZ(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,n),e.attachShader(r,a);const o=t.extra?.transformFeedbackVaryings;if(o&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,o.names,"separate"===o.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||function(e,t,n,a){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(n,e.COMPILE_STATUS)||mZ(e,n),e.getShaderParameter(a,e.COMPILE_STATUS)||mZ(e,a),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}(e,r,n,a),t.attributeData=function(e,t){const n={},a=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<a;r++){const a=t.getActiveAttrib(e,r);if(a.name.startsWith("gl_"))continue;const o=nK(t,a.type),i={type:o,name:a.name,size:QJ(o),location:t.getAttribLocation(e,a.name)};n[a.name]=i}return n}(r,e),t.uniformData=function(e,t){const n={},a=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<a;r++){const a=t.getActiveUniform(e,r),o=a.name.replace(/\[.*?\]$/,""),i=!!a.name.match(/\[.*?\]$/),s=nK(t,a.type);n[o]={name:o,index:r,type:s,size:a.size,isArray:i,value:uZ(s,a.size)}}return n}(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const n=Object.keys(t.attributeData);n.sort((e,t)=>e>t?1:-1);for(let a=0;a<n.length;a++)t.attributeData[n[a]].location=a,e.bindAttribLocation(r,a,n[a]);e.linkProgram(r)}e.deleteShader(n),e.deleteShader(a);const i={};for(const n in t.uniformData){const a=t.uniformData[n];i[n]={location:e.getUniformLocation(r,n),value:uZ(a.type,a.size)}}return new lZ(r,i)}(t,n);return n.glPrograms[this.renderer.CONTEXT_UID]=a,a}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}yZ.extension={type:KX.RendererSystem,name:"shader"},eJ.add(yZ);class xZ{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}xZ.defaultOptions={hello:!1},xZ.extension={type:[KX.RendererSystem,KX.CanvasRendererSystem],name:"startup"},eJ.add(xZ);const kZ=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=uW.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new rJ,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,t=[]){return t[uW.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.ADD]=[e.ONE,e.ONE],t[uW.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.NONE]=[0,0],t[uW.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[uW.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[uW.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[uW.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[uW.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[uW.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[uW.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[uW.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[uW.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[uW.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[uW.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,n=0;for(;t;)1&t&&this.map[n].call(this,!!(e.data&1<<n)),t>>=1,n++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],n=this.gl;2===t.length?n.blendFunc(t[0],t[1]):n.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,n.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const n=this.checks.indexOf(e);t&&-1===n?this.checks.push(e):!t&&-1!==n&&this.checks.splice(n,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};kZ.extension={type:KX.RendererSystem,name:"state"};let wZ=kZ;eJ.add(wZ);class EZ extends YW{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(t=>e.systems[t]),n=[...t,...Object.keys(e.systems).filter(e=>!t.includes(e))];for(const t of n)this.addSystem(e.systems[t],t)}addRunners(...e){e.forEach(e=>{this.runners[e]=new sJ(e)})}addSystem(e,t){const n=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=n,this._systemsHash[t]=n;for(const e in this.runners)this.runners[e].add(n);return this}emitWithCustomOptions(e,t){const n=Object.keys(this._systemsHash);e.items.forEach(a=>{const r=n.find(e=>this._systemsHash[e]===a);a[e.name](t[r])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const NZ=class e{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==wW.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let n=!1;for(let a=0;a<t.length;a++){const r=t[a];r.resource&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[a]=null,n=!0)}if(n){let e=0;for(let n=0;n<t.length;n++)null!==t[n]&&(t[e++]=t[n]);t.length=e}}unload(e){const t=this.renderer.texture,n=e._texture;n&&!n.framebuffer&&t.destroyTexture(n);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}};NZ.defaultMode=wW.AUTO,NZ.defaultMaxIdle=3600,NZ.defaultCheckCountMax=600,NZ.extension={type:KX.RendererSystem,name:"textureGC"};let SZ=NZ;eJ.add(SZ);class VZ{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=hW.UNSIGNED_BYTE,this.internalFormat=pW.RGBA,this.samplerType=0}}class _Z{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new mJ,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[hW.UNSIGNED_BYTE]:{[pW.RGBA]:e.RGBA8,[pW.RGB]:e.RGB8,[pW.RG]:e.RG8,[pW.RED]:e.R8,[pW.RGBA_INTEGER]:e.RGBA8UI,[pW.RGB_INTEGER]:e.RGB8UI,[pW.RG_INTEGER]:e.RG8UI,[pW.RED_INTEGER]:e.R8UI,[pW.ALPHA]:e.ALPHA,[pW.LUMINANCE]:e.LUMINANCE,[pW.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[hW.BYTE]:{[pW.RGBA]:e.RGBA8_SNORM,[pW.RGB]:e.RGB8_SNORM,[pW.RG]:e.RG8_SNORM,[pW.RED]:e.R8_SNORM,[pW.RGBA_INTEGER]:e.RGBA8I,[pW.RGB_INTEGER]:e.RGB8I,[pW.RG_INTEGER]:e.RG8I,[pW.RED_INTEGER]:e.R8I},[hW.UNSIGNED_SHORT]:{[pW.RGBA_INTEGER]:e.RGBA16UI,[pW.RGB_INTEGER]:e.RGB16UI,[pW.RG_INTEGER]:e.RG16UI,[pW.RED_INTEGER]:e.R16UI,[pW.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[hW.SHORT]:{[pW.RGBA_INTEGER]:e.RGBA16I,[pW.RGB_INTEGER]:e.RGB16I,[pW.RG_INTEGER]:e.RG16I,[pW.RED_INTEGER]:e.R16I},[hW.UNSIGNED_INT]:{[pW.RGBA_INTEGER]:e.RGBA32UI,[pW.RGB_INTEGER]:e.RGB32UI,[pW.RG_INTEGER]:e.RG32UI,[pW.RED_INTEGER]:e.R32UI,[pW.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[hW.INT]:{[pW.RGBA_INTEGER]:e.RGBA32I,[pW.RGB_INTEGER]:e.RGB32I,[pW.RG_INTEGER]:e.RG32I,[pW.RED_INTEGER]:e.R32I},[hW.FLOAT]:{[pW.RGBA]:e.RGBA32F,[pW.RGB]:e.RGB32F,[pW.RG]:e.RG32F,[pW.RED]:e.R32F,[pW.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[hW.HALF_FLOAT]:{[pW.RGBA]:e.RGBA16F,[pW.RGB]:e.RGB16F,[pW.RG]:e.RG16F,[pW.RED]:e.R16F},[hW.UNSIGNED_SHORT_5_6_5]:{[pW.RGB]:e.RGB565},[hW.UNSIGNED_SHORT_4_4_4_4]:{[pW.RGBA]:e.RGBA4},[hW.UNSIGNED_SHORT_5_5_5_1]:{[pW.RGBA]:e.RGB5_A1},[hW.UNSIGNED_INT_2_10_10_10_REV]:{[pW.RGBA]:e.RGB10_A2,[pW.RGBA_INTEGER]:e.RGB10_A2UI},[hW.UNSIGNED_INT_10F_11F_11F_REV]:{[pW.RGB]:e.R11F_G11F_B10F},[hW.UNSIGNED_INT_5_9_9_9_REV]:{[pW.RGB]:e.RGB9_E5},[hW.UNSIGNED_INT_24_8]:{[pW.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[hW.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[pW.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[hW.UNSIGNED_BYTE]:{[pW.RGBA]:e.RGBA,[pW.RGB]:e.RGB,[pW.ALPHA]:e.ALPHA,[pW.LUMINANCE]:e.LUMINANCE,[pW.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[hW.UNSIGNED_SHORT_5_6_5]:{[pW.RGB]:e.RGB},[hW.UNSIGNED_SHORT_4_4_4_4]:{[pW.RGBA]:e.RGBA},[hW.UNSIGNED_SHORT_5_5_5_1]:{[pW.RGBA]:e.RGBA}},t}(e),this.samplerTypes=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:fW.FLOAT,[e.RGBA]:fW.FLOAT,[e.ALPHA]:fW.FLOAT,[e.LUMINANCE]:fW.FLOAT,[e.LUMINANCE_ALPHA]:fW.FLOAT,[e.R8]:fW.FLOAT,[e.R8_SNORM]:fW.FLOAT,[e.RG8]:fW.FLOAT,[e.RG8_SNORM]:fW.FLOAT,[e.RGB8]:fW.FLOAT,[e.RGB8_SNORM]:fW.FLOAT,[e.RGB565]:fW.FLOAT,[e.RGBA4]:fW.FLOAT,[e.RGB5_A1]:fW.FLOAT,[e.RGBA8]:fW.FLOAT,[e.RGBA8_SNORM]:fW.FLOAT,[e.RGB10_A2]:fW.FLOAT,[e.RGB10_A2UI]:fW.FLOAT,[e.SRGB8]:fW.FLOAT,[e.SRGB8_ALPHA8]:fW.FLOAT,[e.R16F]:fW.FLOAT,[e.RG16F]:fW.FLOAT,[e.RGB16F]:fW.FLOAT,[e.RGBA16F]:fW.FLOAT,[e.R32F]:fW.FLOAT,[e.RG32F]:fW.FLOAT,[e.RGB32F]:fW.FLOAT,[e.RGBA32F]:fW.FLOAT,[e.R11F_G11F_B10F]:fW.FLOAT,[e.RGB9_E5]:fW.FLOAT,[e.R8I]:fW.INT,[e.R8UI]:fW.UINT,[e.R16I]:fW.INT,[e.R16UI]:fW.UINT,[e.R32I]:fW.INT,[e.R32UI]:fW.UINT,[e.RG8I]:fW.INT,[e.RG8UI]:fW.UINT,[e.RG16I]:fW.INT,[e.RG16UI]:fW.UINT,[e.RG32I]:fW.INT,[e.RG32UI]:fW.UINT,[e.RGB8I]:fW.INT,[e.RGB8UI]:fW.UINT,[e.RGB16I]:fW.INT,[e.RGB16UI]:fW.UINT,[e.RGB32I]:fW.INT,[e.RGB32UI]:fW.UINT,[e.RGBA8I]:fW.INT,[e.RGBA8UI]:fW.UINT,[e.RGBA16I]:fW.INT,[e.RGBA16UI]:fW.UINT,[e.RGBA32I]:fW.INT,[e.RGBA32UI]:fW.UINT,[e.DEPTH_COMPONENT16]:fW.FLOAT,[e.DEPTH_COMPONENT24]:fW.FLOAT,[e.DEPTH_COMPONENT32F]:fW.FLOAT,[e.DEPTH_STENCIL]:fW.FLOAT,[e.DEPTH24_STENCIL8]:fW.FLOAT,[e.DEPTH32F_STENCIL8]:fW.FLOAT}:{[e.RGB]:fW.FLOAT,[e.RGBA]:fW.FLOAT,[e.ALPHA]:fW.FLOAT,[e.LUMINANCE]:fW.FLOAT,[e.LUMINANCE_ALPHA]:fW.FLOAT,[e.DEPTH_STENCIL]:fW.FLOAT},t}(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};const n=new VZ(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new VZ(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){const{gl:n}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const a=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(e.target,a.texture)),a.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),this.updateTexture(e)):a.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<n.length;e++)n[e]===this.unknownTexture&&this.bind(null,e)}for(let a=0;a<n.length;a++)n[a]===e&&(this.currentLocation!==a&&(t.activeTexture(t.TEXTURE0+a),this.currentLocation=a),t.bindTexture(e.target,this.emptyTextures[e.target].texture),n[a]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:n,CONTEXT_UID:a}=this;if(n)for(let n=e-1;n>=0;--n){const e=t[n];e&&e._glTextures[a].samplerType!==fW.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const t=new VZ(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??fW.FLOAT,2===this.webGLVersion&&e.type===hW.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const n=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(n,e,t))t.samplerType!==fW.FLOAT&&(this.hasIntegerTextures=!0);else{const a=e.realWidth,r=e.realHeight,o=n.gl;(t.width!==a||t.height!==r||t.dirtyId<0)&&(t.width=a,t.height=r,o.texImage2D(e.target,0,t.internalFormat,a,r,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:n}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),n.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);-1!==t&&$X(this.managedTextures,t,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==yW.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=bW.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const n=this.gl;if(t.mipmap&&e.mipmap!==yW.ON_MANUAL&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,t.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===vW.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===vW.LINEAR){const a=Math.min(e.anisotropicLevel,n.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,a)}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===vW.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===vW.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}_Z.extension={type:KX.RendererSystem,name:"texture"},eJ.add(_Z);class CZ{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,a=e._glTransformFeedbacks[n]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,a)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:n,renderer:a}=this;t&&a.shader.bind(t),n.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:n,CONTEXT_UID:a}=this,r=t.createTransformFeedback();e._glTransformFeedbacks[a]=r,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r);for(let r=0;r<e.buffers.length;r++){const o=e.buffers[r];o&&(n.buffer.update(o),o._glBuffers[a].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,r,o._glBuffers[a].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),r}disposeTransformFeedback(e,t){const n=e._glTransformFeedbacks[this.CONTEXT_UID],a=this.gl;e.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let n=0;n<e.buffers.length;n++){const a=e.buffers[n];if(!a)continue;const o=a._glBuffers[this.CONTEXT_UID];o&&(o.refCount--,0===o.refCount&&!t&&r.dispose(a,t))}n&&(t||a.deleteTransformFeedback(n),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}CZ.extension={type:KX.RendererSystem,name:"transformFeedback"},eJ.add(CZ);class AZ{constructor(e){this.renderer=e}init(e){this.screen=new AJ(0,0,e.width,e.height),this.element=e.view||CW.ADAPTER.createCanvas(),this.resolution=e.resolution||CW.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const n=this.element.width/this.resolution,a=this.element.height/this.resolution;this.screen.width=n,this.screen.height=a,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${a}px`),this.renderer.emit("resize",n,a),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}AZ.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},AZ.extension={type:[KX.RendererSystem,KX.CanvasRendererSystem],name:"_view"},eJ.add(AZ),CW.PREFER_ENV=lW.WEBGL2,CW.STRICT_TEXTURE_CACHE=!1,CW.RENDER_OPTIONS={...kK.defaultOptions,...bK.defaultOptions,...AZ.defaultOptions,...xZ.defaultOptions},Object.defineProperties(CW,{WRAP_MODE:{get:()=>mJ.defaultOptions.wrapMode,set(e){JW("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),mJ.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>mJ.defaultOptions.scaleMode,set(e){JW("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),mJ.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>mJ.defaultOptions.mipmap,set(e){JW("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),mJ.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>mJ.defaultOptions.anisotropicLevel,set(e){JW("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),mJ.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(JW("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),vK.defaultResolution),set(e){vK.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(JW("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),vK.defaultMultisample),set(e){vK.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>hK.defaultMaxTextures,set(e){JW("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),hK.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>hK.defaultBatchSize,set(e){JW("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),hK.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>hK.canUploadSameBuffer,set(e){JW("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),hK.canUploadSameBuffer=e}},GC_MODE:{get:()=>SZ.defaultMode,set(e){JW("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),SZ.defaultMode=e}},GC_MAX_IDLE:{get:()=>SZ.defaultMaxIdle,set(e){JW("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),SZ.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>SZ.defaultCheckCountMax,set(e){JW("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),SZ.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>sK.defaultVertexPrecision,set(e){JW("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),sK.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>sK.defaultFragmentPrecision,set(e){JW("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),sK.defaultFragmentPrecision=e}}});var DZ=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(DZ||{});class TZ{constructor(e,t=null,n=0,a=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=n,this.once=a}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const BZ=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TZ(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,n=DZ.NORMAL){return this._addListener(new TZ(e,t,n))}addOnce(e,t,n=DZ.NORMAL){return this._addListener(new TZ(e,t,n,!0))}_addListener(e){let t=this._head.next,n=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(n);break}n=t,t=t.next}e.previous||e.connect(n)}else e.connect(n);return this._startIfPossible(),this}remove(e,t){let n=this._head.next;for(;n;)n=n.match(e,t)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let n;if(t>this.lastTime){if(n=this.elapsedMS=t-this.lastTime,n>this._maxElapsedMS&&(n=this._maxElapsedMS),n*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=n,this.deltaTime=this.deltaMS*e.targetFPMS;const a=this._head;let r=a.next;for(;r;)r=r.emit(this.deltaTime);a.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const n=Math.min(this.maxFPS,t),a=Math.min(Math.max(0,n)/1e3,e.targetFPMS);this._maxElapsedMS=1/a}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){const t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){const t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};BZ.targetFPMS=.06;let IZ=BZ;Object.defineProperties(CW,{TARGET_FPMS:{get:()=>IZ.targetFPMS,set(e){JW("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),IZ.targetFPMS=e}}});class zZ{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,DZ.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?IZ.shared:new IZ,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}zZ.extension=KX.Application,eJ.add(zZ);const MZ=[];eJ.handleByList(KX.Renderer,MZ);const PZ="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class RZ{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){const n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{const n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}t>=SW.HIGH?this.multisample=SW.HIGH:t>=SW.MEDIUM?this.multisample=SW.MEDIUM:t>=SW.LOW?this.multisample=SW.LOW:this.multisample=SW.NONE}destroy(){}}RZ.extension={type:KX.RendererSystem,name:"_multisample"},eJ.add(RZ);class $Z{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class OZ{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,a=e._glBuffers[n]||this.createGLBuffer(e);t.bindBuffer(e.type,a.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:n,CONTEXT_UID:a}=this;if(this.boundBufferBases[t]!==e){const r=e._glBuffers[a]||this.createGLBuffer(e);this.boundBufferBases[t]=e,n.bindBufferBase(n.UNIFORM_BUFFER,t,r.buffer)}}bindBufferRange(e,t,n){const{gl:a,CONTEXT_UID:r}=this;n=n||0;const o=e._glBuffers[r]||this.createGLBuffer(e);a.bindBufferRange(a.UNIFORM_BUFFER,t||0,o.buffer,256*n,256)}update(e){const{gl:t,CONTEXT_UID:n}=this,a=e._glBuffers[n]||this.createGLBuffer(e);if(e._updateID!==a.updateID)if(a.updateID=e._updateID,t.bindBuffer(e.type,a.buffer),a.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;a.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const n=e._glBuffers[this.CONTEXT_UID],a=this.gl;e.disposeRunner.remove(this),n&&(t||a.deleteBuffer(n.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let n=0;n<t.length;n++)this.dispose(this.managedBuffers[t[n]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:n}=this;return e._glBuffers[t]=new $Z(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}OZ.extension={type:KX.RendererSystem,name:"buffer"},eJ.add(OZ);class LZ{constructor(e){this.renderer=e}render(e,t){const n=this.renderer;let a,r,o,i;if(t&&(a=t.renderTexture,r=t.clear,o=t.transform,i=t.skipUpdateTransform),this.renderingToScreen=!a,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=o,!n.context.isLost){if(a||(this.lastObjectRendered=e),!i){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}n.renderTexture.bind(a),n.batch.currentRenderer.start(),(r??n.background.clearBeforeRender)&&n.renderTexture.clear(),e.render(n),n.batch.currentRenderer.flush(),a&&(t.blit&&n.framebuffer.blit(),a.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}LZ.extension={type:KX.RendererSystem,name:"objectRenderer"},eJ.add(LZ);const FZ=class e extends EZ{constructor(t){super(),this.type=cW.WEBGL,t=Object.assign({},CW.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new cK({projectionMatrix:new zJ},!0);const n={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(n),"useContextAlpha"in t&&(JW("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&(typeof tX>"u"&&(tX=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:CW.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!CW.ADAPTER.getWebGLRenderingContext())return!1;const t=CW.ADAPTER.createCanvas();let n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const a=!!n?.getContextAttributes()?.stencil;if(n){const e=n.getExtension("WEBGL_lose_context");e&&e.loseContext()}return n=null,a}catch{return!1}}()),tX)}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return JW("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return JW("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return JW("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return JW("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){JW("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return JW("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){JW("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return JW("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};FZ.extension={type:KX.Renderer,priority:1},FZ.__plugins={},FZ.__systems={};let jZ=FZ;eJ.handleByMap(KX.RendererPlugin,jZ.__plugins),eJ.handleByMap(KX.RendererSystem,jZ.__systems),eJ.add(jZ);class UZ extends lJ{constructor(e,t){const{width:n,height:a}=t||{};super(n,a),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){const e=new mJ;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let n=0;n<this.length;n++)e[n]&&(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof lJ?this.addResourceAt(e[n],n):this.addResourceAt(iJ(e[n],t),n))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(e).then(()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)}),this._load}}const qZ=class e extends UZ{constructor(t,n){const{width:a,height:r,autoLoad:o,linkBaseTexture:i}=n||{};if(t&&t.length!==e.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:a,height:r});for(let t=0;t<e.SIDES;t++)this.items[t].target=gW.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==i,t&&this.initFromArray(t,n),!1!==o&&this.load()}bind(e){super.bind(e),e.target=gW.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=gW.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(t,n,a){const r=this.itemDirtyIds;for(let o=0;o<e.SIDES;o++){const e=this.items[o];(r[o]<e.dirtyId||a.dirtyId<n.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(t,e,a),r[o]=e.dirtyId):r[o]<-1&&(t.gl.texImage2D(e.target,0,a.internalFormat,n.realWidth,n.realHeight,0,n.format,a.type,null),r[o]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===e.SIDES}};qZ.SIDES=6;let GZ=qZ;class HZ extends NK{constructor(e,t){let n,a,r;t=t||{},"string"==typeof e?(n=HZ.EMPTY,a=e,r=!0):(n=e,a=null,r=!1),super(n),this.url=a,this.crossOrigin=t.crossOrigin??!0,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??r,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(async(e,t)=>{if(null!==this.url)try{const t=await CW.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await t.blob();if(this.destroyed)return;const a=await createImageBitmap(n,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===xW.UNPACK?"premultiply":"none"});if(this.destroyed)return void a.close();this.source=a,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}else e(this)})),this._load}upload(e,t,n){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,n)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return HZ._EMPTY=HZ._EMPTY??CW.ADAPTER.createCanvas(0,0),HZ._EMPTY}}const YZ=class e extends NK{constructor(e,t){t=t||{},super(CW.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const e=new Image;NK.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,n=e.height;if(!t||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let a=t*this.scale,r=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(a=this._overrideWidth||this._overrideHeight/n*t,r=this._overrideHeight||this._overrideWidth/t*n),a=Math.round(a),r=Math.round(r);const o=this.source;o.width=a,o.height=r,o._pixiId=`canvas_${FX()}`,o.getContext("2d").drawImage(e,0,0,t,n,0,0,a,r),this._resolve(),this._resolve=null}}static getSize(t){const n=e.SVG_SIZE.exec(t),a={};return n&&(a[n[1]]=Math.round(parseFloat(n[3])),a[n[5]]=Math.round(parseFloat(n[7]))),a}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,n){return"svg"===n||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&e.SVG_XML.test(t)}};YZ.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,YZ.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let WZ=YZ;const XZ=class e extends NK{constructor(t,n){if(n=n||{},!(t instanceof HTMLVideoElement)){const a=document.createElement("video");!1!==n.autoLoad&&a.setAttribute("preload","auto"),!1!==n.playsinline&&(a.setAttribute("webkit-playsinline",""),a.setAttribute("playsinline","")),!0===n.muted&&(a.setAttribute("muted",""),a.muted=!0),!0===n.loop&&a.setAttribute("loop",""),!1!==n.autoPlay&&a.setAttribute("autoplay",""),"string"==typeof t&&(t=[t]);const r=t[0].src||t[0];NK.crossOrigin(a,r,n.crossorigin);for(let n=0;n<t.length;++n){const r=document.createElement("source");let{src:o,mime:i}=t[n];if(o=o||t[n],o.startsWith("data:"))i=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const t=o.split("?").shift().toLowerCase(),n=t.slice(t.lastIndexOf(".")+1);i=i||e.MIME_TYPES[n]||`video/${n}`}r.src=o,i&&(r.type=i),a.appendChild(r)}t=a}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=n.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==n.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==n.autoLoad&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const e=IZ.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,n)=>{this.valid?t(this):(this._resolve=t,this._reject=n,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(IZ.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(IZ.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(IZ.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,n){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.includes(n)}};XZ.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],XZ.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let JZ=XZ;oJ.push(HZ,SK,class extends NK{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},JZ,class extends NK{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},WZ,cJ,GZ,class extends UZ{constructor(e,t){const{width:n,height:a}=t||{};let r,o;Array.isArray(e)?(r=e,o=e.length):o=e,super(o,{width:n,height:a}),r&&this.initFromArray(r,t)}addBaseTextureAt(e,t){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,t),this}bind(e){super.bind(e),e.target=gW.TEXTURE_2D_ARRAY}upload(e,t,n){const{length:a,itemDirtyIds:r,items:o}=this,{gl:i}=e;n.dirtyId<0&&i.texImage3D(i.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,a,0,t.format,n.type,null);for(let e=0;e<a;e++){const a=o[e];r[e]<a.dirtyId&&(r[e]=a.dirtyId,a.valid&&i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,e,a.resource.width,a.resource.height,1,t.format,n.type,a.resource.source))}return!0}});class KZ{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?AJ.EMPTY:((e=e||new AJ(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:n,b:a,c:r,d:o,tx:i,ty:s}=e,l=n*t.x+r*t.y+i,c=a*t.x+o*t.y+s;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(e){let t=this.minX,n=this.minY,a=this.maxX,r=this.maxY,o=e[0],i=e[1];t=o<t?o:t,n=i<n?i:n,a=o>a?o:a,r=i>r?i:r,o=e[2],i=e[3],t=o<t?o:t,n=i<n?i:n,a=o>a?o:a,r=i>r?i:r,o=e[4],i=e[5],t=o<t?o:t,n=i<n?i:n,a=o>a?o:a,r=i>r?i:r,o=e[6],i=e[7],t=o<t?o:t,n=i<n?i:n,a=o>a?o:a,r=i>r?i:r,this.minX=t,this.minY=n,this.maxX=a,this.maxY=r}addFrame(e,t,n,a,r){this.addFrameMatrix(e.worldTransform,t,n,a,r)}addFrameMatrix(e,t,n,a,r){const o=e.a,i=e.b,s=e.c,l=e.d,c=e.tx,d=e.ty;let u=this.minX,m=this.minY,p=this.maxX,g=this.maxY,h=o*t+s*n+c,f=i*t+l*n+d;u=h<u?h:u,m=f<m?f:m,p=h>p?h:p,g=f>g?f:g,h=o*a+s*n+c,f=i*a+l*n+d,u=h<u?h:u,m=f<m?f:m,p=h>p?h:p,g=f>g?f:g,h=o*t+s*r+c,f=i*t+l*r+d,u=h<u?h:u,m=f<m?f:m,p=h>p?h:p,g=f>g?f:g,h=o*a+s*r+c,f=i*a+l*r+d,u=h<u?h:u,m=f<m?f:m,p=h>p?h:p,g=f>g?f:g,this.minX=u,this.minY=m,this.maxX=p,this.maxY=g}addVertexData(e,t,n){let a=this.minX,r=this.minY,o=this.maxX,i=this.maxY;for(let s=t;s<n;s+=2){const t=e[s],n=e[s+1];a=t<a?t:a,r=n<r?n:r,o=t>o?t:o,i=n>i?n:i}this.minX=a,this.minY=r,this.maxX=o,this.maxY=i}addVertices(e,t,n,a){this.addVerticesMatrix(e.worldTransform,t,n,a)}addVerticesMatrix(e,t,n,a,r=0,o=r){const i=e.a,s=e.b,l=e.c,c=e.d,d=e.tx,u=e.ty;let m=this.minX,p=this.minY,g=this.maxX,h=this.maxY;for(let e=n;e<a;e+=2){const n=t[e],a=t[e+1],f=i*n+l*a+d,v=c*a+s*n+u;m=Math.min(m,f-r),g=Math.max(g,f+r),p=Math.min(p,v-o),h=Math.max(h,v+o)}this.minX=m,this.minY=p,this.maxX=g,this.maxY=h}addBounds(e){const t=this.minX,n=this.minY,a=this.maxX,r=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<n?e.minY:n,this.maxX=e.maxX>a?e.maxX:a,this.maxY=e.maxY>r?e.maxY:r}addBoundsMask(e,t){const n=e.minX>t.minX?e.minX:t.minX,a=e.minY>t.minY?e.minY:t.minY,r=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(n<=r&&a<=o){const e=this.minX,t=this.minY,i=this.maxX,s=this.maxY;this.minX=n<e?n:e,this.minY=a<t?a:t,this.maxX=r>i?r:i,this.maxY=o>s?o:s}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const n=e.minX>t.x?e.minX:t.x,a=e.minY>t.y?e.minY:t.y,r=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(n<=r&&a<=o){const e=this.minX,t=this.minY,i=this.maxX,s=this.maxY;this.minX=n<e?n:e,this.minY=a<t?a:t,this.maxX=r>i?r:i,this.maxY=o>s?o:s}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,n,a,r,o){e-=r,t-=o,n+=r,a+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>a?this.maxY:a}}class ZZ extends YW{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new GJ,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new KZ,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let n=0;n<t.length;++n){const a=t[n];Object.defineProperty(ZZ.prototype,a,Object.getOwnPropertyDescriptor(e,a))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new AJ),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new AJ),e=this._localBoundsRect),this._localBounds||(this._localBounds=new KZ);const t=this.transform,n=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=n?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const a=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=n,this.transform=t,this._bounds=a,this._bounds.updateID+=this._boundsID-r,o}toGlobal(e,t,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,n,a){return t&&(e=t.toGlobal(e,n,a)),a||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,n=1,a=1,r=0,o=0,i=0,s=0,l=0){return this.position.x=e,this.position.y=t,this.scale.x=n||1,this.scale.y=a||1,this.rotation=r,this.skew.x=o,this.skew.y=i,this.pivot.x=s,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new QZ),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*NJ}set angle(e){this.transform.rotation=e*SJ}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class QZ extends ZZ{constructor(){super(...arguments),this.sortDirty=null}}ZZ.prototype.displayObjectUpdateTransform=ZZ.prototype.updateTransform;const eQ=new zJ;function tQ(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const nQ=class e extends ZZ{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const n=this.getChildIndex(e),a=this.getChildIndex(t);this.children[n]=t,this.children[a]=e,this.onChildrenChange(n<a?n:a)}getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(e);$X(this.children,n,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],n=this.children.indexOf(t);if(-1===n)return null;t.parent=null,t.transform._parentID=-1,$X(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,$X(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const n=e,a=t-n;let r;if(a>0&&a<=t){r=this.children.splice(n,a);for(let e=0;e<r.length;++e)r[e].parent=null,r[e].transform&&(r[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<r.length;++e)r[e].emit("removed",this),this.emit("childRemoved",r[e],this,e);return r}if(0===a&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,n=this.children.length;t<n;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&0!==n.zIndex&&(e=!0)}e&&this.children.length>1&&this.children.sort(tQ),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const n=super.getLocalBounds(e);if(!t)for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const n=t.renderTexture.sourceFrame;if(!(n.width>0&&n.height>0))return;let a,r;this.cullArea?(a=this.cullArea,r=this.worldTransform):this._render!==e.prototype._render&&(a=this.getBounds(!0));const o=t.projection.transform;if(o&&(r?(r=eQ.copyFrom(r),r.prepend(o)):r=o),a&&n.intersects(a,r))this._render(t);else if(this.cullArea)return;for(let e=0,n=this.children.length;e<n;++e){const n=this.children[e],a=n.cullable;n.cullable=a||!this.cullArea,n.render(t),n.cullable=a}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,n=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const a=t&&this._enabledFilters?.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==NW.NONE));if(a&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}a&&e.batch.flush(),n&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof e?e:e?.children,n=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<n.length;++t)n[t].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}};nQ.defaultSortableChildren=!1;let aQ=nQ;aQ.prototype.containerUpdateTransform=aQ.prototype.updateTransform,Object.defineProperties(CW,{SORTABLE_CHILDREN:{get:()=>aQ.defaultSortableChildren,set(e){JW("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),aQ.defaultSortableChildren=e}}});const rQ=new _J,oQ=new Uint16Array([0,1,2,0,2,3]);class iQ extends aQ{constructor(e){super(),this._anchor=new UJ(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new TX(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=uW.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||AK.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=oQ,this.pluginName="batch",this.isSprite=!0,this._roundPixels=CW.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=OX(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=OX(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,n=t.a,a=t.b,r=t.c,o=t.d,i=t.tx,s=t.ty,l=this.vertexData,c=e.trim,d=e.orig,u=this._anchor;let m=0,p=0,g=0,h=0;if(c?(p=c.x-u._x*d.width,m=p+c.width,h=c.y-u._y*d.height,g=h+c.height):(p=-u._x*d.width,m=p+d.width,h=-u._y*d.height,g=h+d.height),l[0]=n*p+r*h+i,l[1]=o*h+a*p+s,l[2]=n*m+r*h+i,l[3]=o*h+a*m+s,l[4]=n*m+r*g+i,l[5]=o*g+a*m+s,l[6]=n*p+r*g+i,l[7]=o*g+a*p+s,this._roundPixels){const e=CW.RESOLUTION;for(let t=0;t<l.length;++t)l[t]=Math.round(l[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,n=e.orig,a=this._anchor,r=this.transform.worldTransform,o=r.a,i=r.b,s=r.c,l=r.d,c=r.tx,d=r.ty,u=-a._x*n.width,m=u+n.width,p=-a._y*n.height,g=p+n.height;if(t[0]=o*u+s*p+c,t[1]=l*p+i*u+d,t[2]=o*m+s*p+c,t[3]=l*p+i*m+d,t[4]=o*m+s*g+c,t[5]=l*g+i*m+d,t[6]=o*u+s*g+c,t[7]=l*g+i*u+d,this._roundPixels){const e=CW.RESOLUTION;for(let n=0;n<t.length;++n)t[n]=Math.round(t[n]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new KZ),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new AJ),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,rQ);const t=this._texture.orig.width,n=this._texture.orig.height,a=-t*this.anchor.x;let r=0;return rQ.x>=a&&rQ.x<a+t&&(r=-n*this.anchor.y,rQ.y>=r&&rQ.y<r+n)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){const t="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const n=e instanceof AK?e:AK.from(e,t);return new iQ(n)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=OX(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=OX(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||AK.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const sQ=new zJ;ZZ.prototype._cacheAsBitmap=!1,ZZ.prototype._cacheData=null,ZZ.prototype._cacheAsBitmapResolution=null,ZZ.prototype._cacheAsBitmapMultisample=null;class lQ{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ZZ.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let t;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new lQ),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),ZZ.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},ZZ.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const n=this.getLocalBounds(new AJ,!0);if(this.filters?.length){const e=this.filters[0].padding;n.pad(e)}const a=this.cacheAsBitmapResolution||e.resolution;n.ceil(a),n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a);const r=e.renderTexture.current,o=e.renderTexture.sourceFrame.clone(),i=e.renderTexture.destinationFrame.clone(),s=e.projection.transform,l=DK.create({width:n.width,height:n.height,resolution:a,multisample:this.cacheAsBitmapMultisample??e.multisample}),c=`cacheAsBitmap_${FX()}`;this._cacheData.textureCacheId=c,mJ.addToCache(l.baseTexture,c),AK.addToCache(l,c);const d=this.transform.localTransform.copyTo(sQ).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=s,e.renderTexture.bind(r,o,i),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new iQ(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-n.x/n.width,u.anchor.y=-n.y/n.height,u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},ZZ.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},ZZ.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new AJ,!0),n=this.alpha;this.alpha=1;const a=e.canvasContext.activeContext,r=e._projTransform,o=this.cacheAsBitmapResolution||e.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const i=DK.create({width:t.width,height:t.height,resolution:o}),s=`cacheAsBitmap_${FX()}`;this._cacheData.textureCacheId=s,mJ.addToCache(i.baseTexture,s),AK.addToCache(i,s);const l=sQ;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:i,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=a,e._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const c=new iQ(i);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-t.x/t.width,c.anchor.y=-t.y/t.height,c.alpha=n,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},ZZ.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ZZ.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ZZ.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,mJ.removeFromCache(this._cacheData.textureCacheId),AK.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ZZ.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},ZZ.prototype.name=null,aQ.prototype.getChildByName=function(e,t){for(let t=0,n=this.children.length;t<n;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,n=this.children.length;t<n;t++){const n=this.children[t];if(!n.getChildByName)continue;const a=n.getChildByName(e,!0);if(a)return a}return null},ZZ.prototype.getGlobalPosition=function(e=new _J,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};const cQ={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},dQ=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class uQ extends vK{constructor(e,t=8,n=4,a=vK.defaultResolution,r=5){const o=function(e,t){const n=Math.ceil(e/2);let a,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";a=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let t=0;t<e;t++){let e=a.replace("%index%",t.toString());e=e.replace("%sampleIndex%",t-(n-1)+".0"),o+=e,o+="\n"}return r=r.replace("%blur%",o),r=r.replace("%size%",e.toString()),r}(r,e),i=function(e){const t=cQ[e],n=t.length;let a,r=dQ,o="";for(let r=0;r<e;r++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",r.toString());a=r,r>=n&&(a=e-r-1),i=i.replace("%value%",t[a].toString()),o+=i,o+="\n"}return r=r.replace("%blur%",o),r=r.replace("%size%",e.toString()),r}(r);super(o,i),this.horizontal=e,this.resolution=a,this._quality=0,this.quality=n,this.blur=t}apply(e,t,n,a){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/t.width):this.uniforms.strength=1/n.height*(n.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,n,a);else{const r=e.getFilterTexture(),o=e.renderer;let i=t,s=r;this.state.blend=!1,e.applyFilter(this,i,s,kW.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(i,kW.BLIT),this.uniforms.uSampler=s;const t=s;s=i,i=t,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,s,n,a),e.returnFilterTexture(r)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class mQ extends vK{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(PZ,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e,t=!1){let n=e;t&&(this._multiply(n,this.uniforms.m,e),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(e,t,n){return e[0]=t[0]*n[0]+t[1]*n[5]+t[2]*n[10]+t[3]*n[15],e[1]=t[0]*n[1]+t[1]*n[6]+t[2]*n[11]+t[3]*n[16],e[2]=t[0]*n[2]+t[1]*n[7]+t[2]*n[12]+t[3]*n[17],e[3]=t[0]*n[3]+t[1]*n[8]+t[2]*n[13]+t[3]*n[18],e[4]=t[0]*n[4]+t[1]*n[9]+t[2]*n[14]+t[3]*n[19]+t[4],e[5]=t[5]*n[0]+t[6]*n[5]+t[7]*n[10]+t[8]*n[15],e[6]=t[5]*n[1]+t[6]*n[6]+t[7]*n[11]+t[8]*n[16],e[7]=t[5]*n[2]+t[6]*n[7]+t[7]*n[12]+t[8]*n[17],e[8]=t[5]*n[3]+t[6]*n[8]+t[7]*n[13]+t[8]*n[18],e[9]=t[5]*n[4]+t[6]*n[9]+t[7]*n[14]+t[8]*n[19]+t[9],e[10]=t[10]*n[0]+t[11]*n[5]+t[12]*n[10]+t[13]*n[15],e[11]=t[10]*n[1]+t[11]*n[6]+t[12]*n[11]+t[13]*n[16],e[12]=t[10]*n[2]+t[11]*n[7]+t[12]*n[12]+t[13]*n[17],e[13]=t[10]*n[3]+t[11]*n[8]+t[12]*n[13]+t[13]*n[18],e[14]=t[10]*n[4]+t[11]*n[9]+t[12]*n[14]+t[13]*n[19]+t[14],e[15]=t[15]*n[0]+t[16]*n[5]+t[17]*n[10]+t[18]*n[15],e[16]=t[15]*n[1]+t[16]*n[6]+t[17]*n[11]+t[18]*n[16],e[17]=t[15]*n[2]+t[16]*n[7]+t[17]*n[12]+t[18]*n[17],e[18]=t[15]*n[3]+t[16]*n[8]+t[17]*n[13]+t[18]*n[18],e[19]=t[15]*n[4]+t[16]*n[9]+t[17]*n[14]+t[18]*n[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}tint(e,t){const[n,a,r]=TX.shared.setValue(e).toArray(),o=[n,0,0,0,0,0,a,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){const n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){e=(e||0)/180*Math.PI;const n=Math.cos(e),a=Math.sin(e),r=1/3,o=(0,Math.sqrt)(r),i=[n+(1-n)*r,r*(1-n)-o*a,r*(1-n)+o*a,0,0,r*(1-n)+o*a,n+r*(1-n),r*(1-n)-o*a,0,0,r*(1-n)-o*a,r*(1-n)+o*a,n+r*(1-n),0,0,0,0,0,1,0];this._loadMatrix(i,t)}contrast(e,t){const n=(e||0)+1,a=-.5*(n-1),r=[n,0,0,0,a,0,n,0,0,a,0,0,n,0,a,0,0,0,1,0];this._loadMatrix(r,t)}saturate(e=0,t){const n=2*e/3+1,a=-.5*(n-1),r=[n,a,a,0,0,a,n,a,0,0,a,a,n,0,0,0,0,0,1,0];this._loadMatrix(r,t)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,n,a,r){e=e||.2,t=t||.15,n=n||16770432,a=a||3375104;const o=TX.shared,[i,s,l]=o.setValue(n).toArray(),[c,d,u]=o.setValue(a).toArray(),m=[.3,.59,.11,0,0,i,s,l,e,0,c,d,u,t,0,i-c,s-d,l-u,0,0];this._loadMatrix(m,r)}night(e,t){const n=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}predator(e,t){const n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}mQ.prototype.grayscale=mQ.prototype.greyscale;const pQ={AlphaFilter:class extends vK{constructor(e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends vK{constructor(e=8,t=4,n=vK.defaultResolution,a=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new uQ(!0,e,t,n,a),this.blurYFilter=new uQ(!1,e,t,n,a),this.resolution=n,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,n,a){const r=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(r&&o){const r=e.getFilterTexture();this.blurXFilter.apply(e,t,r,kW.CLEAR),this.blurYFilter.apply(e,r,n,a),e.returnFilterTexture(r)}else o?this.blurYFilter.apply(e,t,n,a):this.blurXFilter.apply(e,t,n,a)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:uQ,ColorMatrixFilter:mQ,DisplacementFilter:class extends vK{constructor(e,t){const n=new zJ;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=n,null==t&&(t=20),this.scale=new _J(t,t)}apply(e,t,n,a){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,o=Math.sqrt(r.a*r.a+r.b*r.b),i=Math.sqrt(r.c*r.c+r.d*r.d);0!==o&&0!==i&&(this.uniforms.rotation[0]=r.a/o,this.uniforms.rotation[1]=r.b/o,this.uniforms.rotation[2]=r.c/i,this.uniforms.rotation[3]=r.d/i),e.applyFilter(this,t,n,a)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends vK{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends vK{constructor(e=.5,t=Math.random()){super(PZ,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(pQ).forEach(([e,t])=>{Object.defineProperty(pQ,e,{get:()=>(JW("7.1.0",`filters.${e} has moved to ${e}`),t)})});const gQ=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(IZ.system.add(this.tickerUpdate,this,DZ.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(IZ.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class hQ{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=hQ.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new _J,this.page=new _J,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,n,a,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class fQ extends hQ{constructor(){super(...arguments),this.client=new _J,this.movement=new _J,this.offset=new _J,this.global=new _J,this.screen=new _J}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,n){return e.worldTransform.applyInverse(n||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,n,a,r,o,i,s,l,c,d,u,m,p,g){throw new Error("Method not implemented.")}}class vQ extends fQ{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class bQ extends fQ{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}bQ.DOM_DELTA_PIXEL=0,bQ.DOM_DELTA_LINE=1,bQ.DOM_DELTA_PAGE=2;const yQ=new _J,xQ=new _J;class kQ{constructor(e){this.dispatch=new YW,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((e,t)=>e.priority-t.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let n=0,a=t.length;n<a;n++)t[n].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){gQ.pauseUpdate=!0;const n=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,yQ.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let a=0,r=n.length-1;a<r;a++)if(e.currentTarget=n[a],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let a=n.length-2;a>=0;a--)if(e.currentTarget=n[a],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,n=this._allInteractiveElements){if(0===n.length)return;e.eventPhase=e.BUBBLING_PHASE;const a=Array.isArray(t)?t:[t];for(let t=n.length-1;t>=0;t--)a.forEach(a=>{e.currentTarget=n[t],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let n=0;n<2048&&e!==this.rootTarget;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,n,a,r,o=!1){let i=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(gQ.pauseUpdate=!1),e.interactiveChildren&&e.children){const s=e.children;for(let l=s.length-1;l>=0;l--){const c=s[l],d=this.hitTestMoveRecursive(c,this._isInteractive(t)?t:c.eventMode,n,a,r,o||r(e,n));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const t=e.isInteractive();(d.length>0||t)&&(t&&this._allInteractiveElements.push(e),d.push(e)),0===this._hitElements.length&&(this._hitElements=d),i=!0}}}const s=this._isInteractive(t),l=e.isInteractive();return s&&l&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:i?this._hitElements:s&&!r(e,n)&&a(e,n)?l?[e]:[]:null}hitTestRecursive(e,t,n,a,r){if(this._interactivePrune(e)||r(e,n))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(gQ.pauseUpdate=!1),e.interactiveChildren&&e.children){const o=e.children;for(let i=o.length-1;i>=0;i--){const s=o[i],l=this.hitTestRecursive(s,this._isInteractive(t)?t:s.eventMode,n,a,r);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const t=e.isInteractive();return(l.length>0||t)&&l.push(e),l}}}const o=this._isInteractive(t),i=e.isInteractive();return o&&a(e,n)?i?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&"none"!==e.eventMode&&("passive"!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,xQ),!e.hitArea.contains(xQ.x,xQ.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!n.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){const n=`on${t=t??e.type}`;e.currentTarget[n]?.(e);const a=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,a),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const n="mouse"===t.pointerType||"pen"===t.pointerType,a=this.trackingData(e.pointerId),r=this.findMountedTarget(a.overTargets);if(a.overTargets?.length>0&&r!==t.target){const a="mousemove"===e.type?"mouseout":"pointerout",o=this.createPointerEvent(e,a,r);if(this.dispatchEvent(o,"pointerout"),n&&this.dispatchEvent(o,"mouseout"),!t.composedPath().includes(r)){const a=this.createPointerEvent(e,"pointerleave",r);for(a.eventPhase=a.AT_TARGET;a.target&&!t.composedPath().includes(a.target);)a.currentTarget=a.target,this.notifyTarget(a),n&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;this.freeEvent(a)}this.freeEvent(o)}if(r!==t.target){const a="mousemove"===e.type?"mouseover":"pointerover",o=this.clonePointerEvent(t,a);this.dispatchEvent(o,"pointerover"),n&&this.dispatchEvent(o,"mouseover");let i=r?.parent;for(;i&&i!==this.rootTarget.parent&&i!==t.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==r&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(o)}const o=[],i=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(t,"pointermove"),i&&o.push("globalpointermove"),"touch"===t.pointerType&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),i&&o.push("globaltouchmove")),n&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),i&&o.push("globalmousemove"),this.cursor=t.target?.cursor),o.length>0&&this.all(t,o),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.createPointerEvent(e),a="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),a&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=n.target?.cursor);const r=this.clonePointerEvent(n,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),a&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;t.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(r)}mapPointerOut(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId);if(t.overTargets){const n="mouse"===e.pointerType||"pen"===e.pointerType,a=this.findMountedTarget(t.overTargets),r=this.createPointerEvent(e,"pointerout",a);this.dispatchEvent(r),n&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(e,"pointerleave",a);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=performance.now(),n=this.createPointerEvent(e);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.dispatchEvent(n,e?"rightup":"mouseup")}const a=this.trackingData(e.pointerId),r=this.findMountedTarget(a.pressTargetsByButton[e.button]);let o=r;if(r&&!n.composedPath().includes(r)){let t=r;for(;t&&!n.composedPath().includes(t);){if(n.currentTarget=t,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.notifyTarget(n,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete a.pressTargetsByButton[e.button],o=t}if(o){const r=this.clonePointerEvent(n,"click");r.target=o,r.path=null,a.clicksByButton[e.button]||(a.clicksByButton[e.button]={clickCount:0,target:r.target,timeStamp:t});const i=a.clicksByButton[e.button];if(i.target===r.target&&t-i.timeStamp<200?++i.clickCount:i.clickCount=1,i.target=r.target,i.timeStamp=t,r.detail=i.clickCount,"mouse"===r.pointerType){const e=2===r.button;this.dispatchEvent(r,e?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(n)}mapPointerUpOutside(e){if(!(e instanceof vQ))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.findMountedTarget(t.pressTargetsByButton[e.button]),a=this.createPointerEvent(e);if(n){let r=n;for(;r;)a.currentTarget=r,this.notifyTarget(a,"pointerupoutside"),"touch"===a.pointerType?this.notifyTarget(a,"touchendoutside"):("mouse"===a.pointerType||"pen"===a.pointerType)&&this.notifyTarget(a,2===a.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(a)}mapWheel(e){if(!(e instanceof bQ))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let n=1;n<e.length&&e[n].parent===t;n++)t=e[n];return t}createPointerEvent(e,t,n){const a=this.allocateEvent(vQ);return this.copyPointerData(e,a),this.copyMouseData(e,a),this.copyData(e,a),a.nativeEvent=e.nativeEvent,a.originalEvent=e,a.target=n??this.hitTest(a.global.x,a.global.y)??this._hitElements[0],"string"==typeof t&&(a.type=t),a}createWheelEvent(e){const t=this.allocateEvent(bQ);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const n=this.allocateEvent(vQ);return n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=t??n.type,n}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof vQ&&t instanceof vQ&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof fQ&&t instanceof fQ&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const n=e.currentTarget._events[t];if(n&&e.currentTarget.isInteractive())if("fn"in n)n.once&&e.currentTarget.removeListener(t,n.fn,void 0,!0),n.fn.call(n.context,e);else for(let a=0,r=n.length;a<r&&!e.propagationImmediatelyStopped;a++)n[a].once&&e.currentTarget.removeListener(t,n[a].fn,void 0,!0),n[a].fn.call(n[a].context,e)}}const wQ={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},EQ=class e{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new kQ(null),gQ.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new vQ(null),this.rootWheelEvent=new bQ(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,n)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=n),e[t]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:n,resolution:a}=this.renderer;this.setTargetElement(n),this.resolution=a,e._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const n=this.cursorStyles[e];if(n)switch(typeof n){case"string":t&&(this.domElement.style.cursor=n);break;case"function":n(e);break;case"object":t&&Object.assign(this.domElement.style,n)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,n=t.length;e<n;e++){const n=t[e],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,gQ.pointerMoved();const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const n=t!==this.domElement?"outside":"",a=this.normalizeToPointerData(e);for(let e=0,t=a.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,a[e]);t.type+=n,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,gQ.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;gQ.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;gQ.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,n){const a=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;e.x=(t-a.left)*(this.domElement.width/a.width)*r,e.y=(n-a.top)*(this.domElement.height/a.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let n=0,a=e.changedTouches.length;n<a;n++){const a=e.changedTouches[n];typeof a.button>"u"&&(a.button=0),typeof a.buttons>"u"&&(a.buttons=1),typeof a.isPrimary>"u"&&(a.isPrimary=1===e.touches.length&&"touchstart"===e.type),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,a.type=e.type,t.push(a)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&!(this.supportsPointerEvents&&e instanceof globalThis.PointerEvent)){const n=e;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=1),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,t.push(n)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=wQ[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};EQ.extension={name:"events",type:[KX.RendererSystem,KX.CanvasRendererSystem]},EQ.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let NQ=EQ;function SQ(e){return"dynamic"===e||"static"===e}eJ.add(NQ);const VQ={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??SQ(NQ.defaultEventMode)},set interactive(e){JW("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??NQ.defaultEventMode},set eventMode(e){this._internalInteractive=SQ(e),this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,n){const a="boolean"==typeof n&&n||"object"==typeof n&&n.capture,r="object"==typeof n?n.signal:void 0,o="object"==typeof n&&!0===n.once,i="function"==typeof t?void 0:t;e=a?`${e}capture`:e;const s="function"==typeof t?t:t.handleEvent,l=this;r&&r.addEventListener("abort",()=>{l.off(e,s,i)}),o?l.once(e,s,i):l.on(e,s,i)},removeEventListener(e,t,n){const a="function"==typeof t?void 0:t;e="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,a)},dispatchEvent(e){if(!(e instanceof hQ))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};ZZ.mixin(VQ),ZZ.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class _Q{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(HW.tablet||HW.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){const e=performance.now();if(HW.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:n,width:a,height:r}=this.renderer.view.getBoundingClientRect(),{width:o,height:i,resolution:s}=this.renderer,l=a/o*s,c=r/i*s;let d=this.div;d.style.left=`${t}px`,d.style.top=`${n}px`,d.style.width=`${o}px`,d.style.height=`${i}px`;for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.renderId!==this.renderId)t._accessibleActive=!1,$X(this.children,e,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,e--;else{d=t._accessibleDiv;let e=t.hitArea;const n=t.worldTransform;t.hitArea?(d.style.left=(n.tx+e.x*n.a)*l+"px",d.style.top=(n.ty+e.y*n.d)*c+"px",d.style.width=e.width*n.a*l+"px",d.style.height=e.height*n.d*c+"px"):(e=t.getBounds(),this.capHitArea(e),d.style.left=e.x*l+"px",d.style.top=e.y*c+"px",d.style.width=e.width*l+"px",d.style.height=e.height*c+"px",d.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(d.title=t.accessibleTitle),d.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&d.setAttribute("aria-label",t.accessibleHint)),(t.accessibleTitle!==d.title||t.tabIndex!==d.tabIndex)&&(d.title=t.accessibleTitle,d.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:n}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>n&&(e.height=n-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:n}=e.target,a=this.renderer.events.rootBoundary,r=Object.assign(new hQ(a),{target:n});a.rootTarget=this.renderer.lastObjectRendered,t.forEach(e=>a.dispatchEvent(r,e))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}_Q.extension={name:"accessibility",type:[KX.RendererPlugin,KX.CanvasRendererPlugin]},eJ.add(_Q);const CQ=class e{constructor(t){this.stage=new aQ,t=Object.assign({forceCanvas:!1},t),this.renderer=function(e){for(const t of MZ)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}(t),e._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,n){const a=e._plugins.slice(0);a.reverse(),a.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(t),this.renderer=null}};CQ._plugins=[];let AQ=CQ;eJ.handleByList(KX.Application,AQ._plugins);class DQ{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:a}=this._resizeTo;e=n,t=a}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}DQ.extension=KX.Application,eJ.add(DQ);const TQ={loader:KX.LoadParser,resolver:KX.ResolveParser,cache:KX.CacheParser,detection:KX.DetectionParser};eJ.handle(KX.Asset,e=>{const t=e.ref;Object.entries(TQ).filter(([e])=>!!t[e]).forEach(([e,n])=>eJ.add(Object.assign(t[e],{extension:t[e].extension??n})))},e=>{const t=e.ref;Object.keys(TQ).filter(e=>!!t[e]).forEach(e=>eJ.remove(t[e]))});class BQ{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<t;n++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function IQ(e,t){const n=e.split("?")[0],a=QW.extname(n).toLowerCase();return Array.isArray(t)?t.includes(a):a===t}const zQ=(e,t,n=!1)=>(Array.isArray(e)||(e=[e]),t?e.map(e=>"string"==typeof e||n?t(e):e):e),MQ=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const n=zQ(e);let a;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];if(r.test(t)){a=r.getCacheableAssets(n,t);break}}a||(a={},n.forEach(e=>{a[e]=t}));const r=Object.keys(a),o={cacheKeys:r,keys:n};if(n.forEach(e=>{this._cacheMap.set(e,o)}),r.forEach(e=>{const n=a?a[e]:t;this._cache.has(e)&&this._cache.get(e)!==n&&console.warn("[Cache] already has key:",e),this._cache.set(e,a[e])}),t instanceof AK){const e=t;n.forEach(t=>{e.baseTexture!==AK.EMPTY.baseTexture&&mJ.addToCache(e.baseTexture,t),AK.addToCache(e,t)})}}remove(e){if(!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach(e=>{this._cache.delete(e)}),t.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}},PQ=e=>!Array.isArray(e);class RQ{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,n)=>(this._parsersValidated=!1,e[t]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const n={promise:null,parser:null};return n.promise=(async()=>{let a=null,r=null;if(t.loadParser&&(r=this._parserHash[t.loadParser],r||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!r){for(let n=0;n<this.parsers.length;n++){const a=this.parsers[n];if(a.load&&a.test?.(e,t,this)){r=a;break}}if(!r)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}a=await r.load(e,t,this),n.parser=r;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];r.parse&&r.parse&&await(r.testParse?.(a,t,this))&&(a=await r.parse(a,t,this)||a,n.parser=r)}return a})(),n}async load(e,t){this._parsersValidated||this._validateParsers();let n=0;const a={},r=PQ(e),o=zQ(e,e=>({alias:[e],src:e})),i=o.length,s=o.map(async e=>{const r=QW.toAbsolute(e.src);if(!a[e.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,e)),a[e.src]=await this.promiseCache[r].promise,t&&t(++n/i)}catch(t){throw delete this.promiseCache[r],delete a[e.src],new Error(`[Loader.load] Failed to load ${r}.\n${t}`)}});return await Promise.all(s),r?a[o[0].src]:a}async unload(e){const t=zQ(e,e=>({alias:[e],src:e})).map(async e=>{const t=QW.toAbsolute(e.src),n=this.promiseCache[t];if(n){const a=await n.promise;delete this.promiseCache[t],n.parser?.unload?.(a,e,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var $Q=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))($Q||{});function OQ(e,t){if(Array.isArray(t)){for(const n of t)if(e.startsWith(`data:${n}`))return!0;return!1}return e.startsWith(`data:${t}`)}const LQ={extension:{type:KX.LoadParser,priority:$Q.Low},name:"loadJson",test:e=>OQ(e,"application/json")||IQ(e,".json"),load:async e=>await(await CW.ADAPTER.fetch(e)).json()};eJ.add(LQ);const FQ={name:"loadTxt",extension:{type:KX.LoadParser,priority:$Q.Low},test:e=>OQ(e,"text/plain")||IQ(e,".txt"),load:async e=>await(await CW.ADAPTER.fetch(e)).text()};eJ.add(FQ);const jQ=["normal","bold","100","200","300","400","500","600","700","800","900"],UQ=[".ttf",".otf",".woff",".woff2"],qQ=["font/ttf","font/otf","font/woff","font/woff2"],GQ=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,HQ=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function YQ(e){return HQ.test(e)?e:encodeURI(e)}const WQ={extension:{type:KX.LoadParser,priority:$Q.Low},name:"loadWebFont",test:e=>OQ(e,qQ)||IQ(e,UQ),async load(e,t){const n=CW.ADAPTER.getFontFaceSet();if(n){const a=[],r=t.data?.family??function(e){const t=QW.extname(e),n=QW.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1));let a=n.length>0;for(const e of n)if(!e.match(GQ)){a=!1;break}let r=n.join(" ");return a||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}(e),o=t.data?.weights?.filter(e=>jQ.includes(e))??["normal"],i=t.data??{};for(let t=0;t<o.length;t++){const s=o[t],l=new FontFace(r,`url(${YQ(e)})`,{...i,weight:s});await l.load(),n.add(l),a.push(l)}return 1===a.length?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>CW.ADAPTER.getFontFaceSet().delete(e))}};eJ.add(WQ);let XQ=null;class JQ{constructor(){XQ||(XQ=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(XQ)}}JQ.revokeObjectURL=function(){XQ&&(URL.revokeObjectURL(XQ),XQ=null)};let KQ=null;class ZQ{constructor(){KQ||(KQ=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(KQ)}}ZQ.revokeObjectURL=function(){KQ&&(URL.revokeObjectURL(KQ),KQ=null)};let QQ,e0=0;const t0=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new JQ;t.addEventListener("message",n=>{t.terminate(),JQ.revokeObjectURL(),e(n.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===QQ&&(QQ=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<QQ&&(this._createdWorkers++,e=(new ZQ).worker,e.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const n=new Promise((n,a)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:a})});return this.next(),n}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),n=t.id;this.resolveHash[e0]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:e0++,id:n})}};function n0(e,t,n){e.resource.internal=!0;const a=new AK(e),r=()=>{delete t.promiseCache[n],MQ.has(n)&&MQ.remove(n)};return a.baseTexture.once("destroyed",()=>{n in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())}),a.once("destroyed",()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),a}const a0=[".jpeg",".jpg",".png",".webp",".avif"],r0=["image/jpeg","image/png","image/webp","image/avif"],o0={name:"loadTextures",extension:{type:KX.LoadParser,priority:$Q.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>OQ(e,r0)||IQ(e,a0),async load(e,t,n){const a=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let r;r=a?this.config.preferWorkers&&await t0.isImageBitmapSupported()?await t0.loadImageBitmap(e):await async function(e){const t=await CW.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const n=await t.blob();return await createImageBitmap(n)}(e):await new Promise((t,n)=>{const a=new Image;a.crossOrigin=this.config.crossOrigin,a.src=e,a.complete?t(a):(a.onload=()=>t(a),a.onerror=e=>n(e))});const o={...t.data};o.resolution??(o.resolution=JX(e)),a&&void 0===o.resourceOptions?.ownsImageBitmap&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);const i=new mJ(r,o);return i.resource.src=e,n0(i,n,e)},unload(e){e.destroy(!0)}};eJ.add(o0);const i0={extension:{type:KX.LoadParser,priority:$Q.High},name:"loadSVG",test:e=>OQ(e,"image/svg+xml")||IQ(e,".svg"),testParse:async e=>WZ.test(e),async parse(e,t,n){const a=new WZ(e,t?.data?.resourceOptions);await a.load();const r=new mJ(a,{resolution:JX(e),...t?.data});return r.resource.src=t.src,n0(r,n,t.src)},load:async(e,t)=>(await CW.ADAPTER.fetch(e)).text(),unload:o0.unload};eJ.add(i0);const s0=[".mp4",".m4v",".webm",".ogv"],l0=["video/mp4","video/webm","video/ogg"],c0={name:"loadVideo",extension:{type:KX.LoadParser,priority:$Q.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>OQ(e,l0)||IQ(e,s0),async load(e,t,n){let a;const r=await(await CW.ADAPTER.fetch(e)).blob(),o=URL.createObjectURL(r);try{const r={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},i=new JZ(o,r);await i.load();const s=new mJ(i,{alphaMode:await nX(),resolution:JX(e),...t?.data});s.resource.src=e,a=n0(s,n,e),a.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(e){throw URL.revokeObjectURL(o),e}return a},unload(e){e.destroy(!0)}};function d0(e,t,n,a,r){const o=t[n];for(let i=0;i<o.length;i++){const s=o[i];n<t.length-1?d0(e.replace(a[n],s),t,n+1,a,r):r.push(e.replace(a[n],s))}}function u0(e){const t=e.match(/\{(.*?)\}/g),n=[];if(t){const a=[];t.forEach(e=>{const t=e.substring(1,e.length-1).split(",");a.push(t)}),d0(e,a,0,t,n)}else n.push(e);return n}eJ.add(c0);class m0{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}}getAlias(e){const{alias:t,name:n,src:a,srcs:r}=e;return zQ(t||n||a||r,e=>"string"==typeof e?e:Array.isArray(e)?e.map(e=>e?.src??e?.srcs??e):e?.src||e?.srcs?e.src??e.srcs:e,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,t){const n=[];Array.isArray(t)?t.forEach(t=>{const a=t.src??t.srcs,r=t.alias??t.name;let o;if("string"==typeof r){const t=this._createBundleAssetId(e,r);n.push(t),o=[r,t]}else{const t=r.map(t=>this._createBundleAssetId(e,t));n.push(...t),o=[...r,...t]}this.add({...t,alias:o,src:a})}):Object.keys(t).forEach(a=>{const r=[a,this._createBundleAssetId(e,a)];if("string"==typeof t[a])this.add({alias:r,src:t[a]});else if(Array.isArray(t[a]))this.add({alias:r,src:t[a]});else{const e=t[a],n=e.src??e.srcs;this.add({...e,alias:r,src:Array.isArray(n)?n:[n]})}n.push(...r)}),this._bundles[e]=n}add(e,t,n,a,r){const o=[];let i;"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(JW("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),o.push({alias:e,src:t,data:n,format:a,loadParser:r})):Array.isArray(e)?o.push(...e):o.push(e),i=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},zQ(o).forEach(e=>{const{src:t,srcs:n}=e;let{data:a,format:r,loadParser:o}=e;const s=zQ(t||n).map(e=>"string"==typeof e?u0(e):Array.isArray(e)?e:[e]),l=this.getAlias(e);Array.isArray(l)?l.forEach(i):i(l);const c=[];s.forEach(e=>{e.forEach(e=>{let t={};if("object"!=typeof e){t.src=e;for(let n=0;n<this._parsers.length;n++){const a=this._parsers[n];if(a.test(e)){t=a.parse(e);break}}}else a=e.data??a,r=e.format??r,o=e.loadParser??o,t={...t,...e};if(!l)throw new Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this.buildResolvedAsset(t,{aliases:l,data:a,format:r,loadParser:o}),c.push(t)})}),l.forEach(e=>{this._assetMap[e]=c})})}resolveBundle(e){const t=PQ(e);e=zQ(e);const n={};return e.forEach(e=>{const t=this._bundles[e];if(t){const a=this.resolve(t),r={};for(const t in a){const n=a[t];r[this._extractAssetIdFromBundle(e,t)]=n}n[e]=r}}),t?n[e[0]]:n}resolveUrl(e){const t=this.resolve(e);if("string"!=typeof e){const e={};for(const n in t)e[n]=t[n].src;return e}return t.src}resolve(e){const t=PQ(e);e=zQ(e);const n={};return e.forEach(e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const n=t[0],a=this._getPreferredOrder(t);a?.priority.forEach(e=>{a.params[e].forEach(n=>{const a=t.filter(t=>!!t[e]&&t[e]===n);a.length&&(t=a)})}),this._resolverHash[e]=t[0]??n}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});n[e]=this._resolverHash[e]}),t?n[e[0]]:n}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const t=e[0],n=this._preferredOrder.find(e=>e.params.format.includes(t.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){return this._defaultSearchParams?`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`:e}buildResolvedAsset(e,t){const{aliases:n,data:a,loadParser:r,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=QW.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=n??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...a||{},...e.data},e.loadParser=r??e.loadParser,e.format=o??e.format??QW.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}const p0=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new m0,this.loader=new RQ,this.cache=MQ,this._backgroundLoader=new BQ(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=e.texturePreference?.resolution??1,n="number"==typeof t?[t]:t,a=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:a,resolution:n}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,n,a,r){this.resolver.add(e,t,n,a,r)}async load(e,t){this._initialized||await this.init();const n=PQ(e),a=zQ(e).map(e=>{if("string"!=typeof e){const t=this.resolver.getAlias(e);return t.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),r=this.resolver.resolve(a),o=await this._mapLoadToResolve(r,t);return n?o[a[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let n=!1;"string"==typeof e&&(n=!0,e=[e]);const a=this.resolver.resolveBundle(e),r={},o=Object.keys(a);let i=0,s=0;const l=()=>{t?.(++i/s)},c=o.map(e=>{const t=a[e];return s+=Object.keys(t).length,this._mapLoadToResolve(t,l).then(t=>{r[e]=t})});return await Promise.all(c),n?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return MQ.get(e);const t={};for(let n=0;n<e.length;n++)t[n]=MQ.get(e[n]);return t}async _mapLoadToResolve(e,t){const n=Object.values(e),a=Object.keys(e);this._backgroundLoader.active=!1;const r=await this.loader.load(n,t);this._backgroundLoader.active=!0;const o={};return n.forEach((e,t)=>{const n=r[e.src],i=[e.src];e.alias&&i.push(...e.alias),o[a[t]]=n,MQ.set(i,n)}),o}async unload(e){this._initialized||await this.init();const t=zQ(e).map(e=>"string"!=typeof e?e.src:e),n=this.resolver.resolve(t);await this._unloadFromResolved(n)}async unloadBundle(e){this._initialized||await this.init(),e=zQ(e);const t=this.resolver.resolveBundle(e),n=Object.keys(t).map(e=>this._unloadFromResolved(t[e]));await Promise.all(n)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(e=>{MQ.remove(e.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const n of e.detections)e.skipDetections||await n.test()?t=await n.add(t):e.skipDetections||(t=await n.remove(t));return t=t.filter((e,n)=>t.indexOf(e)===n),t}get detections(){return this._detections}get preferWorkers(){return o0.config.preferWorkers}set preferWorkers(e){JW("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(t=>t in e).forEach(n=>{t.config[n]=e[n]})})}};eJ.handleByList(KX.LoadParser,p0.loader.parsers).handleByList(KX.ResolveParser,p0.resolver.parsers).handleByList(KX.CacheParser,p0.cache.parsers).handleByList(KX.DetectionParser,p0.detections);const g0={extension:KX.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof AK),getCacheableAssets:(e,t)=>{const n={};return e.forEach(e=>{t.forEach((t,a)=>{n[e+(0===a?"":a+1)]=t})}),n}};async function h0(e){if("Image"in globalThis)return new Promise(t=>{const n=new Image;n.onload=()=>{t(!0)},n.onerror=()=>{t(!1)},n.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}eJ.add(g0);const f0={extension:{type:KX.DetectionParser,priority:1},test:async()=>h0("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(e=>"avif"!==e)};eJ.add(f0);const v0={extension:{type:KX.DetectionParser,priority:0},test:async()=>h0("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(e=>"webp"!==e)};eJ.add(v0);const b0=["png","jpg","jpeg"],y0={extension:{type:KX.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...b0],remove:async e=>e.filter(e=>!b0.includes(e))};eJ.add(y0);const x0="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function k0(e){return!x0&&""!==document.createElement("video").canPlayType(e)}const w0={extension:{type:KX.DetectionParser,priority:0},test:async()=>k0("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(e=>"webm"!==e)};eJ.add(w0);const E0={extension:{type:KX.DetectionParser,priority:0},test:async()=>k0("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(e=>"mp4"!==e&&"m4v"!==e)};eJ.add(E0);const N0={extension:{type:KX.DetectionParser,priority:0},test:async()=>k0("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(e=>"ogv"!==e)};eJ.add(N0);const S0={extension:KX.ResolveParser,test:o0.test,parse:e=>({resolution:parseFloat(CW.RETINA_PREFIX.exec(e)?.[1]??"1"),format:QW.extname(e).slice(1),src:e})};eJ.add(S0);const V0=(e,t)=>{const n=t.split("?")[1];return n&&(e+=`?${n}`),e};var _0=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e))(_0||{});const C0={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let A0,D0;function T0(){D0={bptc:A0.getExtension("EXT_texture_compression_bptc"),astc:A0.getExtension("WEBGL_compressed_texture_astc"),etc:A0.getExtension("WEBGL_compressed_texture_etc"),s3tc:A0.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:A0.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:A0.getExtension("WEBGL_compressed_texture_pvrtc")||A0.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:A0.getExtension("WEBGL_compressed_texture_etc1"),atc:A0.getExtension("WEBGL_compressed_texture_atc")}}const B0={extension:{type:KX.DetectionParser,priority:2},test:async()=>{const e=CW.ADAPTER.createCanvas().getContext("webgl");return e?(A0=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{D0||T0();const t=[];for(const e in D0)D0[e]&&t.push(e);return[...t,...e]},remove:async e=>(D0||T0(),e.filter(e=>!(e in D0)))};eJ.add(B0);class I0 extends cJ{constructor(e,t={width:1,height:1,autoLoad:!0}){let n,a;"string"==typeof e?(n=e,a=new Uint8Array):(n=null,a=e),super(a,t),this.origin=n,this.buffer=a?new tJ(a):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==t.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new tJ(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this))),this._load}}class z0 extends I0{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=z0._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||z0._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,n){const a=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;a.pixelStorei(a.UNPACK_ALIGNMENT,4);for(let e=0,t=this.levels;e<t;e++){const{levelID:t,levelWidth:n,levelHeight:r,levelBuffer:o}=this._levelBuffers[e];a.compressedTexImage2D(a.TEXTURE_2D,t,this.format,n,r,0,o)}return!0}onBlobLoaded(){this._levelBuffers=z0._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(36196===e)return"etc1";if(35986===e||35987===e||34798===e)return"atc";if(e>=36492&&e<=36495)return"bptc";if(37808===e)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,n,a,r,o,i){const s=new Array(n);let l=e.byteOffset,c=o,d=i,u=c+a-1&~(a-1),m=d+r-1&~(r-1),p=u*m*C0[t];for(let o=0;o<n;o++)s[o]={levelID:o,levelWidth:n>1?c:u,levelHeight:n>1?d:m,levelBuffer:new Uint8Array(e.buffer,l,p)},l+=p,c=c>>1||1,d=d>>1||1,u=c+a-1&~(a-1),m=d+r-1&~(r-1),p=u*m*C0[t];return s}}const M0=827611204,P0=861165636,R0=894720068,$0={[M0]:_0.COMPRESSED_RGBA_S3TC_DXT1_EXT,[P0]:_0.COMPRESSED_RGBA_S3TC_DXT3_EXT,[R0]:_0.COMPRESSED_RGBA_S3TC_DXT5_EXT},O0={70:_0.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:_0.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:_0.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:_0.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:_0.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:_0.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:_0.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:_0.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:_0.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:_0.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:_0.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:_0.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:_0.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT},L0=[171,75,84,88,32,49,49,187,13,10,26,10],F0={[hW.UNSIGNED_BYTE]:1,[hW.UNSIGNED_SHORT]:2,[hW.INT]:4,[hW.UNSIGNED_INT]:4,[hW.FLOAT]:4,[hW.HALF_FLOAT]:8},j0={[pW.RGBA]:4,[pW.RGB]:3,[pW.RG]:2,[pW.RED]:1,[pW.LUMINANCE]:1,[pW.LUMINANCE_ALPHA]:2,[pW.ALPHA]:1},U0={[hW.UNSIGNED_SHORT_4_4_4_4]:2,[hW.UNSIGNED_SHORT_5_5_5_1]:2,[hW.UNSIGNED_SHORT_5_6_5]:2};function q0(e){switch(e){case pW.RGBA:return pW.RGBA_INTEGER;case pW.RGB:return pW.RGB_INTEGER;case pW.RG:return pW.RG_INTEGER;case pW.RED:return pW.RED_INTEGER;default:return e}}const G0={extension:{type:KX.LoadParser,priority:$Q.High},name:"loadDDS",test:e=>IQ(e,".dds"),async load(e,t,n){const a=function(e){const t=new Uint32Array(e);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,124/Uint32Array.BYTES_PER_ELEMENT),a=n[3],r=n[4],o=n[7],i=new Uint32Array(e,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),s=i[1];if(4&s){const n=i[2];if(808540228!==n){const t=$0[n],i=new Uint8Array(e,128);return[new z0(i,{format:t,width:r,height:a,levels:o})]}const s=128,l=new Uint32Array(t.buffer,s,20/Uint32Array.BYTES_PER_ELEMENT),c=l[0],d=l[1],u=l[2],m=l[3],p=O0[c];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===d)throw new Error("DDSParser does not supported 3D texture data");const g=new Array,h=148;if(1===m)g.push(new Uint8Array(e,h));else{const t=C0[p];let n=0,i=r,s=a;for(let e=0;e<o;e++)n+=Math.max(1,i+3&-4)*Math.max(1,s+3&-4)*t,i>>>=1,s>>>=1;let l=h;for(let t=0;t<m;t++)g.push(new Uint8Array(e,l,n)),l+=n}return g.map(e=>new z0(e,{format:p,width:r,height:a,levels:o}))}throw 64&s?new Error("DDSParser does not support uncompressed texture data."):512&s?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&s?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&s?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await CW.ADAPTER.fetch(e)).arrayBuffer()).map(a=>n0(new mJ(a,{mipmap:yW.OFF,alphaMode:xW.NO_PREMULTIPLIED_ALPHA,resolution:JX(e),...t.data}),n,e));return 1===a.length?a[0]:a},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};eJ.add(G0);const H0={extension:{type:KX.LoadParser,priority:$Q.High},name:"loadKTX",test:e=>IQ(e,".ktx"),async load(e,t,n){const a=await(await CW.ADAPTER.fetch(e)).arrayBuffer(),{compressed:r,uncompressed:o,kvData:i}=function(e,t,n=!1){const a=new DataView(t);if(!function(e,t){for(let n=0;n<L0.length;n++)if(t.getUint8(n)!==L0[n])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,a))return null;const r=67305985===a.getUint32(12,!0),o=a.getUint32(16,r),i=a.getUint32(24,r),s=a.getUint32(28,r),l=a.getUint32(36,r),c=a.getUint32(40,r)||1,d=a.getUint32(44,r)||1,u=a.getUint32(48,r)||1,m=a.getUint32(52,r),p=a.getUint32(56,r),g=a.getUint32(60,r);if(0===c||1!==d)throw new Error("Only 2D textures are supported");if(1!==m)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const h=l+3&-4,f=c+3&-4,v=new Array(u);let b,y=l*c;if(0===o&&(y=h*f),b=0!==o?F0[o]?F0[o]*j0[i]:U0[o]:C0[s],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=n?function(e,t,n){const a=new Map;let r=0;for(;r<t;){const o=e.getUint32(64+r,n),i=64+r+4,s=3-(o+3)%4;if(0===o||o>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<o&&0!==e.getUint8(i+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=(new TextDecoder).decode(new Uint8Array(e.buffer,i,l)),d=new DataView(e.buffer,i+l+1,o-l-1);a.set(c,d),r+=4+o+s}return a}(a,g,r):null;let k=y*b,w=l,E=c,N=h,S=f,V=64+g;for(let e=0;e<p;e++){const n=a.getUint32(V,r);let i=V+4;for(let n=0;n<u;n++){let a=v[n];a||(a=v[n]=new Array(p)),a[e]={levelID:e,levelWidth:p>1||0!==o?w:N,levelHeight:p>1||0!==o?E:S,levelBuffer:new Uint8Array(t,i,k)},i+=k}V+=n+4,V=V%4!=0?V+4-V%4:V,w=w>>1||1,E=E>>1||1,N=w+4-1&-4,S=E+4-1&-4,k=N*S*b}return 0!==o?{uncompressed:v.map(e=>{let t=e[0].levelBuffer,n=!1;return o===hW.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):o===hW.UNSIGNED_INT?(n=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):o===hW.INT&&(n=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new cJ(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:o,format:n?q0(i):i}}),kvData:x}:{compressed:v.map(e=>new z0(null,{format:s,width:l,height:c,levels:p,levelBuffers:e})),kvData:x}}(e,a),s=r??o,l={mipmap:yW.OFF,alphaMode:xW.NO_PREMULTIPLIED_ALPHA,resolution:JX(e),...t.data},c=s.map(t=>{s===o&&Object.assign(l,{type:t.type,format:t.format});const a=t.resource??t,r=new mJ(a,l);return r.ktxKeyValueData=i,n0(r,n,e)});return 1===c.length?c[0]:c},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};eJ.add(H0);const Y0=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],W0={extension:KX.ResolveParser,test:e=>{const t=QW.extname(e).slice(1);return["basis","ktx","dds"].includes(t)},parse:e=>{const t=e.split("."),n=t.pop();if(["ktx","dds"].includes(n)){const n=t.pop();if(Y0.includes(n))return{resolution:parseFloat(CW.RETINA_PREFIX.exec(e)?.[1]??"1"),format:n,src:e}}return{resolution:parseFloat(CW.RETINA_PREFIX.exec(e)?.[1]??"1"),format:n,src:e}}};eJ.add(W0);const X0=new AJ,J0=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,n,a){const r=new Image;return r.src=await this.base64(e,t,n,a),r}async base64(e,t,n,a){const r=this.canvas(e,a);if(void 0!==r.toBlob)return new Promise((e,a)=>{r.toBlob(t=>{if(!t)return void a(new Error("ICanvas.toBlob failed!"));const n=new FileReader;n.onload=()=>e(n.result),n.onerror=a,n.readAsDataURL(t)},t,n)});if(void 0!==r.toDataURL)return r.toDataURL(t,n);if(void 0!==r.convertToBlob){const e=await r.convertToBlob({type:t,quality:n});return new Promise((t,n)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=n,a.readAsDataURL(e)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,n){const{pixels:a,width:r,height:o,flipY:i,premultipliedAlpha:s}=this._rawPixels(t,n);i&&e._flipY(a,r,o),s&&e._unpremultiplyAlpha(a);const l=new YX(r,o,1),c=new ImageData(new Uint8ClampedArray(a.buffer),r,o);return l.context.putImageData(c,0,0),l.canvas}pixels(t,n){const{pixels:a,width:r,height:o,flipY:i,premultipliedAlpha:s}=this._rawPixels(t,n);return i&&e._flipY(a,r,o),s&&e._unpremultiplyAlpha(a),a}_rawPixels(e,t){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let a,r,o=!1,i=!1,s=!1;e&&(e instanceof DK?r=e:(r=n.generateTexture(e,{region:t,resolution:n.resolution,multisample:n.multisample}),s=!0,t&&(X0.width=t.width,X0.height=t.height,t=X0)));const l=n.gl;if(r){if(a=r.baseTexture.resolution,t=t??r.frame,o=!1,i=r.baseTexture.alphaMode>0&&r.baseTexture.format===pW.RGBA,!s){n.renderTexture.bind(r);const e=r.framebuffer.glFramebuffers[n.CONTEXT_UID];e.blitFramebuffer&&n.framebuffer.bind(e.blitFramebuffer)}}else a=n.resolution,t||((t=X0).width=n.width/a,t.height=n.height/a),o=!0,i=this._rendererPremultipliedAlpha,n.renderTexture.bind();const c=Math.max(Math.round(t.width*a),1),d=Math.max(Math.round(t.height*a),1),u=new Uint8Array(4*c*d);return l.readPixels(Math.round(t.x*a),Math.round(t.y*a),c,d,l.RGBA,l.UNSIGNED_BYTE,u),s&&r?.destroy(!0),{pixels:u,width:c,height:d,flipY:o,premultipliedAlpha:i}}destroy(){this.renderer=null}static _flipY(e,t,n){const a=t<<2,r=n>>1,o=new Uint8Array(a);for(let t=0;t<r;t++){const r=t*a,i=(n-t-1)*a;o.set(e.subarray(r,r+a)),e.copyWithin(r,i,i+a),e.set(o,i)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let n=0;n<t;n+=4){const t=e[n+3];if(0!==t){const a=255.001/t;e[n]=e[n]*a+.5,e[n+1]=e[n+1]*a+.5,e[n+2]=e[n+2]*a+.5}}}};J0.extension={name:"extract",type:KX.RendererSystem};let K0=J0;eJ.add(K0);const Z0={build(e){const t=e.points;let n,a,r,o,i,s;if(e.type===VJ.CIRC){const t=e.shape;n=t.x,a=t.y,i=s=t.radius,r=o=0}else if(e.type===VJ.ELIP){const t=e.shape;n=t.x,a=t.y,i=t.width,s=t.height,r=o=0}else{const t=e.shape,l=t.width/2,c=t.height/2;n=t.x+l,a=t.y+c,i=s=Math.max(0,Math.min(t.radius,Math.min(l,c))),r=l-i,o=c-s}if(!(i>=0&&s>=0&&r>=0&&o>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(i+s)),c=8*l+(r?4:0)+(o?4:0);if(t.length=c,0===c)return;if(0===l)return t.length=8,t[0]=t[6]=n+r,t[1]=t[3]=a+o,t[2]=t[4]=n-r,void(t[5]=t[7]=a-o);let d=0,u=4*l+(r?2:0)+2,m=u,p=c;{const e=r+i,s=o,l=n+e,c=n-e,g=a+s;if(t[d++]=l,t[d++]=g,t[--u]=g,t[--u]=c,o){const e=a-s;t[m++]=c,t[m++]=e,t[--p]=e,t[--p]=l}}for(let e=1;e<l;e++){const c=Math.PI/2*(e/l),g=r+Math.cos(c)*i,h=o+Math.sin(c)*s,f=n+g,v=n-g,b=a+h,y=a-h;t[d++]=f,t[d++]=b,t[--u]=b,t[--u]=v,t[m++]=v,t[m++]=y,t[--p]=y,t[--p]=f}{const e=o+s,i=n+r,l=n-r,c=a+e,u=a-e;t[d++]=i,t[d++]=c,t[--p]=u,t[--p]=i,r&&(t[d++]=l,t[d++]=c,t[--p]=u,t[--p]=l)}},triangulate(e,t){const n=e.points,a=t.points,r=t.indices;if(0===n.length)return;let o=a.length/2;const i=o;let s,l;if(e.type!==VJ.RREC){const t=e.shape;s=t.x,l=t.y}else{const t=e.shape;s=t.x+t.width/2,l=t.y+t.height/2}const c=e.matrix;a.push(e.matrix?c.a*s+c.c*l+c.tx:s,e.matrix?c.b*s+c.d*l+c.ty:l),o++,a.push(n[0],n[1]);for(let e=2;e<n.length;e+=2)a.push(n[e],n[e+1]),r.push(o++,i,o);r.push(i+1,i,o)}};function Q0(e,t=!1){const n=e.length;if(n<6)return;let a=0;for(let t=0,r=e[n-2],o=e[n-1];t<n;t+=2){const n=e[t],i=e[t+1];a+=(n-r)*(i+o),r=n,o=i}if(!t&&a>0||t&&a<=0){const t=n/2;for(let a=t+t%2;a<n;a+=2){const t=n-a-2,r=n-a-1,o=a,i=a+1;[e[t],e[o]]=[e[o],e[t]],[e[r],e[i]]=[e[i],e[r]]}}}const e1={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let n=e.points;const a=e.holes,r=t.points,o=t.indices;if(n.length>=6){Q0(n,!1);const e=[];for(let t=0;t<a.length;t++){const r=a[t];Q0(r.points,!0),e.push(n.length/2),n=n.concat(r.points)}const t=WW(n,e,2);if(!t)return;const i=r.length/2;for(let e=0;e<t.length;e+=3)o.push(t[e]+i),o.push(t[e+1]+i),o.push(t[e+2]+i);for(let e=0;e<n.length;e++)r.push(n[e])}}},t1={build(e){const t=e.shape,n=t.x,a=t.y,r=t.width,o=t.height,i=e.points;i.length=0,r>=0&&o>=0&&i.push(n,a,n+r,a,n+r,a+o,n,a+o)},triangulate(e,t){const n=e.points,a=t.points;if(0===n.length)return;const r=a.length/2;a.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},n1={build(e){Z0.build(e)},triangulate(e,t){Z0.triangulate(e,t)}};var a1=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(a1||{}),r1=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(r1||{});const o1={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let n=Math.ceil(e/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class i1{static curveTo(e,t,n,a,r,o){const i=o[o.length-2],s=o[o.length-1]-t,l=i-e,c=a-t,d=n-e,u=Math.abs(s*d-l*c);if(u<1e-8||0===r)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;const m=s*s+l*l,p=c*c+d*d,g=s*c+l*d,h=r*Math.sqrt(m)/u,f=r*Math.sqrt(p)/u,v=h*g/m,b=f*g/p,y=h*d+f*l,x=h*c+f*s,k=l*(f+v),w=s*(f+v),E=d*(h+b),N=c*(h+b);return{cx:y+e,cy:x+t,radius:r,startAngle:Math.atan2(w-x,k-y),endAngle:Math.atan2(N-x,E-y),anticlockwise:l*c>d*s}}static arc(e,t,n,a,r,o,i,s,l){const c=i-o,d=o1._segmentsCount(Math.abs(c)*r,40*Math.ceil(Math.abs(c)/EJ)),u=c/(2*d),m=2*u,p=Math.cos(u),g=Math.sin(u),h=d-1,f=h%1/h;for(let e=0;e<=h;++e){const t=u+o+m*(e+f*e),i=Math.cos(t),s=-Math.sin(t);l.push((p*i+g*s)*r+n,(p*-s+g*i)*r+a)}}}class s1{static curveLength(e,t,n,a,r,o,i,s){let l=0,c=0,d=0,u=0,m=0,p=0,g=0,h=0,f=0,v=0,b=0,y=e,x=t;for(let k=1;k<=10;++k)c=k/10,d=c*c,u=d*c,m=1-c,p=m*m,g=p*m,h=g*e+3*p*c*n+3*m*d*r+u*i,f=g*t+3*p*c*a+3*m*d*o+u*s,v=y-h,b=x-f,y=h,x=f,l+=Math.sqrt(v*v+b*b);return l}static curveTo(e,t,n,a,r,o,i){const s=i[i.length-2],l=i[i.length-1];i.length-=2;const c=o1._segmentsCount(s1.curveLength(s,l,e,t,n,a,r,o));let d=0,u=0,m=0,p=0,g=0;i.push(s,l);for(let h=1,f=0;h<=c;++h)f=h/c,d=1-f,u=d*d,m=u*d,p=f*f,g=p*f,i.push(m*s+3*u*f*e+3*d*p*n+g*r,m*l+3*u*f*t+3*d*p*a+g*o)}}function l1(e,t,n,a,r,o,i,s){let l,c;i?(l=a,c=-n):(l=-a,c=n);const d=e-n*r+l,u=t-a*r+c,m=e+n*o+l,p=t+a*o+c;return s.push(d,u,m,p),2}function c1(e,t,n,a,r,o,i,s){const l=n-e,c=a-t;let d=Math.atan2(l,c),u=Math.atan2(r-e,o-t);s&&d<u?d+=2*Math.PI:!s&&d>u&&(u+=2*Math.PI);let m=d;const p=u-d,g=Math.abs(p),h=Math.sqrt(l*l+c*c),f=1+(15*g*Math.sqrt(h)/Math.PI|0),v=p/f;if(m+=v,s){i.push(e,t,n,a);for(let n=1,a=m;n<f;n++,a+=v)i.push(e,t,e+Math.sin(a)*h,t+Math.cos(a)*h);i.push(e,t,r,o)}else{i.push(n,a,e,t);for(let n=1,a=m;n<f;n++,a+=v)i.push(e+Math.sin(a)*h,t+Math.cos(a)*h,e,t);i.push(r,o,e,t)}return 2*f}function d1(e,t){e.lineStyle.native?function(e,t){let n=0;const a=e.shape,r=e.points||a.points,o=a.type!==VJ.POLY||a.closeStroke;if(0===r.length)return;const i=t.points,s=t.indices,l=r.length/2,c=i.length/2;let d=c;for(i.push(r[0],r[1]),n=1;n<l;n++)i.push(r[2*n],r[2*n+1]),s.push(d,d+1),d++;o&&s.push(d,c)}(e,t):function(e,t){const n=e.shape;let a=e.points||n.points.slice();const r=t.closePointEps;if(0===a.length)return;const o=e.lineStyle,i=new _J(a[0],a[1]),s=new _J(a[a.length-2],a[a.length-1]),l=n.type!==VJ.POLY||n.closeStroke,c=Math.abs(i.x-s.x)<r&&Math.abs(i.y-s.y)<r;if(l){a=a.slice(),c&&(a.pop(),a.pop(),s.set(a[a.length-2],a[a.length-1]));const e=.5*(i.x+s.x),t=.5*(s.y+i.y);a.unshift(e,t),a.push(e,t)}const d=t.points,u=a.length/2;let m=a.length;const p=d.length/2,g=o.width/2,h=g*g,f=o.miterLimit*o.miterLimit;let v=a[0],b=a[1],y=a[2],x=a[3],k=0,w=0,E=-(b-x),N=v-y,S=0,V=0,_=Math.sqrt(E*E+N*N);E/=_,N/=_,E*=g,N*=g;const C=o.alignment,A=2*(1-C),D=2*C;l||(o.cap===r1.ROUND?m+=c1(v-E*(A-D)*.5,b-N*(A-D)*.5,v-E*A,b-N*A,v+E*D,b+N*D,d,!0)+2:o.cap===r1.SQUARE&&(m+=l1(v,b,E,N,A,D,!0,d))),d.push(v-E*A,b-N*A,v+E*D,b+N*D);for(let e=1;e<u-1;++e){v=a[2*(e-1)],b=a[2*(e-1)+1],y=a[2*e],x=a[2*e+1],k=a[2*(e+1)],w=a[2*(e+1)+1],E=-(b-x),N=v-y,_=Math.sqrt(E*E+N*N),E/=_,N/=_,E*=g,N*=g,S=-(x-w),V=y-k,_=Math.sqrt(S*S+V*V),S/=_,V/=_,S*=g,V*=g;const t=y-v,n=b-x,r=y-k,i=w-x,s=t*r+n*i,l=n*r-i*t,c=l<0;if(Math.abs(l)<.001*Math.abs(s)){d.push(y-E*A,x-N*A,y+E*D,x+N*D),s>=0&&(o.join===a1.ROUND?m+=c1(y,x,y-E*A,x-N*A,y-S*A,x-V*A,d,!1)+4:m+=2,d.push(y-S*D,x-V*D,y+S*A,x+V*A));continue}const u=(-E+v)*(-N+x)-(-E+y)*(-N+b),p=(-S+k)*(-V+x)-(-S+y)*(-V+w),C=(t*p-r*u)/l,T=(i*u-n*p)/l,B=(C-y)*(C-y)+(T-x)*(T-x),I=y+(C-y)*A,z=x+(T-x)*A,M=y-(C-y)*D,P=x-(T-x)*D,R=c?A:D,$=B<=Math.min(t*t+n*n,r*r+i*i)+R*R*h;let O=o.join;if(O===a1.MITER&&B/h>f&&(O=a1.BEVEL),$)switch(O){case a1.MITER:d.push(I,z,M,P);break;case a1.BEVEL:c?d.push(I,z,y+E*D,x+N*D,I,z,y+S*D,x+V*D):d.push(y-E*A,x-N*A,M,P,y-S*A,x-V*A,M,P),m+=2;break;case a1.ROUND:c?(d.push(I,z,y+E*D,x+N*D),m+=c1(y,x,y+E*D,x+N*D,y+S*D,x+V*D,d,!0)+4,d.push(I,z,y+S*D,x+V*D)):(d.push(y-E*A,x-N*A,M,P),m+=c1(y,x,y-E*A,x-N*A,y-S*A,x-V*A,d,!1)+4,d.push(y-S*A,x-V*A,M,P))}else{switch(d.push(y-E*A,x-N*A,y+E*D,x+N*D),O){case a1.MITER:c?d.push(M,P,M,P):d.push(I,z,I,z),m+=2;break;case a1.ROUND:m+=c?c1(y,x,y+E*D,x+N*D,y+S*D,x+V*D,d,!0)+2:c1(y,x,y-E*A,x-N*A,y-S*A,x-V*A,d,!1)+2}d.push(y-S*A,x-V*A,y+S*D,x+V*D),m+=2}}v=a[2*(u-2)],b=a[2*(u-2)+1],y=a[2*(u-1)],x=a[2*(u-1)+1],E=-(b-x),N=v-y,_=Math.sqrt(E*E+N*N),E/=_,N/=_,E*=g,N*=g,d.push(y-E*A,x-N*A,y+E*D,x+N*D),l||(o.cap===r1.ROUND?m+=c1(y-E*(A-D)*.5,x-N*(A-D)*.5,y-E*A,x-N*A,y+E*D,x+N*D,d,!1)+2:o.cap===r1.SQUARE&&(m+=l1(y,x,E,N,A,D,!1,d)));const T=t.indices,B=o1.epsilon*o1.epsilon;for(let e=p;e<m+p-2;++e)v=d[2*e],b=d[2*e+1],y=d[2*(e+1)],x=d[2*(e+1)+1],k=d[2*(e+2)],w=d[2*(e+2)+1],!(Math.abs(v*(x-w)+y*(w-b)+k*(b-x))<B)&&T.push(e,e+1,e+2)}(e,t)}class u1{static curveLength(e,t,n,a,r,o){const i=e-2*n+r,s=t-2*a+o,l=2*n-2*e,c=2*a-2*t,d=4*(i*i+s*s),u=4*(i*l+s*c),m=l*l+c*c,p=2*Math.sqrt(d+u+m),g=Math.sqrt(d),h=2*d*g,f=2*Math.sqrt(m),v=u/g;return(h*p+g*u*(p-f)+(4*m*d-u*u)*Math.log((2*g+v+p)/(v+f)))/(4*h)}static curveTo(e,t,n,a,r){const o=r[r.length-2],i=r[r.length-1],s=o1._segmentsCount(u1.curveLength(o,i,e,t,n,a));let l=0,c=0;for(let d=1;d<=s;++d){const u=d/s;l=o+(e-o)*u,c=i+(t-i)*u,r.push(l+(e+(n-e)*u-l)*u,c+(t+(a-t)*u-c)*u)}}}const m1={[VJ.POLY]:e1,[VJ.CIRC]:Z0,[VJ.ELIP]:Z0,[VJ.RECT]:t1,[VJ.RREC]:n1},p1=[],g1=[];class h1{constructor(e,t=null,n=null,a=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=n,this.fillStyle=t,this.matrix=a,this.type=e.type}clone(){return new h1(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class f1{constructor(){this.reset()}begin(e,t,n){this.reset(),this.style=e,this.start=t,this.attribStart=n}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const v1=new _J,b1=class e extends wJ{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new KZ,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),g1.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),p1.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,n=null,a=null){const r=new h1(e,t,n,a);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const n=new h1(e,null,null,t),a=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=a.lineStyle,a.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let n=0;n<t.length;++n){const a=t[n];if(a.fillStyle.visible&&a.shape&&(a.matrix?a.matrix.applyInverse(e,v1):v1.copyFrom(e),a.shape.contains(v1.x,v1.y))){let e=!1;if(a.holes)for(let t=0;t<a.holes.length;t++)if(a.holes[t].shape.contains(v1.x,v1.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let n=null,a=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],a=n.style);for(let r=this.shapeIndex;r<t.length;r++){this.shapeIndex++;const o=t[r],i=o.fillStyle,s=o.lineStyle;m1[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(i.visible||s.visible)&&this.processHoles(o.holes);for(let t=0;t<2;t++){const r=0===t?i:s;if(!r.visible)continue;const l=r.texture.baseTexture,c=this.indices.length,d=this.points.length/2;l.wrapMode=bW.REPEAT,0===t?this.processFill(o):this.processLine(o);const u=this.points.length/2-d;0!==u&&(n&&!this._compareStyles(a,r)&&(n.end(c,d),n=null),n||(n=p1.pop()||new f1,n.begin(r,c,d),this.batches.push(n),a=r),this.addUvs(this.points,e,r.texture,d,u,r.matrix))}}const r=this.indices.length,o=this.points.length/2;if(n&&n.end(r,o),0===this.batches.length)return void(this.batchable=!0);const i=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&i===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=i?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const t=this.graphicsData[e],n=t.fillStyle,a=t.lineStyle;if(n&&!n.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0;e<n.size;e++){const t=n.start+e;this.indicesUint16[t]=this.indicesUint16[t]-n.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++mJ._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),g1.push(this.drawCalls[e]);this.drawCalls.length=0;const t=this.colors,n=this.textureIds;let a=g1.pop();a||(a=new pJ,a.texArray=new mK),a.texArray.count=0,a.start=0,a.size=0,a.type=mW.TRIANGLES;let r=0,o=null,i=0,s=!1,l=mW.TRIANGLES,c=0;this.drawCalls.push(a);for(let d=0;d<this.batches.length;d++){const u=this.batches[d],m=8,p=u.style,g=p.texture.baseTexture;s!==!!p.native&&(s=!!p.native,l=s?mW.LINES:mW.TRIANGLES,o=null,r=m,e++),o!==g&&(o=g,g._batchEnabled!==e&&(r===m&&(e++,r=0,a.size>0&&(a=g1.pop(),a||(a=new pJ,a.texArray=new mK),this.drawCalls.push(a)),a.start=c,a.size=0,a.texArray.count=0,a.type=l),g.touched=1,g._batchEnabled=e,g._batchLocation=r,g.wrapMode=bW.REPEAT,a.texArray.elements[a.texArray.count++]=g,r++)),a.size+=u.size,c+=u.size,i=g._batchLocation,this.addColors(t,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(n,i,u.attribSize,u.attribStart)}mJ._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,n=this.colors,a=this.textureIds,r=new ArrayBuffer(3*e.length*4),o=new Float32Array(r),i=new Uint32Array(r);let s=0;for(let r=0;r<e.length/2;r++)o[s++]=e[2*r],o[s++]=e[2*r+1],o[s++]=t[2*r],o[s++]=t[2*r+1],i[s++]=n[r],o[s++]=a[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?e1.triangulate(e,this):m1[e.type].triangulate(e,this)}processLine(e){d1(e,this);for(let t=0;t<e.holes.length;t++)d1(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const n=e[t];m1[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let n=0;n<e.length/2;n++){const a=e[2*n],r=e[2*n+1];e[2*n]=t.a*a+t.c*r+t.tx,e[2*n+1]=t.b*a+t.d*r+t.ty}}addColors(e,t,n,a,r=0){const o=TX.shared.setValue(t).toLittleEndianNumber(),i=TX.shared.setValue(o).toPremultiplied(n);e.length=Math.max(e.length,r+a);for(let t=0;t<a;t++)e[r+t]=i}addTextureIds(e,t,n,a=0){e.length=Math.max(e.length,a+n);for(let r=0;r<n;r++)e[a+r]=t}addUvs(e,t,n,a,r,o=null){let i=0;const s=t.length,l=n.frame;for(;i<r;){let n=e[2*(a+i)],r=e[2*(a+i)+1];if(o){const e=o.a*n+o.c*r+o.tx;r=o.b*n+o.d*r+o.ty,n=e}i++,t.push(n/l.width,r/l.height)}const c=n.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(t,n,s,r)}adjustUvs(e,t,n,a){const r=t.baseTexture,o=1e-6,i=n+2*a,s=t.frame,l=s.width/r.width,c=s.height/r.height;let d=s.x/s.width,u=s.y/s.height,m=Math.floor(e[n]+o),p=Math.floor(e[n+1]+o);for(let t=n+2;t<i;t+=2)m=Math.min(m,Math.floor(e[t]+o)),p=Math.min(p,Math.floor(e[t+1]+o));d-=m,u-=p;for(let t=n;t<i;t+=2)e[t]=(e[t]+d)*l,e[t+1]=(e[t+1]+u)*c}};b1.BATCHABLE_SIZE=100;let y1=b1;class x1{constructor(){this.color=16777215,this.alpha=1,this.texture=AK.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new x1;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=AK.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class k1 extends x1{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=r1.BUTT,this.join=a1.MITER,this.miterLimit=10}clone(){const e=new k1;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=r1.BUTT,this.join=a1.MITER,this.miterLimit=10}}const w1={},E1=class e extends aQ{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new x1,this._lineStyle=new k1,this._matrix=null,this._holeMode=!1,this.state=rJ.for2d(),this._geometry=e||new y1,this._geometry.refCount++,this._transformID=-1,this._tintColor=new TX(16777215),this.blendMode=uW.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,n,a=.5,r=!1){return"number"==typeof e&&(e={width:e,color:t,alpha:n,alignment:a,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:AK.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:r1.BUTT,join:a1.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.width>0&&e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:n},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new BJ,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new BJ,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,a=n[n.length-2],r=n[n.length-1];return(a!==e||r!==t)&&n.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,n,a){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),u1.curveTo(e,t,n,a,r),this}bezierCurveTo(e,t,n,a,r,o){return this._initCurve(),s1.curveTo(e,t,n,a,r,o,this.currentPath.points),this}arcTo(e,t,n,a,r){this._initCurve(e,t);const o=this.currentPath.points,i=i1.curveTo(e,t,n,a,r,o);if(i){const{cx:e,cy:t,radius:n,startAngle:a,endAngle:r,anticlockwise:o}=i;this.arc(e,t,n,a,r,o)}return this}arc(e,t,n,a,r,o=!1){if(a===r)return this;if(!o&&r<=a?r+=EJ:o&&a<=r&&(a+=EJ),r-a===0)return this;const i=e+Math.cos(a)*n,s=t+Math.sin(a)*n,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const e=Math.abs(c[c.length-2]-i),t=Math.abs(c[c.length-1]-s);e<l&&t<l||c.push(i,s)}else this.moveTo(i,s),c=this.currentPath.points;return i1.arc(i,s,e,t,n,a,r,o,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:AK.WHITE,color:e,alpha:t})}normalizeColor(e){const t=TX.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:AK.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:n},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,n,a){return this.drawShape(new AJ(e,t,n,a))}drawRoundedRect(e,t,n,a,r){return this.drawShape(new IJ(e,t,n,a,r))}drawCircle(e,t,n){return this.drawShape(new DJ(e,t,n))}drawEllipse(e,t,n,a){return this.drawShape(new TJ(e,t,n,a))}drawPolygon(...e){let t,n=!0;const a=e[0];a.points?(n=a.closeStroke,t=a.points):t=Array.isArray(e[0])?e[0]:e;const r=new BJ(t);return r.closeStroke=n,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==VJ.RECT||e[0].matrix||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,n=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(e.points);for(let a=0;a<n;a++){const n=e.batches[a],r=n.style.color,o=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),i=new Float32Array(e.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),s={vertexData:o,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*n.start,n.size),uvs:i,_batchRGB:TX.shared.setValue(r).toRgbArray(),_tintRGB:r,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[a]=s}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,n=this.batches.length;t<n;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),n=this._geometry,a=this.worldAlpha,r=t.uniforms,o=n.drawCalls;r.translationMatrix=this.transform.worldTransform,TX.shared.setValue(this._tintColor).premultiply(a).toArray(r.tint),e.shader.bind(t),e.geometry.bind(n,t),e.state.set(this.state);for(let t=0,a=o.length;t<a;t++)this._renderDrawCallDirect(e,n.drawCalls[t])}_renderDrawCallDirect(e,t){const{texArray:n,type:a,size:r,start:o}=t,i=n.count;for(let t=0;t<i;t++)e.texture.bind(n.elements[t],t);e.geometry.draw(a,r,o)}_resolveDirectShader(e){let t=this.shader;const n=this.pluginName;if(!t){if(!w1[n]){const{maxTextures:t}=e.plugins[n],a=new Int32Array(t);for(let e=0;e<t;e++)a[e]=e;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new zJ,default:cK.from({uSamplers:a},!0)},o=e.plugins[n]._shader.program;w1[n]=new dK(o,r)}t=w1[n]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:n,maxX:a,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,n,a,r)}containsPoint(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=TX.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,n=t.a,a=t.b,r=t.c,o=t.d,i=t.tx,s=t.ty,l=this._geometry.points,c=this.vertexData;let d=0;for(let e=0;e<l.length;e+=2){const t=l[e],u=l[e+1];c[d++]=n*t+r*u+i,c[d++]=o*u+a*t+s}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};E1.curves=o1,E1._TEMP_POINT=new _J;let N1=E1;class S1{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const V1=new _J,_1=new BJ,C1=class e extends aQ{constructor(e,t,n,a=mW.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=n||rJ.for2d(),this.drawMode=a,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=CW.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(t){const n=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===mW.TRIANGLES&&n.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const a=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[a]),e.plugins[a].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,n=e._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const a=this.transform.worldTransform,r=a.a,o=a.b,i=a.c,s=a.d,l=a.tx,c=a.ty,d=this.vertexData;for(let e=0;e<d.length/2;e++){const n=t[2*e],a=t[2*e+1];d[2*e]=r*n+i*a+l,d[2*e+1]=o*n+s*a+c}if(this._roundPixels){const e=CW.RESOLUTION;for(let t=0;t<d.length;++t)d[t]=Math.round(d[t]*e)/e}this.vertexDirty=n}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new S1(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,V1);const t=this.geometry.getBuffer("aVertexPosition").data,n=_1.points,a=this.geometry.getIndex().data,r=a.length,o=4===this.drawMode?3:1;for(let e=0;e+2<r;e+=o){const r=2*a[e],o=2*a[e+1],i=2*a[e+2];if(n[0]=t[r],n[1]=t[r+1],n[2]=t[o],n[3]=t[o+1],n[4]=t[i],n[5]=t[i+1],_1.contains(V1.x,V1.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};C1.BATCHABLE_SIZE=100;let A1=C1;class D1 extends kJ{constructor(e,t,n){super();const a=new hJ(e),r=new hJ(t,!0),o=new hJ(n,!0,!0);this.addAttribute("aVertexPosition",a,2,!1,hW.FLOAT).addAttribute("aTextureCoord",r,2,!1,hW.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class T1 extends dK{constructor(e,t){const n={uSampler:e,alpha:1,uTextureMatrix:zJ.IDENTITY,uColor:new Float32Array([1,1,1,1])};(t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t)).uniforms&&Object.assign(n,t.uniforms),super(t.program||sK.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new qK(e),this.batchable=void 0===t.program,this.pluginName=t.pluginName,this._tintColor=new TX(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;TX.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class B1{constructor(e,t,n){this.geometry=new kJ,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<e.length;++n){let a=e[n];a={attributeName:a.attributeName,size:a.size,uploadFunction:a.uploadFunction,type:a.type||hW.FLOAT,offset:a.offset},t[n]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new hJ(function(e,t=null){const n=6*e;if((t=t||new Uint16Array(n)).length!==n)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${n}`);for(let e=0,a=0;e<n;e+=6,a+=4)t[e+0]=a+0,t[e+1]=a+1,t[e+2]=a+2,t[e+3]=a+0,t[e+4]=a+2,t[e+5]=a+3;return t}(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const n=this.dynamicProperties[e];n.offset=t,t+=n.size,this.dynamicStride+=n.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new hJ(this.dynamicData,!1,!1);let a=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const t=this.staticProperties[e];t.offset=a,a+=t.size,this.staticStride+=t.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new hJ(this.staticData,!0,!1);for(let t=0;t<this.dynamicProperties.length;++t){const n=this.dynamicProperties[t];e.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===hW.UNSIGNED_BYTE,n.type,4*this.dynamicStride,4*n.offset)}for(let t=0;t<this.staticProperties.length;++t){const n=this.staticProperties[t];e.addAttribute(n.attributeName,this.staticBuffer,0,n.type===hW.UNSIGNED_BYTE,n.type,4*this.staticStride,4*n.offset)}}uploadDynamic(e,t,n){for(let a=0;a<this.dynamicProperties.length;a++){const r=this.dynamicProperties[a];r.uploadFunction(e,t,n,r.type===hW.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,n){for(let a=0;a<this.staticProperties.length;a++){const r=this.staticProperties[a];r.uploadFunction(e,t,n,r.type===hW.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class I1 extends pK{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new zJ,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:hW.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=dK.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=rJ.for2d()}render(e){const t=e.children,n=e._maxSize,a=e._batchSize,r=this.renderer;let o=t.length;if(0===o)return;o>n&&!e.autoResize&&(o=n);let i=e._buffers;i||(i=e._buffers=this.generateBuffers(e));const s=t[0]._texture.baseTexture,l=s.alphaMode>0;this.state.blendMode=IX(e.blendMode,l),r.state.set(this.state);const c=r.gl,d=e.worldTransform.copyTo(this.tempMatrix);d.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=TX.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);let u=!1;for(let n=0,s=0;n<o;n+=a,s+=1){let l=o-n;l>a&&(l=a),s>=i.length&&i.push(this._generateOneMoreBuffer(e));const d=i[s];d.uploadDynamic(t,n,l);const m=e._bufferUpdateIDs[s]||0;u=u||d._updateID<m,u&&(d._updateID=e._updateID,d.uploadStatic(t,n,l)),r.geometry.bind(d.geometry),c.drawElements(c.TRIANGLES,6*l,c.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],n=e._maxSize,a=e._batchSize,r=e._properties;for(let e=0;e<n;e+=a)t.push(new B1(this.properties,r,a));return t}_generateOneMoreBuffer(e){const t=e._batchSize,n=e._properties;return new B1(this.properties,n,t)}uploadVertices(e,t,n,a,r,o){let i=0,s=0,l=0,c=0;for(let d=0;d<n;++d){const n=e[t+d],u=n._texture,m=n.scale.x,p=n.scale.y,g=u.trim,h=u.orig;g?(s=g.x-n.anchor.x*h.width,i=s+g.width,c=g.y-n.anchor.y*h.height,l=c+g.height):(i=h.width*(1-n.anchor.x),s=h.width*-n.anchor.x,l=h.height*(1-n.anchor.y),c=h.height*-n.anchor.y),a[o]=s*m,a[o+1]=c*p,a[o+r]=i*m,a[o+r+1]=c*p,a[o+2*r]=i*m,a[o+2*r+1]=l*p,a[o+3*r]=s*m,a[o+3*r+1]=l*p,o+=4*r}}uploadPosition(e,t,n,a,r,o){for(let i=0;i<n;i++){const n=e[t+i].position;a[o]=n.x,a[o+1]=n.y,a[o+r]=n.x,a[o+r+1]=n.y,a[o+2*r]=n.x,a[o+2*r+1]=n.y,a[o+3*r]=n.x,a[o+3*r+1]=n.y,o+=4*r}}uploadRotation(e,t,n,a,r,o){for(let i=0;i<n;i++){const n=e[t+i].rotation;a[o]=n,a[o+r]=n,a[o+2*r]=n,a[o+3*r]=n,o+=4*r}}uploadUvs(e,t,n,a,r,o){for(let i=0;i<n;++i){const n=e[t+i]._texture._uvs;n?(a[o]=n.x0,a[o+1]=n.y0,a[o+r]=n.x1,a[o+r+1]=n.y1,a[o+2*r]=n.x2,a[o+2*r+1]=n.y2,a[o+3*r]=n.x3,a[o+3*r+1]=n.y3,o+=4*r):(a[o]=0,a[o+1]=0,a[o+r]=0,a[o+r+1]=0,a[o+2*r]=0,a[o+2*r+1]=0,a[o+3*r]=0,a[o+3*r+1]=0,o+=4*r)}}uploadTint(e,t,n,a,r,o){for(let i=0;i<n;++i){const n=e[t+i],s=TX.shared.setValue(n._tintRGB).toPremultiplied(n.alpha,n.texture.baseTexture.alphaMode>0);a[o]=s,a[o+r]=s,a[o+2*r]=s,a[o+3*r]=s,o+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}I1.extension={name:"particle",type:KX.RendererPlugin},eJ.add(I1);var z1=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(z1||{});const M1={willReadFrequently:!0},P1=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){const n=CW.ADAPTER.getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported="letterSpacing"in n||"textLetterSpacing"in n}return t}constructor(e,t,n,a,r,o,i,s,l){this.text=e,this.style=t,this.width=n,this.height=a,this.lines=r,this.lineWidths=o,this.lineHeight=i,this.maxLineWidth=s,this.fontProperties=l}static measureText(t,n,a,r=e._canvas){a=a??n.wordWrap;const o=n.toFontString(),i=e.measureFont(o);0===i.fontSize&&(i.fontSize=n.fontSize,i.ascent=n.fontSize);const s=r.getContext("2d",M1);s.font=o;const l=(a?e.wordWrap(t,n,r):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let d=0;for(let t=0;t<l.length;t++){const a=e._measureText(l[t],n.letterSpacing,s);c[t]=a,d=Math.max(d,a)}let u=d+n.strokeThickness;n.dropShadow&&(u+=n.dropShadowDistance);const m=n.lineHeight||i.fontSize+n.strokeThickness;let p=Math.max(m,i.fontSize+2*n.strokeThickness)+n.leading+(l.length-1)*(m+n.leading);return n.dropShadow&&(p+=n.dropShadowDistance),new e(t,n,u,p,l,c,m+n.leading,d,i)}static _measureText(t,n,a){let r=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(a.letterSpacing=`${n}px`,a.textLetterSpacing=`${n}px`,r=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px"));let o=a.measureText(t).width;return o>0&&(r?o-=n:o+=(e.graphemeSegmenter(t).length-1)*n),o}static wordWrap(t,n,a=e._canvas){const r=a.getContext("2d",M1);let o=0,i="",s="";const l=Object.create(null),{letterSpacing:c,whiteSpace:d}=n,u=e.collapseSpaces(d),m=e.collapseNewlines(d);let p=!u;const g=n.wordWrapWidth+c,h=e.tokenize(t);for(let t=0;t<h.length;t++){let a=h[t];if(e.isNewline(a)){if(!m){s+=e.addLine(i),p=!u,i="",o=0;continue}a=" "}if(u){const t=e.isBreakingSpace(a),n=e.isBreakingSpace(i[i.length-1]);if(t&&n)continue}const d=e.getFromCache(a,c,l,r);if(d>g)if(""!==i&&(s+=e.addLine(i),i="",o=0),e.canBreakWords(a,n.breakWords)){const t=e.wordWrapSplit(a);for(let d=0;d<t.length;d++){let u=t[d],m=u,h=1;for(;t[d+h];){const r=t[d+h];if(e.canBreakChars(m,r,a,d,n.breakWords))break;u+=r,m=r,h++}d+=h-1;const f=e.getFromCache(u,c,l,r);f+o>g&&(s+=e.addLine(i),p=!1,i="",o=0),i+=u,o+=f}}else{i.length>0&&(s+=e.addLine(i),i="",o=0);const n=t===h.length-1;s+=e.addLine(a,!n),p=!1,i="",o=0}else d+o>g&&(p=!1,s+=e.addLine(i),i="",o=0),(i.length>0||!e.isBreakingSpace(a)||p)&&(i+=a,o+=d)}return s+=e.addLine(i,!1),s}static addLine(t,n=!0){return t=e.trimRight(t),n?`${t}\n`:t}static getFromCache(t,n,a,r){let o=a[t];return"number"!=typeof o&&(o=e._measureText(t,n,r)+n,a[t]=o),o}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(t){if("string"!=typeof t)return"";for(let n=t.length-1;n>=0;n--){const a=t[n];if(!e.isBreakingSpace(a))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,n){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const n=[];let a="";if("string"!=typeof t)return n;for(let r=0;r<t.length;r++){const o=t[r],i=t[r+1];e.isBreakingSpace(o,i)||e.isNewline(o)?(""!==a&&(n.push(a),a=""),n.push(o)):a+=o}return""!==a&&n.push(a),n}static canBreakWords(e,t){return t}static canBreakChars(e,t,n,a,r){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];const n={ascent:0,descent:0,fontSize:0},a=e._canvas,r=e._context;r.font=t;const o=e.METRICS_STRING+e.BASELINE_SYMBOL,i=Math.ceil(r.measureText(o).width);let s=Math.ceil(r.measureText(e.BASELINE_SYMBOL).width);const l=Math.ceil(e.HEIGHT_MULTIPLIER*s);if(s=s*e.BASELINE_MULTIPLIER|0,0===i||0===l)return e._fonts[t]=n,n;a.width=i,a.height=l,r.fillStyle="#f00",r.fillRect(0,0,i,l),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(o,0,s);const c=r.getImageData(0,0,i,l).data,d=c.length,u=4*i;let m=0,p=0,g=!1;for(m=0;m<s;++m){for(let e=0;e<u;e+=4)if(255!==c[p+e]){g=!0;break}if(g)break;p+=u}for(n.ascent=s-m,p=d-u,g=!1,m=l;m>s;--m){for(let e=0;e<u;e+=4)if(255!==c[p+e]){g=!0;break}if(g)break;p-=u}return n.descent=m-s,n.fontSize=n.ascent+n.descent,e._fonts[t]=n,n}static clearMetrics(t=""){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let t;try{const n=new OffscreenCanvas(0,0);if(n.getContext("2d",M1)?.measureText)return e.__canvas=n,n;t=CW.ADAPTER.createCanvas()}catch{t=CW.ADAPTER.createCanvas()}t.width=t.height=10,e.__canvas=t}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",M1)),e.__context}};P1.METRICS_STRING="|ÉqÅ",P1.BASELINE_SYMBOL="M",P1.BASELINE_MULTIPLIER=1.4,P1.HEIGHT_MULTIPLIER=2,P1.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(e=>e.segment)}return e=>[...e]})(),P1.experimentalLetterSpacing=!1,P1._fonts={},P1._newlines=[10,13],P1._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let R1=P1;const $1=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],O1=class e{constructor(e){this.styleID=0,this.reset(),j1(this,e,e)}clone(){const t={};return j1(t,this,e.defaultStyle),new e(t)}reset(){j1(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=F1(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=F1(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=F1(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let n=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!$1.includes(n)&&(n=`"${n}"`),t[e]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};O1.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:z1.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let L1=O1;function F1(e){const t=TX.shared,n=e=>{const n=t.setValue(e);return 1===n.alpha?n.toHex():n.toRgbaString()};return Array.isArray(e)?e.map(n):n(e)}function j1(e,t,n){for(const a in n)Array.isArray(t[a])?e[a]=t[a].slice():e[a]=t[a]}const U1={texture:!0,children:!1,baseTexture:!0},q1=class e extends iQ{constructor(t,n,a){let r=!1;a||(a=CW.ADAPTER.createCanvas(),r=!0),a.width=3,a.height=3;const o=AK.from(a);o.orig=new AJ,o.trim=new AJ,super(o),this._ownCanvas=r,this.canvas=a,this.context=a.getContext("2d",{willReadFrequently:!0}),this._resolution=e.defaultResolution??CW.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=n,this.localStyleID=-1}static get experimentalLetterSpacing(){return R1.experimentalLetterSpacing}static set experimentalLetterSpacing(e){JW("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),R1.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const n=this.context,a=R1.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=a.width,o=a.height,i=a.lines,s=a.lineHeight,l=a.lineWidths,c=a.maxLineWidth,d=a.fontProperties;let u,m;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+2*t.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=t.strokeThickness,n.textBaseline=t.textBaseline,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit;const p=t.dropShadow?2:1;for(let e=0;e<p;++e){const r=t.dropShadow&&0===e,p=r?Math.ceil(Math.max(1,o)+2*t.padding):0,g=p*this._resolution;if(r){n.fillStyle="black",n.strokeStyle="black";const e=t.dropShadowColor,a=t.dropShadowBlur*this._resolution,r=t.dropShadowDistance*this._resolution;n.shadowColor=TX.shared.setValue(e).setAlpha(t.dropShadowAlpha).toRgbaString(),n.shadowBlur=a,n.shadowOffsetX=Math.cos(t.dropShadowAngle)*r,n.shadowOffsetY=Math.sin(t.dropShadowAngle)*r+g}else n.fillStyle=this._generateFillStyle(t,i,a),n.strokeStyle=t.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let h=(s-d.fontSize)/2;s-d.fontSize<0&&(h=0);for(let e=0;e<i.length;e++)u=t.strokeThickness/2,m=t.strokeThickness/2+e*s+d.ascent+h,"right"===t.align?u+=c-l[e]:"center"===t.align&&(u+=(c-l[e])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(i[e],u+t.padding,m+t.padding-p,!0),t.fill&&this.drawLetterSpacing(i[e],u+t.padding,m+t.padding-p)}this.updateTexture()}drawLetterSpacing(e,t,n,a=!1){const r=this._style.letterSpacing;let o=!1;if(R1.experimentalLetterSpacingSupported&&(R1.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||o)return void(a?this.context.strokeText(e,t,n):this.context.fillText(e,t,n));let i=t;const s=R1.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let e=0;e<s.length;++e){const t=s[e];a?this.context.strokeText(t,i,n):this.context.fillText(t,i,n);let o="";for(let t=e+1;t<s.length;++t)o+=s[t];c=this.context.measureText(o).width,i+=l-c+r,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const t=function(e){const t=function(e){const{width:t,height:n}=e,a=e.getContext("2d",{willReadFrequently:!0});if(null===a)throw new TypeError("Failed to get canvas 2D context");const r=a.getImageData(0,0,t,n).data;let o=0,i=0,s=t-1,l=n-1;for(;i<n&&WX(r,t,i);)++i;if(i===n)return UX.EMPTY;for(;WX(r,t,l);)--l;for(;XX(r,t,o,i,l);)++o;for(;XX(r,t,s,i,l);)--s;return++s,++l,new UX(o,i,s,l)}(e),{width:n,height:a}=t;let r=null;if(!t.isEmpty()){const o=e.getContext("2d");if(null===o)throw new TypeError("Failed to get canvas 2D context");r=o.getImageData(t.left,t.top,n,a)}return{width:n,height:a,data:r}}(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}const t=this._texture,n=this._style,a=n.trim?0:n.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-a,t.trim.y=-a,t.orig.width=t._frame.width-2*a,t.orig.height=t._frame.height-2*a,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,n){const a=e.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let r;const o=e.dropShadow?e.dropShadowDistance:0,i=e.padding||0,s=this.canvas.width/this._resolution-o-2*i,l=this.canvas.height/this._resolution-o-2*i,c=a.slice(),d=e.fillGradientStops.slice();if(!d.length){const e=c.length+1;for(let t=1;t<e;++t)d.push(t/e)}if(c.unshift(a[0]),d.unshift(0),c.push(a[a.length-1]),d.push(1),e.fillGradientType===z1.LINEAR_VERTICAL){r=this.context.createLinearGradient(s/2,i,s/2,l+i);const a=n.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const o=n.lineHeight*(e-1)+a,i=n.lineHeight*e;let s=i;e>0&&o>i&&(s=(i+o)/2);const u=i+a,m=n.lineHeight*(e+1);let p=u;e+1<t.length&&m<u&&(p=(u+m)/2);const g=(p-s)/l;for(let e=0;e<c.length;e++){let t=0;t="number"==typeof d[e]?d[e]:e/c.length;let n=Math.min(1,Math.max(0,s/l+t*g));n=Number(n.toFixed(5)),r.addColorStop(n,c[e])}}}else{r=this.context.createLinearGradient(i,l/2,s+i,l/2);const e=c.length+1;let t=1;for(let n=0;n<c.length;n++){let a;a="number"==typeof d[n]?d[n]:t/e,r.addColorStop(a,c[n]),t++}}return r}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},U1,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=OX(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=OX(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof L1?e:new L1(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};q1.defaultAutoResolution=!0;let G1=q1;class H1{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Y1(e,t){let n=!1;if(e?._textures?.length)for(let a=0;a<e._textures.length;a++)if(e._textures[a]instanceof AK){const r=e._textures[a].baseTexture;t.includes(r)||(t.push(r),n=!0)}return n}function W1(e,t){if(e.baseTexture instanceof mJ){const n=e.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function X1(e,t){if(e._texture&&e._texture instanceof AK){const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function J1(e,t){return t instanceof G1&&(t.updateText(!0),!0)}function K1(e,t){if(t instanceof L1){const e=t.toFontString();return R1.measureFont(e),!0}return!1}function Z1(e,t){if(e instanceof G1){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Q1(e,t){return e instanceof L1&&(t.includes(e)||t.push(e),!0)}const e2=class e{constructor(t){this.limiter=new H1(e.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Z1),this.registerFindHook(Q1),this.registerFindHook(Y1),this.registerFindHook(W1),this.registerFindHook(X1),this.registerUploadHook(J1),this.registerUploadHook(K1)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,IZ.system.addOnce(this.tick,this,DZ.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let n=0,a=this.uploadHooks.length;n<a;n++)if(this.uploadHooks[n](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)IZ.system.addOnce(this.tick,this,DZ.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,n=e.length;t<n;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,n=this.addHooks.length;t<n&&!this.addHooks[t](e,this.queue);t++);if(e instanceof aQ)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&IZ.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};e2.uploadsPerFrame=4;let t2=e2;function n2(e,t){return t instanceof mJ&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function a2(e,t){if(!(t instanceof N1))return!1;const{geometry:n}=t;t.finishPoly(),n.updateBatches();const{batches:a}=n;for(let t=0;t<a.length;t++){const{texture:n}=a[t].style;n&&n2(e,n.baseTexture)}return n.batchable||e.geometry.bind(n,t._resolveDirectShader(e)),!0}function r2(e,t){return e instanceof N1&&(t.push(e),!0)}Object.defineProperties(CW,{UPLOADS_PER_FRAME:{get:()=>t2.uploadsPerFrame,set(e){JW("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),t2.uploadsPerFrame=e}}});class o2 extends t2{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(r2),this.registerUploadHook(n2),this.registerUploadHook(a2)}}o2.extension={name:"prepare",type:KX.RendererSystem},eJ.add(o2),new _J;var i2="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const s2=new zJ;class l2 extends pK{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new IK,this.state=rJ.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=dK.from(i2,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",t),this.shader=e.context.webGLVersion>1?dK.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",t):dK.from(i2,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",t)}render(e){const t=this.renderer,n=this.quad;let a=n.vertices;a[0]=a[6]=e._width*-e.anchor.x,a[1]=a[3]=e._height*-e.anchor.y,a[2]=a[4]=e._width*(1-e.anchor.x),a[5]=a[7]=e._height*(1-e.anchor.y);const r=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;a=n.uvs,a[0]=a[6]=-r,a[1]=a[3]=-o,a[2]=a[4]=1-r,a[5]=a[7]=1-o,n.invalidate();const i=e._texture,s=i.baseTexture,l=s.alphaMode>0,c=e.tileTransform.localTransform,d=e.uvMatrix;let u=s.isPowerOfTwo&&i.frame.width===s.width&&i.frame.height===s.height;u&&(s._glTextures[t.CONTEXT_UID]?u=s.wrapMode!==bW.CLAMP:s.wrapMode===bW.CLAMP&&(s.wrapMode=bW.REPEAT));const m=u?this.simpleShader:this.shader,p=i.width,g=i.height,h=e._width,f=e._height;s2.set(c.a*p/h,c.b*p/f,c.c*g/h,c.d*g/f,c.tx/h,c.ty/f),s2.invert(),u?s2.prepend(d.mapCoord):(m.uniforms.uMapCoord=d.mapCoord.toArray(!0),m.uniforms.uClampFrame=d.uClampFrame,m.uniforms.uClampOffset=d.uClampOffset),m.uniforms.uTransform=s2.toArray(!0),m.uniforms.uColor=TX.shared.setValue(e.tint).premultiply(e.worldAlpha,l).toArray(m.uniforms.uColor),m.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),m.uniforms.uSampler=i,t.shader.bind(m),t.geometry.bind(n),this.state.blendMode=IX(e.blendMode,l),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}l2.extension={name:"tilingSprite",type:KX.RendererPlugin},eJ.add(l2);const c2=class e{constructor(e,t,n){this.linkedSheets=[],(e instanceof mJ||e instanceof AK)&&(e={texture:e,data:t,resolutionFilename:n});const{texture:a,data:r,resolutionFilename:o=null,cachePrefix:i=""}=e;this.cachePrefix=i,this._texture=a instanceof AK?a:null,this.baseTexture=a instanceof mJ?a:this._texture.baseTexture,this.textures={},this.animations={},this.data=r;const s=this.baseTexture.resource;this.resolution=this._updateResolution(o||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let n=JX(e,null);return null===n&&(n="number"==typeof t?t:parseFloat(t??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let n=t;const a=e.BATCH_SIZE;for(;n-t<a&&n<this._frameKeys.length;){const e=this._frameKeys[n],t=this._frames[e],a=t.frame;if(a){let n=null,r=null;const o=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,i=new AJ(0,0,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution);n=t.rotated?new AJ(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new AJ(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(r=new AJ(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[e]=new AK(this.baseTexture,n,i,r,t.rotated?2:0,t.anchor,t.borders),AK.addToCache(this.textures[e],this.cachePrefix+e.toString())}n++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let n=0;n<e[t].length;n++){const a=e[t][n];this.animations[t].push(this.textures[a])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};c2.BATCH_SIZE=1e3;let d2=c2;const u2=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function m2(e,t,n){const a={};if(e.forEach(e=>{a[e]=t}),Object.keys(t.textures).forEach(e=>{a[`${t.cachePrefix}${e}`]=t.textures[e]}),!n){const n=QW.dirname(e[0]);t.linkedSheets.forEach((e,r)=>{Object.assign(a,m2([`${n}/${t.data.meta.related_multi_packs[r]}`],e,!0))})}return a}const p2={extension:KX.Asset,cache:{test:e=>e instanceof d2,getCacheableAssets:(e,t)=>m2(e,t,!1)},resolver:{test:e=>{const t=e.split("?")[0].split("."),n=t.pop(),a=t.pop();return"json"===n&&u2.includes(a)},parse:e=>{const t=e.split(".");return{resolution:parseFloat(CW.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:KX.LoadParser,priority:$Q.Normal},testParse:async(e,t)=>".json"===QW.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,n){const{texture:a,imageFilename:r,cachePrefix:o}=t?.data??{};let i,s=QW.dirname(t.src);if(s&&s.lastIndexOf("/")!==s.length-1&&(s+="/"),a&&a.baseTexture)i=a;else{const a=V0(s+(r??e.meta.image),t.src);i=(await n.load([a]))[a]}const l=new d2({texture:i.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:o});await l.parse();const c=e?.meta?.related_multi_packs;if(Array.isArray(c)){const e=[];for(const a of c){if("string"!=typeof a)continue;let r=s+a;t.data?.ignoreMultiPack||(r=V0(r,t.src),e.push(n.load({src:r,data:{ignoreMultiPack:!0}})))}const a=await Promise.all(e);l.linkedSheets=a,a.forEach(e=>{e.linkedSheets=[l].concat(l.linkedSheets.filter(t=>t!==e))})}return l},unload(e){e.destroy(!0)}}};eJ.add(p2);class g2{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class h2{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in t){const a=t[e].match(/^[a-z]+/gm)[0],r=t[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(const e in r){const t=r[e].split("="),n=t[0],a=t[1].replace(/"/gm,""),i=parseFloat(a),s=isNaN(i)?a:i;o[n]=s}n[a].push(o)}const a=new g2;return n.info.forEach(e=>a.info.push({face:e.face,size:parseInt(e.size,10)})),n.common.forEach(e=>a.common.push({lineHeight:parseInt(e.lineHeight,10)})),n.page.forEach(e=>a.page.push({id:parseInt(e.id,10),file:e.file})),n.char.forEach(e=>a.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})),n.kerning.forEach(e=>a.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})),n.distanceField.forEach(e=>a.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType})),a}}class f2{static test(e){const t=e;return"string"!=typeof e&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const t=new g2,n=e.getElementsByTagName("info"),a=e.getElementsByTagName("common"),r=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),i=e.getElementsByTagName("kerning"),s=e.getElementsByTagName("distanceField");for(let e=0;e<n.length;e++)t.info.push({face:n[e].getAttribute("face"),size:parseInt(n[e].getAttribute("size"),10)});for(let e=0;e<a.length;e++)t.common.push({lineHeight:parseInt(a[e].getAttribute("lineHeight"),10)});for(let e=0;e<r.length;e++)t.page.push({id:parseInt(r[e].getAttribute("id"),10)||0,file:r[e].getAttribute("file")});for(let e=0;e<o.length;e++){const n=o[e];t.char.push({id:parseInt(n.getAttribute("id"),10),page:parseInt(n.getAttribute("page"),10)||0,x:parseInt(n.getAttribute("x"),10),y:parseInt(n.getAttribute("y"),10),width:parseInt(n.getAttribute("width"),10),height:parseInt(n.getAttribute("height"),10),xoffset:parseInt(n.getAttribute("xoffset"),10),yoffset:parseInt(n.getAttribute("yoffset"),10),xadvance:parseInt(n.getAttribute("xadvance"),10)})}for(let e=0;e<i.length;e++)t.kerning.push({first:parseInt(i[e].getAttribute("first"),10),second:parseInt(i[e].getAttribute("second"),10),amount:parseInt(i[e].getAttribute("amount"),10)});for(let e=0;e<s.length;e++)t.distanceField.push({fieldType:s[e].getAttribute("fieldType"),distanceRange:parseInt(s[e].getAttribute("distanceRange"),10)});return t}}class v2{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&f2.test(CW.ADAPTER.parseXML(e))}static parse(e){return f2.parse(CW.ADAPTER.parseXML(e))}}const b2=[h2,f2,v2];function y2(e,t,n,a,r,o,i){const s=n.text,l=n.fontProperties;t.translate(a,r),t.scale(o,o);const c=i.strokeThickness/2,d=-i.strokeThickness/2;if(t.font=i.toFontString(),t.lineWidth=i.strokeThickness,t.textBaseline=i.textBaseline,t.lineJoin=i.lineJoin,t.miterLimit=i.miterLimit,t.fillStyle=function(e,t,n,a,r,o){const i=n.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let s;const l=n.dropShadow?n.dropShadowDistance:0,c=n.padding||0,d=e.width/a-l-2*c,u=e.height/a-l-2*c,m=i.slice(),p=n.fillGradientStops.slice();if(!p.length){const e=m.length+1;for(let t=1;t<e;++t)p.push(t/e)}if(m.unshift(i[0]),p.unshift(0),m.push(i[i.length-1]),p.push(1),n.fillGradientType===z1.LINEAR_VERTICAL){s=t.createLinearGradient(d/2,c,d/2,u+c);let e=0;const a=(o.fontProperties.fontSize+n.strokeThickness)/u;for(let t=0;t<r.length;t++){const n=o.lineHeight*t;for(let t=0;t<m.length;t++){let r=0;r="number"==typeof p[t]?p[t]:t/m.length;const o=n/u+r*a;let i=Math.max(e,o);i=Math.min(i,1),s.addColorStop(i,m[t]),e=i}}}else{s=t.createLinearGradient(c,u/2,d+c,u/2);const e=m.length+1;let n=1;for(let t=0;t<m.length;t++){let a;a="number"==typeof p[t]?p[t]:n/e,s.addColorStop(a,m[t]),n++}}return s}(e,t,i,o,[s],n),t.strokeStyle=i.stroke,i.dropShadow){const e=i.dropShadowColor,n=i.dropShadowBlur*o,a=i.dropShadowDistance*o;t.shadowColor=TX.shared.setValue(e).setAlpha(i.dropShadowAlpha).toRgbaString(),t.shadowBlur=n,t.shadowOffsetX=Math.cos(i.dropShadowAngle)*a,t.shadowOffsetY=Math.sin(i.dropShadowAngle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;i.stroke&&i.strokeThickness&&t.strokeText(s,c,d+n.lineHeight-l.descent),i.fill&&t.fillText(s,c,d+n.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function x2(e){return Array.from?Array.from(e):e.split("")}function k2(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const w2=class e{constructor(e,t,n){const[a]=e.info,[r]=e.common,[o]=e.page,[i]=e.distanceField,s=JX(o.file),l={};this._ownsTextures=n,this.font=a.face,this.size=a.size,this.lineHeight=r.lineHeight/s,this.chars={},this.pageTextures=l;for(let n=0;n<e.page.length;n++){const{id:a,file:r}=e.page[n];l[a]=t instanceof Array?t[n]:t[r],i?.fieldType&&"none"!==i.fieldType&&(l[a].baseTexture.alphaMode=xW.NO_PREMULTIPLIED_ALPHA,l[a].baseTexture.mipmap=yW.OFF)}for(let t=0;t<e.char.length;t++){const{id:n,page:a}=e.char[t];let{x:r,y:o,width:i,height:c,xoffset:d,yoffset:u,xadvance:m}=e.char[t];r/=s,o/=s,i/=s,c/=s,d/=s,u/=s,m/=s;const p=new AJ(r+l[a].frame.x/s,o+l[a].frame.y/s,i,c);this.chars[n]={xOffset:d,yOffset:u,xAdvance:m,kerning:{},texture:new AK(l[a].baseTexture,p),page:a}}for(let t=0;t<e.kerning.length;t++){let{first:n,second:a,amount:r}=e.kerning[t];n/=s,a/=s,r/=s,this.chars[a]&&(this.chars[a].kerning[n]=r)}this.distanceFieldRange=i?.distanceRange,this.distanceFieldType=i?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(t,n,a){let r;if(t instanceof g2)r=t;else{const e=function(e){for(let t=0;t<b2.length;t++)if(b2[t].test(e))return b2[t];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(t)}n instanceof AK&&(n=[n]);const o=new e(r,n,a);return e.available[o.font]=o,o}static uninstall(t){const n=e.available[t];if(!n)throw new Error(`No font found named '${t}'`);n.destroy(),delete e.available[t]}static from(t,n,a){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:o,resolution:i,textureWidth:s,textureHeight:l,...c}=Object.assign({},e.defaultOptions,a),d=function(e){"string"==typeof e&&(e=[e]);const t=[];for(let n=0,a=e.length;n<a;n++){const a=e[n];if(Array.isArray(a)){if(2!==a.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${a.length}.`);const e=a[0].charCodeAt(0),n=a[1].charCodeAt(0);if(n<e)throw new Error("[BitmapFont]: Invalid character range.");for(let a=e,r=n;a<=r;a++)t.push(String.fromCharCode(a))}else t.push(...x2(a))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(r),u=n instanceof L1?n:new L1(n),m=s,p=new g2;p.info[0]={face:u.fontFamily,size:u.fontSize},p.common[0]={lineHeight:u.fontSize};let g,h,f,v=0,b=0,y=0;const x=[],k=[];for(let e=0;e<d.length;e++){g||(g=CW.ADAPTER.createCanvas(),g.width=s,g.height=l,h=g.getContext("2d"),f=new mJ(g,{resolution:i,...c}),x.push(f),k.push(new AK(f)),p.page.push({id:k.length-1,file:""}));const t=d[e],n=R1.measureText(t,u,!1,g),a=n.width,r=Math.ceil(n.height),w=Math.ceil(("italic"===u.fontStyle?2:1)*a);if(b>=l-r*i){if(0===b)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,g=null,h=null,f=null,b=0,v=0,y=0;continue}if(y=Math.max(r+n.fontProperties.descent,y),w*i+v>=m){if(0===v)throw new Error(`[BitmapFont] textureWidth ${s}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,b+=y*i,b=Math.ceil(b),v=0,y=0;continue}y2(g,h,n,v,b,i,u);const E=k2(n.text);p.char.push({id:E,page:k.length-1,x:v/i,y:b/i,width:w,height:r,xoffset:0,yoffset:0,xadvance:a-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),v+=(w+2*o)*i,v=Math.ceil(v)}if(!a?.skipKerning)for(let e=0,t=d.length;e<t;e++){const n=d[e];for(let e=0;e<t;e++){const t=d[e],a=h.measureText(n).width,r=h.measureText(t).width,o=h.measureText(n+t).width-(a+r);o&&p.kerning.push({first:k2(n),second:k2(t),amount:o})}}const w=new e(p,k,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=w,w}};w2.ALPHA=[["a","z"],["A","Z"]," "],w2.NUMERIC=[["0","9"]],w2.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],w2.ASCII=[[" ","~"]],w2.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:w2.ALPHANUMERIC},w2.available={};let E2=w2;const N2=[],S2=[],V2=[];(class e extends aQ{constructor(t,n={}){super();const{align:a,tint:r,maxWidth:o,letterSpacing:i,fontName:s,fontSize:l}=Object.assign({},e.styleDefaults,n);if(!E2.available[s])throw new Error(`Missing BitmapFont "${s}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=a,this._tintColor=new TX(r),this._font=void 0,this._fontName=s,this._fontSize=l,this.text=t,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=i,this._anchor=new UJ(()=>{this.dirty=!0},this,0,0),this._roundPixels=CW.ROUND_PIXELS,this.dirty=!0,this._resolution=CW.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=E2.available[this._fontName],t=this.fontSize,n=t/e.size,a=new _J,r=[],o=[],i=[],s=x2(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/t,c="none"===e.distanceFieldType?N2:S2;let d=null,u=0,m=0,p=0,g=-1,h=0,f=0,v=0,b=0;for(let t=0;t<s.length;t++){const n=s[t],c=k2(n);if(/(?:\s)/.test(n)&&(g=t,h=u,b++),"\r"===n||"\n"===n){o.push(u),i.push(-1),m=Math.max(m,u),++p,++f,a.x=0,a.y+=e.lineHeight,d=null,b=0;continue}const y=e.chars[c];if(!y)continue;d&&y.kerning[d]&&(a.x+=y.kerning[d]);const x=V2.pop()||{texture:AK.EMPTY,line:0,charCode:0,prevSpaces:0,position:new _J};x.texture=y.texture,x.line=p,x.charCode=c,x.position.x=Math.round(a.x+y.xOffset+this._letterSpacing/2),x.position.y=Math.round(a.y+y.yOffset),x.prevSpaces=b,r.push(x),u=x.position.x+Math.max(y.xAdvance-y.xOffset,y.texture.orig.width),a.x+=y.xAdvance+this._letterSpacing,v=Math.max(v,y.yOffset+y.texture.height),d=c,-1!==g&&l>0&&a.x>l&&(++f,$X(r,1+g-f,1+t-g),t=g,g=-1,o.push(h),i.push(r.length>0?r[r.length-1].prevSpaces:0),m=Math.max(m,h),p++,a.x=0,a.y+=e.lineHeight,d=null,b=0)}const y=s[s.length-1];"\r"!==y&&"\n"!==y&&(/(?:\s)/.test(y)&&(u=h),o.push(u),m=Math.max(m,u),i.push(-1));const x=[];for(let e=0;e<=p;e++){let t=0;"right"===this._align?t=m-o[e]:"center"===this._align?t=(m-o[e])/2:"justify"===this._align&&(t=i[e]<0?0:(m-o[e])/i[e]),x.push(t)}const k=r.length,w={},E=[],N=this._activePagesMeshData;c.push(...N);for(let t=0;t<k;t++){const n=r[t].texture,a=n.baseTexture.uid;if(!w[a]){let t=c.pop();if(!t){const n=new D1;let a,r;"none"===e.distanceFieldType?(a=new T1(AK.EMPTY),r=uW.NORMAL):(a=new T1(AK.EMPTY,{program:sK.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),r=uW.NORMAL_NPM);const o=new A1(n,a);o.blendMode=r,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:r}=this;r[a]=r[a]||new AK(n.baseTexture),t.mesh.texture=r[a],t.mesh.tint=this._tintColor.value,E.push(t),w[a]=t}w[a].total++}for(let e=0;e<N.length;e++)E.includes(N[e])||this.removeChild(N[e].mesh);for(let e=0;e<E.length;e++)E[e].mesh.parent!==this&&this.addChild(E[e].mesh);this._activePagesMeshData=E;for(const e in w){const t=w[e],n=t.total;if(!(t.indices?.length>6*n)||t.vertices.length<2*A1.BATCHABLE_SIZE)t.vertices=new Float32Array(8*n),t.uvs=new Float32Array(8*n),t.indices=new Uint16Array(6*n);else{const e=t.total,n=t.vertices;for(let t=4*e*2;t<n.length;t++)n[t]=0}t.mesh.size=6*n}for(let e=0;e<k;e++){const t=r[e];let a=t.position.x+x[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(a=Math.round(a));const o=a*n,i=t.position.y*n,s=t.texture,l=w[s.baseTexture.uid],c=s.frame,d=s._uvs,u=l.index++;l.indices[6*u+0]=0+4*u,l.indices[6*u+1]=1+4*u,l.indices[6*u+2]=2+4*u,l.indices[6*u+3]=0+4*u,l.indices[6*u+4]=2+4*u,l.indices[6*u+5]=3+4*u,l.vertices[8*u+0]=o,l.vertices[8*u+1]=i,l.vertices[8*u+2]=o+c.width*n,l.vertices[8*u+3]=i,l.vertices[8*u+4]=o+c.width*n,l.vertices[8*u+5]=i+c.height*n,l.vertices[8*u+6]=o,l.vertices[8*u+7]=i+c.height*n,l.uvs[8*u+0]=d.x0,l.uvs[8*u+1]=d.y0,l.uvs[8*u+2]=d.x1,l.uvs[8*u+3]=d.y1,l.uvs[8*u+4]=d.x2,l.uvs[8*u+5]=d.y2,l.uvs[8*u+6]=d.x3,l.uvs[8*u+7]=d.y3}this._textWidth=m*n,this._textHeight=(a.y+e.lineHeight)*n;for(const e in w){const t=w[e];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const n=this._textWidth*this.anchor.x,a=this._textHeight*this.anchor.y;for(let r=0;r<t.total;r++)t.vertices[e++]-=n,t.vertices[e++]-=a,t.vertices[e++]-=n,t.vertices[e++]-=a,t.vertices[e++]-=n,t.vertices[e++]-=a,t.vertices[e++]-=n,t.vertices[e++]-=a}this._maxLineHeight=v*n;const a=t.mesh.geometry.getBuffer("aVertexPosition"),r=t.mesh.geometry.getBuffer("aTextureCoord"),o=t.mesh.geometry.getIndex();a.data=t.vertices,r.data=t.uvs,o.data=t.indices,a.update(),r.update(),o.update()}for(let e=0;e<r.length;e++)V2.push(r[e]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:n,size:a}=E2.available[this._fontName];if("none"!==n){const{a:n,b:r,c:o,d:i}=this.worldTransform,s=Math.sqrt(n*n+r*r),l=Math.sqrt(o*o+i*i),c=(Math.abs(s)+Math.abs(l))/2,d=this.fontSize/a,u=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=c*t*d*u}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=E2.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!E2.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??E2.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n="none"===E2.available[this._fontName].distanceFieldType?N2:S2;n.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],n.filter(e=>t[e.mesh.texture.baseTexture.uid]).forEach(e=>{e.mesh.texture=AK.EMPTY});for(const e in t)t[e].destroy(),delete t[e];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}}).styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const _2=[".xml",".fnt"],C2={extension:{type:KX.LoadParser,priority:$Q.Normal},name:"loadBitmapFont",test:e=>_2.includes(QW.extname(e).toLowerCase()),testParse:async e=>h2.test(e)||v2.test(e),async parse(e,t,n){const a=h2.test(e)?h2.parse(e):v2.parse(e),{src:r}=t,{page:o}=a,i=[];for(let e=0;e<o.length;++e){const t=o[e].file;let n=QW.join(QW.dirname(r),t);n=V0(n,r),i.push(n)}const s=await n.load(i),l=i.map(e=>s[e]);return E2.install(a,l,!0)},load:async(e,t)=>(await CW.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};eJ.add(C2);const A2=class e extends L1{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new e(Object.keys(e.defaultOptions).reduce((e,n)=>({...e,[n]:t[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete e.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,n={}){const{availableFonts:a}=e;if(a[t]){const e=a[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return CW.ADAPTER.fetch(t).then(e=>e.blob()).then(async e=>new Promise((t,n)=>{const a=URL.createObjectURL(e),r=new FileReader;r.onload=()=>t([a,r.result]),r.onerror=n,r.readAsDataURL(e)})).then(async([e,r])=>{const o=Object.assign({family:QW.basename(t,QW.extname(t)),weight:"normal",style:"normal",display:"auto",src:e,dataSrc:r,refs:1,originalUrl:t,fontFace:null},n);a[t]=o,this._fonts.push(o),this.styleID++;const i=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=i,await i.load(),document.fonts.add(i),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(e=>!this._overrides.includes(e));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(e=>this._overrides.includes(e));t.length>0&&(this._overrides=this._overrides.filter(e=>!t.includes(e)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}\n            @font-face {\n                font-family: "${t.family}";\n                src: url('${t.dataSrc}');\n                font-weight: ${t.weight};\n                font-style: ${t.style};\n                font-display: ${t.display};\n            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(n=e,JW("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),e=TX.shared.setValue(n).toNumber()),"number"==typeof e?(t=e,JW("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),TX.shared.setValue(t).toHex()):e;var t,n}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),a=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(255*t|0).toString(16).padStart(2,"0"));const r=`${n}px ${a}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=CW.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};A2.availableFonts={},A2.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let D2=A2;const T2=class e extends iQ{constructor(t="",n={}){super(AK.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const a=new Image,r=AK.from(a,{scaleMode:CW.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new AJ,r.trim=new AJ,this.texture=r;const o="http://www.w3.org/2000/svg",i="http://www.w3.org/1999/xhtml",s=document.createElementNS(o,"svg"),l=document.createElementNS(o,"foreignObject"),c=document.createElementNS(i,"div"),d=document.createElementNS(i,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",s.appendChild(l),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=c,this._styleElement=d,this._svgRoot=s,this._foreignObject=l,this._foreignObject.appendChild(d),this._foreignObject.appendChild(c),this._image=a,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??CW.RESOLUTION,this.text=t,this.style=n}measureText(e){const{text:t,style:n,resolution:a}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:n.toCSS(a)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:i}=r;(o>this.maxWidth||i>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const s=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(i));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",l.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(a)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*n.padding,height:l+2*n.padding}}async updateText(e=!0){const{style:t,_image:n,_loadImage:a}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:o}=this.measureText();n.width=a.width=Math.ceil(Math.max(1,r)),n.height=a.height=Math.ceil(Math.max(1,o)),this._updateID++;const i=this._updateID;await new Promise(e=>{a.onload=async()=>{i<this._updateID||(await t.onBeforeDraw(),n.src=a.src,a.onload=null,a.src="",this.updateTexture()),e()};const r=(new XMLSerializer).serializeToString(this._svgRoot);a.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:n,resolution:a}=this,{padding:r}=e,{baseTexture:o}=t;t.trim.width=t._frame.width=n.width/a,t.trim.height=t._frame.height=n.height/a,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),o.setRealSize(n.width,n.height,a),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},e.defaultDestroyOptions,t),super.destroy(t);const n=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=n,this._svgRoot?.remove(),this._svgRoot=n,this._domElement?.remove(),this._domElement=n,this._foreignObject?.remove(),this._foreignObject=n,this._styleElement?.remove(),this._styleElement=n,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=n,this._image.src="",this._image=n}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=OX(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=OX(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof D2?(this.ownsStyle=!1,this._style=e):e instanceof L1?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=D2.from(e)):(this.ownsStyle=!0,this._style=new D2(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null==e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};T2.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},T2.defaultMaxWidth=2024,T2.defaultMaxHeight=2024,T2.defaultAutoResolution=!0;class B2{app;worldContainer;layers;config;locationSprites=new Map;eventCallbacks=new Map;continentBounds=new Map;isDragging=!1;dragStart={x:0,y:0};lastPosition={x:0,y:0};dragDistance=0;isPinching=!1;initialPinchDistance=0;initialPinchScale=1;pinchCenter={x:0,y:0};boundOnDragStart;boundOnDragMove;boundOnDragEnd;boundOnTouchStart;boundOnTouchMove;boundOnTouchEnd;boundOnWheel;constructor(e,t){this.config=t,this.boundOnDragStart=this.onDragStart.bind(this),this.boundOnDragMove=this.onDragMove.bind(this),this.boundOnDragEnd=this.onDragEnd.bind(this),this.boundOnTouchStart=this.onTouchStart.bind(this),this.boundOnTouchMove=this.onTouchMove.bind(this),this.boundOnTouchEnd=this.onTouchEnd.bind(this),this.boundOnWheel=this.onWheel.bind(this);const n=e.getBoundingClientRect(),a=n.width||e.clientWidth||800,r=n.height||e.clientHeight||600;this.app=new AQ({view:e,width:a,height:r,backgroundColor:16317180,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,eventMode:"none"}),this.app.renderer.events&&this.app.renderer.events.destroy(),console.log("[地图管理器] Pixi应用初始化完成"),this.worldContainer=new aQ,this.worldContainer.sortableChildren=!0,this.worldContainer.eventMode="none",this.worldContainer.interactiveChildren=!1,this.app.stage.addChild(this.worldContainer),this.layers=new Map,this.initLayers(),this.drawBackground(),this.setupDragInteraction(),this.setZoom(.5,!1),this.centerTo(t.width/2,t.height/2,!1),console.log("[地图管理器] 初始化完成",{worldSize:`${t.width}x${t.height}`,screenSize:`${a}x${r}`,initialZoom:.5,initialCenter:{x:t.width/2,y:t.height/2}})}setupDragInteraction(){const e=this.app.view;e.addEventListener("mousedown",this.boundOnDragStart),e.addEventListener("mousemove",this.boundOnDragMove),e.addEventListener("mouseup",this.boundOnDragEnd),e.addEventListener("mouseleave",this.boundOnDragEnd),e.addEventListener("touchstart",this.boundOnTouchStart,{passive:!1}),e.addEventListener("touchmove",this.boundOnTouchMove,{passive:!1}),e.addEventListener("touchend",this.boundOnTouchEnd),e.addEventListener("wheel",this.boundOnWheel,{passive:!1})}onDragStart(e){this.isDragging=!0,this.dragStart={x:e.clientX,y:e.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0,this.app.view.style.cursor="grabbing",this.clickStartPos={x:e.clientX,y:e.clientY},this.clickStartTime=Date.now()}clickStartPos={x:0,y:0};clickStartTime=0;onDragMove(e){if(!this.isDragging)return;const t=e.clientX-this.dragStart.x,n=e.clientY-this.dragStart.y;this.dragDistance+=Math.abs(t-(this.worldContainer.x-this.lastPosition.x))+Math.abs(n-(this.worldContainer.y-this.lastPosition.y)),this.worldContainer.x=this.lastPosition.x+t,this.worldContainer.y=this.lastPosition.y+n}onDragEnd(e){if(e&&this.isDragging){const t=Date.now()-this.clickStartTime;console.log("[地图管理器] 拖拽结束:",{dragDistance:this.dragDistance,time:t}),this.dragDistance<10&&t<500?(console.log("[地图管理器] 判定为点击事件"),this.handleClick(e)):console.log("[地图管理器] 判定为拖拽事件，不触发点击")}this.isDragging=!1,this.dragDistance=0,this.app.view.style.cursor="grab"}handleClick(e){const t=this.app.view.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,r=this.worldContainer.scale.x,o=(n-this.worldContainer.x)/r,i=(a-this.worldContainer.y)/r,s=this.layers.get(4);if(s){let e=null,t=1/0;if(s.children.forEach(n=>{if(!(n instanceof aQ))return;const a=n.userData;if(!a)return;const r=Math.sqrt(Math.pow(o-n.x,2)+Math.pow(i-n.y,2));r<t&&(t=r,e=a)}),e&&t<50)return console.log(`[地图] 点击地点: ${e.data.name}，距离: ${t.toFixed(0)}`),void this.emit("locationClick",{...e.data,clickPosition:{x:n,y:a}})}const l=this.layers.get(3);if(l)for(const e of l.children)if(e instanceof N1){const t=e.userData;if(t&&"location"===t.type){const r=e.territoryBounds;if(r&&this.isPointInPolygon(o,i,r))return console.log(`[地图] 点击势力范围: ${t.data.name}`),void this.emit("locationClick",{...t.data,clickPosition:{x:n,y:a}})}}console.log(`[地图] 检测大陆点击，世界坐标: (${o.toFixed(0)}, ${i.toFixed(0)})，共有${this.continentBounds.size}个大陆`);const c=[];if(this.continentBounds.forEach((e,t)=>{const n=this.isPointInPolygon(o,i,e.bounds);if(console.log(`[地图] 检测大陆 "${e.data.name}":`,{isInside:n,bounds:e.bounds,boundsCount:e.bounds.length}),n){const n=this.calculatePolygonArea(e.bounds);c.push({id:t,data:e.data,area:n})}}),c.length>0){c.sort((e,t)=>e.area-t.area);const e=c[0];return console.log(`[地图] 点击大陆: ${e.data.name}（共匹配${c.length}个大陆，选择最小的）`),void this.emit("continentClick",{...e.data,clickPosition:{x:n,y:a}})}console.log("[地图] 点击空白区域")}emitClickEvent(e){"location"===e.type?this.emit("locationClick",e.data):"continent"===e.type&&this.emit("continentClick",e.data)}getTouchDistance(e){const t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+n*n)}getTouchCenter(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}onTouchStart(e){if(e.preventDefault(),2===e.touches.length)this.isDragging=!1,this.isPinching=!0,this.initialPinchDistance=this.getTouchDistance(e.touches),this.initialPinchScale=this.worldContainer.scale.x,this.pinchCenter=this.getTouchCenter(e.touches),this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y};else if(1===e.touches.length){this.isPinching=!1;const t=e.touches[0];this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0}}onTouchMove(e){if(e.preventDefault(),2===e.touches.length&&this.isPinching){const t=this.getTouchDistance(e.touches),n=this.getTouchCenter(e.touches),a=t/this.initialPinchDistance*this.initialPinchScale,r=this.config.minZoom||.1,o=this.config.maxZoom||4,i=Math.max(r,Math.min(o,a)),s=(this.pinchCenter.x-this.lastPosition.x)/this.initialPinchScale,l=(this.pinchCenter.y-this.lastPosition.y)/this.initialPinchScale;this.worldContainer.scale.set(i);const c=n.x-this.pinchCenter.x,d=n.y-this.pinchCenter.y;this.worldContainer.x=this.pinchCenter.x-s*i+c,this.worldContainer.y=this.pinchCenter.y-l*i+d}else if(1===e.touches.length&&this.isDragging&&!this.isPinching){const t=e.touches[0],n=t.clientX-this.dragStart.x,a=t.clientY-this.dragStart.y;this.dragDistance+=Math.abs(n-(this.worldContainer.x-this.lastPosition.x))+Math.abs(a-(this.worldContainer.y-this.lastPosition.y)),this.worldContainer.x=this.lastPosition.x+n,this.worldContainer.y=this.lastPosition.y+a}}onTouchEnd(e){if(1===e.touches.length&&this.isPinching){this.isPinching=!1,this.isDragging=!0;const t=e.touches[0];this.dragStart={x:t.clientX,y:t.clientY},this.lastPosition={x:this.worldContainer.x,y:this.worldContainer.y},this.dragDistance=0}else 0===e.touches.length&&(this.isDragging=!1,this.isPinching=!1)}onWheel(e){e.preventDefault();const t=e.deltaY>0?.9:1.1,n=this.worldContainer.scale.x*t,a=this.config.minZoom||.1,r=this.config.maxZoom||4,o=Math.max(a,Math.min(r,n)),i=e.clientX,s=e.clientY,l=(i-this.worldContainer.x)/this.worldContainer.scale.x,c=(s-this.worldContainer.y)/this.worldContainer.scale.y;this.worldContainer.scale.set(o),this.worldContainer.x=i-l*o,this.worldContainer.y=s-c*o}initLayers(){[0,1,2,3,4,5,6].forEach(e=>{const t=new aQ;t.sortableChildren=!0,this.layers.set(e,t),this.worldContainer.addChild(t)}),console.log("[地图管理器] 图层初始化完成，共",this.layers.size,"个图层")}drawBackground(){const e=this.layers.get(0);if(!e)return;const t=new N1;t.beginFill(16317180),t.drawRect(0,0,this.config.width,this.config.height),t.endFill(),e.addChild(t);const n=new N1,a=this.config.tileSize;n.lineStyle(.5,13358561,.3);for(let e=0;e<=this.config.width;e+=a)n.moveTo(e,0),n.lineTo(e,this.config.height);for(let e=0;e<=this.config.height;e+=a)n.moveTo(0,e),n.lineTo(this.config.width,e);e.addChild(n)}addContinent(e){const t=this.layers.get(2);if(!t)return;const n=e.continent_bounds||e.大洲边界;if(!n||n.length<3)return;const a=new N1;a.beginFill(3900150,.12),a.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)a.lineTo(n[e].x,n[e].y);a.closePath(),a.endFill(),a.lineStyle(2.5,2450411,.75),a.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)a.lineTo(n[e].x,n[e].y);a.closePath(),a.eventMode="none";const r={id:e.id,name:e.name||e.名称,description:e.description||e.描述,特点:e.特点,主要势力:e.主要势力};a.userData={type:"continent",data:r};const o=e.id||`continent_${Date.now()}_${Math.random()}`;this.continentBounds.set(o,{bounds:n,data:r}),t.addChild(a);const i=this.calculatePolygonCenter(n),s=new G1(e.name||e.名称||"未知大陆",{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:280,fill:1982639,fontWeight:"bold",align:"center",stroke:"#ffffff",strokeThickness:8});s.anchor.set(.5),s.x=i.x,s.y=i.y,s.alpha=.2,s.eventMode="none",t.addChild(s),console.log("[地图管理器] 添加大陆:",e.name||e.名称,"| ID:",o,"| 边界点数:",n.length,"| 当前存储的大陆数:",this.continentBounds.size)}addLocation(e){const t=this.layers.get(4);if(!t)return;const n=String(e.等级||e.level||"").toLowerCase();let a=2.5;n.includes("超")?a=3.5:n.includes("一")?a=3.2:n.includes("二")?a=2.8:n.includes("三")&&(a=2.5);const r=new aQ;r.x=e.coordinates?.x||0,r.y=e.coordinates?.y||0,r.eventMode="none";const o=this.createLocationIcon(e.type,e.iconColor||"#6B7280");o.scale.set(a),r.addChild(o);const i=new G1(e.name,{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:38*a,fill:e.iconColor||"#6B7280",fontWeight:"700",align:"center",stroke:"#ffffff",strokeThickness:5});i.anchor.set(.5,0),i.y=32*a,i.eventMode="none",r.addChild(i),r.userData={type:"location",data:{id:e.id,name:e.name,coordinates:e.coordinates||{x:0,y:0},location:e}},t.addChild(r),this.locationSprites.set(e.id,r),console.log("[地图管理器] 添加地点:",e.name,`(${e.coordinates?.x}, ${e.coordinates?.y})`)}createLocationIcon(e,t){const n=new N1,a=parseInt(t.replace("#",""),16);switch(n.alpha=.95,e){case"natural_landmark":case"名山大川":n.beginFill(a,.9),n.moveTo(0,-24),n.lineTo(-16,16),n.lineTo(16,16),n.closePath(),n.endFill(),n.lineStyle(2,16777215,.8),n.moveTo(0,-24),n.lineTo(-16,16),n.lineTo(16,16),n.closePath();break;case"sect_power":n.beginFill(a,.9),n.drawRect(-16,-16,32,32),n.endFill(),n.lineStyle(2,16777215,.8),n.drawRect(-16,-16,32,32),n.beginFill(16777215,.9),n.drawRect(-6,0,12,16),n.endFill();break;case"city_town":case"城镇坊市":n.beginFill(a,.9),n.drawCircle(0,0,20),n.endFill(),n.lineStyle(2,16777215,.8),n.drawCircle(0,0,20),n.beginFill(16777215,.9),n.drawCircle(0,0,8),n.endFill();break;case"blessed_land":case"洞天福地":n.beginFill(a,.8),n.drawCircle(0,0,20),n.endFill(),n.lineStyle(2,16777215,.8),n.drawCircle(0,0,20),n.beginFill(16777215,.95);const e=5,t=12,r=6;for(let a=0;a<2*e;a++){const o=a%2==0?t:r,i=Math.PI/e*a-Math.PI/2,s=Math.cos(i)*o,l=Math.sin(i)*o;0===a?n.moveTo(s,l):n.lineTo(s,l)}n.closePath(),n.endFill();break;case"treasure_land":case"奇珍异地":n.beginFill(a,.9),n.moveTo(0,-20),n.lineTo(16,0),n.lineTo(0,20),n.lineTo(-16,0),n.closePath(),n.endFill(),n.lineStyle(2,16777215,.8),n.moveTo(0,-20),n.lineTo(16,0),n.lineTo(0,20),n.lineTo(-16,0),n.closePath();break;case"dangerous_area":case"凶险之地":n.beginFill(a,.9),n.drawCircle(0,0,20),n.endFill(),n.lineStyle(3,16777215,.9),n.drawCircle(0,0,20),n.moveTo(0,-12),n.lineTo(0,4),n.beginFill(16777215),n.drawCircle(0,10,3),n.endFill();break;case"special_other":case"其他特殊":n.beginFill(a,.9),n.moveTo(4,-20),n.lineTo(-12,4),n.lineTo(0,4),n.lineTo(-4,20),n.lineTo(12,-4),n.lineTo(0,-4),n.closePath(),n.endFill(),n.lineStyle(2,16777215,.8),n.moveTo(4,-20),n.lineTo(-12,4),n.lineTo(0,4),n.lineTo(-4,20),n.lineTo(12,-4),n.lineTo(0,-4),n.closePath();break;default:n.beginFill(a,.9),n.drawCircle(0,0,16),n.endFill(),n.lineStyle(2,16777215,.8),n.drawCircle(0,0,16)}return n}addTerritory(e){if(!e.territoryBounds||e.territoryBounds.length<3)return;const t=this.layers.get(3);if(!t)return;const n=e.territoryBounds,a=new N1,r=parseInt((e.color||"#6B7280").replace("#",""),16);a.beginFill(r,.15),a.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)a.lineTo(n[e].x,n[e].y);a.closePath(),a.endFill(),a.lineStyle(2,r,.6),a.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)a.lineTo(n[e].x,n[e].y);a.closePath(),a.eventMode="none",a.userData={type:"location",data:{id:e.id,name:e.name,coordinates:e.coordinates||{x:0,y:0},location:e}},a.territoryBounds=n,t.addChild(a);const o=this.calculatePolygonCenter(n),i=new G1(e.name,{fontFamily:"Microsoft YaHei, SimHei, sans-serif",fontSize:100,fill:e.iconColor||"#6B7280",fontWeight:"bold",align:"center",stroke:"#ffffff",strokeThickness:6});i.anchor.set(.5),i.x=o.x,i.y=o.y,i.alpha=.18,i.eventMode="none",t.addChild(i),console.log("[地图管理器] 添加势力范围:",e.name)}clearPlayerMarker(){const e=this.layers.get(5);e&&e.removeChildren()}updateNPCPositions(e){const t=this.layers.get(5);t&&([...t.children].forEach(e=>{const n=e.userData;if(n&&"npc"===n.type){t.removeChild(e);try{e.destroy({children:!0,texture:!1,baseTexture:!1})}catch{}}}),e.forEach(e=>{if(!Number.isFinite(e.coordinates?.x)||!Number.isFinite(e.coordinates?.y))return;const n=new aQ;n.x=e.coordinates.x,n.y=e.coordinates.y,n.userData={type:"npc",name:e.name};const a=new N1;a.beginFill(9133302,.25),a.drawCircle(0,0,35),a.endFill(),n.addChild(a);const r=new N1;r.beginFill(9133302,.9),r.drawCircle(0,0,22),r.endFill(),r.lineStyle(3,16777215,.9),r.drawCircle(0,0,22),r.lineStyle(0),r.beginFill(16777215,.95),r.drawCircle(0,-6,6),r.endFill(),r.beginFill(16777215,.95),r.moveTo(-8,4),r.lineTo(8,4),r.lineTo(8,14),r.lineTo(-8,14),r.closePath(),r.endFill(),n.addChild(r);const o=new G1(e.name,{fontFamily:"Microsoft YaHei, sans-serif",fontSize:40,fill:9133302,fontWeight:"600",align:"center",stroke:"#ffffff",strokeThickness:5});o.anchor.set(.5,0),o.y=32,n.addChild(o),t.addChild(n)}),console.log(`[地图管理器] 更新NPC位置: 共${e.length}个NPC`))}updatePlayerPosition(e,t="玩家"){const n=this.layers.get(5);if(!n)return;if(!Number.isFinite(e.x)||!Number.isFinite(e.y))return void this.clearPlayerMarker();n.removeChildren();const a=new aQ;a.x=e.x,a.y=e.y;const r=new N1;r.beginFill(15680580,.3),r.drawCircle(0,0,45),r.endFill(),a.addChild(r);const o=new N1;o.beginFill(16498468,.5),o.drawCircle(0,0,28),o.endFill(),a.addChild(o);const i=new N1;i.beginFill(14427686),i.moveTo(0,-30),i.lineTo(-20,20),i.lineTo(20,20),i.closePath(),i.endFill(),i.lineStyle(4,16708338,.95),i.moveTo(0,-30),i.lineTo(-20,20),i.lineTo(20,20),i.closePath(),i.beginFill(16708338),i.drawCircle(0,0,8),i.endFill(),i.beginFill(14427686),i.drawCircle(0,0,4),i.endFill(),a.addChild(i);const s=new G1(t,{fontFamily:"Microsoft YaHei, sans-serif",fontSize:48,fill:14427686,fontWeight:"700",align:"center",stroke:"#ffffff",strokeThickness:6});s.anchor.set(.5,0),s.y=40,a.addChild(s),n.addChild(a),console.log("[地图管理器] 更新玩家位置:",e)}centerTo(e,t,n=!0){const a=this.app.screen.width/2-e*this.worldContainer.scale.x,r=this.app.screen.height/2-t*this.worldContainer.scale.y;if(n){const e=this.worldContainer.x,t=this.worldContainer.y,n=500,o=Date.now(),i=()=>{const s=Date.now()-o,l=Math.min(s/n,1),c=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2;this.worldContainer.x=e+(a-e)*c,this.worldContainer.y=t+(r-t)*c,l<1&&requestAnimationFrame(i)};requestAnimationFrame(i)}else this.worldContainer.x=a,this.worldContainer.y=r}getViewportState(){return{x:(this.app.screen.width/2-this.worldContainer.x)/this.worldContainer.scale.x,y:(this.app.screen.height/2-this.worldContainer.y)/this.worldContainer.scale.y,scale:this.worldContainer.scale.x,screenWidth:this.app.screen.width,screenHeight:this.app.screen.height}}setZoom(e,t=!0){const n=this.config.minZoom||.1,a=this.config.maxZoom||4,r=Math.max(n,Math.min(a,e)),o=(this.app.screen.width/2-this.worldContainer.x)/this.worldContainer.scale.x,i=(this.app.screen.height/2-this.worldContainer.y)/this.worldContainer.scale.y;if(t){const e=this.worldContainer.scale.x,t=300,n=Date.now(),a=()=>{const s=Date.now()-n,l=Math.min(s/t,1),c=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2,d=e+(r-e)*c;this.worldContainer.scale.set(d),this.worldContainer.x=this.app.screen.width/2-o*d,this.worldContainer.y=this.app.screen.height/2-i*d,l<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}else this.worldContainer.scale.set(r),this.worldContainer.x=this.app.screen.width/2-o*r,this.worldContainer.y=this.app.screen.height/2-i*r}calculatePolygonCenter(e){if(0===e.length)return{x:0,y:0};const t=e.reduce((e,t)=>e+t.x,0),n=e.reduce((e,t)=>e+t.y,0);return{x:t/e.length,y:n/e.length}}isPointInPolygon(e,t,n){let a=!1;for(let r=0,o=n.length-1;r<n.length;o=r++){const i=n[r].x,s=n[r].y,l=n[o].x,c=n[o].y;s>t!=c>t&&e<(l-i)*(t-s)/(c-s)+i&&(a=!a)}return a}calculatePolygonArea(e){let t=0;for(let n=0;n<e.length;n++){const a=(n+1)%e.length;t+=e[n].x*e[a].y,t-=e[a].x*e[n].y}return Math.abs(t/2)}on(e,t){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t)}emit(e,t){const n=this.eventCallbacks.get(e);n&&n.forEach(e=>e(t))}clear(){this.layers.forEach(e=>{const t=[...e.children];e.removeChildren(),t.forEach(e=>{try{e.destroy({children:!0,texture:!1,baseTexture:!1})}catch{}})}),this.locationSprites.clear(),this.continentBounds.clear(),this.drawBackground(),console.log("[地图管理器] 地图已清空")}resize(e,t){this.app.renderer.resize(e,t),console.log("[地图管理器] 调整大小:",`${e}x${t}`)}destroy(){const e=this.app.view;e.removeEventListener("mousedown",this.boundOnDragStart),e.removeEventListener("mousemove",this.boundOnDragMove),e.removeEventListener("mouseup",this.boundOnDragEnd),e.removeEventListener("mouseleave",this.boundOnDragEnd),e.removeEventListener("touchstart",this.boundOnTouchStart),e.removeEventListener("touchmove",this.boundOnTouchMove),e.removeEventListener("touchend",this.boundOnTouchEnd),e.removeEventListener("wheel",this.boundOnWheel),this.app.ticker.stop();try{this.worldContainer.destroy({children:!0})}catch{}try{this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}catch{}this.layers.clear(),this.locationSprites.clear(),this.eventCallbacks.clear(),this.continentBounds.clear(),console.log("[地图管理器] 已销毁")}}const I2=1e4,z2=1e4,M2={natural_landmark:"#2D7D32",sect_power:"#1565C0",city_town:"#F57C00",blessed_land:"#7B1FA2",treasure_land:"#388E3C",dangerous_area:"#D32F2F",special_other:"#6B7280"},P2=[{match:/(魔|邪|诡|阴|幽)/i,color:"#7F1D1D"},{match:/(正|仙|道|宗门|剑|丹|符|阵)/i,color:"#1D4ED8"},{match:/(世家|门阀|家族)/i,color:"#0F766E"},{match:/(商会|商盟|商号)/i,color:"#B45309"},{match:/(妖|兽|灵族|异族)/i,color:"#047857"},{match:/(联盟|散修)/i,color:"#6B7280"}],R2=(e,t,n)=>Math.max(t,Math.min(n,e));function $2(e,t){const{width:n,height:a}=(e=>({width:Number(e?.width)>0?Number(e?.width):I2,height:Number(e?.height)>0?Number(e?.height):z2}))(t);return e.map((e,t)=>{let r;const o=String(e.type||e.类型||"special_other"),i=((e,t)=>!(e=>Object.prototype.hasOwnProperty.call(M2,e))(t)&&(!!(e.leadership||e.领导层||e.memberCount||e.成员数量)||/(宗门|世家|商会|联盟|势力|妖族|魔道)/i.test(t)))(e,o)?(e=>{for(const t of P2)if(t.match.test(e))return t.color;return"#6B7280"})(o):M2[o]||"#6B7280";let s;void 0!==e.coordinates?.x&&void 0!==e.coordinates?.y?r={x:R2(Number(e.coordinates.x),0,n),y:R2(Number(e.coordinates.y),0,a)}:void 0!==e.位置?.x&&void 0!==e.位置?.y?r={x:R2(Number(e.位置.x),0,n),y:R2(Number(e.位置.y),0,a)}:(r=function(e=5e3,t=5e3,n=3e3,a=1e4,r=1e4){const o=.05*a,i=.05*r;return{x:R2(o+Math.random()*(a-2*o),0,a),y:R2(i+Math.random()*(r-2*i),0,r)}}(n/2,a/2,.4*Math.min(n,a),n,a),console.warn(`[坐标] 地点 "${e.名称||e.name||`地点${t}`}" 缺少坐标，已随机生成: (${r.x.toFixed(0)}, ${r.y.toFixed(0)})`));const l=e.territoryBounds||e.势力范围;return l&&Array.isArray(l)&&l.length>=3&&(s=l.map(e=>({x:R2(Number(e.x),0,n),y:R2(Number(e.y),0,a)})),console.log(`[坐标] 势力 "${e.名称||e.name}" 有势力范围，共 ${s.length} 个边界点`)),{...e,id:e.id||`loc_${t}_${Date.now()}`,name:e.name||e.名称||`未命名地点${t}`,type:o,description:e.description||e.描述||"",coordinates:r,territoryBounds:s,headquarters:r,iconColor:e.iconColor||i,color:e.color||i}})}var O2=n(2347);const L2={class:"game-map-panel"},F2={key:0,class:"world-info-header"},j2={class:"world-name"},U2={class:"world-background"},q2={key:0,class:"initialize-map-overlay"},G2={key:1,class:"initialize-map-overlay"},H2={class:"initialize-prompt"},Y2={class:"status-text"},W2={class:"popup-header"},X2={class:"popup-content"},J2={class:"location-type"},K2={class:"location-desc"},Z2={key:0,class:"location-detail"},Q2={key:1,class:"location-detail"},e5={key:2,class:"location-detail"},t5={class:"popup-header"},n5={class:"popup-content"},a5={class:"location-type"},r5={class:"location-desc"},o5={key:0,class:"location-detail"},i5={key:1,class:"location-detail"},s5={key:0},l5={key:2,class:"location-detail"},c5={key:3,class:"location-detail"},d5={key:4,class:"location-detail"},u5={class:"popup-header"},m5={class:"popup-content"},p5={class:"location-desc"},g5={key:0,class:"location-detail"},h5={key:1,class:"location-detail"},f5={key:2,class:"location-detail"},v5={key:3,class:"location-detail"},b5={key:4,class:"location-detail"},y5={class:"legend-title"},x5={class:"legend-toggle"},k5={key:0,class:"legend-items"},w5={class:"legend-item"},E5={class:"legend-item"},N5={class:"legend-item"},S5={class:"legend-item"},V5={class:"legend-item"},_5={class:"legend-item"},C5={class:"legend-item"},A5={class:"legend-item"},D5={class:"legend-item"},T5=(0,r.defineComponent)({__name:"GameMapPanel",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,r.ref)(null),a=(0,r.ref)(null),o=(0,r.ref)(null),i=(0,r.ref)(null),s=(0,r.ref)(null),l=(0,r.ref)("初始化中..."),c=(0,r.ref)({x:0,y:0}),d=(0,r.ref)(!1),u=(0,r.ref)(!1),m=(0,r.computed)(()=>t.worldInfo?.世界名称||"修仙界"),p=(0,r.computed)(()=>t.worldInfo?.世界背景||""),g=(0,r.computed)(()=>{const e=t.worldInfo?.["地图配置"],n=Number(e?.width)||1e4,a=Number(e?.height)||1e4;return{width:n,height:a,tileSize:Math.max(80,Math.round(Math.min(n,a)/80)),minZoom:.1,maxZoom:4}}),h=(0,r.computed)(()=>`${g.value.width}x${g.value.height}`),f=(0,r.computed)(()=>{const e=t.worldInfo;if(!e)return!1;const n=e.地点信息?.length>0,a=e.势力信息?.length>0;return n||a}),v={natural_landmark:"名山大川",sect_power:"宗门势力",city_town:"城镇坊市",blessed_land:"洞天福地",treasure_land:"奇珍异地",dangerous_area:"凶险之地",special_other:"其他特殊",名山大川:"名山大川",城镇坊市:"城镇坊市",洞天福地:"洞天福地",奇珍异地:"奇珍异地",凶险之地:"凶险之地",其他特殊:"其他特殊"},b=e=>!!("修仙宗门"===e.类型||"魔道宗门"===e.类型||"修仙世家"===e.类型||"散修联盟"===e.类型||"商会"===e.类型||"妖族势力"===e.类型||"sect_power"===e.type||e.leadership||e.领导层||e.memberCount||e.成员数量),y=(0,r.computed)(()=>{if(!i.value&&!s.value)return{};const e=a.value?.getBoundingClientRect();if(!e)return{};let t=c.value.x,n=c.value.y;return t+160>e.width-20&&(t=e.width-160-20),t-160<20&&(t=180),n-200<20?n+=60:n-=20,{position:"absolute",left:`${t}px`,top:`${n}px`,transform:"translate(-50%, -100%)",zIndex:"2000"}}),x=async()=>{if(n.value&&a.value)try{l.value="正在初始化地图...",await new Promise(e=>requestAnimationFrame(e));const e=a.value.getBoundingClientRect(),t=n.value;t.width=e.width,t.height=e.height,console.log("[地图] Canvas 尺寸:",{width:e.width,height:e.height}),o.value?.destroy(),o.value=new B2(t,g.value),o.value.on("locationClick",e=>{E(e)}),o.value.on("continentClick",e=>{N(e)}),await w({silent:!0,reset:!0}),l.value="地图加载完成"}catch(e){console.error("[地图] 初始化失败:",e),l.value="地图加载失败",X.o.error("地图初始化失败: "+e.message)}};(0,r.onMounted)(async()=>{await x(),window.addEventListener("resize",V),document.addEventListener("fullscreenchange",C)}),(0,r.onUnmounted)(()=>{window.removeEventListener("resize",V),document.removeEventListener("fullscreenchange",C),o.value?.destroy()}),(0,r.watch)(()=>t.location,e=>{if(e&&o.value){const n=t.character?.名字||"道友";o.value.updatePlayerPosition(e,n)}},{deep:!0}),(0,r.watch)(()=>t.relationships,e=>{if(!e||!o.value)return;const t=[];Object.entries(e).forEach(([e,n])=>{const a=n?.当前位置||n?.位置||n?.coordinates;a&&Number.isFinite(a.x)&&Number.isFinite(a.y)&&t.push({name:e,coordinates:a})}),o.value.updateNPCPositions(t)},{deep:!0}),(0,r.watch)(()=>h.value,(e,t)=>{o.value&&e!==t&&x()}),(0,r.watch)(()=>[t.worldInfo?.大陆信息?.length,t.worldInfo?.势力信息?.length,t.worldInfo?.地点信息?.length],(e,t)=>{o.value&&!d.value&&(t&&e.every((e,n)=>e===t[n])||(console.log("[地图] 检测到世界数据变化，重新加载地图",{newLengths:e,oldLengths:t}),w({silent:!0,reset:!0})))});const k=async()=>{const e=t.worldInfo;if(e){d.value=!0,l.value="开始生成地图内容...";try{const n=e.大陆信息?.length||3,a=Math.max(3,Math.round(2*n)),r=Math.max(8,Math.round(4*n)),o=Math.max(2,Math.round(.25*r)),i=e?.["地图配置"]||{width:g.value.width,height:g.value.height,minLng:0,maxLng:g.value.width,minLat:0,maxLat:g.value.height},s=new O2.U({worldName:e.世界名称,worldBackground:e.世界背景,worldEra:e.世界纪元||"修真盛世",factionCount:a,locationCount:r,secretRealmsCount:o,continentCount:n,mapConfig:i,maxRetries:3,retryDelay:1e3,onStreamChunk:e=>{l.value=e}});console.log("[地图] 开始生成地图内容...");const c=await s.generateValidatedWorld();if(c.success&&c.worldInfo){console.log("[地图] 地图生成成功，正在更新游戏状态...");const n={...e,势力信息:c.worldInfo.势力信息||[],地点信息:c.worldInfo.地点信息||[]};t.updateState("worldInfo",n),await w({reset:!0}),X.o.success("地图初始化完成！"),console.log("[地图] 地图初始化完成")}else{const e=c.errors?.join(", ")||"生成失败";X.o.error(`地图生成失败: ${e}`),console.error("[地图] 生成失败:",c.errors)}}catch(e){console.error("[地图] 初始化失败:",e),X.o.error("地图初始化失败: "+e.message)}finally{d.value=!1,l.value="初始化完成"}}else X.o.error("未找到世界信息")},w=async e=>{try{const{silent:n=!1,reset:a=!0}=e??{};l.value="正在加载世界数据...";const r=t.worldInfo;if(!r)return n||X.o.warning("未找到世界数据"),void(l.value="未找到世界数据");a&&o.value?.clear();const i=g.value;let s=0;if(r.大陆信息&&Array.isArray(r.大陆信息)&&(r.大陆信息.forEach(e=>{try{if(e.大洲边界||e.continent_bounds){const t=e.大洲边界||e.continent_bounds;e.continent_bounds=function(e,t=1e4,n=1e4){return e.map(e=>({x:R2(Number(e.x),0,t),y:R2(Number(e.y),0,n)}))}(t,i.width,i.height),e.大洲边界=e.continent_bounds}o.value?.addContinent(e)}catch(t){console.error("[地图] 加载大陆失败:",e,t)}}),console.log(`[地图] 已加载 ${r.大陆信息.length} 个大陆`)),r.势力信息&&Array.isArray(r.势力信息)){const e=$2(r.势力信息,i);e.forEach(e=>{try{e.territoryBounds&&e.territoryBounds.length>=3&&o.value?.addTerritory(e)}catch(t){console.error("[地图] 加载势力失败:",e,t)}}),console.log(`[地图] 已加载 ${e.length} 个势力范围`)}if(r.地点信息&&Array.isArray(r.地点信息)){const e=$2(r.地点信息,i);e.forEach(e=>{try{o.value?.addLocation(e),s++}catch(t){console.error("[地图] 加载地点失败:",e,t)}}),console.log(`[地图] 已加载 ${e.length} 个地点`)}const c=t.location;if(c){const e=t.character?.名字||"道友";o.value?.updatePlayerPosition(c,e),console.log("[地图] 已更新玩家位置")}const d=t.relationships;if(d&&"object"==typeof d){const e=[];Object.entries(d).forEach(([t,n])=>{const a=n?.当前位置||n?.位置||n?.coordinates;a&&Number.isFinite(a.x)&&Number.isFinite(a.y)&&e.push({name:t,coordinates:a})}),e.length>0&&(o.value?.updateNPCPositions(e),console.log(`[地图] 已更新 ${e.length} 个NPC位置`))}l.value=`已加载 ${s} 个地点`,n||X.o.success("地图加载完成")}catch(e){console.error("[地图] 加载数据失败:",e),l.value="数据加载失败",X.o.error("加载地图数据失败: "+e.message)}},E=e=>{if(console.log("[地图] handleLocationClick 被调用，data:",e),!e)return void console.warn("[地图] 点击数据为空");const t=e;s.value=null,i.value=t.location||t,console.log("[地图] selectedLocation 已设置:",i.value),t.clickPosition&&(c.value={x:t.clickPosition.x,y:t.clickPosition.y},console.log("[地图] 弹窗位置（点击位置）:",c.value))},N=e=>{if(console.log("[地图] handleContinentClick 被调用，data:",e),!e)return void console.warn("[地图] 点击数据为空");const t=e;i.value=null,s.value=t,console.log("[地图] selectedContinent 已设置:",s.value),t.clickPosition&&(c.value={x:t.clickPosition.x,y:t.clickPosition.y},console.log("[地图] 弹窗位置（点击位置）:",c.value))},S=()=>{i.value=null,s.value=null},V=()=>{if(a.value&&o.value)try{const e=a.value.getBoundingClientRect();o.value.resize(e.width,e.height)}catch(e){console.warn("[地图] Resize 错误（已忽略）:",e)}},C=()=>{V()};return(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",L2,[(0,r.createCommentVNode)(" 世界信息头部 "),p.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",F2,[(0,r.createElementVNode)("div",j2,(0,r.toDisplayString)(m.value),1),(0,r.createElementVNode)("div",U2,(0,r.toDisplayString)(p.value),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" Pixi.js Canvas容器 "),(0,r.createElementVNode)("div",{class:"map-container",ref_key:"mapContainerRef",ref:a},[(0,r.createElementVNode)("canvas",{ref_key:"canvasRef",ref:n},null,512),(0,r.createCommentVNode)(" 初始化地图按钮 (仅在地图为空时显示) "),f.value||d.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",q2,[(0,r.createElementVNode)("div",{class:"initialize-prompt"},[t[2]||(t[2]=(0,r.createElementVNode)("div",{class:"prompt-icon"},[(0,r.createElementVNode)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"map-icon"},[(0,r.createElementVNode)("path",{d:"M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3V6z"}),(0,r.createElementVNode)("path",{d:"M9 3v15M15 6v15"})])],-1)),t[3]||(t[3]=(0,r.createElementVNode)("h3",null,"地图尚未初始化",-1)),t[4]||(t[4]=(0,r.createElementVNode)("p",null,"当前世界还没有生成势力和地点，点击下方按钮开始生成地图内容",-1)),(0,r.createElementVNode)("button",{onClick:k,class:"initialize-btn"},t[1]||(t[1]=[(0,r.createElementVNode)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"btn-icon"},[(0,r.createElementVNode)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.createElementVNode)("path",{d:"M8 12h8M12 8v8"})],-1),(0,r.createTextVNode)(" 初始化地图 ",-1)]))])])),(0,r.createCommentVNode)(" 初始化进行中 "),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",G2,[(0,r.createElementVNode)("div",H2,[t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"loading-spinner"},null,-1)),t[6]||(t[6]=(0,r.createElementVNode)("h3",null,"正在生成地图内容...",-1)),(0,r.createElementVNode)("p",Y2,(0,r.toDisplayString)(l.value),1)])])):(0,r.createCommentVNode)("v-if",!0)],512),(0,r.createCommentVNode)(" 地点信息弹窗 "),i.value&&!b(i.value)?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:1,class:"location-popup",style:(0,r.normalizeStyle)(y.value)},[(0,r.createElementVNode)("div",W2,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(i.value.name),1),(0,r.createElementVNode)("button",{onClick:S,class:"close-btn"},"×")]),(0,r.createElementVNode)("div",X2,[(0,r.createElementVNode)("p",J2,(0,r.toDisplayString)((c=i.value.type,v[c]||c||"未知类型")),1),(0,r.createElementVNode)("p",K2,(0,r.toDisplayString)(i.value.description||i.value.描述),1),i.value.danger_level?((0,r.openBlock)(),(0,r.createElementBlock)("div",Z2,[t[7]||(t[7]=(0,r.createElementVNode)("strong",null,"安全等级：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.danger_level),1)])):(0,r.createCommentVNode)("v-if",!0),i.value.suitable_for?((0,r.openBlock)(),(0,r.createElementBlock)("div",Q2,[t[8]||(t[8]=(0,r.createElementVNode)("strong",null,"适合境界：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.suitable_for),1)])):(0,r.createCommentVNode)("v-if",!0),i.value.controlled_by?((0,r.openBlock)(),(0,r.createElementBlock)("div",e5,[t[9]||(t[9]=(0,r.createElementVNode)("strong",null,"控制势力：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.controlled_by),1)])):(0,r.createCommentVNode)("v-if",!0)])],4)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 势力信息弹窗 "),i.value&&b(i.value)?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:2,class:"location-popup faction-popup",style:(0,r.normalizeStyle)(y.value)},[(0,r.createElementVNode)("div",t5,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(i.value.name||i.value.名称),1),(0,r.createElementVNode)("button",{onClick:S,class:"close-btn"},"×")]),(0,r.createElementVNode)("div",n5,[(0,r.createElementVNode)("p",a5,(0,r.toDisplayString)(i.value.类型||i.value.type||"势力"),1),(0,r.createElementVNode)("p",r5,(0,r.toDisplayString)(i.value.description||i.value.描述),1),i.value.等级?((0,r.openBlock)(),(0,r.createElementBlock)("div",o5,[t[10]||(t[10]=(0,r.createElementVNode)("strong",null,"势力等级：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.等级),1)])):(0,r.createCommentVNode)("v-if",!0),i.value.leadership||i.value.领导层?((0,r.openBlock)(),(0,r.createElementBlock)("div",i5,[t[11]||(t[11]=(0,r.createElementVNode)("strong",null,"掌门：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.leadership?.宗主||i.value.领导层?.宗主)+" ",1),i.value.leadership?.宗主修为||i.value.领导层?.宗主修为?((0,r.openBlock)(),(0,r.createElementBlock)("span",s5," （"+(0,r.toDisplayString)(i.value.leadership?.宗主修为||i.value.领导层?.宗主修为)+"） ",1)):(0,r.createCommentVNode)("v-if",!0)])):(0,r.createCommentVNode)("v-if",!0),i.value.memberCount||i.value.成员数量?((0,r.openBlock)(),(0,r.createElementBlock)("div",l5,[t[12]||(t[12]=(0,r.createElementVNode)("strong",null,"成员数量：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(i.value.memberCount?.total||i.value.成员数量?.总数||i.value.成员数量?.total)+"人 ",1)])):(0,r.createCommentVNode)("v-if",!0),i.value.特色&&i.value.特色.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",c5,[t[13]||(t[13]=(0,r.createElementVNode)("strong",null,"势力特色：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(Array.isArray(i.value.特色)?i.value.特色.join("、"):i.value.特色),1)])):(0,r.createCommentVNode)("v-if",!0),i.value.与玩家关系?((0,r.openBlock)(),(0,r.createElementBlock)("div",d5,[t[14]||(t[14]=(0,r.createElementVNode)("strong",null,"关系：",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)((o=i.value.与玩家关系,"友好"===o||"盟友"===o?"relation-friendly":"敌对"===o||"仇敌"===o?"relation-hostile":"relation-neutral"))},(0,r.toDisplayString)(i.value.与玩家关系),3)])):(0,r.createCommentVNode)("v-if",!0)])],4)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 大陆信息弹窗 "),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:3,class:"location-popup continent-popup",style:(0,r.normalizeStyle)(y.value)},[(0,r.createElementVNode)("div",u5,[(0,r.createElementVNode)("h4",null,(0,r.toDisplayString)(s.value.name),1),(0,r.createElementVNode)("button",{onClick:S,class:"close-btn"},"×")]),(0,r.createElementVNode)("div",m5,[t[20]||(t[20]=(0,r.createElementVNode)("p",{class:"location-type"},"大陆",-1)),(0,r.createElementVNode)("p",p5,(0,r.toDisplayString)(s.value.description||"广袤的修仙大陆，蕴含无尽机缘与危险。"),1),s.value.气候?((0,r.openBlock)(),(0,r.createElementBlock)("div",g5,[t[15]||(t[15]=(0,r.createElementVNode)("strong",null,"气候：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(s.value.气候),1)])):(0,r.createCommentVNode)("v-if",!0),s.value.地理特征&&s.value.地理特征.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",h5,[t[16]||(t[16]=(0,r.createElementVNode)("strong",null,"地理特征：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(s.value.地理特征.join("、")),1)])):(0,r.createCommentVNode)("v-if",!0),s.value.天然屏障&&s.value.天然屏障.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",f5,[t[17]||(t[17]=(0,r.createElementVNode)("strong",null,"天然屏障：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(s.value.天然屏障.join("、")),1)])):(0,r.createCommentVNode)("v-if",!0),s.value.特点?((0,r.openBlock)(),(0,r.createElementBlock)("div",v5,[t[18]||(t[18]=(0,r.createElementVNode)("strong",null,"大陆特点：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(s.value.特点),1)])):(0,r.createCommentVNode)("v-if",!0),s.value.主要势力&&s.value.主要势力.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",b5,[t[19]||(t[19]=(0,r.createElementVNode)("strong",null,"主要势力：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(Array.isArray(s.value.主要势力)?s.value.主要势力.join("、"):s.value.主要势力),1)])):(0,r.createCommentVNode)("v-if",!0)])],4)):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 地图图例 "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["map-legend",{collapsed:u.value}])},[(0,r.createElementVNode)("div",{class:"legend-header",onClick:t[0]||(t[0]=e=>u.value=!u.value)},[(0,r.createElementVNode)("div",y5,(0,r.toDisplayString)(m.value)+"图例",1),(0,r.createElementVNode)("button",x5,[u.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(rW),{key:0,size:16})),u.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(qw),{key:1,size:16})):(0,r.createCommentVNode)("v-if",!0)])]),u.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",k5,[(0,r.createCommentVNode)(" 名山大川 "),(0,r.createElementVNode)("div",w5,[(0,r.createVNode)((0,r.unref)(XA),{size:16,class:"legend-icon mountain"}),t[21]||(t[21]=(0,r.createElementVNode)("span",null,"名山大川",-1))]),(0,r.createCommentVNode)(" 宗门势力 "),(0,r.createElementVNode)("div",E5,[(0,r.createVNode)((0,r.unref)(oW),{size:16,class:"legend-icon faction"}),t[22]||(t[22]=(0,r.createElementVNode)("span",null,"宗门势力",-1))]),(0,r.createCommentVNode)(" 城镇坊市 "),(0,r.createElementVNode)("div",N5,[(0,r.createVNode)((0,r.unref)(iW),{size:16,class:"legend-icon town"}),t[23]||(t[23]=(0,r.createElementVNode)("span",null,"城镇坊市",-1))]),(0,r.createCommentVNode)(" 洞天福地 "),(0,r.createElementVNode)("div",S5,[(0,r.createVNode)((0,r.unref)(Kp),{size:16,class:"legend-icon blessed"}),t[24]||(t[24]=(0,r.createElementVNode)("span",null,"洞天福地",-1))]),(0,r.createCommentVNode)(" 奇珍异地 "),(0,r.createElementVNode)("div",V5,[(0,r.createVNode)((0,r.unref)(DP),{size:16,class:"legend-icon treasure"}),t[25]||(t[25]=(0,r.createElementVNode)("span",null,"奇珍异地",-1))]),(0,r.createCommentVNode)(" 凶险之地 "),(0,r.createElementVNode)("div",_5,[(0,r.createVNode)((0,r.unref)(sW.A),{size:16,class:"legend-icon danger"}),t[26]||(t[26]=(0,r.createElementVNode)("span",null,"凶险之地",-1))]),(0,r.createCommentVNode)(" 其他特殊 "),(0,r.createElementVNode)("div",C5,[(0,r.createVNode)((0,r.unref)(bu),{size:16,class:"legend-icon special"}),t[27]||(t[27]=(0,r.createElementVNode)("span",null,"其他特殊",-1))]),(0,r.createCommentVNode)(" 玩家位置 "),(0,r.createElementVNode)("div",A5,[(0,r.createVNode)((0,r.unref)(_),{size:16,class:"legend-icon player"}),t[28]||(t[28]=(0,r.createElementVNode)("span",null,"玩家位置",-1))]),(0,r.createCommentVNode)(" NPC位置 "),(0,r.createElementVNode)("div",D5,[(0,r.createVNode)((0,r.unref)(fu),{size:16,class:"legend-icon npc"}),t[29]||(t[29]=(0,r.createElementVNode)("span",null,"NPC位置",-1))])]))],2)]);var o,c}}});var B5=n(5826),I5={};I5.styleTagTransform=k(),I5.setAttributes=v(),I5.insert=h().bind(null,"head"),I5.domAPI=p(),I5.insertStyleElement=y(),u()(B5.A,I5),B5.A&&B5.A.locals&&B5.A.locals;const z5=(0,N.A)(T5,[["__scopeId","data-v-443560a0"]]),M5={class:"event-panel"},P5={class:"event-toolbar"},R5={class:"title"},$5={key:0,class:"meta"},O5={key:0,class:"config-section"},L5={class:"config-item"},F5={class:"toggle-switch"},j5={class:"config-item"},U5={class:"config-item"},q5={class:"config-item config-item-full"},G5={class:"event-list"},H5={key:0,class:"empty-state"},Y5={key:1,class:"events"},W5={class:"event-header"},X5={class:"event-type"},J5={class:"event-name"},K5={class:"event-time"},Z5={class:"event-desc"},Q5=(0,r.defineComponent)({__name:"EventPanel",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,Jc.useCharacterStore)(),a=(0,r.ref)(!1),o=(0,r.computed)(()=>t.eventSystem),i=(0,r.computed)(()=>[...o.value?.事件记录||[]].slice().reverse()),s=(0,r.computed)(()=>{const e=o.value?.下次事件时间;return e?u(e):""}),l=(0,r.reactive)({enabled:!0,minYears:1,maxYears:10,prompt:""}),c=async()=>{try{if(o.value?.配置){const e=o.value.配置;e.启用随机事件=l.enabled,e.最小间隔年=Math.max(1,Math.floor(l.minYears)),e.最大间隔年=Math.max(e.最小间隔年,Math.floor(l.maxYears)),e.事件提示词=l.prompt||"",await n.saveCurrentGame(),X.o.success("事件配置已保存")}}catch(e){console.error("保存事件配置失败:",e),X.o.error("保存配置失败，请重试")}},d=async()=>{try{o.value&&(o.value.下次事件时间=null,await n.saveCurrentGame(),X.o.success("已重新抽取下次世界事件时间"))}catch(e){console.error("重置下次事件失败:",e),X.o.error("重置失败，请重试")}};function u(e){return`${e.年}年${e.月}月${e.日}日 ${String(e.小时).padStart(2,"0")}:${String(e.分钟).padStart(2,"0")}`}return(0,r.onMounted)(()=>{(()=>{if(o.value?.配置){const e=o.value.配置;l.enabled=!1!==e.启用随机事件,l.minYears=Number(e.最小间隔年??1),l.maxYears=Number(e.最大间隔年??10),l.prompt=String(e.事件提示词??"")}})()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",M5,[(0,r.createElementVNode)("div",P5,[(0,r.createElementVNode)("div",R5,[t[5]||(t[5]=(0,r.createElementVNode)("span",{class:"title-text"},"世界事件",-1)),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("span",$5,"· 下次事件："+(0,r.toDisplayString)(s.value),1)):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("button",{class:"tool-btn",onClick:t[0]||(t[0]=e=>a.value=!a.value)},(0,r.toDisplayString)(a.value?"隐藏配置":"事件配置"),1)]),(0,r.createCommentVNode)(" 配置区域 "),a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",O5,[(0,r.createElementVNode)("div",L5,[t[7]||(t[7]=(0,r.createElementVNode)("div",{class:"config-label"},[(0,r.createElementVNode)("span",{class:"label-text"},"启用世界事件"),(0,r.createElementVNode)("span",{class:"label-hint"},"游戏时间推进时自动发生影响世界的事件")],-1)),(0,r.createElementVNode)("label",F5,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>l.enabled=e),onChange:c},null,544),[[r.vModelCheckbox,l.enabled]]),t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"toggle-slider"},null,-1))])]),(0,r.createElementVNode)("div",j5,[t[8]||(t[8]=(0,r.createElementVNode)("div",{class:"config-label"},[(0,r.createElementVNode)("span",{class:"label-text"},"事件间隔（最小）"),(0,r.createElementVNode)("span",{class:"label-hint"},"随机事件最短间隔（年）")],-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",class:"config-input",min:"1",step:"1","onUpdate:modelValue":t[2]||(t[2]=e=>l.minYears=e),onChange:c},null,544),[[r.vModelText,l.minYears,void 0,{number:!0}]])]),(0,r.createElementVNode)("div",U5,[t[9]||(t[9]=(0,r.createElementVNode)("div",{class:"config-label"},[(0,r.createElementVNode)("span",{class:"label-text"},"事件间隔（最大）"),(0,r.createElementVNode)("span",{class:"label-hint"},"随机事件最长间隔（年）")],-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",class:"config-input",min:"1",step:"1","onUpdate:modelValue":t[3]||(t[3]=e=>l.maxYears=e),onChange:c},null,544),[[r.vModelText,l.maxYears,void 0,{number:!0}]])]),(0,r.createElementVNode)("div",q5,[t[10]||(t[10]=(0,r.createElementVNode)("div",{class:"config-label"},[(0,r.createElementVNode)("span",{class:"label-text"},"自定义事件提示词"),(0,r.createElementVNode)("span",{class:"label-hint"},"为世界事件生成添加自定义指令（可选）")],-1)),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.prompt=e),class:"config-textarea",placeholder:"例如：更偏向宗门大战、秘境现世、好友遭遇，并尽量让事件影响玩家...",rows:"3",onChange:c},null,544),[[r.vModelText,l.prompt]])]),(0,r.createElementVNode)("div",{class:"config-actions"},[(0,r.createElementVNode)("button",{class:"action-btn",onClick:d}," 重新抽取下次事件时间 ")])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",G5,[0===i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",H5,t[11]||(t[11]=[(0,r.createElementVNode)("div",{class:"empty-title"},"暂无事件记录",-1),(0,r.createElementVNode)("div",{class:"empty-hint"},"事件会随游戏时间推进自动发生。",-1)]))):((0,r.openBlock)(),(0,r.createElementBlock)("div",Y5,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.事件ID,class:"event-item"},[(0,r.createElementVNode)("div",W5,[(0,r.createElementVNode)("span",X5,(0,r.toDisplayString)(e.事件类型),1),(0,r.createElementVNode)("span",J5,(0,r.toDisplayString)(e.事件名称),1),(0,r.createElementVNode)("span",K5,(0,r.toDisplayString)(u(e.发生时间)),1)]),(0,r.createElementVNode)("div",Z5,(0,r.toDisplayString)(e.事件描述),1)]))),128))]))])]))}});var e6=n(9971),t6={};t6.styleTagTransform=k(),t6.setAttributes=v(),t6.insert=h().bind(null,"head"),t6.domAPI=p(),t6.insertStyleElement=y(),u()(e6.A,t6),e6.A&&e6.A.locals&&e6.A.locals;const n6=(0,N.A)(Q5,[["__scopeId","data-v-59f5a4ff"]]),a6=(0,V.A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),r6=(0,V.A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),o6=(0,V.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),i6=(0,V.A)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),s6=(0,V.A)("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),l6=(0,V.A)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),c6={凡:80,黄:200,玄:500,地:900,天:1500,仙:2600,神:4200},d6={丹药:.85,功法:1.4,装备:1.2,材料:.65,其他:1},u6=[{name:"聚气丹",type:"丹药",quality:"黄品下",description:"加速灵气运转，稳固修炼节奏。",icon:"*"},{name:"回灵丹",type:"丹药",quality:"黄品中",description:"迅速恢复灵气消耗，适合战斗后补给。",icon:"*"},{name:"疗伤散",type:"丹药",quality:"凡品",description:"外伤止血，缓解疲劳。",icon:"*"},{name:"护身符",type:"装备",quality:"黄品下",description:"减轻低阶术法伤害。",icon:"O"},{name:"灵石匣",type:"其他",quality:"凡品",description:"短期存放灵石的轻便匣子。",icon:"O"},{name:"灵草",type:"材料",quality:"凡品",description:"基础炼丹材料，常见药草。",icon:"O"},{name:"灵砂",type:"材料",quality:"黄品下",description:"炼器辅材，增强灵力导通。",icon:"O"}],m6=[{name:"基础吐纳术",quality:"凡品",description:"稳固灵气吸纳，适合打底修炼。"},{name:"引气诀",quality:"黄品下",description:"引导灵气运转周身经脉。"},{name:"静心诀",quality:"黄品中",description:"宁神静气，提升修炼专注度。"},{name:"护体灵罩",quality:"黄品中",description:"凝聚灵气护体，防御入门术法。"}],p6={sword:[{name:"青锋剑诀残卷",type:"功法",quality:"黄品中",description:"剑意基础篇章，适合入门弟子。",icon:"*"},{name:"玄铁剑胚",type:"装备",quality:"黄品中",description:"可塑性良好的剑胚。",icon:"O"},{name:"磨剑石",type:"材料",quality:"凡品",description:"打磨剑意，提升锋锐。",icon:"O"}],alchemy:[{name:"炼丹要诀",type:"功法",quality:"黄品中",description:"炼丹基础心法，讲究火候与灵压。",icon:"*"},{name:"聚灵炉",type:"装备",quality:"黄品下",description:"小型炼丹炉，稳定火候。",icon:"O"},{name:"灵药种子",type:"材料",quality:"黄品下",description:"适合灵田培育，产量稳定。",icon:"O"}],array:[{name:"符箓入门",type:"功法",quality:"黄品下",description:"符箓绘制基础，稳定灵纹结构。",icon:"*"},{name:"小五行阵盘",type:"装备",quality:"黄品中",description:"临时布阵用阵盘，威力有限。",icon:"O"},{name:"朱砂",type:"材料",quality:"凡品",description:"绘符材料，稳定灵线。",icon:"O"}],demonic:[{name:"噬灵诀",type:"功法",quality:"黄品中",description:"吞纳外灵，效率更高但风险更大。",icon:"*"},{name:"煞气丹",type:"丹药",quality:"黄品中",description:"短时提升攻击力，副作用明显。",icon:"*"},{name:"血煞石",type:"材料",quality:"黄品下",description:"魔道辅材，气息阴冷。",icon:"O"}],merchant:[{name:"折扣令",type:"其他",quality:"凡品",description:"兑换商会折扣的令牌。",icon:"O"},{name:"情报玉简",type:"其他",quality:"黄品下",description:"记录周边势力动态的玉简。",icon:"O"},{name:"行商令",type:"其他",quality:"黄品中",description:"可通行部分坊市关卡。",icon:"O"}],beast:[{name:"驭兽诀",type:"功法",quality:"黄品中",description:"基础驭兽法门，适合灵兽契约。",icon:"*"},{name:"灵兽饲料",type:"材料",quality:"凡品",description:"补充灵兽体力的饲料。",icon:"O"},{name:"兽血晶",type:"材料",quality:"黄品下",description:"蕴含灵兽气血精华。",icon:"O"}]},g6={sword:[{name:"青锋剑诀",quality:"黄品中",description:"身法与剑意配合的基础剑诀。"},{name:"流云剑步",quality:"玄品下",description:"以身驭剑，步法飘逸难测。"},{name:"御剑术",quality:"玄品下",description:"御剑远攻，提升机动性。"}],alchemy:[{name:"百草经",quality:"黄品中",description:"药性辨识与灵草搭配要诀。"},{name:"炼丹术",quality:"玄品下",description:"炼丹火候掌控之法。"},{name:"灵药辨识",quality:"凡品",description:"识别灵药品阶与属性。"}],array:[{name:"符箓精义",quality:"黄品中",description:"灵纹勾勒技巧，提升符箓稳定。"},{name:"小五行阵图",quality:"玄品下",description:"常用阵法结构，稳定防守。"}],demonic:[{name:"血煞功",quality:"玄品下",description:"引煞入体，爆发短时增幅。"},{name:"阴冥诀",quality:"黄品中",description:"阴气凝聚，强化神识。"}],merchant:[{name:"商道心法",quality:"黄品下",description:"洞察人心，稳固交易秩序。"},{name:"鉴宝诀",quality:"玄品下",description:"辨识灵宝真伪与来历。"}],beast:[{name:"灵兽感应术",quality:"玄品下",description:"感知灵兽状态与情绪。"},{name:"驭兽印法",quality:"黄品中",description:"稳固灵兽契约的印诀。"}]},h6=e=>{let t=0;for(let n=0;n<e.length;n+=1)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t)},f6=(e,t,n)=>{const a=[...e],r=[],o=Math.min(t,a.length);for(let e=0;e<o;e+=1){const e=Math.floor(n()*a.length);r.push(a.splice(e,1)[0])}return r},v6=e=>{const t=e.match(/[凡黄玄地天仙神]/);return t?t[0]:"凡"},b6=e=>{const t=`${e.类型||""}${Array.isArray(e.特色)?e.特色.join(""):e.特色||""}${Array.isArray(e.特色列表)?e.特色列表.join(""):""}`;return/剑/i.test(t)?"sword":/丹|药/i.test(t)?"alchemy":/符|阵/i.test(t)?"array":/商/i.test(t)?"merchant":/妖|兽/i.test(t)?"beast":/魔|邪|煞/i.test(t)?"demonic":"sword"},y6=(e,t,n)=>{const a=b6(e),r=[...u6,...p6[a]||[]];return f6(r,6,t).map((e,a)=>{const r=v6(e.quality),o=c6[r]||120,i=d6[e.type]||1,s=.85+.3*t(),l=Math.max(40,10*Math.round(o*i*s/10));let c;return c="功法"===e.type?void 0:"装备"===e.type?Math.max(1,Math.floor(3*t())+1):"丹药"===e.type?Math.max(3,Math.floor(8*t())+3):"材料"===e.type?Math.max(5,Math.floor(14*t())+5):Math.max(2,Math.floor(6*t())+2),{id:`sect_${n}_shop_${a+1}`,name:e.name,icon:e.icon||"O",type:e.type,quality:e.quality,description:e.description,cost:l,stock:c}})},x6=(e,t,n)=>{const a=b6(e),r=[...m6,...g6[a]||[]];return f6(r,5,t).map((e,a)=>{const r=v6(e.quality),o=c6[r]||120,i=.85+.25*t(),s=Math.max(60,10*Math.round(1.2*o*i/10));return{id:`sect_${n}_lib_${a+1}`,name:e.name,quality:e.quality,qualityTier:r,cost:s,description:e.description}})},k6={class:"sect-panel"},w6={class:"panel-content"},E6={class:"sect-container"},N6={class:"sect-list"},S6={class:"list-header"},V6={class:"search-bar"},_6={class:"list-content"},C6={key:0,class:"loading-state"},A6={key:1,class:"empty-state"},D6={class:"empty-text"},T6={class:"empty-hint"},B6={key:2,class:"sect-list-content"},I6=["onClick"],z6={class:"sect-icon"},M6={class:"sect-emoji"},P6={class:"sect-info"},R6={class:"sect-name"},$6={class:"sect-meta"},O6={class:"sect-type"},L6={class:"sect-detail"},F6={key:0,class:"detail-content"},j6={class:"detail-header"},U6={class:"detail-icon"},q6={class:"sect-emoji-large"},G6={class:"detail-info"},H6={class:"detail-name"},Y6={class:"detail-badges"},W6={class:"detail-body"},X6={key:0,class:"detail-section"},J6={class:"section-title"},K6={class:"member-stats"},Z6={class:"total-members"},Q6={class:"total-value"},e3={key:0,class:"realm-distribution"},t3={class:"realm-stats"},n3={class:"realm-name"},a3={class:"realm-count"},r3={key:1,class:"position-distribution"},o3={class:"position-stats"},i3={class:"position-name"},s3={class:"position-count"},l3={class:"detail-section"},c3={class:"section-title"},d3={class:"info-grid"},u3={class:"info-item"},m3={class:"info-value"},p3={class:"info-item"},g3={class:"info-value"},h3={class:"info-item"},f3={class:"info-value"},v3={class:"info-item"},b3={class:"info-value"},y3={key:0,class:"leadership-info"},x3={class:"leader-grid"},k3={class:"leader-item primary-leader"},w3={class:"leader-name"},E3={key:0,class:"leader-realm"},N3={key:0,class:"leader-item"},S3={class:"leader-name"},V3={key:1,class:"leader-item"},_3={class:"leader-name"},C3={class:"sect-strength"},A3={class:"strength-item"},D3={class:"strength-value peak-power"},T3={key:0,class:"strength-item"},B3={class:"power-level"},I3={class:"sect-description"},z3={class:"desc-text"},M3={key:1,class:"sect-specialties"},P3={class:"specialties-tags"},R3={class:"detail-section"},$3={class:"section-title"},O3={class:"relationship-info"},L3={class:"relationship-item"},F3={class:"relationship-item"},j3={class:"reputation-level"},U3={key:1,class:"detail-section"},q3={class:"section-title"},G3={class:"territory-info"},H3={class:"influence-description"},Y3={key:0,class:"controlled-areas"},W3={class:"areas-list"},X3={class:"strategic-value"},J3={class:"value-display"},K3={class:"value-bar"},Z3={class:"value-text"},Q3={key:2,class:"detail-section"},e8={class:"section-title"},t8={class:"join-requirements"},n8={key:0,class:"requirements-list"},a8={class:"requirement-text"},r8={key:1,class:"no-requirements"},o8={key:0,class:"join-benefits"},i8={class:"benefits-list"},s8={class:"benefit-text"},l8={class:"join-actions"},c8={key:3,class:"detail-section"},d8={class:"section-title"},u8={class:"current-member-info"},m8={class:"member-status"},p8={class:"status-item"},g8={class:"status-value position"},h8={class:"status-item"},f8={class:"status-value contribution"},v8={class:"status-item"},b8={class:"status-value reputation"},y8={class:"status-item"},x8={class:"status-value join-date"},k8={class:"member-actions"},w8={class:"sect-actions"},E8={class:"action-buttons"},N8={key:1,class:"no-selection"},S8=(0,r.defineComponent)({__name:"SectPanel",setup(e){const t=(0,Jc.useCharacterStore)(),n=(0,pu.useGameStateStore)(),o=(0,a.useRouter)(),{t:i}=(0,K.s)(),s=((0,se.isTavernEnv)(),(0,r.ref)(!1)),l=(0,r.ref)(null),c=(0,r.ref)(""),d=(0,r.computed)(()=>{const e=l.value;return e?.领导层||e?.leadership||null}),u=()=>{Kw((()=>{const e=n.worldInfo?.地图配置;return`你是GM，请根据当前剧情与世界设定，生成/补全「世界.信息.势力信息」（数组）。\n\n要求：\n- 每条势力至少包含：名称、类型、等级、描述、宗门驻地、主要资源、可否加入、加入条件、领导层、成员数量、势力范围详情、与玩家关系、声望值。\n- 坐标范围：x 0-${Number(e?.width)||1e4}，y 0-${Number(e?.height)||1e4}（游戏坐标，左上角为原点）。\n- 势力必须包含「位置」坐标（对象，含x/y）与「势力范围」（至少4个坐标点）。\n- 内容要与当前世界一致，避免与已存在信息冲突。\n- 严格输出一个 JSON 对象（不要代码块/解释/额外文本，不要 <thinking>）：\n{\n  "text": "【系统】势力信息已补全。",\n  "mid_term_memory": "",\n  "tavern_commands": [\n    {"action":"set","key":"世界.信息.势力信息","value":[/*...势力数组...*/]}\n  ],\n  "action_options": []\n}`})()),X.o.success("已发送到对话")},m=(0,r.computed)(()=>{const e=n.getCurrentSaveData();if(!e)return{availableSects:[]};let t=[];const a=n.sectSystem,r=e?.世界?.信息;r?.势力信息&&(t=r.势力信息.filter(e=>{if(!e.类型)return!1;const t=e.类型.toLowerCase();return!["秘境","遗迹","禁地","森林","山脉","湖泊","城池"].some(e=>t.includes(e.toLowerCase()))})),0===t.length&&a?.宗门档案&&Object.keys(a.宗门档案).length>0&&(t=Object.values(a.宗门档案));const o=t.filter((e,t,n)=>n.findIndex(t=>t.名称===e.名称)===t);return{availableSects:$u(o)}}),p=(0,r.computed)(()=>n.sectMemberInfo||void 0),g=(0,r.computed)(()=>m.value.availableSects),h=(0,r.computed)(()=>{let e=[...g.value];if(c.value.trim()){const t=c.value.toLowerCase();e=e.filter(e=>e.名称.toLowerCase().includes(t)||e.类型.toLowerCase().includes(t)||e.描述&&e.描述.toLowerCase().includes(t))}const t=["超级","一流","二流","三流","末流"],n=e=>{if(!e)return 999;const n=t.findIndex(t=>e.includes(t));return-1===n?999:n};return e.sort((e,t)=>n(e.等级)-n(t.等级))}),f=e=>{if(e.所在大洲)return e.所在大洲;const t=n.worldInfo,a=t?.continents||t?.大陆信息;if(a)for(const t of a){if(e.id&&(t.主要势力?.includes(e.id)||t.factions?.includes(e.id)))return t.名称||t.name||"未命名大洲";if(t.主要势力?.includes(e.名称)||t.factions?.includes(e.名称))return t.名称||t.name||"未命名大洲"}if(t?.势力信息)for(const n of t.势力信息)if((n.id&&e.id&&n.id===e.id||n.名称===e.名称)&&n.所在大洲)return n.所在大洲;if(e.位置&&"object"==typeof e.位置&&"x"in e.位置&&"y"in e.位置){const t=e.位置.x,n=e.位置.y;return t<110&&n>40?"北境雪域":t<110&&n<30?"南疆荒漠":t>120&&n>35?"东海群岛":t>120&&n<35?"东南丛林":"中土大陆"}return"未知大洲"},v=e=>{const t=e;if(t.主要资源&&Array.isArray(t.主要资源))return t.主要资源.slice(0,3).join("、");if(t.resources&&Array.isArray(t.resources))return t.resources.slice(0,3).join("、");const n=e.类型||"";return n.includes("剑")?"神铁、剑谱、磨剑石":n.includes("丹")?"灵药、丹炉、药圃":n.includes("符")||n.includes("阵")?"符纸、阵法、法器":n.includes("魔")||n.includes("邪")?"魔石、煞气、秘法":n.includes("商")?"灵石、珍宝、情报":n.includes("世家")?"传承、人脉、底蕴":"灵石、功法、修炼资源"},b=e=>{const t=[];return e.特色列表&&Array.isArray(e.特色列表)&&t.push(...e.特色列表),e.特色&&(Array.isArray(e.特色)?t.push(...e.特色):"string"==typeof e.特色&&t.push(e.特色)),Array.from(new Set(t))},y=e=>String("object"==typeof e&&null!==e&&"name"in e?e.name:e||"中立"),x=e=>"object"==typeof e&&null!==e&&"value"in e?Number(e.value):Number(e)||0,k=e=>({正道宗门:"⛩️",修仙宗门:"⛩️",魔道宗门:"🏴",魔道势力:"🏴",中立宗门:"🏯",修仙世家:"🏘️",世家:"🏘️",商会:"🏪",商会组织:"🏪",散修联盟:"🤝"}[e]||"🏛️"),w=e=>({正道宗门:"righteous",修仙宗门:"righteous",魔道宗门:"demonic",魔道势力:"demonic",中立宗门:"neutral",修仙世家:"family",世家:"family",商会:"merchant",商会组织:"merchant",散修联盟:"alliance"}[e]||"neutral"),E=e=>e>=90?"天下无双":e>=80?"称霸一方":e>=70?"实力雄厚":e>=60?"颇有实力":e>=50?"中等水平":e>=40?"略有实力":"实力一般",N=e=>e>=25?"声名远扬":e>=20?"享有盛誉":e>=15?"名声在外":e>=10?"小有名气":e>=5?"略有声望":"默默无闻",S=e=>{if(!e)return"未知";try{return new Date(e).toLocaleDateString("zh-CN")}catch{return"未知"}},V=e=>e?e.includes("期")||/(练气|筑基|金丹|元婴|化神|炼虚|合体|渡劫)(初期|中期|后期|圆满|极境)/.test(e)?e:/^(练气|筑基|金丹|元婴|化神|炼虚|合体|渡劫)$/.test(e)?e+"期":e:"未知",_=(e,t)=>{const n=t?`你已加入${e}，是否退出并加入${t}？退出后将清空该宗门的贡献与兑换数据。`:`确定退出${e}？退出后将清空该宗门的贡献与兑换数据。`;return window.confirm(n)},C=e=>{n.updateState("sectMemberInfo",null),n.updateState("sectSystem",null),X.o.success(`已退出 ${e}`)},A=()=>{o.push({name:"SectContribution"})},D=()=>{o.push({name:"SectLibrary"})},T=()=>{o.push({name:"SectMembers"})},B=()=>{t.reloadFromStorage(),X.o.info("已强制刷新数据")};return(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",k6,[(0,r.createElementVNode)("div",w6,[(0,r.createElementVNode)("div",E6,[(0,r.createCommentVNode)(" 左侧：宗门列表 "),(0,r.createElementVNode)("div",N6,[(0,r.createElementVNode)("div",S6,[t[3]||(t[3]=(0,r.createElementVNode)("h3",{class:"panel-title"},"势力宗门",-1)),(0,r.createElementVNode)("div",V6,[(0,r.createVNode)((0,r.unref)(TP),{size:16}),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),placeholder:"搜索宗门...",class:"search-input"},null,512),[[r.vModelText,c.value]])])]),(0,r.createElementVNode)("div",_6,[s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",C6,[(0,r.createVNode)((0,r.unref)(Yw),{size:32,class:"animate-spin"}),(0,r.createElementVNode)("p",null,(0,r.toDisplayString)((0,r.unref)(i)("正在读取宗门信息...")),1)])):0===h.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",A6,[(0,r.createVNode)((0,r.unref)(a6),{size:48,class:"empty-icon"}),(0,r.createElementVNode)("p",D6,(0,r.toDisplayString)((0,r.unref)(i)("暂无宗门信息")),1),(0,r.createElementVNode)("p",T6,(0,r.toDisplayString)((0,r.unref)(i)("世界信息将由AI根据游戏进程生成")),1),(0,r.createElementVNode)("div",{class:"empty-actions"},[(0,r.createElementVNode)("button",{class:"empty-action-btn primary",onClick:u},"生成势力信息"),(0,r.createElementVNode)("button",{class:"empty-action-btn",onClick:B},"刷新")]),t[4]||(t[4]=(0,r.createElementVNode)("p",{class:"empty-prompt-hint"},[(0,r.createTextVNode)("提示：点击“生成势力信息”会自动发送到对话并写入 "),(0,r.createElementVNode)("code",null,"世界.信息.势力信息"),(0,r.createTextVNode)("。")],-1))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",B6,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(h.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.名称,class:(0,r.normalizeClass)(["sect-card",{selected:l.value?.名称===e.名称,[`type-${w(e.类型)}`]:!0,"can-join":e.可否加入}]),onClick:t=>(e=>{l.value=l.value?.名称===e.名称?null:e})(e)},[(0,r.createElementVNode)("div",z6,[(0,r.createElementVNode)("span",M6,(0,r.toDisplayString)(k(e.类型)),1)]),(0,r.createElementVNode)("div",P6,[(0,r.createElementVNode)("div",R6,(0,r.toDisplayString)(e.名称),1),(0,r.createElementVNode)("div",$6,[(0,r.createElementVNode)("span",O6,(0,r.toDisplayString)(e.类型),1)])]),(0,r.createVNode)((0,r.unref)(dm),{size:16,class:"arrow-icon"})],10,I6))),128))]))])]),(0,r.createCommentVNode)(" 右侧：宗门详情 "),(0,r.createElementVNode)("div",L6,[l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",F6,[(0,r.createCommentVNode)(" 详情头部 "),(0,r.createElementVNode)("div",j6,[(0,r.createElementVNode)("div",U6,[(0,r.createElementVNode)("span",q6,(0,r.toDisplayString)(k(l.value.类型)),1)]),(0,r.createElementVNode)("div",G6,[(0,r.createElementVNode)("h3",H6,(0,r.toDisplayString)(l.value.名称),1),(0,r.createElementVNode)("div",Y6,[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["type-badge",`type-${w(l.value.类型)}`])},(0,r.toDisplayString)(l.value.类型),3),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["level-badge",`level-${l.value.等级}`])},(0,r.toDisplayString)((I=l.value.等级,I?I.includes("宗门")?I:I+"宗门":"未知")),3)])])]),(0,r.createCommentVNode)(" 详情主体 "),(0,r.createElementVNode)("div",W6,[(0,r.createCommentVNode)(" 成员统计 "),l.value.成员数量?((0,r.openBlock)(),(0,r.createElementBlock)("div",X6,[(0,r.createElementVNode)("h5",J6,[(0,r.createVNode)((0,r.unref)(fu),{size:16}),t[5]||(t[5]=(0,r.createElementVNode)("span",null,"成员统计",-1))]),(0,r.createElementVNode)("div",K6,[(0,r.createCommentVNode)(" 总体统计 "),(0,r.createElementVNode)("div",Z6,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"total-label"},"总人数",-1)),(0,r.createElementVNode)("span",Q6,(0,r.toDisplayString)(l.value.成员数量?.总数||l.value.成员数量?.total||0)+"人",1)]),(0,r.createCommentVNode)(" 境界分布 "),l.value.成员数量?.按境界||l.value.成员数量?.byRealm?((0,r.openBlock)(),(0,r.createElementBlock)("div",e3,[t[7]||(t[7]=(0,r.createElementVNode)("h6",{class:"distribution-title"},"境界分布",-1)),(0,r.createElementVNode)("div",t3,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.成员数量?.按境界||l.value.成员数量?.byRealm,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"realm-item"},[(0,r.createElementVNode)("span",n3,(0,r.toDisplayString)(V(String(t))),1),(0,r.createElementVNode)("span",a3,(0,r.toDisplayString)(e)+"人",1)]))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 职位分布 "),l.value.成员数量?.按职位||l.value.成员数量?.byPosition?((0,r.openBlock)(),(0,r.createElementBlock)("div",r3,[t[8]||(t[8]=(0,r.createElementVNode)("h6",{class:"distribution-title"},"职位分布",-1)),(0,r.createElementVNode)("div",o3,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.成员数量?.按职位||l.value.成员数量?.byPosition,(e,t)=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"position-item"},[(0,r.createElementVNode)("span",i3,(0,r.toDisplayString)(t),1),(0,r.createElementVNode)("span",s3,(0,r.toDisplayString)(e)+"人",1)])),[[r.vShow,e>0]])),128))])])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 基础信息 "),(0,r.createElementVNode)("div",l3,[(0,r.createElementVNode)("h5",c3,[(0,r.createVNode)((0,r.unref)(a6),{size:16}),t[9]||(t[9]=(0,r.createElementVNode)("span",null,"基础信息",-1))]),(0,r.createElementVNode)("div",d3,[(0,r.createElementVNode)("div",u3,[t[10]||(t[10]=(0,r.createElementVNode)("span",{class:"info-label"},"宗门类型",-1)),(0,r.createElementVNode)("span",m3,(0,r.toDisplayString)(l.value.类型),1)]),(0,r.createElementVNode)("div",p3,[t[11]||(t[11]=(0,r.createElementVNode)("span",{class:"info-label"},"宗门等级",-1)),(0,r.createElementVNode)("span",g3,(0,r.toDisplayString)(l.value.等级),1)]),(0,r.createElementVNode)("div",h3,[t[12]||(t[12]=(0,r.createElementVNode)("span",{class:"info-label"},"所在大洲",-1)),(0,r.createElementVNode)("span",f3,(0,r.toDisplayString)(f(l.value)),1)]),(0,r.createElementVNode)("div",v3,[t[13]||(t[13]=(0,r.createElementVNode)("span",{class:"info-label"},"主要资源",-1)),(0,r.createElementVNode)("span",b3,(0,r.toDisplayString)(v(l.value)),1)])]),(0,r.createCommentVNode)(" 宗门领导层 "),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",y3,[t[19]||(t[19]=(0,r.createElementVNode)("h6",{class:"leadership-title"},"宗门领导",-1)),(0,r.createElementVNode)("div",x3,[(0,r.createElementVNode)("div",k3,[t[14]||(t[14]=(0,r.createElementVNode)("span",{class:"leader-role"},"宗主",-1)),(0,r.createElementVNode)("span",w3,(0,r.toDisplayString)(d.value.宗主),1),d.value.宗主修为?((0,r.openBlock)(),(0,r.createElementBlock)("span",E3,(0,r.toDisplayString)(d.value.宗主修为),1)):(0,r.createCommentVNode)("v-if",!0)]),d.value.副宗主?((0,r.openBlock)(),(0,r.createElementBlock)("div",N3,[t[15]||(t[15]=(0,r.createElementVNode)("span",{class:"leader-role"},"副宗主",-1)),(0,r.createElementVNode)("span",S3,(0,r.toDisplayString)(d.value.副宗主),1)])):(0,r.createCommentVNode)("v-if",!0),d.value.圣女?((0,r.openBlock)(),(0,r.createElementBlock)("div",V3,[t[16]||(t[16]=(0,r.createElementVNode)("span",{class:"leader-role"},"圣女",-1)),(0,r.createElementVNode)("span",_3,(0,r.toDisplayString)(d.value.圣女),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",C3,[(0,r.createElementVNode)("div",A3,[t[17]||(t[17]=(0,r.createElementVNode)("span",{class:"strength-label"},"最强修为",-1)),(0,r.createElementVNode)("span",D3,(0,r.toDisplayString)(d.value.最强修为||d.value.宗主修为),1)]),d.value?.综合战力?((0,r.openBlock)(),(0,r.createElementBlock)("div",T3,[t[18]||(t[18]=(0,r.createElementVNode)("span",{class:"strength-label"},"综合战力",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["strength-value power-rating",(g=d.value.综合战力||0,g>=90?"power-legendary":g>=80?"power-supreme":g>=70?"power-strong":g>=60?"power-good":g>=50?"power-average":g>=40?"power-weak":"power-poor")])},[(0,r.createTextVNode)((0,r.toDisplayString)(d.value.综合战力||0)+"/100 ",1),(0,r.createElementVNode)("span",B3,"("+(0,r.toDisplayString)(E(d.value.综合战力||0))+")",1)],2)])):(0,r.createCommentVNode)("v-if",!0)])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",I3,[t[20]||(t[20]=(0,r.createElementVNode)("h6",{class:"desc-title"},"宗门描述",-1)),(0,r.createElementVNode)("p",z3,(0,r.toDisplayString)(l.value.描述),1)]),(0,r.createCommentVNode)(" 宗门特色 "),b(l.value).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",M3,[t[21]||(t[21]=(0,r.createElementVNode)("h6",{class:"specialties-title"},"宗门特色",-1)),(0,r.createElementVNode)("div",P3,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(b(l.value),e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"specialty-tag"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" 关系状态 "),(0,r.createElementVNode)("div",R3,[(0,r.createElementVNode)("h5",$3,[(0,r.createVNode)((0,r.unref)(Xp),{size:16}),t[22]||(t[22]=(0,r.createElementVNode)("span",null,"关系状态",-1))]),(0,r.createElementVNode)("div",O3,[(0,r.createElementVNode)("div",L3,[t[23]||(t[23]=(0,r.createElementVNode)("span",{class:"relationship-label"},"与你的关系",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["relationship-value",(m=y(l.value.与玩家关系),{仇敌:"enemy",敌对:"hostile",冷淡:"cold",中立:"neutral",友好:"friendly",盟友:"ally",附庸:"vassal"}[m]||"neutral")])},(0,r.toDisplayString)(y(l.value.与玩家关系)),3)]),(0,r.createElementVNode)("div",F3,[t[24]||(t[24]=(0,r.createElementVNode)("span",{class:"relationship-label"},"声望值",-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["relationship-value reputation-value",(o=x(l.value.声望值),o>=25?"reputation-legendary":o>=20?"reputation-excellent":o>=15?"reputation-good":o>=10?"reputation-fair":o>=5?"reputation-low":"reputation-none")])},[(0,r.createTextVNode)((0,r.toDisplayString)(x(l.value.声望值))+" ",1),(0,r.createElementVNode)("span",j3,"("+(0,r.toDisplayString)(N(x(l.value.声望值)))+")",1)],2)])])]),(0,r.createCommentVNode)(" 势力范围 "),l.value.势力范围详情?((0,r.openBlock)(),(0,r.createElementBlock)("div",U3,[(0,r.createElementVNode)("h5",q3,[(0,r.createVNode)((0,r.unref)(ku),{size:16}),t[25]||(t[25]=(0,r.createElementVNode)("span",null,"势力范围",-1))]),(0,r.createElementVNode)("div",G3,[(0,r.createElementVNode)("div",H3,[t[26]||(t[26]=(0,r.createElementVNode)("strong",null,"影响范围：",-1)),(0,r.createTextVNode)((0,r.toDisplayString)(l.value.势力范围详情.影响范围||"未知"),1)]),l.value.势力范围详情.控制区域?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",Y3,[t[27]||(t[27]=(0,r.createElementVNode)("strong",null,"控制区域：",-1)),(0,r.createElementVNode)("div",W3,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.势力范围详情.控制区域,e=>((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:e,class:"area-tag"},(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",X3,[t[28]||(t[28]=(0,r.createElementVNode)("strong",null,"战略价值：",-1)),(0,r.createElementVNode)("div",J3,[(0,r.createElementVNode)("div",K3,[(0,r.createElementVNode)("div",{class:"value-fill",style:(0,r.normalizeStyle)({width:10*(l.value.势力范围详情.战略价值||5)+"%"})},null,4)]),(0,r.createElementVNode)("span",Z3,(0,r.toDisplayString)(l.value.势力范围详情.战略价值||5)+"/10",1)])])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 加入条件 "),l.value.可否加入?((0,r.openBlock)(),(0,r.createElementBlock)("div",Q3,[(0,r.createElementVNode)("h5",e8,[(0,r.createVNode)((0,r.unref)(r6),{size:16}),t[29]||(t[29]=(0,r.createElementVNode)("span",null,"加入条件",-1))]),(0,r.createElementVNode)("div",t8,[l.value.加入条件?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",n8,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.加入条件,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"requirement-item"},[(0,r.createVNode)((0,r.unref)(o6),{size:14,class:"requirement-icon"}),(0,r.createElementVNode)("span",a8,(0,r.toDisplayString)(e),1)]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",r8,t[30]||(t[30]=[(0,r.createElementVNode)("p",null,"暂无特殊加入条件",-1)])))]),(0,r.createCommentVNode)(" 加入好处 "),l.value.加入好处?.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",o8,[t[31]||(t[31]=(0,r.createElementVNode)("h6",{class:"benefits-title"},"加入好处",-1)),(0,r.createElementVNode)("div",i8,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value.加入好处,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e,class:"benefit-item"},[(0,r.createVNode)((0,r.unref)(i6),{size:14,class:"benefit-icon"}),(0,r.createElementVNode)("span",s8,(0,r.toDisplayString)(e),1)]))),128))])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 加入按钮 "),(0,r.createElementVNode)("div",l8,[(0,r.createElementVNode)("button",{class:"join-btn",onClick:t[1]||(t[1]=e=>(e=>{if(!e.可否加入)return void X.o.warning("该宗门暂不接受加入");const t=p.value?.宗门名称;if(t===e.名称)return void X.o.info(`你已加入 ${e.名称}`);if(t&&t!==e.名称){if(!_(t,e.名称))return;C(t)}const{sectSystem:a,memberInfo:r}=(e=>{const t=(new Date).toISOString(),n=e.名称,a=String(h6(n)),r=(e=>{let t=e%2147483647;return t<=0&&(t+=2147483646),()=>(t=48271*t%2147483647,t/2147483647)})(h6(`${n}_${t}`)),o={宗门名称:n,宗门类型:(i=String(e.类型||"正道宗门"),/魔道|魔/i.test(i)?"魔道宗门":/散修联盟|散修|联盟/i.test(i)?"散修联盟":/中立/i.test(i)?"中立宗门":/世家|门阀|家族/i.test(i)?"世家":/商会|商盟|商号/i.test(i)?"商会":"正道宗门"),职位:"外门弟子",贡献:0,关系:"友好",声望:0,加入日期:t,描述:e.描述||""};var i;return{sectSystem:{版本:2,当前宗门:n,宗门档案:{[n]:e},宗门成员:{},宗门藏经阁:{[n]:x6(e,r,a)},宗门贡献商店:{[n]:y6(e,r,a)}},memberInfo:o}})(e);n.updateState("sectMemberInfo",r),n.updateState("sectSystem",a),X.o.success(`已加入 ${e.名称}`)})(l.value))},[(0,r.createVNode)((0,r.unref)(r6),{size:16}),t[32]||(t[32]=(0,r.createElementVNode)("span",null,"申请加入",-1))])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" 已加入宗门信息 "),(a=l.value,p.value?.宗门名称===a.名称?((0,r.openBlock)(),(0,r.createElementBlock)("div",c8,[(0,r.createElementVNode)("h5",d8,[(0,r.createVNode)((0,r.unref)(s6),{size:16}),t[33]||(t[33]=(0,r.createElementVNode)("span",null,"我的宗门身份",-1))]),(0,r.createElementVNode)("div",u8,[(0,r.createElementVNode)("div",m8,[(0,r.createElementVNode)("div",p8,[t[34]||(t[34]=(0,r.createElementVNode)("span",{class:"status-label"},"职位",-1)),(0,r.createElementVNode)("span",g8,(0,r.toDisplayString)(p.value?.职位||"散修"),1)]),(0,r.createElementVNode)("div",h8,[t[35]||(t[35]=(0,r.createElementVNode)("span",{class:"status-label"},"贡献点",-1)),(0,r.createElementVNode)("span",f8,(0,r.toDisplayString)(p.value?.贡献||0),1)]),(0,r.createElementVNode)("div",v8,[t[36]||(t[36]=(0,r.createElementVNode)("span",{class:"status-label"},"声望",-1)),(0,r.createElementVNode)("span",b8,(0,r.toDisplayString)(p.value?.声望||0),1)]),(0,r.createElementVNode)("div",y8,[t[37]||(t[37]=(0,r.createElementVNode)("span",{class:"status-label"},"加入时间",-1)),(0,r.createElementVNode)("span",x8,(0,r.toDisplayString)(S(p.value?.加入日期)),1)])]),(0,r.createElementVNode)("div",k8,[(0,r.createElementVNode)("button",{class:"leave-btn",onClick:t[2]||(t[2]=e=>(e=>{const t=p.value?.宗门名称;t?_(t)&&(C(t),e?.名称&&l.value?.名称===e.名称&&(l.value=null)):X.o.info("尚未加入宗门")})(l.value))},[(0,r.createVNode)((0,r.unref)(mm),{size:16}),t[38]||(t[38]=(0,r.createElementVNode)("span",null,"退出宗门",-1))])])]),(0,r.createCommentVNode)(" 宗门功能 "),(0,r.createElementVNode)("div",w8,[t[42]||(t[42]=(0,r.createElementVNode)("h6",{class:"actions-title"},"宗门势力",-1)),(0,r.createElementVNode)("div",E8,[(0,r.createElementVNode)("button",{class:"sect-action-btn",onClick:A},[(0,r.createVNode)((0,r.unref)(Nu),{size:16}),t[39]||(t[39]=(0,r.createElementVNode)("span",null,"贡献兑换",-1))]),(0,r.createElementVNode)("button",{class:"sect-action-btn",onClick:D},[(0,r.createVNode)((0,r.unref)(l6),{size:16}),t[40]||(t[40]=(0,r.createElementVNode)("span",null,"宗门藏书",-1))]),(0,r.createElementVNode)("button",{class:"sect-action-btn",onClick:T},[(0,r.createVNode)((0,r.unref)(fu),{size:16}),t[41]||(t[41]=(0,r.createElementVNode)("span",null,"同门师兄弟",-1))])])])])):(0,r.createCommentVNode)("v-if",!0))])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",N8,[(0,r.createVNode)((0,r.unref)(a6),{size:64,class:"placeholder-icon"}),t[43]||(t[43]=(0,r.createElementVNode)("p",{class:"placeholder-text"},"选择一个宗门查看详细信息",-1)),t[44]||(t[44]=(0,r.createElementVNode)("p",{class:"placeholder-hint"},"尘世间的宗门势力等你探索",-1))]))])])])]);var a,o,m,g,I}}});var V8=n(3879),_8={};_8.styleTagTransform=k(),_8.setAttributes=v(),_8.insert=h().bind(null,"head"),_8.domAPI=p(),_8.insertStyleElement=y(),u()(V8.A,_8),V8.A&&V8.A.locals&&V8.A.locals;const C8=(0,N.A)(S8,[["__scopeId","data-v-de19f802"]]),A8={class:"sect-system-panel"},D8={class:"sect-tabs"},T8=["onClick"],B8={class:"sect-system-content"},I8=(0,r.defineComponent)({__name:"SectSystemPanel",setup(e){const t=(0,a.useRoute)(),n=(0,a.useRouter)(),o=(0,pu.useGameStateStore)(),i=(0,r.computed)(()=>{const e=o.sectMemberInfo;return e&&e.宗门名称}),s=[{name:"SectOverview",label:"宗门概览",icon:Eu,requireJoin:!1},{name:"SectMembers",label:"宗门成员",icon:fu,requireJoin:!0},{name:"SectLibrary",label:"宗门藏经",icon:vu.A,requireJoin:!0},{name:"SectContribution",label:"贡献兑换",icon:Nu,requireJoin:!0}],l=(0,r.computed)(()=>s.filter(e=>!e.requireJoin||i.value));return(e,a)=>{const o=(0,r.resolveComponent)("router-view");return(0,r.openBlock)(),(0,r.createElementBlock)("div",A8,[(0,r.createElementVNode)("div",D8,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("button",{key:e.name,class:(0,r.normalizeClass)(["sect-tab",{active:(a=e.name,String(t.name)===a)}]),onClick:t=>(e=>{n.push({name:e})})(e.name)},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:14})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.label),1)],10,T8);var a}),128))]),(0,r.createElementVNode)("div",B8,[(0,r.createVNode)(o)])])}}});var z8=n(9715),M8={};M8.styleTagTransform=k(),M8.setAttributes=v(),M8.insert=h().bind(null,"head"),M8.domAPI=p(),M8.insertStyleElement=y(),u()(z8.A,M8),z8.A&&z8.A.locals&&z8.A.locals;const P8=(0,N.A)(I8,[["__scopeId","data-v-8db46224"]]);var R8=n(7754);const $8=(0,V.A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),O8=(0,V.A)("swords",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]]);var L8=n(5976);const F8={class:"sect-members"},j8={class:"player-info-bar"},U8={class:"info-item"},q8={class:"info-value sect-name"},G8={class:"info-item"},H8={class:"info-value position"},Y8={class:"member-tabs"},W8=["onClick"],X8={key:0,class:"count-badge"},J8={class:"member-list"},K8={key:0,class:"empty-state"},Z8={key:1,class:"members"},Q8=["onClick"],e4={class:"member-avatar"},t4={class:"avatar-text"},n4={class:"member-info"},a4={class:"member-header"},r4={class:"member-name"},o4={class:"member-details"},i4={class:"detail-item realm"},s4={class:"quick-actions"},l4={class:"actions-title"},c4={class:"action-buttons"},d4={class:"members-notice"},u4=(0,r.defineComponent)({__name:"SectMembersContent",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,r.ref)("all"),a=[{key:"all",label:"全部",icon:fu},{key:"长老",label:"长老",icon:s6},{key:"真传",label:"真传",icon:R8.A},{key:"同辈",label:"同辈",icon:_}],o=(0,r.computed)(()=>t.sectMemberInfo),i=(0,r.computed)(()=>o.value?.宗门名称||"未加入宗门"),s=(0,r.computed)(()=>o.value?.职位||"散修"),l=(0,r.computed)(()=>{const e=t.relationships||{};return Object.entries(e).filter(([e,t])=>(t.势力归属||t.宗门)===i.value).map(([e,t])=>{return{id:e,name:t.名字||e,gender:t.性别||"男",position:t.职位||"弟子",realm:(a=t.境界,a?"string"==typeof a?a:"object"==typeof a?`${a.名称||""}${a.阶段||""}`:"未知":"未知"),relation:u(t.好感度),favorability:t.好感度||50,isSelf:!1,category:(n=t.职位,n?n.includes("长老")||n.includes("太上")?"长老":n.includes("真传")||n.includes("核心")?"真传":"同辈":"同辈")};var n,a})}),c=(0,r.computed)(()=>"all"===n.value?l.value:l.value.filter(e=>e.category===n.value));function d(e){return"all"===e?l.value.length:l.value.filter(t=>t.category===e).length}function u(e){const t=e||50;return t>=90?"挚友":t>=75?"好友":t>=60?"友好":t>=40?"普通":t>=20?"冷淡":"敌视"}function m(e){Kw(e),X.o.success("已发送到对话")}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",F8,[(0,r.createCommentVNode)(" 玩家信息栏 "),(0,r.createElementVNode)("div",j8,[(0,r.createElementVNode)("div",U8,[t[5]||(t[5]=(0,r.createElementVNode)("span",{class:"info-label"},"所属宗门",-1)),(0,r.createElementVNode)("span",q8,(0,r.toDisplayString)(i.value),1)]),(0,r.createElementVNode)("div",G8,[t[6]||(t[6]=(0,r.createElementVNode)("span",{class:"info-label"},"我的职位",-1)),(0,r.createElementVNode)("span",H8,(0,r.toDisplayString)(s.value),1)])]),(0,r.createCommentVNode)(" 成员分类 "),(0,r.createElementVNode)("div",Y8,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a,e=>(0,r.createElementVNode)("button",{key:e.key,class:(0,r.normalizeClass)(["tab-btn",{active:n.value===e.key}]),onClick:t=>n.value=e.key},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:14})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.label),1),d(e.key)>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",X8,(0,r.toDisplayString)(d(e.key)),1)):(0,r.createCommentVNode)("v-if",!0)],10,W8)),64))]),(0,r.createCommentVNode)(" 成员列表 "),(0,r.createElementVNode)("div",J8,[0===c.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",K8,[(0,r.createVNode)((0,r.unref)(fu),{size:48,class:"empty-icon"}),t[8]||(t[8]=(0,r.createElementVNode)("p",{class:"empty-text"},"暂无同门信息",-1)),t[9]||(t[9]=(0,r.createElementVNode)("p",{class:"empty-hint"},"同门信息由AI根据剧情生成",-1)),(0,r.createElementVNode)("button",{class:"ask-btn",onClick:t[0]||(t[0]=e=>m("请告诉我宗门有哪些师兄弟姐妹"))},[(0,r.createVNode)((0,r.unref)($8),{size:14}),t[7]||(t[7]=(0,r.createElementVNode)("span",null,"询问同门信息",-1))])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Z8,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(c.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:(0,r.normalizeClass)(["member-card",{"is-self":e.isSelf}]),onClick:t=>function(e){m(`我想和${e.name}交谈`)}(e)},[(0,r.createElementVNode)("div",e4,[(0,r.createElementVNode)("span",t4,(0,r.toDisplayString)(e.name.charAt(0)),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["gender-badge","女"===e.gender?"female":"male"])},(0,r.toDisplayString)("女"===e.gender?"♀":"♂"),3)]),(0,r.createElementVNode)("div",n4,[(0,r.createElementVNode)("div",a4,[(0,r.createElementVNode)("span",r4,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["member-position",(n=e.position,n.includes("长老")?"position-elder":n.includes("真传")?"position-true":n.includes("内门")?"position-inner":"position-outer")])},(0,r.toDisplayString)(e.position),3)]),(0,r.createElementVNode)("div",o4,[(0,r.createElementVNode)("span",i4,[(0,r.createVNode)((0,r.unref)(bu),{size:12}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.realm),1)]),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["detail-item relation",(t=e.relation,{挚友:"relation-best",好友:"relation-good",友好:"relation-friendly",普通:"relation-normal",冷淡:"relation-cold",敌视:"relation-hostile"}[t]||"relation-normal")])},[(0,r.createVNode)((0,r.unref)(Xp),{size:12}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.relation),1)],2)])]),(0,r.createVNode)((0,r.unref)(dm),{size:16,class:"arrow-icon"})],10,Q8);var t,n}),128))]))]),(0,r.createCommentVNode)(" 快捷操作 "),(0,r.createElementVNode)("div",s4,[(0,r.createElementVNode)("h4",l4,[(0,r.createVNode)((0,r.unref)($8),{size:14}),t[10]||(t[10]=(0,r.createElementVNode)("span",null,"快捷对话",-1))]),(0,r.createElementVNode)("div",c4,[(0,r.createElementVNode)("button",{class:"action-btn",onClick:t[1]||(t[1]=e=>m("我想找同门切磋修炼"))},[(0,r.createVNode)((0,r.unref)(O8),{size:14}),t[11]||(t[11]=(0,r.createElementVNode)("span",null,"邀请切磋",-1))]),(0,r.createElementVNode)("button",{class:"action-btn",onClick:t[2]||(t[2]=e=>m("我想请教师兄修炼心得"))},[(0,r.createVNode)((0,r.unref)(vu.A),{size:14}),t[12]||(t[12]=(0,r.createElementVNode)("span",null,"请教修炼",-1))]),(0,r.createElementVNode)("button",{class:"action-btn",onClick:t[3]||(t[3]=e=>m("我想和同门一起探险"))},[(0,r.createVNode)((0,r.unref)(Oq),{size:14}),t[13]||(t[13]=(0,r.createElementVNode)("span",null,"组队探险",-1))]),(0,r.createElementVNode)("button",{class:"action-btn",onClick:t[4]||(t[4]=e=>m("我想了解宗门最近有什么消息"))},[(0,r.createVNode)((0,r.unref)(wu),{size:14}),t[14]||(t[14]=(0,r.createElementVNode)("span",null,"宗门消息",-1))])])]),(0,r.createCommentVNode)(" 提示信息 "),(0,r.createElementVNode)("div",d4,[(0,r.createVNode)((0,r.unref)(L8.A),{size:14}),t[15]||(t[15]=(0,r.createElementVNode)("span",null,"同门关系会影响游戏发展，可在对话中与同门互动",-1))])]))}});var m4=n(6477),p4={};p4.styleTagTransform=k(),p4.setAttributes=v(),p4.insert=h().bind(null,"head"),p4.domAPI=p(),p4.insertStyleElement=y(),u()(m4.A,p4),m4.A&&m4.A.locals&&m4.A.locals;const g4=(0,N.A)(u4,[["__scopeId","data-v-659283e6"]]),h4={class:"sect-library"},f4={class:"player-info-bar"},v4={class:"info-item"},b4={class:"info-value position"},y4={class:"info-item"},x4={class:"info-value contribution"},k4={class:"library-floors"},w4=["onClick"],E4={class:"floor-info"},N4={class:"floor-icon"},S4={class:"floor-name"},V4={class:"floor-requirement"},_4={class:"floor-status"},C4={key:0,class:"floor-content"},A4={key:0,class:"empty-floor"},D4={key:1,class:"technique-list"},T4={class:"tech-header"},B4={class:"tech-name"},I4={class:"tech-desc"},z4={class:"tech-footer"},M4={class:"tech-cost"},P4=["disabled","onClick"],R4={key:1,class:"owned-badge"},$4={class:"library-tips"},O4=(0,r.defineComponent)({__name:"SectLibraryContent",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,r.ref)(1),a={记名弟子:0,外门弟子:1,内门弟子:2,真传弟子:3,核心弟子:4,长老:5,太上长老:6},o=(0,r.computed)(()=>t.sectMemberInfo),i=(0,r.computed)(()=>o.value?.职位||"散修"),s=(0,r.computed)(()=>o.value?.贡献||0),l=(0,r.computed)(()=>a[i.value]??-1),c=(0,r.computed)(()=>{const e=t.inventory?.物品||{};return Object.values(e).filter(e=>"功法"===e.类型).map(e=>e.物品ID)}),d=(0,r.computed)(()=>{const e=function(){const e=o.value?.宗门名称;if(!e)return[];const n=t.sectSystem?.宗门藏经阁?.[e];return Array.isArray(n)?n.map((e,t)=>{const n=e?.id||e?.物品ID||`sect_tech_${t}`,a=e?.name||e?.名称||"未知功法",r=e?.quality||e?.品质||"凡品",o=e?.qualityTier||(e=>{const t=e.match(/[凡黄玄地天仙神]/);return t?t[0]:"凡"})(String(r)),i=Number(e?.cost??e?.价格??0);return{id:n,name:a,quality:r,qualityTier:o,cost:i,description:e?.description||e?.描述||"",owned:c.value.includes(n),canAfford:s.value>=i}}):[]}();return[{level:1,name:"第一层",icon:"📖",requirement:"外门弟子可入",minPosition:1,accessible:l.value>=1,techniques:e.filter(e=>["凡","黄"].includes(e.qualityTier))},{level:2,name:"第二层",icon:"📚",requirement:"内门弟子可入",minPosition:2,accessible:l.value>=2,techniques:e.filter(e=>"玄"===e.qualityTier)},{level:3,name:"第三层",icon:"📜",requirement:"真传弟子可入",minPosition:3,accessible:l.value>=3,techniques:e.filter(e=>"地"===e.qualityTier)},{level:4,name:"禁区密库",icon:"🔮",requirement:"核心弟子+长老令牌",minPosition:4,accessible:l.value>=4,techniques:e.filter(e=>["天","仙","神"].includes(e.qualityTier))}]});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",h4,[(0,r.createCommentVNode)(" 玩家信息栏 "),(0,r.createElementVNode)("div",f4,[(0,r.createElementVNode)("div",v4,[t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"info-label"},"职位",-1)),(0,r.createElementVNode)("span",b4,(0,r.toDisplayString)(i.value),1)]),(0,r.createElementVNode)("div",y4,[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"info-label"},"贡献点",-1)),(0,r.createElementVNode)("span",x4,(0,r.toDisplayString)(s.value),1)])]),(0,r.createCommentVNode)(" 藏经阁分层 "),(0,r.createElementVNode)("div",k4,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.level,class:(0,r.normalizeClass)(["floor-section",{locked:!e.accessible,expanded:n.value===e.level}])},[(0,r.createElementVNode)("div",{class:"floor-header",onClick:t=>function(e){e.accessible?n.value=n.value===e.level?null:e.level:X.o.warning("职位不足，无法进入此层")}(e)},[(0,r.createElementVNode)("div",E4,[(0,r.createElementVNode)("span",N4,(0,r.toDisplayString)(e.icon),1),(0,r.createElementVNode)("span",S4,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",V4,(0,r.toDisplayString)(e.requirement),1)]),(0,r.createElementVNode)("div",_4,[e.accessible?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(qw),{key:1,size:16,class:(0,r.normalizeClass)({rotated:n.value===e.level})},null,8,["class"])):((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(kC),{key:0,size:16}))])],8,w4),(0,r.createVNode)(r.Transition,{name:"slide"},{default:(0,r.withCtx)(()=>[n.value===e.level&&e.accessible?((0,r.openBlock)(),(0,r.createElementBlock)("div",C4,[0===e.techniques.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",A4,[(0,r.createVNode)((0,r.unref)(vu.A),{size:32,class:"empty-icon"}),t[2]||(t[2]=(0,r.createElementVNode)("p",null,"此层暂无可学功法",-1)),t[3]||(t[3]=(0,r.createElementVNode)("p",{class:"hint"},"功法将由AI根据剧情生成",-1))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",D4,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.techniques,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:(0,r.normalizeClass)(["technique-card",{owned:e.owned,"can-afford":e.canAfford&&!e.owned}])},[(0,r.createElementVNode)("div",T4,[(0,r.createElementVNode)("span",B4,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["tech-quality",(t=e.quality,t.includes("凡")?"quality-common":t.includes("黄")?"quality-yellow":t.includes("玄")?"quality-xuan":t.includes("地")?"quality-earth":t.includes("天")?"quality-heaven":"quality-common")])},(0,r.toDisplayString)(e.quality),3)]),(0,r.createElementVNode)("p",I4,(0,r.toDisplayString)(e.description),1),(0,r.createElementVNode)("div",z4,[(0,r.createElementVNode)("span",M4,[(0,r.createVNode)((0,r.unref)(Nu),{size:14}),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.cost)+" 贡献 ",1)]),e.owned?((0,r.openBlock)(),(0,r.createElementBlock)("span",R4,"已学习")):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"learn-btn",disabled:!e.canAfford,onClick:t=>function(e){Kw(`我想用${e.cost}贡献点在藏经阁学习「${e.name}」`),X.o.success("已发送到对话")}(e)},(0,r.toDisplayString)(e.canAfford?"学习":"贡献不足"),9,P4))])],2);var t}),128))]))])):(0,r.createCommentVNode)("v-if",!0)]),_:2},1024)],2))),128))]),(0,r.createCommentVNode)(" 提示信息 "),(0,r.createElementVNode)("div",$4,[(0,r.createVNode)((0,r.unref)(L8.A),{size:14}),t[4]||(t[4]=(0,r.createElementVNode)("span",null,"功法需要通过游戏剧情获取或让AI生成，此处展示已有功法供兑换学习",-1))])]))}});var L4=n(2445),F4={};F4.styleTagTransform=k(),F4.setAttributes=v(),F4.insert=h().bind(null,"head"),F4.domAPI=p(),F4.insertStyleElement=y(),u()(L4.A,F4),L4.A&&L4.A.locals&&L4.A.locals;const j4=(0,N.A)(O4,[["__scopeId","data-v-8e5c2630"]]),U4=(0,V.A)("pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),q4=(0,V.A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),G4=(0,V.A)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),H4={class:"sect-contribution"},Y4={class:"player-info-bar"},W4={class:"info-item"},X4={class:"info-value position"},J4={class:"info-item highlight"},K4={class:"info-value contribution"},Z4={class:"exchange-tabs"},Q4=["onClick"],e7={class:"exchange-list"},t7={key:0,class:"empty-state"},n7={key:1,class:"items-grid"},a7={class:"item-header"},r7={class:"item-icon"},o7={class:"item-info"},i7={class:"item-name"},s7={class:"item-desc"},l7={class:"item-footer"},c7={class:"item-cost"},d7={key:0,class:"item-stock"},u7=["disabled","onClick"],m7={class:"contribution-tips"},p7={class:"tips-title"},g7={class:"tips-list"},h7={class:"tip-item"},f7={class:"tip-item"},v7={class:"tip-item"},b7={class:"tip-item"},y7={class:"exchange-notice"},x7=(0,r.defineComponent)({__name:"SectContributionContent",setup(e){const t=(0,pu.useGameStateStore)(),n=(0,r.ref)("all"),a=[{key:"all",label:"全部",icon:gu},{key:"丹药",label:"丹药",icon:U4},{key:"功法",label:"功法",icon:vu.A},{key:"装备",label:"装备",icon:AP},{key:"材料",label:"材料",icon:DP}],o=(0,r.computed)(()=>t.sectMemberInfo),i=(0,r.computed)(()=>o.value?.职位||"散修"),s=(0,r.computed)(()=>o.value?.贡献||0),l=(e,t)=>({id:e?.id||e?.物品ID||`sect_item_${t}`,name:e?.name||e?.名称||"未知物品",icon:e?.icon||"O",type:e?.type||e?.类型||"其他",quality:e?.quality||e?.品质||"凡品",description:e?.description||e?.描述||"",cost:Number(e?.cost??e?.价格??0),stock:e?.stock??e?.库存}),c=(0,r.computed)(()=>{const e=o.value?.宗门名称;if(!e)return[];const n=t.sectSystem?.宗门贡献商店?.[e];return Array.isArray(n)?n.map(l):[]}),d=(0,r.computed)(()=>"all"===n.value?c.value:c.value.filter(e=>e.type===n.value));function u(e){return 0===e.stock?"已售罄":s.value<e.cost?"贡献不足":"兑换"}function m(e){Kw(e),X.o.success("已发送到对话")}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",H4,[(0,r.createCommentVNode)(" 玩家信息栏 "),(0,r.createElementVNode)("div",Y4,[(0,r.createElementVNode)("div",W4,[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"info-label"},"职位",-1)),(0,r.createElementVNode)("span",X4,(0,r.toDisplayString)(i.value),1)]),(0,r.createElementVNode)("div",J4,[t[2]||(t[2]=(0,r.createElementVNode)("span",{class:"info-label"},"可用贡献点",-1)),(0,r.createElementVNode)("span",K4,(0,r.toDisplayString)(s.value),1)])]),(0,r.createCommentVNode)(" 兑换分类 "),(0,r.createElementVNode)("div",Z4,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a,e=>(0,r.createElementVNode)("button",{key:e.key,class:(0,r.normalizeClass)(["tab-btn",{active:n.value===e.key}]),onClick:t=>n.value=e.key},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.icon),{size:14})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.label),1)],10,Q4)),64))]),(0,r.createCommentVNode)(" 兑换物品列表 "),(0,r.createElementVNode)("div",e7,[0===d.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",t7,[(0,r.createVNode)((0,r.unref)(gu),{size:48,class:"empty-icon"}),t[4]||(t[4]=(0,r.createElementVNode)("p",{class:"empty-text"},"暂无可兑换物品",-1)),t[5]||(t[5]=(0,r.createElementVNode)("p",{class:"empty-hint"},"可兑换物品由AI根据宗门设定生成",-1)),(0,r.createElementVNode)("button",{class:"ask-btn",onClick:t[0]||(t[0]=e=>m("请告诉我宗门贡献可以兑换什么物品"))},[(0,r.createVNode)((0,r.unref)($8),{size:14}),t[3]||(t[3]=(0,r.createElementVNode)("span",null,"询问可兑换物品",-1))])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",n7,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.id,class:(0,r.normalizeClass)(["item-card",{"can-afford":s.value>=e.cost,"out-of-stock":0===e.stock}])},[(0,r.createElementVNode)("div",a7,[(0,r.createElementVNode)("span",r7,(0,r.toDisplayString)(e.icon),1),(0,r.createElementVNode)("div",o7,[(0,r.createElementVNode)("span",i7,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["item-quality",(t=e.quality,t.includes("凡")?"quality-common":t.includes("黄")?"quality-yellow":t.includes("玄")?"quality-xuan":t.includes("地")?"quality-earth":t.includes("天")?"quality-heaven":"quality-common")])},(0,r.toDisplayString)(e.quality),3)])]),(0,r.createElementVNode)("p",s7,(0,r.toDisplayString)(e.description),1),(0,r.createElementVNode)("div",l7,[(0,r.createElementVNode)("div",c7,[(0,r.createVNode)((0,r.unref)(Nu),{size:14}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.cost)+" 贡献",1)]),void 0!==e.stock?((0,r.openBlock)(),(0,r.createElementBlock)("div",d7,[(0,r.createVNode)((0,r.unref)(gu),{size:12}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.stock>0?`剩余 ${e.stock}`:"已售罄"),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("button",{class:"exchange-btn",disabled:s.value<e.cost||0===e.stock,onClick:t=>function(e){m(`我想用${e.cost}贡献点兑换「${e.name}」`)}(e)},[(0,r.createVNode)((0,r.unref)(q4),{size:14}),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(u(e)),1)],8,u7)],2);var t}),128))]))]),(0,r.createCommentVNode)(" 贡献获取途径 "),(0,r.createElementVNode)("div",m7,[(0,r.createElementVNode)("h4",p7,[(0,r.createVNode)((0,r.unref)(G4),{size:14}),t[6]||(t[6]=(0,r.createElementVNode)("span",null,"贡献点获取途径",-1))]),(0,r.createElementVNode)("div",g7,[(0,r.createElementVNode)("div",h7,[(0,r.createVNode)((0,r.unref)(yu),{size:12}),t[7]||(t[7]=(0,r.createElementVNode)("span",null,"参与宗门事务",-1))]),(0,r.createElementVNode)("div",f7,[(0,r.createVNode)((0,r.unref)(gu),{size:12}),t[8]||(t[8]=(0,r.createElementVNode)("span",null,"上交珍稀资源",-1))]),(0,r.createElementVNode)("div",v7,[(0,r.createVNode)((0,r.unref)(O8),{size:12}),t[9]||(t[9]=(0,r.createElementVNode)("span",null,"参与宗门战斗",-1))]),(0,r.createElementVNode)("div",b7,[(0,r.createVNode)((0,r.unref)(fu),{size:12}),t[10]||(t[10]=(0,r.createElementVNode)("span",null,"指导低阶弟子",-1))])])]),(0,r.createCommentVNode)(" 提示信息 "),(0,r.createElementVNode)("div",y7,[(0,r.createVNode)((0,r.unref)(L8.A),{size:14}),t[11]||(t[11]=(0,r.createElementVNode)("span",null,"点击兑换将直接发送到对话（由AI判定并执行兑换）",-1))])]))}});var k7=n(8992),w7={};w7.styleTagTransform=k(),w7.setAttributes=v(),w7.insert=h().bind(null,"head"),w7.domAPI=p(),w7.insertStyleElement=y(),u()(k7.A,w7),k7.A&&k7.A.locals&&k7.A.locals;const E7=(0,N.A)(x7,[["__scopeId","data-v-e42e724c"]]),N7={class:"game-variable-data-header"},S7={class:"panel-header"},V7={class:"panel-title"},_7={class:"header-actions"},C7={class:"search-bar"},A7=["value"],D7=(0,r.defineComponent)({__name:"GameVariableDataHeader",props:{searchQuery:{},isRefreshing:{type:Boolean}},emits:["update:search-query","show-format-guide","refresh","export","show-stats"],setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",N7,[(0,r.createElementVNode)("div",S7,[(0,r.createElementVNode)("h2",V7,[(0,r.createVNode)((0,r.unref)(Su),{size:20}),t[2]||(t[2]=(0,r.createElementVNode)("span",null,"游戏变量查看",-1))]),(0,r.createElementVNode)("div",_7,[(0,r.createElementVNode)("div",C7,[(0,r.createVNode)((0,r.unref)(TP),{size:16}),(0,r.createElementVNode)("input",{value:e.searchQuery,onInput:t[0]||(t[0]=t=>e.$emit("update:search-query",t.target.value)),placeholder:"搜索数据...",class:"search-input"},null,40,A7)]),(0,r.createElementVNode)("button",{class:"format-guide-btn",onClick:t[1]||(t[1]=t=>e.$emit("show-format-guide")),title:"查看数据格式说明"},[(0,r.createVNode)((0,r.unref)(vu.A),{size:16}),t[3]||(t[3]=(0,r.createElementVNode)("span",null,"格式说明",-1))])])])]))});var T7=n(6119),B7={};B7.styleTagTransform=k(),B7.setAttributes=v(),B7.insert=h().bind(null,"head"),B7.domAPI=p(),B7.insertStyleElement=y(),u()(T7.A,B7),T7.A&&T7.A.locals&&T7.A.locals;const I7=(0,N.A)(D7,[["__scopeId","data-v-759e00bb"]]),z7=(0,V.A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var M7=n(4091);const P7=(0,V.A)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),R7=(0,V.A)("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),$7={class:"data-type-selector"},O7=["onClick"],L7={key:0,class:"count-badge"},F7=(0,r.defineComponent)({__name:"GameVariableDataSelector",props:{dataTypes:{},selectedType:{},getDataCount:{type:Function}},emits:["update:selected-type"],setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",$7,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.dataTypes,t=>{return(0,r.openBlock)(),(0,r.createElementBlock)("button",{key:t.key,onClick:n=>e.$emit("update:selected-type",t.key),class:(0,r.normalizeClass)(["type-btn",{active:e.selectedType===t.key}])},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)((n=t.icon,{MessageSquare:z7,Globe:M7.A,Users:fu,Archive:P7,Book:l6,Brain:hu,Code:R7}[n]||R7)),{size:16})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(t.label),1),e.getDataCount(t.key)>0?((0,r.openBlock)(),(0,r.createElementBlock)("span",L7,(0,r.toDisplayString)(e.getDataCount(t.key)),1)):(0,r.createCommentVNode)("v-if",!0)],10,O7);var n}),128))]))});var j7=n(1703),U7={};U7.styleTagTransform=k(),U7.setAttributes=v(),U7.insert=h().bind(null,"head"),U7.domAPI=p(),U7.insertStyleElement=y(),u()(j7.A,U7),j7.A&&j7.A.locals&&j7.A.locals;const q7=(0,N.A)(F7,[["__scopeId","data-v-2d9375b2"]]),G7=(0,V.A)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),H7=(0,V.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Y7={class:"variable-section"},W7={class:"section-header"},X7={class:"section-title"},J7=["disabled"],K7={class:"variable-content"},Z7={key:0,class:"variable-list"},Q7={class:"variable-header"},e9={class:"variable-key"},t9={class:"variable-type"},n9={class:"variable-actions"},a9=["onClick","disabled"],r9=["onClick"],o9=["onClick","disabled"],i9={class:"variable-value"},s9={key:0,class:"code-pre"},l9={key:1},c9={key:1,class:"empty-state"},d9={key:0},u9={key:1},m9={class:"debug-info"},p9={class:"debug-content"},g9={class:"debug-actions"},h9=(0,r.defineComponent)({__name:"CustomOptionsSection",props:{type:{},variables:{},searchQuery:{},readOnly:{type:Boolean,default:!1},chatVariables:{},customOptions:{},coreDataViews:{}},emits:["edit-variable","copy-variable","delete-variable","add-new-variable","debug-log"],setup(e){const t=e=>null===e?"null":void 0===e?"undefined":Array.isArray(e)?`array[${e.length}]`:"object"==typeof e?`object{${Object.keys(e).length}}`:typeof e;return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Y7,[(0,r.createElementVNode)("div",W7,[(0,r.createElementVNode)("h3",X7,(0,r.toDisplayString)("chat"===e.type?"Chat Variables (聊天变量)":"core"===e.type?"Core Data (核心数据)":"Custom Options (自定义选项)"),1),(0,r.createElementVNode)("button",{onClick:n[0]||(n[0]=t=>e.$emit("add-new-variable",e.type)),class:"add-btn",disabled:e.readOnly},[(0,r.createVNode)((0,r.unref)(hH.A),{size:14}),n[2]||(n[2]=(0,r.createElementVNode)("span",null,"新增变量",-1))],8,J7)]),(0,r.createElementVNode)("div",K7,[Object.keys(e.variables).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Z7,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.variables,(n,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:a,class:"variable-item"},[(0,r.createElementVNode)("div",Q7,[(0,r.createElementVNode)("span",e9,(0,r.toDisplayString)(a),1),(0,r.createElementVNode)("span",t9,(0,r.toDisplayString)(t(n)),1),(0,r.createElementVNode)("div",n9,[(0,r.createElementVNode)("button",{onClick:t=>e.$emit("edit-variable",{type:e.type,key:a,value:n}),class:"action-btn edit",title:"编辑",disabled:e.readOnly},[(0,r.createVNode)((0,r.unref)(G7),{size:12})],8,a9),(0,r.createElementVNode)("button",{onClick:t=>e.$emit("copy-variable",{key:a,value:n}),class:"action-btn copy",title:"复制"},[(0,r.createVNode)((0,r.unref)(H7),{size:12})],8,r9),(0,r.createElementVNode)("button",{onClick:t=>e.$emit("delete-variable",{type:e.type,key:a}),class:"action-btn delete",title:"删除",disabled:e.readOnly},[(0,r.createVNode)((0,r.unref)(Yn.A),{size:12})],8,o9)])]),(0,r.createElementVNode)("div",i9,["object"==typeof n?((0,r.openBlock)(),(0,r.createElementBlock)("pre",s9,(0,r.toDisplayString)(JSON.stringify(n,null,2)),1)):((0,r.openBlock)(),(0,r.createElementBlock)("span",l9,(0,r.toDisplayString)(n),1))])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",c9,[(0,r.createVNode)((0,r.unref)(gu),{size:32}),e.searchQuery?((0,r.openBlock)(),(0,r.createElementBlock)("p",d9,"无匹配的变量")):((0,r.openBlock)(),(0,r.createElementBlock)("p",u9,(0,r.toDisplayString)("chat"===e.type?"暂无聊天变量":"core"===e.type?"暂无核心数据":"暂无自定义选项"),1)),(0,r.createElementVNode)("div",m9,[(0,r.createElementVNode)("details",null,[n[5]||(n[5]=(0,r.createElementVNode)("summary",null,"🔍 调试信息 (点击展开)",-1)),(0,r.createElementVNode)("div",p9,[n[4]||(n[4]=(0,r.createElementVNode)("p",null,[(0,r.createElementVNode)("strong",null,"连接状态:"),(0,r.createTextVNode)(" ✅已连接")],-1)),(0,r.createElementVNode)("p",null,[n[3]||(n[3]=(0,r.createElementVNode)("strong",null,"变量数量:",-1)),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(Object.keys(e.variables).length),1)]),(0,r.createElementVNode)("div",g9,[(0,r.createElementVNode)("button",{onClick:n[1]||(n[1]=t=>e.$emit("debug-log")),class:"debug-btn"}," 🖼️ 控制台输出 ")])])])])]))])]))}});var f9=n(4515),v9={};v9.styleTagTransform=k(),v9.setAttributes=v(),v9.insert=h().bind(null,"head"),v9.domAPI=p(),v9.insertStyleElement=y(),u()(f9.A,v9),f9.A&&f9.A.locals&&f9.A.locals;const b9=(0,N.A)(h9,[["__scopeId","data-v-510a4b50"]]),y9={class:"character-section"},x9={key:0,class:"character-info"},k9={class:"info-grid"},w9={class:"info-item"},E9={class:"info-value"},N9={class:"info-item"},S9={class:"info-value"},V9={class:"data-detail"},_9={class:"code-pre"},C9={key:1,class:"empty-state"},A9=(0,r.defineComponent)({__name:"GameVariableCharacterSection",props:{characterData:{}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",y9,[t[4]||(t[4]=(0,r.createElementVNode)("div",{class:"section-header"},[(0,r.createElementVNode)("h3",{class:"section-title"},"Character Data (角色数据)")],-1)),e.characterData?((0,r.openBlock)(),(0,r.createElementBlock)("div",x9,[(0,r.createElementVNode)("div",k9,[(0,r.createElementVNode)("div",w9,[t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"info-label"},"角色名称:",-1)),(0,r.createElementVNode)("span",E9,(0,r.toDisplayString)(e.characterData?.name||e.characterData?.名字||"未知"),1)]),(0,r.createElementVNode)("div",N9,[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"info-label"},"角色ID:",-1)),(0,r.createElementVNode)("span",S9,(0,r.toDisplayString)(e.characterData?.id||"未知"),1)])]),(0,r.createElementVNode)("div",V9,[t[2]||(t[2]=(0,r.createElementVNode)("h4",{class:"detail-title"},"完整角色数据:",-1)),(0,r.createElementVNode)("pre",_9,(0,r.toDisplayString)(JSON.stringify(e.characterData,null,2)),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",C9,[(0,r.createVNode)((0,r.unref)(fu),{size:32}),t[3]||(t[3]=(0,r.createElementVNode)("p",null,"暂无角色数据",-1))]))]))});var D9=n(3509),T9={};T9.styleTagTransform=k(),T9.setAttributes=v(),T9.insert=h().bind(null,"head"),T9.domAPI=p(),T9.insertStyleElement=y(),u()(D9.A,T9),D9.A&&D9.A.locals&&D9.A.locals;const B9=(0,N.A)(A9,[["__scopeId","data-v-6cf48088"]]),I9={class:"save-data-section"},z9={class:"save-data-content"},M9={key:0,class:"data-tree"},P9={key:1,class:"empty-state"},R9=(0,r.defineComponent)({__name:"GameVariableSaveDataSection",props:{saveData:{},readOnly:{type:Boolean,default:!1}},emits:["edit-variable"],setup(e,{emit:t}){const a=(0,r.defineAsyncComponent)(()=>Promise.resolve().then(n.bind(n,1419))),o=e,i=t,s=(0,pu.useGameStateStore)(),l=(0,r.computed)(()=>{const e=o.saveData??{},t=(0,Zc.ru)(e)?e:(0,Zc.jj)(e).migrated;return{元数据:t.元数据,角色:t.角色,社交:t.社交,世界:t.世界,系统:t.系统}}),c=(e,t)=>{o.readOnly?X.o.warning("联机模式下不允许直接修改存档数据（服务器权威控制）"):i("edit-variable",{type:"saveData",key:e,value:t})},d=async e=>{if(o.readOnly)X.o.warning("联机模式下不允许直接删除存档数据（服务器权威控制）");else if(nV.Yz.log("[TavernSaveData]",`请求删除: ${e}`),confirm(`确定要删除此项目吗？\n路径: ${e}\n\n此操作不可撤销！`))try{const t=e.split("."),n=e.startsWith("角色.背包.物品.")&&4===t.length,a=e.startsWith("社交.关系.")&&3===t.length;if(!n&&!a)return void X.o.warning("该路径暂不支持删除，请通过游戏内操作处理");if(n){const e=t[3],n=s.inventory;if(!n?.物品?.[e])throw new Error(`物品不存在: ${e}`);const a=JSON.parse(JSON.stringify(n));delete a.物品[e],s.updateState("inventory",a)}else{const e=t[2],n=s.relationships;if(!n?.[e])throw new Error(`NPC不存在: ${e}`);const a=JSON.parse(JSON.stringify(n));delete a[e],s.updateState("relationships",a)}await s.saveGame(),X.o.success(`项目 ${e} 已删除`),nV.Yz.log("[TavernSaveData]",`成功删除并同步: ${e}`)}catch(e){nV.Yz.error("[TavernSaveData]","删除失败",e),X.o.error(`删除失败: ${e instanceof Error?e.message:"未知错误"}`)}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",I9,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"section-header"},[(0,r.createElementVNode)("h3",{class:"section-title"},"Save Data (存档数据)")],-1)),(0,r.createElementVNode)("div",z9,[l.value&&Object.keys(l.value).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",M9,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,(t,n)=>((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(a),{key:n,"node-key":n,value:t,path:String(n),"read-only":e.readOnly,onDeleteItem:d,onEditItem:c},null,8,["node-key","value","path","read-only"]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",P9,[(0,r.createVNode)((0,r.unref)(P7),{size:32}),t[0]||(t[0]=(0,r.createElementVNode)("p",null,"暂无存档数据",-1))]))])]))}});var $9=n(7986),O9={};O9.styleTagTransform=k(),O9.setAttributes=v(),O9.insert=h().bind(null,"head"),O9.domAPI=p(),O9.insertStyleElement=y(),u()($9.A,O9),$9.A&&$9.A.locals&&$9.A.locals;const L9=(0,N.A)(R9,[["__scopeId","data-v-68cac9c5"]]),F9={class:"world-info-section"},j9={class:"world-info-content"},U9={key:0,class:"data-display"},q9={class:"code-pre"},G9={key:1,class:"empty-state"},H9=(0,r.defineComponent)({__name:"GameVariableWorldInfoSection",props:{worldInfo:{}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",F9,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"section-header"},[(0,r.createElementVNode)("h3",{class:"section-title"},"World Info (世界信息)")],-1)),(0,r.createElementVNode)("div",j9,[e.worldInfo&&Object.keys(e.worldInfo).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",U9,[(0,r.createElementVNode)("pre",q9,(0,r.toDisplayString)(JSON.stringify(e.worldInfo,null,2)),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",G9,[(0,r.createVNode)((0,r.unref)(l6),{size:32}),t[0]||(t[0]=(0,r.createElementVNode)("p",null,"暂无世界信息",-1))]))])]))});var Y9=n(2748),W9={};W9.styleTagTransform=k(),W9.setAttributes=v(),W9.insert=h().bind(null,"head"),W9.domAPI=p(),W9.insertStyleElement=y(),u()(Y9.A,W9),Y9.A&&Y9.A.locals&&Y9.A.locals;const X9=(0,N.A)(H9,[["__scopeId","data-v-dbebcd90"]]),J9={class:"memory-section"},K9={class:"memory-content"},Z9={key:0,class:"data-display"},Q9={class:"code-pre"},eee={key:1,class:"empty-state"},tee=(0,r.defineComponent)({__name:"GameVariableMemorySection",props:{memoryData:{}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",J9,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"section-header"},[(0,r.createElementVNode)("h3",{class:"section-title"},"Memory Data (记忆数据)")],-1)),(0,r.createElementVNode)("div",K9,[e.memoryData&&Object.keys(e.memoryData).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Z9,[(0,r.createElementVNode)("pre",Q9,(0,r.toDisplayString)(JSON.stringify(e.memoryData,null,2)),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",eee,[(0,r.createVNode)((0,r.unref)(hu),{size:32}),t[0]||(t[0]=(0,r.createElementVNode)("p",null,"暂无记忆数据",-1))]))])]))});var nee=n(8092),aee={};aee.styleTagTransform=k(),aee.setAttributes=v(),aee.insert=h().bind(null,"head"),aee.domAPI=p(),aee.insertStyleElement=y(),u()(nee.A,aee),nee.A&&nee.A.locals&&nee.A.locals;const ree=(0,N.A)(tee,[["__scopeId","data-v-04e0cd04"]]),oee={class:"raw-data-section"},iee={class:"raw-data-content"},see={key:0,class:"data-display"},lee={class:"code-pre"},cee={key:1,class:"empty-state"},dee=(0,r.defineComponent)({__name:"GameVariableRawDataSection",props:{allTavernData:{}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",oee,[t[1]||(t[1]=(0,r.createElementVNode)("div",{class:"section-header"},[(0,r.createElementVNode)("h3",{class:"section-title"},"Raw Data (原始数据)")],-1)),(0,r.createElementVNode)("div",iee,[e.allTavernData&&Object.keys(e.allTavernData).length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",see,[(0,r.createElementVNode)("pre",lee,(0,r.toDisplayString)(JSON.stringify(e.allTavernData,null,2)),1)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",cee,[(0,r.createVNode)((0,r.unref)(R7),{size:32}),t[0]||(t[0]=(0,r.createElementVNode)("p",null,"暂无原始数据",-1))]))])]))});var uee=n(1021),mee={};mee.styleTagTransform=k(),mee.setAttributes=v(),mee.insert=h().bind(null,"head"),mee.domAPI=p(),mee.insertStyleElement=y(),u()(uee.A,mee),uee.A&&uee.A.locals&&uee.A.locals;const pee=(0,N.A)(dee,[["__scopeId","data-v-2cab0dce"]]),gee={class:"data-display"},hee={key:0,class:"loading-state"},fee={key:1,class:"data-content"},vee={key:0,class:"error-state"},bee=(0,r.defineComponent)({__name:"GameVariableDataDisplay",props:{isLoading:{type:Boolean},selectedDataType:{},searchQuery:{},readOnly:{type:Boolean,default:!1},coreDataViews:{},customOptions:{},characterData:{},saveData:{},worldInfo:{},memoryData:{},allGameData:{},filteredCoreDataViews:{},filteredCustomOptions:{},filteredChatVariables:{}},emits:["edit-variable","copy-variable","delete-variable","add-new-variable","debug-log"],setup(e){const t=e,n=(0,r.ref)(!1),a=()=>{n.value=!1},o=()=>{switch(t.selectedDataType){case"core":case"custom":default:return b9;case"character":return B9;case"saveData":return L9;case"worldInfo":return X9;case"memory":return ree;case"raw":return pee}},i=()=>{const e={searchQuery:t.searchQuery,coreDataViews:t.coreDataViews||{},customOptions:t.customOptions||{},readOnly:t.readOnly};switch(t.selectedDataType){case"core":return{...e,type:"core",variables:t.filteredCoreDataViews||{}};case"custom":return{...e,type:"custom",variables:t.filteredCustomOptions||{}};case"character":return{characterData:t.characterData};case"saveData":return{saveData:t.saveData,readOnly:t.readOnly};case"worldInfo":return{worldInfo:t.worldInfo};case"memory":return{memoryData:t.memoryData};case"raw":return{allGameData:t.allGameData};default:return{...e,type:"chat",variables:t.filteredChatVariables||{}}}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",gee,[e.isLoading?((0,r.openBlock)(),(0,r.createElementBlock)("div",hee,[(0,r.createVNode)((0,r.unref)(Yw),{size:32,class:"animate-spin"}),t[5]||(t[5]=(0,r.createElementVNode)("p",null,"正在加载数据...",-1))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",fee,[n.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",vee,[(0,r.createVNode)((0,r.unref)(WA),{size:48}),t[6]||(t[6]=(0,r.createElementVNode)("p",null,"数据显示出错",-1)),t[7]||(t[7]=(0,r.createElementVNode)("p",{class:"hint"},"请尝试刷新数据",-1)),(0,r.createElementVNode)("button",{onClick:a,class:"retry-btn"},"重试")])):((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(o()),(0,r.mergeProps)({key:1},i(),{onEditVariable:t[0]||(t[0]=t=>e.$emit("edit-variable",t)),onCopyVariable:t[1]||(t[1]=t=>e.$emit("copy-variable",t)),onDeleteVariable:t[2]||(t[2]=t=>e.$emit("delete-variable",t)),onAddNewVariable:t[3]||(t[3]=t=>e.$emit("add-new-variable",t)),onDebugLog:t[4]||(t[4]=t=>e.$emit("debug-log"))}),null,16))]))]))}});var yee=n(7816),xee={};xee.styleTagTransform=k(),xee.setAttributes=v(),xee.insert=h().bind(null,"head"),xee.domAPI=p(),xee.insertStyleElement=y(),u()(yee.A,xee),yee.A&&yee.A.locals&&yee.A.locals;const kee=(0,N.A)(bee,[["__scopeId","data-v-3e8f894e"]]),wee={class:"modal-header"},Eee={class:"modal-body"},Nee={class:"form-group"},See=["disabled"],Vee={key:0,class:"form-hint-text"},_ee={class:"form-group"},Cee={class:"value-type-selector"},Aee=["onClick"],Dee=["placeholder"],Tee={key:0,class:"error-message"},Bee={key:1,class:"form-hint"},Iee={key:0,class:"preview-section"},zee={class:"preview-content"},Mee={class:"modal-footer"},Pee=["disabled"],Ree=(0,r.defineComponent)({__name:"GameVariableEditModal",props:{editingItem:{}},emits:["close","save"],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)({type:"",key:"",value:""}),i=(0,r.ref)("string"),s=(0,r.ref)(""),l=[{value:"string",label:"字符串"},{value:"number",label:"数字"},{value:"boolean",label:"布尔值"},{value:"object",label:"对象"},{value:"array",label:"数组"}],c=(0,r.computed)({get:()=>{if(!o.value)return"";const e=o.value.value;return"object"==typeof e&&null!==e?JSON.stringify(e,null,2):String(e??"")},set:e=>{o.value&&(o.value.value=e,m())}}),d=(0,r.computed)(()=>{if(s.value||!c.value)return null;try{if("object"===i.value||"array"===i.value){const e=JSON.parse(c.value);return JSON.stringify(e,null,2)}return null}catch{return null}}),u=(0,r.computed)(()=>""!==o.value.key.trim()&&""!==c.value.trim()&&!s.value),m=()=>{if(s.value="",c.value.trim()&&("object"===i.value||"array"===i.value))try{const e=JSON.parse(c.value);"array"!==i.value||Array.isArray(e)?"object"!==i.value||!Array.isArray(e)&&"object"==typeof e||(s.value="期望是对象类型，但解析结果不是对象"):s.value="期望是数组类型，但解析结果不是数组"}catch(e){s.value="JSON 格式错误: "+(e instanceof Error?e.message:"未知错误")}},p=()=>{switch(i.value){case"string":return"请输入字符串值，例如: Hello World";case"number":return"请输入数字值，例如: 123 或 3.14";case"boolean":return"请输入 true 或 false";case"object":return'请输入 JSON 对象，例如: {"name": "张三", "age": 25}';case"array":return'请输入 JSON 数组，例如: [1, 2, 3] 或 ["a", "b", "c"]';default:return"请输入值"}},g=()=>{switch(i.value){case"string":return"✅ 直接输入文本内容即可";case"number":return"✅ 输入数字，支持整数和小数";case"boolean":return"✅ 输入 true 或 false";case"object":return'✅ 使用 JSON 格式，例如: {"key": "value"}';case"array":return"✅ 使用 JSON 数组格式，例如: [1, 2, 3]";default:return"支持字符串、数字、布尔值、对象和数组"}},h=()=>{if(u.value)try{console.log("=== [Modal诊断] 开始保存 ==="),console.log("[Modal-1] editingValue.value (原始字符串):",c.value),console.log("[Modal-2] selectedType:",i.value);let e=c.value;switch(i.value){case"number":if(e=Number(c.value),isNaN(e))return void(s.value="无效的数字格式");break;case"boolean":e="true"===c.value.toLowerCase();break;case"object":case"array":console.log("[Modal-3] 解析前的JSON字符串:",c.value),e=JSON.parse(c.value),console.log("[Modal-4] 解析后的对象:",e),console.log("[Modal-5] 解析后的JSON:",JSON.stringify(e));break;default:e=c.value}o.value.value=e,console.log("[Modal-6] 即将emit的localEditingItem:",o.value),console.log("[Modal-7] 即将emit的finalValue:",e,"JSON:",JSON.stringify(e)),a("save",o.value)}catch(e){s.value="保存失败: "+(e instanceof Error?e.message:"未知错误")}};return(0,r.watch)(()=>n.editingItem,e=>{var t;e&&(o.value={...e},i.value=null==(t=e.value)?"string":Array.isArray(t)?"array":"object"==typeof t?"object":"boolean"==typeof t?"boolean":"number"==typeof t?"number":"string",s.value="",m())},{immediate:!0}),(e,t)=>e.editingItem?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=t=>e.$emit("close"))},[(0,r.createElementVNode)("div",{class:"modal-content",onClick:t[4]||(t[4]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",wee,[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(o.value.key?"编辑变量":"新增变量"),1),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:16})])]),(0,r.createElementVNode)("div",Eee,[(0,r.createElementVNode)("div",Nee,[t[6]||(t[6]=(0,r.createElementVNode)("label",null,"变量名 (Key)",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.key=e),class:"form-input",disabled:!!e.editingItem.key,placeholder:"请输入变量名"},null,8,See),[[r.vModelText,o.value.key]]),e.editingItem.key?((0,r.openBlock)(),(0,r.createElementBlock)("p",Vee," ℹ️ 编辑模式下无法修改变量名 ")):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",_ee,[t[7]||(t[7]=(0,r.createElementVNode)("label",null,"变量值 (Value)",-1)),(0,r.createElementVNode)("div",Cee,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l,e=>(0,r.createElementVNode)("button",{key:e.value,onClick:t=>(e=>{if(i.value=e,!c.value)switch(e){case"string":c.value="";break;case"number":c.value="0";break;case"boolean":c.value="true";break;case"object":c.value="{}";break;case"array":c.value="[]"}m()})(e.value),class:(0,r.normalizeClass)(["type-btn",{active:i.value===e.value}])},(0,r.toDisplayString)(e.label),11,Aee)),64))]),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),class:(0,r.normalizeClass)(["form-textarea",{"has-error":s.value}]),rows:"10",placeholder:p()},null,10,Dee),[[r.vModelText,c.value]]),s.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Tee," ⚠️ "+(0,r.toDisplayString)(s.value),1)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Bee,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(g()),1)]))]),d.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Iee,[t[8]||(t[8]=(0,r.createElementVNode)("label",null,"预览",-1)),(0,r.createElementVNode)("pre",zee,(0,r.toDisplayString)(d.value),1)])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",Mee,[(0,r.createElementVNode)("button",{onClick:t[3]||(t[3]=t=>e.$emit("close")),class:"cancel-btn"},"取消"),(0,r.createElementVNode)("button",{onClick:h,class:"save-btn",disabled:!u.value},[(0,r.createVNode)((0,r.unref)(xu.A),{size:14}),t[9]||(t[9]=(0,r.createElementVNode)("span",null,"保存",-1))],8,Pee)])])])):(0,r.createCommentVNode)("v-if",!0)}});var $ee=n(8470),Oee={};Oee.styleTagTransform=k(),Oee.setAttributes=v(),Oee.insert=h().bind(null,"head"),Oee.domAPI=p(),Oee.insertStyleElement=y(),u()($ee.A,Oee),$ee.A&&$ee.A.locals&&$ee.A.locals;const Lee=(0,N.A)(Ree,[["__scopeId","data-v-01a0fb92"]]),Fee={class:"modal-header"},jee={class:"modal-body"},Uee={class:"stats-grid"},qee={class:"stat-card"},Gee={class:"stat-icon core"},Hee={class:"stat-info"},Yee={class:"stat-value"},Wee={class:"stat-card"},Xee={class:"stat-icon global"},Jee={class:"stat-info"},Kee={class:"stat-value"},Zee={class:"stat-card"},Qee={class:"stat-icon memory"},ete={class:"stat-info"},tte={class:"stat-value"},nte={class:"stat-card"},ate={class:"stat-icon world"},rte={class:"stat-info"},ote={class:"stat-value"},ite={class:"data-size-info"},ste={class:"size-list"},lte={class:"size-item"},cte={class:"size-item"},dte={class:"size-item"},ute={class:"data-size-info",style:{"margin-top":"1rem"}},mte={class:"size-list"},pte={style:{"font-family":"monospace","font-size":"0.8rem"}},gte=(0,r.defineComponent)({__name:"GameVariableStatsModal",props:{coreDataViews:{},customOptions:{},allGameData:{},getMemoryCount:{type:Function},getWorldItemCount:{type:Function}},emits:["close"],setup(e){const t=e,n=e=>new Blob([JSON.stringify(e)]).size,a=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"modal-overlay",onClick:o[2]||(o[2]=t=>e.$emit("close"))},[(0,r.createElementVNode)("div",{class:"modal-content stats-modal",onClick:o[1]||(o[1]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("div",Fee,[o[3]||(o[3]=(0,r.createElementVNode)("h3",null,"数据统计",-1)),(0,r.createElementVNode)("button",{onClick:o[0]||(o[0]=t=>e.$emit("close")),class:"close-btn"},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:16})])]),(0,r.createElementVNode)("div",jee,[(0,r.createElementVNode)("div",Uee,[(0,r.createElementVNode)("div",qee,[(0,r.createElementVNode)("div",Gee,[(0,r.createVNode)((0,r.unref)(Su),{size:24})]),(0,r.createElementVNode)("div",Hee,[(0,r.createElementVNode)("div",Yee,(0,r.toDisplayString)(Object.keys(e.coreDataViews).length),1),o[4]||(o[4]=(0,r.createElementVNode)("div",{class:"stat-label"},"核心数据",-1))])]),(0,r.createElementVNode)("div",Wee,[(0,r.createElementVNode)("div",Xee,[(0,r.createVNode)((0,r.unref)(Wn.A),{size:24})]),(0,r.createElementVNode)("div",Jee,[(0,r.createElementVNode)("div",Kee,(0,r.toDisplayString)(Object.keys(e.customOptions).length),1),o[5]||(o[5]=(0,r.createElementVNode)("div",{class:"stat-label"},"自定义选项",-1))])]),(0,r.createElementVNode)("div",Zee,[(0,r.createElementVNode)("div",Qee,[(0,r.createVNode)((0,r.unref)(hu),{size:24})]),(0,r.createElementVNode)("div",ete,[(0,r.createElementVNode)("div",tte,(0,r.toDisplayString)(e.getMemoryCount()),1),o[6]||(o[6]=(0,r.createElementVNode)("div",{class:"stat-label"},"记忆条目",-1))])]),(0,r.createElementVNode)("div",nte,[(0,r.createElementVNode)("div",ate,[(0,r.createVNode)((0,r.unref)(l6),{size:24})]),(0,r.createElementVNode)("div",rte,[(0,r.createElementVNode)("div",ote,(0,r.toDisplayString)(e.getWorldItemCount()),1),o[7]||(o[7]=(0,r.createElementVNode)("div",{class:"stat-label"},"世界元素",-1))])])]),(0,r.createElementVNode)("div",ite,[o[11]||(o[11]=(0,r.createElementVNode)("h4",null,"数据大小统计",-1)),(0,r.createElementVNode)("div",ste,[(0,r.createElementVNode)("div",lte,[o[8]||(o[8]=(0,r.createElementVNode)("span",null,"核心数据大小:",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(a(n(e.coreDataViews))),1)]),(0,r.createElementVNode)("div",cte,[o[9]||(o[9]=(0,r.createElementVNode)("span",null,"自定义选项大小:",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(a(n(e.customOptions))),1)]),(0,r.createElementVNode)("div",dte,[o[10]||(o[10]=(0,r.createElementVNode)("span",null,"总数据大小:",-1)),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(a(n(e.allGameData))),1)])])]),(0,r.createElementVNode)("div",ute,[o[12]||(o[12]=(0,r.createElementVNode)("h4",null,"核心数据详细大小（前10个最大的）",-1)),(0,r.createElementVNode)("div",mte,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Object.entries(t.coreDataViews).map(([e,t])=>({key:e,size:n(t)})).sort((e,t)=>t.size-e.size).slice(0,10),e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.key,class:"size-item"},[(0,r.createElementVNode)("span",pte,(0,r.toDisplayString)(e.key),1),(0,r.createElementVNode)("span",{style:(0,r.normalizeStyle)({color:e.size>5e4?"#ef4444":e.size>1e4?"#f59e0b":"inherit"})},(0,r.toDisplayString)(a(e.size)),5)]))),128))])])])])]))}});var hte=n(8537),fte={};fte.styleTagTransform=k(),fte.setAttributes=v(),fte.insert=h().bind(null,"head"),fte.domAPI=p(),fte.insertStyleElement=y(),u()(hte.A,fte),hte.A&&hte.A.locals&&hte.A.locals;const vte=(0,N.A)(gte,[["__scopeId","data-v-594e2d00"]]);var bte=n(406);const yte={class:"format-guide-modal"},xte={class:"modal-header"},kte={class:"modal-title"},wte={class:"modal-body"},Ete={class:"format-guide-content"},Nte={class:"quick-nav"},Ste=["onClick"],Vte={class:"modal-footer"},_te=(0,r.defineComponent)({__name:"GameVariableFormatGuideModal",emits:["close"],setup(e){const t=(0,r.ref)("character"),n=(0,bte.lS)((0,se.isTavernEnv)()),a=[{id:"character",title:"角色/状态"},{id:"dao",title:"大道"},{id:"inventory",title:"背包物品"},{id:"relationships",title:"关系"},{id:"world",title:"世界"},{id:"event",title:"事件"}],o=async()=>{try{await navigator.clipboard.writeText(n),X.o.success("已复制完整数据格式说明")}catch(e){console.error("复制失败:",e),X.o.error("复制失败")}};return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"format-guide-modal-overlay",onClick:n[2]||(n[2]=(0,r.withModifiers)(t=>e.$emit("close"),["self"]))},[(0,r.createElementVNode)("div",yte,[(0,r.createElementVNode)("div",xte,[(0,r.createElementVNode)("h3",kte,[(0,r.createVNode)((0,r.unref)(vu.A),{size:20}),n[3]||(n[3]=(0,r.createTextVNode)(" 数据格式说明 ",-1))]),(0,r.createElementVNode)("button",{class:"close-btn",onClick:n[0]||(n[0]=t=>e.$emit("close")),title:"关闭"},[(0,r.createVNode)((0,r.unref)(Iu.A),{size:20})])]),(0,r.createElementVNode)("div",wte,[(0,r.createElementVNode)("div",Ete,[(0,r.createCommentVNode)(" 快速导航 "),(0,r.createElementVNode)("div",Nte,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a,e=>(0,r.createElementVNode)("button",{key:e.id,class:(0,r.normalizeClass)(["nav-btn",{active:t.value===e.id}]),onClick:n=>(e=>{t.value=e;const n=document.getElementById(e);n&&n.scrollIntoView({behavior:"smooth",block:"start"})})(e.id)},(0,r.toDisplayString)(e.title),11,Ste)),64))]),(0,r.createCommentVNode)(" 格式说明内容 "),n[4]||(n[4]=(0,r.createStaticVNode)('<div class="format-sections" data-v-15e88818>\x3c!-- 角色信息 --\x3e<section id="character" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>1. 角色与状态</h4><div class="section-content" data-v-15e88818><h5 data-v-15e88818>1.1 角色（基础档案）</h5><pre class="code-block" data-v-15e88818>名字: string (只读)\n性别: &quot;男&quot;|&quot;女&quot;|&quot;其他&quot; (只读)\n年龄: number (自动计算)\n出生日期: {年, 月, 日, 小时?, 分钟?} (只读)\n先天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (只读，1-10)\n后天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (可修改，用add)</pre><h5 data-v-15e88818>1.2 属性（可修改）</h5><pre class="code-block" data-v-15e88818>境界: {名称, 阶段, 当前进度, 下一级所需, 突破描述}\n  → 用set更新整个对象\n  → 突破时必须更新突破描述\n\n气血/灵气/神识: {当前, 上限}\n  → 当前用add，上限突破时用add\n\n寿命: {当前, 上限}\n  → 当前用add/或在时间推进时由系统更新，上限突破时用add\n\n声望: number\n  → 用add增减或set覆盖\n\n位置: {描述:&quot;大陆·地点&quot;, x, y}\n  → 顶级字段 key=&quot;位置&quot;，用set更新整个对象，三个字段必须同时设置\n\n效果: [{状态名称, 类型, 生成时间, 持续时间分钟, 状态描述}]\n  → 只能用push添加\n  → 类型必须是&quot;buff&quot;或&quot;debuff&quot;（全小写）\n  → 生成时间使用当前游戏时间\n  → 持续时间分钟：数值类型（99999表示永久）</pre><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 添加增益状态\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;效果&quot;,\n  &quot;value&quot;: {\n    &quot;状态名称&quot;: &quot;灵气充盈&quot;,\n    &quot;类型&quot;: &quot;buff&quot;,\n    &quot;生成时间&quot;: {&quot;年&quot;: 1000, &quot;月&quot;: 3, &quot;日&quot;: 15, &quot;小时&quot;: 10, &quot;分钟&quot;: 30},\n    &quot;持续时间分钟&quot;: 120,\n    &quot;状态描述&quot;: &quot;灵气恢复速度提升50%&quot;\n  }\n}</pre></div></div></section>\x3c!-- 三千大道 --\x3e<section id="dao" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>2. 大道</h4><div class="section-content" data-v-15e88818><pre class="code-block" data-v-15e88818>大道列表: {道名: DaoData对象}\n  - 道名: string\n  - 描述: string\n  - 阶段列表: [{名称, 描述, 突破经验}]\n  - 是否解锁: boolean\n  - 当前阶段: number\n  - 当前经验: number\n  - 总经验: number</pre><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 解锁并初始化大道\n{\n  &quot;action&quot;: &quot;set&quot;,\n  &quot;key&quot;: &quot;大道.大道列表.剑道&quot;,\n  &quot;value&quot;: {\n    &quot;道名&quot;: &quot;剑道&quot;,\n    &quot;描述&quot;: &quot;以剑入道，剑气纵横&quot;,\n    &quot;是否解锁&quot;: true,\n    &quot;当前阶段&quot;: 0,\n    &quot;当前经验&quot;: 0,\n    &quot;总经验&quot;: 0,\n    &quot;阶段列表&quot;: [\n      {&quot;名称&quot;: &quot;初窥门径&quot;, &quot;描述&quot;: &quot;...&quot;, &quot;突破经验&quot;: 100},\n      {&quot;名称&quot;: &quot;小有所成&quot;, &quot;描述&quot;: &quot;...&quot;, &quot;突破经验&quot;: 500}\n    ]\n  }\n}\n\n// 增加经验\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;大道.大道列表.剑道.当前经验&quot;,\n  &quot;value&quot;: 50\n}</pre></div></div></section>\x3c!-- 背包与物品 --\x3e<section id="inventory" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>3. 背包与物品</h4><div class="section-content" data-v-15e88818><pre class="code-block" data-v-15e88818>背包:\n  - 灵石: {下品, 中品, 上品, 极品} (用add增减)\n  - 物品: {物品ID: Item对象}\n\n物品类型:\n  - 装备: {物品ID, 名称, 类型:&quot;装备&quot;, 品质, 数量, 描述, 装备增幅, 特殊效果}\n  - 功法: {物品ID, 名称, 类型:&quot;功法&quot;, 品质, 数量, 描述, 功法效果, 功法技能[], 修炼进度, 已解锁技能[]}\n  - 消耗品/材料: {物品ID, 名称, 类型:&quot;丹药&quot;|&quot;材料&quot;|&quot;其他&quot;, 品质, 数量, 描述, 使用效果?}\n\n品质格式: {quality:&quot;凡&quot;|&quot;黄&quot;|&quot;玄&quot;|&quot;地&quot;|&quot;天&quot;|&quot;仙&quot;|&quot;神&quot;, grade:0-10}</pre><div class="warning-box" data-v-15e88818><strong data-v-15e88818>⚠️ 重要：</strong><ul data-v-15e88818><li data-v-15e88818>修炼进度和已解锁技能存储在<strong data-v-15e88818>角色.背包.物品.{功法ID}</strong>中</li><li data-v-15e88818>❌ 错误：修改&quot;角色.修炼.修炼功法&quot;字段（这是引用槽位，不是进度来源）</li><li data-v-15e88818>✅ 正确：修改&quot;角色.背包.物品.{功法ID}.修炼进度&quot;</li></ul></div><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 增加功法修炼进度\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;角色.背包.物品.gongfa_001.修炼进度&quot;,\n  &quot;value&quot;: 10\n}\n\n// 解锁新技能\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;角色.背包.物品.gongfa_001.已解锁技能&quot;,\n  &quot;value&quot;: &quot;御剑术&quot;\n}</pre></div></div></section>\x3c!-- 人物关系 --\x3e<section id="relationships" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>4. 关系</h4><div class="section-content" data-v-15e88818><pre class="code-block" data-v-15e88818>关系: {NPC名字: NPC档案对象}\n  - 名字: string\n  - 性别: &quot;男&quot;|&quot;女&quot;|&quot;其他&quot;\n  - 境界: {名称, 阶段} (⚠️ NPC境界是简化结构，严禁添加&quot;当前进度&quot;等玩家专属字段)\n  - 与玩家关系: string\n  - 好感度: number (-100~100，用add)\n  - 记忆: [string] (用push添加)\n  - 当前外貌状态: string (用set实时更新)\n  - 当前内心想法: string (用set实时更新)</pre><div class="warning-box" data-v-15e88818><strong data-v-15e88818>⚠️ NPC境界格式：</strong><ul data-v-15e88818><li data-v-15e88818>✅ 正确：{&quot;名称&quot;: &quot;筑基&quot;, &quot;阶段&quot;: &quot;中期&quot;}</li><li data-v-15e88818>❌ 错误：{&quot;名称&quot;: &quot;筑基&quot;, &quot;阶段&quot;: &quot;中期&quot;, &quot;当前进度&quot;: 0}</li></ul></div><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 增加好感度\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;关系.张三.好感度&quot;,\n  &quot;value&quot;: 10\n}\n\n// 添加记忆\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;关系.张三.记忆&quot;,\n  &quot;value&quot;: &quot;【1000年3月15日】与玩家一起修炼，感觉很愉快&quot;\n}\n\n// 更新关系\n{\n  &quot;action&quot;: &quot;set&quot;,\n  &quot;key&quot;: &quot;关系.张三.与玩家关系&quot;,\n  &quot;value&quot;: &quot;朋友&quot;\n}</pre></div></div></section>\x3c!-- 世界信息 --\x3e<section id="world" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>5. 世界</h4><div class="section-content" data-v-15e88818><pre class="code-block" data-v-15e88818>世界:\n  - 势力信息: [{名称, 类型, 等级, 位置, 与玩家关系, 声望值, ...}]\n  - 地点信息: [{名称, 类型, 位置, coordinates, ...}]\n\n势力信息字段:\n  - 名称: string\n  - 类型: &quot;修仙宗门&quot;|&quot;魔道宗门&quot;|&quot;修仙世家&quot;\n  - 等级: &quot;超级&quot;|&quot;一流&quot;|&quot;二流&quot;|&quot;三流&quot;\n  - 与玩家关系: &quot;敌对&quot;|&quot;中立&quot;|&quot;友好&quot;\n  - 声望值: number\n  - 领导层: {宗主, 宗主修为, 综合战力}\n  - 成员数量: {总数, 按境界, 按职位}</pre><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 修改宗主\n{\n  &quot;action&quot;: &quot;set&quot;,\n  &quot;key&quot;: &quot;世界.势力信息[0].领导层.宗主&quot;,\n  &quot;value&quot;: &quot;新宗主名字&quot;\n}\n\n// 增加声望\n{\n  &quot;action&quot;: &quot;add&quot;,\n  &quot;key&quot;: &quot;世界.势力信息[2].声望值&quot;,\n  &quot;value&quot;: 50\n}\n\n// 添加新地点\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;世界.地点信息&quot;,\n  &quot;value&quot;: {\n    &quot;名称&quot;: &quot;xx秘境&quot;,\n    &quot;类型&quot;: &quot;秘境&quot;,\n    &quot;位置&quot;: &quot;东玄大陆·北部&quot;,\n    &quot;coordinates&quot;: {&quot;x&quot;: 108.5, &quot;y&quot;: 28.3},\n    &quot;描述&quot;: &quot;...&quot;,\n    &quot;安全等级&quot;: &quot;危险&quot;\n  }\n}</pre></div></div></section>\x3c!-- 世界事件系统 --\x3e<section id="event" class="format-section" data-v-15e88818><h4 class="section-title" data-v-15e88818>6. 事件</h4><div class="section-content" data-v-15e88818><pre class="code-block" data-v-15e88818>社交.事件:\n  - 配置: {启用随机事件, 最小间隔年, 最大间隔年, 事件提示词}\n  - 下次事件时间: {年, 月, 日, 小时, 分钟} | null\n  - 事件记录: [事件对象]\n\n事件对象结构:\n  - 事件ID: string (格式: event_时间戳_随机数)\n  - 事件名称: string\n  - 事件类型: string (宗门大战/世界变化/异宝降世/秘境现世/好友遭遇等)\n  - 事件描述: string\n  - 影响等级: &quot;轻微&quot;|&quot;中等&quot;|&quot;重大&quot;|&quot;灾难&quot;\n  - 影响范围: string\n  - 相关人物: string[]\n  - 相关势力: string[]\n  - 事件来源: &quot;随机&quot;|&quot;玩家行为&quot;|&quot;剧情&quot;\n  - 发生时间: {年, 月, 日, 小时, 分钟}</pre><div class="example-box" data-v-15e88818><strong data-v-15e88818>示例：</strong><pre class="code-block" data-v-15e88818>// 添加一条刚刚发生的世界事件\n{\n  &quot;action&quot;: &quot;push&quot;,\n  &quot;key&quot;: &quot;社交.事件.事件记录&quot;,\n  &quot;value&quot;: {\n    &quot;事件ID&quot;: &quot;event_1700000000000_42&quot;,\n    &quot;事件名称&quot;: &quot;青冥宗与赤炎谷开战&quot;,\n    &quot;事件类型&quot;: &quot;宗门大战&quot;,\n    &quot;事件描述&quot;: &quot;……&quot;,\n    &quot;影响等级&quot;: &quot;重大&quot;,\n    &quot;影响范围&quot;: &quot;东玄大陆北境&quot;,\n    &quot;相关人物&quot;: [],\n    &quot;相关势力&quot;: [&quot;青冥宗&quot;, &quot;赤炎谷&quot;],\n    &quot;事件来源&quot;: &quot;随机&quot;,\n    &quot;发生时间&quot;: {&quot;年&quot;: 12, &quot;月&quot;: 3, &quot;日&quot;: 18, &quot;小时&quot;: 14, &quot;分钟&quot;: 0}\n  }\n}</pre></div></div></section></div>',1))])]),(0,r.createElementVNode)("div",Vte,[(0,r.createElementVNode)("button",{class:"copy-btn",onClick:o},[(0,r.createVNode)((0,r.unref)(H7),{size:16}),n[5]||(n[5]=(0,r.createTextVNode)(" 复制全部格式 ",-1))]),(0,r.createElementVNode)("button",{class:"close-footer-btn",onClick:n[1]||(n[1]=t=>e.$emit("close"))}," 关闭 ")])])]))}});var Cte=n(4414),Ate={};Ate.styleTagTransform=k(),Ate.setAttributes=v(),Ate.insert=h().bind(null,"head"),Ate.domAPI=p(),Ate.insertStyleElement=y(),u()(Cte.A,Ate),Cte.A&&Cte.A.locals&&Cte.A.locals;const Dte=(0,N.A)(_te,[["__scopeId","data-v-15e88818"]]),Tte={class:"game-variable-panel"},Bte=(0,r.defineComponent)({__name:"GameVariablePanel",setup(e){const{t}=(0,K.s)(),n=(0,pu.useGameStateStore)(),a=(0,Jc.useCharacterStore)(),o=(0,r.computed)(()=>"联机"===a.activeCharacterProfile?.模式),i=(0,r.ref)(!1),s=(0,r.ref)(!1),l=(0,r.ref)(""),c=(0,r.ref)("saveData"),d=(0,r.ref)(""),u=(0,r.ref)(!1),m=(0,r.ref)(!1),p=(0,r.ref)(null),g=(0,r.ref)(!1),h=(0,r.computed)(()=>{if(!n.isGameLoaded)return{};const e=a.activeSaveSlot,t=a.activeCharacterProfile,r="联机"===t?.模式?t.存档?.云端同步信息:void 0,o=n.toSaveData()||{},i=(0,Zc.ru)(o)?o:(0,Zc.jj)(o).migrated,s={元数据:i.元数据,角色:i.角色,社交:i.社交,世界:i.世界,系统:i.系统};return s.元数据={...s.元数据&&"object"==typeof s.元数据?s.元数据:{},存档ID:e?.id??e?.存档名??void 0,角色ID:a.rootState.当前激活存档?.角色ID,模式:t?.模式,游玩时长:e?.游戏时长,创建时间:e?.保存时间??void 0,更新时间:e?.最后保存时间??e?.保存时间??void 0},r&&(s.系统&&"object"==typeof s.系统||(s.系统={}),s.系统.联机&&"object"==typeof s.系统.联机||(s.系统.联机={}),s.系统.联机.同步状态=r),s}),f=(0,r.computed)(()=>n.isGameLoaded?(n.$state,{[t("存档数据 (短路径)")]:h.value,[t("角色")]:n.character,[t("记忆")]:n.memory,[t("世界")]:n.worldInfo}):{}),v=(0,r.computed)(()=>({[t("游戏版本")]:"2.0.0",[t("架构模式")]:"Pinia内存 + DB持久化"})),b=(0,r.computed)(()=>n.character||{}),y=(0,r.computed)(()=>n.isGameLoaded?h.value:{}),x=(0,r.computed)(()=>n.worldInfo||{}),k=(0,r.computed)(()=>n.memory||{}),w=(0,r.computed)(()=>({...f.value,...v.value})),E=(0,r.computed)(()=>{if(!d.value)return f.value;const e=d.value.toLowerCase();return Object.fromEntries(Object.entries(f.value).filter(([t])=>t.toLowerCase().includes(e)))}),N=(0,r.computed)(()=>{if(!d.value)return v.value;const e=d.value.toLowerCase();return Object.fromEntries(Object.entries(v.value).filter(([t])=>t.toLowerCase().includes(e)))}),S=e=>{switch(e){case"core":return Object.keys(f.value).length;case"custom":return Object.keys(v.value).length;case"character":return Object.keys(b.value).length;case"saveData":return Object.keys(y.value).length;case"worldInfo":return _();case"memory":return V();case"raw":return Object.keys(w.value).length;default:return 0}},V=()=>"object"==typeof k.value&&null!==k.value?Object.keys(k.value).length:0,_=()=>"object"==typeof x.value&&null!==x.value?Object.keys(x.value).length:0,C=[{key:"saveData",label:t("存档数据(短路径)"),icon:"Archive"},{key:"core",label:t("核心数据"),icon:"Database"},{key:"character",label:t("角色数据"),icon:"Users"},{key:"worldInfo",label:t("世界信息"),icon:"Book"},{key:"memory",label:t("记忆数据"),icon:"Brain"},{key:"custom",label:t("自定义选项"),icon:"Settings"},{key:"raw",label:t("原始数据"),icon:"Code"}],A=async()=>{s.value=!0,i.value=!0;try{if(!n.isGameLoaded)return void X.o.warning(t("请先加载游戏存档"));l.value=(new Date).toLocaleString("zh-CN"),X.o.success(t("数据已从Pinia Store刷新"))}catch(e){console.error("[游戏变量] 刷新失败:",e),X.o.error(t("数据刷新失败: ")+(e instanceof Error?e.message:t("未知错误")))}finally{i.value=!1,s.value=!1}},D=()=>{try{const e=JSON.stringify(w.value,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`game-variables-${Date.now()}.json`,r.click(),URL.revokeObjectURL(a),X.o.success(t("数据导出成功"))}catch(e){console.error("[游戏变量] 导出失败:",e),X.o.error(t("数据导出失败"))}},T=()=>{u.value=!0},B=()=>{X.o.warning(t("新架构下不支持直接添加变量，请通过游戏操作修改数据"))},I=e=>{o.value?X.o.warning(t("联机模式下不允许直接修改变量（服务器权威控制）")):(p.value={...e},g.value=!0)},z=async e=>{try{const n="object"==typeof e.value?JSON.stringify(e.value,null,2):String(e.value);await navigator.clipboard.writeText(`${e.key}: ${n}`),X.o.success(t("已复制到剪贴板"))}catch(e){console.error("[游戏变量] 复制失败:",e),X.o.error(t("复制失败"))}},M=async()=>{o.value?X.o.warning(t("联机模式下不允许直接删除变量（服务器权威控制）")):X.o.warning(t("新架构下不支持直接删除变量，请通过游戏操作修改数据"))},P=async e=>{if(e)if(o.value)X.o.warning(t("联机模式下不允许直接修改变量（服务器权威控制）"));else try{const{key:a,value:r}=e;let o=r;if("string"==typeof r&&(r.trim().startsWith("{")||r.trim().startsWith("[")))try{o=JSON.parse(r)}catch{}console.log("=== [诊断日志] 开始保存变量 ==="),console.log("[1] 原始Key:",a),console.log("[2-A] editingItem.value完整对象:",p.value),console.log("[2-B] 解构后的value:",r,"typeof:",typeof r),console.log("[2-C] parsedValue:",o,"typeof:",typeof o);const i=(e=>{const n=(t,n)=>e===t?n:e.startsWith(`${t}.`)?`${n}${e.slice(t.length)}`:null,a=[{from:"元数据.时间",to:"gameTime"},{from:"元数据",to:"saveMeta"},{from:"角色.身份",to:"character"},{from:"角色.属性",to:"attributes"},{from:"角色.位置",to:"location"},{from:"角色.效果",to:"effects"},{from:"角色.身体.部位开发",to:"bodyPartDevelopment"},{from:"角色.背包",to:"inventory"},{from:"角色.装备",to:"equipment"},{from:"角色.功法",to:"techniqueSystem"},{from:"角色.修炼",to:"cultivation"},{from:"角色.大道",to:"thousandDao"},{from:"角色.技能",to:"skillState"},{from:"社交.关系",to:"relationships"},{from:"社交.宗门",to:"sectSystem"},{from:"社交.事件",to:"eventSystem"},{from:"社交.记忆",to:"memory"},{from:"世界.信息",to:"worldInfo"},{from:"系统.配置",to:"systemConfig"},{from:"系统.设置",to:"userSettings"},{from:"系统.缓存.掌握技能",to:"masteredSkills"},{from:"系统.历史.叙事",to:"narrativeHistory"},{from:"系统.联机",to:"onlineState"}];for(const{from:e,to:t}of a){const a=n(e,t);if(a)return a}return X.o.warning(t("不支持的字段路径（仅支持V3五域路径）")),null})(a);if(!i)return void X.o.warning(t("字段路径无法映射到 Store，请检查路径是否正确"));console.log("[3] 映射后Store路径:",i),console.log("[3.5] 🔍 即将传给updateState的值:",o,"类型:",typeof o);const s=i.split(".");let l=n;for(const e of s)l=l?.[e];console.log("[4] updateState前的Store值:",l),console.log("[4-CRITICAL] 即将传递给updateState的parsedValue:",o,"typeof:",typeof o,"JSON:",JSON.stringify(o)),n.updateState(i,o);let c=n;for(const e of s)c=c?.[e];console.log("[5] updateState后的Store值:",c),console.log("[6] 开始调用 gameStateStore.saveGame()"),await n.saveGame(),console.log("[7] gameStateStore.saveGame() 完成"),console.log("=== [诊断日志] 保存变量结束 ==="),X.o.success(t("✅ 已成功更新 ")+`${a}`),R(),await A()}catch(e){const n=e instanceof Error?e.message:t("未知错误");X.o.error(t("保存失败: ")+`${n}`),console.error("[游戏变量] 保存失败:",e)}else X.o.error(t("没有要保存的数据"))},R=()=>{g.value=!1,p.value=null},$=()=>{console.group("[游戏变量] 详细调试信息 (Pinia模式)"),console.log(t("基本统计:"),{[t("游戏已加载")]:n.isGameLoaded,[t("角色名")]:n.character?.名字,coreDataViewsCount:Object.keys(f.value).length,customOptionsCount:Object.keys(v.value).length,lastUpdateTime:l.value}),console.log(t("核心数据键名:"),Object.keys(f.value)),console.log(t("自定义选项键名:"),Object.keys(v.value)),console.log(t("完整SaveData:"),n.toSaveData()),console.groupEnd(),X.o.success(t("调试信息已输出到控制台"))};return(0,r.onMounted)(()=>{A(),zu.on("refresh",()=>A()),zu.on("export",()=>D()),zu.on("stats",()=>T())}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Tte,[(0,r.createVNode)(I7,{isRefreshing:s.value,searchQuery:d.value,"onUpdate:searchQuery":t[0]||(t[0]=e=>d.value=e),onRefresh:A,onExport:D,onShowStats:T,onShowFormatGuide:t[1]||(t[1]=e=>m.value=!0)},null,8,["isRefreshing","searchQuery"]),(0,r.createVNode)(q7,{dataTypes:C,selectedType:c.value,getDataCount:S,"onUpdate:selectedType":t[2]||(t[2]=e=>c.value=e)},null,8,["selectedType"]),(0,r.createVNode)(kee,{isLoading:i.value,selectedDataType:c.value,searchQuery:d.value,readOnly:o.value,coreDataViews:f.value,customOptions:v.value,characterData:b.value,saveData:y.value,worldInfo:x.value,memoryData:k.value,allGameData:w.value,filteredCoreDataViews:E.value,filteredCustomOptions:N.value,onEditVariable:I,onCopyVariable:z,onDeleteVariable:M,onAddNewVariable:B,onDebugLog:$},null,8,["isLoading","selectedDataType","searchQuery","readOnly","coreDataViews","customOptions","characterData","saveData","worldInfo","memoryData","allGameData","filteredCoreDataViews","filteredCustomOptions"]),g.value?((0,r.openBlock)(),(0,r.createBlock)(Lee,{key:0,editingItem:p.value,onClose:R,onSave:P},null,8,["editingItem"])):(0,r.createCommentVNode)("v-if",!0),u.value?((0,r.openBlock)(),(0,r.createBlock)(vte,{key:1,coreDataViews:f.value,customOptions:v.value,allGameData:w.value,getMemoryCount:V,getWorldItemCount:_,onClose:t[3]||(t[3]=e=>u.value=!1)},null,8,["coreDataViews","customOptions","allGameData"])):(0,r.createCommentVNode)("v-if",!0),m.value?((0,r.openBlock)(),(0,r.createBlock)(Dte,{key:2,onClose:t[4]||(t[4]=e=>m.value=!1)})):(0,r.createCommentVNode)("v-if",!0)]))}});var Ite=n(9130),zte={};zte.styleTagTransform=k(),zte.setAttributes=v(),zte.insert=h().bind(null,"head"),zte.domAPI=p(),zte.insertStyleElement=y(),u()(Ite.A,zte),Ite.A&&Ite.A.locals&&Ite.A.locals;const Mte=(0,N.A)(Bte,[["__scopeId","data-v-540c2ec9"]]),Pte={class:"prompt-panel"},Rte={class:"panel-header compact"},$te={class:"panel-actions"},Ote=["disabled"],Lte=["disabled"],Fte=["disabled"],jte=["disabled"],Ute=["disabled"],qte={key:0,class:"online-mode-warning"},Gte={class:"prompt-list"},Hte=["onClick"],Yte={class:"category-title"},Wte={class:"category-icon"},Xte={class:"category-name"},Jte={class:"category-count"},Kte={class:"category-actions"},Zte={class:"category-desc"},Qte={key:0,class:"category-content"},ene=["onClick"],tne={class:"prompt-title-area"},nne=["checked","onChange"],ane={class:"prompt-meta"},rne=["value","disabled","onChange"],one=["title"],ine={key:0,class:"prompt-content"},sne={key:0,class:"prompt-description-full"},lne=["onUpdate:modelValue","onInput","disabled"],cne={class:"prompt-actions"},dne=["onClick","disabled"],une=["onClick"],mne=["onClick","disabled"],pne=(0,r.defineComponent)({__name:"PromptManagementPanel",setup(e){const t=(0,Jc.useCharacterStore)(),n=(0,r.computed)(()=>"联机"===t.activeCharacterProfile?.模式),a=(0,r.ref)({}),o=(0,r.ref)({}),i=(0,r.ref)({});async function s(){a.value=await Xc.promptStorage.loadByCategory();const e=Object.keys(a.value)[0];e&&(i.value[e]=!0)}function l(){for(const e in a.value)i.value[e]=!0}function c(){for(const e in a.value)i.value[e]=!1;o.value={}}async function d(){let e=0;for(const t in a.value)for(const n of a.value[t].prompts)n.modified&&(await Xc.promptStorage.save(n.key,n.content,n.enabled,n.weight),e++);e>0?(await g({silent:!0}),X.o.success(`已保存 ${e} 项修改`)):X.o.info("没有需要保存的修改")}async function u(){const e=await Xc.promptStorage.exportAll();v((0,Kc.q3)("prompts",e),"prompts_all.json"),X.o.success("已导出全部提示词")}async function m(){if((0,D.isBackendConfigured)())if(localStorage.getItem("access_token"))try{const e=await T.Em.get("/api/v1/prompts/defaults"),t=e?.prompts||{};if(!Object.keys(t).length)return void X.o.error("后端未配置默认提示词");await Xc.promptStorage.resetAll(),await Xc.promptStorage.importPrompts(t),await s(),await g({silent:!0}),X.o.success("已恢复默认提示词")}catch(e){X.o.error("恢复默认提示词失败")}else X.o.error("请先登录后端");else X.o.error("后端未配置，无法恢复默认提示词")}function p(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),n=JSON.parse(e),a=(0,Kc.ZT)(n),r="prompts"===a.type?a.payload:n,o=await Xc.promptStorage.importPrompts(r);await s(),await g({silent:!0}),X.o.success(`成功导入 ${o} 个提示词`)}catch(e){X.o.error("导入失败，请检查文件格式")}},e.click()}async function g(e){if((0,D.isBackendConfigured)()&&localStorage.getItem("access_token"))try{const e=await Xc.promptStorage.exportAll();await T.Em.put("/api/v1/user/prompts",{prompts:e})}catch(t){console.error("同步用户提示词失败:",t),e?.silent||X.o.error("同步失败，请检查后端连接或登录状态")}}async function h(){if((0,D.isBackendConfigured)())if(localStorage.getItem("access_token"))try{await T.Em.delete("/api/v1/user/prompts"),await g({silent:!1}),X.o.success("已同步到云端")}catch{X.o.error("同步失败")}else X.o.error("请先登录后端");else X.o.error("后端未配置，无法同步")}async function f(){if((0,D.isBackendConfigured)())if(localStorage.getItem("access_token"))try{const e=await T.Em.get("/api/v1/user/prompts"),t=e?.prompts||{};await Xc.promptStorage.resetAll(),Object.keys(t).length&&await Xc.promptStorage.importPrompts(t),await s(),X.o.success("已从云端同步")}catch{X.o.error("同步失败")}else X.o.error("请先登录后端");else X.o.error("后端未配置，无法同步")}function v(e,t){const n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=t,r.click(),URL.revokeObjectURL(a)}return(0,r.onMounted)(async()=>{await s()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Pte,[(0,r.createElementVNode)("div",Rte,[t[11]||(t[11]=(0,r.createElementVNode)("div",{class:"panel-title-compact"},[(0,r.createElementVNode)("span",{class:"title-text"},"📝 提示词管理")],-1)),(0,r.createElementVNode)("div",$te,[(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:m,title:"恢复默认",disabled:n.value},t[3]||(t[3]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("polyline",{points:"1 4 1 10 7 10"}),(0,r.createElementVNode)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1)]),8,Ote),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:h,title:"同步到云端",disabled:n.value},t[4]||(t[4]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M21 12a9 9 0 1 1-3.5-7.1"}),(0,r.createElementVNode)("polyline",{points:"22 4 21 12 13 11"})],-1)]),8,Lte),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:f,title:"从云端同步",disabled:n.value},t[5]||(t[5]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M3 12a9 9 0 1 0 3.5-7.1"}),(0,r.createElementVNode)("polyline",{points:"2 4 3 12 11 11"})],-1)]),8,Fte),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:l,title:"全部展开"},t[6]||(t[6]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("polyline",{points:"6 9 12 15 18 9"})],-1)])),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:c,title:"全部折叠"},t[7]||(t[7]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("polyline",{points:"18 15 12 9 6 15"})],-1)])),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:u,title:"导出全部"},t[8]||(t[8]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,r.createElementVNode)("polyline",{points:"7 10 12 15 17 10"}),(0,r.createElementVNode)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])),(0,r.createElementVNode)("button",{class:"action-btn-compact",onClick:p,title:"导入",disabled:n.value},t[9]||(t[9]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,r.createElementVNode)("polyline",{points:"17 8 12 3 7 8"}),(0,r.createElementVNode)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)]),8,jte),(0,r.createElementVNode)("button",{class:"action-btn-compact primary",onClick:d,title:"保存全部",disabled:n.value},t[10]||(t[10]=[(0,r.createElementVNode)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),(0,r.createElementVNode)("polyline",{points:"17 21 17 13 7 13 7 21"}),(0,r.createElementVNode)("polyline",{points:"7 3 7 8 15 8"})],-1)]),8,Ute)])]),(0,r.createCommentVNode)(" 联机模式警告 "),n.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",qte,t[12]||(t[12]=[(0,r.createElementVNode)("span",{class:"warning-icon"},"🔒",-1),(0,r.createElementVNode)("span",{class:"warning-text"},"联机模式下提示词仅供查看，无法编辑",-1)]))):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Gte,[(0,r.createCommentVNode)(" 分类显示 "),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,(e,s)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:s,class:"category-section"},[(0,r.createCommentVNode)(" 分类头部 "),(0,r.createElementVNode)("div",{class:"category-header",onClick:e=>function(e){i.value[e]=!i.value[e]}(String(s))},[(0,r.createElementVNode)("div",Yte,[(0,r.createElementVNode)("span",Wte,(0,r.toDisplayString)(e.info.icon),1),(0,r.createElementVNode)("span",Xte,(0,r.toDisplayString)(e.info.name),1),(0,r.createElementVNode)("span",Jte,(0,r.toDisplayString)(e.prompts.length)+" 个提示词",1)]),(0,r.createElementVNode)("div",Kte,[(0,r.createElementVNode)("span",Zte,(0,r.toDisplayString)(e.info.description),1),((0,r.openBlock)(),(0,r.createElementBlock)("svg",{class:(0,r.normalizeClass)(["expand-icon",{expanded:i.value[s]}]),width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},t[13]||(t[13]=[(0,r.createElementVNode)("polyline",{points:"6 9 12 15 18 9"},null,-1)]),2))])],8,Hte),(0,r.createCommentVNode)(" 分类内容 "),i.value[s]?((0,r.openBlock)(),(0,r.createElementBlock)("div",Qte,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.prompts,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.key,class:"prompt-item"},[(0,r.createElementVNode)("div",{class:"prompt-header",onClick:t=>{return n=e.key,void(o.value[n]=!o.value[n]);var n}},[(0,r.createElementVNode)("div",tne,[(0,r.createCommentVNode)(" 启用/禁用开关 "),(0,r.createElementVNode)("label",{class:"toggle-switch",onClick:t[0]||(t[0]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("input",{type:"checkbox",checked:e.enabled,onChange:t=>async function(e,t){for(const n in a.value){const r=a.value[n].prompts.find(t=>t.key===e);if(r){r.enabled=t;break}}await Xc.promptStorage.setEnabled(e,t),await g({silent:!0}),X.o.info(t?"已启用":"已禁用")}(e.key,t.target.checked)},null,40,nne),t[14]||(t[14]=(0,r.createElementVNode)("span",{class:"toggle-slider"},null,-1))]),(0,r.createCommentVNode)(" 序号已包含在name中，不再单独显示 "),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["prompt-title",{disabled:!e.enabled}])},(0,r.toDisplayString)(e.name),3)]),(0,r.createElementVNode)("div",ane,[void 0!==e.weight?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:"weight-editor",onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},["stop"]))},[t[15]||(t[15]=(0,r.createElementVNode)("label",{class:"weight-label"},"W",-1)),(0,r.createElementVNode)("input",{type:"number",class:(0,r.normalizeClass)(["weight-input",(s=e.weight,s>=9?"weight-high":s>=6?"weight-medium":"weight-low")]),value:e.weight,min:"1",max:"10",disabled:n.value,onChange:t=>async function(e,t){const n=Math.min(10,Math.max(1,Math.round(t)));for(const t in a.value){const r=a.value[t].prompts.find(t=>t.key===e);if(r){r.weight=n,await Xc.promptStorage.save(e,r.content,r.enabled,n),await g({silent:!0}),X.o.success(`权重已更新为 ${n}`);break}}}(e.key,Number(t.target.value)),onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},["stop"]))},null,42,rne)])):(0,r.createCommentVNode)("v-if",!0),e.description?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:1,class:"prompt-desc",title:e.description},(0,r.toDisplayString)((i=e.description,i.length<=30?i:i.substring(0,30)+"...")),9,one)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["prompt-status",{modified:e.modified}])},(0,r.toDisplayString)(e.modified?"已修改":"默认"),3)])],8,ene),o.value[e.key]?((0,r.openBlock)(),(0,r.createElementBlock)("div",ine,[e.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",sne,(0,r.toDisplayString)(e.description),1)):(0,r.createCommentVNode)("v-if",!0),(0,r.withDirectives)((0,r.createElementVNode)("textarea",{"onUpdate:modelValue":t=>e.content=t,onInput:t=>function(e){for(const t in a.value){const n=a.value[t].prompts.find(t=>t.key===e);if(n){n.modified=n.content!==n.default;break}}}(e.key),rows:"20",class:(0,r.normalizeClass)(["prompt-textarea",{"readonly-mode":n.value}]),disabled:n.value},null,42,lne),[[r.vModelText,e.content]]),(0,r.createElementVNode)("div",cne,[(0,r.createElementVNode)("button",{class:"btn-small",onClick:t=>async function(e){for(const t in a.value){const n=a.value[t].prompts.find(t=>t.key===e);if(n){n.content=n.default,n.modified=!1,await Xc.promptStorage.reset(e),await g({silent:!0}),X.o.info(`已重置: ${n.name}`);break}}}(e.key),disabled:n.value},"重置为默认",8,dne),(0,r.createElementVNode)("button",{class:"btn-small",onClick:t=>function(e){for(const t in a.value){const n=a.value[t].prompts.find(t=>t.key===e);if(n){v((0,Kc.q3)("prompts",{[e]:n.content}),`prompt_${e}.json`);break}}}(e.key)},"导出此项",8,une),(0,r.createElementVNode)("button",{class:"btn-small btn-primary",onClick:t=>async function(e){for(const t in a.value){const n=a.value[t].prompts.find(t=>t.key===e);if(n){await Xc.promptStorage.save(e,n.content,n.enabled,n.weight),await g({silent:!0}),X.o.success(`已保存: ${n.name}`);break}}}(e.key),disabled:n.value},"保存修改",8,mne)])])):(0,r.createCommentVNode)("v-if",!0)]);var i,s}),128))])):(0,r.createCommentVNode)("v-if",!0)]))),128))])]))}});var gne=n(8345),hne={};hne.styleTagTransform=k(),hne.setAttributes=v(),hne.insert=h().bind(null,"head"),hne.domAPI=p(),hne.insertStyleElement=y(),u()(gne.A,hne),gne.A&&gne.A.locals&&gne.A.locals;const fne=(0,N.A)(pne,[["__scopeId","data-v-8a368f36"]]);var vne=n(3567);const bne={setup(){const e=(0,a.useRouter)(),t=()=>{e.push("/")},n=t=>{e.push("/game")};return()=>(0,r.h)(by,{fullscreen:!0,onClose:t,onCharacterSelected:n})}},yne=[{path:"/",name:"ModeSelection",component:W},{path:"/creation",name:"CharacterCreation",component:sc},{path:"/login",name:"Login",component:Wc},{path:"/workshop",name:"Workshop",component:mu},{path:"/account",name:"AccountCenter",component:Yx},{path:"/backend-admin",name:"BackendAdmin",component:jw},{path:"/prompts",name:"PromptsStandalone",component:fne},{path:"/game",name:"Game",component:Cx,children:[{path:"",name:"GameMain",component:ZS},{path:"memory",name:"Memory",component:yC},{path:"character-details",name:"CharacterDetails",component:CP},{path:"inventory",name:"Inventory",component:nO},{path:"relationships",name:"Relationships",component:Fj},{path:"techniques",name:"Techniques",component:Pq},{path:"thousand-dao",name:"ThousandDao",component:pH},{path:"settings",name:"Settings",component:gH.A},{path:"save",name:"Save",component:aW},{path:"world-map",name:"WorldMap",component:z5},{path:"events",name:"Events",component:n6},{path:"sect",name:"Sect",component:P8,children:[{path:"",redirect:{name:"SectOverview"}},{path:"overview",name:"SectOverview",component:C8},{path:"members",name:"SectMembers",component:g4},{path:"library",name:"SectLibrary",component:j4},{path:"contribution",name:"SectContribution",component:E7}]},{path:"game-variables",name:"GameVariables",component:Mte},{path:"prompts",name:"Prompts",component:fne},{path:"api-management",name:"APIManagement",component:vne.A}]},{path:"/management",name:"CharacterManagement",component:bne}],xne=(0,a.createRouter)({history:(0,a.createMemoryHistory)(),routes:yne})},1184:(e,t,n)=>{"use strict";n.d(t,{useGameStateStore:()=>l});var a=n(810),r=n(2224),o=n(8651),i=n(6585),s=n(4530);const l=(0,a.nY)("gameState",{state:()=>({saveMeta:null,onlineState:null,userSettings:null,character:null,attributes:null,location:null,inventory:null,equipment:null,relationships:null,worldInfo:null,sectSystem:null,sectMemberInfo:null,memory:null,gameTime:null,narrativeHistory:[],isGameLoaded:!1,thousandDao:null,eventSystem:{配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},cultivationTechnique:null,cultivation:null,techniqueSystem:null,skillState:null,effects:[],masteredSkills:null,systemConfig:null,body:null,bodyPartDevelopment:null,timeBasedSaveEnabled:!1,timeBasedSaveInterval:10,lastTimeBasedSave:null,conversationAutoSaveEnabled:!0}),actions:{async loadGame(e,t){console.log(`[GameState] Loading game for character ${e}, slot ${t}`);const{useCharacterStore:a}=await Promise.resolve().then(n.bind(n,4582)),r=a();if(!r.rootState.角色列表[e])return void console.error(`[GameState] Character ${e} not found`);const o=await r.loadSaveData(e,t);o?(this.loadFromSaveData(o),console.log("[GameState] Game loaded successfully")):console.error(`[GameState] No save data found for character ${e}, slot ${t}`)},async saveGame(){if(!this.isGameLoaded)return void console.warn("[GameState] Game not loaded, skipping save.");console.log("[GameState] Saving game state...");const{useCharacterStore:e}=await Promise.resolve().then(n.bind(n,4582)),t=e();await t.saveCurrentGame(),console.log("[GameState] Game saved successfully")},loadFromSaveData(e){const t=(0,s.ru)(e)?e:(0,s.jj)(e).migrated,n=e=>JSON.parse(JSON.stringify(e));this.saveMeta=t?.元数据?n(t.元数据):null,this.onlineState=t?.系统?.联机?n(t.系统.联机):null,this.userSettings=t?.系统?.设置?n(t.系统.设置):null;const a=(e,t)=>{if(!e||"object"!=typeof e)return;const n=e[t];if(null!=n)if("string"!=typeof n){if("object"==typeof n){const a=String(n.quality??n.品质??n.品阶??"");if(!a)return;e[t]=a.endsWith("品")?a:`${a}品`}}else n&&!n.endsWith("品")&&(e[t]=`${n}品`)},r=t?.角色?.身份?n(t.角色.身份):null,l=t?.角色?.属性?n(t.角色.属性):null,c=t?.角色?.位置?n(t.角色.位置):null;c&&"联机"===this.onlineState?.模式&&(delete c.x,delete c.y);const d=t?.角色?.背包?n(t.角色.背包):null,u=t?.角色?.装备?n(t.角色.装备):null,m=t?.社交?.关系?n(t.社交.关系):null,p=t?.世界?.信息?n(t.世界.信息):null,g=t?.社交?.宗门?n(t.社交.宗门):null,h=t?.社交?.宗门?.成员信息?n(t.社交.宗门.成员信息):null,f=t?.社交?.记忆?n(t.社交.记忆):null,v=t?.元数据?.时间?n(t.元数据.时间):null,b=Array.isArray(t?.系统?.历史?.叙事)?n(t.系统.历史.叙事):[],y=t?.角色?.大道?n(t.角色.大道):null,x=t?.社交?.事件?n(t.社交.事件):null,k=t?.角色?.修炼?n(t.角色.修炼):null,w=t?.角色?.功法?n(t.角色.功法):null,E=t?.角色?.技能?n(t.角色.技能):null,N=Array.isArray(t?.角色?.效果)?n(t.角色.效果):[],S=t?.系统?.配置?n(t.系统.配置):null,V=t?.角色?.身体?n(t.角色.身体):null;let _=V&&"object"==typeof V&&V.部位开发?n(V.部位开发):null;if(this.character=r,this.attributes=l,this.location=c,this.character?.灵根&&"object"==typeof this.character.灵根&&a(this.character.灵根,"tier"),this.attributes?.境界&&"object"==typeof this.attributes.境界&&(a(this.attributes.境界,"品质"),a(this.attributes.境界,"品阶")),this.inventory=d,this.equipment=u,this.relationships=m,this.worldInfo=p,this.sectSystem=g,this.sectMemberInfo=h,this.memory=f,this.gameTime=v,this.narrativeHistory=b,this.thousandDao=y?n(y):null,this.eventSystem=x?n(x):{配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},this.cultivation=k?n(k):null,this.cultivationTechnique=this.cultivation?.修炼功法??null,this.techniqueSystem=w?n(w):null,this.skillState=E?n(E):null,this.masteredSkills=this.skillState?.掌握技能?n(this.skillState.掌握技能):n(t?.系统?.缓存?.掌握技能??[]),this.effects=Array.isArray(N)?n(N):[],this.systemConfig=S?n(S):null,(0,o.isTavernEnv)()&&this.systemConfig&&(this.systemConfig=(0,i.Md)(this.systemConfig)),(0,o.isTavernEnv)()){const e=V&&"object"==typeof V?n(V):{};void 0===e.部位&&(e.部位={}),void 0===e.部位开发&&(e.部位开发=_??{}),_=e.部位开发??_,this.body=e}else this.body=V&&"object"==typeof V?n(V):null;this.bodyPartDevelopment=_?n(_):null,this.skillState||(this.skillState={掌握技能:this.masteredSkills??[],装备栏:[],冷却:{}}),this.cultivation||(this.cultivation={修炼功法:this.cultivationTechnique??null}),this.isGameLoaded=!0},toSaveData(){const e=[];if(this.character||e.push("character"),this.attributes||e.push("attributes"),this.location||e.push("location"),this.inventory||e.push("inventory"),this.relationships||e.push("relationships"),this.memory||e.push("memory"),this.gameTime||e.push("gameTime"),this.equipment||e.push("equipment"),e.length>0)return console.error("[gameStateStore.toSaveData] 存档数据不完整，缺少以下字段:",e.join(", ")),console.error("[gameStateStore.toSaveData] 联机状态:",this.onlineState),console.error("[gameStateStore.toSaveData] 游戏是否已加载:",this.isGameLoaded),null;const t=e=>JSON.parse(JSON.stringify(e)),n=function(e){const t={},n=e?.物品||{};return Object.values(n).forEach(e=>{if("功法"!==e?.类型)return;const n=e.物品ID;n&&(t[n]={熟练度:Number(e.修炼进度??e.熟练度??0),已解锁技能:Array.isArray(e.已解锁技能)?e.已解锁技能:[]})}),t}(this.inventory),a=this.cultivationTechnique?.物品ID??null,r={...this.techniqueSystem||{},当前功法ID:this.techniqueSystem?.当前功法ID??a,功法进度:this.techniqueSystem?.功法进度??n,功法套装:this.techniqueSystem?.功法套装??{主修:null,辅修:[]}},i={...this.skillState||{},掌握技能:this.skillState?.掌握技能??this.masteredSkills??[],装备栏:this.skillState?.装备栏??[],冷却:this.skillState?.冷却??{}},s={...this.cultivation||{},修炼功法:this.cultivation?.修炼功法??this.cultivationTechnique??null},l=(new Date).toISOString(),c={...this.saveMeta||{},版本号:3,存档ID:this.saveMeta?.存档ID??`save_${Date.now()}`,存档名:this.saveMeta?.存档名??"自动存档",游戏版本:this.saveMeta?.游戏版本,创建时间:this.saveMeta?.创建时间??l,更新时间:l,游戏时长秒:Number(this.saveMeta?.游戏时长秒??0),时间:this.gameTime},d=this.thousandDao&&"object"==typeof this.thousandDao&&this.thousandDao.大道列表?this.thousandDao:{大道列表:{}},u=this.sectSystem||this.sectMemberInfo?{...this.sectSystem||{},...this.sectMemberInfo?{成员信息:this.sectMemberInfo}:{}}:null,m=this.userSettings??{timeBasedSaveEnabled:this.timeBasedSaveEnabled,timeBasedSaveInterval:this.timeBasedSaveInterval,conversationAutoSaveEnabled:this.conversationAutoSaveEnabled},p=this.onlineState??{模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"},g=t(this.location);g&&"联机"===p?.模式&&(delete g.x,delete g.y);const h=(()=>{const e=this.body&&"object"==typeof this.body?t(this.body):{};return this.bodyPartDevelopment&&"object"==typeof this.bodyPartDevelopment&&(e.部位开发=t(this.bodyPartDevelopment)),(0,o.isTavernEnv)()&&(void 0===e.部位&&(e.部位={}),void 0===e.部位开发&&(e.部位开发={})),Object.keys(e).length>0?e:void 0})(),f={元数据:c,角色:{身份:this.character,属性:this.attributes,位置:g,效果:this.effects??[],身体:h,背包:this.inventory,装备:this.equipment,功法:r,修炼:s,大道:d,技能:i},社交:{关系:this.relationships??{},宗门:u,事件:this.eventSystem,记忆:this.memory},世界:{信息:this.worldInfo??{},状态:{}},系统:{配置:this.systemConfig??{},设置:m,缓存:{掌握技能:this.masteredSkills??i?.掌握技能??[]},历史:{叙事:this.narrativeHistory||[]},扩展:{},联机:p}};return t(f)},updatePlayerStatus(e){this.attributes&&(this.attributes={...this.attributes,...e})},updateLocation(e){this.location&&(this.location={...this.location,...e})},updateInventory(e){this.inventory&&(this.inventory={...this.inventory,...e})},updateRelationship(e,t){this.relationships&&this.relationships[e]&&(this.relationships[e]={...this.relationships[e],...t})},advanceGameTime(e){if(this.gameTime){if(this.gameTime.分钟+=e,this.gameTime.分钟>=60){const e=Math.floor(this.gameTime.分钟/60);this.gameTime.分钟=this.gameTime.分钟%60,this.gameTime.小时+=e}if(this.gameTime.小时>=24){const e=Math.floor(this.gameTime.小时/24);this.gameTime.小时=this.gameTime.小时%24,this.gameTime.日+=e}if(this.gameTime.日>30){const e=Math.floor((this.gameTime.日-1)/30);this.gameTime.日=(this.gameTime.日-1)%30+1,this.gameTime.月+=e}if(this.gameTime.月>12){const e=Math.floor((this.gameTime.月-1)/12);this.gameTime.月=(this.gameTime.月-1)%12+1,this.gameTime.年+=e}}},resetState(){this.saveMeta=null,this.onlineState=null,this.userSettings=null,this.character=null,this.attributes=null,this.location=null,this.inventory=null,this.equipment=null,this.relationships=null,this.worldInfo=null,this.sectSystem=null,this.sectMemberInfo=null,this.memory=null,this.gameTime=null,this.narrativeHistory=[],this.isGameLoaded=!1,this.thousandDao=null,this.eventSystem={配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},this.cultivationTechnique=null,this.cultivation=null,this.techniqueSystem=null,this.skillState=null,this.effects=[],this.masteredSkills=null,this.systemConfig=null,this.body=null,this.bodyPartDevelopment=null,console.log("[GameState] State has been reset")},async saveAfterConversation(){if(!this.isGameLoaded)return void console.warn("[GameState] Game not loaded, skipping save");console.log("[GameState] Saving after conversation...");const{useCharacterStore:e}=await Promise.resolve().then(n.bind(n,4582)),t=e();await t.saveCurrentGame(),await this.checkAndCreateTimeBasedSave()},async checkAndCreateTimeBasedSave(){if(!this.timeBasedSaveEnabled)return;const e=Date.now(),t=60*this.timeBasedSaveInterval*1e3;if(this.lastTimeBasedSave&&e-this.lastTimeBasedSave<t)return;console.log("[GameState] Updating time-based save slot...");const{useCharacterStore:a}=await Promise.resolve().then(n.bind(n,4582)),r=a();await r.saveToSlot("时间点存档"),this.lastTimeBasedSave=e,console.log("[GameState] Time-based save slot updated: 时间点存档")},async saveBeforeExit(){this.isGameLoaded&&(console.log("[GameState] Saving before exit..."),await this.saveGame())},setTimeBasedSaveInterval(e){e<1?console.warn("[GameState] Invalid interval, must be at least 1 minute"):(this.timeBasedSaveInterval=e,console.log(`[GameState] Time-based save interval set to ${e} minutes`))},setTimeBasedSaveEnabled(e){this.timeBasedSaveEnabled=e,console.log("[GameState] Time-based save "+(e?"enabled":"disabled"))},setConversationAutoSaveEnabled(e){this.conversationAutoSaveEnabled=e,console.log("[GameState] Conversation auto save "+(e?"enabled":"disabled"))},getCurrentSaveData(){return this.toSaveData()},updateState(e,t){console.log(`[诊断-updateState] 开始更新路径: ${e}`),console.log("[诊断-updateState] 要设置的值:",t);const n=e.split("."),a=n[0];if(console.log("[诊断-updateState] rootKey:",a),console.log("[诊断-updateState] 路径部分:",n),1===n.length)return this[a]=t,void console.log("[诊断-updateState] 顶层属性直接设置完成");const o=this[a];if(console.log("[诊断-updateState] 当前rootKey的值:",o),o&&"object"==typeof o){const i=(0,r.cloneDeep)(o);console.log("[诊断-updateState] 深拷贝后的clonedRoot:",i);const s=n.slice(1).join(".");console.log("[诊断-updateState] 嵌套路径:",s),console.log("[诊断-updateState] set前的value类型:",typeof t,"value:",t),(0,r.set)(i,s,t),console.log("[诊断-updateState] lodash set后的clonedRoot:",i),console.log("[诊断-updateState] set后检查实际值:",(0,r.get)(i,s)),this.$patch({[a]:i}),console.log("[诊断-updateState] 已通过$patch更新root对象"),console.log(`[gameStateStore] ✅ 已更新 ${e} = ${JSON.stringify(t).substring(0,100)}`)}else console.log("[诊断-updateState] currentRoot不是对象，直接设置"),(0,r.set)(this,e,t)},addToShortTermMemory(e){this.memory||(this.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(this.memory.短期记忆)||(this.memory.短期记忆=[]),Array.isArray(this.memory.中期记忆)||(this.memory.中期记忆=[]),Array.isArray(this.memory.隐式中期记忆)||(this.memory.隐式中期记忆=[]);const t=this.gameTime,n=t?.分钟??0,a=t?`【仙道${t.年}年${t.月}月${t.日}日 ${String(t.小时).padStart(2,"0")}:${String(n).padStart(2,"0")}】`:"【未知时间】",r=e.startsWith("【仙道")||e.startsWith("【未知时间】")||e.startsWith("【仙历")?e:`${a}${e}`;this.memory.短期记忆.unshift(r),this.memory.隐式中期记忆.unshift(r);const o=(()=>{try{const e=localStorage.getItem("memory-settings");return e&&JSON.parse(e).maxShortTerm||3}catch{return 3}})();for(;this.memory.短期记忆.length>o;){this.memory.短期记忆.pop();const e=this.memory.隐式中期记忆.pop();e&&!this.memory.中期记忆.includes(e)&&(this.memory.中期记忆.push(e),console.log("[gameStateStore] ✅ 短期记忆溢出，已转移到中期记忆"))}console.log("[gameStateStore] ✅ 已添加到短期记忆",r.substring(0,50)+"...")}}})},1208:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(6623),n.b),d=i()(r()),u=l()(c);d.push([e.id,`@font-face {\n  font-family: 'PangMenZhengDaoTitle';\n  src: url(${u}) format('truetype');\n  font-weight: 400;\n  font-style: normal;\n  font-display: swap;\n}\n\n/* --- Design Tokens (The Alchemist's Formula) --- */\n:root {\n  /* --- Light Theme Colors (现代深邃版) --- */\n  --color-background: #c8c3b8; /* 更深的基底色，增加层次 */\n  --color-background-transparent: rgba(200, 195, 184, 0.92);\n  --color-surface: #d8d4c9; /* 面板色，比背景稍亮 */\n  --color-surface-transparent: rgba(216, 212, 201, 0.88);\n  --color-surface-light: #cec9bd; /* 更深一档做层次 */\n  /* Derived/interactive states (light) */\n  --color-surface-hover: #e0dcd2; /* 悬浮时的柔和色 */\n  --color-primary: #1e4a9a; /* 更深的主色调 */\n  --color-primary-rgb: 30, 74, 154;\n  --color-primary-hover: #163d82;\n  --color-primary-active: #0f2f6a;\n  /* Lighten variant used by some components */\n  --color-primary-light: rgba(30, 74, 154, 0.15);\n  --color-accent: #2e8b57; /* 翠玉绿 - 修仙风格 */\n  --color-accent-hover: #267349;\n  --color-accent-light: rgba(46, 139, 87, 0.18);\n  --color-text: #1a1a1a;\n  --color-text-secondary: #4a4a4a; /* 更深，提高对比度 */\n  --color-text-muted: #5a5a5a; /* 更深，提高对比度 */\n  --color-white-soft: #f1eee7; /* 柔和的白色 */\n  --color-border: rgba(0, 0, 0, 0.15); /* 更明显的边框 */\n  --color-border-hover: rgba(0, 0, 0, 0.28);\n  --color-success: #2e8b32; /* 更深的绿色，提高可读性 */\n  --color-success-hover: #267529;\n  --color-warning: #e68a00; /* 更深的橙色 */\n  --color-warning-hover: #cc7a00;\n  --color-error: #dc2626; /* 更深的红色 */\n  --color-error-hover: #c22050;\n  --color-info: #2196f3;\n  --color-info-hover: #1e88e5;\n  /* Keep danger alias for components that expect it */\n  --color-danger: var(--color-error);\n  --color-danger-hover: #e53935;\n  /* Generic hover background alias used in components */\n  --color-hover: var(--color-surface-hover);\n  /* Code block background used in data views */\n  --color-code-bg: #0f172a0f; /* subtle deep slate with opacity */\n  /* Global scrollbar tokens (light) – hide track, show only thumb */\n  --scrollbar-track-color: transparent;\n  --scrollbar-thumb-color: rgba(0, 0, 0, 0.35);\n  --scrollbar-thumb-hover-color: rgba(0, 0, 0, 0.5);\n\n  /* Vital colors (light theme) */\n  --vital-health: #ff2929;   /* 气血/健康（与 --color-error 保持一致） */\n  --vital-lingqi: #3b82f6;   /* 灵气(统一蓝) */\n  --vital-spirit: #ffeb00;   /* 神识(金色) */\n  --vital-lifespan: #c253ff; /* 寿元(紫色) */\n\n  /* Derived RGB triplets for rgba() usage (light) */\n  --color-background-rgb: 200, 195, 184;\n  --color-surface-rgb: 216, 212, 201;\n  --color-accent-rgb: 46, 139, 87;\n  --color-border-rgb: 0, 0, 0;\n  --color-success-rgb: 46, 139, 50;\n  --color-warning-rgb: 230, 138, 0;\n  --color-error-rgb: 220, 38, 38;\n  --color-info-rgb: 33, 150, 243;\n\n  /* UI缩放变量 */\n  --ui-scale: 1;\n  --base-font-size: 1rem;\n\n  /* 字体与过渡 */\n  --font-family-serif: 'PangMenZhengDaoTitle', 'SimSun', 'NSimSun', 'STSong', '宋体', 'Noto Serif SC', 'KaiTi', 'STKaiti', serif;\n  --font-family-sans-serif: 'PangMenZhengDaoTitle', 'SimSun', 'NSimSun', 'STSong', '宋体', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  --transition-fast: all 0.2s ease-in-out;\n}\n\n/* --- 暗色主题灵脉: "松烟玄墨" (通过 data-theme 属性激活) --- */\n:root[data-theme='dark'] {\n  /* --- Dark Theme Colors --- */\n  --color-background: rgb(30, 41, 59);\n  --color-background-transparent: rgba(26, 27, 38, 0.85);\n  --color-surface: #232e40;\n  --color-surface-transparent: rgba(41, 51, 72, 0.6);\n  --color-surface-light: #414868;\n  /* Derived/interactive states (dark) */\n  --color-surface-hover: #33415f;\n  --color-primary: #82a3f5;\n  --color-primary-rgb: 130, 163, 245;\n  --color-primary-hover: #6f93f2;\n  --color-primary-active: #597ee6;\n  --color-primary-light: rgba(130, 163, 245, 0.18);\n  --color-accent: #7dd3a0; /* 翠玉绿 - 暗色主题 */\n  --color-accent-hover: #6bc48e;\n  --color-accent-light: rgba(125, 211, 160, 0.15);\n  --color-text: #f7f7f5; /* 柔和的暖白色，不那么刺眼 */\n  --color-text-secondary: #d0d0d0;\n  --color-text-muted: #b9b9b9; /* 增强对比度 */\n  --color-white-soft: #f7f7f5; /* 暗色主题下的柔和白色 */\n  --color-border: rgba(173, 216, 230, 0.5);\n  --color-border-hover: rgba(173, 216, 230, 0.8);\n  --color-success: #9ece6a;\n  --color-success-hover: #88b85b;\n  --color-warning: #ffd500;\n  --color-warning-hover: #e6c200;\n  --color-error: #ff2f49; /* 暗色下更红一些 */\n  --color-error-hover: #e64470;\n  --color-info: #77cdfe;\n  --color-info-hover: #66bff4;\n  --color-danger: var(--color-error);\n  --color-danger-hover: #e66a81;\n  --color-hover: var(--color-surface-hover);\n  --color-code-bg: rgba(20, 26, 43, 0.6);\n  /* Global scrollbar tokens (dark) – hide track, show only thumb */\n  --scrollbar-track-color: transparent;\n  --scrollbar-thumb-color: rgba(255, 255, 255, 0.35);\n  --scrollbar-thumb-hover-color: rgba(255, 255, 255, 0.5);\n\n  /* Vital colors (dark theme) */\n  --vital-health: #ff2f49;   /* 气血/健康（暗色，与 --color-error 保持一致） */\n  --vital-lingqi: #3b82f6;   /* 灵气(统一蓝) */\n  --vital-spirit: #ffeb00;   /* 神识(金色) */\n  --vital-lifespan: #c253ff; /* 寿元(紫色) */\n\n  /* Derived RGB triplets for rgba() usage (dark) */\n  --color-background-rgb: 26, 27, 38;\n  --color-surface-rgb: 41, 51, 72;\n  --color-accent-rgb: 125, 211, 160;\n  --color-border-rgb: 173, 216, 230;\n  --color-success-rgb: 158, 206, 106;\n  --color-warning-rgb: 255, 213, 0;\n  --color-error-rgb: 255, 47, 73;\n  --color-info-rgb: 119, 205, 254;\n}\n\n/* --- Base Styles --- */\nhtml,\nbody {\n  /* 高度将由 App.vue 中的脚本动态设置，此处不应有 height 或 min-height */\n  margin: 0;\n  padding: 0;\n  /* 移除 overflow: hidden; 应用内滚动由 #app 控制 */\n  font-family: var(--font-family-serif);\n  /* 透明背景以显示视频背景（VideoBackground组件使用z-index:-10） */\n  background-color: transparent;\n  color: var(--color-text);\n  /* 遵道友法旨，去除所有文字阴影，返璞归真。 */\n  text-shadow: none;\n  /* 确保在iframe中也能正确填充 */\n  width: 100%;\n  height: 100%;\n}\n\n#app {\n  position: absolute; /* 使用绝对定位强制撑满body */\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 100%;\n  width: 100%;\n  box-sizing: border-box;\n  overflow: auto; /* 应用内的滚动由app自身管理 */\n  /* 应用UI缩放，使用zoom属性（Chrome, Safari等支持） */\n  zoom: var(--ui-scale);\n  /* 应用基础字体大小 */\n  font-size: var(--base-font-size);\n  /* 透明背景以显示视频背景 */\n  background-color: transparent;\n}\n\n#app-container {\n  width: 100%;\n  height: 100%;\n  min-height: 100%;\n  /* 透明背景以显示视频背景 */\n  background-color: transparent;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  overflow-x: hidden;\n  position: relative;\n}\n\n/* --- Reusable Button Class (The Master's Touch) --- */\n.btn {\n  display: inline-block;\n  padding: 0.75rem 1.5rem;\n  border: 1px solid var(--color-primary);\n  border-radius: 8px;\n  background-color: transparent;\n  color: var(--color-primary);\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  font-weight: bold;\n  text-align: center;\n  text-decoration: none;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  user-select: none; /* Prevent text selection on click */\n  position: relative;\n  overflow: hidden;\n}\n\n/* --- Button States (Guaranteed Visual Feedback) --- */\n.btn:hover {\n  background-color: var(--color-primary);\n  color: #fff;\n  box-shadow: 0 0 15px rgba(200, 160, 100, 0.5);\n}\n\n.btn:active {\n  transform: scale(0.98);\n  background-color: var(--color-primary-active);\n  border-color: var(--color-primary-active);\n  box-shadow: none;\n}\n\n.btn:focus-visible {\n  outline: 2px solid var(--color-primary-hover);\n  outline-offset: 2px;\n}\n\n/* --- Disabled Button State --- */\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background-color: transparent;\n  color: var(--color-border);\n  border-color: var(--color-border);\n  box-shadow: none;\n}\n\n/* --- 移除流光特效 --- */\n\n/* --- Button Variants --- */\n.btn.btn-secondary {\n  border-color: var(--color-border);\n  color: var(--color-text);\n}\n\n.btn.btn-secondary:hover {\n  background-color: var(--color-surface);\n  border-color: var(--color-text);\n}\n\n.btn.btn-complete {\n  border-color: var(--color-accent); /* 青玉色 */\n  color: var(--color-accent);\n  animation: pulse-glow 2s ease-in-out infinite;\n}\n\n.btn.btn-complete:hover {\n  background-color: var(--color-accent);\n  color: #fff;\n  box-shadow: 0 0 20px rgba(111, 179, 184, 0.5);\n}\n\n@keyframes pulse-glow {\n  0%,\n  100% {\n    box-shadow: 0 0 10px rgba(111, 179, 184, 0.3);\n  }\n  50% {\n    box-shadow: 0 0 20px rgba(111, 179, 184, 0.6);\n  }\n}\n\n/* --- 全局滚动条美化 (兼容 WebKit & Firefox) --- */\n/* WebKit browsers (Chrome, Safari, Edge) */\n#app::-webkit-scrollbar {\n  width: 10px; /* 稍微加宽以获得更好的点击区域 */\n  height: 10px;\n}\n\n#app::-webkit-scrollbar-track {\n  background: var(--scrollbar-track-color);\n}\n\n#app::-webkit-scrollbar-thumb {\n  background-color: var(--scrollbar-thumb-color);\n  border-radius: 5px;\n  border: 2px solid transparent;\n  background-clip: content-box;\n  transition: background-color 0.3s ease-in-out;\n}\n\n#app::-webkit-scrollbar-thumb:hover {\n  background-color: var(--scrollbar-thumb-hover-color);\n}\n\n/* Firefox */\n#app {\n  scrollbar-width: thin;\n  scrollbar-color: var(--scrollbar-thumb-color) var(--scrollbar-track-color);\n}\n\n/* --- 通用法器样式：卡片/面板 (浮空术) --- */\n.card-panel {\n  background: var(--color-surface);\n  border: 2px solid var(--color-primary); /* 坚固、醒目的主色边框 */\n  border-radius: 12px;\n  box-shadow: none; /* 移除所有阴影 */\n  transition: border-color 0.3s ease;\n}\n\n.card-panel:hover {\n  border-color: var(--color-primary-hover); /* 悬浮时边框颜色变亮 */\n  transform: none; /* 移除悬浮时的位移 */\n}\n\n/* --- 新增样式：世界推演动画 (for Login Button) --- */\n.btn.is-loading .btn-text {\n  opacity: 0; /* Hide original text */\n}\n\n.btn.is-loading::before,\n.btn.is-loading::after {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 20px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 2px solid var(--color-primary);\n  animation-duration: 1.5s;\n  animation-iteration-count: infinite;\n  animation-timing-function: ease-in-out;\n}\n\n.btn.is-loading::before {\n  border-style: solid solid dashed dashed;\n  animation-name: spin-left;\n}\n\n.btn.is-loading::after {\n  border-style: dashed dashed solid solid;\n  animation-name: spin-right;\n}\n\n@keyframes spin-left {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n@keyframes spin-right {\n  from { transform: rotate(360deg); }\n  to { transform: rotate(0deg); }\n}\n\n/* --- 新增样式：开天辟地 (for MainGame Empty State) --- */\n.genesis-prompt {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  padding: 2rem;\n  text-align: center;\n  background: radial-gradient(ellipse at center, var(--color-surface-light) 0%, var(--color-background) 70%);\n}\n\n.genesis-title {\n  font-family: var(--font-family-serif);\n  font-size: 2.5rem;\n  color: var(--color-primary);\n  margin-bottom: 1rem;\n  text-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n\n.genesis-subtitle {\n  font-size: 1.2rem;\n  color: var(--color-text-secondary);\n  max-width: 500px;\n  margin-bottom: 3rem;\n}\n\n.genesis-cta {\n  padding: 1.2rem 2.5rem;\n  font-size: 1.5rem;\n  border-width: 2px;\n  animation: pulse-glow 2.5s ease-in-out infinite;\n}\n\n/* --- 新增样式：道途选择界面 --- */\n.mode-selection-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  max-height: 800px; /* 限制最大高度适应iframe */\n  overflow-y: auto;\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  align-items: center; /* 水平居中 */\n  justify-content: center; /* 垂直居中 */\n  padding: 1rem 0; /* 减小内部垂直边距 */\n  box-sizing: border-box; /* 确保 padding 不会导致溢出 */\n  background: transparent; /* 透明背景以显示视频 */\n}\n\n.video-background {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: translate(-50%, -50%);\n  z-index: -2;\n}\n\n.video-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5); /* 默认遮罩，暗色主题下可调整 */\n  z-index: -1;\n}\n\n:root[data-theme='dark'] .video-overlay {\n    background-color: rgba(10, 15, 24, 0.4); /* 降低遮罩透明度，让背景更亮 */\n}\n\n.selection-content {\n  position: relative;\n  z-index: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 1.5rem;\n  background: var(--color-surface-light);\n  border-radius: 16px;\n  border: 1px solid var(--color-border);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  width: 90%;\n  max-width: 1000px;\n  max-height: calc(100% - 2rem); /* 确保不超出容器 */\n  overflow-y: auto; /* 允许内容滚动 */\n  /* 移除 margin，由父容器的 padding 控制间距 */\n}\n\n.main-title {\n  font-family: var(--font-family-serif);\n  font-size: 3rem;\n  font-weight: 500;\n  margin-bottom: 2.5rem;\n  letter-spacing: 0.2em;\n  text-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.4);\n}\n\n.paths-container {\n  display: flex;\n  justify-content: center;\n  gap: 3rem;\n  width: 100%;\n}\n\n.path-card {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 2rem;\n  border-radius: 1rem;\n  border: 2px solid var(--color-primary);\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.3s ease-in-out;\n  position: relative;\n  overflow: hidden;\n}\n\n.path-card:hover {\n  transform: translateY(-10px);\n  background: rgba(var(--color-primary-rgb), 0.4);\n}\n\n.path-card .path-icon {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    color: var(--color-primary);\n    transition: var(--transition-fast);\n}\n\n.path-card:hover .path-icon {\n    color: var(--color-accent);\n    transform: scale(1.1);\n}\n\n.path-title {\n  font-family: var(--font-family-serif);\n  font-size: 1.75rem;\n  margin-bottom: 0.75rem;\n}\n\n.path-description {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n  max-width: 300px;\n}\n\n.bottom-actions {\n  position: fixed;\n  z-index: 100; /* Ensure it's on top of everything */\n  bottom: 2rem;\n  right: 2rem;\n  display: flex;\n  gap: 1rem;\n}\n\n.action-btn {\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.5rem;\n  border: 1px solid var(--color-border);\n  background-color: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  backdrop-filter: blur(5px);\n}\n\n.action-btn:hover {\n  background-color: var(--color-surface-light);\n  color: var(--color-text);\n  border-color: var(--color-border-hover);\n  transform: scale(1.1);\n}\n\n/* --- 通用法器样式：模态对话框/弹窗 (须弥芥子) --- */\n.modal-dialog {\n  background-color: var(--color-surface);\n  color: var(--color-text); /* 显式设置文字颜色，防止继承问题 */\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 1.5rem;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n}\n\n:root[data-theme='dark'] .modal-dialog {\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n}\n\n/* --- 全局操作按钮样式 (新版) --- */\n.global-actions {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  z-index: 1000;\n  display: flex;\n  gap: 12px;\n  pointer-events: auto;\n}\n\n.theme-toggle,\n.fullscreen-toggle {\n  --color: #555560;\n  --size: 24px;\n  width: 48px;\n  height: 48px;\n  border: none;\n  border-radius: 12px;\n  background: rgba(230, 226, 217, 0.92); /* 使用更柔和的背景色 */\n  backdrop-filter: blur(10px);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);\n  color: var(--color);\n  font-size: var(--size);\n  user-select: none;\n  fill: var(--color);\n}\n\n.theme-toggle:hover,\n.fullscreen-toggle:hover {\n  transform: translateY(-2px) scale(1.05);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);\n  background: rgba(220, 216, 207, 0.95); /* 悬浮时稍深 */\n}\n\n.theme-toggle:active,\n.fullscreen-toggle:active {\n  transform: translateY(0);\n}\n\n/* 主题切换图标 */\n.theme-toggle .moon {\n  position: absolute;\n  animation: keyframes-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.theme-toggle .sun {\n  position: absolute;\n  display: none;\n  animation: keyframes-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.theme-toggle input:checked ~ .moon {\n  display: none;\n}\n\n.theme-toggle input:checked ~ .sun {\n  display: block;\n}\n\n/* 全屏切换图标 */\n.fullscreen-toggle .expand {\n  position: absolute;\n  animation: fullscreen-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.fullscreen-toggle .compress {\n  position: absolute;\n  display: none;\n  animation: fullscreen-fill .5s;\n  width: 24px;\n  height: 24px;\n}\n\n.fullscreen-toggle input:checked ~ .expand {\n  display: none;\n}\n\n.fullscreen-toggle input:checked ~ .compress {\n  display: block;\n}\n\n/* 隐藏checkbox */\n.theme-toggle input,\n.fullscreen-toggle input {\n  position: absolute;\n  opacity: 0;\n  cursor: pointer;\n  height: 0;\n  width: 0;\n}\n\n/* 动画效果 */\n@keyframes keyframes-fill {\n  0% {\n    transform: rotate(-360deg) scale(0);\n    opacity: 0;\n  }\n  75% {\n    transform: rotate(25deg);\n  }\n  100% {\n    transform: rotate(0deg) scale(1);\n    opacity: 1;\n  }\n}\n\n@keyframes fullscreen-fill {\n  0% {\n    transform: scale(0);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n/* 暗色主题适配 */\n[data-theme="dark"] .theme-toggle,\n[data-theme="dark"] .fullscreen-toggle {\n  background: rgba(41, 51, 72, 0.9);\n  --color: #82A3F5;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n[data-theme="dark"] .theme-toggle:hover,\n[data-theme="dark"] .fullscreen-toggle:hover {\n  background: rgba(41, 51, 72, 0.95);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);\n}\n\n/* --- App Root & Transitions --- */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.3s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n\n/* #app-container 样式已在上方定义，此处合并 */\n\n/* --- Author Modal Styles --- */\n.author-modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(5px);\n}\n\n.author-modal {\n  background: var(--color-surface);\n  padding: 1.5rem 2rem;\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n  width: 90%;\n  max-width: 500px;\n  color: var(--color-text);\n}\n\n.author-modal-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid var(--color-border);\n  padding-bottom: 1rem;\n  margin-bottom: 1rem;\n}\n\n.author-modal-header h3 {\n  margin: 0;\n  font-size: 1.4rem;\n  font-family: var(--font-family-serif);\n}\n\n.author-modal-body p {\n  margin: 0.8rem 0;\n  font-size: 1rem;\n  line-height: 1.6;\n}\n\n.author-modal-body a {\n  color: var(--color-primary);\n  text-decoration: none;\n  word-break: break-all;\n}\n\n.author-modal-body a:hover {\n  text-decoration: underline;\n}\n\n.close-btn {\n  background: none;\n  border: none;\n  font-size: 2rem;\n  color: var(--color-text-muted);\n  cursor: pointer;\n  line-height: 1;\n  padding: 0;\n}\n\n.close-btn:hover {\n  color: var(--color-text);\n}\n`,""]);const m=d},1211:(e,t,n)=>{"use strict";n.d(t,{N:()=>d});var a=n(810),r=n(4061),o=n(7445),i=n(8651),s=n(9333),l=n(7527);function c(e){if(null===e||"object"!=typeof e)return!1;const t=e;return Array.isArray(t.worlds)&&Array.isArray(t.talentTiers)&&Array.isArray(t.origins)&&Array.isArray(t.spiritRoots)&&Array.isArray(t.talents)}const d=(0,a.nY)("characterCreation",()=>{const e=(0,r.ref)("single"),t=(0,r.ref)(!1),a=(0,r.ref)(null),d=(0,r.ref)({worlds:[],talentTiers:[],origins:[],spiritRoots:[],talents:[]}),u=(0,r.ref)({gender:"男",character_name:"无名者",race:"人族",world_id:"",talent_tier_id:"",current_age:16,root_bone:0,spirituality:0,comprehension:0,fortune:0,charm:0,temperament:0,origin_id:null,spirit_root_id:null,selected_talent_ids:[]}),m=(0,r.ref)(1),p=(0,r.ref)(!0),g=(0,r.ref)(null),h=(0,r.ref)(!0),f=(0,r.ref)("generate"),v=(0,r.ref)({majorFactionsCount:5,totalLocations:12,secretRealmsCount:5,continentCount:4,generateOnlyContinents:!0}),b=(0,r.ref)("普通"),y={简单:"【难度模式：简单】\n- 世界对主角较为友善，机缘频繁出现\n- 敌人实力普遍较弱，战斗容易获胜\n- 资源获取容易，修炼进度较快\n- 突破瓶颈的难度降低\n- NPC对主角态度友好，容易获得帮助",普通:"【难度模式：普通】\n- 世界遵循正常修仙规则，机缘与危险并存\n- 敌人实力与主角相当，战斗需要策略\n- 资源获取需要努力，修炼进度正常\n- 突破瓶颈需要积累和机缘\n- NPC态度中立，需要建立关系",困难:"【难度模式：困难】\n- 世界充满危险，机缘稀少且竞争激烈\n- 敌人实力普遍较强，战斗需要谨慎\n- 资源稀缺，修炼进度缓慢\n- 突破瓶颈困难重重，需要特殊机缘\n- NPC对主角态度冷淡，需要付出代价获得帮助",噩梦:"【难度模式：噩梦】\n- 世界极度危险，处处是陷阱和敌人\n- 敌人实力远超主角，战斗九死一生\n- 资源极度稀缺，修炼举步维艰\n- 突破瓶颈几乎不可能，需要逆天机缘\n- NPC对主角充满敌意，信任难以建立\n- 死亡风险极高，每一步都需谨慎"},x=(0,r.computed)(()=>y[b.value]);try{const e=o.aiService.getConfig();h.value=!1!==e.streaming,f.value="generateRaw"===e.initMode?"generateRaw":"generate"}catch{}try{const e=localStorage.getItem("dad_creation_useStreamingStart");null!==e&&(h.value="false"!==e);const t=localStorage.getItem("dad_creation_generateMode");"generate"!==t&&"generateRaw"!==t||(f.value=t)}catch{}try{const e=localStorage.getItem("dad_start_config");e&&(e=>{if(!e||"object"!=typeof e)return;const t=e,n=t.ai&&"object"==typeof t.ai?t.ai:t,a=n.streaming??n.useStreamingStart;"boolean"==typeof a&&(h.value=a);const r=n.initMode??n.generateMode;"generate"!==r&&"generateRaw"!==r||(f.value=r);const o=t.world&&"object"==typeof t.world?t.world:t.worldGenerationConfig&&"object"==typeof t.worldGenerationConfig?t.worldGenerationConfig:null,i=(e,t,n)=>{const a=Number(e);if(!Number.isFinite(a))return null;const r=Math.floor(a);return Math.min(n,Math.max(t,r))};if(o){const e={...v.value},t=i(o.majorFactionsCount,1,30),n=i(o.totalLocations,1,60),a=i(o.secretRealmsCount,0,30),r=i(o.continentCount,1,12);null!==t&&(e.majorFactionsCount=t),null!==n&&(e.totalLocations=n),null!==a&&(e.secretRealmsCount=a),null!==r&&(e.continentCount=r),v.value=e}const s=t.character&&"object"==typeof t.character?t.character:null;if(s){const e={...u.value},t="string"==typeof s.character_name?s.character_name.trim():null,n="string"==typeof s.gender?s.gender.trim():null,a="string"==typeof s.race?s.race.trim():null,r=i(s.current_age,1,3e3);t&&(e.character_name=t),n&&(e.gender=n),a&&(e.race=a),null!==r&&(e.current_age=r),u.value=e}})(JSON.parse(e))}catch{}(0,r.watch)(h,e=>{try{localStorage.setItem("dad_creation_useStreamingStart",String(e))}catch{}}),(0,r.watch)(f,e=>{try{localStorage.setItem("dad_creation_generateMode",e)}catch{}});const k=(0,r.computed)(()=>7),w=(0,r.computed)(()=>({root_bone:u.value.root_bone,spirituality:u.value.spirituality,comprehension:u.value.comprehension,fortune:u.value.fortune,charm:u.value.charm,temperament:u.value.temperament})),E=(0,r.computed)(()=>d.value.worlds.find(e=>e.id===u.value.world_id)||null),N=(0,r.computed)(()=>d.value.talentTiers.find(e=>e.id===u.value.talent_tier_id)||null),S=(0,r.computed)(()=>d.value.origins.find(e=>e.id===u.value.origin_id)||null),V=(0,r.computed)(()=>d.value.spiritRoots.find(e=>e.id===u.value.spirit_root_id)||null),_=(0,r.computed)(()=>d.value.talents.filter(e=>u.value.selected_talent_ids.includes(e.id))),C=(0,r.computed)(()=>{let e=0;return _.value.some(e=>"霸王血脉"===e.name)&&(e+=1,console.log('[技能点计算] 检测到 "霸王血脉" 天赋, 增加 1 技能点')),e}),A=(0,r.computed)(()=>{if(!N.value)return 0;let e=N.value.total_points;console.log("[技能点计算] 初始技能点:",e),e+=C.value,S.value&&(console.log("[技能点计算] 出生消耗:",S.value.talent_cost),e-=S.value.talent_cost),V.value&&(console.log("[技能点计算] 灵根消耗:",V.value.talent_cost),e-=V.value.talent_cost);const t=_.value.reduce((e,t)=>e+t.talent_cost,0);console.log("[技能点计算] 已选天赋数量:",_.value.length),console.log("[技能点计算] 已选天赋列表:",_.value.map(e=>({名称:e.name,消耗:e.talent_cost}))),console.log("[技能点计算] 天赋总消耗:",t),e-=t;const n=Object.values(w.value).reduce((e,t)=>e+t,0);return console.log("[技能点计算] 先天六司总和:",n),e-=n,console.log("[技能点计算] 最终剩余:",e),e}),D=(0,r.computed)(()=>{if(!N.value)return 0;const e=N.value.total_points-A.value;return Math.max(0,e)});async function T(){const e={worlds:d.value.worlds.filter(e=>"cloud"===e.source),talentTiers:d.value.talentTiers.filter(e=>"cloud"===e.source),origins:d.value.origins.filter(e=>"cloud"===e.source),spiritRoots:d.value.spiritRoots.filter(e=>"cloud"===e.source),talents:d.value.talents.filter(e=>"cloud"===e.source)},{saveData:t}=await Promise.resolve().then(n.bind(n,5099));await t("customCreationData",e),console.log("【创世神殿】自定义创世数据已保存到数据库！")}function B(e){d.value.worlds.unshift({...e,source:"cloud"}),T()}function I(e){d.value.talentTiers.unshift({...e,source:"cloud"}),T()}function z(e){d.value.origins.unshift({...e,source:"cloud"}),T()}function M(e){d.value.spiritRoots.unshift({...e,source:"cloud"}),T()}function P(e){d.value.talents.unshift({...e,source:"cloud"}),T()}async function R(e,t){const a=d.value[e].findIndex(e=>e.id===t);if(a>-1){const r=d.value[e][a];if(d.value[e].splice(a,1),console.log(`【创世神殿】已删除 ${e} 项目，ID: ${t}，来源: ${r.source}`),await T(),"cloud"===r.source){console.log("【创世神殿】删除云端数据，强制同步酒馆全局变量");try{const a=(0,i.getTavernHelper)();if(a){console.log("【创世神殿】方案1：完全重置 DAD_creationData");const r={worlds:d.value.worlds.filter(e=>"cloud"===e.source),talentTiers:d.value.talentTiers.filter(e=>"cloud"===e.source),origins:d.value.origins.filter(e=>"cloud"===e.source),spiritRoots:d.value.spiritRoots.filter(e=>"cloud"===e.source),talents:d.value.talents.filter(e=>"cloud"===e.source)};console.log("【创世神殿】准备保存的新数据:",JSON.stringify(r,null,2));try{await a.deleteVariable("DAD_creationData",{type:"global"}),console.log("【创世神殿】已删除旧的 DAD_creationData")}catch(e){console.warn("【创世神殿】删除旧变量失败（可能不存在）:",e)}const{deepCleanForClone:o}=await Promise.resolve().then(n.bind(n,3098)),i=o({DAD_creationData:r});await a.insertOrAssignVariables(i,{type:"global"}),console.log("【创世神殿】已重新创建 DAD_creationData");const s=(await a.getVariables({type:"global"})).DAD_creationData;if(console.log("【创世神殿】验证：更新后的 DAD_creationData:",JSON.stringify(s,null,2)),s&&c(s)){const n=s[e].filter(e=>e.id===t);0===n.length?console.log(`【创世神殿】✅ 验证成功：${e} 项目 ID: ${t} 已从酒馆全局变量中删除`):(console.error(`【创世神殿】❌ 验证失败：${e} 项目 ID: ${t} 仍在酒馆全局变量中`),console.error("【创世神殿】剩余项目:",n))}else console.error("【创世神殿】❌ 验证失败：DAD_creationData 格式无效")}else console.error("【创世神殿】❌ 酒馆助手不可用")}catch(e){console.error("【创世神殿】❌ 同步酒馆全局变量失败:",e)}}}else console.warn(`【创世神殿】删除失败：未找到 ${e} 项目，ID: ${t}`)}function $(e,t,n){const a=d.value[e].findIndex(e=>e.id===t);if(a>-1){const r=d.value[e][a];return d.value[e][a]={...r,...n},console.log(`【创世神殿】已更新 ${e} 项目，ID: ${t}`),T(),!0}return!1}async function O(){const e=await async function(){let e="无名者";try{e=await(0,i.getCurrentCharacterName)()||"无名者"}catch(t){console.warn("获取用户名字失败:",t),e="无名者"}return{gender:"男",character_name:e,race:"人族",world_id:"",talent_tier_id:"",current_age:16,root_bone:0,spirituality:0,comprehension:0,fortune:0,charm:0,temperament:0,origin_id:null,spirit_root_id:null,selected_talent_ids:[]}}();u.value=e,m.value=1}return{mode:e,isLoading:t,error:a,creationData:d,characterPayload:u,currentStep:m,isLocalCreation:p,initialGameMessage:g,worldGenerationConfig:v,useStreamingStart:h,generateMode:f,gameDifficulty:b,currentDifficultyPrompt:x,totalSteps:k,attributes:w,selectedWorld:E,selectedTalentTier:N,selectedOrigin:S,selectedSpiritRoot:V,selectedTalents:_,remainingTalentPoints:A,totalTalentCost:D,bonusTalentPoints:C,initializeStore:async function(r){t.value=!0,a.value=null,e.value=r;try{const e=await(0,i.getCurrentCharacterName)();u.value.character_name=e||"无名者",console.log("【创世神殿】已获取用户用户名:",u.value.character_name)}catch(e){console.warn("【创世神殿】获取用户用户名失败，使用默认名",e),u.value.character_name="无名者"}try{if("single"===r){console.log("【创世神殿】初始化穿越异世界，加载本地数据和自定义数据！");const e=l.eQ.map(e=>({...e,source:"local"})),t=l.VQ.map(e=>({...e,source:"local"})),a=l.yM.map(e=>({...e,source:"local"})),r=l.Gr.map(e=>({...e,source:"local"})),o=l.qS.map(e=>({...e,source:"local"}));let i={worlds:[],talentTiers:[],origins:[],spiritRoots:[],talents:[]};try{const{loadFromIndexedDB:e}=await Promise.resolve().then(n.bind(n,5099)),t=await e("customCreationData");t&&c(t)&&(i=t,console.log("【创世神殿】成功加载自定义数据:",{worlds:i.worlds.length,talentTiers:i.talentTiers.length,origins:i.origins.length,spiritRoots:i.spiritRoots.length,talents:i.talents.length}))}catch(e){console.warn("【创世神殿】加载自定义数据失败，仅使用本地数据:",e)}const s=i.worlds.map(e=>({...e,source:"cloud"})),u=i.talentTiers.map(e=>({...e,source:"cloud"})),m=i.origins.map(e=>({...e,source:"cloud"})),p=i.spiritRoots.map(e=>({...e,source:"cloud"})),g=i.talents.map(e=>({...e,source:"cloud"})),h=(e,t)=>{const n=new Map;return e.forEach(e=>n.set(e.id,e)),t.forEach(e=>n.set(e.id,e)),Array.from(n.values())};d.value.worlds=h(e,s),d.value.talentTiers=h(t,u),d.value.origins=h(a,m),d.value.spiritRoots=h(r,p),d.value.talents=h(o,g)}else{console.log("【创世神殿】初始化联机模式，从后端获取更新数据！");const{isBackendConfigured:e}=await Promise.resolve().then(n.bind(n,8546)),{verifyStoredToken:t}=await Promise.resolve().then(n.bind(n,9333));if(e())if(await t())try{console.log("【创世神殿】后端已配置且 token 有效，开始请求云端数据...");const[e,t,n,a,r]=await Promise.all([(0,s.w2)(),(0,s.yZ)(),(0,s.Uy)(),(0,s.xJ)(),(0,s.Qc)()]);console.log("【创世神殿】成功获取更新数据:",{worlds:e.length,talentTiers:t.length,origins:n.length,spiritRoots:a.length,talents:r.length}),d.value.worlds=e.map(e=>({...e,source:"cloud"})),d.value.talentTiers=t.map(e=>({...e,source:"cloud"})),d.value.origins=n.map(e=>({...e,source:"cloud"})),d.value.spiritRoots=a.map(e=>({...e,source:"cloud"})),d.value.talents=r.map(e=>({...e,source:"cloud"}))}catch(e){console.error("【创世神殿】获取更新数据失败，回退到本地数据:",e),d.value.worlds=l.eQ.map(e=>({...e,source:"local"})),d.value.talentTiers=l.VQ.map(e=>({...e,source:"local"})),d.value.origins=l.yM.map(e=>({...e,source:"local"})),d.value.spiritRoots=l.Gr.map(e=>({...e,source:"local"})),d.value.talents=l.qS.map(e=>({...e,source:"local"}))}else console.warn("【创世神殿】联机模式 token 无效，回退到本地数据"),d.value.worlds=l.eQ.map(e=>({...e,source:"local"})),d.value.talentTiers=l.VQ.map(e=>({...e,source:"local"})),d.value.origins=l.yM.map(e=>({...e,source:"local"})),d.value.spiritRoots=l.Gr.map(e=>({...e,source:"local"})),d.value.talents=l.qS.map(e=>({...e,source:"local"})),a.value="联机模式需要先登录";else console.warn("【创世神殿】后端未配置，使用本地数据！"),d.value.worlds=l.eQ.map(e=>({...e,source:"local"})),d.value.talentTiers=l.VQ.map(e=>({...e,source:"local"})),d.value.origins=l.yM.map(e=>({...e,source:"local"})),d.value.spiritRoots=l.Gr.map(e=>({...e,source:"local"})),d.value.talents=l.qS.map(e=>({...e,source:"local"}))}}catch(e){console.error("加载数据失败:",e),a.value="加载数据失败",d.value.talentTiers=l.VQ.map(e=>({...e,source:"local"})),d.value.origins=l.yM.map(e=>({...e,source:"local"})),d.value.spiritRoots=l.Gr.map(e=>({...e,source:"local"})),d.value.talents=l.qS.map(e=>({...e,source:"local"}))}finally{t.value=!1}},fetchCloudWorlds:async function(){console.log("【创世神殿】正在从云端获取世界列表..."),t.value=!0,a.value=null;try{const e=await(0,s.w2)();console.log("【创世神殿】成功获取更新世界数据",e);const t=e.map(e=>({...e,source:"cloud"})),n=(l.eQ.map(e=>({...e,source:"local"})),new Map);t.forEach(e=>n.set(e.id,e)),d.value.worlds=Array.from(n.values()),console.log("【创世神殿】世界列表已更新:",d.value.worlds.length,"个世界"),console.log("【创世神殿】云端世界",d.value.worlds.filter(e=>"cloud"===e.source))}catch(e){console.error("【创世神殿】从云端获取世界列表失败:",e),a.value=`获取更新世界列表失败: ${e instanceof Error?e.message:"未知错误"}`;const t=l.eQ.map(e=>({...e,source:"local"}));d.value.worlds=t,console.warn("【创世神殿】云端数据获取失败，已提供本地备选数据")}finally{t.value=!1}},fetchAllCloudData:async function(){console.log("【创世神殿】正在从云端获取完整创世数据..."),t.value=!0,a.value=null;try{const[e,t,n,a,r]=await Promise.all([(0,s.w2)(),(0,s.yZ)(),(0,s.Uy)(),(0,s.xJ)(),(0,s.Qc)()]);console.log("【创世神殿】成功获取所有云端数据"),console.log("- 世界:",e.length,"个"),console.log("- 天资等级:",t.length,"个"),console.log("- 出身:",n.length,"个"),console.log("- 灵根:",a.length,"个"),console.log("- 天赋:",r.length,"个");const o={worlds:d.value.worlds.length,talentTiers:d.value.talentTiers.length,origins:d.value.origins.length,spiritRoots:d.value.spiritRoots.length,talents:d.value.talents.length},i=(e,t)=>(e||[]).filter(Boolean).map(e=>({...t,...e,source:"cloud"})),l=i(e,{id:0,name:"",era:"",description:""}),c=i(t,{id:0,name:"未知天资",description:"",total_points:20,rarity:1,color:"#FFFFFF"}),u=i(n,{id:0,name:"",description:"",talent_cost:0,attribute_modifiers:{},rarity:0}),m=i(a,{id:0,name:"",tier:"",description:"",base_multiplier:0,talent_cost:0}),p=i(r,{id:0,name:"",description:"",talent_cost:0,rarity:0}),g=d.value.worlds,h=d.value.talentTiers,f=d.value.origins,v=d.value.spiritRoots,b=d.value.talents,y=(e,t)=>{const n=[],a=new Set(e.map(e=>e.name));let r=Math.max(...e.map(e=>e.id),0);return t.forEach(e=>{if(!a.has(e.name)){r++;const t={...e,id:r};n.push(t),a.add(t.name)}}),n},x=(e,t)=>{t.length>0&&e.push(...t)};x(d.value.worlds,y(g,l)),x(d.value.talentTiers,y(h,c)),x(d.value.origins,y(f,u)),x(d.value.spiritRoots,y(v,m)),x(d.value.talents,y(b,p)),console.log("【创世神殿】所有云端数据合并完成"),console.log("【创世神殿】最终数据验证"),console.log("- 世界 (云端):",d.value.worlds.filter(e=>"cloud"===e.source).length),console.log("- 天资 (云端):",d.value.talentTiers.filter(e=>"cloud"===e.source).length),console.log("- 出身 (云端):",d.value.origins.filter(e=>"cloud"===e.source).length),console.log("- 灵根 (云端):",d.value.spiritRoots.filter(e=>"cloud"===e.source).length),console.log("- 天赋 (云端):",d.value.talents.filter(e=>"cloud"===e.source).length),console.log("【创世神殿】天资数据示例",d.value.talentTiers.slice(0,3).map(e=>({name:e.name,source:e.source})));const k={worlds:d.value.worlds.length,talentTiers:d.value.talentTiers.length,origins:d.value.origins.length,spiritRoots:d.value.spiritRoots.length,talents:d.value.talents.length},w=k.worlds-o.worlds+(k.talentTiers-o.talentTiers)+(k.origins-o.origins)+(k.spiritRoots-o.spiritRoots)+(k.talents-o.talents);return console.log(`【创世神殿】同步完成，新增 ${w} 项数据。`),await T(),w}catch(e){console.error("【创世神殿】获取更新创世数据失败",e),a.value=`获取更新创世数据失败: ${e instanceof Error?e.message:"未知错误"}`;const t=l.eQ.map(e=>({...e,source:"local"})),n=l.VQ.map(e=>({...e,source:"local"})),r=l.yM.map(e=>({...e,source:"local"})),o=l.Gr.map(e=>({...e,source:"local"})),i=l.qS.map(e=>({...e,source:"local"}));return d.value.worlds=t,d.value.talentTiers=n,d.value.origins=r,d.value.spiritRoots=o,d.value.talents=i,console.warn("【创世神殿】云端数据获取失败，已提供本地备选数据"),0}finally{t.value=!1}},addWorld:B,addTalentTier:I,addOrigin:z,addSpiritRoot:M,addTalent:P,addGeneratedData:function(e,t){switch(e){case"world":B(t);break;case"talent_tier":I(t);break;case"origin":z(t);break;case"spirit_root":M(t);break;case"talent":P(t);break;default:console.warn(`Unknown data type for addGeneratedData: ${e}`)}},removeWorld:async e=>await R("worlds",e),removeTalentTier:async e=>await R("talentTiers",e),removeOrigin:async e=>await R("origins",e),removeSpiritRoot:async e=>await R("spiritRoots",e),removeTalent:async e=>await R("talents",e),updateWorld:(e,t)=>$("worlds",e,t),updateTalentTier:(e,t)=>$("talentTiers",e,t),updateOrigin:(e,t)=>$("origins",e,t),updateSpiritRoot:(e,t)=>$("spiritRoots",e,t),updateTalent:(e,t)=>$("talents",e,t),getItemById:(e,t)=>d.value[e].find(e=>e.id===t)||null,selectWorld:function(e){u.value.world_id=e},selectTalentTier:function(e){u.value.talent_tier_id=e,u.value.origin_id=null,u.value.spirit_root_id=null,u.value.selected_talent_ids=[],u.value.root_bone=0,u.value.spirituality=0,u.value.comprehension=0,u.value.fortune=0,u.value.charm=0,u.value.temperament=0},selectOrigin:function(e){u.value.origin_id=e},selectSpiritRoot:function(e){u.value.spirit_root_id=e},toggleTalent:function(e){const t=u.value.selected_talent_ids.indexOf(e);t>-1?u.value.selected_talent_ids.splice(t,1):u.value.selected_talent_ids.push(e)},setAttribute:function(e,t){e in u.value&&(u.value[e]=t)},resetCharacter:O,nextStep:function(){m.value<7&&m.value++},prevStep:function(){m.value>1&&m.value--},goToStep:function(e){e>=1&&e<=7&&(m.value=e)},setMode:function(t){e.value=t,p.value="single"===t},toggleLocalCreation:function(){p.value=!p.value},setInitialGameMessage:function(e){g.value=e},setWorldGenerationConfig:function(e){v.value={...v.value,...e}},resetOnExit:async function(){await O(),e.value="single",p.value=!0},startLocalCreation:async function(){await O(),p.value=!0,e.value="single"},startCloudCreation:async function(){await O(),p.value=!1,e.value="cloud"},persistCustomData:T,setAIGeneratedSpiritRoot:function(e){if(!e||"object"!=typeof e||!e.name)return;let t=d.value.spiritRoots.find(t=>t.name===e.name);if(!t){const n=Math.max(...d.value.spiritRoots.map(e=>e.id),0)+1;M({...e,id:n}),t=d.value.spiritRoots.find(t=>t.name===e.name),console.log(`[创世神殿] AI生成了新的灵根 "${e.name}" 并已添加到列表中 (ID: ${n})`)}t&&(u.value.spirit_root_id=t.id,console.log(`[创世神殿] 已将玩家选择的灵根更新为AI生成的结果: "${t.name}"`))},setAIGeneratedOrigin:function(e){if(!e||"object"!=typeof e||!e.name)return;let t=d.value.origins.find(t=>t.name===e.name);if(!t){const n=Math.max(...d.value.origins.map(e=>e.id),0)+1;z({...e,id:n}),t=d.value.origins.find(t=>t.name===e.name),console.log(`[创世神殿] AI生成了新的出身 "${e.name}" 并已添加到列表中 (ID: ${n})`)}t&&(u.value.origin_id=t.id,console.log(`[创世神殿] 已将玩家选择的出身更新为AI生成的结果: "${t.name}"`))}}})},1237:e=>{"use strict";e.exports=EvalError},1270:function(e,t,n){var a;e=n.nmd(e),function(){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof n.g&&n.g;r.global!==r&&r.window!==r&&r.self;var o,i=2147483647,s=36,l=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,p=String.fromCharCode;function g(e){throw new RangeError(u[e])}function h(e,t){for(var n=e.length,a=[];n--;)a[n]=t(e[n]);return a}function f(e,t){var n=e.split("@"),a="";return n.length>1&&(a=n[0]+"@",e=n[1]),a+h((e=e.replace(d,".")).split("."),t).join(".")}function v(e){for(var t,n,a=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?a.push(((1023&t)<<10)+(1023&n)+65536):(a.push(t),r--):a.push(t);return a}function b(e){return h(e,function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+p(e)}).join("")}function y(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:s}function x(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,n){var a=0;for(e=n?m(e/700):e>>1,e+=m(e/t);e>455;a+=s)e=m(e/35);return m(a+36*e/(e+38))}function w(e){var t,n,a,r,o,l,c,d,u,p,h=[],f=e.length,v=0,x=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),a=0;a<n;++a)e.charCodeAt(a)>=128&&g("not-basic"),h.push(e.charCodeAt(a));for(r=n>0?n+1:0;r<f;){for(o=v,l=1,c=s;r>=f&&g("invalid-input"),((d=y(e.charCodeAt(r++)))>=s||d>m((i-v)/l))&&g("overflow"),v+=d*l,!(d<(u=c<=w?1:c>=w+26?26:c-w));c+=s)l>m(i/(p=s-u))&&g("overflow"),l*=p;w=k(v-o,t=h.length+1,0==o),m(v/t)>i-x&&g("overflow"),x+=m(v/t),v%=t,h.splice(v++,0,x)}return b(h)}function E(e){var t,n,a,r,o,l,c,d,u,h,f,b,y,w,E,N=[];for(b=(e=v(e)).length,t=128,n=0,o=72,l=0;l<b;++l)(f=e[l])<128&&N.push(p(f));for(a=r=N.length,r&&N.push("-");a<b;){for(c=i,l=0;l<b;++l)(f=e[l])>=t&&f<c&&(c=f);for(c-t>m((i-n)/(y=a+1))&&g("overflow"),n+=(c-t)*y,t=c,l=0;l<b;++l)if((f=e[l])<t&&++n>i&&g("overflow"),f==t){for(d=n,u=s;!(d<(h=u<=o?1:u>=o+26?26:u-o));u+=s)E=d-h,w=s-h,N.push(p(x(h+E%w,0))),d=m(E/w);N.push(p(x(d,0))),o=k(n,y,a==r),n=0,++a}++n,++t}return N.join("")}o={version:"1.4.1",ucs2:{decode:v,encode:b},decode:w,encode:E,toASCII:function(e){return f(e,function(e){return c.test(e)?"xn--"+E(e):e})},toUnicode:function(e){return f(e,function(e){return l.test(e)?w(e.slice(4).toLowerCase()):e})}},void 0===(a=function(){return o}.call(t,n,t,e))||(e.exports=a)}()},1321:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.formatted-text[data-v-fa8db44c] {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  text-align: justify;\n  text-indent: 2em;\n  margin: 0;\n  line-height: 1.8;\n  padding-bottom: 1.5rem;\n}\n\n/* 环境描写 - 青色 */\n.text-environment[data-v-fa8db44c] {\n  color: #0891b2;\n  font-weight: 500;\n}\n\n/* 心理描写 - 紫色 */\n.text-psychology[data-v-fa8db44c] {\n  color: #7c3aed;\n  font-style: italic;\n  font-weight: 500;\n}\n\n/* 对话 - 橙色 */\n.text-dialogue[data-v-fa8db44c] {\n  color: #d97706;\n  font-weight: 500;\n}\n\n/* 引用/独白 - 橙色斜体 */\n.text-quote[data-v-fa8db44c] {\n  color: rgb(254 125 0);\n  font-style: italic;\n}\n\n/* 普通文本 */\n.text-normal[data-v-fa8db44c] {\n  color: var(--color-text, #1a1a1a);\n}\n\n/* 判定卡片样式 - 清爽版 */\n.judgement-card[data-v-fa8db44c] {\n  display: flex;\n  gap: 1rem;\n  margin: 1.25rem 0;\n  padding: 1.25rem;\n  background: var(--color-surface);\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n  text-indent: 0;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.2s ease;\n}\n.judgement-card[data-v-fa8db44c]:hover {\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n}\n\n/* 成功状态 */\n.judgement-card.is-success[data-v-fa8db44c] {\n  border-left: 4px solid #10b981;\n  background: rgba(16, 185, 129, 0.05); /* 极淡的绿色背景 */\n  --card-color: #10b981;\n}\n.judgement-card.is-great-success[data-v-fa8db44c] {\n  border-left: 4px solid #f59e0b;\n  background: rgba(245, 158, 11, 0.05);\n  --card-color: #f59e0b;\n}\n\n/* 失败状态 */\n.judgement-card.is-failure[data-v-fa8db44c] {\n  border-left: 4px solid #ef4444;\n  background: rgba(239, 68, 68, 0.05);\n  --card-color: #ef4444;\n}\n.judgement-card.is-great-failure[data-v-fa8db44c] {\n  border-left: 4px solid #a855f7;\n  background: rgba(168, 85, 247, 0.05);\n  --card-color: #a855f7;\n}\n@keyframes pulse-success-fa8db44c {\n0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4);\n}\n50% { box-shadow: 0 0 0 8px rgba(251, 191, 36, 0);\n}\n}\n@keyframes pulse-failure-fa8db44c {\n0%, 100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4);\n}\n50% { box-shadow: 0 0 0 8px rgba(168, 85, 247, 0);\n}\n}\n\n/* 图标区域 */\n.card-icon[data-v-fa8db44c] {\n  flex-shrink: 0;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: white;\n  border-radius: 12px;\n  border: 2px solid var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n/* 内容区域 */\n.card-content[data-v-fa8db44c] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n/* 标题行 */\n.card-header[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n}\n.judgement-title[data-v-fa8db44c] {\n  font-size: 1.125rem;\n  font-weight: 700;\n  color: #0f172a;\n  letter-spacing: -0.01em;\n  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);\n  opacity: 1;\n}\n.judgement-badge[data-v-fa8db44c] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.375rem 0.875rem;\n  background: var(--card-color, #6366f1);\n  color: white;\n  border-radius: 20px;\n  font-size: 0.875rem;\n  font-weight: 600;\n  letter-spacing: 0.02em;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  opacity: 1;\n}\n\n/* 统计信息行 */\n.card-body[data-v-fa8db44c] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n.stat-item[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.875rem;\n  background: white;\n  border-radius: 10px;\n  border: 1px solid #e2e8f0;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);\n  min-width: fit-content;\n}\n.difficulty-item[data-v-fa8db44c] {\n  min-width: 120px;\n}\n.details-list[data-v-fa8db44c] {\n  width: 100%;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid #e2e8f0;\n}\n.detail-item[data-v-fa8db44c] {\n  font-size: 0.875rem;\n  color: #64748b;\n  padding: 0.25rem 0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.detail-item[data-v-fa8db44c]::before {\n  content: \'•\';\n  color: #94a3b8;\n}\n.detail-label[data-v-fa8db44c] {\n  font-weight: 600;\n  color: #475569;\n}\n.detail-value[data-v-fa8db44c] {\n  font-weight: 700;\n  color: #1e293b;\n  min-width: 2rem;\n}\n.detail-source[data-v-fa8db44c] {\n  font-size: 0.75rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.stat-icon[data-v-fa8db44c] {\n  font-size: 1.375rem;\n  line-height: 1;\n}\n.stat-info[data-v-fa8db44c] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.125rem;\n}\n.stat-label[data-v-fa8db44c] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: #64748b;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n.stat-value[data-v-fa8db44c] {\n  font-size: 1.125rem;\n  font-weight: 700;\n  color: #1e293b;\n}\n.dice-roll[data-v-fa8db44c], .attribute-check[data-v-fa8db44c] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface-light, #ebe9e6);\n  border-radius: 8px;\n  border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));\n  transition: all 0.2s ease;\n  text-align: center;\n}\n.dice-roll[data-v-fa8db44c]:hover, .attribute-check[data-v-fa8db44c]:hover {\n  background: var(--color-surface, #f2f1ee);\n  transform: translateY(-1px);\n}\n.dice-roll .label[data-v-fa8db44c], .attribute-check .label[data-v-fa8db44c] {\n  font-size: 0.8em;\n  color: var(--color-text-secondary, #666666);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  margin-bottom: 0.25rem;\n  font-weight: 500;\n}\n.dice-roll .value[data-v-fa8db44c], .attribute-check .value[data-v-fa8db44c] {\n  font-size: 1.4em;\n  font-weight: 700;\n  color: var(--color-text, #1a1a1a);\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.dice-roll .value[data-v-fa8db44c] {\n  color: #6366f1;\n  background: linear-gradient(135deg, #6366f1, #8b5cf6);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .text-normal[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .text-environment[data-v-fa8db44c] {\n  color: #22d3ee;\n}\n[data-theme="dark"] .text-psychology[data-v-fa8db44c] {\n  color: #a78bfa;\n}\n[data-theme="dark"] .text-dialogue[data-v-fa8db44c] {\n  color: #fb923c;\n}\n[data-theme="dark"] .text-quote[data-v-fa8db44c] {\n  color: rgb(254 125 0);\n}\n[data-theme="dark"] .judgement-card[data-v-fa8db44c] {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, var(--color-background, rgb(30, 41, 59)) 100%);\n  border-color: var(--color-border, rgba(173, 216, 230, 0.5));\n}\n[data-theme="dark"] .card-header[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .result-text[data-v-fa8db44c],\n[data-theme="dark"] .dice-roll[data-v-fa8db44c],\n[data-theme="dark"] .attribute-check[data-v-fa8db44c] {\n  background: var(--color-surface-light, #414868);\n  border-color: var(--color-border, rgba(173, 216, 230, 0.5));\n}\n[data-theme="dark"] .dice-roll .label[data-v-fa8db44c],\n[data-theme="dark"] .attribute-check .label[data-v-fa8db44c] {\n  color: var(--color-text-secondary, #d0d0d0);\n}\n[data-theme="dark"] .dice-roll .value[data-v-fa8db44c],\n[data-theme="dark"] .attribute-check .value[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n.header-right[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.help-btn[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 1px solid #e2e8f0;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #64748b;\n}\n.help-btn[data-v-fa8db44c]:hover {\n  background: white;\n  border-color: var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n  transform: scale(1.1);\n}\n.help-btn[data-v-fa8db44c]:active {\n  transform: scale(0.95);\n}\n\n/* 帮助弹窗 */\n.help-modal-overlay[data-v-fa8db44c] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  animation: fadeIn-fa8db44c 0.2s ease;\n}\n@keyframes fadeIn-fa8db44c {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.help-modal[data-v-fa8db44c] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  max-width: 600px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  animation: slideUp-fa8db44c 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n@keyframes slideUp-fa8db44c {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.help-modal-header[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1.5rem;\n  border-bottom: 1px solid #e2e8f0;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n}\n.help-modal-header h3[data-v-fa8db44c] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.close-btn[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #64748b;\n}\n.close-btn[data-v-fa8db44c]:hover {\n  background: #fee2e2;\n  border-color: #ef4444;\n  color: #ef4444;\n}\n.help-modal-content[data-v-fa8db44c] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  max-height: calc(80vh - 80px);\n}\n.help-section[data-v-fa8db44c] {\n  margin-bottom: 1.5rem;\n}\n.help-section[data-v-fa8db44c]:last-child {\n  margin-bottom: 0;\n}\n.help-section h4[data-v-fa8db44c] {\n  margin: 0 0 0.75rem 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.help-section ol[data-v-fa8db44c] {\n  margin: 0;\n  padding-left: 1.5rem;\n  color: var(--color-text-secondary);\n  line-height: 1.8;\n}\n.help-section ol li[data-v-fa8db44c] {\n  margin-bottom: 0.5rem;\n}\n.help-section ol li strong[data-v-fa8db44c] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n.formula-box[data-v-fa8db44c] {\n  padding: 1rem;\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border-left: 4px solid #f59e0b;\n  border-radius: 8px;\n  margin-bottom: 0.75rem;\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: #78350f;\n}\n.formula-box strong[data-v-fa8db44c] {\n  color: #92400e;\n  font-weight: 700;\n}\n.result-list[data-v-fa8db44c] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.result-item[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem 1rem;\n  border-radius: 10px;\n  border: 1px solid;\n  gap: 1rem;\n}\n.result-item.perfect[data-v-fa8db44c] {\n  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);\n  border-color: #fbbf24;\n}\n.result-item.great-success[data-v-fa8db44c] {\n  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\n  border-color: #86efac;\n}\n.result-item.success[data-v-fa8db44c] {\n  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n  border-color: #93c5fd;\n}\n.result-item.failure[data-v-fa8db44c] {\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n  border-color: #fca5a5;\n}\n.result-item.critical-failure[data-v-fa8db44c] {\n  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);\n  border-color: #c084fc;\n}\n.result-label[data-v-fa8db44c] {\n  font-weight: 700;\n  font-size: 0.875rem;\n  min-width: 60px;\n  opacity: 1;\n}\n.result-desc[data-v-fa8db44c] {\n  font-size: 0.875rem;\n  flex: 1;\n  opacity: 1;\n}\n\n/* -- 统一文字颜色，仅保留强调色 -- */\n.result-item[data-v-fa8db44c] {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n}\n.result-label[data-v-fa8db44c] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.result-desc[data-v-fa8db44c] {\n  color: var(--color-text-secondary);\n}\n\n/* 仅在标签上应用颜色 */\n.result-item.perfect .result-label[data-v-fa8db44c] { color: #f59e0b;\n}\n.result-item.great-success .result-label[data-v-fa8db44c] { color: #10b981;\n}\n.result-item.success .result-label[data-v-fa8db44c] { color: #10b981;\n}\n.result-item.failure .result-label[data-v-fa8db44c] { color: #ef4444;\n}\n.result-item.critical-failure .result-label[data-v-fa8db44c] { color: #a855f7;\n}\n.formula-note[data-v-fa8db44c] {\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n  border-left: 4px solid #3b82f6;\n  border-radius: 8px;\n  margin-bottom: 0.75rem;\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: #1e40af;\n}\n.formula-note strong[data-v-fa8db44c] {\n  color: #1e3a8a;\n  font-weight: 700;\n}\n.tips-list[data-v-fa8db44c] {\n  margin: 0;\n  padding-left: 1.25rem;\n  color: #475569;\n  line-height: 1.8;\n}\n.tips-list li[data-v-fa8db44c] {\n  margin-bottom: 0.5rem;\n}\n.judgement-types[data-v-fa8db44c] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.type-item[data-v-fa8db44c] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.75rem;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border-radius: 8px;\n  border: 1px solid #e2e8f0;\n}\n.type-name[data-v-fa8db44c] {\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #1e293b;\n}\n.type-attrs[data-v-fa8db44c] {\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.attributes-desc[data-v-fa8db44c] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 0.75rem;\n}\n.attr-card[data-v-fa8db44c] {\n  padding: 0.75rem;\n  background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);\n  border-radius: 10px;\n  border: 1px solid #e2e8f0;\n}\n.attr-header[data-v-fa8db44c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.attr-icon[data-v-fa8db44c] {\n  font-size: 1.25rem;\n}\n.attr-name[data-v-fa8db44c] {\n  font-weight: 600;\n  font-size: 0.875rem;\n  color: #1e293b;\n}\n.attr-card p[data-v-fa8db44c] {\n  margin: 0;\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .help-modal[data-v-fa8db44c] {\n  background: var(--color-surface, #1e293b);\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .help-modal-header[data-v-fa8db44c] {\n  background: rgba(255, 255, 255, 0.05);\n  border-bottom-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .help-modal-header h3[data-v-fa8db44c],\n[data-theme="dark"] .help-section h4[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .help-section ol[data-v-fa8db44c],\n[data-theme="dark"] .tips-list[data-v-fa8db44c] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n\n/* -- 深色主题适配 -- */\n/* 仅调整标签颜色以适应深色背景 */\n[data-theme="dark"] .result-item.perfect .result-label[data-v-fa8db44c] { color: #fcd34d;\n}\n[data-theme="dark"] .result-item.great-success .result-label[data-v-fa8db44c] { color: #86efac;\n}\n[data-theme="dark"] .result-item.success .result-label[data-v-fa8db44c] { color: #93c5fd;\n}\n[data-theme="dark"] .result-item.failure .result-label[data-v-fa8db44c] { color: #fca5a5;\n}\n[data-theme="dark"] .result-item.critical-failure .result-label[data-v-fa8db44c] { color: #d8b4fe;\n}\n[data-theme="dark"] .close-btn[data-v-fa8db44c] {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .close-btn[data-v-fa8db44c]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  border-color: #ef4444;\n}\n[data-theme="dark"] .help-btn[data-v-fa8db44c] {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .help-btn[data-v-fa8db44c]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: var(--card-color, #6366f1);\n  color: var(--card-color, #6366f1);\n}\n[data-theme="dark"] .type-item[data-v-fa8db44c] {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .type-name[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .type-attrs[data-v-fa8db44c] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .attr-card[data-v-fa8db44c] {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: var(--color-border, rgba(255, 255, 255, 0.1));\n}\n[data-theme="dark"] .attr-name[data-v-fa8db44c] {\n  color: var(--color-text, #f7f7f5);\n}\n[data-theme="dark"] .attr-card p[data-v-fa8db44c] {\n  color: var(--color-text-secondary, #94a3b8);\n}\n[data-theme="dark"] .formula-box[data-v-fa8db44c] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);\n  border-left-color: #f59e0b;\n  color: #fbbf24;\n}\n[data-theme="dark"] .formula-box strong[data-v-fa8db44c] {\n  color: #fcd34d;\n}\n[data-theme="dark"] .detail-label[data-v-fa8db44c] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .detail-value[data-v-fa8db44c] {\n  color: #f1f5f9;\n}\n[data-theme="dark"] .detail-source[data-v-fa8db44c] {\n  color: #64748b;\n}\n',""]);const s=i},1333:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var a in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},1393:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.data-clear-container[data-v-5b396b26] {\n  display: flex;\n  align-items: center;\n}\n.clear-buttons[data-v-5b396b26] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.clear-button[data-v-5b396b26] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.clear-button[data-v-5b396b26]:hover:not(:disabled) {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  border-color: var(--color-danger);\n  color: var(--color-danger);\n}\n.clear-button[data-v-5b396b26]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.clear-icon[data-v-5b396b26] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n.clear-text[data-v-5b396b26] {\n  font-weight: 500;\n}\n\n/* 不同类型按钮的特定样式 */\n.clear-button.extra[data-v-5b396b26]:hover:not(:disabled) {\n  background: rgba(255, 165, 0, 0.2);\n  border-color: orange;\n  color: orange;\n}\n.clear-button.sync[data-v-5b396b26]:hover:not(:disabled) {\n  background: rgba(135, 206, 235, 0.2);\n  border-color: skyblue;\n  color: skyblue;\n}\n",""]);const s=i},1412:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]])},1419:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var a=n(4061),r=n(4717),o=n(1783);const i={class:"tree-node"},s={key:0,class:"arrow"},l={key:1,class:"arrow"},c={class:"key"},d={key:2,class:"value"},u={class:"action-buttons"},m=["disabled"],p=["disabled"],g={key:0,class:"node-children"},h=(0,a.defineComponent)({__name:"TreeNode",props:{nodeKey:{},value:{},path:{},readOnly:{type:Boolean,default:!1}},emits:["delete-item","edit-item"],setup(e,{emit:t}){const h=(0,a.defineAsyncComponent)(()=>Promise.resolve().then(n.bind(n,1419))),f=e,v=t,b=(0,a.ref)(!1),y=(0,a.computed)(()=>"object"==typeof f.value&&null!==f.value),x=(0,a.computed)(()=>null===f.value?"null":"string"==typeof f.value&&f.value.length>100?`"${f.value.substring(0,100)}..."`:JSON.stringify(f.value)),k=(0,a.computed)(()=>{const e=f.path,t=e.startsWith("角色.背包.物品.")&&4===e.split(".").length,n=e.startsWith("社交.关系.")&&3===e.split(".").length;return t||n}),w=()=>{y.value&&(b.value=!b.value)},E=()=>{f.readOnly||v("delete-item",f.path)},N=()=>{f.readOnly||v("edit-item",f.path,f.value)};return(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",i,[(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["node-line",{"is-object":y.value}]),onClick:w},[y.value?((0,a.openBlock)(),(0,a.createElementBlock)("span",s,(0,a.toDisplayString)(b.value?"▼":"▶"),1)):((0,a.openBlock)(),(0,a.createElementBlock)("span",l)),(0,a.createElementVNode)("span",c,(0,a.toDisplayString)(e.nodeKey)+":",1),y.value?(0,a.createCommentVNode)("v-if",!0):((0,a.openBlock)(),(0,a.createElementBlock)("span",d,(0,a.toDisplayString)(x.value),1)),(0,a.createElementVNode)("div",u,[(0,a.createElementVNode)("button",{onClick:(0,a.withModifiers)(N,["stop"]),class:"edit-btn",title:"编辑此项",disabled:e.readOnly},[(0,a.createVNode)((0,a.unref)(r.A),{size:14})],8,m),k.value?((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:0,onClick:(0,a.withModifiers)(E,["stop"]),class:"delete-btn",title:"删除此项",disabled:e.readOnly},[(0,a.createVNode)((0,a.unref)(o.A),{size:14})],8,p)):(0,a.createCommentVNode)("v-if",!0)])],2),y.value&&b.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",g,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.value,(n,r)=>((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(h),{key:r,"node-key":r,value:n,path:`${e.path}.${r}`,"read-only":e.readOnly,onDeleteItem:t[0]||(t[0]=e=>v("delete-item",e)),onEditItem:t[1]||(t[1]=(e,t)=>v("edit-item",e,t))},null,8,["node-key","value","path","read-only"]))),128))])):(0,a.createCommentVNode)("v-if",!0)]))}});var f=n(5072),v=n.n(f),b=n(7825),y=n.n(b),x=n(7659),k=n.n(x),w=n(5056),E=n.n(w),N=n(540),S=n.n(N),V=n(1113),_=n.n(V),C=n(1489),A={};A.styleTagTransform=_(),A.setAttributes=E(),A.insert=k().bind(null,"head"),A.domAPI=y(),A.insertStyleElement=S(),v()(C.A,A),C.A&&C.A.locals&&C.A.locals;const D=(0,n(6262).A)(h,[["__scopeId","data-v-ee632ce2"]])},1459:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.left-sidebar[data-v-ee6620be] {\n  width: 100%;\n  height: 100%;\n  padding: 16px;\n  box-sizing: border-box;\n  font-family: var(--font-family-sans-serif);\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n}\n.sidebar-header[data-v-ee6620be] {\n  margin-bottom: 16px;\n  padding-bottom: 12px;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  flex-shrink: 0;\n}\n.sidebar-footer[data-v-ee6620be] {\n  padding-top: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10px;\n  border-top: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.footer-links[data-v-ee6620be] {\n  display: flex;\n  gap: 6px;\n}\n.footer-link[data-v-ee6620be] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  transition: all 0.2s ease;\n}\n.footer-link[data-v-ee6620be]:hover {\n  transform: scale(1.1);\n}\n.footer-link.github[data-v-ee6620be] {\n  color: var(--color-text-secondary);\n}\n.footer-link.github[data-v-ee6620be]:hover {\n  color: #fff;\n  background: #333;\n  border-color: #333;\n}\n.footer-link.sponsor[data-v-ee6620be] {\n  color: #f472b6;\n}\n.footer-link.sponsor[data-v-ee6620be]:hover {\n  color: #fff;\n  background: #ec4899;\n  border-color: #ec4899;\n}\n.app-version[data-v-ee6620be] {\n  font-family: monospace;\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #67e8f9;\n  padding: 0.25rem 0.6rem;\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.12) 0%, rgba(56, 189, 248, 0.08) 100%);\n  border: 1px solid rgba(34, 211, 238, 0.35);\n  border-radius: 6px;\n  display: inline-block;\n  letter-spacing: 0.5px;\n  text-shadow: 0 0 8px rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 12px rgba(34, 211, 238, 0.15);\n  transition: all 0.3s ease;\n}\n.app-version[data-v-ee6620be]:hover {\n  color: #a5f3fc;\n  border-color: rgba(34, 211, 238, 0.5);\n  box-shadow: 0 0 16px rgba(34, 211, 238, 0.25);\n  text-shadow: 0 0 12px rgba(34, 211, 238, 0.7);\n}\n.sidebar-title[data-v-ee6620be] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  text-align: center;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n}\n.real-time[data-v-ee6620be] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-family: 'Courier New', monospace;\n  padding: 4px 8px;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.time-icon[data-v-ee6620be] {\n  color: var(--color-primary);\n}\n.title-icon[data-v-ee6620be] {\n  color: var(--color-primary);\n}\n.sidebar-content[data-v-ee6620be] {\n  flex: 1;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n  padding-right: 4px;\n}\n.sidebar-content[data-v-ee6620be]::-webkit-scrollbar {\n  width: 4px;\n}\n.sidebar-content[data-v-ee6620be]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.sidebar-content[data-v-ee6620be]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 2px;\n}\n[data-theme=\"dark\"] .sidebar-content[data-v-ee6620be]::-webkit-scrollbar-thumb {\n  background: transparent;\n}\n\n/* 功能分区样式 */\n.function-section[data-v-ee6620be] {\n  margin-bottom: 24px;\n}\n.section-title[data-v-ee6620be] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  margin-bottom: 8px;\n  padding: 0 4px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.function-group[data-v-ee6620be] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.system-section[data-v-ee6620be] {\n  padding-top: 8px;\n  padding-bottom: 8px;\n}\n.divider[data-v-ee6620be] {\n  height: 1px;\n  background: var(--color-border);\n  margin: 12px 0;\n}\n\n/* 增强的按钮样式 */\n.function-btn[data-v-ee6620be] {\n  display: flex;\n  align-items: center;\n  padding: 12px 16px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  font-family: inherit;\n  text-align: left;\n  width: 100%;\n  position: relative;\n  overflow: hidden;\n}\n.function-btn[data-v-ee6620be]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, var(--color-surface-light), transparent);\n  transition: left 0.5s ease;\n}\n.function-btn[data-v-ee6620be]:hover::before {\n  left: 100%;\n}\n.function-btn[data-v-ee6620be]:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 20px rgba(var(--color-primary-rgb), 0.15);\n}\n.function-btn[data-v-ee6620be]:active {\n  transform: translateY(-1px) scale(0.98);\n  transition: all 0.1s ease;\n}\n\n/* 按钮图标区域 */\n.btn-icon[data-v-ee6620be] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border-radius: 8px;\n  background: var(--color-background);\n  margin-right: 12px;\n  transition: all 0.3s ease;\n  flex-shrink: 0;\n}\n\n/* 按钮内容区域 */\n.btn-content[data-v-ee6620be] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n.btn-text[data-v-ee6620be] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n  line-height: 1.3;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.btn-desc[data-v-ee6620be] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  line-height: 1.2;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* 按钮箭头 */\n.btn-arrow[data-v-ee6620be] {\n  color: var(--color-text-muted);\n  transition: all 0.3s ease;\n  margin-left: 8px;\n}\n.function-btn:hover .btn-arrow[data-v-ee6620be] {\n  color: var(--color-primary);\n  transform: translateX(2px);\n}\n\n/* 无箭头按钮的右边距补偿 */\n.function-btn.no-arrow .btn-content[data-v-ee6620be] {\n  margin-right: 22px; /* 14px (箭头宽度) + 8px (margin-left) */\n}\n\n/* 分类颜色主题 */\n.function-btn.primary .btn-icon[data-v-ee6620be] {\n  background: rgba(59, 130, 246, 0.1);\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  color: rgb(59, 130, 246);\n}\n.function-btn.primary:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(59, 130, 246, 0.15);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n.function-btn.secondary .btn-icon[data-v-ee6620be] {\n  background: rgba(16, 185, 129, 0.1);\n  border: 1px solid rgba(16, 185, 129, 0.2);\n  color: rgb(16, 185, 129);\n}\n.function-btn.secondary:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(16, 185, 129, 0.15);\n  border-color: rgba(16, 185, 129, 0.3);\n}\n\n/* 修炼系统 - 金色 */\n.function-btn.cultivation .btn-icon[data-v-ee6620be] {\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.2);\n  color: rgb(245, 158, 11);\n}\n.function-btn.cultivation:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(245, 158, 11, 0.15);\n  border-color: rgba(245, 158, 11, 0.3);\n}\n\n/* 任务探索 - 紫色 */\n.function-btn.quest .btn-icon[data-v-ee6620be] {\n  background: rgba(139, 92, 246, 0.1);\n  border: 1px solid rgba(139, 92, 246, 0.2);\n  color: rgb(139, 92, 246);\n}\n.function-btn.quest:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(139, 92, 246, 0.15);\n  border-color: rgba(139, 92, 246, 0.3);\n}\n.function-btn.system .btn-icon[data-v-ee6620be] {\n  background: rgba(107, 114, 128, 0.1);\n  border: 1px solid rgba(107, 114, 128, 0.2);\n  color: rgb(107, 114, 128);\n}\n.function-btn.system:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(107, 114, 128, 0.15);\n  border-color: rgba(107, 114, 128, 0.3);\n}\n\n/* 禁用状态样式 */\n.function-btn[data-v-ee6620be]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-surface-light);\n}\n.function-btn[data-v-ee6620be]:disabled:hover {\n  background: var(--color-surface-light);\n  transform: none;\n  box-shadow: none;\n  border-color: var(--color-border);\n}\n.function-btn:disabled .btn-icon[data-v-ee6620be] {\n  background: var(--color-background);\n  border-color: var(--color-border);\n}\n.function-btn:disabled .btn-arrow[data-v-ee6620be] {\n  opacity: 0.3;\n  transform: none;\n}\n.function-btn.disabled[data-v-ee6620be] {\n  position: relative;\n  opacity: 0.6;\n}\n.disabled-text[data-v-ee6620be] {\n  font-style: italic;\n  opacity: 0.7;\n}\n\n/* 退出按钮特殊样式 */\n.exit-btn[data-v-ee6620be] {\n  border-color: var(--color-error);\n  background: rgba(239, 68, 68, 0.05);\n}\n.exit-btn[data-v-ee6620be]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: var(--color-error);\n  box-shadow: 0 4px 20px rgba(239, 68, 68, 0.15);\n}\n.exit-btn .btn-text[data-v-ee6620be] {\n  color: var(--color-error);\n}\n.exit-btn .btn-desc[data-v-ee6620be] {\n  color: rgba(239, 68, 68, 0.7);\n}\n.exit-btn .btn-icon[data-v-ee6620be] {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.2);\n}\n.exit-btn:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(239, 68, 68, 0.15);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n\n/* 管理员按钮样式 */\n.function-btn.admin .btn-icon[data-v-ee6620be] {\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.2);\n  color: rgb(245, 158, 11);\n}\n.function-btn.admin:hover .btn-icon[data-v-ee6620be] {\n  background: rgba(245, 158, 11, 0.15);\n  border-color: rgba(245, 158, 11, 0.3);\n}\n.function-btn.admin .btn-text[data-v-ee6620be] {\n  color: rgb(245, 158, 11);\n}\n.function-btn.admin .btn-desc[data-v-ee6620be] {\n  color: rgba(245, 158, 11, 0.7);\n}\n\n/* 深色主题无需额外适配：已统一使用主题变量 */\n\n/* 响应式适配 */\n@media (max-width: 768px) {\n.left-sidebar[data-v-ee6620be] {\n    padding: 12px;\n}\n.function-btn[data-v-ee6620be] {\n    padding: 10px 12px;\n}\n.btn-icon[data-v-ee6620be] {\n    width: 32px;\n    height: 32px;\n}\n.btn-text[data-v-ee6620be] {\n    font-size: 0.8rem;\n}\n.btn-desc[data-v-ee6620be] {\n    font-size: 0.65rem;\n}\n}\n\n/* ========== iframe环境（酒馆端）样式 ========== */\n/* 不做特殊放大，使用与网页版相同的样式 */\n",""]);const s=i},1489:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.tree-node[data-v-ee632ce2] {\n  padding-left: 20px;\n  position: relative;\n}\n.node-line[data-v-ee632ce2] {\n  display: flex;\n  align-items: center;\n  padding: 4px 0;\n  cursor: default;\n  position: relative;\n}\n.node-line.is-object[data-v-ee632ce2] {\n  cursor: pointer;\n}\n.arrow[data-v-ee632ce2] {\n  width: 20px;\n  text-align: center;\n  margin-left: -20px;\n  color: #888;\n  font-size: 0.7rem;\n}\n.key[data-v-ee632ce2] {\n  color: #9cdcfe; /* 蓝色，适合键 */\n  margin-right: 8px;\n  font-weight: bold;\n}\n.value[data-v-ee632ce2] {\n  color: #ce9178; /* 橙色，适合字符串值 */\n}\n.node-children[data-v-ee632ce2] {\n  border-left: 1px solid #444;\n}\n.action-buttons[data-v-ee632ce2] {\n  margin-left: auto;\n  display: none; /* 默认隐藏 */\n  gap: 4px;\n}\n.node-line:hover .action-buttons[data-v-ee632ce2] {\n  display: flex; /* 悬停时显示 */\n}\n.edit-btn[data-v-ee632ce2],\n.delete-btn[data-v-ee632ce2] {\n  background: none;\n  border: none;\n  cursor: pointer;\n  padding: 2px 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-ee632ce2]:disabled,\n.delete-btn[data-v-ee632ce2]:disabled {\n  opacity: 0.35;\n  cursor: not-allowed;\n}\n.edit-btn[data-v-ee632ce2] {\n  color: #4a9eff;\n}\n.edit-btn[data-v-ee632ce2]:hover {\n  background: rgba(74, 158, 255, 0.2);\n  color: #6eb3ff;\n}\n.edit-btn[data-v-ee632ce2]:disabled:hover {\n  background: none;\n  color: #4a9eff;\n}\n.delete-btn[data-v-ee632ce2] {\n  color: #ff5555;\n}\n.delete-btn[data-v-ee632ce2]:hover {\n  background: rgba(255, 85, 85, 0.2);\n  color: #ff8080;\n}\n.delete-btn[data-v-ee632ce2]:disabled:hover {\n  background: none;\n  color: #ff5555;\n}\n",""]);const s=i},1513:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});var a=n(7203),r=n(406),o=n(8651);async function i(e,t){const[n,i,s,l,c]=await Promise.all([(0,a.XH)("coreOutputRules"),(0,a.XH)("businessRules"),(0,a.XH)("dataDefinitions"),(0,a.XH)("textFormatRules"),(0,a.XH)("worldStandards")]),d=[n,i,(0,o.isTavernEnv)()?s:(0,r.qh)(s),l,c];if(e.includes("actionOptions")){const e=(await(0,a.XH)("actionOptions")).trim(),n=t?`**用户自定义要求**：${t}\n\n请严格按照以上自定义要求生成行动选项。`:"（无特殊要求，按默认规则生成）";e&&d.push(e.replace("{{CUSTOM_ACTION_PROMPT}}",n))}if(e.includes("eventSystem")){const e=(await(0,a.XH)("eventSystemRules")).trim();e&&d.push(e)}return d.map(e=>e.trim()).filter(Boolean).join("\n\n---\n\n")}},1514:e=>{"use strict";e.exports=Math.abs},1530:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23e5e7eb%27 d=%27M6 9L1 4h10z%27/%3E%3C/svg%3E"},1601:e=>{"use strict";e.exports=function(e){return e[1]}},1606:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"/* 统一的游戏面板主题样式 */\n\n/* === 面板基础容器 === */\n.game-panel {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  gap: 0.75rem;\n  position: relative;\n  font-family: var(--font-family-sans-serif);\n}\n\n/* === 面板头部 === */\n.panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  flex-shrink: 0;\n  backdrop-filter: blur(10px);\n  margin: 0.5rem;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.header-icon {\n  font-size: 1.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2.5rem;\n  height: 2.5rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 50%;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n\n.header-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.panel-title {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-text);\n  /* 防止标题在紧凑布局中撑破布局 */\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.panel-subtitle {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n\n.header-actions {\n  display: flex;\n  gap: 0.5rem;\n  /* 允许按钮自动换行，避免溢出 */\n  flex-wrap: wrap;\n  justify-content: flex-end;\n  max-width: 100%;\n}\n\n/* === 动作按钮 === */\n.action-btn {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  /* 行为：默认不换行，但容器可多行显示 */\n  white-space: nowrap;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  /* 允许在需要时收缩，避免容器被撑破 */\n  flex: 0 1 auto;\n  max-width: 100%;\n}\n\n.action-btn:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 4px rgba(var(--color-primary-rgb), 0.1);\n}\n\n.action-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n\n.action-btn.primary {\n  background: var(--color-primary);\n  color: #fff;\n  border-color: var(--color-primary);\n}\n\n.action-btn.primary:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n}\n\n.action-btn.secondary {\n  background: var(--color-accent);\n  color: #fff;\n  border-color: var(--color-accent);\n}\n\n.action-btn.secondary:hover {\n  background: var(--color-accent-hover);\n  border-color: var(--color-accent-hover);\n}\n\n.action-btn.danger {\n  border-color: var(--color-error);\n  color: var(--color-error);\n}\n\n.action-btn.danger:hover {\n  background: rgba(var(--color-error-rgb), 0.05);\n  border-color: var(--color-danger);\n  color: var(--color-danger);\n}\n\n.btn-icon {\n  flex-shrink: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.btn-text {\n  font-weight: 500;\n}\n\n/* === 内容区域 === */\n.panel-content {\n  flex: 1;\n  overflow-y: auto;\n  margin: 0 0.5rem 0.5rem 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: var(--scrollbar-thumb) transparent;\n}\n\n.panel-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.panel-content::-webkit-scrollbar-track {\n  background: rgba(var(--color-border-rgb), 0.1);\n  border-radius: 3px;\n}\n\n.panel-content::-webkit-scrollbar-thumb {\n  background: var(--scrollbar-thumb);\n  border-radius: 3px;\n  opacity: 0.6;\n}\n\n.panel-content::-webkit-scrollbar-thumb:hover {\n  opacity: 0.8;\n}\n\n/* === 筛选标签 === */\n.filter-section {\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  flex-shrink: 0;\n  margin: 0 0.5rem;\n}\n\n.filter-tabs {\n  display: flex;\n  gap: 0.5rem;\n  overflow-x: auto;\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n}\n\n.filter-tabs::-webkit-scrollbar {\n  display: none;\n}\n\n.filter-tab {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.5rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 1.5rem;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n  white-space: nowrap;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  flex-shrink: 0;\n}\n\n.filter-tab:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n}\n\n.filter-tab.active {\n  background: var(--color-primary);\n  color: var(--color-background);\n  border-color: var(--color-primary);\n}\n\n.tab-icon {\n  font-size: 1rem;\n}\n\n.tab-name {\n  font-weight: 500;\n}\n\n.tab-count {\n  font-size: 0.75rem;\n  background: rgba(255, 255, 255, 0.2);\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.75rem;\n  font-weight: 600;\n}\n\n.filter-tab.active .tab-count {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n/* === 网格布局 === */\n.items-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n  gap: 0.75rem;\n  padding: 0.5rem;\n}\n\n.currency-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n  gap: 0.75rem;\n}\n\n/* === 卡片样式 === */\n.item-card, .currency-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: var(--transition-fast);\n  position: relative;\n}\n\n.item-card:hover, .currency-item:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.1);\n}\n\n/* === 状态指示 === */\n.loading-state, .empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n\n.loading-spinner, .empty-icon {\n  font-size: 2rem;\n  margin-bottom: 0.5rem;\n}\n\n.loading-text, .empty-text {\n  font-size: 1rem;\n  margin: 0;\n}\n\n/* === 详情区域 === */\n.detail-section {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-top: 1rem;\n}\n\n.detail-header {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n.detail-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin: 0;\n}\n\n.detail-content {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.info-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 0.5rem;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  font-size: 0.875rem;\n}\n\n.info-label {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n\n.info-value {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* === 列表样式 === */\n.list-container {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.list-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  transition: var(--transition-fast);\n}\n\n.list-item:hover {\n  background: var(--color-surface-light);\n  border-color: var(--color-border-hover);\n  transform: translateX(2px);\n}\n\n.list-item-content {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n\n.list-item-title {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n.list-item-subtitle {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* === 进度条 === */\n.progress-container {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.progress-bar {\n  height: 6px;\n  background: rgba(var(--color-border-rgb), 0.3);\n  border-radius: 3px;\n  overflow: hidden;\n}\n\n.progress-fill {\n  height: 100%;\n  background: var(--color-primary);\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n\n.progress-text {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* === 分割线 === */\n.section-divider {\n  height: 1px;\n  background: var(--color-border);\n  margin: 1rem 0;\n}\n\n/* === 响应式适配 === */\n@media (max-width: 640px) {\n  .game-panel {\n    gap: 0.5rem;\n  }\n\n  .panel-header {\n    padding: 0.5rem 0.75rem;\n    margin: 0.25rem;\n    /* 小屏时头部内容纵向排列，避免左右挤压 */\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem 0.5rem;\n  }\n\n  .filter-section {\n    padding: 0.5rem;\n    margin: 0 0.25rem;\n  }\n\n  .panel-content {\n    margin: 0 0.25rem 0.25rem 0.25rem;\n  }\n\n  .header-left {\n    min-width: 0;\n    flex: 1 1 auto;\n  }\n\n  .header-actions .btn-text {\n    display: none;\n  }\n\n  .header-actions {\n    /* 头部操作按钮独占一行并可换行 */\n    width: 100%;\n    justify-content: flex-start;\n    gap: 0.375rem;\n  }\n\n  .action-btn {\n    /* 移动端更紧凑的按钮尺寸 */\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8125rem;\n    /* 移动端触摸优化 */\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    min-height: 36px;\n    min-width: 36px; /* 确保按钮有足够宽度显示图标 */\n  }\n\n  .items-grid {\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 0.5rem;\n  }\n\n  .info-grid {\n    grid-template-columns: 1fr;\n  }\n\n  /* 详情区域按钮在窄屏堆叠，避免溢出 */\n  .details-actions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n  }\n\n  .details-actions .action-btn,\n  .details-actions .dialog-btn,\n  .details-actions .operation-btn,\n  .details-actions .card-btn {\n    flex: 1 1 100%;\n    max-width: 100%;\n  }\n\n  /* 移动端列表项触摸优化 */\n  .list-item,\n  .item-card,\n  .currency-item,\n  .filter-tab {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n  }\n\n  /* 移动端文本自动换行 */\n  .panel-title,\n  .list-item-title,\n  .detail-title {\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    hyphens: auto;\n  }\n}\n\n/* === 中等屏幕适配 (平板) === */\n@media (min-width: 641px) and (max-width: 1024px) {\n  .game-panel {\n    gap: 0.65rem;\n  }\n\n  .panel-header {\n    padding: 0.625rem 0.875rem;\n  }\n\n  .action-btn {\n    padding: 0.45rem 0.7rem;\n    font-size: 0.85rem;\n  }\n\n  .items-grid {\n    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));\n  }\n\n  .info-grid {\n    grid-template-columns: 1fr 1fr;\n  }\n}\n\n/* === 特殊状态样式 === */\n.success-indicator {\n  color: var(--color-success);\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n}\n\n.warning-indicator {\n  color: var(--color-warning);\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n}\n\n.error-indicator {\n  color: var(--color-error);\n  background: rgba(var(--color-error-rgb), 0.1);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n}\n\n.info-indicator {\n  color: var(--color-info);\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.3);\n}\n\n/* === 动画效果 === */\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.fade-in-up {\n  animation: fadeInUp 0.3s ease-out;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.pulse {\n  animation: pulse 2s infinite;\n}\n",""]);const s=i},1703:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.data-type-selector[data-v-2d9375b2] {\n  padding: 1rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n  gap: 0.75rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.data-type-selector[data-v-2d9375b2] {\n    grid-template-columns: 1fr 1fr;\n    gap: 0.5rem;\n    padding: 0.75rem;\n}\n}\n@media (max-width: 480px) {\n.data-type-selector[data-v-2d9375b2] {\n    gap: 0.4rem;\n    padding: 0.5rem;\n}\n}\n.type-btn[data-v-2d9375b2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: visible;\n  width: 100%;\n  justify-content: flex-start;\n  color: var(--color-text);\n  background: var(--color-background);\n}\n.type-btn[data-v-2d9375b2]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-primary-light);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.15);\n}\n.type-btn.active[data-v-2d9375b2] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.type-btn.active[data-v-2d9375b2]:hover,\n.type-btn.active[data-v-2d9375b2]:focus,\n.type-btn.active[data-v-2d9375b2]:focus-visible {\n  background: var(--color-primary-hover);\n  color: white;\n  border-color: var(--color-primary-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 6px 16px rgba(var(--color-primary-rgb), 0.25);\n}\n.type-btn svg[data-v-2d9375b2] {\n  color: inherit;\n}\n.type-btn[data-v-2d9375b2]:focus {\n  outline: none;\n}\n.type-btn[data-v-2d9375b2]:focus-visible {\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.25);\n  border-color: var(--color-primary);\n}\n.type-btn[data-v-2d9375b2]:active {\n  transform: translateY(0);\n  box-shadow: none;\n}\n.count-badge[data-v-2d9375b2] {\n  position: absolute;\n  top: -0.5rem;\n  right: -0.5rem;\n  background: var(--color-accent);\n  color: white;\n  font-size: 0.75rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 10px;\n  min-width: 1.25rem;\n  text-align: center;\n  z-index: 2;\n}\n\n/* 手机端按钮适配 */\n@media (max-width: 640px) {\n.type-btn[data-v-2d9375b2] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8rem;\n    gap: 0.3rem;\n}\n.count-badge[data-v-2d9375b2] {\n    font-size: 0.7rem;\n    padding: 0.1rem 0.3rem;\n    min-width: 1rem;\n}\n}\n@media (max-width: 480px) {\n.type-btn[data-v-2d9375b2] {\n    padding: 0.35rem 0.5rem;\n    font-size: 0.75rem;\n    gap: 0.25rem;\n}\n.count-badge[data-v-2d9375b2] {\n    font-size: 0.65rem;\n    padding: 0.08rem 0.25rem;\n    min-width: 0.9rem;\n}\n}\n",""]);const s=i},1756:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.admin-container[data-v-79c43826] {\n  width: 100%;\n  min-height: 100vh;\n  min-height: 100svh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem;\n  box-sizing: border-box;\n  overflow: auto;\n}\n.admin-panel[data-v-79c43826] {\n  width: 100%;\n  max-width: 1100px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  padding: 2rem;\n  color: var(--color-text);\n}\n.header[data-v-79c43826] { margin-bottom: 1.25rem;\n}\n.title-row[data-v-79c43826] { display: flex; align-items: center; justify-content: space-between; gap: 1rem;\n}\n.title[data-v-79c43826] { margin: 0; font-family: var(--font-family-serif); font-size: 2rem; color: var(--color-primary);\n}\n.subtitle[data-v-79c43826] { margin: 0.6rem 0 0; color: var(--color-text-secondary);\n}\n.status[data-v-79c43826] {\n  padding: 0.35rem 0.9rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  font-size: 0.85rem;\n}\n.status.ok[data-v-79c43826] { border-color: rgba(34, 197, 94, 0.4); color: #22c55e;\n}\n.status.warn[data-v-79c43826] { border-color: rgba(251, 191, 36, 0.4); color: #fbbf24;\n}\n.locked[data-v-79c43826] { padding: 1.25rem; border: 1px solid var(--color-border); border-radius: 12px; background: var(--color-surface-light);\n}\n.login-card[data-v-79c43826] { border: 1px solid var(--color-border); border-radius: 12px; background: var(--color-surface-light); padding: 1.25rem;\n}\n.login-title[data-v-79c43826] { font-weight: 800; margin-bottom: 0.75rem;\n}\n.login-grid[data-v-79c43826] { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;\n}\n.hint[data-v-79c43826] { margin-top: 0.75rem; color: var(--color-text-secondary); font-size: 0.85rem;\n}\n.top-actions[data-v-79c43826] { display: flex; align-items: flex-start; justify-content: space-between; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;\n}\n.tab-groups[data-v-79c43826] { display: flex; flex-direction: row; flex-wrap: wrap; gap: 1.5rem; flex: 1;\n}\n.tab-group[data-v-79c43826] { display: flex; flex-direction: column; gap: 0.5rem; min-width: fit-content;\n}\n.group-label[data-v-79c43826] {\n  font-size: 0.75rem;\n  font-weight: 700;\n  color: var(--color-text-secondary);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  padding-left: 0.25rem;\n}\n.tabs[data-v-79c43826] { display: flex; flex-direction: column; gap: 0.5rem;\n}\n.tab[data-v-79c43826] {\n  padding: 0.5rem 0.75rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.15s;\n  font-size: 0.9rem;\n}\n.tab[data-v-79c43826]:hover:not(.active) { border-color: rgba(var(--color-primary-rgb), 0.2);\n}\n.tab.active[data-v-79c43826] { background: rgba(var(--color-primary-rgb), 0.08); border-color: rgba(var(--color-primary-rgb), 0.35); color: var(--color-text); font-weight: 600;\n}\n.content[data-v-79c43826] { display: grid; gap: 1rem;\n}\n.section[data-v-79c43826] { border: 1px solid var(--color-border); border-radius: 12px; padding: 1rem; background: var(--color-surface-light);\n}\n.section-head[data-v-79c43826] { display: flex; align-items: baseline; justify-content: space-between; gap: 1rem; margin-bottom: 0.75rem;\n}\n.section-title[data-v-79c43826] { font-weight: 800;\n}\n.section-sub[data-v-79c43826] { color: var(--color-text-secondary); font-size: 0.85rem;\n}\n.toolbar[data-v-79c43826] { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; margin-bottom: 0.75rem;\n}\n.field[data-v-79c43826] { display: grid; gap: 0.35rem;\n}\n.label[data-v-79c43826] { font-size: 0.85rem; color: var(--color-text-secondary);\n}\n.input[data-v-79c43826] {\n  width: 100%;\n  padding: 0.65rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  background: var(--color-background);\n  color: var(--color-text);\n}\n.input.small[data-v-79c43826] { padding: 0.35rem 0.5rem; border-radius: 8px; width: 120px;\n}\n.textarea[data-v-79c43826] {\n  width: 100%;\n  padding: 0.65rem 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  background: var(--color-background);\n  color: var(--color-text);\n  resize: vertical;\n}\n.mono[data-v-79c43826] { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \'Liberation Mono\', monospace;\n}\n.actions[data-v-79c43826] { display: flex; justify-content: space-between; gap: 0.75rem; margin-top: 1rem;\n}\n.btn[data-v-79c43826] {\n  padding: 0.6rem 0.9rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n}\n.btn[data-v-79c43826]:hover:not(:disabled) { border-color: var(--color-primary);\n}\n.btn[data-v-79c43826]:disabled { opacity: 0.5; cursor: not-allowed;\n}\n.btn.primary[data-v-79c43826] { background: var(--color-primary); color: white; border-color: rgba(var(--color-primary-rgb), 0.7);\n}\n.btn.btn-secondary[data-v-79c43826] { background: transparent;\n}\n.btn.danger[data-v-79c43826], .btn.sm.danger[data-v-79c43826] { border-color: rgba(239, 68, 68, 0.35); color: #ef4444;\n}\n.btn.sm[data-v-79c43826] { padding: 0.35rem 0.6rem; border-radius: 8px; font-size: 0.85rem;\n}\n.table[data-v-79c43826] { border: 1px solid var(--color-border); border-radius: 12px; overflow: hidden; background: var(--color-surface);\n}\n.table.crud .row[data-v-79c43826] { display: grid; grid-template-columns: 90px 200px 1fr 170px; gap: 0.5rem; padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--color-border); align-items: center;\n}\n.table.players .row[data-v-79c43826] { display: grid; grid-template-columns: 90px 220px 1fr 120px 140px 120px; gap: 0.5rem; padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--color-border); align-items: center;\n}\n.table.saves .row[data-v-79c43826] { display: grid; grid-template-columns: 80px 150px 150px 100px 1fr 1fr 100px 100px; gap: 0.5rem; padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--color-border); align-items: center;\n}\n.table.characters .row[data-v-79c43826] { display: grid; grid-template-columns: 80px 150px 180px 120px 120px 100px 1fr; gap: 0.5rem; padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--color-border); align-items: center;\n}\n.row.header[data-v-79c43826] { background: rgba(var(--color-primary-rgb), 0.06); font-weight: 800; color: var(--color-text);\n}\n.row[data-v-79c43826]:last-child { border-bottom: none;\n}\n.cell.actions[data-v-79c43826] { display: flex; gap: 0.5rem; justify-content: flex-end;\n}\n.cell.desc[data-v-79c43826] { color: var(--color-text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n}\n.pill[data-v-79c43826] { display: inline-flex; padding: 0.2rem 0.6rem; border-radius: 999px; border: 1px solid var(--color-border); background: rgba(var(--color-primary-rgb), 0.06);\n}\n.pill.banned[data-v-79c43826] { border-color: rgba(239, 68, 68, 0.35); color: #ef4444;\n}\n.error[data-v-79c43826] { color: #ef4444; padding: 0.5rem 0;\n}\n.loading[data-v-79c43826] { color: var(--color-text-secondary); padding: 0.5rem 0;\n}\n.modal-overlay[data-v-79c43826] { position: fixed; inset: 0; background: rgba(0,0,0,0.55); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; padding: 1rem; z-index: 10000;\n}\n.modal[data-v-79c43826] { width: min(720px, 100%); background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; box-shadow: 0 25px 60px rgba(0,0,0,0.4); overflow: hidden;\n}\n.modal-head[data-v-79c43826] { padding: 1rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-79c43826] { font-weight: 900;\n}\n.modal-body[data-v-79c43826] { padding: 1rem; display: grid; gap: 0.75rem;\n}\n@media (max-width: 820px) {\n.login-grid[data-v-79c43826] { grid-template-columns: 1fr;\n}\n.table.crud .row[data-v-79c43826] { grid-template-columns: 80px 1fr 120px; grid-template-areas: "id name actions" "desc desc desc";\n}\n.table.crud .cell.desc[data-v-79c43826] { grid-area: desc;\n}\n.table.crud .cell.actions[data-v-79c43826] { grid-area: actions;\n}\n.table.players .row[data-v-79c43826] { grid-template-columns: 80px 1fr 120px; grid-template-areas: "id name actions" "time time time" "num num num";\n}\n}\n',""]);const s=i},1783:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},2031:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-57971540] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.75);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 3000;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n  animation: fadeIn-57971540 0.2s ease-out;\n}\n@keyframes fadeIn-57971540 {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n.deep-cultivation-modal[data-v-57971540] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n  animation: slideUp-57971540 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n}\n@keyframes slideUp-57971540 {\nfrom {\n    opacity: 0;\n    transform: translateY(30px) scale(0.95);\n}\nto {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n}\n.modal-header[data-v-57971540] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 24px;\n  border-bottom: 1px solid var(--color-border);\n  background: linear-gradient(135deg, var(--color-surface-light), rgba(var(--color-primary-rgb), 0.05));\n}\n.modal-header h3[data-v-57971540] {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n.close-btn[data-v-57971540] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 8px;\n  border-radius: 8px;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-btn[data-v-57971540]:hover {\n  background: var(--color-danger);\n  color: white;\n}\n.modal-content[data-v-57971540] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n}\n\n/* 功法信息区域 */\n.technique-info-section[data-v-57971540] {\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.info-header[data-v-57971540] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.technique-icon[data-v-57971540] {\n  font-size: 2.5rem;\n  width: 60px;\n  height: 60px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 12px;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n}\n.technique-icon.quality-神[data-v-57971540] { background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(248, 113, 113, 0.2));\n}\n.technique-icon.quality-仙[data-v-57971540] { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.2));\n}\n.technique-icon.quality-天[data-v-57971540] { background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(192, 132, 252, 0.2));\n}\n.technique-icon.quality-地[data-v-57971540] { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(96, 165, 250, 0.2));\n}\n.technique-icon.quality-玄[data-v-57971540] { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.2));\n}\n.technique-icon.quality-黄[data-v-57971540] { background: linear-gradient(135deg, rgba(250, 204, 21, 0.2), rgba(253, 224, 71, 0.2));\n}\n.technique-details[data-v-57971540] {\n  flex: 1;\n}\n.technique-name[data-v-57971540] {\n  font-size: 1.25rem;\n  font-weight: 700;\n  margin: 0 0 8px 0;\n  color: var(--color-text);\n}\n.technique-name.quality-神[data-v-57971540] { color: #dc2626;\n}\n.technique-name.quality-仙[data-v-57971540] { color: #f59e0b;\n}\n.technique-name.quality-天[data-v-57971540] { color: #a855f7;\n}\n.technique-name.quality-地[data-v-57971540] { color: #3b82f6;\n}\n.technique-name.quality-玄[data-v-57971540] { color: #10b981;\n}\n.technique-name.quality-黄[data-v-57971540] { color: #facc15;\n}\n.technique-quality[data-v-57971540] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n\n/* 进度条 */\n.progress-section[data-v-57971540] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.progress-label[data-v-57971540] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.progress-percent[data-v-57971540] {\n  color: var(--color-primary);\n  font-size: 1rem;\n}\n.progress-bar-bg[data-v-57971540] {\n  height: 12px;\n  background: rgba(var(--color-border-rgb), 0.3);\n  border-radius: 999px;\n  overflow: hidden;\n  position: relative;\n}\n.progress-bar-fill[data-v-57971540] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));\n  border-radius: 999px;\n  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n}\n.progress-bar-fill[data-v-57971540]::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n  animation: shine-57971540 2s infinite;\n}\n@keyframes shine-57971540 {\nto {\n    left: 100%;\n}\n}\n\n/* 效果列表 */\n.effects-section[data-v-57971540] {\n  border-top: 1px solid var(--color-border);\n  padding-top: 12px;\n}\n.effects-section h5[data-v-57971540] {\n  margin: 0 0 8px 0;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.effects-list[data-v-57971540] {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.effects-list li[data-v-57971540] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.effect-icon[data-v-57971540] {\n  font-size: 1rem;\n}\n.attr-bonus[data-v-57971540] {\n  padding: 2px 8px;\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n  border-radius: 4px;\n  font-weight: 500;\n  margin-left: 4px;\n}\n\n/* 修炼天数选择区域 */\n.cultivation-days-section[data-v-57971540] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.section-label[data-v-57971540] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin: 0;\n}\n.section-hint[data-v-57971540] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin: 0;\n  line-height: 1.5;\n}\n.input-group[data-v-57971540] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.days-input[data-v-57971540] {\n  flex: 1;\n  padding: 12px 16px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  transition: all 0.2s;\n}\n.days-input[data-v-57971540]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n.input-unit[data-v-57971540] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n\n/* 快捷按钮 */\n.preset-buttons[data-v-57971540] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n}\n.preset-btn[data-v-57971540] {\n  padding: 10px;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.preset-btn[data-v-57971540]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n}\n.preset-btn.active[data-v-57971540] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n\n/* 提示信息 */\n.cultivation-hints[data-v-57971540] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 16px;\n  background: rgba(var(--color-info-rgb), 0.05);\n  border: 1px solid rgba(var(--color-info-rgb), 0.2);\n  border-radius: 8px;\n}\n.hint-item[data-v-57971540] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.hint-icon[data-v-57971540] {\n  font-size: 1rem;\n}\n\n/* 底部按钮 */\n.modal-footer[data-v-57971540] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding: 20px 24px;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  border-radius: 0 0 16px 16px;\n}\n.btn[data-v-57971540] {\n  padding: 10px 24px;\n  border-radius: 8px;\n  font-weight: 600;\n  font-size: 0.95rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n}\n.btn-cancel[data-v-57971540] {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-57971540]:hover {\n  background: var(--color-border);\n}\n.btn-confirm[data-v-57971540] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: white;\n}\n.btn-confirm[data-v-57971540]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n.btn-confirm[data-v-57971540]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.deep-cultivation-modal[data-v-57971540] {\n    max-width: 100%;\n    border-radius: 16px 16px 0 0;\n    max-height: 95vh;\n}\n.modal-header[data-v-57971540] {\n    padding: 20px;\n}\n.modal-content[data-v-57971540] {\n    padding: 20px;\n}\n.preset-buttons[data-v-57971540] {\n    grid-template-columns: repeat(2, 1fr);\n}\n.modal-footer[data-v-57971540] {\n    padding: 16px 20px;\n}\n}\n",""]);const s=i},2047:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-e43e747c] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  animation: fadeIn-e43e747c 0.2s ease-out;\n}\n@keyframes fadeIn-e43e747c {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n.modal-content[data-v-e43e747c] {\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n  border: 1px solid rgba(255, 215, 0, 0.3);\n  border-radius: 12px;\n  width: 90%;\n  max-width: 500px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n  animation: slideUp-e43e747c 0.3s ease-out;\n}\n@keyframes slideUp-e43e747c {\nfrom {\n    transform: translateY(20px);\n    opacity: 0;\n}\nto {\n    transform: translateY(0);\n    opacity: 1;\n}\n}\n.modal-header[data-v-e43e747c] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  border-bottom: 1px solid rgba(255, 215, 0, 0.2);\n}\n.modal-header h3[data-v-e43e747c] {\n  margin: 0;\n  font-size: 1.25rem;\n  color: #ffd700;\n  font-weight: 600;\n}\n.close-btn[data-v-e43e747c] {\n  background: none;\n  border: none;\n  font-size: 2rem;\n  color: #999;\n  cursor: pointer;\n  line-height: 1;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-e43e747c]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n}\n.modal-body[data-v-e43e747c] {\n  padding: 24px;\n}\n.hint[data-v-e43e747c] {\n  margin: 0 0 12px 0;\n  color: #ccc;\n  font-size: 0.95rem;\n}\n.prompt-input[data-v-e43e747c] {\n  width: 100%;\n  padding: 12px;\n  border: 1px solid rgba(255, 215, 0, 0.3);\n  border-radius: 8px;\n  background: rgba(0, 0, 0, 0.3);\n  color: #fff;\n  font-size: 0.95rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 120px;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n.prompt-input[data-v-e43e747c]:focus {\n  outline: none;\n  border-color: #ffd700;\n  box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);\n}\n.prompt-input[data-v-e43e747c]::placeholder {\n  color: #666;\n}\n.modal-footer[data-v-e43e747c] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding: 16px 24px;\n  border-top: 1px solid rgba(255, 215, 0, 0.2);\n}\n.cancel-btn[data-v-e43e747c],\n.submit-btn[data-v-e43e747c] {\n  padding: 10px 24px;\n  border-radius: 6px;\n  font-size: 0.95rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n}\n.cancel-btn[data-v-e43e747c] {\n  background: rgba(255, 255, 255, 0.1);\n  color: #ccc;\n}\n.cancel-btn[data-v-e43e747c]:hover {\n  background: rgba(255, 255, 255, 0.15);\n  color: #fff;\n}\n.submit-btn[data-v-e43e747c] {\n  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);\n  color: #1a1a2e;\n  font-weight: 600;\n}\n.submit-btn[data-v-e43e747c]:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);\n}\n.submit-btn[data-v-e43e747c]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n",""]);const s=i},2224:e=>{"use strict";e.exports=_},2271:(e,t,n)=>{"use strict";var a=n(453),r=n(6556),o=n(8859),i=n(507),s=n(9675),l=a("%WeakMap%",!0),c=r("WeakMap.prototype.get",!0),d=r("WeakMap.prototype.set",!0),u=r("WeakMap.prototype.has",!0),m=r("WeakMap.prototype.delete",!0);e.exports=l?function(){var e,t,n={assert:function(e){if(!n.has(e))throw new s("Side channel does not contain "+o(e))},delete:function(n){if(l&&n&&("object"==typeof n||"function"==typeof n)){if(e)return m(e,n)}else if(i&&t)return t.delete(n);return!1},get:function(n){return l&&n&&("object"==typeof n||"function"==typeof n)&&e?c(e,n):t&&t.get(n)},has:function(n){return l&&n&&("object"==typeof n||"function"==typeof n)&&e?u(e,n):!!t&&t.has(n)},set:function(n,a){l&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new l),d(e,n,a)):i&&(t||(t=i()),t.set(n,a))}};return n}:i},2347:(e,t,n)=>{"use strict";n.d(t,{U:()=>c});var a=n(8651),r=n(4191);const o={修仙宗门:1,正道宗门:1,魔道宗门:1.1,魔道势力:1.1,修仙世家:.9,世家:.9,商会:.7,商会组织:.7,中立宗门:.85,散修联盟:.75};function i(e){let t=0;const n=e.最强修为||e.宗主修为||"";t=n.includes("练气")?5:n.includes("筑基")?15:n.includes("金丹")?25:n.includes("元婴")?35:n.includes("化神")?45:n.includes("炼虚")?55:n.includes("合体")?65:n.includes("渡劫")?75:20;const a=e.长老数量||0,r=(e.核心弟子数||0)+(e.内门弟子数||0)+(e.外门弟子数||0);let o=0;o+=a>=50?15:a>=30?12:a>=20?10:a>=10?7:a>=5?4:Math.max(0,a),o+=r>=1e4?10:r>=5e3?8:r>=2e3?6:r>=1e3?4:r>=500?2:Math.max(0,Math.floor(r/250));let i=0;switch(e.等级){case"超级":case"超级宗门":i=10;break;case"一流":case"一流宗门":i=7;break;case"二流":case"二流宗门":i=4;break;case"三流":case"三流宗门":i=2;break;default:i=0}let s=0;switch(e.类型){case"魔道宗门":case"魔道势力":s=3;break;case"正道宗门":case"修仙宗门":s=1;break;case"修仙世家":case"世家":s=-1;break;case"商会":case"商会组织":s=-3;break;case"散修联盟":s=-2;break;default:s=0}let l=t+o+i+s;return n.includes("渡劫")?l=Math.max(l,85):n.includes("合体")?l=Math.max(l,75):n.includes("炼虚")?l=Math.max(l,65):n.includes("化神")&&(l=Math.max(l,55)),Math.min(100,Math.max(1,Math.round(l)))}function s(e){let t=5;switch(e.等级){case"超级":case"超级宗门":t=25;break;case"一流":case"一流宗门":t=20;break;case"二流":case"二流宗门":t=15;break;case"三流":case"三流宗门":t=10;break;default:t=5}const n=o[e.类型]||1;let a=0;const r=e.长老数量||0;r>=10?a+=3:r>=5?a+=2:r>=3&&(a+=1);const i=.8+.4*Math.random(),s=Math.round((t*n+a)*i);return Math.min(30,Math.max(0,s))}var l=n(4459);class c{config;previousErrors=[];originalConfig;constructor(e){this.config=e,this.originalConfig={factionCount:e.factionCount,locationCount:e.locationCount,secretRealmsCount:e.secretRealmsCount,continentCount:e.continentCount}}async generateValidatedWorld(){for(let e=0;e<=this.config.maxRetries;e++)try{e>0&&(await new Promise(t=>setTimeout(t,this.config.retryDelay*e)),this.reduceCountsForRetry(e));const t=await this.generateWorldData(),n=this.validateWorldData(t);if(n.isValid)return{success:!0,worldInfo:t};this.previousErrors=n.errors.map(e=>e.message)}catch(e){const t=e instanceof Error?e.message:String(e);this.previousErrors=[t]}return{success:!1,errors:this.previousErrors}}reduceCountsForRetry(e){const t=Math.pow(.8,e);this.config.factionCount=Math.max(3,Math.floor(this.originalConfig.factionCount*t)),this.config.locationCount=Math.max(5,Math.floor(this.originalConfig.locationCount*t)),this.config.secretRealmsCount=Math.max(2,Math.floor(this.originalConfig.secretRealmsCount*t)),this.config.continentCount=Math.max(2,Math.floor(this.originalConfig.continentCount*t))}async generateWorldData(){const e=(0,a.getTavernHelper)();if(!e)throw new Error("AI服务未初始化，请在设置中配置AI服务");const t=await this.buildPromptWithErrors();try{const n=[{role:"user",content:t},{role:"user",content:"请根据上述要求生成完整的世界数据JSON。"}],a=await e.generateRaw({ordered_prompts:n,should_stream:!0,usageType:"world_generation",overrides:{world_info_before:"",world_info_after:""},onStreamChunk:e=>{this.config.onStreamChunk&&this.config.onStreamChunk(e)}}),r=this.parseAIResponse(String(a));return this.convertToWorldInfo(r)}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`AI生成失败: ${t}`)}}async buildPromptWithErrors(){return await this.buildPrompt()}async buildPrompt(){const e=await l.promptStorage.get("worldGeneration"),t=(0,a.isTavernEnv)()&&Math.random()>.3;t&&console.log("[世界生成] 🎲 彩蛋触发：将强制生成合欢宗");const{factionCount:n,locationCount:o,secretRealmsCount:i,continentCount:s,mapConfig:c}=this.config,d={factionCount:n,totalLocations:o,secretRealms:i,continentCount:s,characterBackground:this.config.characterBackground,worldBackground:this.config.worldBackground,worldEra:this.config.worldEra,worldName:this.config.worldName,mapConfig:c};let u=r.c.buildPrompt(d);if(t&&(u+='\n\n【特殊要求】\n请务必在势力列表中包含一个名为"合欢宗"的宗门。设定为魔道或中立，以双修采补闻名，宗门风气开放。'),e&&e.trim()){const t=await l.promptStorage.loadAll();if(t.worldGeneration?.modified)return e}return u}parseAIResponse(e){try{let t=null,n="";if(t=e.match(/```json\s*(\{[\s\S]*?\})\s*```/),t&&(n=t[1]),t||(t=e.match(/(\{[\s\S]*?"continents"\s*:\s*\[[\s\S]*?\][\s\S]*?\})/),t&&(n=t[1])),!t){const t=e.match(/\{[\s\S]*?\}/g);if(t)for(const e of t)try{const t=JSON.parse(e);if(t.continents||t.factions||t.locations){n=e;break}}catch{continue}}if(!n)throw new Error("无法解析AI响应中的JSON数据");let a=JSON.parse(n);return a.world_data&&"object"==typeof a.world_data&&(a=a.world_data),{continents:Array.isArray(a.continents)?a.continents:[],factions:Array.isArray(a.factions)?a.factions:[],locations:Array.isArray(a.locations)?a.locations:[]}}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`JSON解析失败: ${t}`)}}convertToWorldInfo(e){return{世界名称:this.config.worldName||e.world_name||e.worldName||"修仙界",世界背景:this.config.worldBackground||e.world_background||e.worldBackground||"",大陆信息:(e.continents||[]).map(e=>({名称:e.名称||e.name||"未名大陆",描述:e.描述||e.description||"一片神秘的修仙大陆，灵气充沛，势力林立",地理特征:e.terrain_features||e.地理特征||[],修真环境:e.cultivation_environment||e.修真环境||"灵气充沛，适宜修行",气候:e.climate||e.气候||"四季分明，温和宜人",天然屏障:e.natural_barriers||e.天然屏障||[],大洲边界:e.continent_bounds||e.大洲边界||[]})),势力信息:(e.factions||[]).map(e=>{const t={声望值:s(l={名称:e.name||e.名称,类型:e.type||e.类型||"修仙宗门",等级:e.level||e.等级||"三流",宗主修为:e.leadership?.宗主修为,最强修为:e.leadership?.最强修为,长老数量:e.memberCount?.byPosition?.长老||0,核心弟子数:e.leadership?.核心弟子数,内门弟子数:e.leadership?.内门弟子数,外门弟子数:e.leadership?.外门弟子数}),综合战力:i(l)},n=String(e.name||e.名称||"").includes("合欢"),a=e.leadership?{宗主:e.leadership.宗主,宗主修为:e.leadership.宗主修为,副宗主:e.leadership.副宗主??void 0,圣女:n?e.leadership.圣女??void 0:void 0,圣子:n?e.leadership.圣子??void 0:void 0,太上长老:e.leadership.太上长老??void 0,太上长老修为:e.leadership.太上长老修为??void 0,最强修为:e.leadership.最强修为||e.leadership.宗主修为,综合战力:t.综合战力,核心弟子数:e.leadership.核心弟子数,内门弟子数:e.leadership.内门弟子数,外门弟子数:e.leadership.外门弟子数}:void 0,r=e.memberCount?{total:Number(e.memberCount.total)||0,byRealm:e.memberCount.byRealm||{},byPosition:e.memberCount.byPosition||{}}:void 0,o=e.territoryInfo?{controlledAreas:e.territoryInfo.controlledAreas||[],influenceRange:e.territoryInfo.influenceRange,strategicValue:e.territoryInfo.strategicValue}:void 0;var l;return{名称:e.name||e.名称,类型:e.type||e.类型,等级:e.level||e.等级,位置:e.location||e.headquarters||e.位置,势力范围:e.territory||e.territory_bounds||e.势力范围||[],描述:e.description||e.描述,特色:e.specialties||e.features||e.特色||[],与玩家关系:e.与玩家关系||"中立",声望值:t.声望值,领导层:a,leadership:a,成员数量:r?{总数:r.total,按境界:r.byRealm,按职位:r.byPosition,...r}:void 0,memberCount:r,势力范围详情:o?{控制区域:o.controlledAreas,影响范围:o.influenceRange,战略价值:o.strategicValue}:void 0,territoryInfo:o,可否加入:void 0===e.canJoin||!!e.canJoin,canJoin:void 0===e.canJoin||!!e.canJoin,加入条件:e.joinRequirements||[],joinRequirements:e.joinRequirements||[],加入好处:e.benefits||[],benefits:e.benefits||[]}}),地点信息:(e.locations||[]).map(e=>({名称:e.name||e.名称,类型:e.type||e.类型,位置:e.位置,coordinates:e.coordinates,描述:e.description||e.描述,特色:e.features||e.特色,安全等级:e.safety_level||e.danger_level||e.安全等级||"较安全",开放状态:e.status||e.开放状态||"开放",相关势力:e.related_factions||e.相关势力||[],特殊功能:e.special_functions||e.特殊功能||[]})),地图配置:this.config.mapConfig||e.地图配置||e.map_config||{width:1e4,height:1e4,minLng:0,maxLng:1e4,minLat:0,maxLat:1e4},生成时间:(new Date).toISOString(),世界纪元:this.config.worldEra||e.world_era||"修仙纪元",特殊设定:e.special_settings||[],版本:"2.0-Enhanced"}}validateWorldData(e){const t={isValid:!0,errors:[]};return this.performCustomValidation(e,t),t.isValid||(this.previousErrors=t.errors.map(e=>e.message)),t}performCustomValidation(e,t){const n=e.势力信息.reduce((e,t)=>{const n=t.等级;return e[n]=(e[n]||0)+1,e},{});n["超级"]>1&&t.errors.push({path:"势力信息.等级",message:"超级势力不能超过1个",expected:"1个超级势力",received:`${n["超级"]}个超级势力`});const a=e.势力信息.map(e=>e.名称),r=new Set(a);a.length!==r.size&&t.errors.push({path:"势力信息.名称",message:"势力名称存在重复",expected:"所有名称唯一",received:"存在重复名称"});const o=e.地点信息.map(e=>e.名称),i=new Set(o);o.length!==i.size&&t.errors.push({path:"地点信息.名称",message:"地点名称存在重复",expected:"所有名称唯一",received:"存在重复名称"}),this.config.worldName&&e.世界名称!==this.config.worldName&&t.errors.push({path:"世界名称",message:"世界名称必须与玩家选择一致",expected:this.config.worldName,received:e.世界名称}),t.isValid=0===t.errors.length}}},2425:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(5224),n.b),d=i()(r()),u=l()(c);d.push([e.id,`\n/* ============ 教程弹窗样式 ============ */\n.help-overlay[data-v-7f9f51bc] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  padding: 1rem;\n}\n.help-modal[data-v-7f9f51bc] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 420px;\n  width: 100%;\n  max-height: 85vh;\n  overflow: hidden;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n}\n.help-header[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.help-title[data-v-7f9f51bc] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.help-close[data-v-7f9f51bc] {\n  background: transparent;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.help-close[data-v-7f9f51bc]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.help-body[data-v-7f9f51bc] {\n  padding: 1.25rem;\n  overflow-y: auto;\n  max-height: calc(85vh - 60px);\n}\n.help-version[data-v-7f9f51bc] {\n  display: inline-block;\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  padding: 2px 8px;\n  border-radius: 4px;\n  margin-bottom: 0.5rem;\n}\n.help-desc[data-v-7f9f51bc] {\n  margin: 0 0 1rem;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n.help-link-card[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  text-decoration: none;\n  margin-bottom: 1rem;\n  transition: background 0.2s;\n}\n.help-link-card[data-v-7f9f51bc]:hover {\n  background: var(--color-surface-hover);\n}\n.help-link-card span[data-v-7f9f51bc] {\n  flex: 1;\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.help-warning[data-v-7f9f51bc] {\n  padding: 0.75rem;\n  background: rgba(251, 191, 36, 0.1);\n  border: 1px solid rgba(251, 191, 36, 0.3);\n  border-radius: 8px;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  margin-bottom: 1rem;\n}\n.help-warning strong[data-v-7f9f51bc] {\n  color: #ef4444;\n}\n.help-section h3[data-v-7f9f51bc] {\n  margin: 0 0 0.75rem;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.help-features[data-v-7f9f51bc] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-bottom: 1rem;\n}\n.help-features span[data-v-7f9f51bc] {\n  font-size: 0.8rem;\n  padding: 4px 10px;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n}\n.help-footer[data-v-7f9f51bc] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.help-author[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.help-author a[data-v-7f9f51bc] {\n  color: var(--color-primary);\n  text-decoration: none;\n}\n.help-author a[data-v-7f9f51bc]:hover {\n  text-decoration: underline;\n}\n.settings-modal-overlay[data-v-7f9f51bc] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  padding: 20px;\n}\n.game-info-header[data-v-7f9f51bc]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: url(${u});\n  opacity: 0.5;\n  animation: bgFloat-7f9f51bc 25s ease-in-out infinite;\n}\n@keyframes bgFloat-7f9f51bc {\n0%, 100% {\n    transform: translate(0, 0);\n}\n50% {\n    transform: translate(10px, 10px);\n}\n}\n.game-info-header .header-bg[data-v-7f9f51bc] {\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),\n              radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);\n}\n.game-info-header .header-content[data-v-7f9f51bc] {\n  position: relative;\n  z-index: 1;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.75rem;\n}\n.game-info-header .game-title[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n}\n.game-info-header .title-icon[data-v-7f9f51bc] {\n  font-size: 1.75rem;\n}\n.game-info-header .title-text[data-v-7f9f51bc] {\n  font-size: 2rem;\n  font-weight: 900;\n  color: #fff;\n  letter-spacing: -0.02em;\n  text-shadow: 0 4px 16px rgba(0, 0, 0, 0.4),\n               0 2px 8px rgba(0, 0, 0, 0.3);\n}\n.version-subtitle-row[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.game-info-header .version-tag[data-v-7f9f51bc] {\n  background: rgba(255, 255, 255, 0.25);\n  color: #fff;\n  padding: 0.25rem 0.625rem;\n  border-radius: 20px;\n  font-size: 0.7rem;\n  font-weight: 700;\n  backdrop-filter: blur(8px);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n}\n.game-info-header .game-subtitle[data-v-7f9f51bc] {\n  color: rgba(255, 255, 255, 0.95);\n  font-size: 0.875rem;\n  margin: 0;\n  font-weight: 500;\n  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);\n}\n.game-info-header .close-btn[data-v-7f9f51bc] {\n  position: absolute;\n  top: 1.25rem;\n  right: 1.25rem;\n  background: rgba(255, 255, 255, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: #fff;\n  width: 36px;\n  height: 36px;\n  border-radius: 10px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  line-height: 1;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  backdrop-filter: blur(8px);\n}\n.game-info-header .close-btn[data-v-7f9f51bc]:hover {\n  background: rgba(255, 255, 255, 0.3);\n  transform: scale(1.08) rotate(90deg);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n}\n\n/* 内容区域 */\n.game-info-body[data-v-7f9f51bc] {\n  padding: 2rem;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  background: var(--color-surface);\n}\n\n/* 官网介绍卡片 */\n.official-intro-card[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  padding: 1.5rem;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);\n  border: 2px solid rgba(99, 102, 241, 0.2);\n  border-radius: 20px;\n  text-decoration: none;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.official-intro-card[data-v-7f9f51bc]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n.official-intro-card[data-v-7f9f51bc]:hover::before {\n  opacity: 1;\n}\n.official-intro-card[data-v-7f9f51bc]:hover {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);\n  border-color: rgba(99, 102, 241, 0.4);\n  transform: translateY(-4px);\n  box-shadow: 0 12px 32px rgba(99, 102, 241, 0.3),\n              0 4px 12px rgba(0, 0, 0, 0.15);\n}\n.intro-icon-wrapper[data-v-7f9f51bc] {\n  width: 64px;\n  height: 64px;\n  border-radius: 16px;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #6366f1;\n  flex-shrink: 0;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2),\n              inset 0 1px 0 rgba(255, 255, 255, 0.2);\n}\n.official-intro-card:hover .intro-icon-wrapper[data-v-7f9f51bc] {\n  transform: scale(1.15) rotate(-5deg);\n  box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35),\n              inset 0 1px 0 rgba(255, 255, 255, 0.3);\n}\n.intro-content[data-v-7f9f51bc] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.35rem;\n}\n.intro-title[data-v-7f9f51bc] {\n  font-size: 1.05rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.intro-desc[data-v-7f9f51bc] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.intro-arrow[data-v-7f9f51bc] {\n  color: var(--color-text-secondary);\n  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);\n}\n.official-intro-card:hover .intro-arrow[data-v-7f9f51bc] {\n  transform: translateX(6px);\n  color: #667eea;\n}\n\n/* 警告横幅 */\n.warning-banner[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  gap: 0.875rem;\n  padding: 1.25rem 1.5rem;\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.12) 0%, rgba(245, 158, 11, 0.08) 100%);\n  border: 2px solid rgba(251, 191, 36, 0.3);\n  border-left: 4px solid #f59e0b;\n  border-radius: 16px;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  box-shadow: 0 2px 12px rgba(251, 191, 36, 0.15);\n  backdrop-filter: blur(8px);\n}\n.warning-banner .warning-icon[data-v-7f9f51bc] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.warning-banner strong[data-v-7f9f51bc] {\n  color: #dc2626;\n  font-weight: 800;\n}\n\n/* 信息卡片 */\n.info-card[data-v-7f9f51bc] {\n  background: var(--color-surface-light);\n  border: 2px solid var(--color-border);\n  border-radius: 18px;\n  padding: 1.5rem;\n  transition: all 0.3s ease;\n}\n.info-card[data-v-7f9f51bc]:hover {\n  border-color: rgba(99, 102, 241, 0.35);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1),\n              0 0 0 1px rgba(99, 102, 241, 0.1);\n  transform: translateY(-2px);\n}\n.info-card .card-header[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  gap: 0.65rem;\n  margin-bottom: 1rem;\n}\n.info-card .card-icon[data-v-7f9f51bc] {\n  font-size: 1.25rem;\n}\n.info-card .card-header h4[data-v-7f9f51bc] {\n  margin: 0;\n  font-size: 1.05rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.info-card .card-desc[data-v-7f9f51bc] {\n  margin: 0;\n  font-size: 0.925rem;\n  line-height: 1.7;\n  color: var(--color-text-secondary);\n}\n\n/* 功能网格 */\n.feature-grid[data-v-7f9f51bc] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.feature-item[data-v-7f9f51bc] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.875rem;\n  padding: 1.125rem;\n  background: var(--color-surface);\n  border-radius: 14px;\n  border: 2px solid var(--color-border);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.feature-item[data-v-7f9f51bc]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n.feature-item[data-v-7f9f51bc]:hover::before {\n  opacity: 1;\n}\n.feature-item[data-v-7f9f51bc]:hover {\n  border-color: rgba(99, 102, 241, 0.4);\n  background: var(--color-surface);\n  transform: translateY(-3px);\n  box-shadow: 0 6px 16px rgba(99, 102, 241, 0.15),\n              0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.feature-item .feature-icon[data-v-7f9f51bc] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.15));\n  transition: transform 0.3s ease;\n  position: relative;\n  z-index: 1;\n}\n.feature-item:hover .feature-icon[data-v-7f9f51bc] {\n  transform: scale(1.1);\n}\n.feature-item .feature-text[data-v-7f9f51bc] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  position: relative;\n  z-index: 1;\n}\n.feature-item .feature-text strong[data-v-7f9f51bc] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.feature-item .feature-text span[data-v-7f9f51bc] {\n  font-size: 0.825rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n\n/* 紧凑型卡片布局 */\n.info-row[data-v-7f9f51bc] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1rem;\n}\n.info-card.compact[data-v-7f9f51bc] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n}\n.info-card.compact .card-header[data-v-7f9f51bc] {\n  margin-bottom: 0.75rem;\n}\n.author-content[data-v-7f9f51bc], .copyright-content[data-v-7f9f51bc] {\n  font-size: 0.925rem;\n  color: var(--color-text-secondary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.65rem;\n}\n.author-name[data-v-7f9f51bc] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.github-link[data-v-7f9f51bc] {\n  color: #6366f1;\n  text-decoration: none;\n  font-size: 0.875rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n}\n.github-link[data-v-7f9f51bc]:hover {\n  color: #8b5cf6;\n  text-decoration: underline;\n}\n\n/* 深色主题适配 */\n[data-theme='dark'] .game-info-header[data-v-7f9f51bc] {\n  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #c026d3 100%);\n}\n[data-theme='dark'] .warning-banner[data-v-7f9f51bc] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);\n  border-color: rgba(251, 191, 36, 0.35);\n  border-left-color: #f59e0b;\n}\n[data-theme='dark'] .warning-banner strong[data-v-7f9f51bc] {\n  color: #fca5a5;\n}\n[data-theme='dark'] .official-intro-card[data-v-7f9f51bc] {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(139, 92, 246, 0.08) 100%);\n  border-color: rgba(99, 102, 241, 0.25);\n}\n[data-theme='dark'] .official-intro-card[data-v-7f9f51bc]:hover {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);\n  border-color: rgba(99, 102, 241, 0.45);\n}\n[data-theme='dark'] .intro-icon-wrapper[data-v-7f9f51bc] {\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.2) 100%);\n  color: #818cf8;\n}\n\n/* 滚动条美化 */\n.game-info-body[data-v-7f9f51bc]::-webkit-scrollbar {\n  width: 8px;\n}\n.game-info-body[data-v-7f9f51bc]::-webkit-scrollbar-track {\n  background: transparent;\n  margin: 8px 0;\n}\n.game-info-body[data-v-7f9f51bc]::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.game-info-body[data-v-7f9f51bc]::-webkit-scrollbar-thumb:hover {\n  background: var(--color-text-secondary);\n}\n.settings-modal-overlay[data-v-7f9f51bc] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  padding: 20px;\n}\n.settings-modal-content[data-v-7f9f51bc] {\n  background: var(--color-surface, #ffffff);\n  border-radius: 14px;\n  width: min(760px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);\n  border: 1px solid var(--color-border);\n  animation: modalIn 0.2s ease;\n}\n.settings-modal-header[data-v-7f9f51bc] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.settings-modal-header h3[data-v-7f9f51bc] {\n  margin: 0;\n  font-size: 1.15rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.settings-modal-body[data-v-7f9f51bc] {\n  flex: 1;\n  overflow: auto;\n}\n.close-btn[data-v-7f9f51bc] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  font-size: 1.5rem;\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-btn[data-v-7f9f51bc]:hover {\n  background: var(--color-surface-hover);\n}\n`,""]);const m=d},2445:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-library[data-v-8e5c2630] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-height: 60vh;\n  overflow-y: auto;\n}\n.player-info-bar[data-v-8e5c2630] {\n  display: flex;\n  gap: 1.5rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.05));\n  border-radius: 8px;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.info-item[data-v-8e5c2630] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-label[data-v-8e5c2630] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-8e5c2630] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.position[data-v-8e5c2630] {\n  color: #9333ea;\n}\n.info-value.contribution[data-v-8e5c2630] {\n  color: #f59e0b;\n}\n.library-floors[data-v-8e5c2630] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.floor-section[data-v-8e5c2630] {\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  overflow: hidden;\n  transition: all 0.2s ease;\n}\n.floor-section.locked[data-v-8e5c2630] {\n  opacity: 0.6;\n}\n.floor-section.expanded[data-v-8e5c2630] {\n  border-color: rgba(147, 51, 234, 0.3);\n}\n.floor-header[data-v-8e5c2630] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--color-background);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.floor-header[data-v-8e5c2630]:hover {\n  background: var(--color-surface);\n}\n.floor-info[data-v-8e5c2630] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.floor-icon[data-v-8e5c2630] {\n  font-size: 1.25rem;\n}\n.floor-name[data-v-8e5c2630] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.floor-requirement[data-v-8e5c2630] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: var(--color-surface);\n  padding: 0.2rem 0.5rem;\n  border-radius: 4px;\n}\n.floor-status[data-v-8e5c2630] {\n  color: var(--color-text-secondary);\n}\n.floor-status svg.rotated[data-v-8e5c2630] {\n  transform: rotate(180deg);\n}\n.floor-content[data-v-8e5c2630] {\n  padding: 1rem;\n  background: var(--color-surface);\n  border-top: 1px solid var(--color-border);\n}\n.empty-floor[data-v-8e5c2630] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-8e5c2630] {\n  opacity: 0.5;\n  margin-bottom: 0.5rem;\n}\n.hint[data-v-8e5c2630] {\n  font-size: 0.8rem;\n  opacity: 0.7;\n}\n.technique-list[data-v-8e5c2630] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.technique-card[data-v-8e5c2630] {\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.technique-card.can-afford[data-v-8e5c2630] {\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.technique-card.owned[data-v-8e5c2630] {\n  opacity: 0.7;\n  border-color: rgba(147, 51, 234, 0.3);\n}\n.tech-header[data-v-8e5c2630] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.tech-name[data-v-8e5c2630] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.tech-quality[data-v-8e5c2630] {\n  font-size: 0.75rem;\n  padding: 0.15rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.quality-common[data-v-8e5c2630] { background: rgba(156, 163, 175, 0.2); color: #6b7280;\n}\n.quality-yellow[data-v-8e5c2630] { background: rgba(245, 158, 11, 0.2); color: #f59e0b;\n}\n.quality-xuan[data-v-8e5c2630] { background: rgba(139, 92, 246, 0.2); color: #8b5cf6;\n}\n.quality-earth[data-v-8e5c2630] { background: rgba(59, 130, 246, 0.2); color: #3b82f6;\n}\n.quality-heaven[data-v-8e5c2630] { background: rgba(239, 68, 68, 0.2); color: #ef4444;\n}\n.tech-desc[data-v-8e5c2630] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n}\n.tech-footer[data-v-8e5c2630] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.tech-cost[data-v-8e5c2630] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  font-size: 0.8rem;\n  color: #f59e0b;\n  font-weight: 500;\n}\n.learn-btn[data-v-8e5c2630] {\n  padding: 0.35rem 0.75rem;\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  border: none;\n  border-radius: 4px;\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.learn-btn[data-v-8e5c2630]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);\n}\n.learn-btn[data-v-8e5c2630]:disabled {\n  background: #6b7280;\n  cursor: not-allowed;\n}\n.owned-badge[data-v-8e5c2630] {\n  font-size: 0.75rem;\n  color: #9333ea;\n  font-weight: 500;\n}\n.library-tips[data-v-8e5c2630] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #3b82f6;\n}\n.slide-enter-active[data-v-8e5c2630],\n.slide-leave-active[data-v-8e5c2630] {\n  transition: all 0.3s ease;\n}\n.slide-enter-from[data-v-8e5c2630],\n.slide-leave-to[data-v-8e5c2630] {\n  opacity: 0;\n  max-height: 0;\n  padding: 0 1rem;\n}\n",""]);const s=i},2497:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-5cceb5b0] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-5cceb5b0]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-5cceb5b0] {\n  font-weight: 500;\n}\n.sync-icon[data-v-5cceb5b0] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-5cceb5b0] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-5cceb5b0]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.cloud-sync-button.synced[data-v-5cceb5b0]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-5cceb5b0] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-5cceb5b0] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-5cceb5b0] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-5cceb5b0] {\n  display: none;\n}\n",""]);const s=i},2634:()=>{},2642:(e,t,n)=>{"use strict";var a=n(7720),r=Object.prototype.hasOwnProperty,o=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:a.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,a){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(o),c=s?o.slice(0,s.index):o,d=[];if(c){if(!n.plainObjects&&r.call(Object.prototype,c)&&!n.allowPrototypes)return;d.push(c)}for(var u=0;n.depth>0&&null!==(s=i.exec(o))&&u<n.depth;){if(u+=1,!n.plainObjects&&r.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(s[1])}if(s){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");d.push("["+o.slice(s.index)+"]")}return function(e,t,n,a){for(var r=a?t:l(t,n),o=e.length-1;o>=0;--o){var i,s=e[o];if("[]"===s&&n.parseArrays)i=n.allowEmptyArrays&&(""===r||n.strictNullHandling&&null===r)?[]:[].concat(r);else{i=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,d=n.decodeDotInKeys?c.replace(/%2E/g,"."):c,u=parseInt(d,10);n.parseArrays||""!==d?!isNaN(u)&&s!==d&&String(u)===d&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(i=[])[u]=r:"__proto__"!==d&&(i[d]=r):i={0:r}}r=i}return r}(d,t,n,a)}};e.exports=function(e,t){var n=function(e){if(!e)return i;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?i.charset:e.charset,n=void 0===e.duplicates?i.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||i.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:i.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:i.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||a.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:i.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:i.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var n={__proto__:null},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;c=c.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var d,u=t.parameterLimit===1/0?void 0:t.parameterLimit,m=c.split(t.delimiter,u),p=-1,g=t.charset;if(t.charsetSentinel)for(d=0;d<m.length;++d)0===m[d].indexOf("utf8=")&&("utf8=%E2%9C%93"===m[d]?g="utf-8":"utf8=%26%2310003%3B"===m[d]&&(g="iso-8859-1"),p=d,d=m.length);for(d=0;d<m.length;++d)if(d!==p){var h,f,v=m[d],b=v.indexOf("]="),y=-1===b?v.indexOf("="):b+1;-1===y?(h=t.decoder(v,i.decoder,g,"key"),f=t.strictNullHandling?null:""):(h=t.decoder(v.slice(0,y),i.decoder,g,"key"),f=a.maybeMap(l(v.slice(y+1),t),function(e){return t.decoder(e,i.decoder,g,"value")})),f&&t.interpretNumericEntities&&"iso-8859-1"===g&&(f=s(f)),v.indexOf("[]=")>-1&&(f=o(f)?[f]:f);var x=r.call(n,h);x&&"combine"===t.duplicates?n[h]=a.combine(n[h],f):x&&"last"!==t.duplicates||(n[h]=f)}return n}(e,n):e,u=n.plainObjects?Object.create(null):{},m=Object.keys(d),p=0;p<m.length;++p){var g=m[p],h=c(g,d[g],n,"string"==typeof e);u=a.merge(u,h,n)}return!0===n.allowSparse?u:a.compact(u)}},2748:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.world-info-section[data-v-dbebcd90] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-dbebcd90] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-dbebcd90] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.world-info-content[data-v-dbebcd90] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-dbebcd90] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-dbebcd90] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-dbebcd90] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.world-info-section[data-v-dbebcd90] {\n    padding: 0.75rem;\n}\n.section-title[data-v-dbebcd90] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-dbebcd90] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-dbebcd90] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.world-info-section[data-v-dbebcd90] {\n    padding: 0.5rem;\n}\n.section-title[data-v-dbebcd90] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-dbebcd90] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},2794:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},2814:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%2394a3b8%27 d=%27M6 8L1 3h10z%27/%3E%3C/svg%3E"},2914:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.loading-overlay[data-v-23d51e69] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.85), rgba(15, 21, 53, 0.85));\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 10000;\n  border-top: 2px solid var(--tech-primary);\n}\n.loading-content[data-v-23d51e69] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n}\n.spinner[data-v-23d51e69] {\n  width: 50px;\n  height: 50px;\n  border: 4px solid rgba(0, 217, 255, 0.2);\n  border-top-color: var(--tech-primary);\n  border-right-color: var(--tech-secondary);\n  border-radius: 50%;\n  animation: spin-23d51e69 1.2s linear infinite;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.4), inset 0 0 20px rgba(0, 217, 255, 0.1);\n}\n@keyframes spin-23d51e69 {\nto {\n    transform: rotate(360deg);\n}\n}\n.loading-text[data-v-23d51e69] {\n  color: var(--tech-primary);\n  font-size: 1.2rem;\n  font-weight: 600;\n  text-shadow: 0 0 15px rgba(0, 217, 255, 0.5);\n  letter-spacing: 0.05em;\n}\n.fade-enter-active[data-v-23d51e69],\n.fade-leave-active[data-v-23d51e69] {\n  transition: opacity 0.3s ease;\n}\n.fade-enter-from[data-v-23d51e69],\n.fade-leave-to[data-v-23d51e69] {\n  opacity: 0;\n}\n",""]);const s=i},3093:(e,t,n)=>{"use strict";var a=n(6840);e.exports=function(e){return a(e)||0===e?e:e<0?-1:1}},3098:(e,t,n)=>{"use strict";n.d(t,{deepCleanForClone:()=>r,zB:()=>o});var a=n(6988);function r(e){return JSON.parse(JSON.stringify(e))}function o(e,t,n){if(!e)return{isValid:!1,errors:["存档数据为空"]};const r=[...(0,a.$)(e).errors];if(t?.角色){const e=t.角色;e.名字&&"string"==typeof e.名字||r.push("角色姓名无效"),e.性别||r.push("角色性别缺失")}if("creation"===n){const t=e?.角色?.位置;t&&"object"==typeof t||r.push("角色.位置 缺失");const n=e?.角色?.属性?.境界;n&&"object"==typeof n||r.push("角色.属性.境界 缺失")}return{isValid:0===r.length,errors:r}}},3126:(e,t,n)=>{"use strict";var a=n(6743),r=n(9675),o=n(76),i=n(3144);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new r("a function is required");return i(a,o,e)}},3144:(e,t,n)=>{"use strict";var a=n(6743),r=n(1002),o=n(76),i=n(7119);e.exports=i||a.call(o,r)},3147:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.talent-selection-container[data-v-0d74e85b] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n/* ========== 深色玻璃拟态风格 ========== */\n.loading-state[data-v-0d74e85b], .error-state[data-v-0d74e85b], .placeholder[data-v-0d74e85b] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.talent-layout[data-v-0d74e85b] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.talent-left-panel[data-v-0d74e85b] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n/* 顶部功能按钮 - 深色玻璃拟态风格 */\n.top-actions-container[data-v-0d74e85b] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-0d74e85b] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-0d74e85b]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n\n/* 亮色主题顶部按钮 */\n[data-theme="light"] .top-actions-container[data-v-0d74e85b] {\n  background: rgba(241, 245, 249, 0.6);\n  border-bottom-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-0d74e85b] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-0d74e85b]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n.talent-list-container[data-v-0d74e85b] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.talent-list-container[data-v-0d74e85b]::-webkit-scrollbar { width: 6px;\n}\n.talent-list-container[data-v-0d74e85b]::-webkit-scrollbar-track { background: transparent;\n}\n.talent-list-container[data-v-0d74e85b]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.talent-list-container[data-v-0d74e85b]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式 ========== */\n.talent-item[data-v-0d74e85b] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.item-content[data-v-0d74e85b] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n  gap: 0.5rem;\n}\n.talent-cost[data-v-0d74e85b] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-0d74e85b] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.talent-item:hover .action-buttons[data-v-0d74e85b] {\n  opacity: 1;\n}\n.edit-btn[data-v-0d74e85b], .delete-btn[data-v-0d74e85b] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-0d74e85b]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.1);\n}\n.delete-btn[data-v-0d74e85b]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.1);\n}\n.talent-item[data-v-0d74e85b]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.talent-item.selected[data-v-0d74e85b] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.talent-name[data-v-0d74e85b] {\n  font-weight: 500;\n  color: #f1f5f9;\n}\n.talent-item.selected .talent-name[data-v-0d74e85b] {\n  color: #bfdbfe;\n}\n.single-actions-container[data-v-0d74e85b] {\n  border-top: 1px solid var(--color-border);\n  background: rgba(0, 0, 0, 0.3);\n  padding: 0.5rem;\n  display: flex;\n  gap: 0.5rem;\n}\n.action-item[data-v-0d74e85b] {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0.8rem 1rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 1rem;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n.action-item[data-v-0d74e85b]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-name[data-v-0d74e85b] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.talent-details-container[data-v-0d74e85b] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.talent-details[data-v-0d74e85b] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.talent-details h2[data-v-0d74e85b] {\n  margin: 0 0 1rem 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.description-scroll[data-v-0d74e85b] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  margin-bottom: 1rem;\n  padding-right: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll p[data-v-0d74e85b] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.description-scroll[data-v-0d74e85b]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-0d74e85b]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-0d74e85b]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.talent-layout[data-v-0d74e85b] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.talent-layout[data-v-0d74e85b] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.talent-details h2[data-v-0d74e85b] {\n    font-size: 1.6rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-0d74e85b] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-0d74e85b] {\n    flex-grow: 1;\n    text-align: center;\n}\n.talent-layout[data-v-0d74e85b] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.talent-left-panel[data-v-0d74e85b] {\n    order: 1;\n    max-height: 40vh;\n}\n.talent-details-container[data-v-0d74e85b] {\n    order: 2;\n    min-height: 300px;\n}\n.talent-list-container[data-v-0d74e85b] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.talent-item[data-v-0d74e85b],\n  .action-item[data-v-0d74e85b] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.talent-layout[data-v-0d74e85b] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.talent-left-panel[data-v-0d74e85b] {\n    max-height: 35vh;\n}\n.talent-list-container[data-v-0d74e85b] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.talent-item[data-v-0d74e85b] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-0d74e85b] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-0d74e85b] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.talent-details-container[data-v-0d74e85b] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.talent-details h2[data-v-0d74e85b] {\n    font-size: 1.4rem;\n    margin-bottom: 0.8rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-0d74e85b] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.talent-selection-container[data-v-0d74e85b] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.talent-layout[data-v-0d74e85b] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.talent-left-panel[data-v-0d74e85b] {\n    max-height: none;\n    border-radius: 6px;\n}\n.talent-list-container[data-v-0d74e85b] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.talent-item[data-v-0d74e85b] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.talent-name[data-v-0d74e85b] {\n    font-size: 0.9rem;\n}\n.single-actions-container[data-v-0d74e85b] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-0d74e85b] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.talent-details-container[data-v-0d74e85b] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.talent-details h2[data-v-0d74e85b] {\n    font-size: 1.3rem;\n    margin-bottom: 0.6rem;\n}\n.description-scroll[data-v-0d74e85b] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n}\n.placeholder[data-v-0d74e85b] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-0d74e85b] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-0d74e85b] {\n    text-align: center;\n}\n}\n@media (max-width: 360px) {\n.talent-selection-container[data-v-0d74e85b] {\n    padding: 0.3rem;\n}\n.talent-layout[data-v-0d74e85b] {\n    gap: 0.4rem;\n}\n.talent-left-panel[data-v-0d74e85b] {\n    max-height: 28vh;\n}\n.talent-list-container[data-v-0d74e85b] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.talent-item[data-v-0d74e85b] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.talent-name[data-v-0d74e85b] {\n    font-size: 0.8rem;\n}\n.talent-details-container[data-v-0d74e85b] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.talent-details h2[data-v-0d74e85b] {\n    font-size: 1.1rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-0d74e85b] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n}\n.action-item[data-v-0d74e85b] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-0d74e85b] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .talent-left-panel[data-v-0d74e85b],\n[data-theme="light"] .talent-details-container[data-v-0d74e85b] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .talent-item[data-v-0d74e85b] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .talent-item[data-v-0d74e85b]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .talent-item.selected[data-v-0d74e85b] {\n  background: rgba(219, 234, 254, 0.8);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .talent-name[data-v-0d74e85b] {\n  color: #1e293b;\n}\n[data-theme="light"] .talent-item.selected .talent-name[data-v-0d74e85b] {\n  color: #1e40af;\n}\n[data-theme="light"] .talent-details h2[data-v-0d74e85b] {\n  color: #2563eb;\n}\n[data-theme="light"] .description-scroll p[data-v-0d74e85b] {\n  color: #475569;\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-0d74e85b],\n[data-theme="light"] .delete-btn[data-v-0d74e85b] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-0d74e85b]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-0d74e85b]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n',""]);const s=i},3293:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.account-container[data-v-2600fd5e] {\n  width: 100%;\n  height: 100vh;\n  min-height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem;\n  box-sizing: border-box;\n  overflow: auto;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05), rgba(157, 0, 255, 0.03));\n  position: relative;\n}\n.account-container[data-v-2600fd5e]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-image:\n    linear-gradient(0deg, transparent 24%, rgba(0, 217, 255, 0.02) 25%, rgba(0, 217, 255, 0.02) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.02) 75%, rgba(0, 217, 255, 0.02) 76%, transparent 77%, transparent),\n    linear-gradient(90deg, transparent 24%, rgba(0, 217, 255, 0.02) 25%, rgba(0, 217, 255, 0.02) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.02) 75%, rgba(0, 217, 255, 0.02) 76%, transparent 77%, transparent);\n  background-size: 50px 50px;\n  pointer-events: none;\n  z-index: 0;\n}\n.account-panel[data-v-2600fd5e] {\n  width: 100%;\n  max-width: 900px;\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.95), rgba(10, 14, 39, 0.95));\n  border: 2px solid var(--tech-primary);\n  border-radius: 4px;\n  box-shadow: 0 25px 50px rgba(0, 217, 255, 0.2), inset 0 0 40px rgba(0, 217, 255, 0.1);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  padding: 2.5rem;\n  color: var(--tech-primary);\n  position: relative;\n  z-index: 1;\n}\n.account-panel[data-v-2600fd5e]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n}\n.header[data-v-2600fd5e] {\n  margin-bottom: 1.5rem;\n}\n.title-row[data-v-2600fd5e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.title[data-v-2600fd5e] {\n  margin: 0;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  color: var(--tech-primary);\n  text-shadow: 0 0 15px rgba(0, 217, 255, 0.4);\n}\n.status[data-v-2600fd5e] {\n  padding: 0.35rem 0.9rem;\n  border-radius: 3px;\n  border: 1px solid;\n  font-size: 0.85rem;\n  font-weight: 600;\n}\n.status.ok[data-v-2600fd5e] {\n  border-color: rgba(0, 255, 136, 0.4);\n  color: var(--tech-success);\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));\n  box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);\n}\n.status.warn[data-v-2600fd5e] {\n  border-color: rgba(255, 107, 0, 0.4);\n  color: var(--tech-warning);\n  background: linear-gradient(135deg, rgba(255, 107, 0, 0.1), rgba(255, 107, 0, 0.05));\n  box-shadow: 0 0 10px rgba(255, 107, 0, 0.2);\n}\n.subtitle[data-v-2600fd5e] {\n  margin: 0.6rem 0 0;\n  color: rgba(0, 217, 255, 0.7);\n}\n.sections[data-v-2600fd5e] {\n  display: grid;\n  gap: 1rem;\n}\n.section[data-v-2600fd5e] {\n  border: 1px solid var(--tech-border);\n  border-radius: 4px;\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.7), rgba(10, 14, 39, 0.7));\n  overflow: hidden;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.05);\n  transition: all 0.3s ease;\n}\n.section[data-v-2600fd5e]:hover {\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.1);\n  border-color: var(--tech-primary);\n}\n.section-title[data-v-2600fd5e] {\n  list-style: none;\n  padding: 0.85rem 1rem;\n  font-weight: 700;\n  color: var(--tech-primary);\n  cursor: pointer;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08), rgba(157, 0, 255, 0.05));\n  text-shadow: 0 0 8px rgba(0, 217, 255, 0.3);\n  transition: all 0.3s ease;\n}\n.section-title[data-v-2600fd5e]::-webkit-details-marker {\n  display: none;\n}\n.section:hover .section-title[data-v-2600fd5e] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n}\n.section-body[data-v-2600fd5e] {\n  padding: 0 1rem 1rem;\n}\n.info-list[data-v-2600fd5e] {\n  display: grid;\n  gap: 0.6rem;\n}\n.info-row[data-v-2600fd5e] {\n  display: flex;\n  justify-content: space-between;\n  gap: 1rem;\n  padding-bottom: 0.6rem;\n  border-bottom: 1px solid var(--tech-border);\n}\n.info-row[data-v-2600fd5e]:last-child {\n  border-bottom: none;\n  padding-bottom: 0;\n}\n.info-label[data-v-2600fd5e] {\n  color: rgba(0, 217, 255, 0.6);\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.info-value[data-v-2600fd5e] {\n  font-weight: 600;\n  color: var(--tech-primary);\n}\n.info-empty[data-v-2600fd5e] {\n  color: rgba(0, 217, 255, 0.4);\n  font-size: 0.9rem;\n  padding: 0.3rem 0;\n}\n.actions[data-v-2600fd5e] {\n  margin-top: 2rem;\n  display: flex;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.btn[data-v-2600fd5e] {\n  flex: 1;\n  padding: 0.9rem 1rem;\n  border-radius: 4px;\n  border: 2px solid var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.1));\n  color: var(--tech-primary);\n  cursor: pointer;\n  transition: all 0.3s ease;\n  font-weight: 600;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);\n}\n.btn[data-v-2600fd5e]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);\n}\n.btn.btn-secondary[data-v-2600fd5e] {\n  border-color: var(--tech-secondary);\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(157, 0, 255, 0.05));\n  color: var(--tech-secondary);\n  box-shadow: 0 0 15px rgba(157, 0, 255, 0.2);\n}\n.btn.btn-secondary[data-v-2600fd5e]:hover {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(157, 0, 255, 0.1));\n  box-shadow: 0 0 25px rgba(157, 0, 255, 0.4);\n}\n.btn.danger[data-v-2600fd5e] {\n  border-color: var(--tech-danger);\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.1), rgba(255, 0, 85, 0.05));\n  color: var(--tech-danger);\n  box-shadow: 0 0 15px rgba(255, 0, 85, 0.2);\n}\n.btn.danger[data-v-2600fd5e]:hover {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(255, 0, 85, 0.1));\n  box-shadow: 0 0 25px rgba(255, 0, 85, 0.4);\n}\n.loading[data-v-2600fd5e] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--tech-primary);\n  font-size: 1.1rem;\n}\n.backend-locked[data-v-2600fd5e] {\n  text-align: center;\n  padding: 2rem;\n}\n.backend-locked p[data-v-2600fd5e] {\n  color: rgba(0, 217, 255, 0.7);\n  margin-bottom: 1.5rem;\n}\n@media (max-width: 768px) {\n.account-panel[data-v-2600fd5e] {\n    padding: 2rem 1.5rem;\n}\n.title-row[data-v-2600fd5e] {\n    flex-direction: column;\n    align-items: flex-start;\n}\n}\n",""]);const s=i},3302:(e,t,n)=>{"use strict";n.d(t,{Yz:()=>o,w9:()=>r});class a{static instance;debugMode=!1;consoleDebug=!1;performanceMonitor=!1;constructor(){this.loadDebugSettings()}static getInstance(){return a.instance||(a.instance=new a),a.instance}loadDebugSettings(){try{const e=localStorage.getItem("dad_game_settings");if(e){const t=JSON.parse(e);this.debugMode=t.debugMode||!1,this.consoleDebug=t.consoleDebug||!1,this.performanceMonitor=t.performanceMonitor||!1}}catch(e){console.error("加载调试设置失败:",e),this.debugMode=!1,this.consoleDebug=!1,this.performanceMonitor=!1}}reloadSettings(){this.loadDebugSettings()}setDebugMode(e){this.debugMode=e,this.reloadSettings(),this.consoleDebug&&console.log("[调试] 调试模式"+(e?"已启用":"已禁用"))}isDebugMode(){return this.debugMode}isConsoleDebugEnabled(){return this.debugMode&&this.consoleDebug}isPerformanceMonitorEnabled(){return this.debugMode&&this.performanceMonitor}log(e,t,n){this.isConsoleDebugEnabled()&&(void 0!==n?console.log(`[${e}] ${t}`,n):console.log(`[${e}] ${t}`))}warn(e,t,n){this.isConsoleDebugEnabled()&&(void 0!==n?console.warn(`[${e}] ${t}`,n):console.warn(`[${e}] ${t}`))}error(e,t,n){void 0!==n?console.error(`[${e}] ${t}`,n):console.error(`[${e}] ${t}`)}timeStart(e){if(this.isPerformanceMonitorEnabled())try{console.time(`[性能] ${e}`)}catch(e){}}timeEnd(e){if(this.isPerformanceMonitorEnabled())try{console.timeEnd(`[性能] ${e}`)}catch(e){}}group(e){this.isConsoleDebugEnabled()&&console.group(`[调试] ${e}`)}groupEnd(){this.isConsoleDebugEnabled()&&console.groupEnd()}info(e,t,n){this.debugMode&&(void 0!==n?console.info(`[${e}] ${t}`,n):console.info(`[${e}] ${t}`))}table(e,t,n){this.isConsoleDebugEnabled()&&(console.log(`[${e}] ${t}:`),console.table(n))}count(e){this.isPerformanceMonitorEnabled()&&console.count(`[统计] ${e}`)}countReset(e){this.isPerformanceMonitorEnabled()&&console.countReset(`[统计] ${e}`)}}const r=a.getInstance(),o={log:(e,t,n)=>r.log(e,t,n),warn:(e,t,n)=>r.warn(e,t,n),error:(e,t,n)=>r.error(e,t,n),info:(e,t,n)=>r.info(e,t,n),timeStart:e=>r.timeStart(e),timeEnd:e=>r.timeEnd(e),group:e=>r.group(e),groupEnd:()=>r.groupEnd(),table:(e,t,n)=>r.table(e,t,n),count:e=>r.count(e),countReset:e=>r.countReset(e),setMode:e=>r.setDebugMode(e),isEnabled:()=>r.isDebugMode(),reload:()=>r.reloadSettings()}},3310:(e,t,n)=>{"use strict";n.d(t,{useActionQueueStore:()=>o});var a=n(810),r=n(4061);const o=(0,a.nY)("actionQueue",()=>{const e=(0,r.ref)([]),t=()=>{console.log("[操作队列] 清空操作队列，共",e.value.length,"个操作"),e.value=[],a()},n=()=>0===e.value.length?"":`\n\n【玩家最近操作】\n在本轮对话前，玩家进行了以下操作：\n${e.value.map(e=>{switch(e.type){case"cultivate":return"大道"===e.itemType?`感悟了《${e.itemName}》大道`:`修炼了《${e.itemName}》功法`;case"equip":return`装备了《${e.itemName}》${e.itemType||"法宝"}`;case"use":return e.description||`使用了《${e.itemName}》`;case"unequip":return`卸下了《${e.itemName}》装备`;case"discard":return`丢弃了《${e.itemName}》`;case"npc_trade":return`尝试与 ${e.npcName} 交易 ${e.itemName}`;case"npc_request":return`向 ${e.npcName} 索要 ${e.itemName}`;case"npc_steal":return`尝试从 ${e.npcName} 身上偷取 ${e.itemName}`;case"npc_memory_summarize":return`你开始整理关于 ${e.npcName} 的记忆碎片，试图从最旧的 ${e.count||10} 条记忆中总结出关键信息。`;default:return e.description}}).map(e=>`• ${e}`).join("\n")}\n\n⚠️ **重要提醒**：请优先基于这些玩家操作来生成回应！先处理和反映这些具体动作的结果，然后再回应用户输入的文本内容。这些操作具有更高的优先级，应该在叙事中得到明确体现。`,a=()=>{try{localStorage.setItem("dao_action_queue",JSON.stringify(e.value))}catch(e){console.warn("[操作队列] 保存到localStorage失败:",e)}};return(()=>{try{const t=localStorage.getItem("dao_action_queue");if(t){const n=JSON.parse(t),a=Date.now()-36e5;e.value=n.filter(e=>e.timestamp>a),console.log("[操作队列] 从存储加载",e.value.length,"个操作")}}catch(e){console.warn("[操作队列] 从localStorage加载失败:",e)}})(),{pendingActions:e,addAction:t=>{const n={...t,id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};"equip"===n.type?e.value=e.value.filter(e=>!("unequip"===e.type&&e.itemName===n.itemName)):"unequip"===n.type&&(e.value=e.value.filter(e=>!("equip"===e.type&&e.itemName===n.itemName))),"cultivate"===n.type&&(e.value=e.value.filter(e=>"cultivate"!==e.type)),"comprehend"===n.type&&(e.value=e.value.filter(e=>"comprehend"!==e.type));const r=e.value.findIndex(e=>e.type===t.type&&e.itemName===t.itemName);-1!==r?e.value[r]=n:e.value.push(n),console.log("[操作队列] 添加操作:",n),a()},removeAction:t=>{const n=e.value.findIndex(e=>e.id===t);if(-1!==n){const t=e.value.splice(n,1)[0];return console.log("[操作队列] 移除操作:",t),a(),t}return null},clearActions:t,getActionPrompt:n,consumeActions:()=>{const e=n();return e&&t(),e}}})},3353:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.state-change-overlay[data-v-a2a95590] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n}\n.state-change-viewer[data-v-a2a95590] {\n  width: 90%;\n  max-width: 500px;\n  max-height: 80vh;\n  background-color: var(--color-surface);\n  border-radius: 16px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n  border: 1px solid var(--color-border);\n  animation: modal-fade-in-a2a95590 0.3s ease-out;\n}\n@keyframes modal-fade-in-a2a95590 {\nfrom {\n    opacity: 0;\n    transform: scale(0.95);\n}\nto {\n    opacity: 1;\n    transform: scale(1);\n}\n}\n.viewer-header[data-v-a2a95590] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.viewer-header h3[data-v-a2a95590] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.close-btn[data-v-a2a95590] {\n  background: none;\n  border: none;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  padding: 0.25rem;\n  border-radius: 50%;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-a2a95590]:hover {\n  background-color: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.viewer-summary[data-v-a2a95590] {\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--color-surface-light);\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.summary-item[data-v-a2a95590] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n  font-weight: 500;\n}\n.summary-item.added[data-v-a2a95590] { color: var(--color-success);\n}\n.summary-item.removed[data-v-a2a95590] { color: #ff9800;\n}\n.summary-item.updated[data-v-a2a95590] { color: var(--color-info);\n}\n.summary-item.errors[data-v-a2a95590] { color: var(--color-error);\n}\n.viewer-content[data-v-a2a95590] {\n  overflow-y: auto;\n  padding: 1rem 1.25rem;\n  scrollbar-width: thin;\n  scrollbar-color: var(--color-border) transparent;\n}\n.viewer-content[data-v-a2a95590]::-webkit-scrollbar { width: 6px;\n}\n.viewer-content[data-v-a2a95590]::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 3px;\n}\n.no-changes[data-v-a2a95590] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.changes-list[data-v-a2a95590] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.change-item[data-v-a2a95590] {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1rem;\n  border-radius: 10px;\n  border-left: 4px solid;\n  background: var(--color-surface-light);\n  transition: all 0.2s ease;\n}\n.change-item[data-v-a2a95590]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n}\n.item-green[data-v-a2a95590] { border-color: var(--color-success);\n}\n.item-red[data-v-a2a95590] { border-color: var(--color-error);\n}\n.item-blue[data-v-a2a95590] { border-color: var(--color-info);\n}\n.item-gray[data-v-a2a95590] { border-color: var(--color-text-secondary);\n}\n.item-orange[data-v-a2a95590] { border-color: #ff9800;\n}\n.item-icon[data-v-a2a95590] {\n  flex-shrink: 0;\n  width: 2rem;\n  height: 2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  color: white;\n}\n.item-green .item-icon[data-v-a2a95590] { background: var(--color-success);\n}\n.item-red .item-icon[data-v-a2a95590] { background: var(--color-error);\n}\n.item-blue .item-icon[data-v-a2a95590] { background: var(--color-info);\n}\n.item-gray .item-icon[data-v-a2a95590] { background: var(--color-text-secondary);\n}\n.item-orange .item-icon[data-v-a2a95590] { background: #ff9800;\n}\n.item-content[data-v-a2a95590] { flex: 1;\n}\n.item-title[data-v-a2a95590] {\n  margin: 0 0 0.25rem 0;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.item-description[data-v-a2a95590] {\n  margin: 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n.item-details[data-v-a2a95590] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(0, 0, 0, 0.05);\n  border-radius: 6px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  font-family: 'Courier New', monospace;\n}\n.item-details p[data-v-a2a95590] {\n  margin: 0.25rem 0;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n",""]);const s=i},3509:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.character-section[data-v-6cf48088] {\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-header[data-v-6cf48088] {\n  margin-bottom: 1rem;\n}\n.section-title[data-v-6cf48088] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.info-grid[data-v-6cf48088] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n.info-item[data-v-6cf48088] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n}\n.info-label[data-v-6cf48088] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-6cf48088] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.data-detail[data-v-6cf48088] {\n  margin-top: 1rem;\n  border-top: 1px solid var(--color-border);\n  padding-top: 1rem;\n}\n.detail-title[data-v-6cf48088] {\n  margin: 0 0 1rem 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  border-bottom: 1px solid var(--color-border);\n  padding-bottom: 0.5rem;\n}\n.code-pre[data-v-6cf48088] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  max-height: 60vh;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.5;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n}\n.empty-state[data-v-6cf48088] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 3rem;\n  color: var(--color-text-secondary);\n}\n\n/* 手机端适配 */\n@media (max-width: 768px) {\n.code-pre[data-v-6cf48088] {\n    max-height: 50vh;\n    font-size: 0.8rem;\n    padding: 0.5rem;\n}\n.character-section[data-v-6cf48088] {\n    padding: 0.75rem;\n}\n.info-grid[data-v-6cf48088] {\n    grid-template-columns: 1fr;\n    gap: 0.75rem;\n}\n}\n@media (max-width: 480px) {\n.code-pre[data-v-6cf48088] {\n    max-height: 40vh;\n    font-size: 0.75rem;\n    padding: 0.4rem;\n}\n.character-section[data-v-6cf48088] {\n    padding: 0.5rem;\n}\n.empty-state[data-v-6cf48088] {\n    padding: 2rem;\n}\n}\n",""]);const s=i},3528:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},3567:(e,t,n)=>{"use strict";n.d(t,{A:()=>dn});var a=n(4061),r=n(5365),o=n(3528),i=n(6680),s=n(8133);const l=(0,n(9596).A)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var c=n(1783),d=n(6494),u=n(8684),m=n(100),p=n(7445),g=n(9173),h=n(5184),f=n(6585),v=n(8651),b=n(4270),y=n(876);const x={class:"api-management-panel"},k={class:"panel-header"},w={class:"header-left"},E={class:"header-info"},N={class:"panel-title"},S={class:"settings-subtitle"},V={class:"header-actions"},_={class:"btn-text"},C={class:"btn-text"},A={class:"btn-text"},D={class:"settings-container"},T={class:"settings-section"},B={class:"section-header"},I={class:"section-title"},z={class:"section-count"},M={class:"api-list"},P={class:"api-card-header"},R={class:"api-info"},$={class:"api-name"},O={key:0,class:"api-provider"},L={key:1,class:"api-provider tavern-tag"},F={class:"api-actions"},j=["title"],U=["checked","onChange"],q=["onClick","title"],G=["onClick","title"],H=["onClick","title","disabled"],Y={class:"api-card-body"},W={key:0,class:"tavern-api-hint"},X={class:"api-detail"},J={class:"detail-label"},K={class:"detail-value"},Z={class:"api-detail"},Q={class:"detail-label"},ee={class:"detail-value url"},te={class:"api-detail"},ne={class:"detail-label"},ae={key:0,class:"api-card-footer"},re={class:"assigned-label"},oe={class:"assigned-tags"},ie={class:"settings-section"},se={class:"section-header"},le={class:"section-title"},ce={class:"hint-icon"},de={key:0,class:"hint-content"},ue={key:1,class:"hint-content"},me={class:"settings-list"},pe={class:"setting-info"},ge={class:"setting-name"},he={key:0,class:"locked-badge"},fe={class:"setting-desc"},ve={class:"setting-control"},be={key:0,class:"locked-text"},ye=["value"],xe=["value"],ke={class:"setting-item"},we={class:"setting-info"},Ee={class:"setting-name"},Ne={class:"setting-desc"},Se={class:"setting-control"},Ve={class:"control-row"},_e={class:"inline-toggle"},Ce={class:"setting-switch compact"},Ae=["checked"],De=["value","disabled"],Te=["value"],Be={class:"setting-item"},Ie={class:"setting-info"},ze={class:"setting-name"},Me={class:"setting-desc"},Pe={class:"setting-control"},Re=["value"],$e=["value"],Oe={key:0,class:"auto-split-hint"},Le={class:"setting-info"},Fe={class:"setting-name"},je={key:0,class:"mode-indicator"},Ue={class:"setting-desc"},qe={class:"setting-control"},Ge={class:"control-row"},He={key:0,class:"inline-toggle"},Ye={class:"setting-switch compact"},We=["checked"],Xe=["value","onChange","disabled"],Je=["value"],Ke=["value","onChange"],Ze={class:"settings-section"},Qe={class:"section-header"},et={class:"section-title"},tt={class:"settings-list"},nt={class:"setting-item"},at={class:"setting-info"},rt={class:"setting-name"},ot={class:"setting-desc"},it={class:"setting-control"},st={class:"setting-switch"},lt={key:0,class:"setting-item"},ct={class:"setting-info"},dt={class:"setting-name"},ut={class:"setting-desc"},mt={class:"setting-control"},pt={key:1,class:"setting-item"},gt={class:"setting-info"},ht={class:"setting-name"},ft={class:"setting-desc"},vt={class:"setting-control"},bt={class:"setting-switch"},yt={key:2,class:"setting-item"},xt={class:"setting-info"},kt={class:"setting-name"},wt={class:"setting-desc"},Et={class:"setting-control"},Nt={value:"female"},St={value:"male"},Vt={value:"all"},_t={class:"modal-content"},Ct={class:"modal-header"},At={class:"modal-body"},Dt={class:"form-group"},Tt=["placeholder"],Bt={class:"form-group"},It={value:"custom"},zt={class:"form-group"},Mt=["placeholder"],Pt={class:"form-group"},Rt={class:"form-group"},$t={class:"model-select-wrapper"},Ot={class:"model-input-row"},Lt=["placeholder"],Ft=["disabled"],jt={key:0,class:"model-dropdown"},Ut=["onMousedown"],qt={class:"form-row"},Gt={class:"form-group half"},Ht={class:"form-group half"},Yt={class:"modal-footer"},Wt=(0,a.defineComponent)({__name:"APIManagementPanel",setup(e){const{t}=(0,y.s)(),n=(0,m.useAPIManagementStore)(),Wt=(0,g.useUIStore)();(0,a.onMounted)(async()=>{localStorage.getItem("access_token")?(await n.loadFromBackend(),tn(),nn(),rn()):b.o.info(t("请先登录"))});const Xt=(0,a.ref)(!0),Jt=(0,a.ref)(!1),Kt=(0,a.ref)(10),Zt=(0,a.ref)((0,v.isTavernEnv)()),Qt=(0,a.ref)(!0),en=(0,a.ref)("female"),tn=()=>{const e=p.aiService.getConfig();Xt.value=!1!==e.streaming},nn=()=>{const e=(0,f.rW)();Qt.value=e.nsfwMode,en.value=e.nsfwGenderFilter,Zt.value=(0,v.isTavernEnv)()},an=()=>{(e=>{const t=(()=>{try{const e=localStorage.getItem("dad_game_settings");if(!e)return{};const t=JSON.parse(e);return t&&"object"==typeof t&&!Array.isArray(t)?t:{}}catch{return{}}})();localStorage.setItem("dad_game_settings",JSON.stringify({...t,...e}))})({enableNsfwMode:Qt.value,nsfwGenderFilter:en.value})},rn=()=>{const e=h.vectorMemoryService.getConfig();Jt.value=e.enabled,Kt.value=e.maxRetrieveCount},on=()=>{h.vectorMemoryService.saveConfig({enabled:Jt.value,maxRetrieveCount:Kt.value}),Jt.value?b.o.success(`向量记忆检索已启用，每次最多检索 ${Kt.value} 条`):b.o.info("向量记忆检索已禁用，将使用全量发送模式")};(0,a.watch)(Xt,()=>{p.aiService.saveConfig({streaming:Xt.value}),Wt.useStreaming=Xt.value});const sn=(0,a.ref)(!1),ln=(0,a.ref)(!1),cn=(0,a.ref)({name:"",provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0}),dn=(0,a.ref)(null),un=(0,a.ref)(!1),mn=(0,a.ref)([]),pn=(0,a.ref)(!1),gn=(0,a.computed)(()=>{const e=cn.value.model?.toLowerCase()||"";return e?mn.value.filter(t=>t.toLowerCase().includes(e)):mn.value}),hn=()=>{pn.value=!0},fn=(0,a.ref)(null),vn=(0,a.ref)({}),bn=e=>Zt.value&&"default"===e.id?"🍺 酒馆API":e.name,yn=e=>p.o[e]?.url||"https://api.openai.com",xn=e=>p.o[e]?.defaultModel||"gpt-4o",kn=()=>{const e=p.o[cn.value.provider];e&&(cn.value.url=e.url,cn.value.model=e.defaultModel)},wn=e=>({main:"主游戏流程",memory_summary:"记忆总结",embedding:"向量检索(Embedding)",text_optimization:"文本优化",cot:"思维链",instruction_generation:"指令生成",world_generation:"世界生成",event_generation:"事件生成",sect_generation:"宗门生成"}[e]||e),En=e=>Zt.value?{main:"游戏主要交互（酒馆模式下永远使用酒馆API）",memory_summary:"压缩总结历史记忆，包括NPC记忆（可配置Raw/标准模式）",embedding:"向量记忆语义检索用Embedding（需要embedding模型，建议使用独立API）",text_optimization:"优化AI输出文本（可配置Raw/标准模式）",cot:"思维链推理（启用后可配置独立API）",instruction_generation:"将用户模糊指令转化为明确游戏指令（一次对话生成）",world_generation:"生成世界、地点等（可配置Raw/标准模式）",event_generation:"生成世界事件（可配置Raw/标准模式）",sect_generation:"生成宗门内容如藏经阁、贡献商店（可配置Raw/标准模式）"}[e]||"":{main:"游戏主要交互和剧情生成（核心API）",memory_summary:"压缩总结历史记忆，包括NPC记忆（可用快速模型节省成本）",embedding:"向量记忆语义检索用Embedding（需要embedding模型）",text_optimization:"优化AI输出的文本质量",cot:"思维链推理（启用后可配置独立API）",instruction_generation:"将用户模糊指令转化为明确游戏指令（一次对话生成）",world_generation:"生成世界、地点等内容（开局时使用）",event_generation:"生成世界事件（可用快速模型）",sect_generation:"生成宗门内容如藏经阁、贡献商店（可用快速模型）"}[e]||"",Nn=e=>n.apiAssignments.filter(t=>t.apiId===e).map(e=>e.type),Sn=e=>{const t=vn.value[e];return"success"===t?"success":"fail"===t?"fail":"unknown"},Vn=e=>{const n=vn.value[e];return t("success"===n?"连接正常":"fail"===n?"连接失败":"未测试")},_n=async()=>{if(!un.value)if(cn.value.url&&cn.value.apiKey){un.value=!0;try{const e=p.aiService.getConfig();p.aiService.saveConfig({mode:"custom",customAPI:{provider:cn.value.provider,url:cn.value.url,apiKey:cn.value.apiKey,model:cn.value.model||"gpt-4o",temperature:cn.value.temperature||.7,maxTokens:cn.value.maxTokens||16e3}});const n=await p.aiService.fetchModels();mn.value=n,b.o.success(`${t("获取到")} ${n.length} ${t("个模型")}`),p.aiService.saveConfig(e)}catch(e){b.o.error(t("获取模型列表失败"))}finally{un.value=!1}}else b.o.warning(t("请先填写API地址和密钥"))},Cn=()=>{if(cn.value.name){if(ln.value&&dn.value)n.updateAPI(dn.value,cn.value),b.o.success(t("API配置已更新"));else{const e={name:cn.value.name,provider:cn.value.provider,url:cn.value.url||yn(cn.value.provider),apiKey:cn.value.apiKey||"",model:cn.value.model||xn(cn.value.provider),temperature:cn.value.temperature||.7,maxTokens:cn.value.maxTokens||16e3,enabled:!0};n.addAPI(e),b.o.success(t("API配置已添加"))}Tn(),An()}else b.o.warning(t("请填写配置名称"))},An=()=>{const e=n.apiConfigs.find(e=>"default"===e.id);e&&p.aiService.saveConfig({mode:"custom",customAPI:{provider:e.provider,url:e.url,apiKey:e.apiKey,model:e.model,temperature:e.temperature,maxTokens:e.maxTokens}})},Dn=(e,a)=>{n.assignAPI(e,a),b.o.success(`${wn(e)} ${t("已分配到")} ${n.apiConfigs.find(e=>e.id===a)?.name||"API"}`)},Tn=()=>{sn.value=!1,ln.value=!1,dn.value=null,cn.value={name:"",provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3,enabled:!0},mn.value=[]},Bn=()=>{const e=n.exportConfig(),a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=`超凡新生-API配置-${(new Date).toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(r),b.o.success(t("API配置已导出"))},In=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const a=e.target.files?.[0];if(a)try{const e=await a.text(),r=JSON.parse(e);n.importConfig(r),An(),b.o.success(t("API配置已导入"))}catch(e){b.o.error(t("导入失败，请检查文件格式"))}},e.click()};return(e,m)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",x,[(0,a.createCommentVNode)(" 头部 "),(0,a.createElementVNode)("div",k,[(0,a.createElementVNode)("div",w,[m[17]||(m[17]=(0,a.createElementVNode)("div",{class:"header-icon"},"🔌",-1)),(0,a.createElementVNode)("div",E,[(0,a.createElementVNode)("h3",N,(0,a.toDisplayString)((0,a.unref)(t)("API管理")),1),(0,a.createElementVNode)("span",S,(0,a.toDisplayString)((0,a.unref)(t)("管理多个API配置和功能分配")),1)])]),(0,a.createElementVNode)("div",V,[(0,a.createElementVNode)("button",{class:"action-btn",onClick:In},[(0,a.createVNode)((0,a.unref)(r.A),{size:16}),(0,a.createElementVNode)("span",_,(0,a.toDisplayString)((0,a.unref)(t)("导入")),1)]),(0,a.createElementVNode)("button",{class:"action-btn",onClick:Bn},[(0,a.createVNode)((0,a.unref)(o.A),{size:16}),(0,a.createElementVNode)("span",C,(0,a.toDisplayString)((0,a.unref)(t)("导出")),1)]),(0,a.createElementVNode)("button",{class:"action-btn primary",onClick:m[0]||(m[0]=e=>sn.value=!0)},[(0,a.createVNode)((0,a.unref)(i.A),{size:16}),(0,a.createElementVNode)("span",A,(0,a.toDisplayString)((0,a.unref)(t)("新增API")),1)])])]),(0,a.createCommentVNode)(" 内容区域 "),(0,a.createElementVNode)("div",D,[(0,a.createCommentVNode)(" API列表区 "),(0,a.createElementVNode)("div",T,[(0,a.createElementVNode)("div",B,[(0,a.createElementVNode)("h4",I,"📡 "+(0,a.toDisplayString)((0,a.unref)(t)("API配置列表")),1),(0,a.createElementVNode)("span",z,(0,a.toDisplayString)((0,a.unref)(n).apiConfigs.length)+" "+(0,a.toDisplayString)((0,a.unref)(t)("个配置")),1)]),(0,a.createElementVNode)("div",M,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(n).apiConfigs,e=>{return(0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.id,class:(0,a.normalizeClass)(["api-card",{disabled:!e.enabled,default:"default"===e.id}])},[(0,a.createElementVNode)("div",P,[(0,a.createElementVNode)("div",R,[(0,a.createElementVNode)("span",$,(0,a.toDisplayString)(bn(e)),1),Zt.value&&"default"===e.id?((0,a.openBlock)(),(0,a.createElementBlock)("span",L,"🍺 酒馆配置")):((0,a.openBlock)(),(0,a.createElementBlock)("span",O,(0,a.toDisplayString)((r=e.provider,p.o[r]?.name||r)),1))]),(0,a.createElementVNode)("div",F,[(0,a.createElementVNode)("label",{class:"setting-switch",title:(0,a.unref)(t)("启用/禁用")},[(0,a.createElementVNode)("input",{type:"checkbox",checked:e.enabled,onChange:t=>{return a=e.id,void n.toggleAPI(a);var a}},null,40,U),m[18]||(m[18]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))],8,j),(0,a.createElementVNode)("button",{class:"icon-btn",onClick:n=>(async e=>{if(!fn.value){fn.value=e.id;try{const n=p.aiService.getConfig();p.aiService.saveConfig({mode:"custom",customAPI:{provider:e.provider,url:e.url,apiKey:e.apiKey,model:e.model,temperature:e.temperature,maxTokens:e.maxTokens}});const a="你正在进行API连通性测试。请仅输出：超凡新生本-连通测试-OK",r=await p.aiService.generate({user_input:a,should_stream:!1,generation_id:`api_test_${Date.now()}`}),o=r.toLowerCase().includes("超凡新生本")||r.toLowerCase().includes("ok");vn.value[e.id]=o?"success":"fail",o?b.o.success(`${e.name} ${t("连接成功")}`):b.o.warning(`${e.name} ${t("响应异常")}`),p.aiService.saveConfig(n)}catch(n){vn.value[e.id]="fail",b.o.error(`${e.name} ${t("连接失败")}: ${n instanceof Error?n.message:"未知错误"}`)}finally{fn.value=null}}})(e),title:(0,a.unref)(t)("测试连接")},[(0,a.createVNode)((0,a.unref)(s.A),{size:16,class:(0,a.normalizeClass)({"loading-pulse":fn.value===e.id})},null,8,["class"])],8,q),(0,a.createElementVNode)("button",{class:"icon-btn",onClick:t=>(e=>{cn.value={...e},dn.value=e.id,ln.value=!0})(e),title:(0,a.unref)(t)("编辑")},[(0,a.createVNode)((0,a.unref)(l),{size:16})],8,G),(0,a.createElementVNode)("button",{class:"icon-btn danger",onClick:a=>{var r;"default"!==(r=e.id)?Wt.showRetryDialog({title:t("确认删除"),message:t("确定要删除这个API配置吗？使用它的功能将自动回退到默认API。"),confirmText:t("删除"),cancelText:t("取消"),onConfirm:()=>{n.deleteAPI(r),b.o.success(t("API配置已删除"))},onCancel:()=>{}}):b.o.error(t("不能删除默认API配置"))},title:(0,a.unref)(t)("删除"),disabled:"default"===e.id},[(0,a.createVNode)((0,a.unref)(c.A),{size:16})],8,H)])]),(0,a.createElementVNode)("div",Y,[(0,a.createCommentVNode)(" 酒馆模式下默认API显示特殊提示 "),Zt.value&&"default"===e.id?((0,a.openBlock)(),(0,a.createElementBlock)("div",W,m[19]||(m[19]=[(0,a.createElementVNode)("span",{class:"hint-text"},"🍺 API配置由酒馆管理，此处无需配置",-1)]))):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createElementVNode)("div",X,[(0,a.createElementVNode)("span",J,(0,a.toDisplayString)((0,a.unref)(t)("模型"))+":",1),(0,a.createElementVNode)("span",K,(0,a.toDisplayString)(e.model),1)]),(0,a.createElementVNode)("div",Z,[(0,a.createElementVNode)("span",Q,(0,a.toDisplayString)((0,a.unref)(t)("地址"))+":",1),(0,a.createElementVNode)("span",ee,(0,a.toDisplayString)(e.url||(0,a.unref)(t)("默认")),1)]),(0,a.createElementVNode)("div",te,[(0,a.createElementVNode)("span",ne,(0,a.toDisplayString)((0,a.unref)(t)("状态"))+":",1),(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["detail-value",Sn(e.id)])},(0,a.toDisplayString)(Vn(e.id)),3)])],64))]),Nn(e.id).length>0?((0,a.openBlock)(),(0,a.createElementBlock)("div",ae,[(0,a.createElementVNode)("span",re,(0,a.toDisplayString)((0,a.unref)(t)("已分配功能"))+":",1),(0,a.createElementVNode)("div",oe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(Nn(e.id),e=>((0,a.openBlock)(),(0,a.createElementBlock)("span",{key:e,class:"function-tag"},(0,a.toDisplayString)(wn(e)),1))),128))])])):(0,a.createCommentVNode)("v-if",!0)],2);var r}),128))])]),(0,a.createCommentVNode)(" 功能分配区 "),(0,a.createElementVNode)("div",ie,[(0,a.createElementVNode)("div",se,[(0,a.createElementVNode)("h4",le,"⚙️ "+(0,a.toDisplayString)((0,a.unref)(t)("功能分配")),1),(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["mode-badge",Zt.value?"tavern":"web"])},(0,a.toDisplayString)(Zt.value?"酒馆模式":"网页模式"),3)]),(0,a.createCommentVNode)(" 模式说明 "),(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["mode-hint",Zt.value?"tavern":"web"])},[(0,a.createElementVNode)("div",ce,(0,a.toDisplayString)(Zt.value?"🍺":"🌐"),1),Zt.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",de,m[20]||(m[20]=[(0,a.createElementVNode)("strong",null,"酒馆模式：",-1),(0,a.createTextVNode)("主游戏流程（main）",-1),(0,a.createElementVNode)("em",null,"永远",-1),(0,a.createTextVNode)('使用酒馆配置的API。 辅助功能如需使用独立API，请在下方分配非"默认API"的配置。 ',-1),(0,a.createElementVNode)("br",null,null,-1),(0,a.createElementVNode)("span",{class:"hint-example"},"提示：未配置独立API的辅助功能也会走酒馆API，实现请求合并。",-1)]))):((0,a.openBlock)(),(0,a.createElementBlock)("div",ue,m[21]||(m[21]=[(0,a.createElementVNode)("strong",null,"网页模式：",-1),(0,a.createTextVNode)("所有功能都通过配置的自定义API调用。 可为不同功能分配不同的API，实现灵活调度。 ",-1),(0,a.createElementVNode)("br",null,null,-1),(0,a.createElementVNode)("span",{class:"hint-example"},"提示：配置了相同API的功能会自动合并请求，节省调用次数。",-1)])))],2),m[31]||(m[31]=(0,a.createElementVNode)("div",{class:"pipeline-hint"},[(0,a.createElementVNode)("div",{class:"hint-icon"},"💡"),(0,a.createElementVNode)("div",{class:"hint-content"},[(0,a.createElementVNode)("strong",null,"智能流水线："),(0,a.createTextVNode)('只有配置了独立API的功能才会触发额外调用。 如果所有功能都使用"默认API"，系统会合并请求以节省调用次数。 '),(0,a.createElementVNode)("br"),(0,a.createElementVNode)("span",{class:"hint-example"},"示例：CoT + Main 使用同一API = 1次调用 | CoT + Main 使用不同API = 2次调用")])],-1)),(0,a.createElementVNode)("div",me,[(0,a.createCommentVNode)(" ========== 主游戏流程（3个） ========== "),m[29]||(m[29]=(0,a.createElementVNode)("div",{class:"function-group-header"},[(0,a.createElementVNode)("h5",{class:"group-title"},"🎮 主游戏流程"),(0,a.createElementVNode)("span",{class:"group-desc"},"控制游戏主要生成流程的API分配")],-1)),(0,a.createCommentVNode)(" 1. 主游戏流程 "),(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["setting-item",{"tavern-locked":Zt.value&&(0,a.unref)(n).apiAssignments.find(e=>"main"===e.type)}])},[(0,a.createElementVNode)("div",pe,[(0,a.createElementVNode)("label",ge,[(0,a.createTextVNode)((0,a.toDisplayString)(wn("main"))+" ",1),Zt.value?((0,a.openBlock)(),(0,a.createElementBlock)("span",he,"🔒 酒馆API")):(0,a.createCommentVNode)("v-if",!0)]),(0,a.createElementVNode)("span",fe,(0,a.toDisplayString)(En("main")),1)]),(0,a.createElementVNode)("div",ve,[Zt.value?((0,a.openBlock)(),(0,a.createElementBlock)("span",be,"使用酒馆配置")):((0,a.openBlock)(),(0,a.createElementBlock)("select",{key:1,value:(0,a.unref)(n).apiAssignments.find(e=>"main"===e.type)?.apiId,onChange:m[1]||(m[1]=e=>Dn("main",e.target.value)),class:"setting-select"},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(n).enabledAPIs,e=>((0,a.openBlock)(),(0,a.createElementBlock)("option",{key:e.id,value:e.id},(0,a.toDisplayString)(bn(e)),9,xe))),128))],40,ye))])],2),(0,a.createCommentVNode)(" 2. 思维链（CoT）+ 启用系统CoT开关 "),(0,a.createElementVNode)("div",ke,[(0,a.createElementVNode)("div",we,[(0,a.createElementVNode)("label",Ee,(0,a.toDisplayString)(wn("cot")),1),(0,a.createElementVNode)("span",Ne,(0,a.toDisplayString)(En("cot")),1)]),(0,a.createElementVNode)("div",Se,[(0,a.createElementVNode)("div",Ve,[(0,a.createCommentVNode)(" 启用系统CoT开关 "),(0,a.createElementVNode)("div",_e,[m[23]||(m[23]=(0,a.createElementVNode)("label",{class:"toggle-label"},"启用",-1)),(0,a.createElementVNode)("label",Ce,[(0,a.createElementVNode)("input",{type:"checkbox",checked:(0,a.unref)(n).aiGenerationSettings.enableSystemCoT,onChange:m[2]||(m[2]=e=>(0,a.unref)(n).updateAIGenerationSettings({enableSystemCoT:e.target.checked}))},null,40,Ae),m[22]||(m[22]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])]),(0,a.createCommentVNode)(" API分配 "),(0,a.createElementVNode)("select",{value:(0,a.unref)(n).apiAssignments.find(e=>"cot"===e.type)?.apiId,onChange:m[3]||(m[3]=e=>Dn("cot",e.target.value)),class:"setting-select",disabled:!(0,a.unref)(n).aiGenerationSettings.enableSystemCoT},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(n).enabledAPIs,e=>((0,a.openBlock)(),(0,a.createElementBlock)("option",{key:e.id,value:e.id},(0,a.toDisplayString)(bn(e)),9,Te))),128))],40,De)])])]),(0,a.createCommentVNode)(" 3. 指令生成 "),(0,a.createElementVNode)("div",Be,[(0,a.createElementVNode)("div",Ie,[(0,a.createElementVNode)("label",ze,(0,a.toDisplayString)(wn("instruction_generation")),1),(0,a.createElementVNode)("span",Me,(0,a.toDisplayString)(En("instruction_generation")),1)]),(0,a.createElementVNode)("div",Pe,[(0,a.createElementVNode)("select",{value:(0,a.unref)(n).apiAssignments.find(e=>"instruction_generation"===e.type)?.apiId,onChange:m[4]||(m[4]=e=>Dn("instruction_generation",e.target.value)),class:"setting-select"},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(n).enabledAPIs,e=>((0,a.openBlock)(),(0,a.createElementBlock)("option",{key:e.id,value:e.id},(0,a.toDisplayString)(bn(e)),9,$e))),128))],40,Re)])]),(0,a.createCommentVNode)(" 自动分步生成提示 "),(0,a.unref)(n).shouldEnableSplitGeneration?((0,a.openBlock)(),(0,a.createElementBlock)("div",Oe,m[24]||(m[24]=[(0,a.createElementVNode)("div",{class:"hint-icon"},"⚡",-1),(0,a.createElementVNode)("div",{class:"hint-text"},[(0,a.createElementVNode)("strong",null,"自动分步生成已启用："),(0,a.createTextVNode)(" 检测到主游戏流程中有功能使用了独立API，系统将自动启用分步生成以优化性能。 ")],-1)]))):(0,a.createCommentVNode)("v-if",!0),(0,a.createCommentVNode)(" ========== 辅助功能（6个） ========== "),m[30]||(m[30]=(0,a.createElementVNode)("div",{class:"function-group-header"},[(0,a.createElementVNode)("h5",{class:"group-title"},"🛠️ 辅助功能"),(0,a.createElementVNode)("span",{class:"group-desc"},"可选的辅助生成功能，支持Raw/标准模式切换")],-1)),(0,a.createCommentVNode)(" 辅助功能列表 "),((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(["memory_summary","text_optimization","world_generation","event_generation","sect_generation","embedding"],e=>(0,a.createElementVNode)("div",{key:e,class:"setting-item"},[(0,a.createElementVNode)("div",Le,[(0,a.createElementVNode)("label",Fe,[(0,a.createTextVNode)((0,a.toDisplayString)(wn(e))+" ",1),"embedding"!==e?((0,a.openBlock)(),(0,a.createElementBlock)("span",je,(0,a.toDisplayString)("raw"===(0,a.unref)(n).getFunctionMode(e)?"Raw":"标准"),1)):(0,a.createCommentVNode)("v-if",!0)]),(0,a.createElementVNode)("span",Ue,(0,a.toDisplayString)(En(e)),1)]),(0,a.createElementVNode)("div",qe,[(0,a.createElementVNode)("div",Ge,[(0,a.createCommentVNode)(" embedding 功能的启用开关 "),"embedding"===e?((0,a.openBlock)(),(0,a.createElementBlock)("div",He,[m[26]||(m[26]=(0,a.createElementVNode)("label",{class:"toggle-label"},"启用",-1)),(0,a.createElementVNode)("label",Ye,[(0,a.createElementVNode)("input",{type:"checkbox",checked:Jt.value,onChange:on},null,40,We),m[25]||(m[25]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])):(0,a.createCommentVNode)("v-if",!0),(0,a.createCommentVNode)(" API分配下拉框 "),(0,a.createElementVNode)("select",{value:(0,a.unref)(n).apiAssignments.find(t=>t.type===e)?.apiId,onChange:t=>Dn(e,t.target.value),class:"setting-select",disabled:"embedding"===e&&!Jt.value},[m[27]||(m[27]=(0,a.createElementVNode)("option",{value:"default"},"使用主API",-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(n).enabledAPIs.filter(e=>"default"!==e.id),e=>((0,a.openBlock)(),(0,a.createElementBlock)("option",{key:e.id,value:e.id},(0,a.toDisplayString)(bn(e)),9,Je))),128))],40,Xe),(0,a.createCommentVNode)(" Raw/标准模式选择（仅非embedding功能且为酒馆模式时显示） "),"embedding"!==e&&Zt.value?((0,a.openBlock)(),(0,a.createElementBlock)("select",{key:1,value:(0,a.unref)(n).getFunctionMode(e),onChange:a=>{return r=e,o=a.target.value,n.setFunctionMode(r,o),void b.o.success(`${wn(r)} ${t("模式已设置为")} ${o}`);var r,o},class:"setting-select mode-select"},m[28]||(m[28]=[(0,a.createElementVNode)("option",{value:"raw"},"Raw",-1),(0,a.createElementVNode)("option",{value:"standard"},"标准",-1)]),40,Ke)):(0,a.createCommentVNode)("v-if",!0)])])])),64))])]),(0,a.createCommentVNode)(" AI生成设置 "),(0,a.createElementVNode)("div",Ze,[(0,a.createElementVNode)("div",Qe,[(0,a.createElementVNode)("h4",et,"🤖 "+(0,a.toDisplayString)((0,a.unref)(t)("AI生成设置")),1)]),(0,a.createElementVNode)("div",tt,[(0,a.createElementVNode)("div",nt,[(0,a.createElementVNode)("div",at,[(0,a.createElementVNode)("label",rt,(0,a.toDisplayString)((0,a.unref)(t)("流式输出")),1),(0,a.createElementVNode)("span",ot,(0,a.toDisplayString)((0,a.unref)(t)("开启后AI响应逐字显示")),1)]),(0,a.createElementVNode)("div",it,[(0,a.createElementVNode)("label",st,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":m[5]||(m[5]=e=>Xt.value=e)},null,512),[[a.vModelCheckbox,Xt.value]]),m[32]||(m[32]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])]),Jt.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",lt,[(0,a.createElementVNode)("div",ct,[(0,a.createElementVNode)("label",dt,(0,a.toDisplayString)((0,a.unref)(t)("检索数量")),1),(0,a.createElementVNode)("span",ut,(0,a.toDisplayString)((0,a.unref)(t)("每次检索的最大记忆条数")),1)]),(0,a.createElementVNode)("div",mt,[(0,a.withDirectives)((0,a.createElementVNode)("select",{"onUpdate:modelValue":m[6]||(m[6]=e=>Kt.value=e),onChange:on,class:"setting-select"},m[33]||(m[33]=[(0,a.createElementVNode)("option",{value:5},"5条",-1),(0,a.createElementVNode)("option",{value:10},"10条（推荐）",-1),(0,a.createElementVNode)("option",{value:15},"15条",-1),(0,a.createElementVNode)("option",{value:20},"20条",-1)]),544),[[a.vModelSelect,Kt.value,void 0,{number:!0}]])])])):(0,a.createCommentVNode)("v-if",!0),Zt.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",pt,[(0,a.createElementVNode)("div",gt,[(0,a.createElementVNode)("label",ht,(0,a.toDisplayString)((0,a.unref)(t)("🔞 成人内容模式")),1),(0,a.createElementVNode)("span",ft,(0,a.toDisplayString)((0,a.unref)(t)("启用后NPC可能产生成人向互动内容")),1)]),(0,a.createElementVNode)("div",vt,[(0,a.createElementVNode)("label",bt,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":m[7]||(m[7]=e=>Qt.value=e),onChange:an},null,544),[[a.vModelCheckbox,Qt.value]]),m[34]||(m[34]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])])):(0,a.createCommentVNode)("v-if",!0),Zt.value&&Qt.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",yt,[(0,a.createElementVNode)("div",xt,[(0,a.createElementVNode)("label",kt,(0,a.toDisplayString)((0,a.unref)(t)("🔞 性别偏好过滤")),1),(0,a.createElementVNode)("span",wt,(0,a.toDisplayString)((0,a.unref)(t)("过滤参与成人互动的NPC性别")),1)]),(0,a.createElementVNode)("div",Et,[(0,a.withDirectives)((0,a.createElementVNode)("select",{"onUpdate:modelValue":m[8]||(m[8]=e=>en.value=e),onChange:an,class:"setting-select"},[(0,a.createElementVNode)("option",Nt,(0,a.toDisplayString)((0,a.unref)(t)("仅女性")),1),(0,a.createElementVNode)("option",St,(0,a.toDisplayString)((0,a.unref)(t)("仅男性")),1),(0,a.createElementVNode)("option",Vt,(0,a.toDisplayString)((0,a.unref)(t)("不限性别")),1)],544),[[a.vModelSelect,en.value]])])])):(0,a.createCommentVNode)("v-if",!0)])])]),(0,a.createCommentVNode)(" 新增/编辑API弹窗 "),sn.value||ln.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:(0,a.withModifiers)(Tn,["self"])},[(0,a.createElementVNode)("div",_t,[(0,a.createElementVNode)("div",Ct,[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(ln.value?(0,a.unref)(t)("编辑API配置"):(0,a.unref)(t)("新增API配置")),1),(0,a.createElementVNode)("button",{class:"close-btn",onClick:Tn},[(0,a.createVNode)((0,a.unref)(d.A),{size:20})])]),(0,a.createElementVNode)("div",At,[(0,a.createElementVNode)("div",Dt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("配置名称")),1),(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[9]||(m[9]=e=>cn.value.name=e),class:"form-input",placeholder:(0,a.unref)(t)("例如：主力API")},null,8,Tt),[[a.vModelText,cn.value.name]])]),(0,a.createElementVNode)("div",Bt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("API提供商")),1),(0,a.withDirectives)((0,a.createElementVNode)("select",{"onUpdate:modelValue":m[10]||(m[10]=e=>cn.value.provider=e),class:"form-select",onChange:kn},[m[35]||(m[35]=(0,a.createElementVNode)("option",{value:"openai"},"OpenAI",-1)),m[36]||(m[36]=(0,a.createElementVNode)("option",{value:"claude"},"Claude",-1)),m[37]||(m[37]=(0,a.createElementVNode)("option",{value:"gemini"},"Gemini",-1)),m[38]||(m[38]=(0,a.createElementVNode)("option",{value:"deepseek"},"DeepSeek",-1)),(0,a.createElementVNode)("option",It,(0,a.toDisplayString)((0,a.unref)(t)("自定义(OpenAI兼容)")),1)],544),[[a.vModelSelect,cn.value.provider]])]),(0,a.createElementVNode)("div",zt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("API地址")),1),(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[11]||(m[11]=e=>cn.value.url=e),class:"form-input",placeholder:yn(cn.value.provider||"openai")},null,8,Mt),[[a.vModelText,cn.value.url]])]),(0,a.createElementVNode)("div",Pt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("API密钥")),1),(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[12]||(m[12]=e=>cn.value.apiKey=e),type:"password",class:"form-input",placeholder:"sk-..."},null,512),[[a.vModelText,cn.value.apiKey]])]),(0,a.createElementVNode)("div",Rt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("模型名称")),1),(0,a.createElementVNode)("div",$t,[(0,a.createElementVNode)("div",Ot,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[13]||(m[13]=e=>cn.value.model=e),class:"form-input",placeholder:xn(cn.value.provider||"openai"),onFocus:m[14]||(m[14]=e=>pn.value=!0),onInput:hn},null,40,Lt),[[a.vModelText,cn.value.model]]),(0,a.createElementVNode)("button",{class:"utility-btn",onClick:_n,disabled:un.value},[(0,a.createVNode)((0,a.unref)(u.A),{size:16,class:(0,a.normalizeClass)({"loading-pulse":un.value})},null,8,["class"])],8,Ft)]),pn.value&&gn.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)("div",jt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(gn.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e,class:(0,a.normalizeClass)(["model-dropdown-item",{active:cn.value.model===e}]),onMousedown:(0,a.withModifiers)(t=>(e=>{cn.value.model=e,pn.value=!1})(e),["prevent"])},(0,a.toDisplayString)(e),43,Ut))),128))])):(0,a.createCommentVNode)("v-if",!0)])]),(0,a.createElementVNode)("div",qt,[(0,a.createElementVNode)("div",Gt,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("温度参数")),1),(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[15]||(m[15]=e=>cn.value.temperature=e),type:"number",class:"form-input",min:"0",max:"2",step:"0.1"},null,512),[[a.vModelText,cn.value.temperature,void 0,{number:!0}]])]),(0,a.createElementVNode)("div",Ht,[(0,a.createElementVNode)("label",null,(0,a.toDisplayString)((0,a.unref)(t)("最大Token数")),1),(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":m[16]||(m[16]=e=>cn.value.maxTokens=e),type:"number",class:"form-input",min:"100",max:"128000"},null,512),[[a.vModelText,cn.value.maxTokens,void 0,{number:!0}]])])])]),(0,a.createElementVNode)("div",Yt,[(0,a.createElementVNode)("button",{class:"btn-cancel",onClick:Tn},(0,a.toDisplayString)((0,a.unref)(t)("取消")),1),(0,a.createElementVNode)("button",{class:"btn-confirm",onClick:Cn},(0,a.toDisplayString)((0,a.unref)(t)("保存")),1)])])])):(0,a.createCommentVNode)("v-if",!0)]))}});var Xt=n(5072),Jt=n.n(Xt),Kt=n(7825),Zt=n.n(Kt),Qt=n(7659),en=n.n(Qt),tn=n(5056),nn=n.n(tn),an=n(540),rn=n.n(an),on=n(1113),sn=n.n(on),ln=n(4763),cn={};cn.styleTagTransform=sn(),cn.setAttributes=nn(),cn.insert=en().bind(null,"head"),cn.domAPI=Zt(),cn.insertStyleElement=rn(),Jt()(ln.A,cn),ln.A&&ln.A.locals&&ln.A.locals;const dn=(0,n(6262).A)(Wt,[["__scopeId","data-v-2186d8d2"]])},3628:(e,t,n)=>{"use strict";var a=n(8648),r=n(1064),o=n(7176);e.exports=a?function(e){return a(e)}:r?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return r(e)}:o?function(e){return o(e)}:null},3830:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.body-stats-panel[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  animation: fade-in-7f6fd3e6 0.3s ease;\n}\n@keyframes fade-in-7f6fd3e6 {\nfrom { opacity: 0; transform: translateY(10px);\n}\nto { opacity: 1; transform: translateY(0);\n}\n}\n.privacy-notice[data-v-7f6fd3e6] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px dashed var(--color-primary);\n  border-radius: 8px;\n  color: var(--color-primary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  margin-bottom: 8px;\n}\n.empty-stats[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px;\n  color: var(--color-text-secondary);\n  text-align: center;\n  background: var(--color-surface-light);\n  border-radius: 12px;\n  border: 1px dashed var(--color-border);\n}\n.empty-icon[data-v-7f6fd3e6] {\n  margin-bottom: 12px;\n  opacity: 0.5;\n}\n\n/* 寿元样式 */\n.lifespan-section[data-v-7f6fd3e6] {\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.08) 0%, rgba(56, 189, 248, 0.05) 100%);\n  border: 1px solid rgba(34, 211, 238, 0.2);\n}\n.lifespan-display[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.lifespan-info[data-v-7f6fd3e6] {\n  display: flex;\n  align-items: baseline;\n  gap: 4px;\n  font-family: monospace;\n}\n.lifespan-current[data-v-7f6fd3e6] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: #22d3ee;\n}\n.lifespan-divider[data-v-7f6fd3e6] {\n  color: var(--color-text-secondary);\n  font-size: 1rem;\n}\n.lifespan-max[data-v-7f6fd3e6] {\n  font-size: 1.1rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.lifespan-unit[data-v-7f6fd3e6] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-left: 4px;\n}\n.lifespan-bar[data-v-7f6fd3e6] {\n  height: 8px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.lifespan-fill[data-v-7f6fd3e6] {\n  height: 100%;\n  background: linear-gradient(90deg, #22d3ee, #38bdf8);\n  border-radius: 4px;\n  transition: width 0.5s ease;\n}\n.lifespan-fill.warning[data-v-7f6fd3e6] {\n  background: linear-gradient(90deg, #fbbf24, #f59e0b);\n}\n.lifespan-fill.danger[data-v-7f6fd3e6] {\n  background: linear-gradient(90deg, #f87171, #ef4444);\n}\n.lifespan-hint[data-v-7f6fd3e6] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  text-align: right;\n}\n.sub-text[data-v-7f6fd3e6] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n  margin-top: 4px;\n}\n.section-title[data-v-7f6fd3e6] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 16px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid var(--color-border);\n}\n.title-icon[data-v-7f6fd3e6] {\n  color: var(--color-primary);\n}\n.stats-grid[data-v-7f6fd3e6] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n  gap: 12px;\n  margin-bottom: 16px;\n}\n.stat-card[data-v-7f6fd3e6] {\n  background: var(--color-surface);\n  padding: 12px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 4px;\n}\n.label[data-v-7f6fd3e6] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.value[data-v-7f6fd3e6] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.unit[data-v-7f6fd3e6] {\n  font-size: 0.8rem;\n  font-weight: normal;\n  color: var(--color-text-secondary);\n}\n.tags-container[data-v-7f6fd3e6] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.feature-tag[data-v-7f6fd3e6] {\n  padding: 4px 10px;\n  background: var(--color-surface-hover);\n  border-radius: 12px;\n  font-size: 0.85rem;\n  color: var(--color-text);\n}\n.measurements-display[data-v-7f6fd3e6] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  margin-bottom: 16px;\n  padding: 20px;\n  background: var(--color-surface);\n  border-radius: 12px;\n}\n.measurement-item[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.measure-circle[data-v-7f6fd3e6] {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  border: 2px solid var(--color-accent);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-accent-rgb), 0.05);\n}\n.measure-val[data-v-7f6fd3e6] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-accent);\n}\n.measure-label[data-v-7f6fd3e6] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.measurement-divider[data-v-7f6fd3e6] {\n  font-size: 1.5rem;\n  color: var(--color-border);\n  font-weight: 300;\n}\n.cup-display[data-v-7f6fd3e6] {\n  text-align: center;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.cup-value[data-v-7f6fd3e6] {\n  font-weight: 700;\n  color: var(--color-accent);\n  margin-left: 4px;\n}\n.description-list[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.desc-item[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.desc-label[data-v-7f6fd3e6] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.desc-content[data-v-7f6fd3e6] {\n  margin: 0;\n  padding: 12px;\n  background: var(--color-surface);\n  border-radius: 8px;\n  font-size: 0.9rem;\n  line-height: 1.5;\n  color: var(--color-text);\n}\n.sensitive-points[data-v-7f6fd3e6] {\n  margin-bottom: 16px;\n}\n.sub-title[data-v-7f6fd3e6] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  margin-bottom: 8px;\n}\n.points-list[data-v-7f6fd3e6] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.point-tag[data-v-7f6fd3e6] {\n  padding: 4px 10px;\n  background: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n  border: 1px solid rgba(var(--color-danger-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.85rem;\n}\n.development-list[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.dev-item[data-v-7f6fd3e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.dev-header[data-v-7f6fd3e6] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.85rem;\n}\n.dev-bar[data-v-7f6fd3e6] {\n  height: 8px;\n  background: var(--color-border);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.dev-fill[data-v-7f6fd3e6] {\n  height: 100%;\n  background: linear-gradient(90deg, #f472b6, #ec4899);\n  border-radius: 4px;\n}\n.markings-list[data-v-7f6fd3e6] {\n  list-style: disc;\n  padding-left: 20px;\n  margin: 0;\n  color: var(--color-text);\n}\n.marking-item[data-v-7f6fd3e6] {\n  margin-bottom: 4px;\n}\n",""]);const s=i},3879:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-panel[data-v-de19f802] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n.panel-content[data-v-de19f802] {\n  flex: 1;\n  overflow: hidden;\n}\n.sect-container[data-v-de19f802] {\n  height: 100%;\n  display: flex;\n  background: var(--color-surface);\n  overflow: hidden;\n}\n.sect-list[data-v-de19f802] {\n  width: 280px; /* 窄一点 */\n  border-right: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n}\n.list-header[data-v-de19f802] {\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.panel-title[data-v-de19f802] {\n  margin: 0 0 1rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-primary);\n  text-align: center;\n}\n.search-bar[data-v-de19f802] {\n  position: relative;\n  display: flex;\n  align-items: center;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.5rem;\n}\n.search-bar svg[data-v-de19f802] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.search-input[data-v-de19f802] {\n  flex: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.list-content[data-v-de19f802] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n.loading-state[data-v-de19f802], .empty-state[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-de19f802] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.empty-text[data-v-de19f802] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-de19f802] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.empty-actions[data-v-de19f802] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n.empty-action-btn[data-v-de19f802] {\n  padding: 0.4rem 0.75rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  font-size: 0.85rem;\n}\n.empty-action-btn[data-v-de19f802]:hover {\n  transform: translateY(-1px);\n  border-color: var(--color-primary);\n}\n.empty-action-btn.primary[data-v-de19f802] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: #fff;\n}\n.empty-action-btn.primary[data-v-de19f802]:hover {\n  filter: brightness(1.05);\n}\n.empty-prompt-hint[data-v-de19f802] {\n  margin-top: 0.75rem;\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.empty-prompt-hint code[data-v-de19f802] {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  padding: 0.1rem 0.35rem;\n  border-radius: 6px;\n  background: rgba(99, 102, 241, 0.12);\n  border: 1px solid rgba(99, 102, 241, 0.2);\n}\n.sect-list-content[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.sect-card[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.sect-card[data-v-de19f802]:hover {\n  border-color: #9333ea;\n  box-shadow: 0 2px 8px rgba(147, 51, 234, 0.1);\n  transform: translateY(-1px);\n}\n.sect-card.selected[data-v-de19f802] {\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.1));\n  border-color: #9333ea;\n  box-shadow: 0 4px 12px rgba(147, 51, 234, 0.15);\n}\n.sect-card.can-join[data-v-de19f802] {\n  border-left: 3px solid #22c55e;\n}\n.sect-icon[data-v-de19f802] {\n  position: relative;\n  margin-right: 0.75rem;\n  flex-shrink: 0;\n}\n.sect-emoji[data-v-de19f802] {\n  font-size: 2rem;\n  display: block;\n}\n.sect-level[data-v-de19f802] {\n  position: absolute;\n  bottom: -2px;\n  right: -2px;\n  padding: 1px 4px;\n  border-radius: 8px;\n  font-size: 0.6rem;\n  font-weight: 700;\n  color: white;\n}\n.level-一流[data-v-de19f802] { background: #ef4444;\n}\n.level-二流[data-v-de19f802] { background: #f59e0b;\n}\n.level-三流[data-v-de19f802] { background: #3b82f6;\n}\n.level-末流[data-v-de19f802] { background: #6b7280;\n}\n.sect-info[data-v-de19f802] {\n  flex: 1;\n  min-width: 0;\n}\n.sect-name[data-v-de19f802] {\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.25rem;\n  font-size: 1rem;\n}\n.sect-meta[data-v-de19f802] {\n  margin-bottom: 0.5rem;\n}\n.sect-type[data-v-de19f802] {\n  background: rgba(147, 51, 234, 0.1);\n  color: #9333ea;\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.sect-stats[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.member-count[data-v-de19f802] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-weight: 500;\n}\n\\n/* .power-rating removed */\\n.arrow-icon[data-v-de19f802] {\n  color: var(--color-border-hover);\n  transition: transform 0.2s;\n}\n.sect-card.selected .arrow-icon[data-v-de19f802] {\n  transform: rotate(90deg);\n  color: #9333ea;\n}\n.sect-detail[data-v-de19f802] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n.detail-content[data-v-de19f802] {\n  height: 100%;\n  padding: 1rem;\n  overflow-y: auto;\n}\n.detail-header[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 2rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.detail-icon[data-v-de19f802] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #9333ea, #7c3aed);\n  flex-shrink: 0;\n  box-shadow: 0 4px 16px rgba(147, 51, 234, 0.3);\n}\n.sect-emoji-large[data-v-de19f802] {\n  font-size: 2rem;\n}\n.detail-info[data-v-de19f802] {\n  flex: 1;\n}\n.detail-name[data-v-de19f802] {\n  margin: 0 0 0.5rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.detail-badges[data-v-de19f802] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.type-badge[data-v-de19f802], .level-badge[data-v-de19f802] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.type-badge.type-righteous[data-v-de19f802] { background: rgba(59, 130, 246, 0.1); color: #3b82f6;\n}\n.type-badge.type-demonic[data-v-de19f802] { background: rgba(239, 68, 68, 0.1); color: #ef4444;\n}\n.type-badge.type-neutral[data-v-de19f802] { background: rgba(107, 114, 128, 0.1); color: #6b7280;\n}\n.type-badge.type-merchant[data-v-de19f802] { background: rgba(245, 158, 11, 0.1); color: #f59e0b;\n}\n.type-badge.type-family[data-v-de19f802] { background: rgba(34, 197, 94, 0.1); color: #22c55e;\n}\n.type-badge.type-alliance[data-v-de19f802] { background: rgba(168, 85, 247, 0.1); color: #a855f7;\n}\n.level-badge[data-v-de19f802] { background: rgba(168, 85, 247, 0.1); color: #a855f7;\n}\n.detail-body[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.detail-section[data-v-de19f802] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-title[data-v-de19f802] {\n  margin: 0 0 1rem 0;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;            /* 图标与标题同一行 */\n  align-items: center;      /* 垂直居中对齐 */\n  gap: 8px;                 /* 图标与文字间距 */\n}\n.section-title svg[data-v-de19f802] {\n  flex-shrink: 0;           /* 防止图标被压缩换行 */\n}\n.info-grid[data-v-de19f802] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n.info-item[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.info-label[data-v-de19f802] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.sect-description[data-v-de19f802] {\n  margin-top: 1rem;\n}\n.desc-title[data-v-de19f802] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.desc-text[data-v-de19f802] {\n  margin: 0;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n.sect-specialties[data-v-de19f802] {\n  margin-top: 1rem;\n}\n.specialties-title[data-v-de19f802] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.specialties-tags[data-v-de19f802] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.specialty-tag[data-v-de19f802] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(147, 51, 234, 0.1));\n  color: #9333ea;\n  padding: 0.25rem 0.75rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.member-overview[data-v-de19f802] {\n  text-align: center;\n  margin-bottom: 1.5rem;\n}\n.total-members[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.25rem;\n}\n.total-number[data-v-de19f802] {\n  font-size: 2rem;\n  font-weight: 700;\n  color: #9333ea;\n}\n.total-label[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.member-breakdown[data-v-de19f802] {\n  margin-bottom: 1.5rem;\n}\n.breakdown-title[data-v-de19f802] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.realm-stats[data-v-de19f802], .position-stats[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.realm-stat[data-v-de19f802], .position-stat[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.realm-name[data-v-de19f802], .position-name[data-v-de19f802] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  min-width: 60px;\n}\n.realm-bar[data-v-de19f802], .position-bar[data-v-de19f802] {\n  flex: 1;\n  height: 6px;\n  background: var(--color-border);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.realm-fill[data-v-de19f802] {\n  height: 100%;\n  background: linear-gradient(90deg, #9333ea, #7c3aed);\n  transition: width 0.3s ease;\n}\n.position-fill[data-v-de19f802] {\n  height: 100%;\n  background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n  transition: width 0.3s ease;\n}\n.realm-count[data-v-de19f802], .position-count[data-v-de19f802] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--color-text);\n  min-width: 30px;\n  text-align: right;\n}\n.relationship-info[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.relationship-item[data-v-de19f802] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.relationship-label[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.relationship-value[data-v-de19f802] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.reputation-value[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.reputation-level[data-v-de19f802] {\n  font-size: 0.75rem;\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.reputation-legendary[data-v-de19f802] {\n  color: #f59e0b;\n}\n.reputation-legendary .reputation-level[data-v-de19f802] {\n  background: rgba(245, 158, 11, 0.1);\n  color: #f59e0b;\n  border: 1px solid rgba(245, 158, 11, 0.2);\n}\n.reputation-excellent[data-v-de19f802] {\n  color: #8b5cf6;\n}\n.reputation-excellent .reputation-level[data-v-de19f802] {\n  background: rgba(139, 92, 246, 0.1);\n  color: #8b5cf6;\n  border: 1px solid rgba(139, 92, 246, 0.2);\n}\n.reputation-good[data-v-de19f802] {\n  color: #3b82f6;\n}\n.reputation-good .reputation-level[data-v-de19f802] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.reputation-fair[data-v-de19f802] {\n  color: #22c55e;\n}\n.reputation-fair .reputation-level[data-v-de19f802] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n  border: 1px solid rgba(34, 197, 94, 0.2);\n}\n.reputation-low[data-v-de19f802] {\n  color: #6b7280;\n}\n.reputation-low .reputation-level[data-v-de19f802] {\n  background: rgba(107, 114, 128, 0.1);\n  color: #6b7280;\n  border: 1px solid rgba(107, 114, 128, 0.2);\n}\n.reputation-none[data-v-de19f802] {\n  color: var(--color-text-secondary);\n}\n.reputation-none .reputation-level[data-v-de19f802] {\n  background: rgba(var(--color-text-secondary-rgb), 0.1);\n  color: var(--color-text-secondary);\n  border: 1px solid rgba(var(--color-text-secondary-rgb), 0.2);\n}\n.join-requirements[data-v-de19f802] {\n  margin-bottom: 1rem;\n}\n.requirements-list[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.requirement-item[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.requirement-icon[data-v-de19f802] {\n  color: #22c55e;\n}\n.requirement-text[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.no-requirements[data-v-de19f802] {\n  text-align: center;\n  padding: 1rem;\n  color: var(--color-text-secondary);\n}\n.join-benefits[data-v-de19f802] {\n  margin-bottom: 1rem;\n}\n.benefits-title[data-v-de19f802] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.benefits-list[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.benefit-item[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.benefit-icon[data-v-de19f802] {\n  color: #3b82f6;\n}\n.benefit-text[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.join-actions[data-v-de19f802] {\n  text-align: center;\n}\n.join-btn[data-v-de19f802] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  border: none;\n  border-radius: 8px;\n  color: white;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.join-btn[data-v-de19f802]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);\n}\n.current-member-info[data-v-de19f802] {\n  margin-bottom: 1.5rem;\n}\n.member-status[data-v-de19f802] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.member-actions[data-v-de19f802] {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 0.75rem;\n}\n.leave-btn[data-v-de19f802] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.leave-btn[data-v-de19f802]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);\n}\n.status-item[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.status-label[data-v-de19f802] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.status-value[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.status-value.position[data-v-de19f802] {\n  color: #9333ea;\n}\n.status-value.contribution[data-v-de19f802] {\n  color: #f59e0b;\n}\n.status-value.reputation[data-v-de19f802] {\n  color: #3b82f6;\n}\n.sect-actions[data-v-de19f802] {\n  margin-top: 1rem;\n}\n.actions-title[data-v-de19f802] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.action-buttons[data-v-de19f802] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.5rem;\n}\n.sect-action-btn[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: center;\n  min-width: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.sect-action-btn[data-v-de19f802]:hover {\n  border-color: #9333ea;\n  background: rgba(147, 51, 234, 0.05);\n}\n.no-selection[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.placeholder-icon[data-v-de19f802] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.placeholder-text[data-v-de19f802] {\n  font-size: 1rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.placeholder-hint[data-v-de19f802] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n\n/* 势力范围相关样式 */\n.territory-info[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* 成员统计样式 */\n.member-stats[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.total-members[data-v-de19f802] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n}\n.total-label[data-v-de19f802] {\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.total-value[data-v-de19f802] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n}\n.distribution-title[data-v-de19f802] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.realm-stats[data-v-de19f802], .position-stats[data-v-de19f802] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));\n  gap: 0.5rem;\n  max-height: none; /* 允许完整显示 */\n}\n.realm-item[data-v-de19f802], .position-item[data-v-de19f802] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.realm-item[data-v-de19f802]:hover, .position-item[data-v-de19f802]:hover {\n  background: var(--color-surface);\n  border-color: rgba(var(--color-primary-rgb), 0.2);\n}\n.realm-name[data-v-de19f802], .position-name[data-v-de19f802] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.realm-count[data-v-de19f802], .position-count[data-v-de19f802] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n\n/* 宗门领导层样式 */\n.leadership-info[data-v-de19f802] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n}\n.leadership-title[data-v-de19f802] {\n  margin: 0 0 1rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.leader-grid[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n.leader-item[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.leader-item.primary-leader[data-v-de19f802] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.leader-role[data-v-de19f802] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  min-width: 3rem;\n  text-align: center;\n}\n.leader-name[data-v-de19f802] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.leader-realm[data-v-de19f802] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  background: rgba(var(--color-accent-rgb), 0.1);\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n  margin-left: auto;\n}\n.sect-strength[data-v-de19f802] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: rgba(var(--color-success-rgb), 0.05);\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-success-rgb), 0.1);\n}\n.strength-item[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.25rem;\n}\n.strength-label[data-v-de19f802] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.strength-value[data-v-de19f802] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.strength-value.peak-power[data-v-de19f802] {\n  color: var(--color-accent);\n  text-shadow: 0 0 4px rgba(var(--color-accent-rgb), 0.3);\n}\n.strength-value.power-rating[data-v-de19f802] {\n  color: var(--color-primary);\n  font-weight: 700;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.power-level[data-v-de19f802] {\n  font-size: 0.75rem;\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.power-legendary[data-v-de19f802] {\n  color: #dc2626 !important;\n  border-color: rgba(220, 38, 38, 0.3) !important;\n  background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(239, 68, 68, 0.05)) !important;\n}\n.power-legendary .power-level[data-v-de19f802] {\n  background: rgba(220, 38, 38, 0.1);\n  color: #dc2626;\n  border: 1px solid rgba(220, 38, 38, 0.2);\n}\n.power-supreme[data-v-de19f802] {\n  color: #7c3aed !important;\n  border-color: rgba(124, 58, 237, 0.3) !important;\n  background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(139, 92, 246, 0.05)) !important;\n}\n.power-supreme .power-level[data-v-de19f802] {\n  background: rgba(124, 58, 237, 0.1);\n  color: #7c3aed;\n  border: 1px solid rgba(124, 58, 237, 0.2);\n}\n.power-strong[data-v-de19f802] {\n  color: #2563eb !important;\n  border-color: rgba(37, 99, 235, 0.3) !important;\n  background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.05)) !important;\n}\n.power-strong .power-level[data-v-de19f802] {\n  background: rgba(37, 99, 235, 0.1);\n  color: #2563eb;\n  border: 1px solid rgba(37, 99, 235, 0.2);\n}\n.power-good[data-v-de19f802] {\n  color: #059669 !important;\n  border-color: rgba(5, 150, 105, 0.3) !important;\n  background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.05)) !important;\n}\n.power-good .power-level[data-v-de19f802] {\n  background: rgba(5, 150, 105, 0.1);\n  color: #059669;\n  border: 1px solid rgba(5, 150, 105, 0.2);\n}\n.power-average[data-v-de19f802] {\n  color: #d97706 !important;\n  border-color: rgba(217, 119, 6, 0.3) !important;\n  background: linear-gradient(135deg, rgba(217, 119, 6, 0.1), rgba(245, 158, 11, 0.05)) !important;\n}\n.power-average .power-level[data-v-de19f802] {\n  background: rgba(217, 119, 6, 0.1);\n  color: #d97706;\n  border: 1px solid rgba(217, 119, 6, 0.2);\n}\n.power-weak[data-v-de19f802] {\n  color: #6b7280 !important;\n  border-color: rgba(107, 114, 128, 0.3) !important;\n  background: linear-gradient(135deg, rgba(107, 114, 128, 0.1), rgba(156, 163, 175, 0.05)) !important;\n}\n.power-weak .power-level[data-v-de19f802] {\n  background: rgba(107, 114, 128, 0.1);\n  color: #6b7280;\n  border: 1px solid rgba(107, 114, 128, 0.2);\n}\n.power-poor[data-v-de19f802] {\n  color: var(--color-text-secondary) !important;\n  border-color: rgba(var(--color-text-secondary-rgb), 0.3) !important;\n  background: linear-gradient(135deg, rgba(var(--color-text-secondary-rgb), 0.1), rgba(var(--color-text-secondary-rgb), 0.05)) !important;\n}\n.power-poor .power-level[data-v-de19f802] {\n  background: rgba(var(--color-text-secondary-rgb), 0.1);\n  color: var(--color-text-secondary);\n  border: 1px solid rgba(var(--color-text-secondary-rgb), 0.2);\n}\n.influence-description[data-v-de19f802] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  line-height: 1.5;\n}\n.controlled-areas[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.areas-list[data-v-de19f802] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.area-tag[data-v-de19f802] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));\n  color: #3b82f6;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.strategic-value[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.value-display[data-v-de19f802] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.value-bar[data-v-de19f802] {\n  flex: 1;\n  height: 8px;\n  background: var(--color-border);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.value-fill[data-v-de19f802] {\n  height: 100%;\n  background: linear-gradient(90deg, #22c55e, #16a34a);\n  transition: width 0.3s ease;\n}\n.value-text[data-v-de19f802] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--color-text);\n  min-width: 40px;\n}\n\n/* 回退显示样式 */\n.fallback-leadership[data-v-de19f802] {\n  padding: 1rem;\n  background: rgba(var(--color-warning-rgb), 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.1);\n}\n.leadership-description[data-v-de19f802] {\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n\n/* 数据缺失提示样式 */\n.missing-data-notice[data-v-de19f802] {\n  background: rgba(var(--color-warning-rgb), 0.05);\n  border: 1px solid rgba(var(--color-warning-rgb), 0.2);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-top: 1rem;\n}\n.notice-title[data-v-de19f802] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-warning);\n}\n.notice-content[data-v-de19f802] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.notice-text[data-v-de19f802] {\n  margin: 0;\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.notice-hint[data-v-de19f802] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-tertiary);\n  opacity: 0.8;\n}\n.animate-spin[data-v-de19f802] {\n  animation: spin-de19f802 1s linear infinite;\n}\n@keyframes spin-de19f802 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n@media (max-width: 640px) {\n.sect-panel[data-v-de19f802] {\n    padding: 0;\n}\n.panel-content[data-v-de19f802] {\n    padding: 0;\n}\n.sect-container[data-v-de19f802] {\n    flex-direction: column;\n    border-radius: 0;\n    border: none;\n}\n.sect-list[data-v-de19f802] {\n    width: 100%;\n    height: 30vh;\n    min-height: 250px;\n    max-height: 350px;\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n}\n.list-header[data-v-de19f802] {\n    padding: 1rem;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    background: var(--color-surface);\n}\n.panel-title[data-v-de19f802] {\n    font-size: 1.1rem;\n    margin-bottom: 0.75rem;\n}\n.search-bar[data-v-de19f802] {\n    padding: 0.5rem;\n}\n.search-input[data-v-de19f802] {\n    font-size: 0.9rem;\n}\n.list-content[data-v-de19f802] {\n    padding: 0.5rem;\n}\n.sect-card[data-v-de19f802] {\n    padding: 0.75rem;\n    margin-bottom: 0.5rem;\n}\n.sect-name[data-v-de19f802] {\n    font-size: 0.95rem;\n}\n.sect-type[data-v-de19f802] {\n    font-size: 0.7rem;\n    padding: 1px 6px;\n}\n\n  /* .power-rating removed */\n.sect-detail[data-v-de19f802] {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n}\n.detail-content[data-v-de19f802] {\n    padding: 0.75rem;\n    height: auto;\n}\n.detail-header[data-v-de19f802] {\n    margin-bottom: 1rem;\n    padding-bottom: 0.5rem;\n}\n.detail-icon[data-v-de19f802] {\n    width: 40px;\n    height: 40px;\n}\n.sect-emoji-large[data-v-de19f802] {\n    font-size: 1.25rem;\n}\n.detail-name[data-v-de19f802] {\n    font-size: 1rem;\n}\n.info-grid[data-v-de19f802] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.member-status[data-v-de19f802] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.action-buttons[data-v-de19f802] {\n    grid-template-columns: repeat(2, 1fr);\n    gap: 0.4rem;\n}\n.sect-action-btn[data-v-de19f802] {\n    padding: 0.6rem 0.4rem;\n    font-size: 0.75rem;\n    justify-content: center;\n    white-space: normal; /* 允许文本换行 */\n    height: 100%; /* 确保按钮在换行后高度一致 */\n}\n.detail-section[data-v-de19f802] {\n    padding: 0.6rem;\n    margin-bottom: 0.75rem;\n}\n.section-title[data-v-de19f802] {\n    font-size: 0.8rem;\n    margin-bottom: 0.5rem;\n    padding-bottom: 0.4rem;\n}\n.realm-stats[data-v-de19f802], .position-stats[data-v-de19f802] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.leader-grid[data-v-de19f802] {\n    gap: 0.5rem;\n}\n.leader-item[data-v-de19f802] {\n    padding: 0.5rem;\n}\n.leader-role[data-v-de19f802] {\n    font-size: 0.7rem;\n    padding: 0.2rem 0.4rem;\n    min-width: 2.5rem;\n}\n.leader-name[data-v-de19f802] {\n    font-size: 0.8rem;\n}\n.leader-realm[data-v-de19f802] {\n    font-size: 0.7rem;\n}\n}\n",""]);const s=i},3943:(e,t,n)=>{"use strict";n.d(t,{E0:()=>l,QS:()=>o,UZ:()=>d,wG:()=>u});var a=n(2224);function r(e){const t=e.分钟??0;return 365*e.年*24*60+30*e.月*24*60+24*e.日*60+60*e.小时+t}function o(e){if(e<=0)return"已过期";if(e>=99999)return"永久";const t=Math.floor(e/525600),n=Math.floor(e%525600/43200),a=Math.floor(e%43200/1440),r=Math.floor(e%1440/60),o=e%60,i=[];return t>0&&i.push(`${t}年`),n>0&&i.push(`${n}月`),a>0&&i.push(`${a}天`),r>0&&i.push(`${r}小时`),o>0&&i.push(`${o}分钟`),i.length>0?i.join(""):"不足1分钟"}function i(e){if(!e||"string"!=typeof e)return 0;let t=0;const n=e.match(/(\d+)年/);n&&(t+=365*parseInt(n[1])*24*60);const a=e.match(/(\d+)月/);a&&(t+=30*parseInt(a[1])*24*60);const r=e.match(/(\d+)天/);r&&(t+=24*parseInt(r[1])*60);const o=e.match(/(\d+)小时/);o&&(t+=60*parseInt(o[1]));const i=e.match(/(\d+)分钟/);return i&&(t+=parseInt(i[1])),t}function s(e,t){if(e.生成时间&&"number"==typeof e.持续时间分钟){if(e.持续时间分钟<0||e.持续时间分钟>=99999)return!1;const n=r(e.生成时间);return r(t)-n>=e.持续时间分钟}return!(!e.时间||!e.剩余时间)&&i(e.剩余时间)<=0}function l(e,t){if(e.生成时间&&"number"==typeof e.持续时间分钟){if(e.持续时间分钟<0||e.持续时间分钟>=99999)return 99999;const n=r(e.生成时间),a=r(t)-n,o=e.持续时间分钟-a;return Math.max(0,o)}return 60}function c(e,t){try{if(!e||"object"!=typeof e)return console.warn("[状态效果] 无效的状态效果数据:",e),null;if(e.生成时间&&"number"==typeof e.持续时间分钟)return e;const n={状态名称:e.状态名称||e.name||"未知状态",类型:e.类型||e.type||"buff",生成时间:{年:t.年,月:t.月,日:t.日,小时:t.小时||0,分钟:t.分钟??0},持续时间分钟:0,状态描述:e.状态描述||e.description||"无描述",强度:e.强度||e.intensity,来源:e.来源||e.source};return e.剩余时间?n.持续时间分钟=i(e.剩余时间):e.duration?n.持续时间分钟=i(e.duration):n.持续时间分钟=60,n}catch(e){return console.error("[状态效果] 规范化状态效果失败:",e),null}}function d(e){const t=[];try{const n=(0,a.get)(e,"角色.效果",(0,a.get)(e,"效果",[]));if(!Array.isArray(n)||0===n.length)return{removedEffects:t};const r=e.元数据?.时间??e.时间;if(!r)return console.warn("[状态效果] 时间不存在，无法更新状态效果"),{removedEffects:t};const o=[];for(const e of n){if(!e||"object"!=typeof e){console.warn("[状态效果] 跳过无效的状态效果:",e);continue}const n=c(e,r);n?s(n,r)?(console.log(`[状态效果] 状态效果"${n.状态名称}"已过期，将被移除`),t.push(n.状态名称)):o.push(n):console.warn("[状态效果] 跳过无法规范化的状态效果:",e)}return t.length>0&&(e.角色||(e.角色={}),(0,a.set)(e,"角色.效果",o)),{removedEffects:t}}catch(e){return console.error("[状态效果] 更新状态效果失败:",e),{removedEffects:t}}}function u(e,t){try{const n=(0,a.get)(e,"角色.效果",(0,a.get)(e,"效果",[])),r=n.length;console.log("[状态效果-调试] 尝试移除:",t),console.log("[状态效果-调试] 当前状态效果列表:",n.map(e=>e.状态名称||e.name||"未知"));const o=n.filter(e=>(e.状态名称||e.name)!==t);e.角色||(e.角色={}),(0,a.set)(e,"角色.效果",o);const i=r>o.length;return console.log("[状态效果-调试] 移除结果:",i?"成功":"失败",`(${r} -> ${o.length})`),i}catch(e){return console.error("[状态效果] 移除状态效果失败:",e),!1}}},3992:e=>{"use strict";e.exports=VueRouter},4033:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.login-container[data-v-3cd22fcb] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05), rgba(157, 0, 255, 0.03));\n  position: relative;\n  overflow: hidden;\n}\n.login-container[data-v-3cd22fcb]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-image:\n    linear-gradient(0deg, transparent 24%, rgba(0, 217, 255, 0.02) 25%, rgba(0, 217, 255, 0.02) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.02) 75%, rgba(0, 217, 255, 0.02) 76%, transparent 77%, transparent),\n    linear-gradient(90deg, transparent 24%, rgba(0, 217, 255, 0.02) 25%, rgba(0, 217, 255, 0.02) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.02) 75%, rgba(0, 217, 255, 0.02) 76%, transparent 77%, transparent);\n  background-size: 50px 50px;\n  pointer-events: none;\n  z-index: 0;\n}\n.login-panel[data-v-3cd22fcb] {\n  width: 100%;\n  max-width: 400px;\n  padding: 2.5rem;\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.95), rgba(10, 14, 39, 0.95));\n  border: 2px solid var(--tech-primary);\n  border-radius: 4px;\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  box-shadow: 0 25px 50px rgba(0, 217, 255, 0.2), inset 0 0 40px rgba(0, 217, 255, 0.1);\n  position: relative;\n  z-index: 1;\n}\n.login-panel[data-v-3cd22fcb]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n}\n.title[data-v-3cd22fcb] {\n  text-align: center;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  color: var(--tech-primary);\n  margin-top: 0;\n  margin-bottom: 0.5rem;\n  text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);\n}\n.subtitle[data-v-3cd22fcb] {\n  text-align: center;\n  color: rgba(0, 217, 255, 0.7);\n  margin-bottom: 2rem;\n}\n.form-group[data-v-3cd22fcb] {\n  margin-bottom: 1.5rem;\n}\n.form-group label[data-v-3cd22fcb] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: var(--tech-primary);\n  font-size: 0.9rem;\n}\n.form-group input[data-v-3cd22fcb] {\n  width: 100%;\n  padding: 0.8rem 1rem;\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6));\n  border: 1px solid var(--tech-border);\n  border-radius: 4px;\n  color: var(--tech-primary);\n  font-size: 1rem;\n  box-sizing: border-box;\n  transition: all 0.3s ease;\n}\n.form-group input[data-v-3cd22fcb]::placeholder {\n  color: rgba(0, 217, 255, 0.3);\n}\n.form-group input[data-v-3cd22fcb]:focus {\n  outline: none;\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1);\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(15, 21, 53, 0.8));\n}\n.email-input-row[data-v-3cd22fcb] {\n  display: flex;\n  gap: 0.5rem;\n}\n.email-input-row input[data-v-3cd22fcb] {\n  flex: 1;\n}\n.btn-small[data-v-3cd22fcb] {\n  padding: 0.8rem 1rem;\n  white-space: nowrap;\n  flex-shrink: 0;\n  min-width: 100px;\n  border: 2px solid var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.1));\n  color: var(--tech-primary);\n  border-radius: 4px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);\n}\n.btn-small[data-v-3cd22fcb]:hover:not(:disabled) {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.4);\n}\n.btn-small[data-v-3cd22fcb]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.turnstile-group[data-v-3cd22fcb] {\n  margin-top: 0.25rem;\n}\n.turnstile-container[data-v-3cd22fcb] {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 72px;\n}\n.error-message[data-v-3cd22fcb] {\n    color: var(--tech-danger);\n    text-align: center;\n    margin-bottom: 1rem;\n    animation: fadeIn-3cd22fcb 0.3s ease;\n    background: linear-gradient(135deg, rgba(255, 0, 85, 0.1), rgba(255, 0, 85, 0.05));\n    border: 1px solid rgba(255, 0, 85, 0.3);\n    padding: 0.75rem;\n    border-radius: 4px;\n}\n.success-message[data-v-3cd22fcb] {\n    color: var(--tech-success);\n    text-align: center;\n    margin-bottom: 1rem;\n    animation: fadeIn-3cd22fcb 0.3s ease;\n    background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));\n    border: 1px solid rgba(0, 255, 136, 0.3);\n    padding: 0.75rem;\n    border-radius: 4px;\n}\n.form-actions[data-v-3cd22fcb] {\n    display: flex;\n    justify-content: space-between;\n    gap: 1rem;\n    margin-top: 2rem;\n}\n.form-footer[data-v-3cd22fcb] {\n    text-align: center;\n    margin-top: 1.5rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid var(--tech-border);\n}\n.link[data-v-3cd22fcb] {\n    color: var(--tech-primary);\n    text-decoration: none;\n    transition: all 0.3s ease;\n    font-weight: 500;\n}\n.link[data-v-3cd22fcb]:hover {\n    color: #fff;\n    text-shadow: 0 0 10px rgba(0, 217, 255, 0.8);\n}\n.admin-login-toggle[data-v-3cd22fcb] {\n    margin-top: 1rem;\n}\n.admin-checkbox[data-v-3cd22fcb] {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    cursor: pointer;\n    color: rgba(0, 217, 255, 0.7);\n    font-size: 0.9rem;\n    transition: all 0.3s ease;\n}\n.admin-checkbox input[type=\"checkbox\"][data-v-3cd22fcb] {\n    width: 16px;\n    height: 16px;\n    cursor: pointer;\n    accent-color: var(--tech-warning);\n}\n.admin-checkbox[data-v-3cd22fcb]:hover {\n    color: var(--tech-warning);\n}\n.btn[data-v-3cd22fcb] {\n  padding: 0.8rem 1.5rem;\n  border-radius: 4px;\n  border: 2px solid var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  color: var(--tech-primary);\n  cursor: pointer;\n  transition: all 0.3s ease;\n  font-weight: 600;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);\n}\n.btn[data-v-3cd22fcb]:hover:not(:disabled) {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.25), rgba(157, 0, 255, 0.15));\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);\n}\n.btn[data-v-3cd22fcb]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.btn-secondary[data-v-3cd22fcb] {\n  border-color: var(--tech-secondary);\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(157, 0, 255, 0.05));\n  color: var(--tech-secondary);\n  box-shadow: 0 0 15px rgba(157, 0, 255, 0.2);\n}\n.btn-secondary[data-v-3cd22fcb]:hover:not(:disabled) {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(157, 0, 255, 0.1));\n  box-shadow: 0 0 25px rgba(157, 0, 255, 0.4);\n}\n.btn.is-loading[data-v-3cd22fcb] {\n  opacity: 0.7;\n  pointer-events: none;\n}\n.btn-text[data-v-3cd22fcb] {\n  display: inline-block;\n}\n@keyframes fadeIn-3cd22fcb {\nfrom { opacity: 0; transform: translateY(-10px);\n}\nto { opacity: 1; transform: translateY(0);\n}\n}\n",""]);const s=i},4039:(e,t,n)=>{"use strict";var a="undefined"!=typeof Symbol&&Symbol,r=n(1333);e.exports=function(){return"function"==typeof a&&"function"==typeof Symbol&&"symbol"==typeof a("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4061:e=>{"use strict";e.exports=Vue},4091:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},4178:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-431f1334] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-431f1334] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 500px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-431f1334 0.3s ease-out;\n}\n@keyframes slideUp-431f1334 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-431f1334] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-431f1334] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-431f1334] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-431f1334]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-431f1334] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.form-group[data-v-431f1334] {\n  margin-bottom: 1.5rem;\n}\n.form-label[data-v-431f1334] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.required[data-v-431f1334] {\n  color: var(--color-danger);\n}\n.optional[data-v-431f1334] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: normal;\n}\n.form-input[data-v-431f1334],\n.form-textarea[data-v-431f1334] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-family: inherit;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n}\n.form-input[data-v-431f1334]:focus,\n.form-textarea[data-v-431f1334]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.form-textarea[data-v-431f1334] {\n  resize: vertical;\n  min-height: 80px;\n}\n.char-count[data-v-431f1334] {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  text-align: right;\n}\n.preset-preview[data-v-431f1334] {\n  padding: 1rem;\n  background: rgba(var(--color-accent-rgb), 0.05);\n  border: 1px solid rgba(var(--color-accent-rgb), 0.15);\n  border-radius: 8px;\n  margin-top: 1rem;\n}\n.preview-header[data-v-431f1334] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.75rem;\n}\n.preview-tags[data-v-431f1334] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-431f1334] {\n  padding: 0.3rem 0.7rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n}\n.info-tag.talent-tag[data-v-431f1334] {\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-color: rgba(var(--color-accent-rgb), 0.3);\n  color: var(--color-accent);\n  font-weight: 500;\n}\n.preset-info[data-v-431f1334] {\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 6px;\n  margin-top: 1rem;\n}\n.info-item[data-v-431f1334] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.85rem;\n}\n.info-label[data-v-431f1334] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-431f1334] {\n  color: var(--color-text);\n  font-family: 'Monaco', 'Courier New', monospace;\n}\n.modal-footer[data-v-431f1334] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-431f1334] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-431f1334] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-431f1334]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-431f1334] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-431f1334]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-431f1334]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-431f1334] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-431f1334] {\n    padding: 1rem;\n}\n.modal-title[data-v-431f1334] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-431f1334] {\n    padding: 1rem;\n}\n.form-group[data-v-431f1334] {\n    margin-bottom: 1rem;\n}\n.modal-footer[data-v-431f1334] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-431f1334] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},4191:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});class a{static buildPrompt(e){const t=e.factionCount,n=e.totalLocations,a=e.continentCount,r=Math.min(e.secretRealms,n);if(0===t&&0===n)return this.buildContinentsOnlyPrompt(e);const o=Math.max(2,Math.floor(.25*n)),i=Math.max(2,Math.floor(.25*n)),s=Math.max(1,Math.floor(.15*n)),l=Math.max(2,Math.floor(.2*n)),c=Math.max(0,n-o-i-s-l),d=Math.floor(r*(.3+.3*Math.random())),u=Math.floor(r*(.2+.3*Math.random())),m=Math.max(0,r-d-u),p=e.characterBackground?`\n角色出身: ${e.characterBackground}`:"",g=e.worldBackground?`\n世界背景: ${e.worldBackground}`:"",h=e.worldEra?`\n世界时代: ${e.worldEra}`:"",f=e.worldName?`\n世界名称: ${e.worldName}`:"",v=e.mapConfig,b=Number(v?.minLng??0),y=Number(v?.minLat??0),x=Number(v?.width)||1e4,k=Number(v?.height)||1e4,w=Number(v?.maxLng??b+x),E=Number(v?.maxLat??y+k),N=Math.max(1,Math.floor(w-b)),S=Math.max(1,Math.floor(E-y)),V=Math.max(.6,Math.min(N,S)/1e4),_=Math.max(120,Math.round(150*V)),C=Math.max(240,Math.round(400*V)),A=Math.max(1e3,Math.round(2e3*V)),D=Math.max(2400,Math.round(5e3*V)),T=Date.now()+Math.floor(1e6*Math.random()),B=Math.random().toString(36).substring(7),I=Math.ceil(Math.sqrt(a)),z=Math.ceil(a/I),M=Math.floor(N/z),P=Math.floor(S/I),R=Math.floor(b+.25*N),$=Math.floor(y+.15*S),O=Math.floor(b+.23*N),L=Math.floor(b+.27*N),F=Math.floor(y+.13*S),j=Math.floor(y+.17*S);return`# 诸天万界势力地图生成任务\n\n会话ID: ${B} | 随机种子: ${T}\n\n## 🎮 游戏坐标系统说明\n**重要**：本项目使用游戏坐标系统，不是经纬度！\n- 坐标范围：x: ${b}-${w}, y: ${y}-${E}（像素坐标）\n- 原点(${b},${y})在左上角，x向右增加，y向下增加\n- 所有位置、边界、范围都必须使用此坐标系统\n- 禁止使用经纬度或任何地理坐标系统\n\n## 🚨 最高优先级要求\n必须生成完整JSON：\n1. continents数组：${a}个大洲（边界不重叠）\n2. factions数组：${t}个势力（不能为空）\n3. locations数组：${n}个地点（不能为空）\n\n## 📐 分布与散点要求（强制）\n- 禁止聚集：势力/地点坐标不得都挤在地图中心或同一区域\n- 覆盖全部大洲：每个大洲都要有势力和地点，不能只出现在单个大洲\n- 边距留白：坐标需距离地图边缘≥2%宽高，避免贴边\n- 网格散点：各大洲内部按网格/象限取样坐标，确保南北/东西方向都有点位\n- 坐标随机但分散：同一大洲的势力/地点使用不同象限的随机值，避免坐标重叠\n\n## 世界设定\n${p}${g}${h}${f}\n\n## 🚨 世界风格适配（重要）\n**必须根据上述世界背景，自行判断并选择合适的风格：**\n- 命名风格：势力、地点的命名必须符合世界背景设定\n- 境界体系：根据世界背景选择合适的境界体系（如武道世界用后天/先天/宗师，修仙世界用炼气/筑基/金丹等）\n- 势力类型：根据世界背景选择合适的势力类型（如武侠用门派/帮会，修仙用宗门/世家等）\n- 保持一致性：整个世界的风格必须统一，不要混搭\n\n**禁用词根**：本心、问心、见性、归一、太玄、太虚、紫薇、天机、青霞、无量、昊天、玄天、太清、太上、无极、九天\n\n**重要**：\n- 只生成continents/factions/locations三个字段\n- 严禁输出world_name/world_background/generation_info/player_spawn\n- 每次生成必须显著不同，避免固化\n\n## 核心原则\n### 修仙世界基础\n- 核心体系: 修仙、境界、功法、丹药、法宝\n- 权力结构: 强者为尊\n\n### 多样性与创新\n- 势力多样化: 每次不同类型组合\n- 地名创新: 避免模板化\n- 规模平衡: 根据背景调整\n\n### 势力分布参考\n宗门(40-50%) | 世家(20-30%) | 魔道(10-20%) | 散修联盟(10-15%) | 商会(5-15%) | 妖族(5-10%)\n\n## 大洲生成要求（${a}个）\n### 🚨 关键要求：大洲必须完全覆盖地图，边界必须相连！\n\n### 网格分割法（强制执行）\n- 网格布局: ${I}行 × ${z}列\n- X轴分段: 每段${M}像素（游戏坐标）\n- Y轴分段: 每段${P}像素（游戏坐标）\n- 每个大洲占据一个网格单元\n\n### 大洲边界生成规则（重要！）\n**必须使用以下方法确保边界相连：**\n\n1. **第一个大洲（左上角）**：\n   - 左上角: (${b}, ${y})\n   - 右上角: (${b+M}, ${y})\n   - 右下角: (${b+M}, ${y+P})\n   - 左下角: (${b}, ${y+P})\n   - 可在中间添加1-2个点形成自然形状\n\n2. **其他大洲**：\n   - 必须与相邻大洲共享边界点\n   - 网格边界的四个角点必须精确对齐\n   - 可在边界中间添加1-2个点形成自然曲线\n   - 总点数：4-6个（推荐4-5个）\n\n### 大洲要求\n- 边界: 4-5个坐标点（最多6个），形成简单多边形\n- 坐标格式: {"x": 整数, "y": 整数}，范围${b}-${w}\n- **覆盖: 必须完全覆盖地图，相邻大洲边界必须精确对接，不留空隙**\n- 命名: 独特名称，避免方位词，符合世界背景\n- 描述: 详细描述大陆的地理特征、气候、文化特色\n- 特色: 独特地理特征（雪域、沙漠、森林、山脉、海洋等）\n- 势力: 每个大洲1-3个主要势力\n\n### 推荐形状（简单规则）\n- **矩形变体**：在矩形基础上，某条边中间加1个点形成凸起或凹陷\n- **梯形**：上下边不等长的四边形\n- **五边形**：在矩形基础上切掉一个角\n- ❌ 禁止：复杂的多角星形、不规则锯齿状\n\n### 边界铁律\n- ✅ 相邻大洲必须共享边界点（精确到像素）\n- ✅ 网格角点必须对齐（如 (${b+M}, ${y}) 必须是两个大洲的共同顶点）\n- ✅ 边界点按顺时针或逆时针顺序排列\n- ✅ 形状简洁，不要奇形怪状\n- ❌ 禁止：边界中间断开、留有空隙\n- ❌ 禁止：跨越网格边界\n- ❌ 禁止：过于复杂的形状（超过6个点）\n\n## 势力生成要求（${t}个）\n### 势力等级与规模\n- 超级势力：势力范围跨度≈${Math.round(1.2*C)} 像素，占大洲核心区\n- 一流势力：≈${Math.round((_+C)/2)} 像素\n- 二流势力：≈${Math.round(.9*_)} 像素\n- 三流势力：≈${Math.round(.7*_)} 像素（面积最小）\n- 勿随意使用超大范围，必须与等级匹配\n\n### 规模关系（游戏坐标）\n- 大洲: 超大地理板块，跨度${A}-${D}像素（游戏坐标）\n- **势力范围: 占大洲3%-8%，跨度${_}-${C}像素（游戏坐标）** ⚠️ 不要太大！\n- 势力位置: 必须在对应大洲边界内，使用游戏坐标{"x": 数字, "y": 数字}\n- 势力范围形状: 简单的4-5边形，不要复杂形状\n\n### 必需字段\n1. **基础信息**\n   - 名称、类型、等级（超级/一流/二流/三流）\n   - 描述、历史背景\n   - 特色专长（数组格式）\n\n2. **领导层字段**（前端直接显示）\n\`\`\`json\n{\n  "宗主": "具体姓名（如：欧阳烈风）",\n  "宗主修为": "具体境界（如：化神中期）",\n  "最强修为": "宗门最高境界（必填）",\n  "综合战力": 数字1-100,\n  "核心弟子数": 数字,\n  "内门弟子数": 数字,\n  "外门弟子数": 数字\n}\n\`\`\`\n\n3. **成员数量字段**（前端显示）\n\`\`\`json\n{\n  "总数": 总人数,\n  "按境界": {\n    // 🚨 境界不能超过领导层.最强修为\n    // 境界等级：练气期 < 筑基期 < 金丹期 < 元婴期 < 化神期 < 炼虚期 < 合体期 < 渡劫期\n    "练气期": 数量,\n    "筑基期": 数量\n  },\n  "按职位": {\n    "散修": 0,\n    "外门弟子": 数量,\n    "内门弟子": 数量,\n    "核心弟子": 数量,\n    "传承弟子": 数量,\n    "执事": 数量,\n    "长老": 数量,\n    "太上长老": 数量（可选，大势力才有）,\n    "副掌门": 1,\n    "掌门": 1\n  }\n}\n\`\`\`\n\n### 数据一致性\n- 总数 = 按职位所有职位总和\n- 按境界总和 = 总数\n- 按境界境界 ≤ 最强修为\n- 所有数值必须是数字类型\n\n### 人名要求\n- 具体中式姓名（欧阳烈风、司徒云雅、独孤剑心）\n- 2-3个汉字，符合传统命名\n- 每个人名唯一，不重复\n\n## 地点生成要求（${n}个）\n### 分布\n- 名山大川: ${l}个\n- 城镇坊市: ${o}个\n- 特殊地点: ${i}个\n- 危险区域: ${s}个\n- 其他地点: ${c}个\n- 均匀散点：各大洲都要有地点，禁止所有地点集中在地图中心或单一大洲\n- 坐标象限：同一大洲的地点请分布在不同象限，保持东西/南北方向的平衡\n\n### 6种标准类型（全部使用中文）\n1. 名山大川 - 自然地标（山川湖泊）\n2. 城镇坊市 - 城镇聚居地（坊市、城池）\n3. 洞天福地 - 修炼圣地（灵气充沛之地）\n4. 奇珍异地 - 资源宝地（矿脉、药园）\n5. 凶险之地 - 危险区域（妖兽巢穴、禁地）\n6. 其他特殊 - 特殊地点（遗迹、秘境入口）\n\n### 特殊属性（${r}个）\n- 机遇之地: ${d}个\n- 传承遗迹: ${u}个\n- 危险禁地: ${m}个\n\n### 地点坐标要求（重要）\n- 坐标格式: "坐标": {"x": 数字, "y": 数字}\n- 坐标范围: x和y必须在${b}-${w}之间（游戏坐标）\n- 地点位置必须在对应大洲边界内\n- 可在势力范围内外\n- 中立地点可不属于任何势力\n- 禁止使用经纬度或其他坐标系统\n\n## 数据结构检查\n### 严禁错误格式\n- ✗ 空数组: "势力范围": []\n- ✗ 空数组: "大洲边界": []\n- ✗ 空数组: "地理特征": []\n- ✗ 空数组: "天然屏障": []\n- ✗ 无效坐标: "位置": "初始地"\n- ✗ 缺失必需字段\n- ✗ 势力范围少于4个点\n- ✗ 大洲边界少于4个点或超过8个点\n- ✗ 大洲边界点顺序错误（必须按顺时针或逆时针排列，相邻点连接）\n\n### 必需字段\n**势力**：\n- 位置（对象，游戏坐标）: {"x": 数字, "y": 数字}\n- 势力范围（≥4点，按顺时针或逆时针顺序，游戏坐标）\n- 领导层（完整）\n- 成员数量（完整）\n\n**地点**：\n- 坐标（对象，游戏坐标）: {"x": 数字, "y": 数字}\n- 名称（字符串）\n- 类型（7种类型之一）\n- 描述（详细描述）\n\n**大洲**：\n- 大洲边界（4-6点，推荐4-5点，**必须按顺时针或逆时针顺序排列形成闭合多边形**，游戏坐标）\n- 地理特征（≥3个）\n- 天然屏障（≥2个）\n- 描述（详细的地理和文化描述）\n\n## JSON输出格式\n\`\`\`json\n{\n  "continents": [\n    {\n      "id": "continent_1",\n      "名称": "大洲名称",\n      "描述": "地理特征和文化描述",\n      "气候": "气候类型",\n      "地理特征": ["特征1", "特征2", "特征3"],\n      "天然屏障": ["屏障1", "屏障2"],\n      "大洲边界": [\n        {"x": ${b}, "y": ${y}},\n        {"x": ${b+M}, "y": ${y}},\n        {"x": ${b+M}, "y": ${y+P}},\n        {"x": ${b}, "y": ${y+P}}\n      ],\n      // ⚠️ 游戏坐标系统：x: ${b}-${w}, y: ${y}-${E}（像素坐标，不是经纬度）\n      // ⚠️ 大洲边界必须按顺时针或逆时针顺序排列，相邻点连接形成闭合多边形\n      // ⚠️ 相邻大洲必须共享边界点，确保无缝对接！\n      // ⚠️ 网格角点必须精确对齐（如第一个大洲的右上角 (${b+M}, ${y}) 必须是第二个大洲的左上角）\n      // ⚠️ 推荐4-5个点，最多6个点，保持形状简洁\n      // ⚠️ 示例：矩形变体可以在右边中间加一个点 {"x": ${b+M}, "y": ${y+Math.floor(P/2)}} 形成凸起\n      "主要势力": ["势力ID列表"]\n    }\n  ],\n  "factions": [\n    {\n      "id": "faction_1",\n      "名称": "势力名称",\n      "类型": "修仙宗门/修仙世家/魔道势力等",\n      "等级": "超级/一流/二流/三流",\n      "描述": "势力背景描述",\n      "特色": ["专长1", "专长2"],\n      "与玩家关系": "中立",\n      "声望值": "程序自动计算",\n      "位置": {"x": ${R}, "y": ${$}},\n      // ⚠️ 位置使用游戏坐标 (${b}-${w})，不是经纬度\n      "势力范围": [\n        {"x": ${O}, "y": ${F}},\n        {"x": ${L}, "y": ${F}},\n        {"x": ${L}, "y": ${j}},\n        {"x": ${O}, "y": ${j}}\n      ],\n      // ⚠️ 势力范围坐标必须在游戏坐标系统内 (${b}-${w})，不是经纬度\n      // ⚠️ 势力范围必须按顺时针或逆时针顺序排列\n      // ⚠️ 势力范围必须在对应大洲边界内\n      // ⚠️ 势力范围不要太大！跨度建议${_}-${C}像素，占大洲3%-8%\n      // ⚠️ 形状简单：4-5个点的矩形或五边形即可\n      "领导层": {\n        "宗主": "欧阳烈风",\n        "宗主修为": "化神中期",\n        "副宗主": "王明月",\n        "最强修为": "化神大圆满",\n        "综合战力": 85,\n        "核心弟子数": 50,\n        "内门弟子数": 300,\n        "外门弟子数": 1200\n      },\n      "成员数量": {\n        "总数": 1565,\n        "按境界": {\n          "练气期": 1200,\n          "筑基期": 300,\n          "金丹期": 50,\n          "元婴期": 10,\n          "化神期": 5\n        },\n        "按职位": {\n          "散修": 0,\n          "外门弟子": 1200,\n          "内门弟子": 300,\n          "核心弟子": 50,\n          "传承弟子": 10,\n          "执事": 20,\n          "长老": 15,\n          "太上长老": 1,\n          "副掌门": 1,\n          "掌门": 1\n        }\n      },\n      "所属大洲": "continent_1"\n    }\n  ],\n  "locations": [\n    {\n      "id": "loc_1",\n      "名称": "地点名称",\n      "类型": "城镇坊市",\n      "坐标": {"x": 2500, "y": 1500},\n      // ⚠️ 地点坐标使用游戏坐标系统 (${b}-${w})，不是经纬度\n      // ⚠️ 地点坐标必须在对应大洲边界内\n      // ⚠️ 类型必须是中文：名山大川/城镇坊市/洞天福地/奇珍异地/凶险之地/其他特殊\n      "描述": "地点详细描述",\n      "安全等级": "安全",\n      "适合境界": ["筑基期以上"],\n      "所属势力": "青云宗",\n      "特殊特征": ["护山大阵", "灵气充沛"],\n      "特殊属性": []\n    }\n  ]\n}\n\`\`\`\n\n## 最终检查清单\n生成前必须确认：\n1. ✅ continents数组有${a}个对象，边界不重叠\n2. ✅ factions数组有${t}个对象（不是0个）\n3. ✅ locations数组有${n}个对象（不是0个）\n4. ✅ 每个势力有完整领导层和成员数量\n5. ✅ 每个势力范围≥4个坐标点\n6. ✅ 每个大洲边界4-8个坐标点\n7. ✅ 所有坐标为数字类型，范围在${b}-${w}之间\n8. ✅ 成员数量数据一致性\n9. ✅ 按境界境界≤最强修为\n10. ✅ 避免重复名称\n\n🔥 核心目标：创造独一无二的世界，包含完整势力组织架构！\n\n现在请生成完整JSON数据，确保所有数组都不为空！\n`}static buildContinentsOnlyPrompt(e){const t=e.continentCount,n=e.characterBackground?`\n角色出身: ${e.characterBackground}`:"",a=e.worldBackground?`\n世界背景: ${e.worldBackground}`:"",r=e.worldEra?`\n世界时代: ${e.worldEra}`:"",o=e.worldName?`\n世界名称: ${e.worldName}`:"",i=e.mapConfig,s=Number(i?.minLng??0),l=Number(i?.minLat??0),c=Number(i?.width)||1e4,d=Number(i?.height)||1e4,u=Number(i?.maxLng??s+c),m=Number(i?.maxLat??l+d),p=Math.max(1,Math.floor(u-s)),g=Math.max(1,Math.floor(m-l)),h=Date.now()+Math.floor(1e6*Math.random()),f=Math.random().toString(36).substring(7),v=Math.ceil(Math.sqrt(t)),b=Math.ceil(t/v),y=Math.floor(p/b),x=Math.floor(g/v);return`# 世界大陆框架生成任务（简化模式）\n\n会话ID: ${f} | 随机种子: ${h}\n\n## 🎮 游戏坐标系统说明\n**重要**：本项目使用游戏坐标系统，不是经纬度！\n- 坐标范围：x: ${s}-${u}, y: ${l}-${m}（像素坐标）\n- 原点(${s},${l})在左上角，x向右增加，y向下增加\n- 所有边界都必须使用此坐标系统\n- 禁止使用经纬度或任何地理坐标系统\n\n## 🚨 最高优先级要求\n**仅生成大陆框架，不生成势力和地点！**\n\n必须生成的JSON结构：\n1. continents数组：${t}个大洲\n2. factions数组：空数组 []\n3. locations数组：空数组 []\n\n## 世界设定\n${n}${a}${r}${o}\n\n## 🚨 世界风格适配（重要）\n**必须根据上述世界背景，自行判断并选择合适的风格：**\n- 命名风格：大陆命名必须符合世界背景设定\n- 保持一致性：整个世界的风格必须统一\n\n**禁用词根**：本心、问心、见性、归一、太玄、太虚、紫薇、天机、青霞、无量、昊天、玄天、太清、太上、无极、九天\n\n## 大洲生成要求（${t}个）\n### 🚨 关键要求：大洲必须完全覆盖地图，边界必须相连！\n\n### 网格分割法（强制执行）\n- 网格布局: ${v}行 × ${b}列\n- X轴分段: 每段${y}像素（游戏坐标）\n- Y轴分段: 每段${x}像素（游戏坐标）\n- 每个大洲占据一个网格单元\n\n### 大洲边界生成规则（重要！）\n**必须使用以下方法确保边界相连：**\n\n1. **第一个大洲（左上角）**：\n   - 左上角: (${s}, ${l})\n   - 右上角: (${s+y}, ${l})\n   - 右下角: (${s+y}, ${l+x})\n   - 左下角: (${s}, ${l+x})\n   - 可在中间添加1-2个点形成自然形状\n\n2. **其他大洲**：\n   - 必须与相邻大洲共享边界点\n   - 网格边界的四个角点必须精确对齐\n   - 总点数：4-6个（推荐4-5个）\n\n### 大洲要求\n- 边界: 4-5个坐标点（最多6个），形成简单多边形\n- 坐标格式: {"x": 整数, "y": 整数}，范围${s}-${u}\n- **覆盖: 必须完全覆盖地图，相邻大洲边界必须精确对接，不留空隙**\n- 命名: 独特名称，避免方位词，符合世界背景\n- 描述: 详细描述大陆的地理特征、气候、文化特色\n- 特色: 独特地理特征（雪域、沙漠、森林、山脉、海洋等）\n- 主要势力: 空数组 []（势力将在游戏中动态生成）\n\n## JSON输出格式\n\`\`\`json\n{\n  "continents": [\n    {\n      "id": "continent_1",\n      "名称": "大洲名称",\n      "描述": "地理特征和文化描述",\n      "气候": "气候类型",\n      "地理特征": ["特征1", "特征2", "特征3"],\n      "天然屏障": ["屏障1", "屏障2"],\n      "大洲边界": [\n        {"x": ${s}, "y": ${l}},\n        {"x": ${s+y}, "y": ${l}},\n        {"x": ${s+y}, "y": ${l+x}},\n        {"x": ${s}, "y": ${l+x}}\n      ],\n      "主要势力": []\n    }\n  ],\n  "factions": [],\n  "locations": []\n}\n\`\`\`\n\n## 最终检查清单\n生成前必须确认：\n1. ✅ continents数组有${t}个对象，边界不重叠且完全覆盖地图\n2. ✅ factions数组为空 []\n3. ✅ locations数组为空 []\n4. ✅ 每个大洲边界4-6个坐标点\n5. ✅ 所有坐标为数字类型，范围在${s}-${u}之间\n6. ✅ 相邻大洲边界精确对接\n\n🔥 核心目标：快速生成大陆框架，势力和地点将在游戏中动态探索生成！\n\n现在请生成JSON数据，只包含大陆信息！\n`}}},4270:(e,t,n)=>{"use strict";n.d(t,{T:()=>c,o:()=>l});var a=n(4061);const r=(0,a.ref)([]);let o=0;const i=e=>{const t=r.value.findIndex(t=>t.id===e);t>-1&&r.value.splice(t,1)},s=(e,t,n={})=>{const a=n.id||"toast-"+o++;i(a);const s=n.duration??("loading"===e?void 0:3e3),l={id:a,type:e,message:t,duration:s};return r.value.push(l),void 0!==s&&setTimeout(()=>{i(a)},s),a},l={success:(e,t={})=>s("success",e,t),error:(e,t={})=>s("error",e,t),warning:(e,t={})=>s("warning",e,t),info:(e,t={})=>s("info",e,t),loading:(e,t={})=>{const n=void 0===t.duration?void 0:t.duration;return s("loading",e,{...t,duration:n})},hide:i},c=(0,a.readonly)(r)},4319:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 基础布局 - 深色玻璃拟态风格 ========== */\n.step-wrapper[data-v-240ca87a] {\n  height: 100%;\n}\n.creation-container[data-v-240ca87a] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  overflow: hidden;\n  box-sizing: border-box;\n  background: transparent; /* 透明背景以显示视频 */\n}\n.creation-scroll[data-v-240ca87a] {\n  width: 95%;\n  max-width: 1200px;\n  height: 92vh;\n  max-height: 92vh;\n  background: rgba(15, 23, 42, 0.75);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n  display: flex;\n  flex-direction: column;\n  padding: 2rem;\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  position: relative;\n  z-index: 1;\n  overflow: hidden;\n}\n\n/* ========== 头部区域 ========== */\n.header-container[data-v-240ca87a] {\n  margin-bottom: 1.5rem;\n  flex-shrink: 0;\n}\n.header-top[data-v-240ca87a] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n\n/* ========== 穿越点数确认弹窗 ========== */\n.travel-confirm-overlay[data-v-240ca87a] {\n  position: fixed;\n  inset: 0;\n  background: rgba(2, 6, 23, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 50;\n}\n.travel-confirm-card[data-v-240ca87a] {\n  width: min(520px, 90vw);\n  background: rgba(15, 23, 42, 0.92);\n  border: 1px solid rgba(148, 163, 184, 0.25);\n  border-radius: 12px;\n  padding: 1.5rem;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);\n  color: #e2e8f0;\n}\n.travel-confirm-title[data-v-240ca87a] {\n  font-size: 1.2rem;\n  font-weight: 600;\n  margin-bottom: 0.75rem;\n}\n.travel-confirm-message[data-v-240ca87a] {\n  margin-bottom: 0.75rem;\n  color: rgba(226, 232, 240, 0.9);\n}\n.travel-confirm-points[data-v-240ca87a] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  margin-bottom: 1.25rem;\n}\n.travel-confirm-actions[data-v-240ca87a] {\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n}\n.mode-indicator[data-v-240ca87a] {\n  font-size: 0.75rem;\n  color: #fbbf24;\n  padding: 0.25rem 0.75rem;\n  background: rgba(251, 191, 36, 0.1);\n  border: 1px solid rgba(251, 191, 36, 0.25);\n  border-radius: 4px;\n  font-weight: 500;\n  letter-spacing: 0.05em;\n}\n.cloud-sync-container[data-v-240ca87a] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n\n/* ========== 进度步骤 ========== */\n.progress-steps[data-v-240ca87a] {\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n  overflow-x: auto;\n  overflow-y: hidden;\n  gap: 0.5rem;\n  padding: 0.5rem 0;\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n}\n.progress-steps[data-v-240ca87a]::-webkit-scrollbar {\n  display: none;\n}\n.step[data-v-240ca87a] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  opacity: 0.4;\n  transition: all 0.3s ease;\n  flex-shrink: 0;\n  min-width: 60px;\n  cursor: default;\n}\n.step.active[data-v-240ca87a] {\n  opacity: 1;\n}\n.step-circle[data-v-240ca87a] {\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background: rgba(30, 41, 59, 0.8);\n  border: 2px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #94a3b8;\n  transition: all 0.3s ease;\n}\n.step.active .step-circle[data-v-240ca87a] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  color: #ffffff;\n  border-color: rgba(96, 165, 250, 0.5);\n  box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);\n}\n.step-label[data-v-240ca87a] {\n  margin-top: 0.5rem;\n  font-size: 0.7rem;\n  color: #64748b;\n  text-align: center;\n  letter-spacing: 0.05em;\n}\n.step.active .step-label[data-v-240ca87a] {\n  color: #f1f5f9;\n  font-weight: 500;\n}\n\n/* ========== 内容区域 ========== */\n.step-content[data-v-240ca87a] {\n  flex: 1 1 0;\n  min-height: 0;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1.5rem 0.5rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.06);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.step-content[data-v-240ca87a]::-webkit-scrollbar {\n  width: 6px;\n}\n.step-content[data-v-240ca87a]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.step-content[data-v-240ca87a]::-webkit-scrollbar-thumb {\n  background: rgba(147, 197, 253, 0.3);\n  border-radius: 3px;\n}\n.step-content[data-v-240ca87a]::-webkit-scrollbar-thumb:hover {\n  background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 导航按钮 ========== */\n.navigation-buttons[data-v-240ca87a] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n  flex-shrink: 0;\n  padding-top: 1.5rem;\n  position: relative;\n}\n.points-display[data-v-240ca87a] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.destiny-points[data-v-240ca87a] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 8px;\n}\n.points-label[data-v-240ca87a] {\n  color: #94a3b8;\n  font-size: 0.85rem;\n}\n.points-value[data-v-240ca87a] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #93c5fd;\n}\n.points-value.low[data-v-240ca87a] {\n  color: #f87171;\n  animation: pulse-240ca87a 1s ease-in-out infinite;\n}\n@keyframes pulse-240ca87a {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.5;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .creation-scroll[data-v-240ca87a] {\n  background: rgba(255, 255, 255, 0.85);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .mode-indicator[data-v-240ca87a] {\n  color: #d97706;\n  background: rgba(251, 191, 36, 0.15);\n  border-color: rgba(251, 191, 36, 0.3);\n}\n[data-theme="light"] .step-circle[data-v-240ca87a] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.1);\n  color: #64748b;\n}\n[data-theme="light"] .step.active .step-circle[data-v-240ca87a] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: rgba(59, 130, 246, 0.5);\n}\n[data-theme="light"] .step-label[data-v-240ca87a] {\n  color: #94a3b8;\n}\n[data-theme="light"] .step.active .step-label[data-v-240ca87a] {\n  color: #1e293b;\n}\n[data-theme="light"] .step-content[data-v-240ca87a] {\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .destiny-points[data-v-240ca87a] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .points-label[data-v-240ca87a] {\n  color: #64748b;\n}\n[data-theme="light"] .points-value[data-v-240ca87a] {\n  color: #3b82f6;\n}\n\n/* ========== 平板适配 ========== */\n@media (max-width: 768px) {\n.creation-scroll[data-v-240ca87a] {\n    width: 98%;\n    height: 95vh;\n    max-height: 95vh;\n    padding: 1.5rem;\n    border-radius: 12px;\n}\n.header-container[data-v-240ca87a] {\n    margin-bottom: 1rem;\n}\n.progress-steps[data-v-240ca87a] {\n    justify-content: flex-start;\n    gap: 0.75rem;\n}\n.step[data-v-240ca87a] {\n    min-width: 55px;\n}\n.step-circle[data-v-240ca87a] {\n    width: 32px;\n    height: 32px;\n    font-size: 0.85rem;\n}\n.step-label[data-v-240ca87a] {\n    font-size: 0.65rem;\n}\n.step-content[data-v-240ca87a] {\n    padding: 1rem 0.25rem;\n}\n.navigation-buttons[data-v-240ca87a] {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.points-display[data-v-240ca87a] {\n    flex-basis: 100%;\n    order: -1;\n    margin-bottom: 0.5rem;\n    position: static;\n    transform: none;\n}\n.navigation-buttons button[data-v-240ca87a] {\n    flex: 1;\n    min-width: 100px;\n}\n}\n\n/* ========== 手机适配 ========== */\n@media (max-width: 480px) {\n.creation-scroll[data-v-240ca87a] {\n    width: 100%;\n    height: 100vh;\n    max-height: 100vh;\n    padding: 1rem;\n    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n    border-radius: 0;\n    box-shadow: none;\n}\n.header-top[data-v-240ca87a] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n}\n.mode-indicator[data-v-240ca87a] {\n    text-align: center;\n    font-size: 0.7rem;\n}\n.cloud-sync-container[data-v-240ca87a] {\n    justify-content: center;\n}\n.progress-steps[data-v-240ca87a] {\n    gap: 0.4rem;\n}\n.step[data-v-240ca87a] {\n    min-width: 46px;\n}\n.step-circle[data-v-240ca87a] {\n    width: 28px;\n    height: 28px;\n    font-size: 0.75rem;\n}\n.step-label[data-v-240ca87a] {\n    font-size: 0.55rem;\n}\n.step-content[data-v-240ca87a] {\n    padding: 0.75rem 0.25rem;\n}\n.navigation-buttons[data-v-240ca87a] {\n    padding-top: 0.75rem;\n    gap: 0.5rem;\n}\n.points-display[data-v-240ca87a] {\n    width: 100%;\n    flex-basis: 100%;\n    order: -1;\n    margin-bottom: 0.5rem;\n    position: static;\n    transform: none;\n    justify-content: center;\n}\n.destiny-points[data-v-240ca87a] {\n    padding: 0.4rem 0.75rem;\n}\n.points-label[data-v-240ca87a] {\n    font-size: 0.75rem;\n}\n.points-value[data-v-240ca87a] {\n    font-size: 0.95rem;\n}\n.navigation-buttons button[data-v-240ca87a] {\n    flex: 1 1 calc(50% - 0.25rem);\n    min-width: 0;\n    padding: 0.6rem 0.4rem;\n    font-size: 0.8rem;\n}\n}\n\n/* ========== 超小屏幕适配 ========== */\n@media (max-width: 360px) {\n.creation-scroll[data-v-240ca87a] {\n    padding: 0.75rem;\n}\n.step[data-v-240ca87a] {\n    min-width: 42px;\n}\n.step-circle[data-v-240ca87a] {\n    width: 26px;\n    height: 26px;\n    font-size: 0.7rem;\n}\n.step-label[data-v-240ca87a] {\n    font-size: 0.5rem;\n}\n}\n',""]);const s=i},4414:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.format-guide-modal-overlay[data-v-15e88818] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  backdrop-filter: blur(4px);\n  padding: 20px;\n}\n.format-guide-modal[data-v-15e88818] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  width: 100%;\n  max-width: 1000px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: slideUp-15e88818 0.3s ease;\n}\n@keyframes slideUp-15e88818 {\nfrom {\n    transform: translateY(20px);\n    opacity: 0;\n}\nto {\n    transform: translateY(0);\n    opacity: 1;\n}\n}\n.modal-header[data-v-15e88818] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-15e88818] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-15e88818] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s;\n}\n.close-btn[data-v-15e88818]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-15e88818] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0;\n}\n.format-guide-content[data-v-15e88818] {\n  display: flex;\n  height: 100%;\n}\n.quick-nav[data-v-15e88818] {\n  width: 180px;\n  border-right: 1px solid var(--color-border);\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  flex-shrink: 0;\n}\n.nav-btn[data-v-15e88818] {\n  padding: 0.6rem 1rem;\n  background: transparent;\n  border: none;\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  text-align: left;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.nav-btn[data-v-15e88818]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.nav-btn.active[data-v-15e88818] {\n  background: var(--color-primary);\n  color: white;\n}\n.format-sections[data-v-15e88818] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.format-section[data-v-15e88818] {\n  margin-bottom: 2rem;\n}\n.section-title[data-v-15e88818] {\n  margin: 0 0 1rem 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  border-bottom: 2px solid var(--color-primary);\n  padding-bottom: 0.5rem;\n}\n.section-content h5[data-v-15e88818] {\n  margin: 1rem 0 0.5rem 0;\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.code-block[data-v-15e88818] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 1rem;\n  margin: 0.5rem 0;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  color: var(--color-text);\n  overflow-x: auto;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.example-box[data-v-15e88818] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-left: 3px solid var(--color-primary);\n  padding: 1rem;\n  margin: 1rem 0;\n  border-radius: 4px;\n}\n.example-box strong[data-v-15e88818] {\n  color: var(--color-primary);\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.warning-box[data-v-15e88818] {\n  background: rgba(255, 193, 7, 0.1);\n  border-left: 3px solid #ffc107;\n  padding: 1rem;\n  margin: 1rem 0;\n  border-radius: 4px;\n}\n.warning-box strong[data-v-15e88818] {\n  color: #ffc107;\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.warning-box ul[data-v-15e88818] {\n  margin: 0.5rem 0 0 1.5rem;\n  padding: 0;\n}\n.warning-box li[data-v-15e88818] {\n  margin: 0.3rem 0;\n  color: var(--color-text);\n}\n.modal-footer[data-v-15e88818] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 1rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n.copy-btn[data-v-15e88818],\n.close-footer-btn[data-v-15e88818] {\n  padding: 0.6rem 1.2rem;\n  border: none;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n}\n.copy-btn[data-v-15e88818] {\n  background: var(--color-primary);\n  color: white;\n}\n.copy-btn[data-v-15e88818]:hover {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.close-footer-btn[data-v-15e88818] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  margin-left: auto;\n}\n.close-footer-btn[data-v-15e88818]:hover {\n  background: var(--color-surface-hover);\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.format-guide-modal[data-v-15e88818] {\n    max-width: 95vw;\n    max-height: 95vh;\n}\n.format-guide-content[data-v-15e88818] {\n    flex-direction: column;\n}\n.quick-nav[data-v-15e88818] {\n    width: 100%;\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n    flex-direction: row;\n    overflow-x: auto;\n    padding: 0.75rem;\n}\n.nav-btn[data-v-15e88818] {\n    white-space: nowrap;\n}\n.format-sections[data-v-15e88818] {\n    padding: 1rem;\n}\n.modal-footer[data-v-15e88818] {\n    flex-direction: column;\n}\n.close-footer-btn[data-v-15e88818] {\n    margin-left: 0;\n}\n}\n",""]);const s=i},4417:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4449:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},4459:(e,t,n)=>{"use strict";n.r(t),n.d(t,{promptStorage:()=>o});var a=n(602),r=n(7203);const o=new class{db=null;async init(){this.db||(this.db=await(0,a.P2)("dad-prompts",1,{upgrade(e){e.objectStoreNames.contains("prompts")||e.createObjectStore("prompts",{keyPath:"key"})}}))}async loadAll(){await this.init();const e=(0,r.LB)(),t={};for(const n in e){const a=await this.db.get("prompts",n),r=a?.content||e[n].content,o=!1!==a?.enabled,i=void 0!==a?.weight?a.weight:e[n].weight;t[n]={key:n,name:e[n].name,content:r,modified:!!a&&a.content!==e[n].content,enabled:o,default:e[n].content,category:e[n].category,description:e[n].description,order:e[n].order,weight:i}}return t}async loadByCategory(){await this.init();const e=await this.loadAll(),t={};for(const[e,n]of Object.entries(r.y8))t[e]={info:n,prompts:[]};for(const n in e){const a=e[n],r=a.category;if(t[r])t[r].prompts.push(a);else{const e=Object.keys(t)[0];e&&t[e].prompts.push(a)}}for(const e in t)t[e].prompts.sort((e,t)=>(e.order||999)-(t.order||999));return t}async save(e,t,n=!0,a){await this.init(),await this.db.put("prompts",{key:e,content:t,modified:!0,enabled:n,weight:a,updatedAt:(new Date).toISOString()})}async setEnabled(e,t){await this.init();const n=(0,r.LB)(),a=await this.db.get("prompts",e),o=a?.content||n[e]?.content||"",i=a?.modified||!1;await this.db.put("prompts",{key:e,content:o,modified:i,enabled:t,updatedAt:(new Date).toISOString()})}async getEnabledPrompts(){const e=await this.loadAll();return Object.keys(e).filter(t=>e[t].enabled)}async get(e){await this.init();const t=(0,r.LB)(),n=await this.db.get("prompts",e);return!1===n?.enabled?"":n?.modified?n.content:t[e]?.content||""}async reset(e){await this.init(),await this.db.delete("prompts",e)}async resetAll(){await this.init(),await this.db.clear("prompts")}async exportAll(){const e=await this.loadAll(),t={};for(const n in e)t[n]=e[n].content;return t}async importPrompts(e){await this.init();const t=(0,r.LB)();let n=0;for(const a in e)t[a]&&(await this.save(a,e[a]),n++);return n}}},4511:(e,t,n)=>{"use strict";var a=n(5072),r=n.n(a),o=n(7825),i=n.n(o),s=n(7659),l=n.n(s),c=n(5056),d=n.n(c),u=n(540),m=n.n(u),p=n(1113),g=n.n(p),h=n(1208),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=m(),r()(h.A,f),h.A&&h.A.locals&&h.A.locals},4515:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.variable-section[data-v-510a4b50] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-510a4b50] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-510a4b50] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.add-btn[data-v-510a4b50] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.add-btn[data-v-510a4b50]:hover {\n  background: var(--color-primary-hover);\n}\n.add-btn[data-v-510a4b50]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-border);\n}\n.variable-content[data-v-510a4b50] {\n  flex: 1;\n  overflow: hidden;\n}\n.variable-list[data-v-510a4b50] {\n  height: 100%;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.variable-item[data-v-510a4b50] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 1rem;\n}\n.variable-header[data-v-510a4b50] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n  gap: 0.5rem;\n}\n.variable-key[data-v-510a4b50] {\n  font-weight: 600;\n  color: var(--color-primary);\n  flex: 1;\n  word-break: break-word;\n}\n.variable-type[data-v-510a4b50] {\n  font-size: 0.75rem;\n  padding: 0.125rem 0.5rem;\n  background: var(--color-accent-light);\n  color: var(--color-accent);\n  border-radius: 4px;\n  flex-shrink: 0;\n}\n.variable-actions[data-v-510a4b50] {\n  display: flex;\n  gap: 0.25rem;\n  flex-shrink: 0;\n}\n.action-btn[data-v-510a4b50] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  padding: 0;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: var(--color-text-secondary);\n  background: var(--color-surface);\n}\n.action-btn[data-v-510a4b50]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.action-btn[data-v-510a4b50]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-color: var(--color-border);\n}\n.action-btn.edit[data-v-510a4b50]:disabled:hover,\n.action-btn.copy[data-v-510a4b50]:disabled:hover,\n.action-btn.delete[data-v-510a4b50]:disabled:hover {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border-color: var(--color-border);\n}\n.action-btn.edit[data-v-510a4b50]:hover {\n  background: var(--color-info);\n  color: white;\n  border-color: var(--color-info);\n}\n.action-btn.copy[data-v-510a4b50]:hover {\n  background: var(--color-success);\n  color: white;\n  border-color: var(--color-success);\n}\n.action-btn.delete[data-v-510a4b50]:hover {\n  background: var(--color-danger);\n  color: white;\n  border-color: var(--color-danger);\n}\n.variable-value[data-v-510a4b50] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  word-break: break-word;\n}\n.code-pre[data-v-510a4b50] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  max-height: 200px;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-510a4b50] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 1rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.debug-info[data-v-510a4b50] {\n  margin-top: 1rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.debug-info summary[data-v-510a4b50] {\n  cursor: pointer;\n  color: var(--color-primary);\n}\n.debug-content[data-v-510a4b50] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 4px;\n  text-align: left;\n}\n.debug-actions[data-v-510a4b50] {\n  margin-top: 0.5rem;\n}\n.debug-btn[data-v-510a4b50] {\n  padding: 0.25rem 0.5rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.variable-section[data-v-510a4b50] {\n    padding: 0.75rem;\n}\n.section-header[data-v-510a4b50] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n    margin-bottom: 0.75rem;\n}\n.section-title[data-v-510a4b50] {\n    font-size: 1rem;\n    text-align: center;\n}\n.add-btn[data-v-510a4b50] {\n    align-self: center;\n    padding: 0.4rem 0.8rem;\n    font-size: 0.8rem;\n}\n.variable-item[data-v-510a4b50] {\n    padding: 0.75rem;\n}\n.variable-header[data-v-510a4b50] {\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.5rem;\n}\n.variable-key[data-v-510a4b50] {\n    font-size: 0.9rem;\n}\n.variable-actions[data-v-510a4b50] {\n    justify-content: center;\n    gap: 0.5rem;\n}\n.action-btn[data-v-510a4b50] {\n    width: 32px;\n    height: 32px;\n}\n.code-pre[data-v-510a4b50] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.variable-section[data-v-510a4b50] {\n    padding: 0.5rem;\n}\n.section-title[data-v-510a4b50] {\n    font-size: 0.9rem;\n}\n.add-btn[data-v-510a4b50] {\n    padding: 0.35rem 0.7rem;\n    font-size: 0.75rem;\n}\n.variable-item[data-v-510a4b50] {\n    padding: 0.5rem;\n}\n.variable-key[data-v-510a4b50] {\n    font-size: 0.85rem;\n}\n.variable-type[data-v-510a4b50] {\n    font-size: 0.7rem;\n}\n.action-btn[data-v-510a4b50] {\n    width: 28px;\n    height: 28px;\n}\n.code-pre[data-v-510a4b50] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n.empty-state[data-v-510a4b50] {\n    padding: 2rem 0.5rem;\n}\n}\n",""]);const s=i},4530:(e,t,n)=>{"use strict";n.d(t,{WI:()=>d,jj:()=>h,ru:()=>c});const a=["状态","玩家角色状态","玩家角色状态信息","玩家角色信息","角色基础信息","玩家角色基础信息","修行状态","状态效果","叙事历史","对话历史","任务系统","事件系统","宗门系统","世界信息","人物关系","装备栏","游戏时间","三千大道","修炼功法","掌握技能","身体部位开发"],r=["元数据","角色","社交","世界","系统"],o=e=>JSON.parse(JSON.stringify(e)),i=e=>!!e&&"object"==typeof e&&!Array.isArray(e),s=e=>{if(Array.isArray(e))return e.map(s);if(!i(e))return e;const t={};for(const[n,a]of Object.entries(e))"_AI说明"!==n&&"_AI修改规则"!==n&&"_AI重要提醒"!==n&&(t[n]=s(a));return t},l=e=>{const t={年:1e3,月:1,日:1,小时:8,分钟:0};return i(e)?{年:Number(e.年??e.年数??t.年),月:Number(e.月??t.月),日:Number(e.日??t.日),小时:Number(e.小时??t.小时),分钟:Number(e.分钟??t.分钟)}:t};function c(e){if(!e||"object"!=typeof e)return!1;const t=e;return i(t.元数据)&&i(t.角色)&&i(t.社交)&&i(t.世界)&&i(t.系统)}function d(e){if(!e||"object"!=typeof e)return{needsMigration:!0,issues:["invalid-structure"],legacyKeysFound:[]};const t=e;if(c(e))return{needsMigration:!1,issues:[],legacyKeysFound:[]};const n=[...a.filter(e=>e in t),...t.属性||t.位置||t.背包||t.时间?["短路径平铺"]:[]],o=r.filter(e=>!(e in t)),i=[];return n.length>0&&i.push("legacy-root-keys"),o.length>0&&i.push("missing-required-keys"),{needsMigration:i.length>0,issues:i,legacyKeysFound:n}}const u=()=>({配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]}),m=()=>({模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"}),p=e=>({世界名称:"九寰仙岛",大陆信息:[],势力信息:[],地点信息:[],生成时间:e,世界背景:"",世界纪元:"",特殊设定:[],版本:"v1"}),g=()=>({名字:"无名修士",性别:"男",出生日期:{年:982,月:1,日:1},种族:"人族",世界:"九寰仙岛",天资:"凡人",出生:"散修",灵根:"五行杂灵根",天赋:[],先天六司:{根骨:5,灵性:5,悟性:5,气运:5,魅力:5,心性:5},后天六司:{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}});function h(e){const t=o(e??{}),n=s(t),d={legacyKeysFound:[],removedLegacyKeys:[],warnings:[]};if(c(n))return{migrated:n,report:d};d.legacyKeysFound=a.filter(e=>e in n);const h=(new Date).toISOString(),f=n.角色??n.角色基础信息??n.玩家角色基础信息??n.玩家角色信息??n.玩家角色状态信息?.角色??null,v=n.属性??n.状态??n.玩家角色状态??n.玩家角色状态信息??null,b=i(v)?v:{},y={境界:b.境界??null,声望:b.声望??0,气血:b.气血??{当前:100,上限:100},灵气:b.灵气??{当前:50,上限:50},神识:b.神识??{当前:30,上限:30},寿命:b.寿命??{当前:18,上限:80}},x=n.效果??n.修行状态??b.状态效果??n.状态效果??[],k=Array.isArray(x)?x:[],w=n.位置??b.位置??n.状态位置??{描述:"九寰仙岛·无名之地",x:5e3,y:5e3},E=l(n.元数据?.时间??n.时间??n.游戏时间),N=n.背包??{灵石:{下品:0,中品:0,上品:0,极品:0},物品:{}},S=n.装备??n.装备栏??{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},V=n.功法??{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},_=n.修炼??(void 0!==n.修炼功法?{修炼功法:n.修炼功法}:{修炼功法:null}),C=n.大道??n.三千大道??{大道列表:{}},A=n.技能??(n.掌握技能?{掌握技能:n.掌握技能,装备栏:[],冷却:{}}:{掌握技能:[],装备栏:[],冷却:{}}),D=n.宗门??n.宗门系统??void 0,T=n.关系??n.人物关系??{},B=n.记忆??{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]},I=n.事件??n.事件系统??u(),z=(()=>{const e=i(I)?o(I):u();return Array.isArray(e.事件记录)||(e.事件记录=[]),i(e.下次事件时间)||(e.下次事件时间=null),e})(),M=n.世界?.信息??n.世界??n.世界信息??n.worldInfo??void 0,P=i(M)?M:p(h),R=n.系统?.配置??n.系统??n.系统配置??void 0,$=n.系统?.历史?.叙事??n.历史?.叙事??(n.叙事历史?n.叙事历史:n.对话历史?n.对话历史:[]),O=n.系统?.联机??n.联机??m(),L=i(f)?f:g(),F={元数据:{版本号:3,存档ID:String(n.元数据?.存档ID??n.存档ID??`save_${Date.now()}`),存档名:String(n.元数据?.存档名??n.存档名??"迁移存档"),游戏版本:n.元数据?.游戏版本??n.游戏版本,创建时间:String(n.元数据?.创建时间??n.创建时间??h),更新时间:h,游戏时长秒:Number(n.元数据?.游戏时长秒??n.游戏时长秒??n.元数据?.游戏时长??n.游戏时长??0),时间:E},角色:{身份:L,属性:y,位置:w,效果:k,身体:n.身体??(n.身体部位开发?{部位开发:n.身体部位开发}:void 0),背包:N,装备:S,功法:V,修炼:_,大道:C,技能:A},社交:{关系:T,宗门:D??null,事件:z,记忆:B},世界:{信息:P,状态:n.世界?.状态??n.世界状态??void 0},系统:{配置:R,设置:n.系统?.设置??n.设置??void 0,缓存:n.系统?.缓存??n.缓存??void 0,行动队列:n.系统?.行动队列??n.行动队列??void 0,历史:{叙事:Array.isArray($)?$:[]},扩展:n.系统?.扩展??n.扩展??{},联机:i(O)?{...m(),...O}:m()}};for(const e of a)e in n&&d.removedLegacyKeys.push(String(e));for(const e of r)e in F||d.warnings.push(`迁移后缺少必填字段：${String(e)}`);return F.角色?.身份||d.warnings.push("迁移后仍缺少 角色.身份（将导致部分界面无法展示）"),{migrated:F,report:d}}},4582:(e,t,n)=>{"use strict";n.r(t),n.d(t,{useCharacterStore:()=>ae});var a=n(4061),r=n(810),o=n(2224),i=n(4270),s=n(3302),l=n(9173),c=n(1211),d=n(5099),u=n(8651),m=n(6585),p=n(1184),g=n(9852),h=n(840),f=n(3098),v=n(4530),b=n(2347),y=n(7527);async function x(e,t){return new Promise(n=>{(0,l.useUIStore)().showRetryDialog({title:`${e}失败`,message:`${e}经过多次尝试后仍然失败。\n\n错误信息：${t}\n\n是否继续重试？\n选择"取消"将终止角色创建流程。`,onConfirm:()=>n(!0),onCancel:()=>n(!1)})})}function k(e,t){const{先天六司:n}=e,a=Number(n?.根骨??0),r=Number(n?.灵性??0),o=Number(n?.悟性??0),i=100+10*a,s=50+5*r,l=30+3*o,c=80+5*a;return console.log(`[角色初始化] 属性计算: 气血=${i}, 灵气=${s}, 神识=${l}, 年龄=${t}/${c}`),console.log(`[角色初始化] 先天六司: 根骨=${a}, 灵性=${r}, 悟性=${o}`),{境界:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"引气入体，感悟天地灵气，踏上修仙第一步"},声望:0,位置:{描述:"位置生成失败"},气血:{当前:i,上限:i},灵气:{当前:s,上限:s},神识:{当前:l,上限:l},寿命:{当前:t,上限:c}}}async function w(e,t,n,a,r=!0,o="generate"){console.log("[初始化流程] ===== initializeCharacter 入口 =====");const i=(0,c.N)();!t.种族&&i.characterPayload.race&&(console.log(`[初始化流程] 补丁：从 store 同步种族信息: ${i.characterPayload.race}`),t.种族=i.characterPayload.race),console.log("[初始化流程] 接收到的 baseInfo.先天六司:",t.先天六司);try{const{saveData:e,processedBaseInfo:i}=function(e,t){let n;console.log("[初始化流程] 1. 准备初始存档数据"),console.log("[初始化流程] prepareInitialData 接收到的 baseInfo.先天六司:",e.先天六司);try{n=JSON.parse(JSON.stringify(e)),console.log("[初始化流程] JSON 序列化后的 processedBaseInfo.先天六司:",n.先天六司)}catch(t){console.error("[角色初始化] JSON 序列化失败，使用原始对象",t),n=e}const a=t;var r;Math.floor(12*Math.random()),Math.floor(60*Math.random()),n.出生日期||(n.出生日期={年:a-t,月:1,日:1,小时:0,分钟:0},console.log(`[角色初始化] 临时出生日期(AI可能会重新计算): ${n.出生日期.年}年${n.出生日期.月}月${n.出生日期.日}日 (当前${t}岁)`)),n.后天六司||(n.后天六司={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0},console.log("[角色初始化] 初始化后天六司为全0")),"string"!=typeof(r=n.灵根)||"随机灵根"!==r&&!r.includes("随机")?console.log("[灵根生成] 检测到玩家已选择特定灵根，将直接使用该灵根，不进行随机化处理。"):console.log("[灵根生成] 检测到随机灵根，将由 AI 创造性生成"),"string"!=typeof n.出生||"随机出生"!==n.出生&&!n.出生.includes("随机")||console.log("[出生生成] 检测到随机出生，将由 AI 创造性生成");const o=k(n,t),i={境界:o.境界,声望:o.声望,气血:o.气血,灵气:o.灵气,神识:o.神识,寿命:o.寿命},s=o.位置,l=(0,u.isTavernEnv)(),c={角色:n,属性:i,位置:s,效果:[],时间:{年:t,月:1,日:1,小时:Math.floor(12*Math.random())+6,分钟:Math.floor(60*Math.random())},背包:{灵石:{下品:0,中品:0,上品:0,极品:0},物品:{}},装备:{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},功法:{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},修炼:{修炼功法:null},大道:{大道列表:{}},技能:{掌握技能:[],装备栏:[],冷却:{}},宗门:void 0,事件:{配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},记忆:{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]},关系:{},历史:{叙事:[]},系统:{规则:{属性上限:{先天六司:{每项上限:10}},装备系统:"装备存储引用{物品ID,名称}，完整数据在背包.物品中",品质控制:"严格遵守境界对应品质范围，仙品世界上几乎没有，每一个都是令世界动荡的存在，神品不存在"},提示:["⚠️ 先创建后修改：修改数据前必须确保数据已存在","装备字段：装备1-6"],...l?{...(0,m.rW)()}:{}}};if(l&&c.系统?.nsfwMode){console.log(`[角色初始化] NSFW模式已开启，正在初始化[${e.性别}]性身体结构...`);const t="女"===e.性别,n="男"===e.性别,a=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,r={身高:n?a(170,185):t?a(158,172):a(165,178),体重:n?a(65,80):t?a(45,58):a(55,70),体脂率:n?a(12,18):t?a(18,26):a(15,22),三围:{胸围:n?a(92,105):t?a(80,95):a(85,98),腰围:n?a(75,88):t?a(58,68):a(65,78),臀围:n?a(90,100):t?a(85,98):a(88,95)},外观特征:[],敏感点:[],开发度:{},纹身与印记:[]};if(t){const e=["A","B","C","D","E"];r.罩杯=e[a(0,e.length-1)],r.胸部描述="形状饱满，肤如凝脂",r.私处描述="紧致粉嫩，毛发稀疏",r.生殖器描述="名器天成"}else n?(r.胸部描述="胸肌结实，轮廓分明",r.生殖器描述="尺寸惊人，青筋暴起"):(r.胸部描述="待AI生成",r.生殖器描述="待AI生成");c.身体=r}const{migrated:d}=(0,v.jj)(c);return{saveData:d,processedBaseInfo:n}}(t,a),s=await async function(e,t){console.log("[初始化流程] 2. 生成世界数据");const n=(0,l.useUIStore)();n.updateLoadingText("🌍 世界生成: 准备配置...");const a=(0,c.N)(),r=a.worldGenerationConfig,o=a.selectedWorld;console.log("[世界生成] 用户配置的世界规模:",{主要势力:r.majorFactionsCount,地点总数:r.totalLocations,秘境数量:r.secretRealmsCount,大陆数量:r.continentCount,仅生成大陆:r.generateOnlyContinents});const i=!r.generateOnlyContinents,s=i?r.majorFactionsCount||5:0,d=i?r.totalLocations||12:0,u=i?r.secretRealmsCount||5:0;r.generateOnlyContinents?console.log('[世界生成] ✅ 开启"仅生成大陆"模式，势力、地点和秘境将在局内动态生成'):console.log("[世界生成] 📋 完整世界生成模式，将生成势力、地点和秘境");const m={worldName:o?.name||t.name,worldBackground:o?.description??t.description??void 0,worldEra:o?.era??t.era??void 0,factionCount:s,locationCount:d,secretRealmsCount:u,continentCount:r.continentCount||4,maxRetries:3,retryDelay:2e3,characterBackground:(e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e&&"名称"in e){const t=e.名称;if("string"==typeof t)return t}return String(e??"")})(e.出生),mapConfig:r.mapConfig,onStreamChunk:e=>{n.updateLoadingText(`🌍 世界生成中...\n\n${e.substring(0,150)}...`)}};console.log("[初始化流程] 开始调用世界生成器..."),n.updateLoadingText("🌍 世界生成: 调用AI生成世界架构...");const p=new b.U(m),g=Date.now(),h=await p.generateValidatedWorld(),f=Date.now()-g;if(console.log(`[初始化流程] 世界生成器返回,耗时: ${f}ms`),h.success&&h.worldInfo)return console.log("[初始化流程] 世界生成成功"),n.updateLoadingText("🌍 世界生成: 完成"),h.worldInfo;throw new Error(`世界生成失败：${h.errors?.join(", ")||"未知错误"}`)}(i,n);e.世界||(e.世界={信息:{},状态:{}}),e.世界.信息=s;const d=s.势力信息.find(e=>e.名称?.includes("合欢")||e.name?.includes("合欢"));if(d){const t=d.名称||d.name||"合欢宗",n=d.领导层||d.leadership,r=n&&"object"==typeof n?{...n}:{};if(r.宗主||(r.宗主="合欢老魔"),r.最强修为||(r.最强修为=r.宗主修为||"化神期"),r.圣女||(r.圣女="灰夫人(合欢圣女)",console.log("[角色初始化] ✅ 已补齐合欢宗领导层：圣女=灰夫人(合欢圣女)")),d.领导层=r,d.leadership=r,(0,u.isTavernEnv)()){console.log("[角色初始化] 🎲 触发合欢宗彩蛋：生成灰夫人NPC");const n={名字:"灰夫人(合欢圣女)",性别:"女",出生日期:{年:Math.max(0,a-20),月:1,日:1},种族:"人族",出生:"合欢宗",外貌描述:"身材极度丰满，拥有夸张的丰乳肥臀，腰肢纤细如蛇。面容妖媚，眼神含春，举手投足间散发着惊人的魅惑力。身着轻薄纱衣，曼妙身姿若隐若现。",性格特征:["平易近人","开放","双性恋","M体质","S体质","痴女(潜在)"],境界:{名称:"金丹",阶段:"圆满",当前进度:0,下一级所需:100,突破描述:"阴阳调和，丹破婴生"},灵根:{name:"天阴灵根",tier:"天品"},天赋:[{name:"合欢圣体",description:"天生媚骨，极适合双修，采补效果翻倍"}],先天六司:{根骨:8,灵性:9,悟性:8,气运:7,魅力:10,心性:5},与玩家关系:"陌生人",好感度:10,当前位置:{描述:`${t}驻地`},势力归属:t,人格底线:[],记忆:["我是合欢宗的圣女，人称灰夫人。","我的真实姓名是一个秘密，只有真正征服我的人才能知道。","我渴望体验世间极致的快乐与痛苦，无论是给予还是接受。"],当前外貌状态:"衣衫半解，媚眼如丝",当前内心想法:"观察着周围的人，寻找能让我感兴趣的猎物",背包:{灵石:{下品:5e3,中品:500,上品:50,极品:0},物品:{}},实时关注:!0,私密信息:{是否为处女:!0,身体部位:[{部位名称:"后庭",特征描述:"九曲回廊，紧致幽深，内壁褶皱繁复，仿佛能吞噬一切",敏感度:80,开发度:0,特殊印记:"未开发"},{部位名称:"阴道",特征描述:"春水玉壶，名器天成，常年湿润，紧致如初",敏感度:90,开发度:0,特殊印记:"白虎"},{部位名称:"腰部",特征描述:"七寸盘蛇，柔若无骨，可做出任何高难度姿势",敏感度:70,开发度:0},{部位名称:"手",特征描述:"纤手观音，指若削葱，灵活多变，擅长挑逗",敏感度:60,开发度:0},{部位名称:"足",特征描述:"玲珑鸳鸯，弓足如玉，脚趾圆润可爱，足弓优美",敏感度:85,开发度:0},{部位名称:"嘴",特征描述:"如意鱼唇，樱桃小口，舌头灵活，深喉天赋异禀",敏感度:75,开发度:0},{部位名称:"胸部",特征描述:"乳燕玉峰，波涛汹涌，乳晕粉嫩，乳头敏感易硬",敏感度:95,开发度:0}],性格倾向:"开放且顺从(待调教)",性取向:"双性恋",性癖好:["BDSM","足交","乳交","捆绑","调教","采补","角色扮演","支配","被支配","露出","放尿","凌辱","刑具"],性渴望程度:80,当前性状态:"渴望",体液分泌状态:"充沛",性交总次数:0,性伴侣名单:[],最近一次性行为时间:"无",特殊体质:["合欢圣体","名器合集"]}};e.社交||(e.社交={关系:{},事件:{},记忆:{}}),e.社交.关系||(e.社交.关系={}),e.社交.关系[n.名字]||(e.社交.关系[n.名字]=n)}}console.log("[初始化流程] 2.5 世界已包含在saveData中（新架构跳过酒馆同步）"),console.log("[初始化流程] 世界包含",s.大陆信息?.length||0,"个大陆"),console.log("[初始化流程] 大陆列表:",s.大陆信息?.map(e=>e.名称||e.name).join("、")),console.log("[初始化流程] 准备调用generateOpeningScene..."),console.log("[初始化流程] 使用流式模式:",r),console.log("[初始化流程] 使用生成模式:",o);const{finalSaveData:w}=await async function(e,t,n,a,r=!0,o="generate"){console.log("[初始化流程] 3. 生成开场剧情");const i=(0,l.useUIStore)();i.updateLoadingText("正在为您创建你的专属故事...");const s=(0,c.N)(),d={name:t.名字,gender:t.性别,race:t.种族??"人族",age:a,world:t.世界||n,talentTier:t.天资,origin:t.出生,spiritRoot:t.灵根,talents:t.天赋||[],attributes:t.先天六司||{},difficultyPrompt:s.currentDifficultyPrompt};console.log("[初始化] 🔥 用户选择数据检查:"),console.log("  - 种族:",t.种族,"->",d.race),console.log("  - 天资:",d.talentTier),console.log("  - 出身:",d.origin),console.log("  - 灵根:",d.spiritRoot),console.log("  - 天赋数量:",d.talents?.length),console.log("  - 难度:",s.gameDifficulty);const f=(0,u.isTavernEnv)(),v={worldInfo:e.世界?.信息,availableContinents:e.世界?.信息?.大陆信息?.map(e=>({名称:e.名称,描述:e.描述,大洲边界:e.大洲边界}))||[],availableLocations:e.世界?.信息?.地点信息?.map(e=>({名称:e.name||e.名称,类型:e.type||e.类型,描述:e.description||e.描述,所属势力:e.faction||e.所属势力,coordinates:e.coordinates}))||[],mapConfig:e.世界?.信息?.地图配置,systemSettings:f?(0,m.Md)(e.系统?.配置??{}):e.系统?.配置||{}};console.log("[初始化] 🔥 世界检查:"),console.log("  - 世界描述:",e.世界?.信息?.世界背景||"未找到"),console.log("  - 大陆数量:",v.availableContinents.length),console.log("  - 地点数量:",v.availableLocations.length);const b=await(0,h.IJ)(),y=(0,h.p$)(d,v),k=`我创建了角色"${t.名字}"，请根据我的选择生成开局故事和初始数据。\n\n${y}\n\n**重要提示**：\n- 严格按照我的角色设定来生成内容\n- 我选择的是什么样的出身、天赋、灵根，你就如实展现\n- 不要强加任何预设的剧情方向或生活方式\n- 这只是一个开始，我的人生我做主`;console.log(`[初始化] 准备生成开场剧情，角色: ${t.名字}`),console.log("[初始化] 可用大陆列表:",v.availableContinents.map(e=>e.名称)),console.log("[初始化] 可用地点数量:",v.availableLocations?.length||0);let w="";const E=e=>{w+=e;const t=w.length>300?"..."+w.slice(-300):w;i.updateLoadingText(`正在为您创建你的专属故事...<br/><br/><div style="text-align: left; font-size: 0.9em; opacity: 0.8; white-space: pre-wrap;">${t}</div>`)},N=await async function(e,t,n,a){const r=(0,l.useUIStore)();let o=null,i=0;for(;;){i++;try{i>1&&r.updateLoadingText(`${a} (第 ${i-1} 次重试)`),console.log(`[robustAICall] 正在尝试: ${a}, 第 ${i} 次`);const n=await e();if(console.log(`[robustAICall] 收到响应 for ${a}:`,n),t(n))return console.log(`[robustAICall] 响应验证成功 for ${a}`),n;throw new Error("AI响应格式无效或未通过验证")}catch(e){if(o=e instanceof Error?e:new Error(String(e)),console.warn(`[AI调用重试] 第 ${i} 次尝试失败:`,o.message),i>3){if(await x(a,o.message)){i=0;continue}throw new Error(`${a}失败，用户选择不继续重试: ${o.message}`)}await new Promise(e=>setTimeout(e,1e3*i))}}}(async()=>{console.log("[初始化] ===== 开始生成开场剧情 =====");const e=Date.now();try{const t=g.J,n=await t.generateInitialMessage(b,k,{useStreaming:r,generateMode:o,onStreamChunk:E}),a=Date.now()-e;return console.log(`[初始化] ✅ AI生成完成,耗时: ${a}ms, 流式模式: ${r}, 生成模式: ${o}`),n}catch(e){throw console.error("[初始化] ❌ AI生成失败:",e),e}},e=>{if(console.log("[AI验证-诊断] ===== 开始验证AI响应 ====="),console.log("[AI验证-诊断] 响应类型:",typeof e),console.log("[AI验证-诊断] 响应内容(前500字):",JSON.stringify(e).substring(0,500)),!e||"object"!=typeof e)return console.warn("[AI验证] ❌ 响应不是对象，实际类型:",typeof e),console.warn("[AI验证] 响应内容:",e),!1;if(!e.text||"string"!=typeof e.text)return console.warn("[AI验证] ❌ text字段无效"),console.warn("[AI验证] text值:",e.text),!1;if(e.text.trim().length<200)return console.warn("[AI验证] ❌ 文本太短 (长度:",e.text.length,")"),!1;if(e.text.includes("placeholder")||e.text.includes("TODO")||e.text.includes("待填充"))return console.warn("[AI验证] ❌ 文本包含占位符"),!1;if(!Array.isArray(e.tavern_commands))return console.warn("[AI验证] ❌ tavern_commands不是数组，实际类型:",typeof e.tavern_commands),console.warn("[AI验证] tavern_commands值:",e.tavern_commands),!1;if(0===e.tavern_commands.length)return console.warn("[AI验证] ❌ tavern_commands是空数组"),!1;console.log("[AI验证-诊断] tavern_commands数量:",e.tavern_commands.length);const t=e.tavern_commands.find(e=>!(!e||"set"!==e.action||"角色.位置"!==e.key&&"位置"!==e.key));if(t){const e=t.value;if(!e||"object"!=typeof e)return console.warn("[AI验证] ❌ 位置值不是对象，类型:",typeof e),console.warn("[AI验证] 位置值:",e),!1;const n=e;if(!n.描述||"string"!=typeof n.描述||0===n.描述.trim().length)return console.warn("[AI验证] ❌ 位置描述无效"),console.warn("[AI验证] 描述值:",n.描述),!1;if(n.描述.includes("undefined")||n.描述.includes("null"))return console.warn("[AI验证] ❌ 位置描述包含无效内容:",n.描述),!1;if("number"!=typeof n.x||"number"!=typeof n.y)return console.warn("[AI验证] ❌ 位置坐标无效"),console.warn("[AI验证] x:",n.x,"y:",n.y),!1;console.log("[AI验证] ✅ 位置命令有效:",n.描述,`(${n.x}, ${n.y})`)}else console.warn("[AI验证] ⚠️ 未提供位置命令（将继续流程，后续由默认值/最终校验兜底）");return Array.isArray(e.action_options)?0===e.action_options.length?console.warn("[AI验证] ⚠️ action_options是空数组，将使用默认选项"):console.log("[AI验证] ✅ action_options有效，数量:",e.action_options.length):console.warn("[AI验证] ⚠️ action_options不是数组，将使用默认选项"),console.log("[AI验证] ✅ 所有验证通过"),!0},0,"正在为您创建你的专属故事..."),S=g.J,{saveData:V,stateChanges:_}=await S.processGmResponse(N,e,!0),C=(0,c.N)();if("随机灵根"===C.selectedSpiritRoot?.name&&V.角色?.身份?.灵根){const e=V.角色.身份.灵根;"object"==typeof e&&C.setAIGeneratedSpiritRoot(e)}if("随机出身"===C.selectedOrigin?.name&&V.角色?.身份?.出生){const e=V.角色.身份.出生;"object"==typeof e&&C.setAIGeneratedOrigin(e)}if((0,p.useGameStateStore)().loadFromSaveData(V),!String(N.text||"").trim())throw new Error("AI生成的开场剧情为空");return V.系统?.历史?.叙事&&V.系统.历史.叙事.length>0&&(V.系统.历史.叙事[V.系统.历史.叙事.length-1].stateChanges=_),{finalSaveData:V,aiResponse:N}}(e,i,n,a,r,o);console.log("[初始化流程] generateOpeningScene已返回"),console.log("[初始化流程] 核心属性校准：合并AI修改与初始属性...");const E=k(t,a),N=w.状态||{},S=N.境界&&"object"==typeof N.境界?{名称:N.境界.名称||E.境界.名称,阶段:void 0!==N.境界.阶段?N.境界.阶段:E.境界.阶段,当前进度:void 0!==N.境界.当前进度?N.境界.当前进度:E.境界.当前进度,下一级所需:void 0!==N.境界.下一级所需?N.境界.下一级所需:E.境界.下一级所需,突破描述:N.境界.突破描述||E.境界.突破描述}:E.境界;w.状态={...E,...N,境界:S},console.log("[初始化流程] 核心属性校准完成，境界:",S),console.log("[初始化流程] 准备最终化并同步数据...");const V=await async function(e,t,n,a){console.log("[初始化流程] 4. 合并、验证并同步最终数据");const r=(0,l.useUIStore)();r.updateLoadingText(`正在同步数据，即将进入${t.名字}的修仙世界...`);const o={...e.角色?.身份??{},...t,名字:t.名字,性别:t.性别,种族:t.种族,先天六司:t.先天六司,天赋:t.天赋};if("object"==typeof t.灵根&&t.灵根?.name?.includes("随机")||"string"==typeof t.灵根&&t.灵根.includes("随机")){console.log("[数据最终化] 🎲 用户选择随机灵根，使用AI生成的数据");const n=e.角色?.身份?.灵根;if(o.灵根=n||"随机灵根","string"==typeof o.灵根&&o.灵根.includes("随机")){console.warn("[数据最终化] ⚠️ 警告：AI未能正确替换随机灵根，使用本地数据库生成");const e=t.天资;let n=y.Gr.filter(t=>"废柴"===e.name||"凡人"===e.name?"凡品"===t.tier||"下品"===t.tier:"俊杰"===e.name?"中品"===t.tier||"上品"===t.tier:"天骄"===e.name?"上品"===t.tier||"极品"===t.tier:"妖孽"===e.name?"极品"===t.tier:"凡品"===t.tier||"下品"===t.tier);0===n.length&&(n=y.Gr);const a=n[Math.floor(Math.random()*n.length)];o.灵根=a,console.log(`[数据最终化] ✅ 已从本地数据库生成随机灵根: ${a.name} (${a.tier})`)}}else console.log(`[数据最终化] ✅ 用户选择特定灵根，强制使用用户选择: ${t.灵根?.name}`),o.灵根=t.灵根;if("object"==typeof t.出生&&t.出生?.name?.includes("随机")||"string"==typeof t.出生&&t.出生.includes("随机")){console.log("[数据最终化] 🎲 用户选择随机出身，使用AI生成的数据");const t=e.角色?.身份?.出生;if(o.出生=t||"随机出身","string"==typeof o.出生&&o.出生.includes("随机")){console.warn("[数据最终化] ⚠️ 警告：AI未能正确替换随机出身，使用本地数据库生成");const e=y.yM[Math.floor(Math.random()*y.yM.length)];o.出生=e,console.log(`[数据最终化] ✅ 已从本地数据库生成随机出身: ${e.name}`)}}else console.log(`[数据最终化] ✅ 用户选择特定出身，强制使用用户选择: ${t.出生?.name}`),o.出生=t.出生;const i=function(e){const t={...e},n=(0,c.N)();console.log("[数据校准] 开始从创角仓库同步所有权威数据..."),console.log("[数据校准] 【重要】所有用户手动选择的数据都将被保护，不被AI或代码修改");const a=n.selectedTalentTier;a?(console.log(`[数据校准] ✅ 同步用户选择的天资: ${a.name}`),t.天资=a):console.warn("[数据校准] 警告: 无法找到权威的天资数据。");const r=n.selectedOrigin,o=t.出生&&"object"==typeof t.出生&&"随机出身"!==t.出生.名称;r&&!o?(console.log(`[数据校准] ✅ 同步用户选择的出身: ${r.name}`),t.出生=r):o?console.log("[数据校准] ✅ 保留已生成的具体出身:",t.出生.name):null===n.characterPayload.origin_id?(console.log("[数据校准] 🎲 用户选择随机出身，但无有效生成值，标记为随机"),t.出生="随机出身"):console.warn("[数据校准] 警告: 无法找到权威的出身数据。");const i=n.selectedSpiritRoot,s=t.灵根&&"object"==typeof t.灵根&&"随机灵根"!==t.灵根.名称;i&&!s?(console.log(`[数据校准] ✅ 同步用户选择的灵根: ${i.name} (${i.tier})`),t.灵根=i):s?console.log("[数据校准] ✅ 保留已生成的具体灵根:",t.灵根.name):null===n.characterPayload.spirit_root_id?(console.log("[数据校准] 🎲 用户选择随机灵根，但无有效生成值，标记为随机"),t.灵根="随机灵根"):console.warn("[数据校准] 警告: 无法找到权威的灵根数据。");const l=n.selectedTalents;l&&l.length>0?(console.log(`[数据校准] ✅ 同步用户选择的天赋，共 ${l.length} 个`),t.天赋=l):(console.log("[数据校准] 用户未选择任何天赋，天赋字段设置为空数组。"),t.天赋=[]);const d=n.attributes;return d&&(console.log("[数据校准] ✅ 同步用户分配的先天六司:",d),t.先天六司={根骨:d.root_bone,灵性:d.spirituality,悟性:d.comprehension,气运:d.fortune,魅力:d.charm,心性:d.temperament}),console.log("[数据校准] 权威数据同步完成。"),t}(o);e.角色||(e.角色={}),e.角色.身份=i,console.log("[数据最终化] 重新计算并校准核心玩家状态...");const s=k(t,a),d=e.角色?.属性??e.属性??{},u=e.角色?.位置??e.位置,m=d.境界&&"object"==typeof d.境界?{名称:d.境界.名称||s.境界.名称,阶段:void 0!==d.境界.阶段?d.境界.阶段:s.境界.阶段,当前进度:void 0!==d.境界.当前进度?d.境界.当前进度:s.境界.当前进度,下一级所需:void 0!==d.境界.下一级所需?d.境界.下一级所需:s.境界.下一级所需,突破描述:d.境界.突破描述||s.境界.突破描述}:s.境界;e.属性={境界:m,声望:"number"==typeof d.声望?d.声望:s.声望,气血:d.气血??s.气血,灵气:d.灵气??s.灵气,神识:d.神识??s.神识,寿命:d.寿命??s.寿命},console.log("[数据最终化] 境界合并结果:",m);const p=u;if(!p||"string"!=typeof p.描述||!p.描述.includes("·")){console.error("[数据最终化] ❌ 位置信息无效或丢失"),console.error("[数据最终化-诊断] aiLocation:",p),console.error("[数据最终化-诊断] aiLocation.描述:",p?.描述),console.error("[数据最终化-诊断] 完整saveData keys:",Object.keys(e));const t=e.历史?.叙事||[];if(t.length>0){const e=t[t.length-1];console.error("[数据最终化-诊断] 最后的叙事历史:",JSON.stringify(e).substring(0,500))}throw new Error(`位置信息在处理过程中丢失，aiLocation=${JSON.stringify(p)}`)}e.角色||(e.角色={}),e.角色.位置=p,console.log(`[数据最终化] ✅ 已保留AI生成的位置信息: "${p.描述}"`),console.log("[数据最终化] 核心玩家状态校准完成。"),delete e.状态;const g=e.元数据?.时间??e.时间;if(g){const t={年:g.年-a,月:g.月,日:g.日,小时:0,分钟:0};e.角色||(e.角色={}),e.角色.身份=e.角色.身份||{},e.角色.身份.出生日期=t,console.log(`[数据最终化] 重新计算出生日期: ${t.年}年${t.月}月${t.日}日 (时间${g.年}年 - 开局年龄${a}岁)`);const n=e.社交?.关系??e.关系;n&&Object.keys(n).length>0&&(console.log("[数据最终化] 验证NPC出生日期:"),Object.entries(n).forEach(([e,t])=>{const n=t;if(n.出生日期&&n.年龄){const t=g.年-n.出生日期.年;console.log(`  - ${e}: 出生${n.出生日期.年}年, 声称年龄${n.年龄}岁, 实际年龄${t}岁 ${t===n.年龄?"✅":"❌不匹配"}`)}}))}const h=e.角色?.位置?.描述;if(console.log(`[数据校准] ✅ 位置信息最终确认: "${h}"`),!h||!h.includes("·"))throw console.error("[数据校准] ❌ 位置格式异常，这不应该发生（验证器应该已拦截）"),console.error("[数据校准-诊断] saveData.角色.位置:",e.角色?.位置),new Error(`位置格式验证失败: "${h}"`);const{migrated:b,report:x}=(0,v.jj)(e);x.legacyKeysFound.length>0&&console.log("[数据最终化] 迁移报告 legacyKeysFound:",x.legacyKeysFound);const w=(0,f.zB)(b,{角色:t,模式:"单机"},"creation");if(!w.isValid)throw new Error(`角色数据最终验证失败: ${w.errors.join(", ")}`);const E=b?.角色?.修炼?.修炼功法,N=b?.角色?.背包?.物品??{};if(E?.物品ID&&"string"==typeof E.名称){const e=N[E.物品ID];!e||"功法"!==e.类型||e.名称!==E.名称&&!e.名称||!0!==e.修炼中&&!0!==e.已装备?(console.warn("[数据校准] 检测到无效的“幽灵功法”：角色.修炼.修炼功法 非空，但角色.背包.物品中无对应实体。正在清除无效修炼状态..."),b.角色?.修炼&&(b.角色.修炼.修炼功法=null)):console.log(`[数据校准] 功法一致性校验通过: "${E.名称}"`)}return console.log("[初始化流程] ✅ 角色创建完成（新架构跳过酒馆同步）"),r.updateLoadingText("✅ 角色创建完成！"),console.log("[初始化流程] finalizeAndSyncData即将返回 V3 saveData"),b}(w,t,0,a);return console.log("[初始化流程] 最终化完成"),console.log("[初始化流程] ✅ 角色创建成功！准备返回completedSaveData"),console.log("[初始化流程] completedSaveData类型:",typeof V),console.log("[初始化流程] completedSaveData有效:",!!V),V}catch(e){throw console.error("[初始化流程] ❌ 角色初始化失败：",e),console.error("[初始化流程] 错误堆栈:",e instanceof Error?e.stack:"N/A"),e}finally{console.log("[初始化流程] initializeCharacter函数执行完毕")}}var E=n(9333),N=n(8546),S=n(6939),V=n(8708),_=(n(3943),n(6988));const C={class:"save-migration"},A={class:"migration-meta"},D={class:"meta-item"},T={class:"value"},B={class:"meta-item"},I={class:"value"},z={class:"migration-reasons"},M={class:"reason-list"},P={class:"migration-actions"},R=["disabled"],$=["disabled"],O=(0,a.defineComponent)({__name:"SaveMigrationModal",props:{characterId:{},saveSlot:{},legacyKeysFound:{},onConfirm:{type:Function},onCancel:{type:Function}},setup(e){const t=e,n=(0,a.ref)(!1);let r=!1;const o=async()=>{if(!n.value){n.value=!0;try{r=!0,await(t.onConfirm?.())}finally{n.value=!1}}},i=()=>{n.value||(r=!0,t.onCancel?.())};return(0,a.onBeforeUnmount)(()=>{r||t.onCancel?.()}),(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",C,[t[3]||(t[3]=(0,a.createElementVNode)("div",{class:"migration-header"},[(0,a.createElementVNode)("h4",null,"检测到旧版存档结构"),(0,a.createElementVNode)("p",null,"此存档不符合 V3（5领域：元数据/角色/社交/世界/系统），必须迁移后才能加载。")],-1)),(0,a.createElementVNode)("div",A,[(0,a.createElementVNode)("div",D,[t[0]||(t[0]=(0,a.createElementVNode)("span",{class:"label"},"角色ID",-1)),(0,a.createElementVNode)("span",T,(0,a.toDisplayString)(e.characterId),1)]),(0,a.createElementVNode)("div",B,[t[1]||(t[1]=(0,a.createElementVNode)("span",{class:"label"},"存档槽位",-1)),(0,a.createElementVNode)("span",I,(0,a.toDisplayString)(e.saveSlot),1)])]),(0,a.createElementVNode)("div",z,[t[2]||(t[2]=(0,a.createElementVNode)("div",{class:"reason-title"},"检测到的旧字段",-1)),(0,a.createElementVNode)("div",M,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.legacyKeysFound,e=>((0,a.openBlock)(),(0,a.createElementBlock)("span",{key:e,class:"tag"},(0,a.toDisplayString)(e),1))),128))])]),t[4]||(t[4]=(0,a.createElementVNode)("div",{class:"migration-hint"},[(0,a.createElementVNode)("div",null,"操作会自动："),(0,a.createElementVNode)("ul",null,[(0,a.createElementVNode)("li",null,"先在 IndexedDB 创建一份隐藏备份（不出现在存档列表）"),(0,a.createElementVNode)("li",null,"覆盖写回当前槽位为 V3 新结构存档")])],-1)),(0,a.createElementVNode)("div",P,[(0,a.createElementVNode)("button",{class:"primary",disabled:n.value,onClick:o},(0,a.toDisplayString)(n.value?"正在迁移…":"备份并迁移"),9,R),(0,a.createElementVNode)("button",{class:"secondary",disabled:n.value,onClick:i},"取消",8,$)])]))}});var L=n(5072),F=n.n(L),j=n(7825),U=n.n(j),q=n(7659),G=n.n(q),H=n(5056),Y=n.n(H),W=n(540),X=n.n(W),J=n(1113),K=n.n(J),Z=n(9197),Q={};Q.styleTagTransform=K(),Q.setAttributes=Y(),Q.insert=G().bind(null,"head"),Q.domAPI=U(),Q.insertStyleElement=X(),F()(Z.A,Q),Z.A&&Z.A.locals&&Z.A.locals;const ee=(0,n(6262).A)(O,[["__scopeId","data-v-230bf738"]]);function te(e){return"联机"!==e.模式?null:e.存档列表?.["云端修行"]?e.存档列表["云端修行"]:e.存档?(s.Yz.log("角色商店","⚠️ 检测到旧存档结构，正在迁移到统一结构..."),e.存档列表||(e.存档列表={}),e.存档列表["云端修行"]=e.存档,delete e.存档,s.Yz.log("角色商店",'✅ 旧存档数据已迁移到 存档列表["云端修行"]'),e.存档列表["云端修行"]):null}function ne(e){if(!e)return null;const t=JSON.parse(JSON.stringify(e)),n=t;let a=!1;return n?.系统?.历史&&"object"==typeof n.系统.历史&&"叙事"in n.系统.历史&&(delete n.系统.历史.叙事,a=!0),n?.历史&&"object"==typeof n.历史&&"叙事"in n.历史&&(delete n.历史.叙事,a=!0),"叙事历史"in n&&(delete n.叙事历史,a=!0),"对话历史"in n&&(delete n.对话历史,a=!0),a&&s.Yz.log("角色商店","✅ 已移除叙事历史用于云端同步"),t}const ae=(0,r.nY)("characterV3",()=>{const e=(0,a.ref)({当前激活存档:null,角色列表:{}}),t=(0,a.ref)(null),r=(0,a.ref)(!1),g=async()=>{if(!r.value)try{await d.YK()&&s.Yz.log("角色商店","✅ 数据已迁移到IndexedDB"),e.value=await d.$v();let t=!1;Object.entries(e.value.角色列表).forEach(([e,n])=>{"联机"===n.模式&&n.存档&&!n.存档列表?.["云端修行"]&&(s.Yz.log("角色商店",`🔄 迁移联机角色「${n.角色.名字}」的存档结构`),n.存档列表||(n.存档列表={}),n.存档列表["云端修行"]={...n.存档,存档名:"云端修行"},n.存档列表["上次对话"]||(n.存档列表["上次对话"]={存档名:"上次对话",保存时间:null,存档数据:null}),delete n.存档,t=!0,s.Yz.log("角色商店",`✅ 角色「${n.角色.名字}」存档结构迁移完成`))}),t&&(await d.c5(e.value),s.Yz.log("角色商店","✅ 迁移后的数据已保存")),r.value=!0,s.Yz.log("角色商店","✅ Store初始化完成，数据已加载")}catch(t){s.Yz.error("角色商店","❌ Store初始化失败",t),e.value={当前激活存档:null,角色列表:{}},r.value=!0}};g();const h=(0,a.computed)(()=>Object.values(e.value.角色列表)),f=(0,a.computed)(()=>{const t=e.value.当前激活存档;return t&&e.value.角色列表[t.角色ID]||null}),b=(0,a.computed)(()=>{const t=e.value.当前激活存档,n=f.value;return t&&n?"单机"===n.模式&&n.存档列表?n.存档列表[t.存档槽位]||null:"联机"===n.模式?te(n):null:null}),y=(0,a.computed)(()=>{const e=f.value;if(!e)return[];if("单机"===e.模式&&e.存档列表)return Object.entries(e.存档列表).map(([t,n])=>({...n,id:t,角色名字:n.角色名字||e.角色?.名字||"未知",境界:n.境界||n.存档数据?.属性?.境界?.名称||"凡人",位置:n.位置||n.存档数据?.位置?.描述||"未知",保存时间:n.保存时间||null,最后保存时间:n.最后保存时间??n.保存时间??null,游戏时长:n.游戏时长||0}));if("联机"===e.模式){const t=te(e);if(t)return[{...t,id:"云端修行",角色名字:t.角色名字||e.角色?.名字||"未知",境界:t.境界||t.存档数据?.属性?.境界?.名称||"凡人",位置:t.位置||t.存档数据?.位置?.描述||"未知",保存时间:t.保存时间||null,最后保存时间:t.最后保存时间??t.保存时间??null,游戏时长:t.游戏时长||0}]}return[]}),x=async()=>{try{const t=JSON.parse(JSON.stringify(e.value));Object.values(t.角色列表).forEach(e=>{e.存档列表&&Object.values(e.存档列表).forEach(e=>{delete e.存档数据}),e.存档&&delete e.存档}),await d.c5(t),s.Yz.log("角色商店","✅ 角色元数据已提交到存储"),D(),e.value={...e.value}}catch(e){throw s.Yz.error("角色商店","持久化元数据到IndexedDB失败",e),e}};let C=null;const A=async()=>{if(localStorage.getItem("access_token")&&(0,N.isBackendConfigured)())try{const t=await(async()=>{const t=JSON.parse(JSON.stringify(e.value.角色列表||{})),n={};for(const[e,a]of Object.entries(t)){const t=a?.存档列表?Object.keys(a.存档列表):[];t.length&&(n[e]={},await Promise.all(t.map(async t=>{const a=await d.loadSaveData(e,t);a&&(n[e][t]=a)})))}return{characters:t,saves:n}})();await E.Em.put("/api/v1/user/local-data",t)}catch(e){s.Yz.error("角色商店","同步本地存档数据到后端失败",e)}},D=()=>{localStorage.getItem("access_token")&&(0,N.isBackendConfigured)()&&(C&&clearTimeout(C),C=window.setTimeout(()=>{C=null,A()},1200))},T=async()=>{e.value={当前激活存档:null,角色列表:{}},await d.ag({}),await d.N5(null),await d.Ky()},B=async()=>{e.value=await d.$v(),s.Yz.log("角色商店","已从乾坤宝库重新同步所有数据")},I=async()=>(s.Yz.log("角色商店","syncRootStateToCloud called. (Placeholder - no backend implementation yet)"),Promise.resolve()),z=async(t,a)=>{s.Yz.log("角色商店",`开始加载游戏，角色ID: ${t}, 存档槽: ${a}`);const r=(0,l.useUIStore)(),o=e.value.角色列表[t];if(!o)return s.Yz.error("角色商店","找不到要加载的角色",t),i.o.error("找不到要加载的角色！"),!1;let c;if(c="单机"===o.模式?o.存档列表?.[a]:te(o),!c)return s.Yz.error("角色商店","找不到指定的存档槽位",a),i.o.error("找不到指定的存档槽位！"),!1;const g=te(o),h=g?.云端同步信息?.后端创建失败;if("联机"===o.模式&&(0,N.isBackendConfigured)()&&!h){if(!await(0,E.verifyStoredToken)())return s.Yz.warn("角色商店","联机模式token无效，需要登录"),i.o.warning("联机模式需要登录"),!1;try{const e=await(0,E.NX)(t),n=e?.game_save,r=n?.save_data;if(r){c.存档数据=r,n?.game_time&&"string"==typeof n.game_time&&(c.游戏内时间=n.game_time),n?.world_map&&"object"==typeof n.world_map&&(c.世界地图=n.world_map),await d.dc(t,a,c.存档数据);const e=te(o);e&&(e.云端同步信息={最后同步:n?.last_sync?String(n.last_sync):(new Date).toISOString(),版本:"number"==typeof n?.version?n.version:e.云端同步信息?.版本??1,需要同步:!1},await x()),s.Yz.log("角色商店","联机存档已从云端拉取并缓存到本地")}}catch(e){s.Yz.warn("角色商店","联机存档云端拉取失败，回退本地缓存",e)}}else"联机"===o.模式&&h&&s.Yz.warn("角色商店","检测到后端创建失败标记，跳过云端获取，使用本地缓存");if(!c.存档数据){console.log("=== [诊断日志-loadGame] 从IndexedDB加载 ==="),console.log("[14] 加载Key:",{角色ID:t,存档槽位:a}),s.Yz.log("角色商店",`存档数据不在内存中，从 IndexedDB 加载: ${t}/${a}`);try{const e=await d.loadSaveData(t,a);if(!e)return s.Yz.error("角色商店",`IndexedDB 中不存在存档数据: ${t}/${a}`),i.o.error("存档数据不存在！"),!1;console.log("[15] 从IndexedDB加载的角色.背包.灵石数据:",e.角色?.背包?.灵石),c.存档数据=e,s.Yz.log("角色商店","✅ 已从 IndexedDB 加载存档数据")}catch(e){return s.Yz.error("角色商店","从 IndexedDB 加载存档数据失败",e),i.o.error("加载存档数据失败！"),!1}}if(c.存档数据){const e=(0,v.WI)(c.存档数据);if(e.needsMigration&&!await new Promise(n=>{r.showDetailModal({title:"存档迁移（必须）",component:ee,props:{characterId:t,saveSlot:a,legacyKeysFound:e.legacyKeysFound,onConfirm:async()=>{try{const e=c.存档数据,r=`__backup__${a}__${(new Date).toISOString().replace(/[:.]/g,"-")}`;await d.dc(t,r,e);const{migrated:o,report:l}=(0,v.jj)(e),u=(0,_.$)(o);if(!u.isValid)return console.error("[存档迁移] 迁移后校验失败:",u.errors,l),i.o.error("迁移失败：新结构校验不通过，请查看控制台"),void n(!1);u.warnings.length>0&&console.warn("[存档迁移] 迁移告警:",u.warnings),await d.dc(t,a,o),c.存档数据=o,s.Yz.log("角色商店",`[存档迁移] ✅ 已写回 V3：${t}/${a}`),n(!0)}catch(e){console.error("[存档迁移] ❌ 迁移过程异常:",e),i.o.error("迁移失败：发生异常，请查看控制台"),n(!1)}finally{r.hideDetailModal()}},onCancel:()=>{r.hideDetailModal(),n(!1)}}})}))return i.o.info("已取消迁移，存档未加载"),!1}try{r.startLoading("开始加载存档..."),await(0,u.clearAllCharacterData)(),r.updateLoadingText("世界重置完毕，正在加载存档..."),s.Yz.log("角色商店","设置当前激活存档"),e.value.当前激活存档={角色ID:t,存档槽位:a},await x(),s.Yz.log("角色商店","将存档数据加载到 gameStateStore");const l=(0,p.useGameStateStore)();if(c.存档数据){const e=(0,u.isTavernEnv)()?(0,m.kL)(c.存档数据):c.存档数据;c.存档数据=e,l.loadFromSaveData(e),s.Yz.log("角色商店","✅ 存档数据已加载到 gameStateStore");try{const{vectorMemoryService:e}=await Promise.resolve().then(n.bind(n,5184)),r=`${t}_${a}`;if(await e.init(r),e.isEnabled()){const t=c.存档数据.社交?.记忆?.长期记忆||[];t.length>0&&0===(await e.getStats()).total&&(s.Yz.log("角色商店",`向量记忆库为空，开始导入 ${t.length} 条长期记忆`),await e.importLongTermMemories(t))}}catch(e){console.warn("[角色商店] 初始化向量记忆服务失败（非致命）:",e)}}return s.Yz.log("角色商店","加载完成"),i.o.success(`已成功加载【${o.角色?.名字||"未知角色"}】的存档: ${c.存档名||a}`),!0}catch(e){s.Yz.error("角色商店","加载过程出错",e);const t=e instanceof Error?e.message:"未知错误";return i.o.error(`存档加载失败：${t}`),!1}finally{r.stopLoading()}},M=async t=>{r.value||await g();const n=e.value.当前激活存档,a=f.value,o=b.value,l=(0,p.useGameStateStore)();if(!n||!a||!o)return t?.notifyIfNoActive&&l.isGameLoaded&&i.o.error("没有激活的存档，无法保存！",{id:"save-no-active"}),void s.Yz.warn("角色商店","当前没有激活的存档，跳过保存");const c=`save-game-${Date.now()}`;try{console.log("=== [诊断日志-characterStore] 开始保存游戏 ==="),console.log("[10] 当前激活存档:",{角色ID:n.角色ID,存档槽位:n.存档槽位});const e=l.toSaveData();if(!e)throw new Error("无法生成存档数据，游戏状态不完整。");console.log("[11] toSaveData()返回的角色.背包.灵石数据:",e.角色?.背包?.灵石),(0,S.DT)(e),(0,V.F)(e),e.社交?.关系&&e.元数据?.时间&&Object.values(e.社交.关系).forEach(t=>{t&&"object"==typeof t&&(0,S.UY)(t,e.元数据.时间)}),console.log("[12] 即将保存到IndexedDB的数据:",{角色ID:n.角色ID,存档槽位:n.存档槽位,背包灵石:e.角色?.背包?.灵石}),await d.dc(n.角色ID,n.存档槽位,e),D(),console.log("[13] IndexedDB保存完成"),s.Yz.log("角色商店",`✅ 存档内容已保存到 IndexedDB (Key: ${n.角色ID}_${n.存档槽位})`),o.保存时间=(new Date).toISOString();const t=e.角色?.属性,r=e.角色?.位置;if(o.境界=t?.境界?.名称||"凡人",o.位置=r?.描述||"未知",e.元数据?.时间){const t=e.元数据.时间;o.游戏内时间=`${t.年}年${t.月}月${t.日}日`}if(delete o.存档数据,"单机"===a.模式&&a.存档列表?a.存档列表[n.存档槽位]=o:"联机"===a.模式&&(a.存档列表||(a.存档列表={}),a.存档列表["云端修行"]=o),await x(),"联机"===a.模式){const t=te(a),r=t?.云端同步信息?.后端创建失败;if(r)try{s.Yz.log("角色商店","检测到后端创建失败标记，尝试重新创建角色...");const e={char_id:n.角色ID,base_info:a.角色};await(0,E.OW)(e),t?.云端同步信息&&(t.云端同步信息.后端创建失败=!1),s.Yz.log("角色商店","✅ 后端角色重新创建成功")}catch(e){return void s.Yz.warn("角色商店","后端角色重新创建失败，跳过云端同步",e)}try{const t=o.世界地图??{},r=o.游戏内时间??null,i=ne(e),s=await(0,E.Sj)(n.角色ID,{save_data:i,world_map:t,game_time:r}),l=te(a),c="number"==typeof s?.version?s.version:(l?.云端同步信息?.版本??1)+1;l&&(l.云端同步信息={最后同步:(new Date).toISOString(),版本:c,需要同步:!1}),await x()}catch(e){s.Yz.warn("角色商店","云端同步失败（联机模式）",e);const t=te(a);t&&(t.云端同步信息={最后同步:t.云端同步信息?.最后同步||(new Date).toISOString(),版本:t.云端同步信息?.版本||1,需要同步:!0},await x())}}s.Yz.log("角色商店",`存档【${o.存档名}】元数据已更新`)}catch(e){s.Yz.error("角色商店","存档保存过程出错",e);const t=e instanceof Error?e.message:"未知错误";i.o.error(`存档保存失败：${t}`,{id:c})}},P=async(t,n)=>{console.log("[角色商店-删除存档] 开始删除存档:",{charId:t,slotKey:n});const a=e.value.角色列表[t];if(!a||"单机"!==a.模式||!a.存档列表)return console.warn("[角色商店-删除存档] 无法删除：角色不存在或非单机模式"),void i.o.error("无法删除存档：角色不存在或非单机模式");console.log("[角色商店-删除存档] 当前存档列表:",Object.keys(a.存档列表));const r=Object.entries(a.存档列表).filter(([e,t])=>t&&"上次对话"!==e).length;if(console.log("[角色商店-删除存档] 可删除存档数量:",r),r<=1)return console.warn("[角色商店-删除存档] 最后一个存档不能删除"),void i.o.error("最后一个存档不能删除");const o=a.存档列表?.[n]?.存档名||n;if(!a.存档列表?.[n])return console.warn("[角色商店-删除存档] 存档不存在:",n),void i.o.error(`存档【${o}】不存在`);const l=e.value.当前激活存档;if(l?.角色ID===t&&l?.存档槽位===n){console.log("[角色商店-删除存档] 删除的是当前激活存档，清理酒馆环境");try{await(0,u.clearAllCharacterData)(),i.o.info((0,u.isTavernEnv)()?"当前存档已激活，同步清理酒馆环境变量。":"当前存档已激活，已清理环境变量。")}catch(e){s.Yz.error("角色商店","删除激活存档时清理酒馆数据失败",e),i.o.error((0,u.isTavernEnv)()?"清理酒馆环境变量失败，建议刷新页面。":"清理环境变量失败，建议刷新页面。")}e.value.当前激活存档=null}try{console.log(`[角色商店-删除存档] 从 IndexedDB 删除存档: ${t}/${n}`),await d.Jx(t,n),console.log("[角色商店-删除存档] ✅ IndexedDB 存档数据已删除")}catch(e){console.error("[角色商店-删除存档] 删除 IndexedDB 存档数据失败:",e),i.o.warning("清理存档数据时出现错误")}console.log("[角色商店-删除存档] 执行 delete 操作"),delete a.存档列表[n],a.存档列表={...a.存档列表},console.log("[角色商店-删除存档] 删除后存档列表:",Object.keys(a.存档列表)),console.log("[角色商店-删除存档] 开始保存到 IndexedDB"),await x(),console.log("[角色商店-删除存档] IndexedDB 保存完成");try{await I(),s.Yz.log("角色商店","删除存档后已同步到云端")}catch(e){s.Yz.error("角色商店","删除存档后同步云端失败",e)}i.o.success("存档已删除"),console.log("[角色商店-删除存档] 删除存档完成")};return{rootState:e,initialized:r,allCharacterProfiles:h,activeCharacterProfile:f,activeSaveSlot:b,saveSlots:y,initializeStore:g,reloadFromStorage:B,createNewCharacter:async t=>{const n=(0,l.useUIStore)(),a=(0,c.N)(),{charId:r,baseInfo:o,world:g,mode:h,age:f}=t;if(e.value.角色列表[r])return void i.o.error(`角色ID ${r} 已存在，创建失败！`);const v={...o,世界:a.selectedWorld,天资:a.selectedTalentTier,出生:a.selectedOrigin||"随机出身",灵根:a.selectedSpiritRoot||"随机灵根",天赋:a.selectedTalents,后天六司:o.后天六司||{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}};s.Yz.log("角色商店","构建权威创角信息:",v);try{n.updateLoadingText("即将开始角色创建..."),await(0,u.clearAllCharacterData)();let t=!1;if("联机"===h)try{n.updateLoadingText("正在向云端提交角色信息...");const e={char_id:r,base_info:v};s.Yz.log("角色商店","向后端提交的数据",e);const a=await(0,E.OW)(e);s.Yz.log("角色商店","后端返回结果",a),n.updateLoadingText("角色信息已成功提交至云端！"),t=!0}catch(e){s.Yz.error("角色商店","向后端提交失败",e),i.o.warning("向云端提交角色信息失败，将继续本地创建流程"),t=!1}console.log("[角色商店] 准备调用initializeCharacter...");let o,l=null;try{console.log("[角色商店] 调用initializeCharacter,参数:",{charId:r,baseInfo:v,world:g.name,age:f,useStreaming:a.useStreamingStart,generateMode:a.generateMode}),l=await w(0,v,g,f,a.useStreamingStart,a.generateMode),console.log("[角色商店] ✅ initializeCharacter返回成功,数据有效:",!!l)}catch(e){if(console.error("[角色商店] ❌ initializeCharacter失败:",e),"单机"!==h)throw e;console.log("[角色商店] 穿越异世界,尝试离线初始化..."),l=await async function(e,t,n,a){console.log("[离线初始化] 开始执行本地角色创建..."),t.后天六司||(t.后天六司={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0},console.log("[离线初始化] 初始化后天六司为全0"));const r=k(t,a);r.位置={描述:"临时位置（等待AI初始化）",x:115,y:35};const o=(new Date).toISOString(),i={元数据:{版本号:3,存档ID:`save_${e}_${Date.now()}`,存档名:`${t.名字}（离线开局）`,创建时间:o,更新时间:o,游戏时长秒:0,时间:{年:1e3,月:1,日:1,小时:8,分钟:0}},角色:{身份:t,属性:{境界:r.境界,声望:r.声望,气血:r.气血,灵气:r.灵气,神识:r.神识,寿命:r.寿命},位置:r.位置,效果:[],背包:{灵石:{下品:10,中品:0,上品:0,极品:0},物品:{consumable_xinshou_danyao_01:{物品ID:"consumable_xinshou_danyao_01",名称:"新手丹药",类型:"其他",数量:3,品质:{quality:"凡",grade:1},描述:"一颗普通的丹药，能恢复少量气血。"},equipment_cubuyi_01:{物品ID:"equipment_cubuyi_01",名称:"粗布衣",类型:"装备",数量:1,品质:{quality:"凡",grade:1},描述:"一件朴素的粗布衣服，能提供微不足道的防御。"}}},装备:{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},功法:{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},修炼:{修炼功法:null,修炼状态:{模式:"未修炼"}},大道:{大道列表:{}},技能:{掌握技能:[],装备栏:[],冷却:{}}},社交:{关系:{},宗门:null,事件:{配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},记忆:{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}},世界:{信息:{世界名称:n.name,大陆信息:[],势力信息:[],地点信息:[],生成时间:o,世界背景:n.description??"",世界纪元:n.era||"未知纪元",特殊设定:[],版本:"offline-1.1"},状态:{}},系统:{配置:{规则:{属性上限:{先天六司:{每项上限:10}}},提示:["系统规则：先天六司每项上限为10（NPC同样适用），如超限需裁剪至上限。","系统会根据时间自动计算当前年龄，无需手动更新寿命.当前字段。"]},缓存:{掌握技能:[]},历史:{叙事:[]},扩展:{离线初始化:{初始年龄:a,开局时间:{年:1e3-a,月:1,日:1,小时:8,分钟:0}}},联机:{模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"}}};return console.log("[离线初始化] 本地角色创建完成:",i),i}(r,v,g,f)}if((0,u.isTavernEnv)()&&l&&(l=(0,m.kL)(l)),"单机"===h){const e=(new Date).toISOString();o={模式:"单机",角色:l?.角色?.身份||v,存档列表:{存档1:{存档名:"存档1",保存时间:e,游戏内时间:"修仙元年 春",角色名字:v.名字,境界:"凡人",位置:"未知",修为进度:0,存档数据:l},上次对话:{存档名:"上次对话",保存时间:null,存档数据:null}}}}else{const e=(new Date).toISOString();o={模式:"联机",角色:l?.角色?.身份||v,存档列表:{云端修行:{存档名:"云端修行",保存时间:e,游戏内时间:"修仙元年 春",角色名字:v.名字,境界:"凡人",位置:"未知",修为进度:0,存档数据:l,云端同步信息:{最后同步:t?e:"",版本:1,需要同步:!t,后端创建失败:!t}},上次对话:{存档名:"上次对话",保存时间:null,存档数据:null}}}}e.value.角色列表[r]=o;const c="单机"===h?"存档1":"云端修行";if(e.value.当前激活存档={角色ID:r,存档槽位:c},await(async t=>{const n=e.value.角色列表[t];if(!n)throw new Error(`[存档核心] 无法找到ID为 ${t} 的角色档案`);const a=b.value;if(a&&a.存档数据)try{const t=e.value.当前激活存档;if(!t)throw new Error("[存档核心] 没有激活的存档");s.Yz.log("角色商店","保存存档数据到 IndexedDB"),await d.dc(t.角色ID,t.存档槽位,a.存档数据),D(),delete a.存档数据,s.Yz.log("角色商店",`✅ 已将【${n.角色.名字}】的存档保存至 IndexedDB`)}catch(e){throw s.Yz.error("角色商店","保存角色存档失败",e),i.o.error("保存角色存档失败，请检查控制台。"),e}else s.Yz.warn("角色商店",`角色 ${t} 没有可用的存档数据来保存`)})(r),await x(),(0,p.useGameStateStore)().loadFromSaveData(l),s.Yz.log("角色商店","✅ 初始存档已加载到 gameStateStore"),"联机"===h&&t)try{n.updateLoadingText("正在同步初始存档到云端...");const e={save_data:ne(l),world_map:{},game_time:"修仙元年 春"};s.Yz.log("角色商店","准备同步到云端的初始存档数据",e),await(0,E.Sj)(r,e),n.updateLoadingText("初始存档已成功同步到云端！")}catch(e){s.Yz.warn("角色商店","同步初始存档数据到云端失败",e);const t=e instanceof Error?e.message:"未知错误";i.o.warning(`云端同步失败(后端未启动): ${t}`)}else"联机"!==h||t||s.Yz.warn("角色商店","后端创建角色失败，跳过初始存档同步");return v}catch(e){s.Yz.error("角色商店","角色创建失败",e);const t=e instanceof Error?e.message:String(e);throw new Error(`角色创建失败: ${t}`)}},deleteCharacter:async t=>{if(console.log("[角色商店-删除] 开始删除角色:",t),console.log("[角色商店-删除] 删除前角色列表:",Object.keys(e.value.角色列表)),!e.value.角色列表[t])return void console.warn("[角色商店-删除] 角色不存在，无法删除");const n=e.value.角色列表[t]?.角色.名字||t;e.value.当前激活存档?.角色ID===t&&(console.log("[角色商店-删除] 删除的是当前激活角色，重置 gameStateStore"),(0,p.useGameStateStore)().resetState(),e.value.当前激活存档=null);try{console.log("[角色商店-删除] 开始清理 IndexedDB 中的所有存档数据...");const e=await d.Wj(t);console.log(`[角色商店-删除] ✅ 已清理 ${e} 个存档记录`)}catch(e){console.error("[角色商店-删除] 清理 IndexedDB 存档数据失败:",e),i.o.warning("清理存档数据时出现错误，部分数据可能未删除")}console.log("[角色商店-删除] 执行 delete 操作"),delete e.value.角色列表[t],console.log("[角色商店-删除] 删除后角色列表:",Object.keys(e.value.角色列表)),console.log("[角色商店-删除] 开始保存到 IndexedDB"),await x(),console.log("[角色商店-删除] IndexedDB 保存完成");try{await I(),s.Yz.log("角色商店","删除角色后已同步到云端")}catch(e){s.Yz.warn("角色商店","删除角色后同步云端失败（后端未启动）:",e)}i.o.success(`角色【${n}】已从本地数据库删除。`),console.log("[角色商店-删除] 删除角色完成")},deleteNpc:async e=>{const t=(0,p.useGameStateStore)(),n=t.relationships;if(!n){const e="无法删除NPC：没有激活的存档或关系数据。";throw i.o.error(e),new Error(e)}const a=Object.keys(n).find(t=>n[t]?.名字===e);if(!a){const t=`找不到名为 ${e} 的NPC。`;throw i.o.error(t),new Error(t)}const r={...n[a]};try{console.log("[删除NPC-调试] 删除前 gameStateStore.relationships 的引用:",t.relationships===n),console.log("[删除NPC-调试] 删除前 relationships 中的NPC列表:",Object.keys(n).map(e=>n[e]?.名字)),delete n[a],console.log(`[删除NPC-调试] 已从内存中删除NPC: ${e}`),console.log("[删除NPC-调试] 删除后 relationships 中的NPC数量:",Object.keys(n).length),console.log("[删除NPC-调试] 删除后是否还存在该NPC:",!!n[a]),console.log("[删除NPC-调试] 删除后 gameStateStore.relationships 中是否还存在:",!!t.relationships?.[a]),console.log("[删除NPC-调试] 删除后 relationships 中的NPC列表:",Object.keys(n).map(e=>n[e]?.名字)),s.Yz.log("角色商店",`已从 gameStateStore 中删除NPC: ${e}`),console.log("[删除NPC-调试] 开始保存到存储..."),await t.saveGame(),console.log("[删除NPC-调试] 保存完成");const r=t.toSaveData();if(r?.社交?.关系){const t=Object.values(r.社交.关系).some(t=>t?.名字===e);console.log("[删除NPC-调试] toSaveData() 返回的数据中是否还存在该NPC:",t),console.log("[删除NPC-调试] toSaveData() 返回的关系数量:",Object.keys(r.社交.关系).length),console.log("[删除NPC-调试] toSaveData() 返回的NPC列表:",Object.values(r.社交.关系).map(e=>e?.名字))}s.Yz.log("角色商店",`✅ NPC ${e} 已成功删除并保存`),i.o.success(`NPC【${e}】已成功删除。`)}catch(t){throw s.Yz.error("角色商店",`删除NPC ${e} 后保存失败`,t),n[a]=r,s.Yz.log("角色商店",`已回滚 gameStateStore 中的NPC删除操作: ${e}`),i.o.error(`删除NPC失败: ${t instanceof Error?t.message:"未知错误"}`),t}},deleteSave:P,deleteSaveById:async t=>{const n=e.value.当前激活存档?.角色ID;if(n)return P(n,t);i.o.error("无法确定角色ID")},createNewSave:async(t,n)=>{const a=e.value.角色列表[t];a&&"单机"===a.模式?(a.存档列表||(a.存档列表={}),a.存档列表[n]?i.o.error("存档名称已存在"):(a.存档列表[n]={存档名:n,保存时间:null,存档数据:null},await x(),i.o.success(`存档【${n}】已创建`))):i.o.error("无法创建存档：角色不存在或非单机模式")},saveAsNewSlot:async t=>{const n=e.value.当前激活存档,a=f.value;if(!n||!a)return i.o.error("没有激活的游戏进度"),null;if("单机"!==a.模式)return i.o.error("联机模式不支持多存档"),null;if(a.存档列表||(a.存档列表={}),a.存档列表[t])return i.o.error("存档名称已存在"),null;try{const e=(0,p.useGameStateStore)().toSaveData();if(!e)return i.o.error("无法获取当前游戏状态"),null;const r=(new Date).toISOString(),o=e.角色?.属性,l=e.角色?.位置,c={存档名:t,保存时间:r,角色名字:e.角色?.身份?.名字,境界:o?.境界?.名称||"凡人",位置:l?.描述||"未知",存档数据:JSON.parse(JSON.stringify(e))};if(o?.境界&&o.境界.下一级所需>0&&(c.修为进度=Math.floor(o.境界.当前进度/o.境界.下一级所需*100)),e.元数据?.时间){const t=e.元数据.时间;c.游戏内时间=`${t.年}年${t.月}月${t.日}日`}return a.存档列表[t]=c,await d.dc(n.角色ID,t,e),await x(),i.o.success(`已另存为新存档：${t}`),s.Yz.log("角色商店",`已创建新存档槽位: ${t}`),t}catch(e){return s.Yz.error("角色商店","另存为新存档失败",e),i.o.error("另存为新存档失败"),null}},saveToSlot:async t=>{const n=e.value.当前激活存档,a=f.value;if(!n||!a){const e=`没有激活的角色，无法保存到 ${t}`;throw s.Yz.error("角色商店",`[saveToSlot] ${e}`),console.error(`[saveToSlot] ${e}`,{active:n,profile:a}),new Error(e)}if("单机"!==a.模式){const e=`联机模式不支持多存档，无法保存到 ${t}`;throw s.Yz.warn("角色商店",`[saveToSlot] ${e}`),console.warn(`[saveToSlot] ${e}`,{模式:a.模式}),new Error(e)}a.存档列表||(a.存档列表={});try{const e=(0,p.useGameStateStore)().getCurrentSaveData();if(!e)throw new Error("无法获取当前存档数据");try{(0,S.DT)(e),e.社交?.关系&&e.元数据?.时间&&Object.values(e.社交.关系).forEach(t=>{t&&"object"==typeof t&&(0,S.UY)(t,e.元数据.时间)})}catch(e){s.Yz.warn("角色商店","[saveToSlot] 自动更新年龄失败（非致命）:",e)}const r=e.角色?.属性,o=e.角色?.位置,i=(new Date).toISOString(),l=a.存档列表;l[t],console.log(`[saveToSlot] 保存到槽位 "${t}"`,{角色ID:n.角色ID,角色名:a.角色?.名字,当前激活槽位:n.存档槽位,目标槽位:t,说明:"特殊存档不受当前激活存档影响，始终保存到角色级别"});const c={存档名:t,保存时间:i,存档数据:e,角色名字:e.角色?.身份?.名字,境界:r?.境界?.名称||"凡人",位置:o?.描述||"未知",修为进度:0,游戏内时间:void 0};if(r?.境界&&r.境界.下一级所需>0&&(c.修为进度=Math.floor(r.境界.当前进度/r.境界.下一级所需*100)),e.元数据?.时间){const t=e.元数据.时间;c.游戏内时间=`${t.年}年${t.月}月${t.日}日`}l[t]=c,await d.dc(n.角色ID,t,e),D(),await x(),s.Yz.log("角色商店",`✅ 已保存到存档槽位: ${t}`)}catch(e){throw s.Yz.error("角色商店",`保存到槽位 ${t} 失败`,e),e}},renameSave:async(t,n,a)=>{const r=e.value.角色列表[t];if(!r||"单机"!==r.模式||!r.存档列表)return void i.o.error("无法重命名存档：角色不存在或非单机模式");const o=r.存档列表[n];if(!o)return void i.o.error("要重命名的存档不存在");if(a===n)return o.存档名=a,await x(),void i.o.success("存档名称已更新");if(r.存档列表[a])return void i.o.error("新存档名称已存在");r.存档列表[a]={...o,存档名:a};const s=e.value.当前激活存档;s?.角色ID===t&&s?.存档槽位===n&&(e.value.当前激活存档={角色ID:t,存档槽位:a}),delete r.存档列表[n],await x(),i.o.success(`存档已重命名为【${a}】`)},loadGame:z,loadGameById:async t=>{const n=f.value;if(!n)return i.o.error("没有激活的角色"),!1;const a=e.value.当前激活存档?.角色ID;return a?"单机"===n.模式?await z(a,t):await z(a,"存档"):(i.o.error("无法确定角色ID"),!1)},saveCurrentGame:M,updateSaveDataDirectly:async t=>{const n=e.value.当前激活存档,a=f.value,r=b.value;if((0,p.useGameStateStore)(),!(n&&a&&r&&t))return void s.Yz.warn("角色商店","[直接更新] 缺少必要参数，跳过更新");const o=n.角色ID,i=n.存档槽位;s.Yz.log("角色商店","[直接更新] 开始更新存档数据到Store...");const l=r.存档数据?.历史?.叙事;if(l&&Array.isArray(l)&&l.length>0&&(t.历史={...t.历史??{},叙事:l},s.Yz.log("角色商店",`[直接更新] 保留本地叙事历史数据 (${l.length}条)`)),"单机"===a.模式&&a.存档列表)e.value.角色列表[o].存档列表={...a.存档列表,[i]:{...a.存档列表[i],存档数据:t,保存时间:(new Date).toISOString()}};else if("联机"===a.模式){a.存档列表||(a.存档列表={});const n=te(a);e.value.角色列表[o].存档列表["云端修行"]={...n||{存档名:"云端修行"},存档数据:t,保存时间:(new Date).toISOString()}}await x(),s.Yz.log("角色商店","✅ [直接更新] 存档数据已更新到Store并持久化")},updateCharacterData:async t=>{const n=e.value.当前激活存档,r=f.value,i=b.value;if(!i?.存档数据||!n||!r)return void s.Yz.warn("角色商店","没有激活的存档，无法更新角色数据");const l=[];if(t?.changes)for(const e of t.changes)l.push(e.key),(0,o.set)(i.存档数据,e.key,e.newValue);const c=n.角色ID,d=n.存档槽位;if("单机"===r.模式&&r.存档列表)e.value.角色列表[c].存档列表={...r.存档列表,[d]:{...r.存档列表[d],存档数据:(0,o.cloneDeep)(i.存档数据),保存时间:(new Date).toISOString()}};else if("联机"===r.模式){r.存档列表||(r.存档列表={});const t=te(r);e.value.角色列表[c].存档列表["云端修行"]={...t||{存档名:"云端修行"},存档数据:(0,o.cloneDeep)(i.存档数据),保存时间:(new Date).toISOString()}}(0,a.triggerRef)(e),await x(),l.length>0&&(await(async()=>{const t=e.value.当前激活存档,n=f.value,r=b.value;if((0,p.useGameStateStore)(),t&&n&&r?.存档数据)try{try{const e=(0,S.DT)(r.存档数据);s.Yz.log("角色商店",`[同步] 自动更新玩家年龄: ${e}岁`);const t=r.存档数据?.社交?.关系,n=r.存档数据?.元数据?.时间;if(t&&"object"==typeof t&&n){let e=0;Object.entries(t).forEach(([t,a])=>{const o=a;if(o&&"object"==typeof o)if(o.名字)try{r.存档数据&&((0,S.UY)(o,n),e++)}catch(e){s.Yz.warn("角色商店",`[同步] 更新NPC ${o.名字} 年龄失败:`,e)}else s.Yz.warn("角色商店",`[同步] 跳过缺少名字的NPC: ${t}`);else s.Yz.warn("角色商店",`[同步] 跳过无效的NPC数据: ${t}`)}),s.Yz.log("角色商店",`[同步] 自动更新${e}个NPC年龄`)}}catch(e){s.Yz.warn("角色商店","[同步] 自动更新年龄失败（非致命）:",e)}s.Yz.log("角色商店","[同步] 直接保存到 IndexedDB（架构已重构）"),r.保存时间=(new Date).toISOString(),r.角色名字=r.存档数据.角色?.身份?.名字;const o=r.存档数据.角色?.属性??null,i=r.存档数据.角色?.位置??null;if(o&&(r.境界=o.境界?.名称||"凡人","object"==typeof o.境界&&null!==o.境界)){const e=o.境界;e.下一级所需>0&&(r.修为进度=Math.floor(e.当前进度/e.下一级所需*100))}r.位置=i?.描述||"未知";const l=r.存档数据?.元数据?.时间;l&&(r.游戏内时间=`${l.年}年${l.月}月${l.日}日`),"单机"===n.模式&&n.存档列表?e.value.角色列表[t.角色ID].存档列表={...n.存档列表,[t.存档槽位]:{...r}}:"联机"===n.模式&&(e.value.角色列表[t.角色ID].存档={...r}),(0,a.triggerRef)(e),await x(),s.Yz.log("角色商店","[同步] 数据已保存到本地，元数据已更新")}catch(e){throw s.Yz.error("角色商店","[同步] 保存到本地存储失败",e),e}else s.Yz.warn("角色商店","[同步] 没有激活的存档数据")})(),s.Yz.log("角色商店",`✅ 角色数据已更新并增量同步 ${l.length} 个字段`,l))},loadSaves:async()=>{B()},importSave:async(t,n)=>{const a=e.value.角色列表[t];if(!a)return void i.o.error("找不到角色，无法导入存档");if("单机"!==a.模式)return void i.o.error("联机模式不支持存档导入");a.存档列表||(a.存档列表={});let r=n.存档名||"导入存档",l=1;for(;a.存档列表[r];)r=`${n.存档名||"导入存档"}_${l}`,l++;if(n.存档数据){const e=(0,u.isTavernEnv)()?(0,m.kL)(n.存档数据):n.存档数据,a=(0,v.ru)(e)?e:(0,v.jj)(e).migrated,l=(0,_.$)(a);if(!l.isValid)return console.error("[导入存档] V3校验失败:",l.errors),void i.o.error(`导入失败：存档结构不合法（${l.errors[0]||"未知原因"}）`);await d.dc(t,r,a);const c=a?.角色?.属性,p=a?.角色?.位置;n={...n,角色名字:n.角色名字??a?.角色?.身份?.名字,境界:n.境界??c?.境界?.名称,位置:n.位置??p?.描述,游戏内时间:n.游戏内时间??(()=>{const e=a?.元数据?.时间;return e?`${e.年}年${e.月}月${e.日}日`:void 0})(),存档数据:(0,o.cloneDeep)(a)},s.Yz.log("角色商店",`✅ 已将导入的存档数据保存到 IndexedDB: ${t}/${r}`)}a.存档列表[r]={...n,存档名:r},await x(),i.o.success(`存档【${r}】导入成功`)},clearAllSaves:async()=>{const t=f.value,n=e.value.当前激活存档?.角色ID;if(t&&n){if("单机"===t.模式&&t.存档列表)t.存档列表={};else if("联机"===t.模式){const e=te(t);e&&(e.存档数据=null,e.保存时间=null)}e.value.当前激活存档=null,await x(),i.o.success("所有存档已清空")}else i.o.error("没有激活的角色")},exitGameSession:async()=>{if(!e.value.当前激活存档)return;const t=(0,l.useUIStore)();try{t.startLoading("正在退出游戏..."),await(0,u.clearAllCharacterData)(),e.value.当前激活存档=null,await x(),i.o.success((0,u.isTavernEnv)()?"已成功退出游戏，酒馆环境已重置。":"已成功退出游戏。")}catch(e){s.Yz.error("角色商店","退出游戏会话失败",e),i.o.error("退出游戏失败，建议刷新页面以确保环境纯净。")}finally{t.stopLoading()}},rollbackToLastConversation:async()=>{const t=f.value,n=e.value.当前激活存档;if(!t||!n||"单机"!==t.模式||!t.存档列表)throw new Error("无法执行回滚：无效的存档状态");let r=t.存档列表["上次对话"];if(!r||!r.存档数据){s.Yz.log("角色商店",'从IndexedDB加载"上次对话"存档数据');const e=await d.loadSaveData(n.角色ID,"上次对话");if(!e)throw new Error('没有可用于回滚的"上次对话"存档。请确保已启用"对话前自动备份"功能。');r?r.存档数据=e:(r={id:"上次对话",存档名:"上次对话",角色名字:e.角色?.身份?.名字||t.角色?.名字||"未知",境界:"未知",位置:"未知",保存时间:(new Date).toISOString(),存档数据:e},t.存档列表["上次对话"]=r)}const o=r.存档数据;if(!o)throw new Error('没有可用于回滚的"上次对话"存档。请确保已启用"对话前自动备份"功能。');const i=t.存档列表[n.存档槽位];if(!i)throw new Error(`找不到当前激活的存档槽位: ${n.存档槽位}`);const l=JSON.parse(JSON.stringify(o));i.存档数据=l,i.保存时间=(new Date).toISOString();const c=l.角色?.属性,u=l.角色?.位置;if(i.境界=c?.境界?.名称||"凡人",i.位置=u?.描述||"未知",l.元数据?.时间){const e=l.元数据.时间;i.游戏内时间=`${e.年}年${e.月}月${e.日}日`}"单机"===t.模式&&t.存档列表&&(e.value.角色列表[n.角色ID].存档列表={...t.存档列表,[n.存档槽位]:{...i}}),(0,a.triggerRef)(e),await d.dc(n.角色ID,n.存档槽位,l),await x(),(0,p.useGameStateStore)().loadFromSaveData(l),s.Yz.log("角色商店","✅ 已成功回滚到上次对话前的状态")},commitMetadataToStorage:x,saveLocalDataToBackend:A,loadLocalDataFromBackend:async()=>{if(!localStorage.getItem("access_token")||!(0,N.isBackendConfigured)())return!1;try{const t=await E.Em.get("/api/v1/user/local-data");if(!t||!t.characters||!t.saves)return!1;await T(),e.value.角色列表=t.characters||{},e.value.当前激活存档=null,await d.ag(e.value.角色列表),await d.N5(null);for(const[e,n]of Object.entries(t.saves||{}))for(const[t,a]of Object.entries(n||{}))await d.dc(e,t,a);return await x(),!0}catch(e){return s.Yz.error("角色商店","从后端导入本地存档数据失败",e),!1}},clearLocalCharacterData:T,repairCharacterDataWithAI:async(t,n)=>{const a=(0,l.useUIStore)(),r=e.value.角色列表[t];if(!r)return void i.o.error("修复失败：找不到角色");let o;if(o="单机"===r.模式?r.存档列表?.[n]:r.存档,o&&o.存档数据)try{a.startLoading("AI正在分析存档结构，请稍候...");const e=(c=o.存档数据,`\n# 任务：修复游戏数据\n\n你需要修复以下损坏的游戏数据，使其符合类型定义要求。\n\n## 类型定义\n${JSON.stringify({},null,2)}\n\n## 损坏的数据\n${JSON.stringify(c,null,2)}\n\n## 修复要求\n1. 补全缺失的必填字段\n2. 修正错误的数据类型\n3. 填充合理的默认值\n4. 保持现有正确数据不变\n\n## 输出格式\n返回修复后的完整JSON对象。\n`.trim()),l=(0,u.getTavernHelper)();if(!l)throw new Error("酒馆连接不可用");a.updateLoadingText("天道正在推演修复方案...");const d=await l.generate({user_input:e,overrides:{temperature:.7,max_context_length:8e3,max_length:2048}});if(!d)throw new Error("AI未能生成修复指令");let m=[];try{const e=d.replace(/```json/g,"").replace(/```/g,"").trim(),t=JSON.parse(e);if(!t.tavern_commands||!Array.isArray(t.tavern_commands))throw new Error("AI响应中缺少有效的 tavern_commands 数组");m=t.tavern_commands}catch(e){throw s.Yz.error("角色商店","解析AI修复指令失败",{error:e,response:d}),new Error("解析AI修复指令失败")}if(0===m.length)return i.o.info("AI分析认为当前存档无需修复。"),void await z(t,n);a.updateLoadingText(`AI已生成 ${m.length} 条修复指令，正在应用...`);const p=await(async(e,t,n)=>{const a=[],r=(e,t,n)=>{const a=t.split(".");let r=e;for(let e=0;e<a.length-1;e++)void 0!==r[a[e]]&&"object"==typeof r[a[e]]||(r[a[e]]={}),r=r[a[e]];r[a[a.length-1]]=n};for(const o of n)try{const{action:n,key:i,value:l}=o;if(!n||!i){a.push(`无效指令: ${JSON.stringify(o)}`);continue}let c,d;i.startsWith("character.profile.")?(c=t,d=i.substring(18)):(c=e,d=i),"set"===n?(r(c,d,l),s.Yz.log("AI修复",`执行 set: ${i} =`,l)):s.Yz.warn("AI修复",`暂不支持的指令 action: ${n}`)}catch(e){a.push(`执行指令失败: ${JSON.stringify(o)}`),s.Yz.error("AI修复","执行指令时出错",e)}return a})(o.存档数据,r,m);p.length>0&&(s.Yz.error("角色商店","执行AI修复指令时出错",p),i.o.error(`部分修复指令执行失败: ${p.join(", ")}`)),o.保存时间=(new Date).toISOString(),await x(),i.o.success("AI已完成存档修复！正在重新加载游戏..."),await new Promise(e=>setTimeout(e,500)),await z(t,n)}catch(e){s.Yz.error("角色商店","AI修复存档失败",e),i.o.error(`存档修复失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{a.stopLoading()}else i.o.error("修复失败：找不到存档数据");var c},initialCreationStateChanges:t,setInitialCreationStateChanges:e=>{s.Yz.log("角色商店","暂存初始角色创建的状态变更",e),t.value=e},consumeInitialCreationStateChanges:()=>{const e=t.value;return e&&(s.Yz.log("角色商店","消费初始状态变更日志",e),t.value=null),e},equipTechnique:async e=>{const t=(0,p.useGameStateStore)(),n=t.getCurrentSaveData();if(!n)return void i.o.error("存档数据不存在");const a=n.角色?.背包?.物品?.[e];if(!a||"功法"!==a.类型)return void i.o.error("要装备的物品不是一个有效的功法");if(console.log("[角色商店-调试] 装备功法前的数据:",{功法名称:a.名称,品质字段存在:!!a.品质,品质内容:a.品质,完整物品数据:a}),Object.values(n.角色?.背包?.物品??{}).forEach(e=>{"功法"===e.类型&&(e.已装备=!1)}),a.已装备=!0,void 0!==a.修炼进度&&null!==a.修炼进度||(a.修炼进度=0,s.Yz.log("角色商店","初始化功法修炼进度为 0")),a.已解锁技能||(a.已解锁技能=[]),a.功法技能&&Array.isArray(a.功法技能)){const e=a.修炼进度||0;s.Yz.log("角色商店",`[技能解锁检查] 功法: ${a.名称}, 进度: ${e}%, 技能数: ${a.功法技能.length}`),a.功法技能.forEach(t=>{const n=t.熟练度要求||0;s.Yz.log("角色商店",`  检查技能: ${t.技能名称}, 阈值: ${n}%, 当前进度: ${e}%, 应解锁: ${e>=n}`),e>=n&&!a.已解锁技能.includes(t.技能名称)&&(a.已解锁技能.push(t.技能名称),s.Yz.log("角色商店",`  ✅ 立即解锁技能: ${t.技能名称} (阈值: ${n}%)`))}),s.Yz.log("角色商店","[技能解锁结果] 已解锁技能数组:",a.已解锁技能)}n.角色.修炼={...n.角色.修炼??{},修炼功法:{物品ID:a.物品ID,名称:a.名称}},s.Yz.log("角色商店",`已装备功法: ${a.名称}`),s.Yz.log("角色商店",`修炼进度存储在: 背包.物品.${a.物品ID}.修炼进度`),s.Yz.log("角色商店",`已解锁技能数量: ${a.已解锁技能?.length||0}`);try{const e=(0,V.F)(n);s.Yz.log("角色商店",`装备功法后已更新掌握技能列表，共 ${e.length} 个技能`)}catch(e){s.Yz.error("角色商店","装备功法后自动计算掌握技能失败:",e)}t.loadFromSaveData(n);const r=t.inventory?.物品?.[e];if(r&&"功法"===r.类型){r.已解锁技能||(r.已解锁技能=[]);const e=r.修炼进度||0;r.功法技能&&Array.isArray(r.功法技能)&&r.功法技能.forEach(t=>{const n=t.熟练度要求||0;e>=n&&!r.已解锁技能.includes(t.技能名称)&&(r.已解锁技能.push(t.技能名称),s.Yz.log("角色商店",`[二次确认] 解锁技能: ${t.技能名称}`))})}await M();const o=n.角色?.背包?.物品?.[e];console.log("[角色商店-调试] 持久化后的功法数据:",{功法名称:o?.名称,品质字段存在:!!o?.品质,品质内容:o?.品质,完整物品数据:o});const l=a.名称;i.o.success(`已开始修炼《${l}》`)},unequipTechnique:async t=>{const n=(0,p.useGameStateStore)().getCurrentSaveData();if(!n)return void i.o.error("存档数据不存在");const r=n.角色?.背包?.物品?.[t],o=r.已装备||r.修炼中;if(!r||"功法"!==r.类型||!o)return s.Yz.error("角色商店","功法卸载验证失败:",{itemExists:!!r,itemType:r?.类型,isEquipped:r?.已装备,isCultivating:r?.修炼中,requestedItemId:t}),void i.o.error("要卸下的功法与当前修炼的功法不匹配");r.已装备=!1,r.修炼中&&(r.修炼中=!1),n.角色?.修炼?.修炼功法?.物品ID===t&&(n.角色.修炼={...n.角色.修炼??{},修炼功法:null}),s.Yz.log("角色商店",`已卸下功法: ${r.名称}`),s.Yz.log("角色商店",`修炼进度保留在: 背包.物品.${r.物品ID}.修炼进度`);try{const e=(0,V.F)(n);s.Yz.log("角色商店",`卸下功法后已更新掌握技能列表，共 ${e.length} 个技能`)}catch(e){s.Yz.error("角色商店","卸下功法后自动计算掌握技能失败:",e)}(0,a.triggerRef)(e),await x();const l=r.修炼进度||0,c=r.名称;i.o.info(`已停止修炼《${c}》，修炼进度${l}%已保存到背包`)},importCharacter:async t=>{if(!t||!t.角色||!t.模式)throw new Error("无效的角色文件格式。");const n=`char_${Date.now()}`,a=t.角色.名字||"未知角色";if(Object.values(e.value.角色列表).some(e=>e.角色.名字===a))throw new Error(`角色 "${a}" 已存在，请先删除或重命名现有角色。`);const r=t._导入存档列表;if(delete t._导入存档列表,t.存档列表||(t.存档列表={}),r&&Array.isArray(r)&&r.length>0){s.Yz.log("角色商店",`开始导入 ${r.length} 个存档...`);for(const e of r){const a=e.存档名||"导入存档";let r=a,o=1;for(;t.存档列表[r];)r=`${a}_${o}`,o++;if(e.存档数据){const t=(0,u.isTavernEnv)()?(0,m.kL)(e.存档数据):e.存档数据,a=(0,v.ru)(t)?t:(0,v.jj)(t).migrated,o=(0,_.$)(a);if(!o.isValid)throw console.error("[导入角色] 存档V3校验失败:",o.errors),new Error(`导入角色失败：存档结构不合法（${o.errors[0]||"未知原因"}）`);await d.dc(n,r,a);const i=a?.角色?.属性,l=a?.角色?.位置;e.角色名字=e.角色名字??a?.角色?.身份?.名字,e.境界=e.境界??i?.境界?.名称,e.位置=e.位置??l?.描述,e.游戏内时间=e.游戏内时间??(()=>{const e=a?.元数据?.时间;return e?`${e.年}年${e.月}月${e.日}日`:void 0})(),s.Yz.log("角色商店",`✅ 已将存档数据保存到 IndexedDB: ${n}/${r}`)}const i={...e};delete i.存档数据,t.存档列表[r]={...i,存档名:r}}s.Yz.log("角色商店",`✅ 成功导入 ${r.length} 个存档`)}e.value.角色列表[n]={...t},await x(),s.Yz.log("角色商店",`成功导入角色: ${a} (新ID: ${n})，含 ${Object.keys(t.存档列表).length} 个存档`)},loadSaveData:async(e,t)=>{console.log(`[CharacterStore] Loading save data for ${e} - ${t}`);return await d.loadSaveData(e,t)||(console.error(`[CharacterStore] Failed to load save data for ${e} - ${t}`),null)},loadCharacterSaves:async t=>{const n=e.value.角色列表[t];if(n){s.Yz.log("角色商店",`[loadCharacterSaves] 开始为角色 ${t} 加载存档数据...`);try{let r=0;if("联机"===n.模式){n.存档列表||(n.存档列表={}),n.存档列表["云端修行"]||(n.存档列表["云端修行"]={存档名:"云端修行",保存时间:"",游戏内时间:""});const e=n.存档列表["云端修行"];if(!e.存档数据){const n=e.云端同步信息?.后端创建失败;if((0,N.isBackendConfigured)()&&!n&&await(0,E.verifyStoredToken)())try{const n=await(0,E.NX)(t),a=n?.game_save,o=a?.save_data;o&&(e.存档数据=o,a?.game_time&&"string"==typeof a.game_time&&(e.游戏内时间=a.game_time),e.云端同步信息={最后同步:a?.last_sync?String(a.last_sync):(new Date).toISOString(),版本:"number"==typeof a?.version?a.version:1,需要同步:!1},r++,s.Yz.log("角色商店","  > 成功从云端加载联机存档"))}catch(e){s.Yz.warn("角色商店","从云端加载联机存档失败，尝试本地缓存",e)}if(!e.存档数据){const n=await d.loadSaveData(t,"云端修行");n&&(e.存档数据=n,r++,s.Yz.log("角色商店","  > 成功从本地加载联机存档缓存"))}}}else{if(!n.存档列表)return void s.Yz.log("角色商店",`[loadCharacterSaves] 角色 ${t} 无存档列表，无需加载。`);const e=Object.keys(n.存档列表);for(const a of e){const e=n.存档列表[a];if(e&&!e.存档数据){const n=await d.loadSaveData(t,a);n&&(e.存档数据=n,r++,s.Yz.log("角色商店",`  > 成功加载存档: ${a}`))}}}r>0?((0,a.triggerRef)(e),s.Yz.log("角色商店",`[loadCharacterSaves] 完成加载，共载入 ${r} 个存档数据。`)):s.Yz.log("角色商店","[loadCharacterSaves] 无需加载新的存档数据。")}catch(e){s.Yz.error("角色商店",`[loadCharacterSaves] 加载角色 ${t} 的存档时出错`,e)}}else s.Yz.warn("角色商店",`[loadCharacterSaves] 角色不存在: ${t}`)}}})},4717:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},4763:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(660),n.b),d=i()(r()),u=l()(c);d.push([e.id,`\n.api-management-panel[data-v-2186d8d2] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 头部 */\n.panel-header[data-v-2186d8d2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: var(--color-surface);\n  border-radius: 0.75rem;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.header-left[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.header-icon[data-v-2186d8d2] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-2186d8d2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-2186d8d2] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1e293b;\n}\n.settings-subtitle[data-v-2186d8d2] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.header-actions[data-v-2186d8d2] {\n  display: flex;\n  gap: 0.5rem;\n}\n.action-btn[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 0.5rem;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n.action-btn[data-v-2186d8d2]:hover {\n  background: #f1f5f9;\n  border-color: #94a3b8;\n}\n.action-btn.primary[data-v-2186d8d2] {\n  background: #3b82f6;\n  border-color: #3b82f6;\n  color: white;\n}\n.action-btn.primary[data-v-2186d8d2]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 内容区域 */\n.settings-container[data-v-2186d8d2] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.settings-container[data-v-2186d8d2]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-container[data-v-2186d8d2]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-container[data-v-2186d8d2]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n}\n\n/* 设置区块 */\n.settings-section[data-v-2186d8d2] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #e2e8f0;\n  overflow: hidden;\n}\n.section-header[data-v-2186d8d2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: #f8fafc;\n  border-bottom: 1px solid #e2e8f0;\n}\n.section-title[data-v-2186d8d2] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text, #1e293b);\n}\n\n/* 流水线提示 */\n.pipeline-hint[data-v-2186d8d2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1.25rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(147, 51, 234, 0.08));\n  border-bottom: 1px solid #e2e8f0;\n}\n.hint-icon[data-v-2186d8d2] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.hint-content[data-v-2186d8d2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary, #64748b);\n  line-height: 1.5;\n}\n.hint-content strong[data-v-2186d8d2] {\n  color: var(--color-text, #1e293b);\n}\n.hint-example[data-v-2186d8d2] {\n  display: inline-block;\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-muted, #94a3b8);\n  font-style: italic;\n}\n.section-count[data-v-2186d8d2] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n\n/* 模式标识 */\n.mode-badge[data-v-2186d8d2] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.mode-badge.tavern[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  border: 1px solid #f59e0b;\n}\n.mode-badge.web[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n  color: #1e40af;\n  border: 1px solid #3b82f6;\n}\n\n/* 模式说明 */\n.mode-hint[data-v-2186d8d2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1.25rem;\n  border-bottom: 1px solid #e2e8f0;\n}\n.mode-hint.tavern[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.08));\n}\n.mode-hint.web[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.08));\n}\n.mode-hint .hint-content em[data-v-2186d8d2] {\n  font-style: normal;\n  font-weight: 600;\n  color: #dc2626;\n}\n\n/* API卡片列表 */\n.api-list[data-v-2186d8d2] {\n  padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.api-card[data-v-2186d8d2] {\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  overflow: hidden;\n  transition: all 0.2s ease;\n}\n.api-card[data-v-2186d8d2]:hover {\n  border-color: #94a3b8;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n.api-card.disabled[data-v-2186d8d2] {\n  opacity: 0.6;\n}\n.api-card.default[data-v-2186d8d2] {\n  border-color: #3b82f6;\n  background: linear-gradient(135deg, #eff6ff 0%, #f8fafc 100%);\n}\n.api-card-header[data-v-2186d8d2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: white;\n  border-bottom: 1px solid #e2e8f0;\n}\n.api-info[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.api-name[data-v-2186d8d2] {\n  font-weight: 600;\n  color: #1e293b;\n}\n.api-provider[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  color: #64748b;\n  background: #e2e8f0;\n  padding: 0.125rem 0.5rem;\n  border-radius: 1rem;\n}\n.api-provider.tavern-tag[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  border: 1px solid #f59e0b;\n  font-weight: 500;\n}\n.api-actions[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.icon-btn[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 0.375rem;\n  background: transparent;\n  color: #64748b;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.icon-btn[data-v-2186d8d2]:hover {\n  background: #e2e8f0;\n  color: #1e293b;\n}\n.icon-btn.danger[data-v-2186d8d2]:hover {\n  background: #fee2e2;\n  color: #dc2626;\n}\n.icon-btn[data-v-2186d8d2]:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n.api-card-body[data-v-2186d8d2] {\n  padding: 0.75rem 1rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n}\n\n/* 酒馆模式下默认API的提示样式 */\n.tavern-api-hint[data-v-2186d8d2] {\n  width: 100%;\n  padding: 0.5rem 0;\n}\n.tavern-api-hint .hint-text[data-v-2186d8d2] {\n  font-size: 0.875rem;\n  color: #92400e;\n  font-style: italic;\n}\n.api-detail[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n}\n.detail-label[data-v-2186d8d2] {\n  color: var(--color-text-secondary);\n}\n.detail-value[data-v-2186d8d2] {\n  color: var(--color-text);\n  font-weight: 500;\n}\n.detail-value.url[data-v-2186d8d2] {\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.detail-value.success[data-v-2186d8d2] {\n  color: #059669;\n}\n.detail-value.fail[data-v-2186d8d2] {\n  color: #dc2626;\n}\n.detail-value.unknown[data-v-2186d8d2] {\n  color: var(--color-text-secondary);\n}\n.api-card-footer[data-v-2186d8d2] {\n  padding: 0.5rem 1rem;\n  background: rgba(59, 130, 246, 0.05);\n  border-top: 1px solid #e2e8f0;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.assigned-label[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  color: #64748b;\n}\n.assigned-tags[data-v-2186d8d2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n}\n.function-tag[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  background: #3b82f6;\n  color: white;\n  padding: 0.125rem 0.5rem;\n  border-radius: 1rem;\n}\n\n/* 设置列表 */\n.settings-list[data-v-2186d8d2] {\n  padding: 0.5rem;\n}\n\n/* 功能分组头部 */\n.function-group-header[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem 0.5rem;\n  margin-top: 1rem;\n}\n.function-group-header[data-v-2186d8d2]:first-child {\n  margin-top: 0;\n}\n.group-title[data-v-2186d8d2] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1e293b;\n}\n.group-desc[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n\n/* 自动分步生成提示 */\n.auto-split-hint[data-v-2186d8d2] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.875rem 1rem;\n  margin: 0.75rem 0.5rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(37, 99, 235, 0.05));\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  border-radius: 0.5rem;\n}\n.auto-split-hint .hint-icon[data-v-2186d8d2] {\n  font-size: 1.25rem;\n}\n.auto-split-hint .hint-text[data-v-2186d8d2] {\n  flex: 1;\n  font-size: 0.875rem;\n  color: #1e40af;\n  line-height: 1.5;\n}\n.auto-split-hint .hint-text strong[data-v-2186d8d2] {\n  font-weight: 600;\n  color: #1e3a8a;\n}\n.setting-item[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-2186d8d2]:hover {\n  background: #f8fafc;\n}\n\n/* 控制行样式 */\n.control-row[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n/* 内联开关样式 */\n.inline-toggle[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-right: 0.5rem;\n}\n.toggle-label[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  color: #64748b;\n  white-space: nowrap;\n}\n.setting-switch.compact[data-v-2186d8d2] {\n  transform: scale(0.85);\n}\n\n/* 模式指示器 */\n.mode-indicator[data-v-2186d8d2] {\n  display: inline-flex;\n  align-items: center;\n  margin-left: 0.5rem;\n  padding: 0.125rem 0.4rem;\n  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n  color: #1e40af;\n  font-size: 0.65rem;\n  font-weight: 600;\n  border-radius: 0.5rem;\n  border: 1px solid #93c5fd;\n}\n.setting-info[data-v-2186d8d2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-2186d8d2] {\n  font-weight: 500;\n  color: #1e293b;\n}\n.setting-desc[data-v-2186d8d2] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n\n/* 酒馆模式锁定状态 */\n.setting-item.tavern-locked[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.05));\n  border-radius: 0.5rem;\n}\n.locked-badge[data-v-2186d8d2] {\n  display: inline-flex;\n  align-items: center;\n  margin-left: 0.5rem;\n  padding: 0.125rem 0.5rem;\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  color: #92400e;\n  font-size: 0.7rem;\n  font-weight: 500;\n  border-radius: 0.75rem;\n  border: 1px solid #f59e0b;\n}\n.locked-text[data-v-2186d8d2] {\n  display: inline-flex;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: #f8fafc;\n  border: 1px dashed #d1d5db;\n  border-radius: 0.5rem;\n  color: #64748b;\n  font-size: 0.875rem;\n  font-style: italic;\n}\n.setting-control[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n}\n.assignment-control[data-v-2186d8d2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n  align-items: flex-end;\n}\n.function-mode-row[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.mode-label[data-v-2186d8d2] {\n  font-size: 0.75rem;\n  color: #64748b;\n  white-space: nowrap;\n}\n.setting-select.mode-select[data-v-2186d8d2] {\n  min-width: 120px;\n}\n.setting-select[data-v-2186d8d2] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background-color: white;\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: #374151;\n  font-size: 0.875rem;\n  cursor: pointer;\n  appearance: none;\n  min-width: 140px;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-2186d8d2] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-2186d8d2] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-2186d8d2] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-2186d8d2]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-2186d8d2] {\n  background-color: #3b82f6;\n}\ninput:checked + .switch-slider[data-v-2186d8d2]:before {\n  transform: translateX(20px);\n}\n\n/* 模态框 */\n.modal-overlay[data-v-2186d8d2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-2186d8d2] {\n  background: white;\n  border-radius: 1rem;\n  width: 90%;\n  max-width: 500px;\n  max-height: 90vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-header[data-v-2186d8d2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid #e2e8f0;\n}\n.modal-header h3[data-v-2186d8d2] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1e293b;\n}\n.close-btn[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 0.5rem;\n  background: transparent;\n  color: #64748b;\n  cursor: pointer;\n}\n.close-btn[data-v-2186d8d2]:hover {\n  background: #f1f5f9;\n  color: #1e293b;\n}\n.modal-body[data-v-2186d8d2] {\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n.form-group[data-v-2186d8d2] {\n  margin-bottom: 1rem;\n}\n.form-group label[data-v-2186d8d2] {\n  display: block;\n  font-weight: 500;\n  color: #374151;\n  margin-bottom: 0.5rem;\n}\n.form-input[data-v-2186d8d2],\n.form-select[data-v-2186d8d2] {\n  width: 100%;\n  padding: 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  background: white;\n  color: #374151;\n  box-sizing: border-box;\n}\n.form-input[data-v-2186d8d2]:focus,\n.form-select[data-v-2186d8d2]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.form-row[data-v-2186d8d2] {\n  display: flex;\n  gap: 1rem;\n}\n.form-group.half[data-v-2186d8d2] {\n  flex: 1;\n}\n.model-input-row[data-v-2186d8d2] {\n  display: flex;\n  gap: 0.5rem;\n}\n.model-input-row .form-input[data-v-2186d8d2] {\n  flex: 1;\n}\n.model-select-wrapper[data-v-2186d8d2] {\n  position: relative;\n}\n.model-dropdown[data-v-2186d8d2] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  max-height: 200px;\n  overflow-y: auto;\n  background: white;\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  z-index: 100;\n  margin-top: 4px;\n}\n.model-dropdown-item[data-v-2186d8d2] {\n  padding: 0.5rem 0.75rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  color: #374151;\n  transition: background 0.15s ease;\n}\n.model-dropdown-item[data-v-2186d8d2]:hover {\n  background: #f1f5f9;\n}\n.model-dropdown-item.active[data-v-2186d8d2] {\n  background: #eff6ff;\n  color: #3b82f6;\n  font-weight: 500;\n}\n.utility-btn[data-v-2186d8d2] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  background: white;\n  color: #374151;\n  cursor: pointer;\n}\n.utility-btn[data-v-2186d8d2]:hover {\n  background: #f1f5f9;\n  border-color: #94a3b8;\n}\n.utility-btn[data-v-2186d8d2]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.model-list[data-v-2186d8d2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n}\n.model-tag[data-v-2186d8d2] {\n  padding: 0.25rem 0.75rem;\n  border: 1px solid #e2e8f0;\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  background: #f8fafc;\n  color: #64748b;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.model-tag[data-v-2186d8d2]:hover {\n  border-color: #3b82f6;\n  color: #3b82f6;\n}\n.model-tag.active[data-v-2186d8d2] {\n  background: #3b82f6;\n  border-color: #3b82f6;\n  color: white;\n}\n.modal-footer[data-v-2186d8d2] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  padding: 1rem 1.5rem;\n  border-top: 1px solid #e2e8f0;\n}\n.btn-cancel[data-v-2186d8d2],\n.btn-confirm[data-v-2186d8d2] {\n  padding: 0.625rem 1.25rem;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.btn-cancel[data-v-2186d8d2] {\n  background: white;\n  border: 1px solid #d1d5db;\n  color: #374151;\n}\n.btn-cancel[data-v-2186d8d2]:hover {\n  background: #f1f5f9;\n  border-color: #94a3b8;\n}\n.btn-confirm[data-v-2186d8d2] {\n  background: #3b82f6;\n  border: 1px solid #3b82f6;\n  color: white;\n}\n.btn-confirm[data-v-2186d8d2]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 加载动画 */\n.loading-pulse[data-v-2186d8d2] {\n  animation: pulse-2186d8d2 1.5s ease-in-out infinite;\n}\n@keyframes pulse-2186d8d2 {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.4;\n}\n}\n\n/* 响应式 */\n@media (max-width: 640px) {\n.header-actions .btn-text[data-v-2186d8d2] {\n    display: none;\n}\n.api-card-body[data-v-2186d8d2] {\n    flex-direction: column;\n    gap: 0.5rem;\n}\n.form-row[data-v-2186d8d2] {\n    flex-direction: column;\n    gap: 1rem;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .api-management-panel[data-v-2186d8d2] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-2186d8d2],\n[data-theme='dark'] .settings-section[data-v-2186d8d2] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .section-header[data-v-2186d8d2] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-2186d8d2],\n[data-theme='dark'] .section-title[data-v-2186d8d2],\n[data-theme='dark'] .setting-name[data-v-2186d8d2],\n[data-theme='dark'] .api-name[data-v-2186d8d2],\n[data-theme='dark'] .group-title[data-v-2186d8d2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .settings-subtitle[data-v-2186d8d2],\n[data-theme='dark'] .setting-desc[data-v-2186d8d2],\n[data-theme='dark'] .detail-label[data-v-2186d8d2],\n[data-theme='dark'] .group-desc[data-v-2186d8d2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .api-card[data-v-2186d8d2] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme='dark'] .api-card-header[data-v-2186d8d2] {\n  background: #1e293b;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .setting-item[data-v-2186d8d2]:hover,\n[data-theme='dark'] .api-card[data-v-2186d8d2]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .action-btn[data-v-2186d8d2],\n[data-theme='dark'] .setting-select[data-v-2186d8d2],\n[data-theme='dark'] .form-input[data-v-2186d8d2],\n[data-theme='dark'] .form-select[data-v-2186d8d2] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .form-group label[data-v-2186d8d2] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .modal-content[data-v-2186d8d2] {\n  background: #1e293b;\n}\n[data-theme='dark'] .modal-header[data-v-2186d8d2] {\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .modal-header h3[data-v-2186d8d2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .modal-footer[data-v-2186d8d2] {\n  border-top-color: #475569;\n}\n[data-theme='dark'] .api-provider[data-v-2186d8d2] {\n  background: #475569;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .api-provider.tavern-tag[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .tavern-api-hint .hint-text[data-v-2186d8d2] {\n  color: #fcd34d;\n}\n[data-theme='dark'] .model-tag[data-v-2186d8d2] {\n  background: #475569;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .model-dropdown[data-v-2186d8d2] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme='dark'] .model-dropdown-item[data-v-2186d8d2] {\n  color: #e5e7eb;\n}\n[data-theme='dark'] .model-dropdown-item[data-v-2186d8d2]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .model-dropdown-item.active[data-v-2186d8d2] {\n  background: #1e40af;\n  color: #93c5fd;\n}\n\n/* 深色主题 - 模式标识 */\n[data-theme='dark'] .mode-badge.tavern[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .mode-badge.web[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);\n  color: #dbeafe;\n  border-color: #2563eb;\n}\n[data-theme='dark'] .mode-hint.tavern[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(120, 53, 15, 0.3), rgba(146, 64, 14, 0.2));\n}\n[data-theme='dark'] .mode-hint.web[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(30, 64, 175, 0.2));\n}\n[data-theme='dark'] .mode-hint .hint-content em[data-v-2186d8d2] {\n  color: #fca5a5;\n}\n\n/* 深色主题 - 锁定状态 */\n[data-theme='dark'] .setting-item.tavern-locked[data-v-2186d8d2] {\n  background: linear-gradient(135deg, rgba(120, 53, 15, 0.2), rgba(146, 64, 14, 0.15));\n}\n[data-theme='dark'] .locked-badge[data-v-2186d8d2] {\n  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);\n  color: #fef3c7;\n  border-color: #b45309;\n}\n[data-theme='dark'] .locked-text[data-v-2186d8d2] {\n  background: #334155;\n  border-color: #475569;\n  color: #94a3b8;\n}\n`,""]);const m=d},4765:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:a}},4803:(e,t,n)=>{"use strict";var a=n(8859),r=n(9675),o=function(e,t,n){for(var a,r=e;null!=(a=r.next);r=a)if(a.key===t)return r.next=a.next,n||(a.next=e.next,e.next=a),a};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+a(e))},delete:function(t){var n=e&&e.next,a=function(e,t){if(e)return o(e,t,!0)}(e,t);return a&&n&&n===a&&(e=void 0),!!a},get:function(t){return function(e,t){if(e){var n=o(e,t);return n&&n.value}}(e,t)},has:function(t){return function(e,t){return!!e&&!!o(e,t)}(e,t)},set:function(t,n){e||(e={next:void 0}),function(e,t,n){var a=o(e,t);a?a.value=n:e.next={key:t,next:e.next,value:n}}(e,t,n)}};return t}},4820:(e,t,n)=>{"use strict";function a(e){const t=[],n=[],a=[];try{return Array.isArray(e)?(e.forEach((e,r)=>{try{const o=function(e,t){const n=[],a=[];try{if(!e||"object"!=typeof e)return n.push(`指令${t}: 不是有效的对象`),{valid:!1,errors:n,warnings:a};const r=e;r.action||n.push(`指令${t}: 缺少action字段`),r.key||n.push(`指令${t}: 缺少key字段`);const o=["set","add","push","delete","pull"];r.action&&!o.includes(r.action)&&n.push(`指令${t}: action值"${r.action}"无效，必须是: ${o.join(", ")}`),r.key&&"string"!=typeof r.key&&n.push(`指令${t}: key必须是字符串类型`),"delete"!==r.action&&void 0===r.value&&n.push(`指令${t}: ${r.action}操作必须提供value字段`);const i=["action","key","value"],s=Object.keys(r).filter(e=>!i.includes(e));if(s.length>0&&a.push(`指令${t}: 包含多余字段: ${s.join(", ")}（这些字段会被自动移除）`),r.key&&void 0!==r.value)try{const e=function(e,t,n){const a=[];try{const r=["元数据","角色","社交","世界","系统"];if(!r.some(t=>e===t||e.startsWith(`${t}.`)))return a.push(`key必须以 ${r.join(" / ")} 开头（V3短路径），当前: ${e}`),a;const o=["根骨","灵性","悟性","气运","魅力","心性"];if("add"===n&&(["元数据.时间.年","元数据.时间.月","元数据.时间.日","元数据.时间.小时","元数据.时间.分钟","角色.属性.声望","角色.属性.气血.当前","角色.属性.气血.上限","角色.属性.灵气.当前","角色.属性.灵气.上限","角色.属性.神识.当前","角色.属性.神识.上限","角色.属性.寿命.当前","角色.属性.寿命.上限","角色.背包.灵石.下品","角色.背包.灵石.中品","角色.背包.灵石.上品","角色.背包.灵石.极品"].includes(e)&&"number"!=typeof t&&a.push(`${e} 使用 add 时 value 必须是数字，当前类型: ${typeof t}`),e.startsWith("角色.身份.后天六司.")&&o.some(t=>e.endsWith(`.${t}`))&&"number"!=typeof t&&a.push(`${e} 使用 add 时 value 必须是数字，当前类型: ${typeof t}`)),"角色.属性.境界"===e&&"set"===n)if("object"!=typeof t||null===t)a.push("角色.属性.境界 必须是对象类型");else{const e=t;void 0!==e.名称&&"string"!=typeof e.名称&&a.push("境界.名称必须是字符串类型"),void 0!==e.阶段&&"string"!=typeof e.阶段&&a.push("境界.阶段必须是字符串类型"),void 0!==e.当前进度&&"number"!=typeof e.当前进度&&a.push("境界.当前进度必须是数字类型"),void 0!==e.下一级所需&&"number"!=typeof e.下一级所需&&a.push("境界.下一级所需必须是数字类型"),void 0!==e.突破描述&&"string"!=typeof e.突破描述&&a.push("境界.突破描述必须是字符串类型")}if("角色.位置"===e&&"set"===n)if("object"!=typeof t||null===t)a.push("角色.位置 必须是对象类型");else{const e=t;void 0!==e.描述&&"string"!=typeof e.描述&&a.push("位置.描述必须是字符串类型"),void 0!==e.x&&"number"!=typeof e.x&&a.push("位置.x必须是数字类型"),void 0!==e.y&&"number"!=typeof e.y&&a.push("位置.y必须是数字类型"),void 0!==e.地图ID&&"string"!=typeof e.地图ID&&a.push("位置.地图ID必须是字符串类型")}if("角色.效果"===e&&"push"===n)if("object"!=typeof t||null===t)a.push("角色.效果 push 的 value 必须是对象类型");else{const e=t;void 0===e.类型||["buff","debuff"].includes(e.类型)||a.push(`状态效果类型必须是"buff"或"debuff"，当前值: ${e.类型}`),void 0!==e.持续时间分钟&&"number"!=typeof e.持续时间分钟&&a.push("状态效果.持续时间分钟必须是数字类型")}if("角色.背包.物品"===e&&"push"===n&&("object"==typeof t&&null!==t||a.push("推送到 角色.背包.物品 的物品必须是对象类型")),e.startsWith("角色.背包.物品.")&&"set"===n&&(3!==(e.match(/\./g)||[]).length||"object"==typeof t&&null!==t||a.push("物品必须是对象类型")),e.startsWith("社交.关系.")&&2===(e.match(/\./g)||[]).length&&"set"===n&&"object"==typeof t&&null!==t){const e=t;!e.境界||"object"==typeof e.境界&&null!==e.境界||a.push("NPC境界必须是对象类型"),void 0===e.天赋||Array.isArray(e.天赋)||a.push("NPC天赋必须是数组类型")}if(e.startsWith("社交.关系.")&&e.endsWith(".境界")&&"set"===n)if("object"!=typeof t||null===t)a.push("NPC境界必须是对象类型");else{const e=t;void 0!==e.名称&&"string"!=typeof e.名称&&a.push("NPC境界.名称必须是字符串类型"),void 0!==e.阶段&&"string"!=typeof e.阶段&&a.push("NPC境界.阶段必须是字符串类型")}return e.startsWith("角色.大道.大道列表.")&&"set"===n&&3===(e.match(/\./g)||[]).length&&("object"==typeof t&&null!==t||a.push("大道对象必须是对象类型")),"社交.任务.当前任务列表"===e&&"push"===n&&("object"==typeof t&&null!==t||a.push("任务对象必须是对象类型")),a}catch(e){return console.error("[指令验证] validateValueType发生异常:",e),a.push(`验证过程发生异常: ${e instanceof Error?e.message:String(e)}`),a}}(r.key,r.value,r.action);n.push(...e.map(e=>`指令${t}: ${e}`))}catch(e){console.error("[指令验证] 值类型检查异常:",e),a.push(`指令${t}: 值类型检查时发生异常，已跳过`)}return{valid:0===n.length,errors:n,warnings:a}}catch(e){return console.error("[指令验证] validateCommand发生严重异常:",e),n.push(`指令${t}: 验证过程发生严重异常`),{valid:!1,errors:n,warnings:a}}}(e,r);t.push(...o.errors),n.push(...o.warnings),o.errors.length>0&&a.push({command:e,errors:o.errors})}catch(e){console.error(`[指令验证] 验证指令${r}时发生异常:`,e),t.push(`指令${r}: 验证时发生异常`),n.push(`指令${r}: 已跳过异常指令`)}}),{valid:0===t.length,errors:t,warnings:n,invalidCommands:a}):{valid:!1,errors:["tavern_commands必须是数组类型"],warnings:[],invalidCommands:[]}}catch(e){return console.error("[指令验证] validateCommands发生严重异常:",e),{valid:!1,errors:["指令数组验证过程发生严重异常"],warnings:[],invalidCommands:[]}}}function r(e){const{action:t,key:n,value:a}=e,r={action:t,key:n,value:a};return"delete"===t&&delete r.value,r}function o(e){return e.map(r)}n.d(t,{cleanCommands:()=>o,validateCommands:()=>a})},4881:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* 顶栏动作统一处理，移除本地工具栏 */\n/* 容器约束防止溢出 */\n.memory-center-panel[data-v-1ded3595] {\n  width: 100%;\n  max-width: 100%;\n  height: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  container-type: inline-size;\n  margin: 0;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1.25rem;\n}\n\n/* 导出区域样式 */\n.export-section[data-v-1ded3595] {\n  padding: 1.25rem 1.5rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(37, 99, 235, 0.08) 100%);\n  border: 1.5px solid rgba(59, 130, 246, 0.15);\n  border-radius: 14px;\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.08);\n}\n.export-btn-main[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: white;\n  border: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 10px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 600;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  white-space: nowrap;\n  box-shadow: 0 4px 14px rgba(59, 130, 246, 0.25);\n  letter-spacing: 0.3px;\n}\n.export-btn-main[data-v-1ded3595]:hover {\n  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);\n  transform: translateY(-3px);\n  box-shadow: 0 8px 20px rgba(59, 130, 246, 0.35);\n}\n.export-hint[data-v-1ded3595] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  opacity: 0.85;\n}\n.filter-section[data-v-1ded3595] {\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1px solid rgba(var(--color-border-rgb), 0.2);\n  border-radius: 16px;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n}\n.filter-tabs[data-v-1ded3595] {\n  display: flex;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n  overflow: hidden;\n  box-sizing: border-box;\n  align-items: center;\n  justify-content: flex-start;\n  margin: 0;\n  padding: 0.75rem;\n}\n.filter-tabs .filter-tab[data-v-1ded3595] {\n  flex: 0 0 auto;\n  margin: 0;\n}\n.filter-tabs .settings-toggle-btn[data-v-1ded3595] {\n  margin-left: auto;\n}\n.filter-tab[data-v-1ded3595] {\n  flex-shrink: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 150px;\n  margin: 0;\n  padding: 0.7rem 1.2rem;\n  border: 1.5px solid rgba(100, 116, 139, 0.2);\n  background: rgba(255, 255, 255, 0.95);\n  color: #475569;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  box-sizing: border-box;\n  font-size: 0.875rem;\n  font-weight: 600;\n  min-height: 42px;\n  position: relative;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n  letter-spacing: 0.3px;\n}\n.filter-tab[data-v-1ded3595]:hover {\n  background: rgba(241, 245, 249, 1);\n  border-color: rgba(59, 130, 246, 0.35);\n  color: #1e293b;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);\n}\n.filter-tab.active[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  border-color: transparent;\n  color: white;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n  transform: translateY(-1px);\n}\n.filter-tab .tab-icon[data-v-1ded3595] {\n  font-size: 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.filter-tab .tab-name[data-v-1ded3595] {\n  font-weight: 500;\n  letter-spacing: 0.2px;\n}\n.filter-tab .tab-count[data-v-1ded3595] {\n  background: rgba(100, 116, 139, 0.12);\n  color: #64748b;\n  padding: 0.2rem 0.5rem;\n  border-radius: 8px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  min-width: 20px;\n  text-align: center;\n  line-height: 1;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);\n}\n.filter-tab.active .tab-count[data-v-1ded3595] {\n  background: rgba(255, 255, 255, 0.3);\n  color: white;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.panel-content[data-v-1ded3595] {\n  width: 100%;\n  max-width: 100%;\n  height: calc(100% - 80px);\n  overflow-y: auto;\n  overflow-x: hidden;\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n/* 设置界面样式 */\n.settings-section[data-v-1ded3595] {\n  margin: 0;\n  padding: 0;\n  background: rgba(var(--color-surface-rgb), 0.95);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  animation: fadeIn-1ded3595 0.3s ease-in-out;\n  max-width: 100%;\n  width: 100%;\n  height: 100%;\n  max-height: calc(100% - 80px);\n  box-sizing: border-box;\n  overflow: hidden;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n}\n.settings-header[data-v-1ded3595] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0;\n  padding: 1rem 1rem 0.5rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  flex-shrink: 0;\n}\n.header-actions[data-v-1ded3595] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.export-btn[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.4rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  white-space: nowrap;\n  margin-right: 0.5rem;\n}\n.export-btn[data-v-1ded3595]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.test-btn[data-v-1ded3595] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  color: white;\n  border: none;\n  padding: 0.4rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.test-btn[data-v-1ded3595]:hover {\n  background: linear-gradient(135deg, #059669, #047857);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\n}\n.settings-title[data-v-1ded3595] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.settings-close-btn[data-v-1ded3595] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0.2rem;\n  border-radius: 4px;\n  transition: var(--transition-fast);\n  flex-shrink: 0;\n}\n.settings-close-btn[data-v-1ded3595]:hover {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n.settings-content[data-v-1ded3595] {\n  display: block;\n  max-width: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  box-sizing: border-box;\n  flex: 1;\n  min-height: 0;\n  padding: 1rem;\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.settings-content[data-v-1ded3595]::-webkit-scrollbar {\n  width: 8px;\n}\n.settings-content[data-v-1ded3595]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-content[data-v-1ded3595]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n}\n.settings-content[data-v-1ded3595]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n.setting-item[data-v-1ded3595] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-width: 100%;\n  overflow: visible;\n  box-sizing: border-box;\n  margin-bottom: 1.5rem;\n}\n.setting-label[data-v-1ded3595] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n}\n.setting-input[data-v-1ded3595] {\n  padding: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  width: 100px;\n  max-width: 120px;\n  transition: var(--transition-fast);\n  box-sizing: border-box;\n}\n.setting-input[data-v-1ded3595]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.setting-textarea[data-v-1ded3595] {\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  width: 100%;\n  max-width: 100%;\n  transition: var(--transition-fast);\n  box-sizing: border-box;\n  resize: vertical;\n  min-height: 100px;\n  font-family: monospace;\n  line-height: 1.4;\n}\n.setting-textarea[data-v-1ded3595]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.setting-textarea[data-v-1ded3595]::placeholder {\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n.setting-checkbox[data-v-1ded3595] {\n  margin-right: 0.5rem;\n  accent-color: var(--color-primary);\n  flex-shrink: 0;\n}\n.setting-hint[data-v-1ded3595] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n}\n.settings-actions[data-v-1ded3595] {\n  display: flex;\n  gap: 0.75rem;\n  margin-top: 2rem;\n  flex-wrap: wrap;\n  max-width: 100%;\n  overflow: visible;\n  box-sizing: border-box;\n}\n\n/* 手动总结区域 */\n.manual-summary-section[data-v-1ded3595] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.summary-info[data-v-1ded3595] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n}\n.info-text[data-v-1ded3595] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.info-hint[data-v-1ded3595] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* 通用操作按钮基样式，确保有清晰边框 */\n.action-btn[data-v-1ded3595] {\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: var(--transition-fast);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  box-sizing: border-box;\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n@keyframes fadeIn-1ded3595 {\nfrom {\n    opacity: 0;\n    transform: translateY(-10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.action-btn.success[data-v-1ded3595] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border: 1px solid rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n  padding: 0.5rem 1rem;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: var(--transition-fast);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  box-sizing: border-box;\n}\n.action-btn.success[data-v-1ded3595]:hover {\n  background: rgba(var(--color-success-rgb), 0.2);\n  border-color: var(--color-success);\n}\n\n/* 信息按钮，用于“重置默认”等操作 */\n.action-btn.info[data-v-1ded3595] {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border: 1px solid rgba(var(--color-info-rgb), 0.3);\n  color: var(--color-info);\n}\n.action-btn.info[data-v-1ded3595]:hover {\n  background: rgba(var(--color-info-rgb), 0.2);\n  border-color: var(--color-info);\n}\n.settings-toggle-btn[data-v-1ded3595] {\n  background: rgba(var(--color-surface-rgb), 0.9);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  padding: 0.65rem;\n  border-radius: 10px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  width: 42px;\n  height: 42px;\n  box-sizing: border-box;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n}\n.settings-toggle-btn[data-v-1ded3595]:hover,\n.settings-toggle-btn.active[data-v-1ded3595] {\n  background: rgba(59, 130, 246, 0.12);\n  border-color: rgba(59, 130, 246, 0.5);\n  color: #3b82f6;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);\n}\n\n/* 记忆卡片特定样式 */\n.memory-list[data-v-1ded3595] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n}\n.memory-card[data-v-1ded3595] {\n  padding: 1.25rem 1.5rem;\n  background: var(--color-surface);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.5);\n  border-radius: 12px;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  cursor: pointer;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  box-sizing: border-box;\n  word-wrap: break-word;\n  word-break: break-word;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n.memory-card[data-v-1ded3595]:hover {\n  background: var(--color-surface-light);\n  border-color: rgba(59, 130, 246, 0.35);\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.12);\n}\n.memory-header[data-v-1ded3595] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  padding-bottom: 0.75rem;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.15);\n}\n.memory-actions[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.delete-memory-btn[data-v-1ded3595] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  padding: 0.25rem 0.5rem;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n  opacity: 0.6;\n}\n.delete-memory-btn[data-v-1ded3595]:hover {\n  opacity: 1;\n  background: rgba(220, 38, 38, 0.1);\n  border-color: #dc2626;\n  transform: scale(1.1);\n}\n.memory-type-badge[data-v-1ded3595] {\n  padding: 0.35rem 0.75rem;\n  border-radius: 8px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  border: 1.5px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  letter-spacing: 0.3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n.badge-short[data-v-1ded3595] {\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n  background: rgba(var(--color-warning-rgb), 0.1);\n  color: var(--color-warning);\n}\n.badge-medium[data-v-1ded3595] {\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n}\n.badge-long[data-v-1ded3595] {\n  border-color: rgba(var(--color-info-rgb), 0.3);\n  background: rgba(var(--color-info-rgb), 0.1);\n  color: var(--color-info);\n}\n.memory-time[data-v-1ded3595] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.memory-content[data-v-1ded3595] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  line-height: 1.5;\n  margin-bottom: 0.5rem;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n  word-break: break-word;\n}\n.memory-title[data-v-1ded3595] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  margin-bottom: 0.75rem;\n  text-align: center;\n  padding: 0.5rem;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n.memory-section[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  margin: 0.75rem 0 0.5rem 0;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n}\n.memory-icon[data-v-1ded3595] {\n  font-size: 1.2rem;\n  margin-right: 0.5rem;\n}\n.memory-section-title[data-v-1ded3595] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.memory-item[data-v-1ded3595] {\n  margin: 0.3rem 0;\n  padding-left: 1rem;\n  color: var(--color-text);\n  line-height: 1.4;\n  position: relative;\n  width: 100%;\n  max-width: 100%;\n  overflow: hidden;\n  word-wrap: break-word;\n  word-break: break-word;\n}\n.memory-item[data-v-1ded3595]::before {\n  content: \'\';\n  position: absolute;\n  left: 0.25rem;\n  top: 0.6rem;\n  width: 3px;\n  height: 3px;\n  background: var(--color-accent);\n  border-radius: 50%;\n}\n.memory-importance[data-v-1ded3595] {\n  font-size: 0.75rem;\n  color: var(--color-accent);\n  font-weight: 500;\n  padding: 0.25rem 0.5rem;\n  background: rgba(var(--color-accent-rgb), 0.1);\n  border-radius: 4px;\n  border: 1px solid rgba(var(--color-accent-rgb), 0.3);\n  display: inline-block;\n}\n.empty-hint[data-v-1ded3595] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.memory-center-panel[data-v-1ded3595] {\n    gap: 0.75rem;\n    width: 100%;\n    max-width: 100%;\n    overflow: hidden;\n}\n.header-actions .btn-text[data-v-1ded3595] {\n    display: none;\n}\n.filter-tabs[data-v-1ded3595] {\n    gap: 0.3rem;\n}\n.filter-tab[data-v-1ded3595] {\n    max-width: 120px;\n    font-size: 0.8rem;\n}\n.memory-status[data-v-1ded3595] {\n    gap: 0.5rem;\n    padding: 0.6rem;\n    flex-direction: column;\n}\n.status-item[data-v-1ded3595] {\n    min-width: 80px;\n    flex: 1 1 100px;\n    width: 100%;\n    max-width: 100%;\n}\n.status-text[data-v-1ded3595] {\n    font-size: 0.7rem;\n    min-width: 2.5rem;\n}\n.memory-card[data-v-1ded3595] {\n    padding: 0.8rem;\n}\n.memory-content[data-v-1ded3595] {\n    font-size: 0.8rem;\n}\n.memory-header[data-v-1ded3595] {\n    flex-direction: column;\n    gap: 0.5rem;\n    align-items: flex-start;\n}\n.memory-type-badge[data-v-1ded3595] {\n    align-self: flex-start;\n}\n.memory-time[data-v-1ded3595] {\n    align-self: flex-end;\n    font-size: 0.7rem;\n}\n}\n@media (max-width: 480px) {\n.memory-center-panel[data-v-1ded3595] {\n    gap: 0.5rem;\n}\n.filter-tabs[data-v-1ded3595] {\n    gap: 0.2rem;\n}\n.filter-tab[data-v-1ded3595] {\n    max-width: 100px;\n    font-size: 0.75rem;\n    padding: 0.4rem 0.6rem;\n}\n.memory-status[data-v-1ded3595] {\n    padding: 0.5rem;\n}\n.status-item[data-v-1ded3595] {\n    gap: 0.3rem;\n}\n.status-label[data-v-1ded3595] {\n    font-size: 0.7rem;\n    min-width: 1.5rem;\n}\n.status-bar[data-v-1ded3595] {\n    height: 4px;\n}\n.status-text[data-v-1ded3595] {\n    font-size: 0.65rem;\n    min-width: 2rem;\n}\n.memory-card[data-v-1ded3595] {\n    padding: 0.6rem;\n}\n.memory-content[data-v-1ded3595] {\n    font-size: 0.75rem;\n}\n.memory-section-title[data-v-1ded3595] {\n    font-size: 0.8rem;\n}\n.memory-item[data-v-1ded3595] {\n    font-size: 0.75rem;\n    padding-left: 0.8rem;\n}\n}\n\n/* 分页控制样式 */\n.pagination-controls[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1.25rem;\n  padding: 1.25rem 1.5rem;\n  background: rgba(var(--color-surface-rgb), 0.6);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.2);\n  border-radius: 12px;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  backdrop-filter: blur(8px);\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);\n}\n.pagination-controls.bottom[data-v-1ded3595] {\n  margin-top: 1.25rem;\n  margin-bottom: 0;\n}\n.pagination-info[data-v-1ded3595] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.pagination-buttons[data-v-1ded3595] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.page-btn[data-v-1ded3595] {\n  background: var(--color-surface);\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 8px;\n  padding: 0.6rem 0.85rem;\n  cursor: pointer;\n  font-size: 1rem;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  min-width: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n.page-btn[data-v-1ded3595]:hover:not(:disabled) {\n  background: var(--color-surface-light);\n  border-color: rgba(59, 130, 246, 0.5);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 10px rgba(59, 130, 246, 0.15);\n}\n.page-btn[data-v-1ded3595]:disabled {\n  opacity: 0.35;\n  cursor: not-allowed;\n  filter: grayscale(0.3);\n}\n.pagination-jump[data-v-1ded3595] {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n.jump-input[data-v-1ded3595] {\n  width: 75px;\n  padding: 0.6rem 0.75rem;\n  border: 1.5px solid rgba(var(--color-border-rgb), 0.4);\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.875rem;\n  text-align: center;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n  font-weight: 500;\n}\n.jump-input[data-v-1ded3595]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);\n}\n.jump-btn[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  padding: 0.6rem 1.25rem;\n  cursor: pointer;\n  font-size: 0.875rem;\n  font-weight: 600;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  white-space: nowrap;\n  box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);\n  letter-spacing: 0.3px;\n}\n.jump-btn[data-v-1ded3595]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 14px rgba(59, 130, 246, 0.3);\n  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);\n}\n.vector-toolbar[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.vector-status[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.status-subtext[data-v-1ded3595] {\n  flex-basis: 100%;\n  margin-left: 1.5rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.status-subtext.warning[data-v-1ded3595] {\n  color: var(--color-warning);\n}\n.status-dot[data-v-1ded3595] {\n  width: 10px;\n  height: 10px;\n  border-radius: 999px;\n  background: var(--color-warning);\n  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15);\n}\n.status-dot.enabled[data-v-1ded3595] {\n  background: var(--color-success);\n  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15);\n}\n.vector-actions[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.vector-content[data-v-1ded3595] {\n  padding: 1rem;\n}\n.vector-stats[data-v-1ded3595] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.75rem 1rem;\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  background: var(--color-surface);\n}\n.stats-item[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: var(--color-text);\n}\n.stats-label[data-v-1ded3595] {\n  opacity: 0.7;\n}\n.stats-value[data-v-1ded3595] {\n  font-weight: 600;\n}\n.vector-list[data-v-1ded3595] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-top: 0.75rem;\n}\n.vector-card[data-v-1ded3595] {\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 0.75rem;\n  background: var(--color-surface);\n}\n.vector-card-header[data-v-1ded3595] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.vector-badges[data-v-1ded3595] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.vector-badge[data-v-1ded3595] {\n  font-size: 0.8rem;\n  padding: 0.2rem 0.5rem;\n  border-radius: 999px;\n  background: rgba(var(--color-primary-rgb), 0.12);\n  color: var(--color-primary);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n}\n.vector-badge.secondary[data-v-1ded3595] {\n  background: rgba(148, 163, 184, 0.12);\n  color: var(--color-text);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n}\n.vector-time[data-v-1ded3595] {\n  font-size: 0.8rem;\n  opacity: 0.75;\n}\n.vector-tags[data-v-1ded3595] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.35rem;\n  margin-bottom: 0.5rem;\n}\n.vector-tag[data-v-1ded3595] {\n  font-size: 0.8rem;\n  padding: 0.15rem 0.45rem;\n  border-radius: 8px;\n  background: rgba(59, 130, 246, 0.12);\n  border: 1px solid rgba(59, 130, 246, 0.2);\n  color: var(--color-text);\n}\n.vector-text[data-v-1ded3595] {\n  white-space: pre-wrap;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n@media (max-width: 640px) {\n.pagination-controls[data-v-1ded3595] {\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.pagination-info[data-v-1ded3595] {\n    width: 100%;\n    text-align: center;\n}\n.pagination-buttons[data-v-1ded3595] {\n    width: 100%;\n    justify-content: center;\n}\n.pagination-jump[data-v-1ded3595] {\n    width: 100%;\n    justify-content: center;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .filter-tab[data-v-1ded3595] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n  color: #475569;\n}\n[data-theme="light"] .filter-tab[data-v-1ded3595]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.4);\n  color: #1e293b;\n}\n[data-theme="light"] .filter-tab.active[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: #3b82f6;\n  color: white;\n}\n[data-theme="light"] .settings-toggle-btn[data-v-1ded3595] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n  color: #475569;\n}\n[data-theme="light"] .settings-toggle-btn[data-v-1ded3595]:hover,\n[data-theme="light"] .settings-toggle-btn.active[data-v-1ded3595] {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #2563eb;\n}\n[data-theme="light"] .memory-card[data-v-1ded3595] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .memory-card[data-v-1ded3595]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);\n}\n[data-theme="light"] .export-btn-main[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n}\n[data-theme="light"] .export-btn-main[data-v-1ded3595]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n}\n\n/* ========== 深色主题适配 ========== */\n[data-theme="dark"] .filter-tab[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #cbd5e1;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n}\n[data-theme="dark"] .filter-tab[data-v-1ded3595]:hover {\n  background: rgba(51, 65, 85, 0.95);\n  border-color: rgba(59, 130, 246, 0.5);\n  color: #f1f5f9;\n}\n[data-theme="dark"] .filter-tab.active[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: transparent;\n  color: white;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .filter-tab .tab-count[data-v-1ded3595] {\n  background: rgba(59, 130, 246, 0.25);\n  color: #93c5fd;\n}\n[data-theme="dark"] .filter-tab.active .tab-count[data-v-1ded3595] {\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n}\n[data-theme="dark"] .settings-toggle-btn[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #94a3b8;\n}\n[data-theme="dark"] .settings-toggle-btn[data-v-1ded3595]:hover,\n[data-theme="dark"] .settings-toggle-btn.active[data-v-1ded3595] {\n  background: rgba(59, 130, 246, 0.2);\n  border-color: #3b82f6;\n  color: #93c5fd;\n}\n[data-theme="dark"] .memory-card[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .memory-card[data-v-1ded3595]:hover {\n  border-color: rgba(59, 130, 246, 0.4);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);\n}\n[data-theme="dark"] .export-section[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .export-btn-main[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n[data-theme="dark"] .export-btn-main[data-v-1ded3595]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .pagination-controls[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .page-btn[data-v-1ded3595] {\n  background: rgba(51, 65, 85, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .page-btn[data-v-1ded3595]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.2);\n  border-color: #3b82f6;\n}\n[data-theme="dark"] .jump-input[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .jump-btn[data-v-1ded3595] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n}\n[data-theme="dark"] .settings-section[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .settings-header[data-v-1ded3595] {\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .vector-card[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .vector-stats[data-v-1ded3595] {\n  background: rgba(30, 41, 59, 0.9);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n',""]);const s=i},4917:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.raw-data-container[data-v-0718c71e] {\n  background-color: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  padding: 1rem;\n  max-height: 600px;\n  overflow-y: auto;\n  font-size: 0.8rem;\n}\n.raw-data-container pre[data-v-0718c71e] {\n  white-space: pre-wrap;\n  word-break: break-all;\n  margin: 0;\n}\n.spirit-stones-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 0.75rem;\n}\n.spirit-stone-item[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  font-size: 0.85rem;\n}\n.spirit-stone-item span[data-v-0718c71e]:first-child {\n  color: var(--color-text-secondary);\n}\n.spirit-stone-item span[data-v-0718c71e]:last-child {\n  font-weight: 600;\n  color: var(--color-primary);\n}\n.relationship-network-panel[data-v-0718c71e] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n.panel-content[data-v-0718c71e] {\n  flex: 1;\n  overflow: hidden;\n}\n.relationships-container[data-v-0718c71e] {\n  height: 100%;\n  display: flex;\n  background: var(--color-surface);\n  overflow: hidden;\n}\n.relationship-list[data-v-0718c71e] {\n  width: 280px; /* 窄一点 */\n  border-right: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n}\n.list-header[data-v-0718c71e] {\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.panel-title[data-v-0718c71e] {\n  margin: 0 0 1rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-primary);\n  text-align: center;\n}\n.search-bar[data-v-0718c71e] {\n  position: relative;\n  display: flex;\n  align-items: center;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.5rem;\n}\n.search-bar svg[data-v-0718c71e] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.search-input[data-v-0718c71e] {\n  flex: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.list-content[data-v-0718c71e] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n.loading-state[data-v-0718c71e],\n.empty-state[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-0718c71e] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.empty-text[data-v-0718c71e] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-0718c71e] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n}\n.person-list[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.person-card[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  padding: 0.75rem; /* 更紧凑 */\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.person-card[data-v-0718c71e]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);\n  transform: translateY(-1px);\n}\n.person-card.selected[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n  border-color: var(--color-primary);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\n}\n.person-avatar[data-v-0718c71e] {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  margin-right: 0.75rem;\n  flex-shrink: 0;\n  background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.avatar-text[data-v-0718c71e] {\n  font-size: 1.2rem;\n}\n.person-info[data-v-0718c71e] {\n  flex: 1;\n  min-width: 0;\n}\n.person-name[data-v-0718c71e] {\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.5rem;\n  font-size: 1rem;\n}\n.person-meta[data-v-0718c71e] {\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n.relationship-type[data-v-0718c71e] {\n  background: rgba(59, 130, 246, 0.1);\n  color: var(--color-primary);\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.attention-toggle[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: rgba(156, 163, 175, 0.1);\n  border: 1px solid rgba(156, 163, 175, 0.2);\n  padding: 0;\n  outline: none;\n  position: relative;\n  z-index: 100;\n  pointer-events: auto;\n}\n.attention-toggle[data-v-0718c71e]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n  transform: scale(1.1);\n}\n.attention-icon[data-v-0718c71e] {\n  transition: all 0.2s ease;\n}\n.attention-icon.active[data-v-0718c71e] {\n  color: #22c55e;\n}\n.attention-icon.inactive[data-v-0718c71e] {\n  color: #9ca3af;\n}\n.attention-toggle:hover .attention-icon.inactive[data-v-0718c71e] {\n  color: #3b82f6;\n}\n.attention-toggle:hover .attention-icon.active[data-v-0718c71e] {\n  color: #16a34a;\n}\n.person-realm[data-v-0718c71e] {\n  margin-bottom: 0.5rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.person-realm .realm-label[data-v-0718c71e] {\n  margin-right: 0.25rem;\n}\n.person-realm .realm-value[data-v-0718c71e] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.intimacy-info[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.intimacy-bar[data-v-0718c71e] {\n  flex: 1;\n  height: 4px;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.intimacy-fill[data-v-0718c71e] {\n  height: 100%;\n  border-radius: 2px;\n  transition: width 0.3s ease;\n}\n.intimacy-high[data-v-0718c71e] {\n  background: linear-gradient(90deg, #22c55e, #16a34a);\n}\n.intimacy-good[data-v-0718c71e] {\n  background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n}\n.intimacy-medium[data-v-0718c71e] {\n  background: linear-gradient(90deg, #8b5cf6, #7c3aed);\n}\n.intimacy-low[data-v-0718c71e] {\n  background: linear-gradient(90deg, #f59e0b, #d97706);\n}\n.intimacy-neutral[data-v-0718c71e] {\n  background: linear-gradient(90deg, #6b7280, #4b5563);\n}\n.intimacy-dislike[data-v-0718c71e] {\n  background: linear-gradient(90deg, #f97316, #ea580c);\n}\n.intimacy-hostile[data-v-0718c71e] {\n  background: linear-gradient(90deg, #dc2626, #b91c1c);\n}\n.intimacy-enemy[data-v-0718c71e] {\n  background: linear-gradient(90deg, #ef4444, #dc2626);\n}\n.intimacy-value[data-v-0718c71e] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  min-width: 30px;\n  text-align: right;\n}\n.arrow-icon[data-v-0718c71e] {\n  color: var(--color-border-hover);\n  transition: transform 0.2s;\n}\n.person-card.selected .arrow-icon[data-v-0718c71e] {\n  transform: rotate(90deg);\n  color: var(--color-primary);\n}\n.relationship-detail[data-v-0718c71e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0; /* 关键修复：允许flex项收缩，防止内容溢出 */\n  overflow: hidden; /* 隐藏所有溢出，滚动由子元素处理 */\n}\n.detail-header[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.detail-avatar[data-v-0718c71e] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 1.5rem;\n  background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n  flex-shrink: 0;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);\n}\n.detail-info[data-v-0718c71e] {\n  flex: 1;\n  min-width: 0; /* 允许flex项收缩，防止长名称撑开容器 */\n}\n.detail-name[data-v-0718c71e] {\n  margin: 0 0 0.5rem 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: var(--color-text);\n  word-break: break-all; /* 强制长名称换行 */\n}\n.detail-badges[data-v-0718c71e] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.relationship-badge[data-v-0718c71e],\n.intimacy-badge[data-v-0718c71e],\n.race-badge[data-v-0718c71e],\n.faction-badge[data-v-0718c71e] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.relationship-badge[data-v-0718c71e] {\n  background: rgba(59, 130, 246, 0.1);\n  color: var(--color-primary);\n}\n.race-badge[data-v-0718c71e] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n  border: 1px solid rgba(34, 197, 94, 0.3);\n}\n.faction-badge[data-v-0718c71e] {\n  background: rgba(168, 85, 247, 0.1);\n  color: #a855f7;\n  border: 1px solid rgba(168, 85, 247, 0.3);\n}\n.detail-body[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  flex: 1; /* 占据剩余空间 */\n  min-height: 0; /* 允许收缩 */\n  overflow-y: auto; /* 内容溢出时滚动 */\n  padding: 1rem;\n}\n.tab-content[data-v-0718c71e] {\n  animation: fadeIn-0718c71e 0.3s ease;\n}\n@keyframes fadeIn-0718c71e {\nfrom {\n    opacity: 0;\n    transform: translateY(10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.empty-state-small[data-v-0718c71e] {\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-style: italic;\n}\n.detail-section[data-v-0718c71e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.section-title[data-v-0718c71e] {\n  margin: 0 0 1rem 0;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.info-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 1rem;\n}\n.info-grid-2col[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.info-item[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.info-label[data-v-0718c71e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-0718c71e] {\n  font-size: 0.875rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.memory-list[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 1rem;\n}\n.memory-header[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n}\n.summary-mode-hint[data-v-0718c71e] {\n  margin-top: 0.75rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.08);\n  border-left: 3px solid #3b82f6;\n  border-radius: 4px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.summary-mode-hint strong[data-v-0718c71e] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.memory-actions-header[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.memory-count[data-v-0718c71e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: rgba(59, 130, 246, 0.1);\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-weight: 500;\n}\n.memory-controls-group[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.download-memory-btn[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.download-memory-btn[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.summarize-controls[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.summarize-input[data-v-0718c71e] {\n  width: 60px;\n  padding: 0.375rem 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.75rem;\n  text-align: center;\n  transition: all 0.2s ease;\n}\n.summarize-input[data-v-0718c71e]:focus {\n  outline: none;\n  border-color: #8b5cf6;\n  box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);\n}\n.summarize-btn[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.summarize-btn[data-v-0718c71e]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #7c3aed, #6d28d9);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);\n}\n.summarize-btn[data-v-0718c71e]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n.memory-summary-list[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n.memory-summary-item[data-v-0718c71e] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(124, 58, 237, 0.05));\n  border-radius: 8px;\n  border-left: 3px solid #8b5cf6;\n}\n.summary-icon[data-v-0718c71e] {\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n.summary-text[data-v-0718c71e] {\n  flex: 1;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n.memory-pagination[data-v-0718c71e] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 1rem;\n  padding-top: 0.75rem;\n  border-top: 1px solid var(--color-border);\n  margin-top: 1rem;\n}\n.pagination-btn[data-v-0718c71e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.5rem 1rem;\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.pagination-btn[data-v-0718c71e]:hover:not(:disabled) {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.pagination-btn[data-v-0718c71e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.pagination-controls[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n}\n.pagination-info[data-v-0718c71e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  text-align: center;\n}\n.jump-to-page[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.page-input[data-v-0718c71e] {\n  width: 60px;\n  padding: 0.375rem 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.75rem;\n  text-align: center;\n  transition: all 0.2s ease;\n}\n.page-input[data-v-0718c71e]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n.jump-btn[data-v-0718c71e] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n.jump-btn[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.memory-summary-section[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(124, 58, 237, 0.08));\n  border-left: 4px solid #8b5cf6;\n}\n.memory-item[data-v-0718c71e] {\n  display: flex;\n  align-items: flex-start;\n  gap: 8px;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border-left: 3px solid var(--color-primary);\n  font-size: 0.85rem;\n  line-height: 1.4;\n  color: var(--color-text-secondary);\n}\n.memory-content[data-v-0718c71e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.memory-time[data-v-0718c71e] {\n  font-size: 0.75rem;\n  color: var(--color-primary);\n  font-weight: 600;\n  opacity: 0.8;\n}\n.memory-event[data-v-0718c71e] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  line-height: 1.5;\n}\n.memory-actions[data-v-0718c71e] {\n  display: flex;\n  gap: 6px;\n}\n.memory-btn[data-v-0718c71e] {\n  padding: 4px 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  font-size: 12px;\n  cursor: pointer;\n  background: var(--color-background);\n}\n.memory-btn.edit[data-v-0718c71e] {\n  color: #2563eb;\n  border-color: #bfdbfe;\n}\n.memory-btn.delete[data-v-0718c71e] {\n  color: #dc2626;\n  border-color: #fecaca;\n}\n\n/* 简化：外貌描述样式 */\n.appearance-description[data-v-0718c71e] {\n  padding: 1rem;\n  background: rgba(147, 51, 234, 0.05);\n  border-radius: 8px;\n  border-left: 3px solid #9333ea;\n}\n.description-text[data-v-0718c71e] {\n  font-size: 0.875rem;\n  line-height: 1.6;\n  color: var(--color-text);\n  margin: 0;\n  font-style: italic;\n}\n.subsection-title[data-v-0718c71e] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.talents-grid[data-v-0718c71e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.talent-tag[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));\n  color: #3b82f6;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n.attributes-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n  gap: 0.75rem;\n}\n.attribute-item[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.attr-label[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.25rem;\n  font-weight: 500;\n}\n.attr-value[data-v-0718c71e] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n\n/* NPC物品样式 */\n.npc-inventory[data-v-0718c71e] {\n  margin-top: 0.75rem;\n}\n.npc-items-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  gap: 0.75rem;\n}\n.npc-item-card[data-v-0718c71e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.75rem;\n  transition: all 0.2s ease;\n}\n.npc-item-card[data-v-0718c71e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.npc-item-card.quality-凡[data-v-0718c71e] {\n  border-left: 3px solid #6b7280;\n}\n.npc-item-card.quality-黄[data-v-0718c71e] {\n  border-left: 3px solid #f59e0b;\n}\n.npc-item-card.quality-玄[data-v-0718c71e] {\n  border-left: 3px solid #8b5cf6;\n}\n.npc-item-card.quality-地[data-v-0718c71e] {\n  border-left: 3px solid #06b6d4;\n}\n.npc-item-card.quality-天[data-v-0718c71e] {\n  border-left: 3px solid #ec4899;\n}\n.npc-item-card.quality-仙[data-v-0718c71e] {\n  border-left: 3px solid #f59e0b;\n  box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);\n}\n.npc-item-card.quality-神[data-v-0718c71e] {\n  border-left: 3px solid #9333ea;\n  box-shadow: 0 0 15px rgba(147, 51, 234, 0.4);\n}\n.item-header[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 0.5rem;\n}\n.item-name[data-v-0718c71e] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.item-type[data-v-0718c71e] {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  padding: 0.125rem 0.375rem;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 500;\n}\n.item-quality[data-v-0718c71e] {\n  margin-bottom: 0.5rem;\n}\n.quality-text[data-v-0718c71e] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.item-quantity[data-v-0718c71e] {\n  text-align: right;\n  margin-bottom: 0.5rem;\n  font-size: 0.8rem;\n  /* 使用主题主色，增强与卡片背景的对比度 */\n  color: var(--color-primary);\n  font-weight: 700;\n}\n.item-description[data-v-0718c71e] {\n  margin-bottom: 0.75rem;\n}\n.item-description p[data-v-0718c71e] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n}\n.item-actions[data-v-0718c71e] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.trade-btn[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #059669, #047857);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.trade-btn[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, #047857, #065f46);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);\n}\n.trade-btn[data-v-0718c71e]:active {\n  transform: translateY(0);\n}\n.request-btn[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.request-btn[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n}\n.request-btn[data-v-0718c71e]:active {\n  transform: translateY(0);\n}\n.steal-btn[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  background: linear-gradient(135deg, #dc2626, #b91c1c);\n  color: white;\n  border: none;\n  padding: 0.375rem 0.75rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.steal-btn[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, #b91c1c, #991b1b);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);\n}\n.steal-btn[data-v-0718c71e]:active {\n  transform: translateY(0);\n}\n.empty-inventory[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.empty-inventory .empty-icon[data-v-0718c71e] {\n  margin-bottom: 0.75rem;\n  opacity: 0.5;\n}\n.no-selection[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.placeholder-icon[data-v-0718c71e] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.placeholder-text[data-v-0718c71e] {\n  font-size: 1rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n.placeholder-hint[data-v-0718c71e] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n.animate-spin[data-v-0718c71e] {\n  animation: spin-0718c71e 1s linear infinite;\n}\n@keyframes spin-0718c71e {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* === NSFW 私密信息样式 === */\n.nsfw-section[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(236, 72, 153, 0.05), rgba(219, 39, 119, 0.05));\n  border: 2px solid rgba(236, 72, 153, 0.3);\n}\n.nsfw-subsection[data-v-0718c71e] {\n  margin-bottom: 1rem;\n}\n.nsfw-subsection[data-v-0718c71e]:last-child {\n  margin-bottom: 0;\n}\n.development-bars[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.dev-bar-item[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.dev-bar-header[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.8rem;\n}\n.dev-label[data-v-0718c71e] {\n  color: var(--color-text);\n  font-weight: 500;\n}\n.dev-value[data-v-0718c71e] {\n  color: #ec4899;\n  font-weight: 700;\n  font-size: 0.75rem;\n}\n.dev-bar-track[data-v-0718c71e] {\n  height: 8px;\n  background: rgba(236, 72, 153, 0.1);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.dev-bar-fill[data-v-0718c71e] {\n  height: 100%;\n  background: linear-gradient(90deg, #ec4899, #db2777);\n  border-radius: 4px;\n  transition: width 0.3s ease;\n}\n.status-badge[data-v-0718c71e] {\n  display: inline-block;\n  padding: 0.25rem 0.5rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.status-正常[data-v-0718c71e] {\n  background: rgba(107, 114, 128, 0.2);\n  color: #6b7280;\n}\n.status-微湿[data-v-0718c71e] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #3b82f6;\n}\n.status-发情[data-v-0718c71e] {\n  background: rgba(236, 72, 153, 0.2);\n  color: #ec4899;\n}\n.status-高潮[data-v-0718c71e] {\n  background: rgba(220, 38, 38, 0.2);\n  color: #dc2626;\n}\n.status-贤者时间[data-v-0718c71e] {\n  background: rgba(139, 92, 246, 0.2);\n  color: #8b5cf6;\n}\n.fetish-tag[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(219, 39, 119, 0.15));\n  color: #ec4899;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(236, 72, 153, 0.3);\n}\n.partner-tag[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(236, 72, 153, 0.12), rgba(219, 39, 119, 0.12));\n  color: #db2777;\n  padding: 0.3rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 500;\n  border: 1px solid rgba(236, 72, 153, 0.25);\n}\n.partner-list[data-v-0718c71e] {\n  margin-top: 0.75rem;\n}\n.toggle-more-btn[data-v-0718c71e] {\n  margin-top: 0.75rem;\n  background: rgba(236, 72, 153, 0.08);\n  border: 1px solid rgba(236, 72, 153, 0.25);\n  color: #db2777;\n  padding: 0.35rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.toggle-more-btn[data-v-0718c71e]:hover {\n  background: rgba(236, 72, 153, 0.12);\n  border-color: rgba(236, 72, 153, 0.35);\n}\n.pregnancy-info[data-v-0718c71e] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.pregnancy-active[data-v-0718c71e] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n}\n.pregnancy-icon[data-v-0718c71e] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.pregnancy-details[data-v-0718c71e] {\n  flex: 1;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.6;\n}\n.pregnancy-inactive[data-v-0718c71e] {\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n}\n.first-time-info[data-v-0718c71e] {\n  padding: 0.75rem;\n  background: rgba(236, 72, 153, 0.05);\n  border-radius: 6px;\n  border-left: 3px solid #ec4899;\n  font-size: 0.85rem;\n  color: var(--color-text);\n}\n\n/* 实时状态高亮区域（通用）*/\n.highlight-section[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  border-radius: 8px;\n  padding: 1rem;\n  border: 1px solid rgba(59, 130, 246, 0.15);\n}\n.realtime-status[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.status-item[data-v-0718c71e] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.status-icon[data-v-0718c71e] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n  line-height: 1;\n}\n.status-content[data-v-0718c71e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.status-label[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.status-text[data-v-0718c71e] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.5;\n  font-style: italic;\n}\n.desire-fill[data-v-0718c71e] {\n  background: linear-gradient(90deg, #f59e0b, #dc2626);\n}\n.mini-label[data-v-0718c71e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n\n/* 性经验统计 */\n.experience-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.exp-item[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.exp-icon[data-v-0718c71e] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.exp-content[data-v-0718c71e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.exp-label[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.exp-value[data-v-0718c71e] {\n  font-size: 0.95rem;\n  color: #ec4899;\n  font-weight: 700;\n}\n.last-time-info[data-v-0718c71e] {\n  padding: 0.5rem 0.75rem;\n  background: rgba(236, 72, 153, 0.05);\n  border-radius: 4px;\n  font-size: 0.8rem;\n  text-align: center;\n}\n.last-time-label[data-v-0718c71e] {\n  color: var(--color-text-secondary);\n  margin-right: 0.5rem;\n}\n.last-time-value[data-v-0718c71e] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n\n/* 身体部位列表 */\n.body-parts-list[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.body-part-item[data-v-0718c71e] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  border: 1px solid var(--color-border);\n}\n.part-header[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.part-name[data-v-0718c71e] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.part-mark[data-v-0718c71e] {\n  font-size: 0.7rem;\n  padding: 0.125rem 0.375rem;\n  background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(219, 39, 119, 0.2));\n  color: #ec4899;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.part-description[data-v-0718c71e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  margin-bottom: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(236, 72, 153, 0.05);\n  border-radius: 4px;\n  line-height: 1.4;\n}\n.part-stats[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.part-stat[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.stat-label[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  min-width: 50px;\n}\n.stat-bar-mini[data-v-0718c71e] {\n  flex: 1;\n  height: 6px;\n  background: rgba(236, 72, 153, 0.1);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.stat-bar-fill[data-v-0718c71e] {\n  height: 100%;\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n.stat-bar-fill.sensitivity[data-v-0718c71e] {\n  background: linear-gradient(90deg, #f59e0b, #ec4899);\n}\n.stat-bar-fill.development[data-v-0718c71e] {\n  background: linear-gradient(90deg, #8b5cf6, #ec4899);\n}\n.stat-value[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: #ec4899;\n  font-weight: 700;\n  min-width: 35px;\n  text-align: right;\n}\n\n/* 体液状态 */\n.fluid-status[data-v-0718c71e] {\n  padding: 0.75rem;\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(236, 72, 153, 0.08));\n  border-radius: 6px;\n  border-left: 3px solid #3b82f6;\n  font-size: 0.85rem;\n  color: var(--color-text);\n  font-style: italic;\n}\n\n/* 特殊体质标签 */\n.special-trait-tag[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(236, 72, 153, 0.15));\n  color: #a855f7;\n  padding: 0.25rem 0.5rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid rgba(168, 85, 247, 0.3);\n}\n\n/* ========== 人格底线样式 ========== */\n.personality-section[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(249, 115, 22, 0.08));\n  border-left: 4px solid #ef4444;\n}\n.personality-bottomlines[data-v-0718c71e] {\n  margin-bottom: 0.75rem;\n}\n.bottomline-tags[data-v-0718c71e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.bottomline-tag[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(249, 115, 22, 0.15));\n  color: #ef4444;\n  padding: 0.4rem 0.75rem;\n  border-radius: 8px;\n  font-size: 0.85rem;\n  font-weight: 600;\n  border: 1.5px solid rgba(239, 68, 68, 0.4);\n  display: inline-flex;\n  align-items: center;\n  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);\n  transition: all 0.2s ease;\n}\n.bottomline-tag[data-v-0718c71e]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);\n  border-color: rgba(239, 68, 68, 0.6);\n}\n.bottomline-empty[data-v-0718c71e] {\n  color: var(--text-secondary);\n  font-style: italic;\n  font-size: 0.875rem;\n  padding: 0.5rem 0;\n}\n.bottomline-warning[data-v-0718c71e] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  padding: 0.75rem;\n  border-radius: 8px;\n  border: 1px solid rgba(239, 68, 68, 0.3);\n}\n.warning-icon[data-v-0718c71e] {\n  font-size: 1.1rem;\n  color: #f59e0b;\n  flex-shrink: 0;\n  animation: pulse-0718c71e 2s infinite;\n}\n@keyframes pulse-0718c71e {\n0%,\n  100% {\n    opacity: 1;\n    transform: scale(1);\n}\n50% {\n    opacity: 0.6;\n    transform: scale(1.1);\n}\n}\n.warning-text[data-v-0718c71e] {\n  color: #dc2626;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  font-weight: 500;\n}\n\n/* ========== Tab导航样式 ========== */\n.detail-tabs[data-v-0718c71e] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0 0 1rem 0;\n  border-bottom: 2px solid var(--color-border);\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n}\n.tab-btn[data-v-0718c71e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px 8px 0 0;\n  padding: 0.5rem 1rem;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  position: relative;\n  outline: none;\n}\n.tab-btn[data-v-0718c71e]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-text);\n  transform: translateY(-2px);\n}\n.tab-btn.active[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  font-weight: 600;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);\n}\n.tab-btn.active[data-v-0718c71e]::after {\n  content: '';\n  position: absolute;\n  bottom: -2px;\n  left: 0;\n  right: 0;\n  height: 2px;\n  background: var(--color-primary);\n}\n.tab-panel[data-v-0718c71e] {\n  animation: fadeIn-0718c71e 0.3s ease;\n}\n\n/* ========== 响应式2列布局样式 ========== */\n.info-grid-responsive[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 8px;\n}\n\n/* 小屏幕时切换为单列 */\n@media (max-width: 500px) {\n.info-grid-responsive[data-v-0718c71e] {\n    grid-template-columns: 1fr;\n}\n}\n.info-item-row[data-v-0718c71e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 6px 10px;\n  background: transparent;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n  transition: background 0.2s ease;\n}\n.info-item-row[data-v-0718c71e]:hover {\n  background: rgba(59, 130, 246, 0.03);\n}\n.info-item-row .info-label[data-v-0718c71e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n  min-width: 50px;\n}\n.info-item-row .info-value[data-v-0718c71e] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  text-align: right;\n  flex: 1;\n  word-break: break-word;\n}\n\n/* ========== NPC记忆列表样式 ========== */\n.npc-memories-list[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.npc-memory-item[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(234, 179, 8, 0.05), rgba(249, 115, 22, 0.05));\n  border-left: 3px solid #eab308;\n  border-radius: 4px;\n  padding: 10px 12px;\n  transition: all 0.2s ease;\n}\n.npc-memory-item[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, rgba(234, 179, 8, 0.1), rgba(249, 115, 22, 0.1));\n  transform: translateX(4px);\n  box-shadow: 0 2px 6px rgba(234, 179, 8, 0.15);\n}\n.npc-memory-content[data-v-0718c71e] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  line-height: 1.5;\n}\n\n/* ========== NPC六司属性样式 ========== */\n.npc-attributes-container[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.npc-attr-group[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  border-radius: 8px;\n  padding: 10px;\n}\n.npc-attr-group-title[data-v-0718c71e] {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--color-primary);\n  margin-bottom: 8px;\n  padding-left: 4px;\n}\n.npc-attr-grid[data-v-0718c71e] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 6px;\n}\n.npc-attr-item[data-v-0718c71e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 6px 4px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 6px;\n  border: 1px solid transparent;\n  transition: all 0.2s ease;\n}\n.npc-attr-item[data-v-0718c71e]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n  transform: translateY(-2px);\n}\n.npc-attr-item.final[data-v-0718c71e] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(147, 51, 234, 0.12));\n}\n.npc-attr-item.final[data-v-0718c71e]:hover {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 51, 234, 0.2));\n}\n.npc-attr-label[data-v-0718c71e] {\n  font-size: 0.7rem;\n  color: var(--text-secondary);\n  margin-bottom: 2px;\n  font-weight: 500;\n}\n.npc-attr-value[data-v-0718c71e] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n.name-and-actions[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n.delete-npc-btn[data-v-0718c71e] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.delete-npc-btn[data-v-0718c71e]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: #ef4444;\n  color: #ef4444;\n  transform: scale(1.1);\n}\n.action-buttons[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.action-btn[data-v-0718c71e] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.action-btn.download-btn[data-v-0718c71e]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #3b82f6;\n  transform: scale(1.1);\n}\n.action-btn.export-btn[data-v-0718c71e]:hover {\n  background: rgba(16, 185, 129, 0.1);\n  border-color: #10b981;\n  color: #10b981;\n  transform: scale(1.1);\n}\n.card-actions[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  position: relative;\n  z-index: 10;\n  pointer-events: auto;\n}\n.delete-btn-card[data-v-0718c71e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: rgba(156, 163, 175, 0.1);\n  border: 1px solid rgba(156, 163, 175, 0.2);\n  color: #9ca3af;\n  padding: 0;\n  outline: none;\n  position: relative;\n  z-index: 100;\n  pointer-events: auto;\n}\n.delete-btn-card[data-v-0718c71e]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: #ef4444;\n  color: #ef4444;\n  transform: scale(1.1);\n}\n.back-to-list-btn[data-v-0718c71e] {\n  display: none; /* 默认隐藏 */\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  border-radius: 50%;\n  width: 32px;\n  height: 32px;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n  margin-right: 0.5rem;\n}\n.back-to-list-btn[data-v-0718c71e]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n@media (max-width: 768px) {\n.relationships-container[data-v-0718c71e] {\n    position: relative;\n    overflow: hidden;\n}\n.relationship-list[data-v-0718c71e],\n  .relationship-detail[data-v-0718c71e] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    transition: transform 0.3s ease-in-out;\n    backface-visibility: hidden;\n}\n.relationship-list[data-v-0718c71e] {\n    transform: translateX(0);\n    z-index: 10;\n}\n.relationship-detail[data-v-0718c71e] {\n    transform: translateX(100%);\n    z-index: 20;\n    border-left: none; /* 移除左边框 */\n}\n.relationships-container.details-active .relationship-list[data-v-0718c71e] {\n    transform: translateX(-100%);\n}\n.relationships-container.details-active .relationship-detail[data-v-0718c71e] {\n    transform: translateX(0);\n}\n.back-to-list-btn[data-v-0718c71e] {\n    display: flex; /* 在移动端显示 */\n}\n.detail-header[data-v-0718c71e] {\n    padding: 0.75rem 1rem;\n}\n}\n",""]);const s=i},4954:(e,t,n)=>{"use strict";n.d(t,{generateWorldEvent:()=>s});var a=n(236),r=n(7203),o=n(758);const i=()=>`event_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;async function s(e){try{const{saveData:t,now:n,customPrompt:s}=e,l=t?.角色?.身份?.名字||t?.角色?.名字||"无名修士",c=t?.角色?.属性?.境界?.名称||"凡人",d=t?.角色?.属性?.境界?.阶段||"",u=t?.角色?.位置?.描述||"未知",m=Number(t?.角色?.属性?.声望??0),p=t?.社交?.关系||{},g=Object.values(p).filter(e=>e&&"object"==typeof e).map(e=>({名字:String(e.名字||""),与玩家关系:String(e.与玩家关系||""),好感度:Number(e.好感度??0),境界:e.境界?`${e.境界.名称||""}${e.境界.阶段?"-"+e.境界.阶段:""}`:""})).filter(e=>e.名字).sort((e,t)=>t.好感度-e.好感度).slice(0,6),h=(await(0,r.XH)("eventGeneration")).trim(),f=s&&String(s).trim()?`\n\n## 额外要求\n${String(s).trim()}`:"",v=`${h}\n\n---\n\n${`\n# 当前状态\n- 时间: ${n.年}年${n.月}月${n.日}日 ${String(n.小时).padStart(2,"0")}:${String(n.分钟).padStart(2,"0")}\n- 玩家: ${l}\n- 境界: ${c}${d?"-"+d:""}\n- 位置: ${u}\n- 声望: ${m}\n\n# 玩家关系（好感度Top）\n${g.length?g.map(e=>`- ${e.名字} | 关系:${e.与玩家关系||"未知"} | 好感:${e.好感度} | 境界:${e.境界||"未知"}`).join("\n"):"- （暂无）"}\n`.trim()}${f}`.trim(),b=await(0,a.e)("生成一个会影响玩家的世界事件",v,!1,"event_generation"),y=(0,o.p)(b),x=y?.event,k=String(y?.prompt_addition||"").trim();return x&&"object"==typeof x&&k?{event:{事件ID:String(x.事件ID||i()),事件名称:String(x.事件名称||"无名事件"),事件类型:String(x.事件类型||"世界变革"),事件描述:String(x.事件描述||k),影响等级:x.影响等级?String(x.影响等级):void 0,影响范围:x.影响范围?String(x.影响范围):void 0,相关人物:Array.isArray(x.相关人物)?x.相关人物.map(e=>String(e)).filter(Boolean):void 0,相关势力:Array.isArray(x.相关势力)?x.相关势力.map(e=>String(e)).filter(Boolean):void 0,事件来源:String(x.事件来源||"随机"),发生时间:n},prompt_addition:k}:null}catch(e){return console.error("[事件生成] 生成失败:",e),null}}},5032:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.inventory-content[data-v-28a5e031] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  overflow: hidden;\n}\n\n/* 自定义确认弹窗样式 */\n.custom-confirm-overlay[data-v-28a5e031] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 2000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.custom-confirm-modal[data-v-28a5e031] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-28a5e031 0.3s ease-out;\n  border: 1px solid var(--color-primary-border);\n}\n.confirm-header[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px 16px 24px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.confirm-header h3[data-v-28a5e031] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.confirm-close-btn[data-v-28a5e031] {\n  background: none;\n  border: none;\n  padding: 4px;\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.confirm-close-btn[data-v-28a5e031]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.confirm-content[data-v-28a5e031] {\n  padding: 24px;\n}\n.confirm-content p[data-v-28a5e031] {\n  margin: 0;\n  color: var(--color-text);\n  line-height: 1.6;\n  white-space: pre-line;\n}\n.confirm-actions[data-v-28a5e031] {\n  display: flex;\n  gap: 12px;\n  padding: 16px 24px 24px 24px;\n  justify-content: flex-end;\n}\n.confirm-btn[data-v-28a5e031] {\n  padding: 10px 20px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n}\n.cancel-btn[data-v-28a5e031] {\n  background: var(--color-surface-hover);\n  color: var(--color-text-secondary);\n}\n.cancel-btn[data-v-28a5e031]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.confirm-btn.confirm-btn[data-v-28a5e031] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.confirm-btn.confirm-btn[data-v-28a5e031]:hover {\n  background: var(--color-primary-hover);\n}\n\n/* 移动端模态框 */\n.item-modal-overlay[data-v-28a5e031] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.item-modal[data-v-28a5e031] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-28a5e031 0.3s ease-out;\n  border: 1px solid var(--color-primary-border);\n}\n@keyframes modal-appear-28a5e031 {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.modal-header[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.modal-header h3[data-v-28a5e031] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n.modal-close-btn[data-v-28a5e031] {\n  background: none;\n  border: none;\n  padding: 4px;\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  transition: all 0.2s ease;\n}\n.modal-close-btn[data-v-28a5e031]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.modal-content[data-v-28a5e031] {\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n}\n.modal-icon-simple[data-v-28a5e031] {\n  width: 80px;\n  height: 80px;\n  border-radius: 12px;\n  border: 3px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 16px;\n  background: var(--color-surface-hover);\n  font-weight: bold;\n  font-size: 14px;\n  color: var(--color-text);\n}\n.modal-info[data-v-28a5e031] {\n  width: 100%;\n}\n.modal-meta[data-v-28a5e031] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  margin-bottom: 12px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n.grade-display[data-v-28a5e031] {\n  font-size: 0.8rem;\n  font-weight: bold;\n  padding: 2px 6px;\n  border-radius: 4px;\n  border: 1px solid currentColor;\n  white-space: nowrap;\n}\n\n/* 品级颜色样式 */\n.grade-display.grade-broken[data-v-28a5e031] {\n  background: #6b7280;\n  color: white;\n  border-color: #6b7280;\n}\n.grade-display.grade-low[data-v-28a5e031] {\n  background: #10b981; /* 绿色 - 下品 */\n  color: white;\n  border-color: #10b981;\n}\n.grade-display.grade-mid[data-v-28a5e031] {\n  background: #3b82f6; /* 蓝色 - 中品 */\n  color: white;\n  border-color: #3b82f6;\n}\n.grade-display.grade-high[data-v-28a5e031] {\n  background: #8b5cf6; /* 紫色 - 上品 */\n  color: white;\n  border-color: #8b5cf6;\n}\n.grade-display.grade-perfect[data-v-28a5e031] {\n  background: #f59e0b; /* 金色 - 极品 */\n  color: white;\n  border-color: #f59e0b;\n}\n.grade-display.grade-unknown[data-v-28a5e031] {\n  background: #9ca3af;\n  color: white;\n  border-color: #9ca3af;\n}\n.modal-description[data-v-28a5e031] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin-bottom: 16px;\n}\n.modal-attributes[data-v-28a5e031] {\n  background: var(--color-surface-light);\n  border-radius: 8px;\n  padding: 12px;\n  margin-top: 16px;\n}\n.modal-attributes h4[data-v-28a5e031] {\n  margin: 0 0 8px 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.modal-actions[data-v-28a5e031] {\n  display: flex;\n  gap: 8px;\n  padding: 16px 20px;\n  border-top: 1px solid var(--color-border);\n}\n\n/* 主内容区域 */\n.inventory-content[data-v-28a5e031] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n/* 标签导航 */\n.tabs-header[data-v-28a5e031] {\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n  padding: 16px;\n  flex-shrink: 0;\n  border-radius: 12px 12px 0 0;\n}\n.tabs-nav[data-v-28a5e031] {\n  display: flex;\n  gap: 4px;\n  margin-bottom: 16px;\n}\n.tab-btn[data-v-28a5e031] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-weight: 500;\n}\n.tab-btn[data-v-28a5e031]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-28a5e031] {\n  background: var(--color-primary);\n  color: white;\n}\n\n/* 工具栏 */\n.tools-section[data-v-28a5e031] {\n  display: flex;\n  gap: 12px;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.search-box[data-v-28a5e031] {\n  position: relative;\n  flex: 1;\n  min-width: 150px;\n}\n.search-icon[data-v-28a5e031] {\n  position: absolute;\n  left: 12px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: var(--color-text-secondary);\n  z-index: 1;\n}\n.search-box input[data-v-28a5e031] {\n  width: 100%;\n  padding: 10px 12px 10px 40px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-background);\n  font-size: 14px;\n  transition: all 0.2s ease;\n}\n.search-box input[data-v-28a5e031]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.filter-buttons[data-v-28a5e031] {\n  display: flex;\n  gap: 8px;\n}\n.filter-select[data-v-28a5e031] {\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 13px;\n  min-width: 80px;\n}\n.filter-select option[data-v-28a5e031] {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n.refresh-btn[data-v-28a5e031] {\n  padding: 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-background);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 32px;\n  height: 32px;\n}\n.refresh-btn[data-v-28a5e031]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n  color: var(--color-primary);\n  border-color: var(--color-primary);\n}\n.refresh-btn[data-v-28a5e031]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.refresh-btn .spinning[data-v-28a5e031] {\n  animation: spin-28a5e031 1s linear infinite;\n}\n\n/* 标签内容 */\n.tab-content[data-v-28a5e031] {\n  flex: 1;\n  overflow: hidden;\n}\n\n/* 物品标签 */\n.items-tab[data-v-28a5e031] {\n  display: flex;\n  height: 100%;\n}\n.items-grid[data-v-28a5e031] {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n  gap: 18px;\n  align-content: start;\n  background: var(--color-background);\n}\n.grid-placeholder[data-v-28a5e031] {\n  grid-column: 1 / -1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.filter-tip[data-v-28a5e031] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted);\n  margin-top: 8px;\n  opacity: 0.8;\n}\n.loading-spinner[data-v-28a5e031] {\n  width: 32px;\n  height: 32px;\n  border: 3px solid var(--color-border);\n  border-top: 3px solid var(--color-primary);\n  border-radius: 50%;\n  animation: spin-28a5e031 1s linear infinite;\n  margin-bottom: 16px;\n}\n@keyframes spin-28a5e031 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 物品卡片 - 重新设计美观布局 */\n.item-card[data-v-28a5e031] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  display: flex;\n  flex-direction: column;\n  height: 140px;\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n.item-card[data-v-28a5e031]:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  background: var(--color-surface-light);\n}\n\n/* 顶部区域：图标和品质 */\n.item-top-section[data-v-28a5e031] {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  margin-bottom: 8px;\n}\n.item-icon-area[data-v-28a5e031] {\n  width: 48px;\n  height: 48px;\n  border-radius: 8px;\n  border: 2px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  position: relative;\n}\n.item-type-icon[data-v-28a5e031] {\n  font-size: 24px;\n  opacity: 0.9;\n}\n.item-quality-badge[data-v-28a5e031] {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  font-size: 10px;\n  font-weight: bold;\n  padding: 3px 6px;\n  border-radius: 6px;\n  background: var(--color-surface);\n  border: 1px solid currentColor;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  z-index: 2;\n  min-width: 20px;\n  text-align: center;\n}\n\n/* 数量显示 - 更大更显眼 */\n.item-quantity-display[data-v-28a5e031] {\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  /* 仅改变文字颜色，不改背景 */\n  background: transparent;\n  color: var(--color-accent, #7c4dff);\n  font-size: 12px;\n  font-weight: 700;\n  padding: 0;\n  border-radius: 0;\n  box-shadow: none;\n  border: none;\n  z-index: 4;\n  min-width: 0;\n  text-align: right;\n}\n\n/* 名称区域 */\n.item-name-section[data-v-28a5e031] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 0 4px;\n}\n.item-name[data-v-28a5e031] {\n  font-size: 12px;\n  font-weight: 600;\n  line-height: 1.3;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n  word-break: break-word;\n}\n\n/* 底部区域：类型和品级 */\n.item-bottom-section[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 4px;\n  margin-top: auto;\n  padding-top: 4px;\n}\n.item-type-label[data-v-28a5e031] {\n  font-size: 9px;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 2px 6px;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.item-grade-info[data-v-28a5e031] {\n  font-size: 8px;\n  font-weight: bold;\n  padding: 2px 4px;\n  border-radius: 4px;\n  border: 1px solid currentColor;\n  background: rgba(255, 255, 255, 0.9);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  flex-shrink: 0;\n}\n\n/* 品级样式 - 简化版本 */\n.grade-broken[data-v-28a5e031] {\n  background: #6b7280;\n  color: white;\n}\n.grade-low[data-v-28a5e031] {\n  background: #10b981; /* 绿色 - 下品 */\n  color: white;\n}\n.grade-mid[data-v-28a5e031] {\n  background: #3b82f6; /* 蓝色 - 中品 */\n  color: white;\n}\n.grade-high[data-v-28a5e031] {\n  background: #8b5cf6; /* 紫色 - 上品 */\n  color: white;\n}\n.grade-perfect[data-v-28a5e031] {\n  background: #f59e0b; /* 金色 - 极品 */\n  color: white;\n}\n.grade-unknown[data-v-28a5e031] {\n  background: #9ca3af;\n  color: white;\n}\n\n/* 灵石品质样式 - 颜色递增 */\n.grade-common[data-v-28a5e031] {\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  border-color: #9ca3af;\n  color: white;\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.grade-rare[data-v-28a5e031] {\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border-color: #3b82f6;\n  color: white;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);\n}\n.grade-epic[data-v-28a5e031] {\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n  border-color: #8b5cf6;\n  color: white;\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);\n}\n.grade-legend[data-v-28a5e031] {\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border-color: #f59e0b;\n  color: white;\n  box-shadow: 0 2px 12px rgba(245, 158, 11, 0.5);\n}\n\n/* 桌面端详情侧边栏 */\n.item-details-sidebar[data-v-28a5e031] {\n  width: 320px;\n  border-left: 1px solid var(--color-border);\n  background: var(--color-surface);\n  display: flex;\n  flex-direction: column;\n}\n.details-content[data-v-28a5e031] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.details-header[data-v-28a5e031] {\n  padding: 20px;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.details-icon-large[data-v-28a5e031] {\n  width: 60px;\n  height: 60px;\n  border-radius: 10px;\n  border: 2px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  flex-shrink: 0;\n  font-weight: bold;\n  font-size: 12px;\n  color: var(--color-text);\n}\n.details-title-area h3[data-v-28a5e031] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n.details-meta[data-v-28a5e031] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-top: 4px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n.details-body[data-v-28a5e031] {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n.details-description[data-v-28a5e031] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin-bottom: 20px;\n}\n.details-attributes h4[data-v-28a5e031] {\n  margin: 0 0 12px 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.details-placeholder[data-v-28a5e031] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n.details-actions[data-v-28a5e031] {\n  padding: 16px 20px;\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  gap: 8px;\n}\n\n/* 灵石标签 */\n.currency-tab[data-v-28a5e031] {\n  padding: 24px;\n  overflow-y: auto;\n}\n.currency-grid[data-v-28a5e031] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 16px;\n  width: 100%;\n}\n.currency-card[data-v-28a5e031] {\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  transition: all 0.3s ease;\n  cursor: default;\n  position: relative;\n  overflow: hidden;\n}\n.currency-card[data-v-28a5e031]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 4px;\n  opacity: 0.8;\n  transition: opacity 0.3s ease;\n}\n.currency-card.grade-common[data-v-28a5e031]::before {\n  background: linear-gradient(90deg, #9ca3af, #6b7280);\n}\n.currency-card.grade-rare[data-v-28a5e031]::before {\n  background: linear-gradient(90deg, #3b82f6, #2563eb);\n}\n.currency-card.grade-epic[data-v-28a5e031]::before {\n  background: linear-gradient(90deg, #8b5cf6, #7c3aed);\n}\n.currency-card.grade-legend[data-v-28a5e031]::before {\n  background: linear-gradient(90deg, #f59e0b, #d97706);\n}\n.currency-card[data-v-28a5e031]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);\n}\n.currency-card[data-v-28a5e031]:hover::before {\n  opacity: 1;\n}\n.currency-card-top[data-v-28a5e031] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.currency-icon[data-v-28a5e031] {\n  flex-shrink: 0;\n  color: var(--color-text-secondary);\n  transition: color 0.3s ease;\n}\n\n/* 灵石图标颜色 */\n.icon-grade-common[data-v-28a5e031] {\n  color: #9ca3af;\n}\n.icon-grade-rare[data-v-28a5e031] {\n  color: #3b82f6;\n}\n.icon-grade-epic[data-v-28a5e031] {\n  color: #8b5cf6;\n}\n.icon-grade-legend[data-v-28a5e031] {\n  color: #f59e0b;\n}\n.currency-info[data-v-28a5e031] {\n  flex: 1;\n}\n.currency-amount[data-v-28a5e031] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n.currency-label[data-v-28a5e031] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n}\n\n/* 兑换功能 */\n.currency-exchange[data-v-28a5e031] {\n  display: flex;\n  gap: 8px;\n  margin-top: 8px;\n}\n.exchange-btn[data-v-28a5e031] {\n  flex: 1;\n  padding: 6px 12px;\n  border: 1px solid var(--color-primary);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-primary);\n  font-size: 0.8rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: hidden;\n}\n.exchange-btn[data-v-28a5e031]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s ease;\n}\n.exchange-btn[data-v-28a5e031]:hover:not(:disabled) {\n  background: var(--color-primary);\n  color: white;\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n.exchange-btn[data-v-28a5e031]:hover:not(:disabled)::before {\n  left: 100%;\n}\n.exchange-btn.down[data-v-28a5e031] {\n  border-color: var(--color-warning);\n  color: var(--color-warning);\n}\n.exchange-btn.down[data-v-28a5e031]:hover:not(:disabled) {\n  background: var(--color-warning);\n  color: white;\n  box-shadow: 0 4px 12px rgba(var(--color-warning-rgb), 0.3);\n}\n.exchange-btn[data-v-28a5e031]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n.exchange-btn[data-v-28a5e031]:active:not(:disabled) {\n  transform: translateY(0) scale(0.98);\n}\n\n/* 按钮样式 */\n.action-btn[data-v-28a5e031] {\n  flex: 1;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-28a5e031]:hover {\n  background: var(--color-surface-light);\n  transform: translateY(-1px);\n}\n.use-btn[data-v-28a5e031] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.use-btn[data-v-28a5e031]:hover {\n  background: var(--color-primary-hover);\n}\n.discard-btn[data-v-28a5e031] {\n  background: var(--color-error);\n  border-color: var(--color-error);\n  color: white;\n}\n.discard-btn[data-v-28a5e031]:hover {\n  background: var(--color-error-hover);\n}\n\n/* 属性文本显示 */\n.attribute-text[data-v-28a5e031] {\n  background: var(--color-background);\n  border-radius: 6px;\n  padding: 12px;\n  font-size: 0.9rem;\n  color: var(--color-text);\n  line-height: 1.4;\n  word-break: break-all;\n}\n\n/* 功法效果样式 */\n.skill-effects[data-v-28a5e031] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.effect-item[data-v-28a5e031] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 6px 0;\n}\n.effect-label[data-v-28a5e031] {\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  min-width: 80px;\n}\n.effect-value[data-v-28a5e031] {\n  color: var(--color-success);\n  font-weight: 500;\n}\n.special-abilities[data-v-28a5e031] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n}\n.ability-tag[data-v-28a5e031] {\n  background: var(--color-primary);\n  color: white;\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n\n/* 功法技能样式 */\n.technique-skills[data-v-28a5e031] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.skill-item[data-v-28a5e031] {\n  background: var(--color-background);\n  border-radius: 8px;\n  padding: 12px;\n  border: 1px solid var(--color-border);\n}\n.skill-header[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.skill-name[data-v-28a5e031] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.skill-type[data-v-28a5e031] {\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n.skill-type.type-攻击[data-v-28a5e031] {\n  background: var(--color-error);\n  color: white;\n}\n.skill-type.type-防御[data-v-28a5e031] {\n  background: var(--color-info);\n  color: white;\n}\n.skill-type.type-辅助[data-v-28a5e031] {\n  background: var(--color-success);\n  color: white;\n}\n.skill-type.type-移动[data-v-28a5e031] {\n  background: var(--color-warning);\n  color: white;\n}\n.skill-type.type-其他[data-v-28a5e031] {\n  background: var(--color-text-secondary);\n  color: white;\n}\n.skill-description[data-v-28a5e031] {\n  color: var(--color-text);\n  font-size: 0.9rem;\n  line-height: 1.4;\n  margin-bottom: 6px;\n}\n.skill-unlock-requirement[data-v-28a5e031] {\n  font-size: 0.75rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  padding: 2px 8px;\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-radius: 4px;\n  margin-left: auto;\n}\n.skill-cost[data-v-28a5e031] {\n  color: var(--color-info);\n  font-size: 0.8rem;\n  font-weight: 500;\n  margin-top: 4px;\n}\n.skill-unlock[data-v-28a5e031] {\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n}\n.cultivate-btn[data-v-28a5e031] {\n  background: var(--color-info);\n  border-color: var(--color-info);\n  color: white;\n}\n.cultivate-btn[data-v-28a5e031]:hover {\n  background: var(--color-info-hover);\n}\n.equip-btn[data-v-28a5e031] {\n  background: var(--color-success);\n  border-color: var(--color-success);\n  color: white;\n}\n.equip-btn[data-v-28a5e031]:hover {\n  background: var(--color-success-hover);\n}\n\n/* 品质样式系统 - 内联文字样式，不填充整行 */\n/* 神阶 - 深红色（最高品质） */\n.text-quality-神[data-v-28a5e031],\n.text-quality-神阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #dc2626, #b91c1c) !important;\n  border: 1px solid #dc2626 !important;\n  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 仙阶 - 粉紫色 */\n.text-quality-仙[data-v-28a5e031],\n.text-quality-仙阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #ec4899, #db2777) !important;\n  border: 1px solid #ec4899 !important;\n  box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 天阶 - 蓝色 */\n.text-quality-天[data-v-28a5e031],\n.text-quality-天阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #3b82f6, #2563eb) !important;\n  border: 1px solid #3b82f6 !important;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 地阶 - 橙色 */\n.text-quality-地[data-v-28a5e031],\n.text-quality-地阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #f59e0b, #d97706) !important;\n  border: 1px solid #f59e0b !important;\n  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 玄阶 - 紫色 */\n.text-quality-玄[data-v-28a5e031],\n.text-quality-玄阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n  border: 1px solid #8b5cf6 !important;\n  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 黄阶 - 金黄色 */\n.text-quality-黄[data-v-28a5e031],\n.text-quality-黄阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #eab308, #ca8a04) !important;\n  border: 1px solid #eab308 !important;\n  box-shadow: 0 2px 8px rgba(234, 179, 8, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 凡阶 - 灰色（最低品质） */\n.text-quality-凡[data-v-28a5e031],\n.text-quality-凡阶[data-v-28a5e031] {\n  color: white !important;\n  background: linear-gradient(135deg, #6b7280, #4b5563) !important;\n  border: 1px solid #6b7280 !important;\n  box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3) !important;\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;\n  padding: 2px 6px !important;\n  border-radius: 4px !important;\n  display: inline !important;\n  white-space: nowrap !important;\n}\n\n/* 边框样式也需要修复 */\n.border-quality-神[data-v-28a5e031] {\n  border-color: #dc2626 !important;\n}\n.border-quality-仙[data-v-28a5e031] {\n  border-color: #ec4899 !important;\n}\n.border-quality-天[data-v-28a5e031] {\n  border-color: #3b82f6 !important;\n}\n.border-quality-地[data-v-28a5e031] {\n  border-color: #f59e0b !important;\n}\n.border-quality-玄[data-v-28a5e031] {\n  border-color: #8b5cf6 !important;\n}\n.border-quality-凡[data-v-28a5e031] {\n  border-color: #6b7280 !important;\n}\n.border-quality-凡[data-v-28a5e031] {\n  border-color: #6b7280 !important;\n}\n\n/* 装备标签页样式 */\n.equipment-tab[data-v-28a5e031] {\n  height: 100%;\n  overflow-y: auto;\n}\n.item-grade[data-v-28a5e031] {\n  border-radius: 5px;\n  border: 2px solid #9ca3af;\n}\n.equipment-content[data-v-28a5e031] {\n  padding: 20px;\n}\n.equipment-header[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n  padding-bottom: 16px;\n  border-bottom: 2px solid var(--color-border);\n}\n.equipment-title[data-v-28a5e031] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin: 0;\n  font-size: 1.4rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.equipment-stats[data-v-28a5e031] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.equipment-stats .stat-item[data-v-28a5e031] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n}\n.equipment-stats .stat-label[data-v-28a5e031] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 4px;\n}\n.equipment-stats .stat-value[data-v-28a5e031] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-primary);\n}\n\n/* 装备网格 */\n.equipment-grid[data-v-28a5e031] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));\n  gap: 20px;\n}\n.equipment-slot[data-v-28a5e031] {\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  padding: 16px;\n  transition: all 0.3s ease;\n  min-height: 160px;\n  position: relative;\n}\n.equipment-slot.has-equipment[data-v-28a5e031] {\n  border-color: var(--color-success);\n  box-shadow: 0 4px 12px rgba(var(--color-success-rgb), 0.1);\n}\n.equipment-slot.has-equipment[data-v-28a5e031]:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 25px rgba(var(--color-success-rgb), 0.2);\n}\n.equipment-slot.empty-slot[data-v-28a5e031] {\n  border-style: dashed;\n  border-color: var(--color-border);\n}\n.slot-header[data-v-28a5e031] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}\n.slot-name[data-v-28a5e031] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  padding: 4px 8px;\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  display: inline-block;\n}\n.slot-actions[data-v-28a5e031] {\n  display: flex;\n  gap: 4px;\n}\n\n/* 卸下按钮样式优化 */\n.unequip-btn[data-v-28a5e031] {\n  padding: 8px 12px;\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n  border: 1px solid #ef4444;\n  border-radius: 8px;\n  color: white;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 4px;\n  font-size: 12px;\n  font-weight: 600;\n  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);\n  position: relative;\n  overflow: hidden;\n}\n.unequip-btn[data-v-28a5e031]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s ease;\n}\n.unequip-btn[data-v-28a5e031]:hover {\n  background: linear-gradient(135deg, #dc2626, #b91c1c);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);\n}\n.unequip-btn[data-v-28a5e031]:hover::before {\n  left: 100%;\n}\n.unequip-btn[data-v-28a5e031]:active {\n  transform: translateY(0);\n}\n\n/* 详情区域的卸下按钮保持与其他 action-btn 一致且不上浮 */\n.action-btn.unequip-btn[data-v-28a5e031] {\n  background: var(--color-danger);\n  border-color: var(--color-danger);\n  color: white;\n  border-radius: 8px;\n}\n.action-btn.unequip-btn[data-v-28a5e031]:hover {\n  background: var(--color-danger-hover);\n  transform: none;\n  box-shadow: none;\n}\n\n/* 装备物品显示 - 优化样式 */\n.equipment-item[data-v-28a5e031] {\n  display: flex;\n  gap: 16px;\n  align-items: flex-start;\n  background: var(--color-background);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  padding: 16px;\n  transition: all 0.3s ease;\n}\n.equipment-item[data-v-28a5e031]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.1);\n  transform: translateY(-2px);\n}\n.item-icon[data-v-28a5e031] {\n  width: 60px;\n  height: 60px;\n  border-radius: 10px;\n  border: 3px solid;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-surface-light);\n  flex-shrink: 0;\n  font-weight: bold;\n  transition: all 0.3s ease;\n}\n.item-type-text[data-v-28a5e031] {\n  font-size: 12px;\n  font-weight: bold;\n  text-align: center;\n  color: var(--color-text);\n  line-height: 1.2;\n  word-break: break-word;\n}\n.item-info[data-v-28a5e031] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.item-name[data-v-28a5e031] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  margin-bottom: 0;\n  line-height: 1.3;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n  color: var(--color-text);\n}\n.item-quality[data-v-28a5e031] {\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  border-radius: 6px;\n  margin-bottom: 0;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 4px 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  width: fit-content;\n}\n.item-description[data-v-28a5e031] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  margin-bottom: 0;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  line-clamp: 3;\n  -webkit-box-orient: vertical;\n  background: var(--color-surface-light);\n  padding: 8px 12px;\n  border-radius: 8px;\n  border-left: 3px solid var(--color-primary);\n}\n.item-effects[data-v-28a5e031] {\n  background: var(--color-surface-light);\n  padding: 8px;\n  border-radius: 6px;\n  border-left: 3px solid var(--color-info);\n}\n.effects-title[data-v-28a5e031] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-info);\n  margin-bottom: 4px;\n}\n.effects-text[data-v-28a5e031] {\n  font-size: 0.8rem;\n  color: var(--color-text);\n  line-height: 1.3;\n}\n\n/* 空装备槽位 */\n.empty-equipment-slot[data-v-28a5e031] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  height: 120px;\n  gap: 8px;\n}\n.empty-icon[data-v-28a5e031] {\n  color: var(--color-text-muted);\n  opacity: 0.5;\n}\n.empty-text[data-v-28a5e031] {\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-28a5e031] {\n  font-size: 0.8rem;\n  color: var(--color-text-muted);\n  font-style: italic;\n}\n\n/* 移动端适配 - 优化卡片显示 */\n@media (max-width: 640px) {\n.tabs-header[data-v-28a5e031] {\n    padding: 12px;\n}\n.tools-section[data-v-28a5e031] {\n    flex-direction: column;\n    gap: 8px;\n    align-items: stretch;\n}\n.search-box[data-v-28a5e031] {\n    min-width: auto;\n}\n.filter-buttons[data-v-28a5e031] {\n    justify-content: space-between;\n}\n.filter-select[data-v-28a5e031] {\n    flex: 1;\n}\n.items-grid[data-v-28a5e031] {\n    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n    padding: 16px;\n    gap: 12px;\n}\n.item-card[data-v-28a5e031] {\n    height: 130px;\n    padding: 6px;\n}\n.item-icon-area[data-v-28a5e031] {\n    width: 40px;\n    height: 40px;\n}\n.item-type-icon[data-v-28a5e031] {\n    font-size: 20px;\n}\n.item-name[data-v-28a5e031] {\n    font-size: 11px;\n}\n.item-type-label[data-v-28a5e031] {\n    font-size: 8px;\n    padding: 1px 4px;\n}\n.item-grade-info[data-v-28a5e031] {\n    font-size: 7px;\n    padding: 1px 3px;\n}\n.currency-grid[data-v-28a5e031] {\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n    gap: 12px;\n}\n.currency-card[data-v-28a5e031] {\n    padding: 16px;\n}\n.currency-amount[data-v-28a5e031] {\n    font-size: 1.25rem;\n}\n\n  /* 装备页面移动端适配 */\n.equipment-content[data-v-28a5e031] {\n    padding: 12px;\n}\n.equipment-header[data-v-28a5e031] {\n    flex-direction: column;\n    gap: 12px;\n    align-items: flex-start;\n}\n.equipment-grid[data-v-28a5e031] {\n    grid-template-columns: 1fr;\n    gap: 16px;\n}\n.equipment-slot[data-v-28a5e031] {\n    min-height: 140px;\n    padding: 12px;\n}\n}\n@media (max-width: 480px) {\n.tabs-nav[data-v-28a5e031] {\n    justify-content: center;\n}\n.tab-btn[data-v-28a5e031] {\n    flex: 1;\n    justify-content: center;\n}\n.items-grid[data-v-28a5e031] {\n    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n    gap: 10px;\n    padding: 12px;\n}\n.item-card[data-v-28a5e031] {\n    height: 120px;\n    padding: 5px;\n}\n.item-icon-area[data-v-28a5e031] {\n    width: 32px;\n    height: 32px;\n}\n.item-type-icon[data-v-28a5e031] {\n    font-size: 16px;\n}\n.item-name[data-v-28a5e031] {\n    font-size: 10px;\n}\n.item-type-label[data-v-28a5e031] {\n    font-size: 7px;\n    padding: 1px 3px;\n}\n.item-grade-info[data-v-28a5e031] {\n    font-size: 6px;\n    padding: 1px 2px;\n}\n.item-quality-badge[data-v-28a5e031] {\n    font-size: 6px;\n    padding: 1px 2px;\n}\n.item-quantity-badge[data-v-28a5e031] {\n    font-size: 8px;\n    padding: 1px 4px;\n}\n.currency-grid[data-v-28a5e031] {\n    grid-template-columns: 1fr;\n}\n.currency-card[data-v-28a5e031] {\n    padding: 14px;\n}\n}\n",""]);const s=i},5056:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{"use strict";var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},i=[],s=0;s<e.length;s++){var l=e[s],c=a.base?l[0]+a.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var m=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var g=r(p,a);a.byIndex=s,t.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=n(o[i]);t[s].references--}for(var l=a(e,r),c=0;c<o.length;c++){var d=n(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},5097:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-migration[data-v-84b88b2c] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  color: var(--color-text);\n}\n.migration-header h4[data-v-84b88b2c] {\n  margin: 0 0 6px 0;\n  font-size: 1.05rem;\n}\n.migration-header p[data-v-84b88b2c] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-reasons[data-v-84b88b2c] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 10px;\n}\n.reason-item[data-v-84b88b2c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.reason-item .dot[data-v-84b88b2c] {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--color-warning);\n  flex-shrink: 0;\n}\n.migration-meta[data-v-84b88b2c] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n  gap: 10px;\n}\n.meta-item[data-v-84b88b2c] {\n  padding: 8px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.meta-item .label[data-v-84b88b2c] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.meta-item .value[data-v-84b88b2c] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.migration-actions[data-v-84b88b2c] {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.migration-actions button[data-v-84b88b2c] {\n  border: none;\n  border-radius: 8px;\n  padding: 8px 14px;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.migration-actions .primary[data-v-84b88b2c] {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  color: white;\n}\n.migration-actions .primary[data-v-84b88b2c]:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.migration-actions .secondary[data-v-84b88b2c] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n}\n.migration-hint[data-v-84b88b2c] {\n  margin: 0;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: rgba(var(--color-primary-rgb), 0.08);\n  padding: 8px 10px;\n  border-radius: 8px;\n}\n",""]);const s=i},5099:(e,t,n)=>{"use strict";n.d(t,{$v:()=>m,Jx:()=>x,Ky:()=>w,N5:()=>h,Wj:()=>k,YK:()=>v,ag:()=>g,c5:()=>f,dc:()=>b,loadFromIndexedDB:()=>E,loadSaveData:()=>y,saveData:()=>p});const a="DAD_SAVES_DB",r=1,o="saves",i="root_data",s="characters",l="active_save",c="savedata_";let d=null;function u(){return new Promise((e,t)=>{if(d)return void e(d);const n=indexedDB.open(a,r);n.onerror=()=>{console.error("【乾坤宝库-IDB】数据库打开失败:",n.error),t(n.error)},n.onsuccess=()=>{d=n.result,console.log("【乾坤宝库-IDB】数据库已打开"),e(n.result)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(o)||(t.createObjectStore(o,{keyPath:"id"}),console.log("【乾坤宝库-IDB】对象存储已创建:",o))}})}async function m(){try{const e=(await u()).transaction([o],"readonly").objectStore(o),t=e.get(s),n=e.get(l);return new Promise((e,a)=>{let r=null,o=null,i=0;const s=()=>{2===i&&(console.log("【乾坤宝库-IDB】分片数据加载完成"),e({角色列表:r||{},当前激活存档:o||null}))};t.onsuccess=()=>{r=t.result?.data||{},i++,s()},t.onerror=()=>a(t.error),n.onsuccess=()=>{o=n.result?.data||null,i++,s()},n.onerror=()=>a(n.error)})}catch(e){return console.error("【乾坤宝库-IDB】加载根数据时出错:",e),{当前激活存档:null,角色列表:{}}}}async function p(e,t){const n=await u();return new Promise((a,r)=>{const i=n.transaction([o],"readwrite").objectStore(o).put({id:e,data:JSON.parse(JSON.stringify(t)),timestamp:(new Date).toISOString()});i.onsuccess=()=>a(),i.onerror=()=>r(i.error)})}async function g(e){try{console.log("[IndexedDB-保存角色] 准备保存角色列表, 角色数:",Object.keys(e).length),await p(s,e),console.log("[IndexedDB-保存角色] ✅ 角色列表已保存到 IndexedDB")}catch(e){throw console.error("[IndexedDB-保存角色] ❌ 保存角色列表失败:",e),e}}async function h(e){try{await p(l,e),console.log("【乾坤宝库-IDB】当前激活存档已保存")}catch(e){throw console.error("【乾坤宝库-IDB】保存当前激活存档失败:",e),e}}async function f(e){try{console.log("[IndexedDB-保存] 开始保存根数据"),console.log("[IndexedDB-保存] 角色列表键名:",Object.keys(e.角色列表)),console.log("[IndexedDB-保存] 当前激活存档:",e.当前激活存档),await Promise.all([g(e.角色列表),h(e.当前激活存档)]),console.log("[IndexedDB-保存] ✅ 根数据（分片）保存成功")}catch(e){throw console.error("[IndexedDB-保存] ❌ 保存根数据时出错:",e),e}}async function v(){try{const e="DAD_SAVES_V3",t=localStorage.getItem(e);if(t){console.log("【乾坤宝库-IDB】检测到localStorage数据，开始迁移...");const n=JSON.parse(t);return await f(n),localStorage.setItem("DAD_SAVES_V3_BACKUP",t),localStorage.removeItem(e),console.log("【乾坤宝库-IDB】✅ localStorage 数据迁移完成！"),!0}const n=(await u()).transaction([o],"readwrite").objectStore(o),a=n.get(i);return new Promise((e,t)=>{a.onsuccess=async()=>{const r=a.result;if(r&&r.data&&(r.data.角色列表||r.data.当前激活存档)){console.log("【乾坤宝库-IDB】检测到旧的单体DB记录，开始分片迁移...");try{const a=r.data;await g(a.角色列表||{}),await h(a.当前激活存档||null);const o=n.delete(i);o.onsuccess=()=>{console.log("【乾坤宝库-IDB】✅ 旧的单体DB记录已成功迁移并删除"),e(!0)},o.onerror=()=>{console.error("【乾坤宝库-IDB】❌ 删除旧的单体DB记录失败:",o.error),t(o.error)}}catch(e){console.error("【乾坤宝库-IDB】❌ 分片迁移失败:",e),t(e)}}else console.log("【乾坤宝库-IDB】无需数据迁移"),e(!1)},a.onerror=()=>{console.error("【乾坤宝库-IDB】❌ 检查旧数据失败:",a.error),t(a.error)}})}catch(e){return console.error("【乾坤宝库-IDB】❌ 数据迁移过程出错:",e),!1}}async function b(e,t,n){try{const a=`${c}${e}_${t}`;await p(a,n),console.log(`【乾坤宝库-IDB】SaveData 已保存 (${e}/${t})`)}catch(e){throw console.error("【乾坤宝库-IDB】保存 SaveData 失败:",e),e}}async function y(e,t){try{const n=`${c}${e}_${t}`,a=await u();return new Promise((r,i)=>{const s=a.transaction([o],"readonly").objectStore(o).get(n);s.onsuccess=()=>{const n=s.result;n&&n.data?(console.log(`【乾坤宝库-IDB】SaveData 已加载 (${e}/${t})`),r(n.data)):(console.warn(`【乾坤宝库-IDB】SaveData 不存在 (${e}/${t})`),r(null))},s.onerror=()=>{console.error("【乾坤宝库-IDB】加载 SaveData 失败:",s.error),i(s.error)}})}catch(e){return console.error("【乾坤宝库-IDB】加载 SaveData 时出错:",e),null}}async function x(e,t){try{const n=`${c}${e}_${t}`,a=await u();return new Promise((r,i)=>{const s=a.transaction([o],"readwrite").objectStore(o).delete(n);s.onsuccess=()=>{console.log(`【乾坤宝库-IDB】SaveData 已删除 (${e}/${t})`),r()},s.onerror=()=>{console.error("【乾坤宝库-IDB】删除 SaveData 失败:",s.error),i(s.error)}})}catch(e){throw console.error("【乾坤宝库-IDB】删除 SaveData 时出错:",e),e}}async function k(e){try{const t=await u(),n=`${c}${e}_`;return console.log(`【乾坤宝库-IDB】开始清理角色 ${e} 的所有存档...`),new Promise((e,a)=>{const r=t.transaction([o],"readwrite").objectStore(o),i=r.getAllKeys();i.onsuccess=()=>{const t=i.result.filter(e=>"string"==typeof e&&e.startsWith(n));if(console.log(`【乾坤宝库-IDB】找到 ${t.length} 个存档记录待删除:`,t),0===t.length)return console.log("【乾坤宝库-IDB】没有找到需要删除的存档"),void e(0);let a=0,o=0;t.forEach(n=>{const i=r.delete(n);i.onsuccess=()=>{a++,console.log(`【乾坤宝库-IDB】✅ 已删除: ${n}`),a+o===t.length&&(console.log(`【乾坤宝库-IDB】批量删除完成，成功 ${a} 个，失败 ${o} 个`),e(a))},i.onerror=()=>{o++,console.error(`【乾坤宝库-IDB】❌ 删除失败: ${n}`,i.error),a+o===t.length&&(console.log(`【乾坤宝库-IDB】批量删除完成，成功 ${a} 个，失败 ${o} 个`),e(a))}})},i.onerror=()=>{console.error("【乾坤宝库-IDB】获取所有键失败:",i.error),a(i.error)}})}catch(e){throw console.error("【乾坤宝库-IDB】批量删除存档数据时出错:",e),e}}async function w(){const e=(await u()).transaction([o],"readwrite").objectStore(o);return new Promise((t,n)=>{let a=0;const r=e.openCursor();r.onsuccess=()=>{const e=r.result;e?(String(e.key).startsWith(c)&&(e.delete(),a++),e.continue()):t(a)},r.onerror=()=>n(r.error)})}async function E(e){try{const t=await u();return new Promise((n,a)=>{const r=t.transaction([o],"readonly").objectStore(o).get(e);r.onsuccess=()=>{const e=r.result;e&&e.data?n(e.data):n(null)},r.onerror=()=>{a(r.error)}})}catch(t){return console.error(`【乾坤宝库-IDB】从 IndexedDB 加载数据失败 (key: ${e}):`,t),null}}},5184:(e,t,n)=>{"use strict";n.d(t,{vectorMemoryService:()=>v});var a=n(602),r=n(8651),o=n(1083);function i(e){return(e||"").toString().trim().replace(/\/v1\/?$/,"").replace(/\/+$/,"")}function s(e){const t=Math.sqrt(e.reduce((e,t)=>e+t*t,0));return t?e.map(e=>e/t):e}async function l(e,t){const n=e.provider,a=i(e.url),r=(e.apiKey||"").trim(),s=(e.model||"").trim();if(!a)throw new Error("Embedding API 地址未配置");if(!r)throw new Error("Embedding API Key 未配置");if(!s)throw new Error("Embedding 模型未配置");if("openai"===n||"deepseek"===n||"custom"===n){const e=await o.A.post(`${a}/v1/embeddings`,{model:s,input:t,encoding_format:"float"},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),n=e.data?.data;if(!Array.isArray(n)||n.length!==t.length)throw new Error("Embedding 响应格式异常");return n.map(e=>{const t=e?.embedding;if(!Array.isArray(t))throw new Error("Embedding 响应缺少 embedding");return t})}throw new Error(`当前 provider 不支持 Embedding：${n}`)}const c={enabled:!1,maxRetrieveCount:10,minSimilarity:.3,tagWeight:.4,vectorWeight:.6},d=new Set(["凡人","炼气","筑基","金丹","元婴","化神","炼虚","合体","渡劫","飞升","初期","中期","后期","圆满","极境","突破","瓶颈","修炼","闭关","悟道","感悟","丹田","经脉","灵气","真气","法力","神识","战斗","交手","斩杀","击败","重伤","轻伤","濒死","陨落","丹药","法宝","灵石","功法","秘籍","材料","灵草","师父","徒弟","道友","敌人","仇人","盟友","宗门","门派","洞府","山门","秘境","禁地","坊市","城池","拜师","入门","出关","历练","任务","机缘","劫难"]),u=new Set(["的","了","是","在","有","和","与","或","也","都","就","着","被","让","把","给","从","到","向","往","对","于","为","而","但","却","因","所","这","那","它","他","她","我","你","们","自","其","此","彼","一","个","些","很","更","最","非","不","无","没","未"]);function m(e){const t=[];for(const n of d)e.includes(n)&&t.push(n);const n=/[\u4e00-\u9fa5]{2,4}/g;let a;for(;null!==(a=n.exec(e));){const e=a[0];u.has(e)||d.has(e)||t.push(e)}return[...new Set(t)]}function p(e){const t=[],n=m(e);for(const e of n)d.has(e)&&t.push(e);const a=/[\u4e00-\u9fa5]{2,3}/g;let r;for(;null!==(r=a.exec(e));){const e=r[0];u.has(e)||d.has(e)||t.length<15&&t.push(e)}return[...new Set(t)].slice(0,20)}function g(e,t){const n=n=>n.some(n=>e.includes(n)||t.includes(n));return n(["战斗","交手","斩杀","击败","重伤","攻击","防御"])?"combat":n(["师父","徒弟","道友","拜师","结交","好感","关系"])?"social":n(["修炼","闭关","突破","感悟","境界","功法"])?"cultivation":n(["探索","发现","秘境","历练","寻找"])?"exploration":n(["机缘","劫难","事件","任务","完成"])?"event":"other"}class h{vocabulary;wordToIndex;constructor(){this.vocabulary=Array.from(d),this.wordToIndex=new Map,this.vocabulary.forEach((e,t)=>{this.wordToIndex.set(e,t)})}vectorize(e){const t=m(e),n=new Array(this.vocabulary.length).fill(0),a=new Map;for(const e of t)a.set(e,(a.get(e)||0)+1);for(const[e,t]of a){const a=this.wordToIndex.get(e);void 0!==a&&(n[a]=t)}const r=Math.sqrt(n.reduce((e,t)=>e+t*t,0));if(r>0)for(let e=0;e<n.length;e++)n[e]/=r;return n}cosineSimilarity(e,t){if(e.length!==t.length)return 0;let n=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a];return n}}function f(e){return`mem_${function(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return(t>>>0).toString(16).padStart(8,"0")}((e||"").trim().replace(/\s+/g," "))}`}const v=new class{db=null;vectorizer;config;saveSlot="";constructor(){this.vectorizer=new h,this.config={...c},this.loadConfig()}async init(e){this.saveSlot=e;const t=`vector-memory-${e}`;this.db=await(0,a.P2)(t,1,{upgrade(e){if(!e.objectStoreNames.contains("memories")){const t=e.createObjectStore("memories",{keyPath:"id"});t.createIndex("tags","tags",{multiEntry:!0}),t.createIndex("category","category"),t.createIndex("timestamp","timestamp")}}}),console.log(`[向量记忆] 初始化完成: ${t}`)}loadConfig(){try{const e=localStorage.getItem("vectorMemoryConfig");e&&(this.config={...c,...JSON.parse(e)})}catch(e){console.warn("[向量记忆] 加载配置失败，使用默认配置")}}saveConfig(e){this.config={...this.config,...e},localStorage.setItem("vectorMemoryConfig",JSON.stringify(this.config))}getConfig(){return{...this.config}}isEnabled(){return this.config.enabled}canAutoIndex(){return!!this.db&&(this.config.enabled||!!this.getEmbeddingRequestConfig())}getEmbeddingRequestConfig(){try{const{useAPIManagementStore:e}=n(100),t=e().getAPIForType("embedding");if(!t||!1===t.enabled)return null;if((0,r.isTavernEnv)()&&"default"===t.id)return null;const a=i(t.url),o=(t.apiKey||"").trim(),s=(t.model||"").trim();return a&&o&&s?{provider:t.provider,url:a,apiKey:o,model:s}:null}catch{return null}}getEmbeddingStatus(){const e=this.getEmbeddingRequestConfig();return e?{available:!0,provider:e.provider,model:e.model}:(0,r.isTavernEnv)()?{available:!1,reason:"酒馆环境下需为 Embedding 分配独立API（非默认）并填写 Key/模型"}:{available:!1,reason:"请在 API管理 中为 Embedding 配置 API 地址/Key/模型"}}async embedText(e){const t=this.getEmbeddingRequestConfig();if(!t)return null;try{const[n]=await l(t,[e]);return{vector:s(n),model:t.model}}catch(e){return console.warn("[向量记忆] Embedding 生成失败，回退到本地向量:",e),null}}async embedBatch(e){const t=this.getEmbeddingRequestConfig();if(!t)return null;try{return{vectors:(await l(t,e)).map(e=>s(e)),model:t.model}}catch(e){return console.warn("[向量记忆] Embedding 批量生成失败，回退到本地向量:",e),null}}async addMemory(e,t=5){if(!this.db)return console.warn("[向量记忆] 数据库未初始化"),null;const n=(e||"").trim();if(!n)return null;const a=p(e),r=g(e,a),o=await this.embedText(n),i=o?o.vector:this.vectorizer.vectorize(n),s={id:f(n),content:n,tags:a,vector:i,vectorType:o?"embedding":"tfidf",embeddingModel:o?.model,timestamp:Date.now(),importance:t,category:r,metadata:{npcs:a.filter(e=>!d.has(e)).slice(0,5)}};return await this.db.put("memories",s),console.log(`[向量记忆] 添加记忆: ${e.substring(0,50)}... 标签: ${a.join(", ")}`),s}async rebuildFromLongTermMemories(e,t){if(!this.db)throw new Error("向量库未初始化");const n=(e||[]).map(e=>(e||"").trim()).filter(Boolean),a=n.length,r=t?.importance??7,o=Math.max(1,Math.min(64,t?.batchSize??24));await this.clear();let i,s=0,l="tfidf";for(let e=0;e<n.length;e+=o){const c=n.slice(e,e+o),u=await this.embedBatch(c);if(u&&u.vectors.length===c.length){l="embedding",i=u.model;for(let e=0;e<c.length;e++){const t=c[e],n=p(t),a=g(t,n),o={id:f(t),content:t,tags:n,vector:u.vectors[e],vectorType:"embedding",embeddingModel:u.model,timestamp:Date.now(),importance:r,category:a,metadata:{npcs:n.filter(e=>!d.has(e)).slice(0,5)}};await this.db.put("memories",o),s++}}else for(const e of c){const t=p(e),n=g(e,t),a={id:f(e),content:e,tags:t,vector:this.vectorizer.vectorize(e),vectorType:"tfidf",timestamp:Date.now(),importance:r,category:n,metadata:{npcs:t.filter(e=>!d.has(e)).slice(0,5)}};await this.db.put("memories",a),s++}t?.onProgress?.(Math.min(e+c.length,a),a)}return console.log(`[向量记忆] 重建完成：${s}/${a} 条，模式=${l}${i?`(${i})`:""}`),{imported:s,vectorType:l,embeddingModel:i}}async importLongTermMemories(e){let t=0;for(const n of e)n&&n.trim()&&(await this.addMemory(n,7),t++);return console.log(`[向量记忆] 导入 ${t} 条长期记忆`),t}async searchMemories(e,t){if(!this.db||!this.config.enabled)return[];const n=p(e);t?.involvedNpcs&&n.push(...t.involvedNpcs),t?.currentLocation&&n.push(t.currentLocation);const a=await this.db.getAll("memories"),r=[],o=[e,t?.currentLocation?`地点: ${t.currentLocation}`:"",...(t?.recentEvents||[]).slice(0,3).map(e=>`事件: ${e}`)].filter(Boolean).join("\n"),i=await this.embedText(o),s=i?.model,l=i?.vector,c=l&&a.some(e=>"embedding"===(e.vectorType||"tfidf")&&(!s||e.embeddingModel===s)&&Array.isArray(e.vector)&&e.vector.length===l.length)?"embedding":"tfidf",d="embedding"===c&&l?l:this.vectorizer.vectorize(e),u=[];for(const e of a){const t=e.vectorType||"tfidf";if(t!==c)continue;if("embedding"===t){if(s&&e.embeddingModel&&e.embeddingModel!==s)continue;if(e.vector.length!==d.length)continue}const a=e.tags.filter(e=>n.includes(e)),r=a.length/Math.max(n.length,1),o="tfidf"===t?this.vectorizer.cosineSimilarity(d,e.vector):(()=>{let t=0;for(let n=0;n<d.length;n++)t+=d[n]*e.vector[n];return t})(),i=r*this.config.tagWeight+o*this.config.vectorWeight;u.push({entry:e,score:i,matchedTags:a})}u.sort((e,t)=>t.score-e.score);const m=u.filter(e=>e.score>=this.config.minSimilarity),g=(m.length>0?m:u).slice(0,this.config.maxRetrieveCount);return r.push(...g),r}async getAllMemories(){return this.db?await this.db.getAll("memories"):[]}async getStats(){if(!this.db)return{total:0,byCategory:{},topTags:[],byVectorType:{},byEmbeddingModel:{}};const e=await this.db.getAll("memories"),t={},n={},a={},r={};for(const o of e){t[o.category]=(t[o.category]||0)+1;const e=o.vectorType||"tfidf";a[e]=(a[e]||0)+1,"embedding"===e&&o.embeddingModel&&(r[o.embeddingModel]=(r[o.embeddingModel]||0)+1);for(const e of o.tags)n[e]=(n[e]||0)+1}const o=Object.entries(n).map(([e,t])=>({tag:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,20);return{total:e.length,byCategory:t,topTags:o,byVectorType:a,byEmbeddingModel:r}}async clear(){this.db&&(await this.db.clear("memories"),console.log("[向量记忆] 已清空向量库"))}formatForAI(e){if(0===e.length)return"";const t=["【相关长期记忆】"];for(const{entry:n,matchedTags:a}of e){const e=a.length>0?`[${a.join(",")}]`:"";t.push(`- ${e} ${n.content}`)}return t.join("\n")}}},5192:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-210f912a] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n}\n.modal-container[data-v-210f912a] {\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.06), rgba(15, 23, 42, 0.02)) , var(--color-surface);\n  border-radius: 12px;\n  border: 1px solid var(--color-border);\n  box-shadow: 0 16px 40px rgba(0,0,0,0.35);\n  width: 90%;\n  max-width: 500px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.modal-container.modal-wide[data-v-210f912a] {\n  width: min(96vw, 960px);\n  max-width: 960px;\n  max-height: 88svh;\n}\n.modal-header[data-v-210f912a] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(59, 130, 246, 0.02));\n}\n.modal-title[data-v-210f912a] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.modal-close-button[data-v-210f912a] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: rgba(15, 23, 42, 0.06);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.modal-close-button[data-v-210f912a]:hover {\n  color: var(--color-text);\n  border-color: var(--color-primary);\n  background: var(--color-surface-hover);\n}\n.modal-content[data-v-210f912a] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  line-height: 1.6;\n  color: var(--color-text);\n  white-space: pre-wrap; /* Allows line breaks in the content */\n}\n.modal-fade-enter-active[data-v-210f912a],\n.modal-fade-leave-active[data-v-210f912a] {\n  transition: opacity 0.3s ease;\n}\n.modal-fade-enter-from[data-v-210f912a],\n.modal-fade-leave-to[data-v-210f912a] {\n  opacity: 0;\n}\n",""]);const s=i},5205:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.character-details-wrapper[data-v-48aca378] {\n  padding: 1rem;\n  height: 100%;\n  overflow: auto;\n  background: var(--color-background);\n  color: var(--color-text);\n}\n.character-details-content[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n/* Loading / Error */\n.loading-container[data-v-48aca378],\n.error-container[data-v-48aca378] {\n  min-height: 320px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  padding: 1.5rem;\n}\n.loading-spinner[data-v-48aca378] {\n  width: 36px;\n  height: 36px;\n  border-radius: 9999px;\n  border: 3px solid rgba(var(--color-primary-rgb), 0.18);\n  border-top-color: var(--color-primary);\n  animation: spin-48aca378 0.9s linear infinite;\n}\n@keyframes spin-48aca378 {\nto {\n    transform: rotate(360deg);\n}\n}\n.error-icon[data-v-48aca378] {\n  color: rgba(239, 68, 68, 0.9);\n}\n.retry-btn[data-v-48aca378] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  padding: 0.6rem 0.9rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n.retry-btn[data-v-48aca378]:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n}\n\n/* Header card */\n.character-header-card[data-v-48aca378] {\n  position: relative;\n  overflow: hidden;\n  border-radius: 18px;\n  border: 1px solid rgba(148, 163, 184, 0.25);\n  background: linear-gradient(\n      135deg,\n      rgba(var(--color-primary-rgb), 0.12) 0%,\n      rgba(var(--color-accent-rgb), 0.08) 45%,\n      rgba(255, 255, 255, 0.02) 100%\n    ),\n    var(--color-surface);\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);\n}\n.header-bg-decoration[data-v-48aca378] {\n  position: absolute;\n  inset: -30%;\n  background: radial-gradient(circle at 20% 25%, rgba(var(--color-primary-rgb), 0.22), transparent 55%),\n    radial-gradient(circle at 75% 60%, rgba(var(--color-accent-rgb), 0.18), transparent 55%);\n  filter: blur(22px);\n  opacity: 0.9;\n  pointer-events: none;\n}\n.header-content[data-v-48aca378] {\n  position: relative;\n  z-index: 1;\n  display: grid;\n  grid-template-columns: 1.25fr 2fr 1fr;\n  gap: 1rem;\n  padding: 1.25rem;\n  align-items: center;\n}\n.profile-section[data-v-48aca378] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  min-width: 0;\n}\n.avatar-wrapper[data-v-48aca378] {\n  position: relative;\n  width: 64px;\n  height: 64px;\n  flex: 0 0 auto;\n}\n.avatar-circle[data-v-48aca378] {\n  width: 64px;\n  height: 64px;\n  border-radius: 9999px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-primary-rgb), 0.14);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.35);\n  color: var(--color-text);\n  font-weight: 800;\n  font-size: 1.35rem;\n  letter-spacing: 0.02em;\n  user-select: none;\n}\n.avatar-glow[data-v-48aca378] {\n  position: absolute;\n  inset: -14px;\n  border-radius: 9999px;\n  background: radial-gradient(circle at center, rgba(var(--color-primary-rgb), 0.25), transparent 65%);\n  filter: blur(10px);\n  opacity: 0.9;\n  pointer-events: none;\n}\n.identity-info[data-v-48aca378] {\n  min-width: 0;\n}\n.character-title[data-v-48aca378] {\n  font-size: 1.5rem;\n  font-weight: 800;\n  margin: 0;\n  line-height: 1.1;\n}\n.character-subtitle[data-v-48aca378] {\n  margin-top: 0.4rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.35rem 0.5rem;\n  align-items: center;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.subtitle-divider[data-v-48aca378] {\n  opacity: 0.6;\n}\n.gender-badge[data-v-48aca378] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.15rem 0.55rem;\n  border-radius: 9999px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  background: rgba(255, 255, 255, 0.05);\n}\n.core-stats-grid[data-v-48aca378] {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 0.75rem;\n  align-content: start;\n}\n.stat-card[data-v-48aca378] {\n  border-radius: 14px;\n  transition: transform 0.15s ease, border-color 0.15s ease, background 0.15s ease;\n  min-width: 0;\n}\n.stat-card.clickable[data-v-48aca378] {\n  cursor: pointer;\n}\n.stat-card[data-v-48aca378]:hover {\n  border-color: rgba(var(--color-primary-rgb), 0.55);\n  transform: translateY(-1px);\n}\n.stat-card .card-icon[data-v-48aca378] {\n  width: 44px;\n  height: 44px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-primary-rgb), 0.12);\n  color: var(--color-primary);\n  flex: 0 0 auto;\n}\n.stat-card .card-content[data-v-48aca378] {\n  min-width: 0;\n}\n.stat-card .card-label[data-v-48aca378] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.15rem;\n}\n.stat-card .card-value[data-v-48aca378] {\n  font-weight: 700;\n  color: var(--color-text);\n  font-size: 1rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.body-card .card-icon[data-v-48aca378] {\n  background: rgba(239, 68, 68, 0.12);\n  color: rgba(239, 68, 68, 0.95);\n}\n.cultivation-section[data-v-48aca378] {\n  display: flex;\n  justify-content: flex-end;\n  align-items: stretch;\n}\n.cultivation-progress-card[data-v-48aca378],\n.cultivation-status[data-v-48aca378] {\n  width: 100%;\n  max-width: 260px;\n  background: rgba(255, 255, 255, 0.04);\n  border: 1px solid rgba(148, 163, 184, 0.25);\n  border-radius: 14px;\n  padding: 0.85rem;\n}\n.progress-header[data-v-48aca378] {\n  display: flex;\n  justify-content: space-between;\n  align-items: baseline;\n  margin-bottom: 0.5rem;\n}\n.progress-label[data-v-48aca378] {\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n}\n.progress-percentage[data-v-48aca378] {\n  font-weight: 800;\n}\n.progress-bar-bg[data-v-48aca378] {\n  height: 10px;\n  border-radius: 9999px;\n  background: rgba(0, 0, 0, 0.18);\n  overflow: hidden;\n}\n.progress-bar-fill[data-v-48aca378] {\n  height: 100%;\n  background: linear-gradient(90deg, rgba(var(--color-primary-rgb), 0.8), rgba(var(--color-accent-rgb), 0.85));\n  border-radius: 9999px;\n  position: relative;\n}\n.progress-bar-shine[data-v-48aca378] {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);\n  transform: translateX(-60%);\n  animation: shine-48aca378 2.4s ease-in-out infinite;\n}\n@keyframes shine-48aca378 {\n0% {\n    transform: translateX(-70%);\n}\n50% {\n    transform: translateX(0%);\n}\n100% {\n    transform: translateX(70%);\n}\n}\n.progress-text[data-v-48aca378] {\n  margin-top: 0.5rem;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n\n/* Tabs */\n.tabs-nav[data-v-48aca378] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  padding: 0.5rem 0.25rem;\n}\n.tab-btn[data-v-48aca378] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.45rem 0.75rem;\n  border-radius: 9999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  font-size: 0.9rem;\n}\n.tab-btn[data-v-48aca378]:hover {\n  border-color: rgba(var(--color-primary-rgb), 0.55);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-48aca378] {\n  background: rgba(var(--color-primary-rgb), 0.14);\n  border-color: rgba(var(--color-primary-rgb), 0.55);\n  color: var(--color-text);\n}\n\n/* Content */\n.tab-content[data-v-48aca378] {\n  padding: 0.25rem;\n}\n.content-grid[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.info-section[data-v-48aca378] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  padding: 1.25rem;\n  overflow: hidden;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n}\n.info-section[data-v-48aca378]:hover {\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.section-title[data-v-48aca378] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin: 0 0 1.25rem;\n  font-size: 1.15rem;\n  font-weight: 700;\n  color: var(--color-text);\n  padding-bottom: 0.75rem;\n  border-bottom: 2px solid var(--color-border);\n}\n.title-icon[data-v-48aca378] {\n  width: 38px;\n  height: 38px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.15), rgba(var(--color-accent-rgb), 0.1));\n  color: var(--color-primary);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.15);\n}\n\n/* Vitals */\n.vitals-grid[data-v-48aca378] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n}\n.vital-item[data-v-48aca378] {\n  padding: 1rem;\n  background: linear-gradient(135deg, var(--color-background) 0%, var(--color-surface-light) 100%);\n  border: 1px solid var(--color-border);\n  border-radius: 14px;\n  transition: all 0.2s ease;\n}\n.vital-item[data-v-48aca378]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.vital-label[data-v-48aca378] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 0.65rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.vital-bar[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.bar-container[data-v-48aca378] {\n  height: 12px;\n  border-radius: 9999px;\n  background: rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n.bar-fill[data-v-48aca378] {\n  height: 100%;\n  border-radius: 9999px;\n  transition: width 0.3s ease;\n  position: relative;\n  overflow: hidden;\n}\n.bar-fill[data-v-48aca378]::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n  animation: shimmer-48aca378 2s infinite;\n}\n@keyframes shimmer-48aca378 {\n0% { transform: translateX(-100%);\n}\n100% { transform: translateX(100%);\n}\n}\n.bar-red[data-v-48aca378] {\n  background: linear-gradient(90deg, #ef4444, #f87171);\n  box-shadow: 0 0 8px rgba(239, 68, 68, 0.3);\n}\n.bar-blue[data-v-48aca378] {\n  background: linear-gradient(90deg, #3b82f6, #60a5fa);\n  box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);\n}\n.bar-gold[data-v-48aca378] {\n  background: linear-gradient(90deg, #f59e0b, #fbbf24);\n  box-shadow: 0 0 8px rgba(245, 158, 11, 0.3);\n}\n.vital-text[data-v-48aca378] {\n  font-size: 0.85rem;\n  color: var(--color-text);\n  font-weight: 600;\n  display: flex;\n  justify-content: space-between;\n}\n.reputation-item[data-v-48aca378] {\n  grid-column: span 1;\n}\n.reputation-display[data-v-48aca378] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.75rem;\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.1), rgba(var(--color-primary-rgb), 0.05));\n  border-radius: 10px;\n  border: 1px solid rgba(var(--color-accent-rgb), 0.2);\n}\n.reputation-value[data-v-48aca378] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-accent);\n}\n\n/* 基础信息网格 */\n.basic-info-grid[data-v-48aca378] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n  gap: 0.85rem;\n}\n.basic-info-item[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n  padding: 0.85rem 1rem;\n  background: linear-gradient(135deg, var(--color-surface-light) 0%, var(--color-background) 100%);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  transition: all 0.2s ease;\n}\n.basic-info-item[data-v-48aca378]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);\n  border-color: rgba(var(--color-primary-rgb), 0.25);\n}\n.info-label[data-v-48aca378] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.info-value[data-v-48aca378] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.info-value.realm[data-v-48aca378] {\n  color: var(--color-primary);\n  font-size: 1.05rem;\n}\n.info-value.gender[data-v-48aca378] {\n  font-weight: 600;\n}\n.info-value.gender.gender-男[data-v-48aca378] {\n  color: #3b82f6;\n}\n.info-value.gender.gender-女[data-v-48aca378] {\n  color: #ec4899;\n}\n.info-value.spirit-root[data-v-48aca378] {\n  color: var(--color-accent);\n}\n.info-value.location[data-v-48aca378] {\n  color: var(--color-text);\n  font-size: 0.95rem;\n}\n\n/* 属性显示 */\n.attributes-display[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n.final-attributes[data-v-48aca378] {\n  padding: 1.25rem;\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.08), rgba(var(--color-accent-rgb), 0.05));\n  border: 2px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 14px;\n}\n.attribute-group-title[data-v-48aca378] {\n  font-size: 0.95rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin: 0 0 1rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n.attributes-grid[data-v-48aca378] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 0.85rem;\n}\n.attributes-grid.compact[data-v-48aca378] {\n  grid-template-columns: repeat(6, 1fr);\n  gap: 0.65rem;\n}\n.attribute-item[data-v-48aca378] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.85rem 0.65rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  transition: all 0.2s ease;\n}\n.attribute-item[data-v-48aca378]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  border-color: rgba(var(--color-primary-rgb), 0.3);\n}\n.attribute-item.final[data-v-48aca378] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.05));\n  border-color: rgba(var(--color-primary-rgb), 0.25);\n}\n.attribute-item.innate[data-v-48aca378] {\n  background: var(--color-surface-light);\n}\n.attribute-item.acquired[data-v-48aca378] {\n  background: var(--color-background);\n}\n.attribute-item.acquired.has-bonus[data-v-48aca378] {\n  background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(16, 185, 129, 0.05));\n  border-color: rgba(34, 197, 94, 0.25);\n}\n.attr-name[data-v-48aca378] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.3px;\n}\n.attr-value[data-v-48aca378] {\n  font-size: 1.25rem;\n  font-weight: 800;\n  color: var(--color-text);\n}\n.attribute-item.final .attr-value[data-v-48aca378] {\n  color: var(--color-primary);\n  font-size: 1.4rem;\n}\n.attribute-item.acquired.has-bonus .attr-value[data-v-48aca378] {\n  color: #10b981;\n}\n.attribute-breakdown[data-v-48aca378] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n}\n.innate-attrs[data-v-48aca378],\n.acquired-attrs[data-v-48aca378] {\n  padding: 1rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n}\n\n/* Modals */\n.modal-overlay[data-v-48aca378] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(6px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  padding: 1rem;\n}\n.skill-modal[data-v-48aca378],\n.dao-modal[data-v-48aca378],\n.spirit-root-modal[data-v-48aca378] {\n  width: min(820px, 100%);\n  max-height: 85vh;\n  overflow: auto;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.35);\n}\n.modal-header[data-v-48aca378] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.85rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-close-btn[data-v-48aca378] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  color: var(--color-text);\n  border-radius: 10px;\n  padding: 0.4rem;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n.modal-close-btn[data-v-48aca378]:hover {\n  border-color: rgba(var(--color-primary-rgb), 0.55);\n  transform: translateY(-1px);\n}\n.modal-content[data-v-48aca378] {\n  padding: 1rem;\n}\n@media (max-width: 980px) {\n.header-content[data-v-48aca378] {\n    grid-template-columns: 1fr;\n    gap: 0.85rem;\n}\n.cultivation-section[data-v-48aca378] {\n    justify-content: flex-start;\n}\n.cultivation-progress-card[data-v-48aca378],\n  .cultivation-status[data-v-48aca378] {\n    max-width: none;\n}\n.content-grid[data-v-48aca378] {\n    grid-template-columns: 1fr;\n}\n}\n",""]);const s=i},5218:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.retry-dialog-overlay[data-v-67dbe82b] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  z-index: 99999;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.retry-dialog[data-v-67dbe82b] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 480px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n  animation: dialog-appear-67dbe82b 0.3s ease-out;\n  overflow: hidden;\n  /* 确保背景完全贴合 */\n  display: flex;\n  flex-direction: column;\n}\n@keyframes dialog-appear-67dbe82b {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.dialog-header[data-v-67dbe82b] {\n  padding: 24px 24px 16px;\n  text-align: center;\n  background: var(--color-surface);\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex-shrink: 0;\n}\n.dialog-header h3[data-v-67dbe82b] {\n  margin: 0;\n  padding: 0;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--color-text);\n  line-height: 1.4;\n}\n.dialog-content[data-v-67dbe82b] {\n  padding: 20px 24px;\n  text-align: center;\n  background: var(--color-surface);\n  /* 确保内容区域可滚动但不超出 */\n  max-height: 50vh;\n  overflow-y: auto;\n  overflow-x: hidden;\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex: 1;\n}\n\n/* 滚动条样式优化 */\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar {\n  width: 6px;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 3px;\n}\n.dialog-content[data-v-67dbe82b]::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.4);\n}\n.error-icon[data-v-67dbe82b] {\n  color: var(--color-warning);\n  margin: 0 0 16px 0;\n  padding: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.message[data-v-67dbe82b] {\n  color: var(--color-text);\n  line-height: 1.6;\n  margin: 0;\n  padding: 0;\n  white-space: pre-line;\n  text-align: left;\n  word-break: break-word;\n}\n.dialog-actions[data-v-67dbe82b] {\n  display: flex;\n  gap: 12px;\n  padding: 16px 24px 24px;\n  background: var(--color-surface);\n  /* 去除可能的间隙 */\n  margin: 0;\n  flex-shrink: 0;\n}\n.btn-primary[data-v-67dbe82b],\n.btn-secondary[data-v-67dbe82b] {\n  flex: 1;\n  padding: 12px 20px;\n  margin: 0;\n  border-radius: 8px;\n  border: 1px solid;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 14px;\n  line-height: 1.5;\n}\n.btn-primary[data-v-67dbe82b] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.btn-primary[data-v-67dbe82b]:hover {\n  background: var(--color-primary-hover);\n  border-color: var(--color-primary-hover);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n.btn-secondary[data-v-67dbe82b] {\n  background: transparent;\n  border-color: var(--color-border);\n  color: var(--color-text-secondary);\n}\n.btn-secondary[data-v-67dbe82b]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-text-secondary);\n  color: var(--color-text);\n  transform: translateY(-1px);\n}\n.btn-primary[data-v-67dbe82b]:active,\n.btn-secondary[data-v-67dbe82b]:active {\n  transform: translateY(0) scale(0.98);\n}\n@media (max-width: 480px) {\n.retry-dialog-overlay[data-v-67dbe82b] {\n    padding: 16px;\n}\n.retry-dialog[data-v-67dbe82b] {\n    max-width: none;\n    border-radius: 12px;\n}\n.dialog-header[data-v-67dbe82b] {\n    padding: 20px 20px 12px;\n}\n.dialog-header h3[data-v-67dbe82b] {\n    font-size: 1.1rem;\n}\n.dialog-content[data-v-67dbe82b] {\n    padding: 16px 20px;\n    max-height: 60vh;\n}\n.dialog-actions[data-v-67dbe82b] {\n    flex-direction: column-reverse;\n    gap: 10px;\n    padding: 12px 20px 20px;\n}\n.btn-primary[data-v-67dbe82b],\n  .btn-secondary[data-v-67dbe82b] {\n    flex: none;\n    width: 100%;\n}\n}\n",""]);const s=i},5224:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg width=%2760%27 height=%2760%27 viewBox=%270 0 60 60%27 xmlns=%27http://www.w3.org/2000/svg%27%3E%3Cg fill=%27none%27 fill-rule=%27evenodd%27%3E%3Cg fill=%27%23ffffff%27 fill-opacity=%270.08%27%3E%3Cpath d=%27M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z%27/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"},5269:(e,t,n)=>{"use strict";function a(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){const t=e.trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}return null}function r(e){if(Array.isArray(e))return e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean);if("string"==typeof e){const t=e.trim();return t?t.split(/[、,，;；\n]/).map(e=>e.trim()).filter(Boolean):[]}return null}function o(e){const{action:t,key:n,value:o}=e,l=[];try{if("角色.属性.境界"===n&&"set"===t){const e=i(o);l.push(...e.errors)}if("角色.位置"===n&&"set"===t){const e=function(e){const t=[];return"object"!=typeof e||null===e?(t.push("位置必须是对象类型"),{valid:!1,errors:t}):(e.描述||t.push('位置缺少"描述"字段'),void 0!==e.x&&"number"!=typeof e.x&&t.push("位置.x类型错误，应为数字"),void 0!==e.y&&"number"!=typeof e.y&&t.push("位置.y类型错误，应为数字"),void 0!==e.地图ID&&"string"!=typeof e.地图ID&&t.push("位置.地图ID类型错误，应为字符串"),{valid:0===t.length,errors:t})}(o);l.push(...e.errors)}if("角色.效果"===n&&"push"===t){const e=function(e){const t=[];return"object"!=typeof e||null===e?(t.push("状态效果必须是对象类型"),{valid:!1,errors:t}):(e.状态名称||t.push('状态效果缺少"状态名称"字段'),e.类型&&["buff","debuff"].includes(e.类型)||t.push('状态效果缺少"类型"字段或值无效'),void 0===e.状态描述&&t.push('状态效果缺少"状态描述"字段'),"number"!=typeof e.持续时间分钟&&t.push('状态效果缺少"持续时间分钟"字段或类型错误'),e.生成时间&&"object"==typeof e.生成时间||t.push('状态效果缺少"生成时间"对象字段'),{valid:0===t.length,errors:t})}(o);l.push(...e.errors)}if("角色.背包.物品"===n&&"push"===t){const e=s(o);l.push(...e.errors)}if(n.startsWith("角色.背包.物品.")&&"set"===t&&3===(n.match(/\./g)||[]).length){const e=s(o);l.push(...e.errors)}if(n.startsWith("社交.关系.")&&2===(n.match(/\./g)||[]).length&&"set"===t&&o&&"object"==typeof o&&o.名字&&o.性别&&o.出生日期&&(o.外貌描述||o.性格特征||o.境界)){const e=function(e){const t=[];if("object"!=typeof e||null===e)return t.push("NPC必须是对象类型"),{valid:!1,errors:t};if(e.名字||t.push('NPC缺少"名字"字段'),e.性别||t.push('NPC缺少"性别"字段'),e.出生日期||t.push('NPC缺少"出生日期"字段'),e.境界){const n=i(e.境界);t.push(...n.errors)}else t.push('NPC缺少"境界"字段');if(e.出生||t.push('NPC缺少"出生"字段'),void 0!==e.性格特征){const t=r(e.性格特征);t&&(e.性格特征=t)}if(e.性格特征||t.push('NPC缺少"性格特征"字段'),e.外貌描述||t.push('NPC缺少"外貌描述"字段'),e.与玩家关系||t.push('NPC缺少"与玩家关系"字段'),void 0!==e.好感度){const t=a(e.好感度);null!==t&&(e.好感度=t)}if("number"!=typeof e.好感度&&t.push('NPC缺少"好感度"字段或类型错误'),void 0===e.天赋||Array.isArray(e.天赋)||t.push("NPC天赋必须是数组类型"),e.私密信息&&"object"==typeof e.私密信息&&void 0!==e.私密信息.身体部位){const n=e.私密信息.身体部位;Array.isArray(n)||n&&"object"==typeof n||t.push("NPC私密信息.身体部位必须是数组或对象类型")}if(void 0!==e.记忆&&!Array.isArray(e.记忆)){const t=r(e.记忆);t&&(e.记忆=t)}return{valid:0===t.length,errors:t}}(o);l.push(...e.errors)}if(n.includes("社交.关系.")&&n.endsWith(".境界")&&"set"===t){const e=i(o);l.push(...e.errors)}if(n.startsWith("角色.大道.大道列表.")&&"set"===t&&3===(n.match(/\./g)||[]).length){const e=function(e,t){const n=[];if("object"!=typeof e||null===e)return n.push("大道对象必须是对象类型"),{valid:!1,errors:n};if(!e.道名){const a=t||e.name||e.名称;a?e.道名=a:n.push('大道对象缺少"道名"字段')}return void 0===e.描述&&(e.描述=e.description||"修行之道"),Array.isArray(e.阶段列表)||(e.阶段列表=[{阶段名:"入门",需求经验:100},{阶段名:"小成",需求经验:500},{阶段名:"大成",需求经验:2e3},{阶段名:"圆满",需求经验:1e4}]),"boolean"!=typeof e.是否解锁&&(e.是否解锁=!0),"number"!=typeof e.当前阶段&&(e.当前阶段=0),"number"!=typeof e.当前经验&&(e.当前经验=0),"number"!=typeof e.总经验&&(e.总经验=0),{valid:0===n.length,errors:n}}(o,n.split(".")[3]);l.push(...e.errors)}if("社交.任务.当前任务列表"===n&&"push"===t){const e=function(e){const t=[];return"object"!=typeof e||null===e?(t.push("任务对象必须是对象类型"),{valid:!1,errors:t}):(e.任务ID||t.push('任务缺少"任务ID"字段'),e.任务名称||t.push('任务缺少"任务名称"字段'),void 0===e.任务描述&&t.push('任务缺少"任务描述"字段'),e.任务状态||t.push('任务缺少"任务状态"字段'),e.任务类型||t.push('任务缺少"任务类型"字段'),{valid:0===t.length,errors:t})}(o);l.push(...e.errors)}return{valid:0===l.length,errors:l}}catch(e){return console.error("[指令值验证] 验证过程发生异常:",e),{valid:!1,errors:[`验证过程异常: ${e instanceof Error?e.message:String(e)}`]}}}function i(e,t){const n=[];if("object"!=typeof e||null===e)return n.push("境界必须是对象类型"),{valid:!1,errors:n};if(e.名称||n.push('境界缺少"名称"字段'),e.阶段||n.push('境界缺少"阶段"字段'),void 0!==e.当前进度){const t=a(e.当前进度);null===t?n.push('境界"当前进度"字段类型错误，应为数字'):e.当前进度=t}if(void 0!==e.下一级所需){const t=a(e.下一级所需);null===t?n.push('境界"下一级所需"字段类型错误，应为数字'):e.下一级所需=t}return void 0!==e.突破描述&&"string"!=typeof e.突破描述&&n.push('境界"突破描述"字段类型错误，应为字符串'),{valid:0===n.length,errors:n}}function s(e){const t=[];return"object"!=typeof e||null===e?(t.push("物品必须是对象类型"),{valid:!1,errors:t}):(e.物品ID||t.push('物品缺少"物品ID"字段'),e.名称||t.push('物品缺少"名称"字段'),e.类型||t.push('物品缺少"类型"字段'),e.品质?"object"==typeof e.品质?(e.品质.quality||t.push('物品品质缺少"quality"字段'),"number"!=typeof e.品质.grade&&t.push('物品品质缺少"grade"字段或类型错误')):t.push("物品品质必须是对象类型"):t.push('物品缺少"品质"字段'),"number"!=typeof e.数量&&t.push('物品缺少"数量"字段或类型错误'),void 0===e.描述&&t.push('物品缺少"描述"字段'),"功法"===e.类型&&(Array.isArray(e.功法技能)?0===e.功法技能.length?t.push('功法物品的"功法技能"数组不能为空，至少需要1个技能'):e.功法技能.forEach((e,n)=>{"object"!=typeof e||null===e?t.push(`功法技能[${n}]不是对象类型`):(e.技能名称||t.push(`功法技能[${n}]缺少"技能名称"字段`),void 0===e.技能描述&&t.push(`功法技能[${n}]缺少"技能描述"字段`),"number"!=typeof e.熟练度要求&&t.push(`功法技能[${n}]缺少"熟练度要求"字段或类型错误`))}):t.push('功法物品缺少"功法技能"数组')),{valid:0===t.length,errors:t})}n.d(t,{validateAndRepairCommandValue:()=>o})},5345:e=>{"use strict";e.exports=URIError},5365:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},5373:(e,t,n)=>{"use strict";var a=n(8636),r=n(2642),o=n(4765);e.exports={formats:o,parse:r,stringify:a}},5517:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},5609:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.modal-overlay[data-v-6ec25edf] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n}\n.modal-dialog[data-v-6ec25edf] {\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-surface);\n  border-radius: 12px;\n  padding: 2rem;\n  overflow: hidden;\n}\n.modal-title[data-v-6ec25edf] {\n  margin-top: 0;\n  color: var(--color-primary);\n  text-align: center;\n  margin-bottom: 1.5rem;\n  flex-shrink: 0;\n}\n.form-fields[data-v-6ec25edf] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n  padding-right: 0.5rem;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar {\n  width: 8px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 4px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 4px;\n}\n.form-fields[data-v-6ec25edf]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n.form-group label[data-v-6ec25edf] {\n  display: block;\n  margin-bottom: 0.5rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.form-group input[data-v-6ec25edf],\n.form-group textarea[data-v-6ec25edf],\n.form-group select[data-v-6ec25edf] {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 1rem;\n  transition: var(--transition-fast);\n}\ninput[type="color"][data-v-6ec25edf] {\n  padding: 0.25rem;\n  height: 2.5rem;\n}\ninput[type="color"][data-v-6ec25edf] {\n  padding: 0.25rem;\n  height: 2.5rem;\n}\n.form-group input[data-v-6ec25edf]:focus,\n.form-group textarea[data-v-6ec25edf]:focus,\n.form-group select[data-v-6ec25edf]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n.error-messages[data-v-6ec25edf] {\n    color: var(--color-danger);\n    margin-bottom: 1rem;\n    font-size: 0.9rem;\n    flex-shrink: 0;\n}\n.modal-actions[data-v-6ec25edf] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  margin-top: 1rem;\n  flex-shrink: 0;\n}\n\n/* Transition styles */\n.modal-fade-enter-active[data-v-6ec25edf], .modal-fade-leave-active[data-v-6ec25edf] {\n  transition: opacity 0.3s ease;\n}\n.modal-fade-enter-from[data-v-6ec25edf], .modal-fade-leave-to[data-v-6ec25edf] {\n  opacity: 0;\n}\n.modal-fade-enter-active .modal-content[data-v-6ec25edf],\n.modal-fade-leave-active .modal-content[data-v-6ec25edf] {\n  transition: transform 0.3s ease;\n}\n.modal-fade-enter-from .modal-content[data-v-6ec25edf],\n.modal-fade-leave-to .modal-content[data-v-6ec25edf] {\n  transform: scale(0.9);\n}\n\n/* 动态列表样式 */\n.dynamic-list-container[data-v-6ec25edf] {\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-light);\n  padding: 1rem;\n}\n.list-header[data-v-6ec25edf] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.add-btn[data-v-6ec25edf] {\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  padding: 0.5rem 1rem;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s ease;\n}\n.add-btn[data-v-6ec25edf]:hover {\n  background: var(--color-primary-dark);\n}\n.list-items[data-v-6ec25edf] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.list-item[data-v-6ec25edf] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n}\n.item-inputs[data-v-6ec25edf] {\n  display: flex;\n  gap: 0.5rem;\n  flex: 1;\n}\n.item-input[data-v-6ec25edf] {\n  flex: 1;\n  padding: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  background: var(--color-background);\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.item-input[data-v-6ec25edf]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 5px rgba(var(--color-primary-rgb), 0.3);\n}\n.remove-btn[data-v-6ec25edf] {\n  background: var(--color-danger);\n  color: white;\n  border: none;\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  cursor: pointer;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.remove-btn[data-v-6ec25edf]:hover {\n  background: #dc2626;\n  transform: scale(1.1);\n}\n.empty-list[data-v-6ec25edf] {\n  text-align: center;\n  color: var(--color-text-secondary);\n  font-style: italic;\n  padding: 2rem;\n}\n@media (max-width: 600px) {\n.modal-dialog[data-v-6ec25edf] {\n    padding: 1.5rem;\n    width: 95%;\n    max-height: 90vh;\n}\n.item-inputs[data-v-6ec25edf] {\n    flex-direction: column;\n}\n.modal-actions[data-v-6ec25edf] {\n    flex-direction: column-reverse;\n    gap: 0.5rem;\n}\n.modal-actions .btn[data-v-6ec25edf] {\n    width: 100%;\n}\n}\n',""]);const s=i},5674:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.error-boundary[data-v-7ca07f60] {\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  padding: 2rem;\n}\n.error-container[data-v-7ca07f60] {\n  max-width: 600px;\n  width: 100%;\n  background: var(--color-surface);\n  border: 2px solid var(--color-error);\n  border-radius: 12px;\n  padding: 2rem;\n  text-align: center;\n}\n.error-icon[data-v-7ca07f60] {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.error-container h2[data-v-7ca07f60] {\n  color: var(--color-error);\n  margin: 0 0 1rem 0;\n  font-size: 1.8rem;\n}\n.error-message[data-v-7ca07f60] {\n  color: var(--color-text);\n  margin: 0 0 1.5rem 0;\n  font-size: 1rem;\n  line-height: 1.6;\n}\n.error-details[data-v-7ca07f60] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n  margin-bottom: 1.5rem;\n  text-align: left;\n  max-height: 300px;\n  overflow-y: auto;\n}\n.error-details pre[data-v-7ca07f60] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n.error-actions[data-v-7ca07f60] {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n.btn-retry[data-v-7ca07f60],\n.btn-back[data-v-7ca07f60],\n.btn-details[data-v-7ca07f60] {\n  padding: 0.75rem 1.5rem;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n  border: none;\n}\n.btn-retry[data-v-7ca07f60] {\n  background: var(--color-primary);\n  color: white;\n}\n.btn-retry[data-v-7ca07f60]:hover {\n  background: var(--color-primary-dark);\n  transform: translateY(-2px);\n}\n.btn-back[data-v-7ca07f60] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-back[data-v-7ca07f60]:hover {\n  background: var(--color-background);\n}\n.btn-details[data-v-7ca07f60] {\n  background: var(--color-info);\n  color: white;\n}\n.btn-details[data-v-7ca07f60]:hover {\n  background: var(--color-info-dark);\n}\n@media (max-width: 640px) {\n.error-boundary[data-v-7ca07f60] {\n    padding: 1rem;\n}\n.error-container[data-v-7ca07f60] {\n    padding: 1.5rem;\n}\n.error-container h2[data-v-7ca07f60] {\n    font-size: 1.5rem;\n}\n.error-actions[data-v-7ca07f60] {\n    flex-direction: column;\n}\n.btn-retry[data-v-7ca07f60],\n  .btn-back[data-v-7ca07f60],\n  .btn-details[data-v-7ca07f60] {\n    width: 100%;\n}\n}\n",""]);const s=i},5735:(e,t,n)=>{"use strict";n.d(t,{BC:()=>l,Ge:()=>d,VW:()=>c,Vd:()=>i,savePreset:()=>s});var a=n(5099),r=n(7760);const o="character_presets";async function i(){try{const e=await(0,a.loadFromIndexedDB)(o);return e&&Array.isArray(e.presets)?e.presets:[]}catch(e){return console.error("[预设管理器] 加载预设失败:",e),[]}}async function s(e){try{const t=`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={presets:[{id:t,savedAt:(new Date).toISOString(),...e},...await i()]};return await(0,a.saveData)(o,n),t}catch(e){throw console.error("[预设管理器] 保存预设失败:",e),e}}async function l(e){try{const t=await i(),n=t.filter(t=>t.id!==e);if(n.length===t.length)return;const r={presets:n};await(0,a.saveData)(o,r)}catch(e){throw console.error("[预设管理器] 删除预设失败:",e),e}}async function c(e){try{console.log("[预设管理器] 开始导出预设:",e);const t=await i(),n=e&&e.length>0?t.filter(t=>e.includes(t.id)):t;if(0===n.length)throw new Error("没有可导出的预设");const a=(0,r.q3)("presets",{presets:n}),o=JSON.stringify(a,null,2),s=new Blob([o],{type:"application/json"}),l=URL.createObjectURL(s),c=document.createElement("a");c.href=l;const d=`character-presets-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5)}.json`;c.download=d,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l),console.log("[预设管理器] 预设导出成功:",d)}catch(e){throw console.error("[预设管理器] 导出预设失败:",e),e}}async function d(e,t="merge"){try{console.log("[预设管理器] 开始导入预设, 模式:",t);const n=await e.text(),s=JSON.parse(n),l=(0,r.ZT)(s);let c;if("presets"===l.type&&Array.isArray(l.payload?.presets))c=l.payload.presets;else{if(!Array.isArray(s.presets))throw new Error("无效的预设文件格式");c=s.presets}let d=0,u=0;const m="replace"===t?[]:await i(),p=new Set(m.map(e=>e.id)),g=[];for(const e of c)try{if(!e.name||!e.data){console.warn("[预设管理器] 跳过无效预设:",e),u++;continue}let t=e.id;p.has(e.id)&&(t=`preset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log("[预设管理器] ID冲突,生成新ID:",e.id,"->",t));const n={...e,id:t,savedAt:(new Date).toISOString()};g.push(n),p.add(t),d++}catch(t){console.error("[预设管理器] 导入预设失败:",e,t),u++}const h={presets:"replace"===t?g:[...g,...m]};return await(0,a.saveData)(o,h),console.log("[预设管理器] 预设导入完成, 成功:",d,"失败:",u),{success:d,failed:u}}catch(e){throw console.error("[预设管理器] 导入预设失败:",e),e}}},5794:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n.hexagon-chart-container[data-v-a8caf924] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n/* 浅色主题 - 金辉仙光 */\n.grid-line[data-v-a8caf924] {\n  fill: none;\n  stroke: var(--color-primary);\n  stroke-width: 1;\n  opacity: 0.2;\n}\n.data-polygon[data-v-a8caf924] {\n  fill: url(#goldGradient);\n  stroke: var(--color-primary);\n  stroke-width: 2.5;\n  filter: drop-shadow(0 0 8px rgba(218, 165, 32, 0.3));\n  transition: all 0.3s ease;\n}\n.data-polygon[data-v-a8caf924]:hover {\n  filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.5));\n}\n.data-point[data-v-a8caf924] {\n  fill: var(--color-accent);\n  stroke: rgba(255, 255, 255, 0.9);\n  stroke-width: 2;\n  filter: drop-shadow(0 0 4px rgba(255, 140, 0, 0.4));\n}\n.data-value-text[data-v-a8caf924] {\n  fill: var(--color-text);\n  font-size: 12px;\n  font-weight: bold;\n  font-family: var(--font-family-serif);\n  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);\n}\n.label-text[data-v-a8caf924] {\n  fill: var(--color-primary);\n  font-size: 13px;\n  font-weight: 600;\n  font-family: var(--font-family-serif);\n  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);\n}\n\n/* 深色主题 - 夜空星辰 */\n[data-theme="dark"] .grid-line[data-v-a8caf924] {\n  stroke: #64b5f6;\n  opacity: 0.4;\n}\n[data-theme="dark"] .data-polygon[data-v-a8caf924] {\n  fill: url(#darkGradient);\n  stroke: #64b5f6;\n}\n[data-theme="dark"] .data-point[data-v-a8caf924] {\n  fill: #ba68c8;\n  stroke: rgba(30, 30, 60, 0.8);\n}\n[data-theme="dark"] .data-value-text[data-v-a8caf924] {\n  fill: #e1e4e8;\n}\n[data-theme="dark"] .label-text[data-v-a8caf924] {\n  fill: #64b5f6;\n}\n',""]);const s=i},5795:(e,t,n)=>{"use strict";var a=n(6549);if(a)try{a([],"length")}catch(e){a=null}e.exports=a},5826:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.game-map-panel[data-v-443560a0] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n}\n\n/* 世界信息头部 */\n.world-info-header[data-v-443560a0] {\n  padding: 12px 16px;\n  background: rgba(255, 255, 255, 0.9);\n  border-bottom: 1px solid #e2e8f0;\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  flex-wrap: wrap;\n  backdrop-filter: blur(8px);\n}\n.world-name[data-v-443560a0] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: #1e40af;\n  text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);\n  white-space: nowrap;\n}\n.world-background[data-v-443560a0] {\n  font-size: 0.85rem;\n  color: #64748b;\n  max-width: 400px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 地图容器 */\n.map-container[data-v-443560a0] {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n  border-radius: 12px;\n  border: 3px solid #cbd5e1;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #dbeafe 100%);\n  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);\n}\ncanvas[data-v-443560a0] {\n  display: block;\n  width: 100%;\n  height: 100%;\n  cursor: grab;\n}\ncanvas[data-v-443560a0]:active {\n  cursor: grabbing;\n}\n\n/* 地点信息弹窗 */\n.location-popup[data-v-443560a0] {\n  position: absolute;\n  background: rgba(255, 255, 255, 0.98);\n  backdrop-filter: blur(12px);\n  border: 2px solid rgba(59, 130, 246, 0.3);\n  border-radius: 16px;\n  padding: 20px;\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);\n  min-width: 320px;\n  max-width: 450px;\n  pointer-events: auto;\n  z-index: 2000;\n}\n.popup-header[data-v-443560a0] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n}\n.popup-header h4[data-v-443560a0] {\n  margin: 0;\n  color: #1e40af;\n  font-size: 1.25rem;\n  font-weight: 700;\n}\n.close-btn[data-v-443560a0] {\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: rgba(239, 68, 68, 0.1);\n  cursor: pointer;\n  color: #ef4444;\n  font-size: 1.4rem;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n}\n.close-btn[data-v-443560a0]:hover {\n  background: rgba(220, 38, 38, 0.2);\n  color: #dc2626;\n  transform: scale(1.1);\n}\n.popup-content[data-v-443560a0] {\n  font-size: 0.95rem;\n  line-height: 1.6;\n}\n.location-type[data-v-443560a0] {\n  color: #6366f1;\n  font-weight: 700;\n  margin: 0 0 10px 0;\n  font-size: 1rem;\n}\n.location-desc[data-v-443560a0] {\n  color: #374151;\n  margin: 0 0 14px 0;\n  font-weight: 500;\n}\n.location-detail[data-v-443560a0] {\n  color: #6b7280;\n  margin: 8px 0;\n  font-size: 0.875rem;\n  font-weight: 500;\n}\n.relation-friendly[data-v-443560a0] {\n  color: #10b981;\n  font-weight: 700;\n}\n.relation-hostile[data-v-443560a0] {\n  color: #ef4444;\n  font-weight: 700;\n}\n.relation-neutral[data-v-443560a0] {\n  color: #6b7280;\n  font-weight: 600;\n}\n\n/* 初始化地图覆盖层 */\n.initialize-map-overlay[data-v-443560a0] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.95);\n  backdrop-filter: blur(8px);\n  z-index: 2000;\n}\n.initialize-prompt[data-v-443560a0] {\n  text-align: center;\n  padding: 3rem 2rem;\n  max-width: 500px;\n  animation: fadeIn-443560a0 0.3s ease-in-out;\n}\n@keyframes fadeIn-443560a0 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.prompt-icon[data-v-443560a0] {\n  margin: 0 auto 1.5rem;\n  width: 80px;\n  height: 80px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #3b82f6, #60a5fa);\n  border-radius: 50%;\n  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);\n}\n.map-icon[data-v-443560a0] {\n  width: 48px;\n  height: 48px;\n  color: white;\n}\n.initialize-prompt h3[data-v-443560a0] {\n  margin: 0 0 1rem 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: #1e40af;\n}\n.initialize-prompt p[data-v-443560a0] {\n  margin: 0 0 2rem 0;\n  font-size: 1rem;\n  color: #64748b;\n  line-height: 1.6;\n}\n.initialize-btn[data-v-443560a0] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 2rem;\n  background: linear-gradient(135deg, #3b82f6, #60a5fa);\n  color: white;\n  border: none;\n  border-radius: 12px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);\n}\n.initialize-btn[data-v-443560a0]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);\n  background: linear-gradient(135deg, #2563eb, #3b82f6);\n}\n.initialize-btn[data-v-443560a0]:active {\n  transform: translateY(0);\n}\n.btn-icon[data-v-443560a0] {\n  width: 24px;\n  height: 24px;\n}\n.loading-spinner[data-v-443560a0] {\n  width: 60px;\n  height: 60px;\n  margin: 0 auto 1.5rem;\n  border: 4px solid rgba(59, 130, 246, 0.2);\n  border-top-color: #3b82f6;\n  border-radius: 50%;\n  animation: spin-443560a0 1s linear infinite;\n}\n@keyframes spin-443560a0 {\nto { transform: rotate(360deg);\n}\n}\n.status-text[data-v-443560a0] {\n  font-size: 0.9rem;\n  color: #3b82f6;\n  margin-top: 1rem;\n  min-height: 1.5rem;\n}\n\n/* 地图图例 */\n.map-legend[data-v-443560a0] {\n  position: absolute;\n  bottom: 24px;\n  right: 24px;\n  background: rgba(255, 255, 255, 0.98);\n  backdrop-filter: blur(12px);\n  border-radius: 16px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n  z-index: 1000;\n  min-width: 200px;\n  max-width: 280px;\n  border: 2px solid rgba(59, 130, 246, 0.3);\n  pointer-events: auto;\n  transition: all 0.3s ease;\n}\n.map-legend.collapsed[data-v-443560a0] {\n  min-width: auto;\n}\n.legend-header[data-v-443560a0] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  cursor: pointer;\n  user-select: none;\n  border-radius: 14px 14px 0 0;\n  transition: background 0.2s ease;\n}\n.legend-header[data-v-443560a0]:hover {\n  background: rgba(59, 130, 246, 0.05);\n}\n.legend-title[data-v-443560a0] {\n  font-weight: 700;\n  color: #1e40af;\n  font-size: 1.05rem;\n  flex: 1;\n}\n.legend-toggle[data-v-443560a0] {\n  background: none;\n  border: none;\n  color: #3b82f6;\n  cursor: pointer;\n  padding: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.legend-toggle[data-v-443560a0]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  transform: scale(1.1);\n}\n.legend-items[data-v-443560a0] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  max-height: 400px;\n  overflow-y: auto;\n  padding: 0 20px 20px;\n}\n.legend-items[data-v-443560a0]::-webkit-scrollbar {\n  width: 6px;\n}\n.legend-items[data-v-443560a0]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 3px;\n}\n.legend-items[data-v-443560a0]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 3px;\n}\n.legend-items[data-v-443560a0]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n.legend-item[data-v-443560a0] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 0.9rem;\n  color: #374151;\n  padding: 8px 10px;\n  font-weight: 600;\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.legend-item[data-v-443560a0]:hover {\n  background: rgba(59, 130, 246, 0.08);\n  transform: translateX(2px);\n}\n.legend-icon[data-v-443560a0] {\n  flex-shrink: 0;\n}\n\n/* 图标颜色 */\n.legend-icon.mountain[data-v-443560a0] {\n  color: #2D7D32;\n}\n.legend-icon.faction[data-v-443560a0] {\n  color: #1565C0;\n}\n.legend-icon.town[data-v-443560a0] {\n  color: #F57C00;\n}\n.legend-icon.blessed[data-v-443560a0] {\n  color: #7B1FA2;\n}\n.legend-icon.treasure[data-v-443560a0] {\n  color: #388E3C;\n}\n.legend-icon.danger[data-v-443560a0] {\n  color: #D32F2F;\n}\n.legend-icon.special[data-v-443560a0] {\n  color: #6B7280;\n}\n.legend-icon.player[data-v-443560a0] {\n  color: #3b82f6;\n  animation: pulse-player-443560a0 2s ease-in-out infinite;\n}\n.legend-icon.npc[data-v-443560a0] {\n  color: #8b5cf6;\n}\n@keyframes pulse-player-443560a0 {\n0%, 100% {\n    opacity: 1;\n}\n50% {\n    opacity: 0.6;\n}\n}\n\n/* 全屏模式优化 */\n.game-map-panel[data-v-443560a0]:fullscreen {\n  background: #1a1a2e;\n}\n.game-map-panel:fullscreen .map-container[data-v-443560a0] {\n  border: none;\n  border-radius: 0;\n}\n.game-map-panel:fullscreen .map-legend[data-v-443560a0] {\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n}\n.game-map-panel:fullscreen .location-popup[data-v-443560a0] {\n  background: rgba(0, 0, 0, 0.9);\n  color: white;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.world-info-header[data-v-443560a0] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 8px;\n}\n.world-background[data-v-443560a0] {\n    max-width: 100%;\n    white-space: normal;\n    line-height: 1.5;\n}\n.map-legend[data-v-443560a0] {\n    position: static;\n    margin: 10px 0 0;\n    width: 100%;\n    max-width: none;\n    padding: 12px;\n}\n.location-popup[data-v-443560a0] {\n    min-width: auto;\n    max-width: calc(100vw - 40px);\n}\n}\n",""]);const s=i},5880:e=>{"use strict";e.exports=Math.pow},5954:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"/*\n * 超凡新生 - 科技风格主题\n * Futuristic Tech Style Theme\n *\n * 特性：\n * - 高对比度的蓝色/紫色/青色配色\n * - 发光效果和渐变\n * - 网格和线条元素\n * - 现代化的动画和过渡\n * - 极简但富有科技感的设计\n */\n\n:root {\n  /* ========== 科技色彩系统 ========== */\n  /* 替换传统色彩为科技色彩 */\n  --tech-primary: #00d9ff;      /* 亮青色 */\n  --tech-primary-dark: #0099cc; /* 深青色 */\n  --tech-secondary: #9d00ff;    /* 紫色 */\n  --tech-accent: #00ffaa;       /* 翠绿色 */\n  --tech-warning: #ff6b00;      /* 橙色 */\n  --tech-danger: #ff0055;       /* 玫红色 */\n  --tech-success: #00ff88;      /* 绿色 */\n  --tech-background: #0a0e27;   /* 深蓝黑 */\n  --tech-surface: #0f1535;      /* 稍亮的深蓝 */\n  --tech-border: #1a2a5e;       /* 蓝色边框 */\n  --tech-glow: rgba(0, 217, 255, 0.3);\n  --tech-glow-strong: rgba(0, 217, 255, 0.6);\n}\n\n:root[data-theme='light'] {\n  /* 浅色主题的科技风格 */\n  --tech-primary: #00d9ff;\n  --tech-primary-dark: #0088bb;\n  --tech-secondary: #7d2fd9;\n  --tech-accent: #00cc66;\n  --tech-warning: #ff6b00;\n  --tech-danger: #ff0055;\n  --tech-success: #00dd66;\n  --tech-background: #f5f7ff;\n  --tech-surface: #eef2ff;\n  --tech-border: #c5d3ff;\n  --tech-glow: rgba(0, 217, 255, 0.2);\n  --tech-glow-strong: rgba(0, 217, 255, 0.4);\n}\n\n:root[data-theme='dark'] {\n  /* 暗色主题的科技风格 */\n  --tech-primary: #00d9ff;\n  --tech-primary-dark: #0099cc;\n  --tech-secondary: #b366ff;\n  --tech-accent: #00ffaa;\n  --tech-warning: #ff7700;\n  --tech-danger: #ff3366;\n  --tech-success: #00ff88;\n  --tech-background: #0a0e27;\n  --tech-surface: #0f1535;\n  --tech-border: #1a3a6e;\n  --tech-glow: rgba(0, 217, 255, 0.3);\n  --tech-glow-strong: rgba(0, 217, 255, 0.6);\n}\n\n/* ========== 全局样式覆盖 ========== */\n\n/* 背景网格效果 */\n#app::before {\n  content: '';\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-image:\n    linear-gradient(0deg, transparent 24%, rgba(0, 217, 255, 0.03) 25%, rgba(0, 217, 255, 0.03) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.03) 75%, rgba(0, 217, 255, 0.03) 76%, transparent 77%, transparent),\n    linear-gradient(90deg, transparent 24%, rgba(0, 217, 255, 0.03) 25%, rgba(0, 217, 255, 0.03) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, 0.03) 75%, rgba(0, 217, 255, 0.03) 76%, transparent 77%, transparent);\n  background-size: 50px 50px;\n  pointer-events: none;\n  z-index: -1;\n  animation: grid-animation 20s linear infinite;\n}\n\n@keyframes grid-animation {\n  0% {\n    background-position: 0 0;\n  }\n  100% {\n    background-position: 50px 50px;\n  }\n}\n\n/* ========== 按钮科技风格 ========== */\n\n.btn {\n  position: relative;\n  border: 2px solid var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.1));\n  color: var(--tech-primary);\n  font-weight: 600;\n  letter-spacing: 0.05em;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);\n  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.2), inset 0 0 20px rgba(0, 217, 255, 0.1);\n  overflow: hidden;\n  border-radius: 4px;\n}\n\n.btn::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s;\n}\n\n.btn:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.25), rgba(157, 0, 255, 0.2));\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.6), inset 0 0 30px rgba(0, 217, 255, 0.2);\n  border-color: var(--tech-primary);\n  color: #fff;\n  text-shadow: 0 0 20px rgba(0, 217, 255, 0.8);\n}\n\n.btn::before:hover {\n  left: 100%;\n}\n\n.btn:active {\n  transform: scale(0.95);\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.4), inset 0 0 10px rgba(0, 217, 255, 0.3);\n}\n\n.btn.btn-primary {\n  border-color: var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 217, 255, 0.08));\n  color: var(--tech-primary);\n}\n\n.btn.btn-primary:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(0, 217, 255, 0.15));\n  box-shadow: 0 0 40px var(--tech-glow-strong), inset 0 0 30px rgba(0, 217, 255, 0.2);\n}\n\n.btn.btn-secondary {\n  border-color: var(--tech-secondary);\n  color: var(--tech-secondary);\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(157, 0, 255, 0.05));\n}\n\n.btn.btn-secondary:hover {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(157, 0, 255, 0.1));\n  box-shadow: 0 0 30px rgba(157, 0, 255, 0.4), inset 0 0 20px rgba(157, 0, 255, 0.1);\n}\n\n.btn.btn-success {\n  border-color: var(--tech-success);\n  color: var(--tech-success);\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));\n}\n\n.btn.btn-success:hover {\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));\n  box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);\n}\n\n.btn.btn-danger {\n  border-color: var(--tech-danger);\n  color: var(--tech-danger);\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.1), rgba(255, 0, 85, 0.05));\n}\n\n.btn.btn-danger:hover {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(255, 0, 85, 0.1));\n  box-shadow: 0 0 30px rgba(255, 0, 85, 0.4);\n}\n\n.btn:disabled {\n  border-color: rgba(0, 217, 255, 0.3);\n  color: rgba(0, 217, 255, 0.5);\n  background: rgba(0, 217, 255, 0.05);\n  box-shadow: none;\n  cursor: not-allowed;\n}\n\n/* ========== 卡片科技风格 ========== */\n\n.card,\n.card-panel {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.8), rgba(15, 21, 53, 0.6));\n  border: 2px solid var(--tech-border);\n  border-radius: 4px;\n  backdrop-filter: blur(10px);\n  box-shadow: 0 8px 32px rgba(0, 217, 255, 0.1), inset 0 0 20px rgba(0, 217, 255, 0.05);\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n\n.card::before,\n.card-panel::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n  opacity: 0.5;\n}\n\n.card:hover,\n.card-panel:hover {\n  border-color: var(--tech-primary);\n  box-shadow: 0 8px 40px rgba(0, 217, 255, 0.3), inset 0 0 30px rgba(0, 217, 255, 0.1);\n}\n\n/* ========== 输入框科技风格 ========== */\n\n.input,\ninput,\ntextarea,\nselect {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6));\n  border: 1px solid var(--tech-border);\n  color: var(--tech-primary);\n  transition: all 0.3s ease;\n  border-radius: 4px;\n}\n\n.input::placeholder,\ninput::placeholder,\ntextarea::placeholder {\n  color: rgba(0, 217, 255, 0.3);\n}\n\n.input:focus,\ninput:focus,\ntextarea:focus,\nselect:focus {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(15, 21, 53, 0.8));\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1);\n  outline: none;\n}\n\n/* ========== Select 下拉菜单选项 ========== */\nselect option {\n  background: #0a0e27;\n  color: var(--tech-primary);\n  border: none;\n  padding: 8px 6px;\n}\n\nselect option:hover,\nselect option:focus,\nselect option:checked {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  color: var(--tech-primary);\n}\n\n/* ========== 标签页科技风格 ========== */\n\n.tab-trigger {\n  position: relative;\n  color: rgba(0, 217, 255, 0.6);\n  border: 1px solid transparent;\n  background: transparent;\n  transition: all 0.3s ease;\n}\n\n.tab-trigger::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 0;\n  height: 2px;\n  background: var(--tech-primary);\n  transition: width 0.3s ease;\n}\n\n.tab-trigger:hover {\n  color: var(--tech-primary);\n}\n\n.tab-trigger:hover::after {\n  width: 100%;\n}\n\n.tab-trigger[data-state=\"active\"],\n.tab-trigger.active {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  border: 1px solid var(--tech-border);\n  color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);\n}\n\n.tab-trigger[data-state=\"active\"]::after,\n.tab-trigger.active::after {\n  width: 100%;\n}\n\n/* ========== 徽章科技风格 ========== */\n\n.badge {\n  border: 1px solid var(--tech-border);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.05));\n  color: var(--tech-primary);\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);\n}\n\n.badge-primary {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 217, 255, 0.1));\n  border-color: var(--tech-primary);\n  color: var(--tech-primary);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);\n}\n\n.badge-success {\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));\n  border-color: var(--tech-success);\n  color: var(--tech-success);\n  box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);\n}\n\n.badge-warning {\n  background: linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(255, 107, 0, 0.1));\n  border-color: var(--tech-warning);\n  color: var(--tech-warning);\n  box-shadow: 0 0 15px rgba(255, 107, 0, 0.3);\n}\n\n.badge-danger {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(255, 0, 85, 0.1));\n  border-color: var(--tech-danger);\n  color: var(--tech-danger);\n  box-shadow: 0 0 15px rgba(255, 0, 85, 0.3);\n}\n\n/* ========== 滚动条科技风格 ========== */\n\n::-webkit-scrollbar {\n  width: 12px;\n  height: 12px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(10, 14, 39, 0.5);\n}\n\n::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, var(--tech-primary), var(--tech-secondary));\n  border-radius: 6px;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(180deg, var(--tech-primary), var(--tech-accent));\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);\n}\n\n/* ========== 模态对话框科技风格 ========== */\n\n.modal-dialog,\n.author-modal {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.95), rgba(10, 14, 39, 0.95));\n  border: 2px solid var(--tech-primary);\n  box-shadow: 0 25px 50px rgba(0, 217, 255, 0.2), inset 0 0 40px rgba(0, 217, 255, 0.1);\n  backdrop-filter: blur(20px);\n  border-radius: 4px;\n}\n\n.modal-dialog::before,\n.author-modal::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n}\n\n/* ========== 顶部按钮科技风格 ========== */\n\n.theme-toggle,\n.fullscreen-toggle,\n.global-actions button {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.1));\n  border: 1px solid var(--tech-border);\n  color: var(--tech-primary);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);\n  transition: all 0.3s ease;\n  border-radius: 4px;\n}\n\n.theme-toggle:hover,\n.fullscreen-toggle:hover,\n.global-actions button:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.4);\n  border-color: var(--tech-primary);\n}\n\n/* ========== 进度条科技风格 ========== */\n\n.progress-bar {\n  background: rgba(0, 217, 255, 0.1);\n  border: 1px solid var(--tech-border);\n  border-radius: 2px;\n  overflow: hidden;\n  box-shadow: inset 0 0 10px rgba(0, 217, 255, 0.1);\n}\n\n.progress-fill {\n  background: linear-gradient(90deg, var(--tech-primary), var(--tech-accent));\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.6);\n  transition: width 0.3s ease;\n}\n\n.progress-fill::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n  animation: progress-shimmer 2s infinite;\n}\n\n@keyframes progress-shimmer {\n  0% {\n    transform: translateX(-100%);\n  }\n  100% {\n    transform: translateX(100%);\n  }\n}\n\n/* ========== 列表项科技风格 ========== */\n\n.list-item {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.5), rgba(10, 14, 39, 0.5));\n  border: 1px solid var(--tech-border);\n  transition: all 0.3s ease;\n}\n\n.list-item:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.08));\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);\n}\n\n.list-item.active {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.3);\n}\n\n/* ========== 统计卡片科技风格 ========== */\n\n.stat-card {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.7), rgba(10, 14, 39, 0.7));\n  border: 1px solid var(--tech-border);\n  box-shadow: 0 8px 32px rgba(0, 217, 255, 0.1);\n  transition: all 0.3s ease;\n}\n\n.stat-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 12px 40px rgba(0, 217, 255, 0.2);\n  border-color: var(--tech-primary);\n}\n\n.stat-icon {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  border: 1px solid var(--tech-border);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);\n  color: var(--tech-primary);\n}\n\n.stat-value {\n  color: var(--tech-primary);\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);\n}\n\n/* ========== 文字科技风格 ========== */\n\n.genesis-title,\n.main-title,\nh1, h2, h3, h4, h5, h6 {\n  color: var(--tech-primary);\n  text-shadow: 0 0 20px rgba(0, 217, 255, 0.4);\n}\n\n.text-primary {\n  color: var(--tech-primary) !important;\n}\n\n.text-success {\n  color: var(--tech-success) !important;\n}\n\n.text-warning {\n  color: var(--tech-warning) !important;\n}\n\n.text-danger {\n  color: var(--tech-danger) !important;\n}\n\n/* ========== 动画效果 ========== */\n\n@keyframes glow-pulse {\n  0%, 100% {\n    box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);\n  }\n  50% {\n    box-shadow: 0 0 40px rgba(0, 217, 255, 0.6);\n  }\n}\n\n@keyframes cyber-flicker {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.8;\n  }\n}\n\n@keyframes neon-glow {\n  0%, 100% {\n    text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);\n  }\n  50% {\n    text-shadow: 0 0 20px rgba(0, 217, 255, 0.8);\n  }\n}\n\n.glow-pulse {\n  animation: glow-pulse 3s ease-in-out infinite;\n}\n\n.cyber-flicker {\n  animation: cyber-flicker 0.15s infinite;\n}\n\n.neon-text {\n  animation: neon-glow 2s ease-in-out infinite;\n}\n\n/* ========== 分割线科技风格 ========== */\n\n.divider {\n  background: linear-gradient(90deg, transparent, var(--tech-border), transparent);\n  height: 2px;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);\n}\n\n.divider-vertical {\n  background: linear-gradient(180deg, transparent, var(--tech-border), transparent);\n  width: 2px;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);\n}\n\n/* ========== 响应式调整 ========== */\n\n@media (max-width: 1024px) {\n  .card,\n  .card-panel {\n    box-shadow: 0 4px 20px rgba(0, 217, 255, 0.1);\n  }\n\n  .btn {\n    box-shadow: 0 0 15px rgba(0, 217, 255, 0.15);\n  }\n}\n\n@media (max-width: 768px) {\n  :root::before {\n    background-size: 30px 30px;\n  }\n\n  .card,\n  .card-panel {\n    box-shadow: 0 2px 15px rgba(0, 217, 255, 0.08);\n  }\n}\n\n@media (max-width: 480px) {\n  .modal-dialog,\n  .author-modal {\n    box-shadow: 0 10px 30px rgba(0, 217, 255, 0.15);\n  }\n}\n",""]);const s=i},5976:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},6095:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.attribute-allocation-container[data-v-88b3b82e] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  color: var(--color-text);\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n}\n.header[data-v-88b3b82e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid rgba(147, 197, 253, 0.2);\n}\n.points-display .negative[data-v-88b3b82e] {\n  color: #f87171 !important;\n}\nh2[data-v-88b3b82e] {\n  margin: 0;\n  color: #93c5fd;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.points-display[data-v-88b3b82e] {\n  font-size: 1.2rem;\n  color: #94a3b8;\n}\n.points-display span[data-v-88b3b82e] {\n  font-weight: 600;\n  color: #fbbf24;\n  font-size: 1.5rem;\n}\n.attributes-list[data-v-88b3b82e] {\n  overflow-y: auto;\n  flex-grow: 1;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.attributes-list[data-v-88b3b82e]::-webkit-scrollbar { width: 6px;\n}\n.attributes-list[data-v-88b3b82e]::-webkit-scrollbar-track { background: transparent;\n}\n.attributes-list[data-v-88b3b82e]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.attribute-item[data-v-88b3b82e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 0.5rem;\n  margin-bottom: 0.5rem;\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.4);\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.attribute-item[data-v-88b3b82e]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.attribute-item[data-v-88b3b82e]:last-child {\n  margin-bottom: 0;\n}\n.attribute-info[data-v-88b3b82e] {\n  flex-basis: 70%;\n}\n.attribute-name[data-v-88b3b82e] {\n  font-size: 1.1rem;\n  font-weight: 500;\n  color: #93c5fd;\n}\n.attribute-desc[data-v-88b3b82e] {\n  font-size: 0.85rem;\n  color: #94a3b8;\n  margin: 0.3rem 0 0 0;\n  line-height: 1.4;\n}\n.attribute-controls[data-v-88b3b82e] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.attribute-controls button[data-v-88b3b82e] {\n  width: 35px;\n  height: 35px;\n  border-radius: 50%;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  color: #93c5fd;\n  font-size: 1.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.attribute-controls button[data-v-88b3b82e]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.3);\n  border-color: #93c5fd;\n  color: #bfdbfe;\n}\n.attribute-controls button[data-v-88b3b82e]:disabled,\n.attribute-controls button.disabled[data-v-88b3b82e] {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: rgba(30, 41, 59, 0.3);\n  border-color: rgba(255, 255, 255, 0.06);\n  color: #64748b;\n}\n.attribute-value[data-v-88b3b82e] {\n  font-size: 1.4rem;\n  font-weight: 600;\n  min-width: 30px;\n  text-align: center;\n  color: #f1f5f9;\n}\n.actions[data-v-88b3b82e] {\n  padding-top: 1rem;\n  display: flex;\n  justify-content: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.actions button[data-v-88b3b82e] {\n  padding: 0.5rem 1.5rem;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  background: rgba(30, 41, 59, 0.6);\n  color: #f1f5f9;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n}\n.actions button[data-v-88b3b82e]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.5);\n}\n.actions .btn-secondary[data-v-88b3b82e] {\n  border-color: rgba(148, 163, 184, 0.4);\n  color: #94a3b8;\n}\n.actions .btn-secondary[data-v-88b3b82e]:hover {\n  background: rgba(148, 163, 184, 0.2);\n  border-color: #94a3b8;\n  color: #f1f5f9;\n}\n.actions .btn-warning[data-v-88b3b82e] {\n  border-color: rgba(251, 191, 36, 0.4);\n  color: #fbbf24;\n}\n.actions .btn-warning[data-v-88b3b82e]:hover {\n  background: rgba(251, 191, 36, 0.2);\n  border-color: #fbbf24;\n  color: #fef3c7;\n}\n.actions .btn-success[data-v-88b3b82e] {\n  border-color: rgba(52, 211, 153, 0.4);\n  color: #34d399;\n}\n.actions .btn-success[data-v-88b3b82e]:hover {\n  background: rgba(52, 211, 153, 0.2);\n  border-color: #34d399;\n  color: #a7f3d0;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n.attribute-allocation-container[data-v-88b3b82e] {\n    padding-bottom: 1rem;\n}\n.header[data-v-88b3b82e] {\n    flex-direction: column;\n    gap: 0.5rem;\n    text-align: center;\n    padding-bottom: 0.75rem;\n    margin-bottom: 1rem;\n}\n.header h2[data-v-88b3b82e] {\n    font-size: 1.3rem;\n}\n.points-display[data-v-88b3b82e] {\n    font-size: 1rem;\n}\n.points-display span[data-v-88b3b82e] {\n    font-size: 1.2rem;\n}\n.attributes-list[data-v-88b3b82e] {\n    margin-bottom: 0.5rem;\n}\n.attribute-item[data-v-88b3b82e] {\n    flex-direction: row;\n    gap: 0.75rem;\n    padding: 0.75rem 0.5rem;\n}\n.attribute-info[data-v-88b3b82e] {\n    flex: 1;\n    min-width: 0;\n}\n.attribute-name[data-v-88b3b82e] {\n    font-size: 0.95rem;\n}\n.attribute-desc[data-v-88b3b82e] {\n    font-size: 0.75rem;\n    line-height: 1.3;\n}\n.attribute-controls[data-v-88b3b82e] {\n    justify-content: flex-end;\n    gap: 0.5rem;\n    flex-shrink: 0;\n}\n.attribute-controls button[data-v-88b3b82e] {\n    width: 32px;\n    height: 32px;\n    font-size: 1.4rem;\n}\n.attribute-value[data-v-88b3b82e] {\n    font-size: 1.2rem;\n    min-width: 28px;\n}\n.actions[data-v-88b3b82e] {\n    gap: 0.5rem;\n    padding: 0.75rem 0;\n}\n.actions button[data-v-88b3b82e] {\n    padding: 0.5rem 1rem;\n    font-size: 0.85rem;\n    flex: 1;\n    min-width: 70px;\n}\n}\n@media (max-width: 640px) {\n.header[data-v-88b3b82e] {\n    gap: 0.5rem;\n}\n.header h2[data-v-88b3b82e] {\n    font-size: 1.2rem;\n}\n.attribute-item[data-v-88b3b82e] {\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem 0.5rem;\n    align-items: center;\n}\n.attribute-info[data-v-88b3b82e] {\n    flex-basis: auto;\n    text-align: center;\n    width: 100%;\n}\n.attribute-name[data-v-88b3b82e] {\n    font-size: 1rem;\n    display: block;\n    margin-bottom: 0.25rem;\n}\n.attribute-controls[data-v-88b3b82e] {\n    justify-content: center;\n    gap: 1rem;\n}\n.attribute-controls button[data-v-88b3b82e] {\n    width: 38px;\n    height: 38px;\n    font-size: 1.6rem;\n}\n.attribute-value[data-v-88b3b82e] {\n    font-size: 1.4rem;\n    min-width: 35px;\n}\n.actions[data-v-88b3b82e] {\n    gap: 0.5rem;\n    padding: 1rem 0 0.5rem;\n}\n.actions button[data-v-88b3b82e] {\n    padding: 0.6rem 1.2rem;\n    font-size: 0.9rem;\n}\n}\n@media (max-width: 480px) {\n.header h2[data-v-88b3b82e] {\n    font-size: 1.1rem;\n}\n.points-display[data-v-88b3b82e] {\n    font-size: 0.9rem;\n}\n.points-display span[data-v-88b3b82e] {\n    font-size: 1.1rem;\n}\n.attribute-name[data-v-88b3b82e] {\n    font-size: 0.95rem;\n}\n.attribute-desc[data-v-88b3b82e] {\n    font-size: 0.7rem;\n}\n.attribute-controls button[data-v-88b3b82e] {\n    width: 36px;\n    height: 36px;\n    font-size: 1.5rem;\n}\n.attribute-value[data-v-88b3b82e] {\n    font-size: 1.3rem;\n    min-width: 32px;\n}\n.actions[data-v-88b3b82e] {\n    flex-wrap: wrap;\n    padding: 0.75rem 0;\n}\n.actions button[data-v-88b3b82e] {\n    flex: 1 1 calc(33.333% - 0.5rem);\n    min-width: 80px;\n    padding: 0.6rem 0.75rem;\n    font-size: 0.85rem;\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .attribute-allocation-container[data-v-88b3b82e] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .header[data-v-88b3b82e] {\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] h2[data-v-88b3b82e] {\n  color: #2563eb;\n}\n[data-theme="light"] .points-display[data-v-88b3b82e] {\n  color: #475569;\n}\n[data-theme="light"] .points-display span[data-v-88b3b82e] {\n  color: #d97706;\n}\n[data-theme="light"] .attribute-item[data-v-88b3b82e] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .attribute-item[data-v-88b3b82e]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .attribute-name[data-v-88b3b82e] {\n  color: #2563eb;\n}\n[data-theme="light"] .attribute-desc[data-v-88b3b82e] {\n  color: #475569;\n}\n[data-theme="light"] .attribute-value[data-v-88b3b82e] {\n  color: #1e293b;\n}\n[data-theme="light"] .attribute-controls button[data-v-88b3b82e] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .attribute-controls button[data-v-88b3b82e]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n}\n[data-theme="light"] .actions button[data-v-88b3b82e] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .actions button[data-v-88b3b82e]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.5);\n}\n',""]);const s=i},6119:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.panel-header[data-v-759e00bb] {\n  padding: 1rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.panel-title[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.2rem;\n  color: var(--color-text);\n}\n.header-actions[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.search-bar[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.5rem;\n  min-width: 180px;\n  flex: 1 1 220px;\n}\n.search-input[data-v-759e00bb] {\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  flex: 1;\n}\n.format-guide-btn[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-accent);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.format-guide-btn[data-v-759e00bb]:hover {\n  background: var(--color-accent-hover);\n  transform: translateY(-1px);\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.panel-header[data-v-759e00bb] {\n    flex-direction: column;\n    gap: 0.5rem;\n    align-items: stretch;\n}\n.panel-title[data-v-759e00bb] {\n    font-size: 1.1rem;\n}\n.header-actions[data-v-759e00bb] {\n    justify-content: stretch;\n}\n.search-bar[data-v-759e00bb] {\n    min-width: 100%;\n    flex: 1;\n}\n}\n@media (max-width: 480px) {\n.panel-header[data-v-759e00bb] {\n    padding: 0.75rem;\n}\n.panel-title[data-v-759e00bb] {\n    font-size: 1rem;\n}\n.search-bar[data-v-759e00bb] {\n    padding: 0.4rem;\n}\n.search-input[data-v-759e00bb] {\n    font-size: 0.8rem;\n}\n}\n.header-buttons[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 0 0 auto;\n  white-space: nowrap;\n  min-width: fit-content;\n}\n.refresh-btn[data-v-759e00bb],\n.export-btn[data-v-759e00bb],\n.stats-btn[data-v-759e00bb] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.refresh-btn[data-v-759e00bb]:hover,\n.export-btn[data-v-759e00bb]:hover,\n.stats-btn[data-v-759e00bb]:hover {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.animate-spin[data-v-759e00bb] {\n  animation: spin-759e00bb 1s linear infinite;\n}\n@keyframes spin-759e00bb {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n@media (max-width: 560px) {\n.header-buttons .refresh-btn span[data-v-759e00bb],\n  .header-buttons .export-btn span[data-v-759e00bb],\n  .header-buttons .stats-btn span[data-v-759e00bb] {\n    display: none;\n}\n}\n",""]);const s=i},6188:e=>{"use strict";e.exports=Math.max},6254:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'/*\n * 超凡新生 - 弹窗/对话框科技风格\n * Modal & Dialog Tech Style\n * 统一所有弹窗的科技风格\n */\n\n/* ========== 通用弹窗样式 ========== */\n\n/* 弹窗覆盖层 */\n.modal-overlay,\n.dialog-overlay,\n.retry-dialog-overlay,\n.custom-confirm-overlay,\n.quantity-modal-overlay,\n.item-modal-overlay,\n.save-migration {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n}\n\n/* 弹窗容器 */\n.dialog-box,\n.retry-dialog,\n.quantity-modal,\n.custom-confirm-modal,\n.item-modal,\n.modal-container,\n.action-config-modal,\n.deep-cultivation-modal,\n.preset-save-modal,\n[class*="modal"]:not(.modal-overlay):not(.modal-appear) {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.98), rgba(10, 14, 39, 0.98)) !important;\n  border: 2px solid var(--tech-primary) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4), inset 0 0 20px rgba(0, 217, 255, 0.1) !important;\n  backdrop-filter: blur(20px) !important;\n  -webkit-backdrop-filter: blur(20px) !important;\n  position: relative;\n}\n\n/* 弹窗头部 */\n.dialog-title,\n.modal-header,\n.confirm-header,\n.retry-dialog-title,\n[class*="modal-header"] h3,\n[class*="modal-title"] {\n  color: var(--tech-primary) !important;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.3) !important;\n  font-weight: 600 !important;\n  margin: 0 !important;\n}\n\n/* 弹窗内容 */\n.dialog-message,\n.modal-content,\n.confirm-content,\n.retry-dialog-message,\n[class*="modal-body"],\n[class*="modal-content"] {\n  color: rgba(0, 217, 255, 0.85) !important;\n}\n\n/* 弹窗输入框 */\n.dialog-input,\n[class*="modal"] input[type="text"],\n[class*="modal"] input[type="number"],\n[class*="modal"] input[type="email"],\n[class*="modal"] input[type="password"],\n[class*="modal"] textarea {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  padding: 8px 12px !important;\n  transition: all 0.3s ease !important;\n}\n\n.dialog-input::placeholder,\n[class*="modal"] input::placeholder,\n[class*="modal"] textarea::placeholder {\n  color: rgba(0, 217, 255, 0.3) !important;\n}\n\n.dialog-input:focus,\n[class*="modal"] input:focus,\n[class*="modal"] textarea:focus {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(15, 21, 53, 0.8)) !important;\n  border-color: var(--tech-primary) !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1) !important;\n  outline: none !important;\n}\n\n/* ========== 弹窗按钮 ========== */\n\n.btn-dialog-confirm,\n.btn-confirm,\n.confirm-btn:not(.cancel-btn),\n[class*="modal"] .btn-confirm,\n[class*="modal-footer"] button:not([class*="cancel"]):not(.secondary):not(.danger),\n.action-button.confirm-button,\n.preset-action-button.confirm-button {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15)) !important;\n  border: 2px solid var(--tech-primary) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  padding: 10px 20px !important;\n  font-weight: 600 !important;\n  cursor: pointer !important;\n  transition: all 0.3s ease !important;\n}\n\n.btn-dialog-confirm:hover:not(:disabled),\n.btn-confirm:hover:not(:disabled),\n.confirm-btn:hover:not(:disabled),\n[class*="modal"] .btn-confirm:hover:not(:disabled),\n.action-button.confirm-button:hover,\n.preset-action-button.confirm-button:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(157, 0, 255, 0.2)) !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.4) !important;\n  transform: translateY(-2px) !important;\n}\n\n/* 取消/关闭按钮 */\n.btn-dialog-cancel,\n.btn-cancel,\n.cancel-btn,\n.confirm-close-btn,\n[class*="modal"] .btn-cancel,\n[class*="modal-footer"] button[class*="cancel"],\n.action-button:not(.confirm-button),\n.preset-action-button:not(.confirm-button) {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.08), rgba(157, 0, 255, 0.04)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: rgba(0, 217, 255, 0.7) !important;\n  border-radius: 4px !important;\n  padding: 10px 20px !important;\n  font-weight: 500 !important;\n  cursor: pointer !important;\n  transition: all 0.3s ease !important;\n}\n\n.btn-dialog-cancel:hover,\n.btn-cancel:hover,\n.cancel-btn:hover,\n.confirm-close-btn:hover,\n[class*="modal"] .btn-cancel:hover,\n.action-button:hover,\n.preset-action-button:hover {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.15), rgba(157, 0, 255, 0.08)) !important;\n  border-color: var(--tech-secondary) !important;\n  color: var(--tech-secondary) !important;\n  box-shadow: 0 0 15px rgba(157, 0, 255, 0.2) !important;\n}\n\n/* 危险按钮 */\n.btn-danger,\n.discard-confirm,\n[class*="modal"] .btn-danger,\n.action-button.danger {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.15), rgba(255, 0, 85, 0.08)) !important;\n  border: 1px solid var(--tech-danger) !important;\n  color: var(--tech-danger) !important;\n}\n\n.btn-danger:hover:not(:disabled),\n.discard-confirm:hover,\n[class*="modal"] .btn-danger:hover:not(:disabled),\n.action-button.danger:hover {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.25), rgba(255, 0, 85, 0.15)) !important;\n  box-shadow: 0 0 20px rgba(255, 0, 85, 0.3) !important;\n}\n\n/* 按钮禁用状态 */\nbutton:disabled,\n.btn:disabled,\n[class*="modal"] button:disabled {\n  opacity: 0.45 !important;\n  cursor: not-allowed !important;\n  pointer-events: none !important;\n}\n\n/* ========== 弹窗分割线 ========== */\n\n[class*="modal"] hr,\n[class*="modal"] .divider,\n.modal-header,\n.confirm-header {\n  border: none !important;\n  border-bottom: 1px solid var(--tech-border) !important;\n  background: none !important;\n}\n\n/* ========== 弹窗头部装饰线 ========== */\n\n.modal-header::before,\n.confirm-header::before,\n.dialog-box::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 2px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n  z-index: 10;\n}\n\n/* ========== 其他弹窗特定样式 ========== */\n\n/* 关闭按钮 */\n[class*="close"],\n.confirm-close-btn {\n  background: transparent !important;\n  border: none !important;\n  color: rgba(0, 217, 255, 0.6) !important;\n  transition: all 0.2s ease !important;\n}\n\n[class*="close"]:hover,\n.confirm-close-btn:hover {\n  color: var(--tech-primary) !important;\n  transform: rotate(90deg) !important;\n}\n\n/* 加载状态 */\n.loading,\n[class*="loading"] {\n  color: var(--tech-primary) !important;\n}\n\n/* 列表项 */\n[class*="modal"] li,\n[class*="modal"] .list-item,\n[class*="preset"] .preset-item {\n  color: rgba(0, 217, 255, 0.8) !important;\n  border: 1px solid var(--tech-border) !important;\n  border-radius: 4px !important;\n  transition: all 0.2s ease !important;\n}\n\n[class*="modal"] li:hover,\n[class*="preset"] .preset-item:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05), rgba(157, 0, 255, 0.03)) !important;\n  border-color: var(--tech-primary) !important;\n}\n\n/* ========== 动画效果 ========== */\n\n@keyframes modal-appear {\n  from {\n    opacity: 0;\n    transform: scale(0.95) translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n}\n\n[class*="modal"]:not(.modal-overlay) {\n  animation: modal-appear 0.3s ease-out !important;\n}\n\n/* ========== 响应式 ========== */\n\n@media (max-width: 768px) {\n  .modal-overlay,\n  .dialog-overlay,\n  .retry-dialog-overlay,\n  .custom-confirm-overlay,\n  .quantity-modal-overlay {\n    padding: 16px !important;\n  }\n\n  [class*="modal"],\n  .dialog-box,\n  .retry-dialog,\n  .quantity-modal,\n  .custom-confirm-modal {\n    max-width: 100% !important;\n    width: 100% !important;\n  }\n}\n\n@media (max-width: 480px) {\n  .modal-overlay,\n  .dialog-overlay,\n  .retry-dialog-overlay,\n  .custom-confirm-overlay,\n  .quantity-modal-overlay {\n    padding: 12px !important;\n  }\n\n  [class*="modal"],\n  .dialog-box,\n  .retry-dialog,\n  .quantity-modal,\n  .custom-confirm-modal {\n    border-radius: 3px !important;\n  }\n}\n',""]);const s=i},6262:(e,t)=>{"use strict";t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&i[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},6477:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-members[data-v-659283e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-height: 60vh;\n  overflow-y: auto;\n}\n.player-info-bar[data-v-659283e6] {\n  display: flex;\n  gap: 1.5rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.05));\n  border-radius: 8px;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.info-item[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-label[data-v-659283e6] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-659283e6] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.sect-name[data-v-659283e6] { color: var(--color-text);\n}\n.info-value.position[data-v-659283e6] { color: #9333ea;\n}\n.member-tabs[data-v-659283e6] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tab-btn[data-v-659283e6]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-659283e6] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));\n  border-color: rgba(59, 130, 246, 0.4);\n  color: #3b82f6;\n}\n.count-badge[data-v-659283e6] {\n  background: #3b82f6;\n  color: white;\n  font-size: 0.7rem;\n  padding: 0.1rem 0.4rem;\n  border-radius: 10px;\n  font-weight: 600;\n}\n.member-list[data-v-659283e6] {\n  flex: 1;\n  overflow-y: auto;\n}\n.empty-state[data-v-659283e6] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-659283e6] {\n  opacity: 0.5;\n  margin-bottom: 0.5rem;\n}\n.empty-text[data-v-659283e6] {\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n.empty-hint[data-v-659283e6] {\n  font-size: 0.8rem;\n  opacity: 0.7;\n  margin-bottom: 1rem;\n}\n.ask-btn[data-v-659283e6] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.ask-btn[data-v-659283e6]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n.members[data-v-659283e6] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.member-card[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.member-card[data-v-659283e6]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  background: var(--color-surface);\n}\n.member-card.is-self[data-v-659283e6] {\n  border-color: rgba(147, 51, 234, 0.3);\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.05), rgba(168, 85, 247, 0.02));\n}\n.member-avatar[data-v-659283e6] {\n  position: relative;\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #9333ea, #7c3aed);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.avatar-text[data-v-659283e6] {\n  color: white;\n  font-weight: 600;\n  font-size: 1rem;\n}\n.gender-badge[data-v-659283e6] {\n  position: absolute;\n  bottom: -2px;\n  right: -2px;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  font-size: 0.6rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 2px solid var(--color-background);\n}\n.gender-badge.male[data-v-659283e6] {\n  background: #3b82f6;\n  color: white;\n}\n.gender-badge.female[data-v-659283e6] {\n  background: #ec4899;\n  color: white;\n}\n.member-info[data-v-659283e6] {\n  flex: 1;\n  min-width: 0;\n}\n.member-header[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.25rem;\n}\n.member-name[data-v-659283e6] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.member-position[data-v-659283e6] {\n  font-size: 0.7rem;\n  padding: 0.1rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n}\n.position-elder[data-v-659283e6] { background: rgba(239, 68, 68, 0.1); color: #ef4444;\n}\n.position-true[data-v-659283e6] { background: rgba(139, 92, 246, 0.1); color: #8b5cf6;\n}\n.position-inner[data-v-659283e6] { background: rgba(59, 130, 246, 0.1); color: #3b82f6;\n}\n.position-outer[data-v-659283e6] { background: rgba(107, 114, 128, 0.1); color: #6b7280;\n}\n.member-details[data-v-659283e6] {\n  display: flex;\n  gap: 0.75rem;\n}\n.detail-item[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.2rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.detail-item.realm[data-v-659283e6] { color: #8b5cf6;\n}\n.relation-best[data-v-659283e6] { color: #ec4899 !important;\n}\n.relation-good[data-v-659283e6] { color: #f59e0b !important;\n}\n.relation-friendly[data-v-659283e6] { color: #22c55e !important;\n}\n.relation-normal[data-v-659283e6] { color: var(--color-text-secondary) !important;\n}\n.relation-cold[data-v-659283e6] { color: #6b7280 !important;\n}\n.relation-hostile[data-v-659283e6] { color: #ef4444 !important;\n}\n.arrow-icon[data-v-659283e6] {\n  color: var(--color-text-secondary);\n  flex-shrink: 0;\n}\n.quick-actions[data-v-659283e6] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.actions-title[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0 0 0.75rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.action-buttons[data-v-659283e6] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.5rem;\n}\n.action-btn[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.35rem;\n  padding: 0.5rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-659283e6]:hover {\n  border-color: rgba(59, 130, 246, 0.3);\n  background: rgba(59, 130, 246, 0.05);\n  color: #3b82f6;\n}\n.members-notice[data-v-659283e6] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #3b82f6;\n}\n",""]);const s=i},6491:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.talent-tier-selection[data-v-075e4a68] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-075e4a68], .error-state[data-v-075e4a68], .placeholder[data-v-075e4a68] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.tier-layout[data-v-075e4a68] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.tier-left-panel[data-v-075e4a68] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n/* 顶部功能按钮 */\n.top-actions-container[data-v-075e4a68] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-075e4a68] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-075e4a68]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n.tiers-list-container[data-v-075e4a68] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.tiers-list-container[data-v-075e4a68]::-webkit-scrollbar { width: 6px;\n}\n.tiers-list-container[data-v-075e4a68]::-webkit-scrollbar-track { background: transparent;\n}\n.tiers-list-container[data-v-075e4a68]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.tiers-list-container[data-v-075e4a68]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式（带天资辉光） ========== */\n.tier-item[data-v-075e4a68] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.tier-item[data-v-075e4a68]:hover {\n  background: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.15);\n  border-color: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.25);\n}\n.tier-item.selected[data-v-075e4a68] {\n  background: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.2);\n  border-color: rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.4);\n  box-shadow: 0 2px 8px rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.2);\n}\n.item-content[data-v-075e4a68] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.tier-name[data-v-075e4a68] {\n  font-weight: 600;\n  color: var(--tier-glow-color, #f1f5f9);\n  text-shadow: 0 0 10px rgba(var(--tier-glow-color-rgb, 147, 197, 253), 0.3);\n}\n.tier-points[data-v-075e4a68] {\n  color: #fbbf24;\n  font-weight: 500;\n  font-size: 0.9rem;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-075e4a68] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.tier-item:hover .action-buttons[data-v-075e4a68] {\n  opacity: 1;\n}\n.edit-btn[data-v-075e4a68], .delete-btn[data-v-075e4a68] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-075e4a68]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n}\n.delete-btn[data-v-075e4a68]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n.action-name[data-v-075e4a68] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.tier-details-container[data-v-075e4a68] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.tier-details[data-v-075e4a68] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.tier-details h2[data-v-075e4a68] {\n  margin: 0 0 1rem 0;\n  font-size: 1.8rem;\n  text-align: center;\n  flex-shrink: 0;\n  text-shadow: 0 0 30px currentColor;\n}\n.description-scroll[data-v-075e4a68] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  padding-right: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-075e4a68]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-075e4a68]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-075e4a68]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.description-scroll p[data-v-075e4a68] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.points-display[data-v-075e4a68] {\n  text-align: center;\n  font-weight: 600;\n  color: #fbbf24;\n  font-size: 1.2rem;\n  padding-top: 1rem;\n  margin-top: 1rem;\n  border-top: 1px solid rgba(255, 255, 255, 0.06);\n  flex-shrink: 0;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .tier-left-panel[data-v-075e4a68],\n[data-theme="light"] .tier-details-container[data-v-075e4a68] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .top-actions-container[data-v-075e4a68] {\n  background: rgba(241, 245, 249, 0.8);\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-075e4a68] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-075e4a68]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n[data-theme="light"] .tier-item[data-v-075e4a68] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .description-scroll p[data-v-075e4a68] {\n  color: #475569;\n}\n[data-theme="light"] .points-display[data-v-075e4a68] {\n  border-color: rgba(0, 0, 0, 0.06);\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-075e4a68],\n[data-theme="light"] .delete-btn[data-v-075e4a68] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-075e4a68]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-075e4a68]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.tier-layout[data-v-075e4a68] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.tier-layout[data-v-075e4a68] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.tier-details h2[data-v-075e4a68] {\n    font-size: 1.8rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-075e4a68] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-075e4a68] {\n    flex-grow: 1;\n    text-align: center;\n}\n.tier-layout[data-v-075e4a68] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.tier-left-panel[data-v-075e4a68] {\n    order: 1;\n    max-height: 40vh;\n}\n.tier-details-container[data-v-075e4a68] {\n    order: 2;\n    min-height: 300px;\n}\n.tiers-list-container[data-v-075e4a68] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.tier-item[data-v-075e4a68],\n  .action-item[data-v-075e4a68] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.tier-layout[data-v-075e4a68] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.tier-left-panel[data-v-075e4a68] {\n    max-height: 35vh;\n}\n.tiers-list-container[data-v-075e4a68] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.tier-item[data-v-075e4a68] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-075e4a68] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-075e4a68] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.tier-details-container[data-v-075e4a68] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.tier-details h2[data-v-075e4a68] {\n    font-size: 1.6rem;\n    margin-bottom: 0.8rem;\n}\n.points-display[data-v-075e4a68] {\n    font-size: 1.1rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-075e4a68] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.talent-tier-selection[data-v-075e4a68] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.tier-layout[data-v-075e4a68] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.tier-left-panel[data-v-075e4a68] {\n    max-height: none;\n    border-radius: 6px;\n}\n.tiers-list-container[data-v-075e4a68] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.tier-item[data-v-075e4a68] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.tier-name[data-v-075e4a68] {\n    font-size: 0.9rem;\n}\n.tier-points[data-v-075e4a68] {\n    font-size: 0.8rem;\n}\n.single-actions-container[data-v-075e4a68] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-075e4a68] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.tier-details-container[data-v-075e4a68] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.tier-details h2[data-v-075e4a68] {\n    font-size: 1.4rem;\n    margin-bottom: 0.6rem;\n    text-align: center;\n}\n.description-scroll[data-v-075e4a68] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n}\n.points-display[data-v-075e4a68] {\n    font-size: 1rem;\n    text-align: center;\n    padding-top: 0.8rem;\n    margin-top: 0.8rem;\n}\n.placeholder[data-v-075e4a68] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-075e4a68] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-075e4a68] {\n    text-align: center;\n}\n}\n@media (max-width: 360px) {\n.talent-tier-selection[data-v-075e4a68] {\n    padding: 0.3rem;\n}\n.tier-layout[data-v-075e4a68] {\n    gap: 0.4rem;\n}\n.tier-left-panel[data-v-075e4a68] {\n    max-height: 28vh;\n}\n.tiers-list-container[data-v-075e4a68] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.tier-item[data-v-075e4a68] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.tier-name[data-v-075e4a68] {\n    font-size: 0.8rem;\n}\n.tier-points[data-v-075e4a68] {\n    font-size: 0.75rem;\n}\n.tier-details-container[data-v-075e4a68] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.tier-details h2[data-v-075e4a68] {\n    font-size: 1.2rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-075e4a68] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n}\n.points-display[data-v-075e4a68] {\n    font-size: 0.9rem;\n    padding-top: 0.6rem;\n    margin-top: 0.6rem;\n}\n.action-item[data-v-075e4a68] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-075e4a68] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n',""]);const s=i},6494:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6549:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},6556:(e,t,n)=>{"use strict";var a=n(453),r=n(3126),o=r([a("%String.prototype.indexOf%")]);e.exports=function(e,t){var n=a(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?r([n]):n}},6570:e=>{"use strict";function t(e,t,a){a=a||2;var o,i,s,l,u,m,g,h=t&&t.length,f=h?t[0]*a:e.length,v=n(e,0,f,a,!0),b=[];if(!v||v.next===v.prev)return b;if(h&&(v=function(e,t,a,r){var o,i,s,l=[];for(o=0,i=t.length;o<i;o++)(s=n(e,t[o]*r,o<i-1?t[o+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),l.push(p(s));for(l.sort(c),o=0;o<l.length;o++)a=d(l[o],a);return a}(e,t,v,a)),e.length>80*a){o=s=e[0],i=l=e[1];for(var y=a;y<f;y+=a)(u=e[y])<o&&(o=u),(m=e[y+1])<i&&(i=m),u>s&&(s=u),m>l&&(l=m);g=0!==(g=Math.max(s-o,l-i))?32767/g:0}return r(v,b,a,o,i,g,0),b}function n(e,t,n,a,r){var o,i;if(r===V(e,t,n,a)>0)for(o=t;o<n;o+=a)i=E(o,e[o],e[o+1],i);else for(o=n-a;o>=t;o-=a)i=E(o,e[o],e[o+1],i);return i&&v(i,i.next)&&(N(i),i=i.next),i}function a(e,t){if(!e)return e;t||(t=e);var n,a=e;do{if(n=!1,a.steiner||!v(a,a.next)&&0!==f(a.prev,a,a.next))a=a.next;else{if(N(a),(a=t=a.prev)===a.next)break;n=!0}}while(n||a!==t);return t}function r(e,t,n,c,d,u,p){if(e){!p&&u&&function(e,t,n,a){var r=e;do{0===r.z&&(r.z=m(r.x,r.y,t,n,a)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,a,r,o,i,s,l,c=1;do{for(n=e,e=null,o=null,i=0;n;){for(i++,a=n,s=0,t=0;t<c&&(s++,a=a.nextZ);t++);for(l=c;s>0||l>0&&a;)0!==s&&(0===l||!a||n.z<=a.z)?(r=n,n=n.nextZ,s--):(r=a,a=a.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=a}o.nextZ=null,c*=2}while(i>1)}(r)}(e,c,d,u);for(var g,h,f=e;e.prev!==e.next;)if(g=e.prev,h=e.next,u?i(e,c,d,u):o(e))t.push(g.i/n|0),t.push(e.i/n|0),t.push(h.i/n|0),N(e),e=h.next,f=h.next;else if((e=h)===f){p?1===p?r(e=s(a(e),t,n),t,n,c,d,u,2):2===p&&l(e,t,n,c,d,u):r(a(e),t,n,c,d,u,1);break}}}function o(e){var t=e.prev,n=e,a=e.next;if(f(t,n,a)>=0)return!1;for(var r=t.x,o=n.x,i=a.x,s=t.y,l=n.y,c=a.y,d=r<o?r<i?r:i:o<i?o:i,u=s<l?s<c?s:c:l<c?l:c,m=r>o?r>i?r:i:o>i?o:i,p=s>l?s>c?s:c:l>c?l:c,h=a.next;h!==t;){if(h.x>=d&&h.x<=m&&h.y>=u&&h.y<=p&&g(r,s,o,l,i,c,h.x,h.y)&&f(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function i(e,t,n,a){var r=e.prev,o=e,i=e.next;if(f(r,o,i)>=0)return!1;for(var s=r.x,l=o.x,c=i.x,d=r.y,u=o.y,p=i.y,h=s<l?s<c?s:c:l<c?l:c,v=d<u?d<p?d:p:u<p?u:p,b=s>l?s>c?s:c:l>c?l:c,y=d>u?d>p?d:p:u>p?u:p,x=m(h,v,t,n,a),k=m(b,y,t,n,a),w=e.prevZ,E=e.nextZ;w&&w.z>=x&&E&&E.z<=k;){if(w.x>=h&&w.x<=b&&w.y>=v&&w.y<=y&&w!==r&&w!==i&&g(s,d,l,u,c,p,w.x,w.y)&&f(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=h&&E.x<=b&&E.y>=v&&E.y<=y&&E!==r&&E!==i&&g(s,d,l,u,c,p,E.x,E.y)&&f(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=x;){if(w.x>=h&&w.x<=b&&w.y>=v&&w.y<=y&&w!==r&&w!==i&&g(s,d,l,u,c,p,w.x,w.y)&&f(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=k;){if(E.x>=h&&E.x<=b&&E.y>=v&&E.y<=y&&E!==r&&E!==i&&g(s,d,l,u,c,p,E.x,E.y)&&f(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function s(e,t,n){var r=e;do{var o=r.prev,i=r.next.next;!v(o,i)&&b(o,r,r.next,i)&&k(o,i)&&k(i,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),N(r),N(r.next),r=e=i),r=r.next}while(r!==e);return a(r)}function l(e,t,n,o,i,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&h(l,c)){var d=w(l,c);return l=a(l,l.next),d=a(d,d.next),r(l,t,n,o,i,s,0),void r(d,t,n,o,i,s,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function d(e,t){var n=function(e,t){var n,a=t,r=e.x,o=e.y,i=-1/0;do{if(o<=a.y&&o>=a.next.y&&a.next.y!==a.y){var s=a.x+(o-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(s<=r&&s>i&&(i=s,n=a.x<a.next.x?a:a.next,s===r))return n}a=a.next}while(a!==t);if(!n)return null;var l,c=n,d=n.x,m=n.y,p=1/0;a=n;do{r>=a.x&&a.x>=d&&r!==a.x&&g(o<m?r:i,o,d,m,o<m?i:r,o,a.x,a.y)&&(l=Math.abs(o-a.y)/(r-a.x),k(a,e)&&(l<p||l===p&&(a.x>n.x||a.x===n.x&&u(n,a)))&&(n=a,p=l)),a=a.next}while(a!==c);return n}(e,t);if(!n)return t;var r=w(n,e);return a(r,r.next),a(n,n.next)}function u(e,t){return f(e.prev,e,t.prev)<0&&f(t.next,e,e.next)<0}function m(e,t,n,a,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,a,r,o,i,s){return(r-i)*(t-s)>=(e-i)*(o-s)&&(e-i)*(a-s)>=(n-i)*(t-s)&&(n-i)*(o-s)>=(r-i)*(a-s)}function h(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(k(e,t)&&k(t,e)&&function(e,t){var n=e,a=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(a=!a),n=n.next}while(n!==e);return a}(e,t)&&(f(e.prev,e,t.prev)||f(e,t.prev,t))||v(e,t)&&f(e.prev,e,e.next)>0&&f(t.prev,t,t.next)>0)}function f(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,a){var r=x(f(e,t,n)),o=x(f(e,t,a)),i=x(f(n,a,e)),s=x(f(n,a,t));return r!==o&&i!==s||!(0!==r||!y(e,n,t))||!(0!==o||!y(e,a,t))||!(0!==i||!y(n,e,a))||!(0!==s||!y(n,t,a))}function y(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function k(e,t){return f(e.prev,e,e.next)<0?f(e,t,e.next)>=0&&f(e,e.prev,t)>=0:f(e,t,e.prev)<0||f(e,e.next,t)<0}function w(e,t){var n=new S(e.i,e.x,e.y),a=new S(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,a.next=n,n.prev=a,o.next=a,a.prev=o,a}function E(e,t,n,a){var r=new S(e,t,n);return a?(r.next=a.next,r.prev=a,a.next.prev=r,a.next=r):(r.prev=r,r.next=r),r}function N(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function V(e,t,n,a){for(var r=0,o=t,i=n-a;o<n;o+=a)r+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,a){var r=t&&t.length,o=r?t[0]*n:e.length,i=Math.abs(V(e,0,o,n));if(r)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,d=s<l-1?t[s+1]*n:e.length;i-=Math.abs(V(e,c,d,n))}var u=0;for(s=0;s<a.length;s+=3){var m=a[s]*n,p=a[s+1]*n,g=a[s+2]*n;u+=Math.abs((e[m]-e[g])*(e[p+1]-e[m+1])-(e[m]-e[p])*(e[g+1]-e[m+1]))}return 0===i&&0===u?0:Math.abs((u-i)/i)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},a=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var i=0;i<t;i++)n.vertices.push(e[r][o][i]);r>0&&(a+=e[r-1].length,n.holes.push(a))}return n}},6585:(e,t,n)=>{"use strict";function a(){try{const e=localStorage.getItem("dad_game_settings");if(e){const t=JSON.parse(e);return{nsfwMode:void 0===t.enableNsfwMode||t.enableNsfwMode,nsfwGenderFilter:t.nsfwGenderFilter||"female"}}}catch{}return{nsfwMode:!0,nsfwGenderFilter:"female"}}function r(e){const t=e&&"object"==typeof e?e:{},{nsfwMode:n,nsfwGenderFilter:r}=a();return void 0===t.nsfwMode&&(t.nsfwMode=n),void 0===t.nsfwGenderFilter&&(t.nsfwGenderFilter=r),t}function o(e){if(!e||"object"!=typeof e)return e;const t=e;t["ϵͳ"]&&!t["系统"]&&(t["系统"]=t["ϵͳ"],delete t["ϵͳ"]);const n=t["系统"]&&"object"==typeof t["系统"]?t["系统"]:{};if(n["配置"]=r(n["配置"]),t["系统"]=n,n["配置"]?.nsfwMode){const e=t["角色"]&&"object"==typeof t["角色"]?t["角色"]:{},n=e["身体"]&&"object"==typeof e["身体"]?e["身体"]:{},a=(()=>{const t=e["身份"]&&"object"==typeof e["身份"]?e["身份"]:null,n=t?.性别;return"男"===n||"女"===n||"其他"===n?n:void 0})(),r=(e,t)=>{void 0===n[e]&&(n[e]=t)};"男"===a?(r("身高",178),r("体重",72),r("体脂率",14),r("三围",{胸围:98,腰围:82,臀围:96}),r("胸部描述","待AI生成"),r("生殖器描述","待AI生成")):"女"===a?(r("身高",165),r("体重",52),r("体脂率",22),r("三围",{胸围:88,腰围:62,臀围:92}),r("罩杯","C"),r("胸部描述","待AI生成"),r("私处描述","待AI生成"),r("生殖器描述","待AI生成")):(r("身高",170),r("体重",60),r("体脂率",18),r("三围",{胸围:90,腰围:70,臀围:90}),r("胸部描述","待AI生成"),r("生殖器描述","待AI生成")),r("外观特征",[]),r("敏感点",[]),r("开发度",{}),r("纹身与印记",[]),void 0===n["部位开发"]&&(n["部位开发"]={}),void 0===n["部位"]&&(n["部位"]={}),e["身体"]=n,t["角色"]=e}return t}n.d(t,{Md:()=>r,kL:()=>o,rW:()=>a})},6588:(e,t,n)=>{"use strict";n.d(t,{repairSaveData:()=>i});var a=n(2224),r=n(4530),o=n(6988);function i(e){console.log("[数据修复] 开始修复存档数据");try{if(!e||"object"!=typeof e)return console.error("[数据修复] ❌ 存档数据为空或无效，创建默认存档"),p();const n=(0,r.ru)(e)?e:(0,r.jj)(e).migrated,i=(0,a.cloneDeep)(n),s=(0,o.$)(i);if(!s.isValid)return console.warn("[数据修复] ⚠️ 存档结构不合格，使用最小V3模板兜底:",s.errors),p();if(i.元数据=i.元数据&&"object"==typeof i.元数据?i.元数据:p().元数据,i.元数据.版本号=3,i.元数据.存档ID=i.元数据.存档ID||`save_${Date.now()}`,i.元数据.存档名=i.元数据.存档名||"自动存档",i.元数据.创建时间=i.元数据.创建时间||(new Date).toISOString(),i.元数据.更新时间=(new Date).toISOString(),i.元数据.游戏时长秒=m(i.元数据.游戏时长秒,0,999999999,0),i.元数据.时间=(t=i.元数据.时间)&&"object"==typeof t?{年:m(t.年,1,999999,1e3),月:m(t.月,1,12,1),日:m(t.日,1,30,1),小时:m(t.小时,0,23,8),分钟:m(t.分钟,0,59,0)}:{年:1e3,月:1,日:1,小时:8,分钟:0},i.角色=i.角色&&"object"==typeof i.角色?i.角色:p().角色,i.角色.身份=i.角色.身份&&"object"==typeof i.角色.身份?i.角色.身份:p().角色.身份,i.角色.身份.名字=i.角色.身份.名字||"无名修士",i.角色.身份.性别=i.角色.身份.性别||"男",i.角色.身份.出生日期||(i.角色.身份.出生日期={年:982,月:1,日:1}),i.角色.身份.先天六司&&"object"==typeof i.角色.身份.先天六司){const e=i.角色.身份.先天六司;e.根骨=m(e.根骨,0,10,5),e.灵性=m(e.灵性,0,10,5),e.悟性=m(e.悟性,0,10,5),e.气运=m(e.气运,0,10,5),e.魅力=m(e.魅力,0,10,5),e.心性=m(e.心性,0,10,5)}else i.角色.身份.先天六司={根骨:5,灵性:5,悟性:5,气运:5,魅力:5,心性:5};i.角色.身份.后天六司&&"object"==typeof i.角色.身份.后天六司||(i.角色.身份.后天六司={根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}),i.角色.属性&&"object"==typeof i.角色.属性?(i.角色.属性.境界=l(i.角色.属性.境界),i.角色.属性.气血=c(i.角色.属性.气血,100,100),i.角色.属性.灵气=c(i.角色.属性.灵气,50,50),i.角色.属性.神识=c(i.角色.属性.神识,30,30),i.角色.属性.寿命=c(i.角色.属性.寿命,18,80),i.角色.属性.声望=m(i.角色.属性.声望,0,999999,0)):(console.warn("[数据修复] 属性缺失，创建默认值"),i.角色.属性={境界:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"引气入体，感悟天地灵气，踏上修仙第一步"},声望:0,气血:{当前:100,上限:100},灵气:{当前:50,上限:50},神识:{当前:30,上限:30},寿命:{当前:18,上限:80}}),i.角色.位置&&"object"==typeof i.角色.位置?i.角色.位置.描述||(i.角色.位置.描述="九寰仙岛·无名之地"):i.角色.位置={描述:"九寰仙岛·无名之地",x:5e3,y:5e3},Array.isArray(i.角色.效果)||(i.角色.效果=[]);const g={装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null};i.角色.装备&&"object"==typeof i.角色.装备||(i.角色.装备={...g});for(let e=1;e<=6;e++){const t=`装备${e}`,n=i.角色.装备[t];i.角色.装备[t]=null==n?null:"string"==typeof n?n:"object"==typeof n&&null!==n&&"物品ID"in n?String(n.物品ID||""):null}if(i.角色.背包&&"object"==typeof i.角色.背包)if(i.角色.背包.灵石&&"object"==typeof i.角色.背包.灵石?(i.角色.背包.灵石.下品=m(i.角色.背包.灵石.下品,0,999999999,0),i.角色.背包.灵石.中品=m(i.角色.背包.灵石.中品,0,999999999,0),i.角色.背包.灵石.上品=m(i.角色.背包.灵石.上品,0,999999999,0),i.角色.背包.灵石.极品=m(i.角色.背包.灵石.极品,0,999999999,0)):i.角色.背包.灵石={下品:0,中品:0,上品:0,极品:0},i.角色.背包.物品&&"object"==typeof i.角色.背包.物品){const e={};for(const[t,n]of Object.entries(i.角色.背包.物品)){const a=n;a&&"object"==typeof a&&"string"==typeof a.名称&&a.名称.trim()&&(e[t]=d(a))}i.角色.背包.物品=e}else i.角色.背包.物品={};else i.角色.背包={灵石:{下品:0,中品:0,上品:0,极品:0},物品:{}};if(i.社交&&"object"==typeof i.社交||(i.社交=p().社交),i.社交.关系&&"object"==typeof i.社交.关系){const e=i.社交.关系,t={};for(const[n,a]of Object.entries(e)){if(n.startsWith("_"))continue;if(!a||"object"!=typeof a)continue;const e=a,r="string"==typeof e.名字?e.名字.trim():"",o="string"==typeof n?n.trim():"",i=r||o;i&&(e.名字=i,t[i]=u(e))}i.社交.关系=t}else i.社交.关系={};if(i.社交.记忆&&"object"==typeof i.社交.记忆?(i.社交.记忆.短期记忆=Array.isArray(i.社交.记忆.短期记忆)?i.社交.记忆.短期记忆:[],i.社交.记忆.中期记忆=Array.isArray(i.社交.记忆.中期记忆)?i.社交.记忆.中期记忆:[],i.社交.记忆.长期记忆=Array.isArray(i.社交.记忆.长期记忆)?i.社交.记忆.长期记忆:[],i.社交.记忆.隐式中期记忆=Array.isArray(i.社交.记忆.隐式中期记忆)?i.社交.记忆.隐式中期记忆:[]):i.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]},i.系统&&"object"==typeof i.系统||(i.系统=p().系统),i.系统.历史&&"object"==typeof i.系统.历史||(i.系统.历史={叙事:[]}),Array.isArray(i.系统.历史.叙事)||(i.系统.历史.叙事=[]),i.角色.大道&&"object"==typeof i.角色.大道||(i.角色.大道={大道列表:{}}),i.角色.功法&&"object"==typeof i.角色.功法||(i.角色.功法={当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}}),i.角色.修炼&&"object"==typeof i.角色.修炼||(i.角色.修炼={修炼功法:null,修炼状态:{模式:"未修炼"}}),i.角色.技能&&"object"==typeof i.角色.技能||(i.角色.技能={掌握技能:[],装备栏:[],冷却:{}}),i.社交.事件&&"object"==typeof i.社交.事件?(i.社交.事件.配置&&"object"==typeof i.社交.事件.配置||(i.社交.事件.配置={启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""}),Array.isArray(i.社交.事件.事件记录)||(i.社交.事件.事件记录=[]),i.社交.事件.下次事件时间&&"object"!=typeof i.社交.事件.下次事件时间&&(i.社交.事件.下次事件时间=null)):i.社交.事件={配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},i.角色.修炼?.修炼功法&&"object"==typeof i.角色.修炼.修炼功法){const e=i.角色.修炼.修炼功法;if(e.物品ID){const t=i.角色?.背包?.物品?.[e.物品ID];t&&"功法"===t.类型?e.名称&&e.名称===t.名称||(e.名称=t.名称):i.角色.修炼.修炼功法=null}else i.角色.修炼.修炼功法=null}return console.log("[数据修复] ✅ 存档数据修复完成"),i}catch(e){return console.error("[数据修复] ❌ 修复过程发生严重错误，返回默认存档:",e),p()}var t}function s(e,t){const n=e||"凡人",a=t||"";if("凡人"===n)return"引气入体，感悟天地灵气，踏上修仙第一步";const r={练气:{初期:"凝聚丹田灵气，打通任督二脉，冲击练气中期",中期:"拓宽经脉，提升灵气容量，冲击练气后期",后期:"凝实根基，感悟天地法则，冲击练气圆满",圆满:"灵气贯通周天，凝练灵根本源，准备筑基","":"搬运周天，凝聚灵气，夯实练气根基"},筑基:{初期:"凝聚道台，将灵气压缩凝实，冲击筑基中期",中期:"稳固道基，扩充丹田容量，冲击筑基后期",后期:"感悟天地法则，凝练金丹雏形，冲击筑基圆满",圆满:"道基圆满，破而后立，将灵气凝聚成金丹","":"夯实道基，压缩灵气，提升筑基境界"},金丹:{初期:"凝实金丹，刻画符文，冲击金丹中期",中期:"淬炼金丹，领悟道韵，冲击金丹后期",后期:"金丹大成，蕴养元神，冲击金丹圆满",圆满:"破丹成婴，元神出窍，踏入元婴境界","":"淬炼金丹本源，刻画天地符文，提升金丹品质"},元婴:{初期:"稳固元婴，凝练神魂，冲击元婴中期",中期:"元婴壮大，感悟大道，冲击元婴后期",后期:"元婴大成，凝练元神，冲击元婴圆满",圆满:"元神蜕变，肉身成圣，准备化神","":"壮大元婴，淬炼神魂，提升元婴境界"},化神:{初期:"神魂合一，领悟法则，冲击化神中期",中期:"凝聚神格，参悟天道，冲击化神后期",后期:"神格大成，融合法则，冲击化神圆满",圆满:"炼虚合道，肉身不灭，准备突破炼虚","":"感悟大道法则，凝练神格，提升化神境界"},炼虚:{初期:"炼虚化实，虚空凝形，冲击炼虚中期",中期:"虚实合一，参悟空间法则，冲击炼虚后期",后期:"撕裂虚空，掌控空间，冲击炼虚圆满",圆满:"虚空大成，与天地合一，准备渡劫","":"炼化虚空之力，感悟空间奥义，提升炼虚境界"},合体:{初期:"天人合一，与天地共鸣，冲击合体中期",中期:"领悟天道，掌控天地之力，冲击合体后期",后期:"天地认可，法则加身，冲击合体圆满",圆满:"与道合真，天劫将至，准备渡劫飞升","":"感悟天地大道，与天地共鸣，提升合体境界"},大乘:{初期:"大道圆满，法则入体，冲击大乘中期",中期:"天道认可，参悟仙道，冲击大乘后期",后期:"仙韵初现，准备渡劫，冲击大乘圆满",圆满:"渡九九天劫，飞升仙界，超脱凡尘","":"感悟仙道奥义，凝练仙体，准备飞升"}}[n];return r?r[a]||r[""]||`感悟${n}境界奥义，提升修为境界`:{初期:`凝练${n}初期根基，冲击${n}中期`,中期:`稳固${n}中期修为，冲击${n}后期`,后期:`圆满${n}后期境界，冲击${n}圆满`,圆满:`${n}圆满大成，准备突破下一境界`,"":`感悟${n}境界奥义，提升修为`}[a]||`感悟${n}境界，提升修为`}function l(e){if(!e||"object"!=typeof e)return{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"引气入体，感悟天地灵气，踏上修仙第一步"};const t=e.名称||"凡人",n=void 0!==e.阶段?e.阶段:"";return{名称:t,阶段:n,当前进度:m(e.当前进度,0,999999999,0),下一级所需:m(e.下一级所需,1,999999999,100),突破描述:e.突破描述||s(t,n)}}function c(e,t,n){if(!e||"object"!=typeof e)return{当前:t,上限:n};const a=m(e.当前,0,999999999,t),r=m(e.上限,1,999999999,n);return{当前:Math.min(a,r),上限:r}}function d(e){const t={...e};return t.物品ID=t.物品ID||`item_${Date.now()}`,t.名称=t.名称||"未命名物品",t.数量=m(t.数量,1,999999,1),t.品质&&"object"==typeof t.品质?(["凡","黄","玄","地","天","仙","神"].includes(t.品质.quality)||(t.品质.quality="凡"),t.品质.grade=m(t.品质.grade,0,10,1)):t.品质={quality:"凡",grade:1},["装备","功法","丹药","材料","其他"].includes(t.类型)||(t.类型="其他"),t}function u(e){const t={...e};return t.名字=t.名字||"无名",t.性别=t.性别||"男",t.境界=l(t.境界),t.先天六司&&"object"==typeof t.先天六司||(t.先天六司={根骨:5,灵性:5,悟性:5,气运:5,魅力:5,心性:5}),t.当前位置&&"object"==typeof t.当前位置?t.当前位置.描述||(t.当前位置.描述="九寰仙岛·无名之地"):t.当前位置={描述:"九寰仙岛·无名之地"},t.好感度=m(t.好感度,-100,100,0),Array.isArray(t.记忆)||(t.记忆=[]),t.背包&&"object"==typeof t.背包||(t.背包={灵石:{下品:0,中品:0,上品:0,极品:0},物品:{}}),t}function m(e,t,n,a){if("number"==typeof e&&!isNaN(e))return Math.max(t,Math.min(n,e));if("string"==typeof e){const a=parseFloat(e);if(!isNaN(a))return Math.max(t,Math.min(n,a))}return a}function p(){const e=(new Date).toISOString();return{元数据:{版本号:3,存档ID:`save_${Date.now()}`,存档名:"自动存档",游戏版本:"0.0.0",创建时间:e,更新时间:e,游戏时长秒:0,时间:{年:1e3,月:1,日:1,小时:8,分钟:0}},角色:{身份:{名字:"无名修士",性别:"男",出生日期:{年:982,月:1,日:1},种族:"人族",世界:"九寰仙岛",天资:"凡人",出生:"散修",灵根:"五行杂灵根",天赋:[],先天六司:{根骨:5,灵性:5,悟性:5,气运:5,魅力:5,心性:5},后天六司:{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}},属性:{境界:{名称:"凡人",阶段:"",当前进度:0,下一级所需:100,突破描述:"引气入体，感悟天地灵气，踏上修仙第一步"},声望:0,气血:{当前:100,上限:100},灵气:{当前:50,上限:50},神识:{当前:30,上限:30},寿命:{当前:18,上限:80}},位置:{描述:"九寰仙岛·无名之地",x:5e3,y:5e3},效果:[],身体:{总体状况:"",部位:{}},背包:{灵石:{下品:0,中品:0,上品:0,极品:0},物品:{}},装备:{装备1:null,装备2:null,装备3:null,装备4:null,装备5:null,装备6:null},功法:{当前功法ID:null,功法进度:{},功法套装:{主修:null,辅修:[]}},修炼:{修炼功法:null,修炼状态:{模式:"未修炼"}},大道:{大道列表:{}},技能:{掌握技能:[],装备栏:[],冷却:{}}},社交:{关系:{},宗门:null,事件:{配置:{启用随机事件:!0,最小间隔年:1,最大间隔年:10,事件提示词:""},下次事件时间:null,事件记录:[]},记忆:{短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}},世界:{信息:{世界名称:"九寰仙岛",大陆信息:[],势力信息:[],地点信息:[],生成时间:e,世界背景:"",世界纪元:"",特殊设定:[],版本:"v1"},状态:{环境:{},事件:[],历史:[],NPC状态:{}}},系统:{配置:{},设置:{},缓存:{掌握技能:[],临时统计:{}},行动队列:{actions:[]},历史:{叙事:[]},扩展:{},联机:{模式:"单机",房间ID:null,玩家ID:null,只读路径:["世界"],世界曝光:!1,冲突策略:"服务器"}}}}},6591:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 4.0 全新视觉系统 - 世界选择 ========== */\n.world-selection-container[data-v-802455fa] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-802455fa], .error-state[data-v-802455fa], .placeholder[data-v-802455fa] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n  letter-spacing: 0.1em;\n}\n.world-layout[data-v-802455fa] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 - 4.0 风格 ========== */\n.left-panel[data-v-802455fa] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(147, 197, 253, 0.12);\n  border-radius: 16px;\n  overflow: hidden;\n  position: relative;\n}\n.left-panel[data-v-802455fa]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  background: linear-gradient(to bottom, rgba(147, 197, 253, 0.05), transparent);\n  pointer-events: none;\n}\n\n/* 顶部功能按钮 */\n.top-actions-container[data-v-802455fa] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-802455fa] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-802455fa]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n.list-container[data-v-802455fa] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.6rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.list-container[data-v-802455fa]::-webkit-scrollbar {\n  width: 6px;\n}\n.list-container[data-v-802455fa]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.list-container[data-v-802455fa]::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.4), rgba(59, 130, 246, 0.3));\n  border-radius: 3px;\n}\n.list-container[data-v-802455fa]::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.6), rgba(59, 130, 246, 0.5));\n}\n\n/* ========== 世界选项卡 - 4.0 风格 ========== */\n.list-item[data-v-802455fa] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.5);\n}\n.list-item[data-v-802455fa]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(147, 197, 253, 0.25);\n}\n.list-item.selected[data-v-802455fa] {\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.5) 0%, rgba(30, 41, 59, 0.6) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.item-content[data-v-802455fa] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.item-name[data-v-802455fa] {\n  flex-grow: 1;\n  font-weight: 500;\n  color: #f1f5f9;\n  letter-spacing: 0.05em;\n  transition: color 0.3s ease;\n}\n.list-item.selected .item-name[data-v-802455fa] {\n  color: #bfdbfe;\n  text-shadow: 0 0 12px rgba(147, 197, 253, 0.4);\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-802455fa] {\n  display: flex;\n  align-items: center;\n  gap: 0.3rem;\n  opacity: 0;\n  transition: opacity 0.25s ease;\n  margin-left: 0.5rem;\n}\n.list-item:hover .action-buttons[data-v-802455fa] {\n  opacity: 1;\n}\n.edit-btn[data-v-802455fa], .delete-btn[data-v-802455fa] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.4rem;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n}\n.edit-btn[data-v-802455fa]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n}\n.delete-btn[data-v-802455fa]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n}\n\n/* ========== 右侧详情面板 - 4.0 风格 ========== */\n.details-container[data-v-802455fa] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(147, 197, 253, 0.12);\n  border-radius: 16px;\n  padding: 1.75rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  min-height: 0;\n  position: relative;\n}\n.details-container[data-v-802455fa]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 80px;\n  background: radial-gradient(ellipse at 50% 0%, rgba(147, 197, 253, 0.08) 0%, transparent 70%);\n  pointer-events: none;\n}\n.world-details[data-v-802455fa] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n  position: relative;\n  z-index: 1;\n}\n.details-header[data-v-802455fa] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.75rem;\n  margin-bottom: 0.5rem;\n}\n.details-title[data-v-802455fa] {\n  margin: 0;\n  font-size: 1.6rem;\n  font-weight: 600;\n  color: #93c5fd;\n  letter-spacing: 0.1em;\n}\n.map-settings-btn[data-v-802455fa] {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  padding: 0.55rem 0.9rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 10px;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(51, 65, 85, 0.5) 100%);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  font-size: 0.85rem;\n}\n.map-settings-btn[data-v-802455fa]:hover {\n  background: linear-gradient(135deg, rgba(51, 65, 85, 0.9) 0%, rgba(71, 85, 105, 0.7) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  color: #f1f5f9;\n  transform: translateY(-1px);\n}\n.world-details h2[data-v-802455fa] {\n  margin-top: 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n}\n.world-details .era[data-v-802455fa] {\n  font-style: italic;\n  color: #fbbf24;\n  margin-bottom: 1.25rem;\n  flex-shrink: 0;\n  font-size: 0.95rem;\n  letter-spacing: 0.05em;\n  text-shadow: 0 0 12px rgba(251, 191, 36, 0.3);\n}\n.description-scroll[data-v-802455fa] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.8;\n  padding-right: 0.5rem;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-802455fa]::-webkit-scrollbar {\n  width: 6px;\n}\n.description-scroll[data-v-802455fa]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.description-scroll[data-v-802455fa]::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, rgba(147, 197, 253, 0.4), rgba(59, 130, 246, 0.3));\n  border-radius: 3px;\n}\n.description-scroll p[data-v-802455fa] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n  font-size: 0.95rem;\n}\n\n/* ========== 地图生成选项 - 4.0 风格 ========== */\n.map-options[data-v-802455fa] {\n  margin-top: 1rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 12px;\n  padding: 1.25rem;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.5) 0%, rgba(51, 65, 85, 0.3) 100%);\n  flex: 1 1 auto;\n  overflow: auto;\n}\n\n/* 仅生成大陆开关 */\n.continents-only-section[data-v-802455fa] {\n  margin-bottom: 1.25rem;\n  padding: 1rem;\n  background: rgba(147, 197, 253, 0.08);\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 10px;\n}\n\n/* 游戏难度选择样式 */\n.difficulty-section[data-v-802455fa] {\n  margin-bottom: 1.25rem;\n  padding: 1rem;\n  background: rgba(251, 191, 36, 0.08);\n  border: 1px solid rgba(251, 191, 36, 0.2);\n  border-radius: 10px;\n}\n.difficulty-label[data-v-802455fa] {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #fbbf24;\n  margin-bottom: 0.75rem;\n  letter-spacing: 0.05em;\n}\n.difficulty-options[data-v-802455fa] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.6rem;\n}\n.difficulty-option[data-v-802455fa] {\n  display: flex;\n  flex-direction: column;\n  padding: 0.6rem 0.9rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.5);\n  cursor: pointer;\n  transition: all 0.25s ease;\n}\n.difficulty-option[data-v-802455fa]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(251, 191, 36, 0.35);\n}\n.difficulty-option.selected[data-v-802455fa] {\n  background: rgba(251, 191, 36, 0.18);\n  border-color: rgba(251, 191, 36, 0.5);\n  box-shadow: 0 0 16px rgba(251, 191, 36, 0.15);\n}\n.difficulty-radio[data-v-802455fa] {\n  display: none;\n}\n.difficulty-name[data-v-802455fa] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #f1f5f9;\n}\n.difficulty-option.selected .difficulty-name[data-v-802455fa] {\n  color: #fbbf24;\n  text-shadow: 0 0 8px rgba(251, 191, 36, 0.4);\n}\n.difficulty-desc[data-v-802455fa] {\n  font-size: 0.72rem;\n  color: #94a3b8;\n  margin-top: 0.25rem;\n}\n.continents-only-toggle[data-v-802455fa] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  cursor: pointer;\n  user-select: none;\n}\n.toggle-checkbox[data-v-802455fa] {\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  accent-color: #93c5fd;\n}\n.toggle-label[data-v-802455fa] {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: #93c5fd;\n  letter-spacing: 0.03em;\n}\n.toggle-hint[data-v-802455fa] {\n  margin-top: 0.6rem;\n  font-size: 0.78rem;\n  color: #94a3b8;\n  line-height: 1.5;\n  padding-left: 1.7rem;\n}\n.config-warning[data-v-802455fa] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.85rem;\n  padding: 0.9rem;\n  margin-bottom: 1.25rem;\n  background: rgba(251, 191, 36, 0.12);\n  border: 1px solid rgba(251, 191, 36, 0.3);\n  border-radius: 10px;\n}\n.warning-icon[data-v-802455fa] {\n  font-size: 1.3rem;\n  flex-shrink: 0;\n}\n.warning-text[data-v-802455fa] {\n  flex: 1;\n}\n.warning-title[data-v-802455fa] {\n  font-weight: 600;\n  font-size: 0.95rem;\n  margin-bottom: 0.3rem;\n  color: #fbbf24;\n}\n.warning-desc[data-v-802455fa] {\n  font-size: 0.82rem;\n  color: #94a3b8;\n  line-height: 1.5;\n}\n.option-item input.config-risky[data-v-802455fa] {\n  border-color: rgba(251, 191, 36, 0.5);\n  background-color: rgba(251, 191, 36, 0.08);\n}\n.config-hint[data-v-802455fa] {\n  font-size: 0.72rem;\n  color: #64748b;\n  margin-top: 0.25rem;\n}\n.map-options-header[data-v-802455fa] {\n  font-weight: 600;\n  color: #93c5fd;\n  margin-bottom: 1rem;\n  font-size: 1rem;\n  letter-spacing: 0.05em;\n}\n.map-options-grid[data-v-802455fa] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));\n  gap: 0.9rem;\n}\n.option-item[data-v-802455fa] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.35rem;\n}\n.option-label[data-v-802455fa] {\n  font-size: 0.82rem;\n  color: #94a3b8;\n  letter-spacing: 0.03em;\n}\n.option-item input[data-v-802455fa] {\n  width: 100%;\n  padding: 0.55rem 0.7rem;\n  border: 1px solid rgba(147, 197, 253, 0.15);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.7);\n  color: #f1f5f9;\n  font-size: 0.88rem;\n  transition: all 0.25s ease;\n}\n.option-item input[data-v-802455fa]:focus {\n  outline: none;\n  border-color: rgba(147, 197, 253, 0.5);\n  box-shadow: 0 0 12px rgba(147, 197, 253, 0.15);\n}\n.option-item input[data-v-802455fa]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.map-options-actions[data-v-802455fa] {\n  display: flex;\n  gap: 0.6rem;\n  margin-top: 1rem;\n}\n.opt-btn[data-v-802455fa] {\n  padding: 0.55rem 1.1rem;\n  border: 1px solid rgba(147, 197, 253, 0.2);\n  border-radius: 8px;\n  background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(51, 65, 85, 0.5) 100%);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n.opt-btn[data-v-802455fa]:hover {\n  background: linear-gradient(135deg, rgba(51, 65, 85, 0.9) 0%, rgba(71, 85, 105, 0.7) 100%);\n  border-color: rgba(147, 197, 253, 0.4);\n  color: #f1f5f9;\n  transform: translateY(-1px);\n}\n\n/* ========== 空状态 ========== */\n.no-worlds-message[data-v-802455fa] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n  color: #64748b;\n}\n.no-worlds-icon[data-v-802455fa] {\n  font-size: 3rem;\n  margin-bottom: 1.25rem;\n  opacity: 0.7;\n}\n.no-worlds-text[data-v-802455fa] {\n  font-size: 1.05rem;\n  margin-bottom: 0.6rem;\n  color: #94a3b8;\n  letter-spacing: 0.05em;\n}\n.no-worlds-hint[data-v-802455fa] {\n  font-size: 0.88rem;\n  opacity: 0.7;\n  font-style: italic;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .left-panel[data-v-802455fa],\n[data-theme="light"] .details-container[data-v-802455fa] {\n  background: rgba(248, 250, 252, 0.85);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .left-panel[data-v-802455fa]::before,\n[data-theme="light"] .details-container[data-v-802455fa]::before {\n  background: radial-gradient(ellipse at 50% 0%, rgba(59, 130, 246, 0.08) 0%, transparent 70%);\n}\n[data-theme="light"] .top-actions-container[data-v-802455fa] {\n  background: rgba(241, 245, 249, 0.85);\n  border-color: rgba(59, 130, 246, 0.1);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-802455fa] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-802455fa]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n[data-theme="light"] .list-item[data-v-802455fa] {\n  background: rgba(255, 255, 255, 0.7);\n}\n[data-theme="light"] .list-item[data-v-802455fa]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.25);\n}\n[data-theme="light"] .list-item.selected[data-v-802455fa] {\n  background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(241, 245, 249, 0.95) 100%);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .list-item[data-v-802455fa]::before {\n  background: linear-gradient(180deg, rgba(59, 130, 246, 0.6), rgba(37, 99, 235, 0.4));\n}\n[data-theme="light"] .item-name[data-v-802455fa] {\n  color: #1e293b;\n}\n[data-theme="light"] .list-item.selected .item-name[data-v-802455fa] {\n  color: #1e40af;\n  text-shadow: none;\n}\n[data-theme="light"] .details-title[data-v-802455fa],\n[data-theme="light"] .world-details h2[data-v-802455fa] {\n  color: #2563eb;\n  text-shadow: none;\n}\n[data-theme="light"] .description-scroll p[data-v-802455fa] {\n  color: #475569;\n}\n[data-theme="light"] .map-options[data-v-802455fa] {\n  background: linear-gradient(135deg, rgba(241, 245, 249, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .option-item input[data-v-802455fa] {\n  background: rgba(255, 255, 255, 0.9);\n  border-color: rgba(59, 130, 246, 0.15);\n  color: #1e293b;\n}\n[data-theme="light"] .opt-btn[data-v-802455fa] {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.8) 100%);\n  border-color: rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .opt-btn[data-v-802455fa]:hover {\n  background: linear-gradient(135deg, rgba(241, 245, 249, 1) 0%, rgba(255, 255, 255, 1) 100%);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-802455fa],\n[data-theme="light"] .delete-btn[data-v-802455fa] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-802455fa]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-802455fa]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n.action-name[data-v-802455fa] {\n  font-weight: 500;\n}\n\n/* ========== 响应式适配 ========== */\n@media (max-width: 1024px) {\n.world-layout[data-v-802455fa] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-802455fa] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n    gap: 0.5rem;\n}\n.top-actions-container .action-item[data-v-802455fa] {\n    flex: 1 1 45%;\n    text-align: center;\n    min-width: 120px;\n}\n.continents-only-section[data-v-802455fa] {\n    padding: 0.6rem;\n}\n.toggle-label[data-v-802455fa] {\n    font-size: 0.85rem;\n}\n.toggle-hint[data-v-802455fa] {\n    font-size: 0.72rem;\n    padding-left: 1.5rem;\n}\n.world-layout[data-v-802455fa] {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    height: 100%;\n    overflow: hidden;\n    padding: 0;\n}\n.left-panel[data-v-802455fa] {\n    order: 1;\n    flex-shrink: 0;\n    max-height: 35vh;\n    overflow: hidden;\n}\n.details-container[data-v-802455fa] {\n    order: 2;\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.list-container[data-v-802455fa] {\n    max-height: calc(35vh - 60px);\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n.list-item[data-v-802455fa],\n  .action-item[data-v-802455fa] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n.map-options-grid[data-v-802455fa] { grid-template-columns: 1fr;\n}\n.list-item[data-v-802455fa] {\n    padding: 0.75rem 0.95rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.45rem;\n}\n.action-item[data-v-802455fa] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.details-container[data-v-802455fa] {\n    padding: 1rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-802455fa] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n    gap: 0.45rem;\n}\n.top-actions-container .action-item[data-v-802455fa] {\n    flex: 1 1 100%;\n    text-align: center;\n}\n.world-selection-container[data-v-802455fa] {\n    padding: 0.3rem;\n    height: 100%;\n}\n.world-layout[data-v-802455fa] {\n    gap: 0.5rem;\n}\n.left-panel[data-v-802455fa] {\n    max-height: 32vh;\n}\n.list-container[data-v-802455fa] {\n    max-height: calc(32vh - 100px);\n    padding: 0.4rem;\n}\n.list-item[data-v-802455fa] {\n    padding: 0.65rem 0.85rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.35rem;\n    border-radius: 8px;\n}\n.details-container[data-v-802455fa] {\n    padding: 1rem;\n    border-radius: 12px;\n}\n.details-title[data-v-802455fa] {\n    font-size: 1.3rem;\n    margin-bottom: 0.5rem;\n}\n.world-details .era[data-v-802455fa] {\n    font-size: 0.9rem;\n    margin-bottom: 0.85rem;\n}\n.description-scroll[data-v-802455fa] {\n    font-size: 0.9rem;\n    line-height: 1.6;\n    padding-right: 0.3rem;\n}\n.action-item[data-v-802455fa] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 8px;\n}\n.placeholder[data-v-802455fa] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 100px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n}\n@media (max-width: 360px) {\n.world-selection-container[data-v-802455fa] {\n    padding: 0.25rem;\n}\n.world-layout[data-v-802455fa] {\n    gap: 0.4rem;\n    padding: 0;\n}\n.left-panel[data-v-802455fa] {\n    max-height: 28vh;\n}\n.list-container[data-v-802455fa] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.list-item[data-v-802455fa] {\n    padding: 0.55rem 0.7rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.25rem;\n}\n.details-container[data-v-802455fa] {\n    padding: 0.85rem;\n    min-height: 120px;\n}\n.details-title[data-v-802455fa] {\n    font-size: 1.15rem;\n    margin-bottom: 0.4rem;\n}\n.world-details .era[data-v-802455fa] {\n    font-size: 0.82rem;\n    margin-bottom: 0.65rem;\n}\n.description-scroll[data-v-802455fa] {\n    font-size: 0.85rem;\n    line-height: 1.5;\n}\n.action-item[data-v-802455fa] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-802455fa] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n}\n}\n',""]);const s=i},6623:(e,t,n)=>{"use strict";e.exports=n.p+"6a14696d36301747cf51.ttf"},6627:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'/* Theme overrides to improve light/dark readability (focused on dashboard sidebar) */\n\n/* Scrollbars follow theme */\n.right-sidebar .sidebar-content {\n  scrollbar-color: var(--scrollbar-thumb-color) transparent;\n}\n.right-sidebar .sidebar-content::-webkit-scrollbar-thumb {\n  background: var(--scrollbar-thumb-color);\n}\n\n/* Containers use themed surfaces/borders */\n.right-sidebar .ai-chat-section,\n.right-sidebar .info-section,\n.right-sidebar .cultivation-section,\n.right-sidebar .vitals-section,\n.right-sidebar .attributes-section,\n.right-sidebar .location-section,\n.right-sidebar .wealth-section,\n.right-sidebar .collapsible-section {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n\n/* Subtle hover */\n.right-sidebar .section-header:hover {\n  background: var(--color-surface-light) !important;\n}\n\n/* Text colors */\n.right-sidebar .sidebar-title,\n.right-sidebar .detail-value,\n.right-sidebar .vital-text,\n.right-sidebar .effect-name,\n.right-sidebar .realm-name {\n  color: var(--color-text) !important;\n}\n.right-sidebar .detail-label,\n.right-sidebar .state-label,\n.right-sidebar .state-text,\n.right-sidebar .progress-text,\n.right-sidebar .effect-time,\n.right-sidebar .empty-text,\n.right-sidebar .no-char-text,\n.right-sidebar .realm-level,\n.right-sidebar .vital-name {\n  color: var(--color-text-secondary) !important;\n}\n.right-sidebar .section-title { color: var(--color-text) !important; }\n.right-sidebar .section-icon { color: var(--color-primary) !important; }\n\n/* Collapsible toggle icon */\n.right-sidebar .collapse-toggle { color: var(--color-text-secondary) !important; }\n.right-sidebar .collapse-toggle:hover {\n  color: var(--color-text) !important;\n  background: var(--color-surface-light) !important;\n}\n\n/* Vital item cards */\n.right-sidebar .vital-item {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n.right-sidebar .vital-item:hover {\n  background: var(--color-surface-light) !important;\n  border-color: var(--color-border) !important;\n}\n\n/* Progress bars */\n.right-sidebar .progress-bar { background: var(--color-surface-light) !important; }\n.right-sidebar .progress-fill.health { background: var(--vital-health) !important; }\n.right-sidebar .progress-fill.mana { background: var(--vital-lingqi) !important; }\n.right-sidebar .progress-fill.spirit { background: var(--vital-spirit) !important; }\n.right-sidebar .progress-fill.lifespan { background: var(--vital-lifespan) !important; }\n.right-sidebar .progress-fill.cultivation { background: var(--color-accent) !important; }\n\n/* Status effect cards: neutral base, colored left bar */\n.right-sidebar .status-effect-card {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n.right-sidebar .status-effect-card::before { background: var(--color-border) !important; }\n.right-sidebar .status-effect-card.buff::before { background: linear-gradient(to bottom, var(--color-success), var(--color-success)) !important; }\n.right-sidebar .status-effect-card.debuff::before { background: linear-gradient(to bottom, var(--color-error), var(--color-error)) !important; }\n\n/* Talent card simplified */\n.right-sidebar .talent-card {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-accent) !important;\n  border-left: 4px solid var(--color-accent) !important;\n}\n.right-sidebar .talent-name { color: var(--color-accent) !important; }\n.right-sidebar .talent-level {\n  color: var(--color-warning) !important;\n  background: var(--color-surface-light) !important;\n  border: 1px solid var(--color-warning) !important;\n}\n\n/* Icons by type */\n.right-sidebar .vital-icon.blood { color: var(--vital-health) !important; }\n.right-sidebar .vital-icon.mana { color: var(--vital-lingqi) !important; }\n.right-sidebar .vital-icon.spirit { color: var(--vital-spirit) !important; }\n.right-sidebar .vital-icon.lifespan { color: var(--vital-lifespan) !important; }\n\n/* Character summary sections keep a subtle primary/accents using existing rgb if available */\n.right-sidebar .character-info-section {\n  background: rgba(var(--color-primary-rgb), 0.06) !important;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.15) !important;\n}\n.right-sidebar .character-state-section {\n  background: var(--color-surface) !important;\n  border: 1px solid var(--color-border) !important;\n}\n\n/* Inventory item count badge: keep readable in both themes */\n.item-quantity-display { color: #f7f7f5 !important; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }\n\n/* ===== 修复右侧面板颜色淡化问题 ===== */\n\n/* 移除可能导致白色遮罩的效果 */\n.right-sidebar,\n.right-panel-area {\n  filter: none !important;\n  backdrop-filter: none !important;\n  -webkit-backdrop-filter: none !important;\n  mix-blend-mode: normal !important;\n  opacity: 1 !important;\n}\n\n/* 确保右侧面板的背景完全不透明 */\n.right-sidebar {\n  background: var(--color-surface) !important;\n}\n\n/* 移除任何可能的伪元素遮罩 */\n.right-sidebar::before,\n.right-sidebar::after,\n.right-panel-area::before,\n.right-panel-area::after {\n  display: none !important;\n}\n\n/* ===== 按钮文字溢出和居中修复 ===== */\n\n/* 通用按钮最小宽度和居中样式 */\nbutton {\n  min-width: fit-content;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* RetryConfirmDialog 按钮修复 */\n.retry-dialog .btn-primary,\n.retry-dialog .btn-secondary {\n  min-width: 100px !important; /* 确保最小宽度 */\n  padding: 12px 24px !important; /* 增加左右内边距防止文字溢出 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* DataClearButtons 按钮修复 */\n.clear-button {\n  min-width: 120px !important; /* 防止"清除自定义数据"等长文字溢出 */\n  padding: 0.4rem 1rem !important; /* 增加左右内边距 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n  gap: 0.25rem;\n}\n\n.clear-button .clear-text {\n  flex: 1;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* SavePanel 操作按钮修复 */\n.operation-btn {\n  min-width: 140px !important; /* 为"导出存档"、"导入存档"等按钮设置最小宽度 */\n  padding: 1rem 1.2rem !important;\n  text-align: center;\n}\n\n.operation-btn .btn-content {\n  width: 100%;\n  text-align: center;\n}\n\n.operation-btn .btn-title {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* MainGamePanel 中的快捷操作按钮修复 */\n.quick-action-btn {\n  min-width: 80px !important; /* 确保按钮最小宽度 */\n  min-height: 70px;\n  padding: 12px 10px !important; /* 增加左右内边距 */\n  text-align: center;\n  display: flex !important;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n}\n\n.quick-action-btn .action-text {\n  width: 100%;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 0.8rem;\n  line-height: 1.2;\n}\n\n/* 配置弹窗按钮修复 */\n.cancel-btn,\n.confirm-btn {\n  min-width: 80px !important; /* 确保"取消"、"确认"按钮最小宽度 */\n  padding: 8px 24px !important; /* 增加左右内边距 */\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* LocalPromptModal 按钮修复 */\n.cancel-button {\n  min-width: 80px !important;\n  padding: 8px 24px !important;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 通用按钮文字居中修复 */\n.btn-text,\n.action-text,\n.btn-title {\n  text-align: center !important;\n  width: 100%;\n  display: block;\n}\n\n/* 修复LeftSidebar中的按钮 */\n.left-sidebar .nav-btn {\n  min-width: 100%;\n  text-align: left; /* LeftSidebar按钮应该左对齐 */\n}\n\n.left-sidebar .nav-btn .btn-text,\n.left-sidebar .nav-btn .btn-desc {\n  text-align: left;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* TopBar中的全屏按钮 */\n.fullscreen-btn {\n  min-width: 32px !important;\n  min-height: 32px !important;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 发送按钮修复 */\n.send-button {\n  min-width: 60px !important;\n  padding: 12px 24px !important;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 行动选择器按钮修复 */\n.action-selector-btn {\n  min-width: 44px !important;\n  min-height: 44px !important;\n  display: flex !important;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 响应式调整 */\n@media (max-width: 640px) {\n  .clear-button {\n    min-width: 100px !important;\n    padding: 0.3rem 0.8rem !important;\n  }\n  \n  .operation-btn {\n    min-width: 120px !important;\n    padding: 0.8rem 1rem !important;\n  }\n  \n  .quick-action-btn {\n    min-width: 70px !important;\n    min-height: 60px;\n    padding: 8px 6px !important;\n  }\n  \n  .cancel-btn,\n  .confirm-btn {\n    min-width: 70px !important;\n    padding: 6px 18px !important;\n  }\n  \n  .send-button {\n    min-width: 50px !important;\n    padding: 10px 20px !important;\n  }\n}\n\n@media (max-width: 480px) {\n  .clear-button {\n    min-width: 90px !important;\n    padding: 0.25rem 0.6rem !important;\n  }\n  \n  .operation-btn {\n    min-width: 100px !important;\n    padding: 0.6rem 0.8rem !important;\n  }\n  \n  .quick-action-btn {\n    min-width: 60px !important;\n    min-height: 50px;\n    padding: 6px 4px !important;\n  }\n  \n  .cancel-btn,\n  .confirm-btn {\n    min-width: 60px !important;\n    padding: 6px 15px !important;\n  }\n  \n  .send-button {\n    min-width: 45px !important;\n    padding: 8px 16px !important;\n  }\n}\n',""]);const s=i},6680:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6689:(e,t,n)=>{"use strict";n.d(t,{A:()=>g});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(660),n.b),d=new URL(n(1530),n.b),u=i()(r()),m=l()(c),p=l()(d);u.push([e.id,`\n.save-panel[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n  overflow: hidden;\n  padding: 1rem;\n  gap: 1rem;\n  position: relative;\n}\n\n/* 工具栏移除：统一到顶栏动作 */\n\n/* 头部 */\n.panel-header[data-v-7497a97e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  flex-shrink: 0;\n}\n.header-left[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.header-icon[data-v-7497a97e] {\n  font-size: 1.5rem;\n}\n.header-info[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.panel-title[data-v-7497a97e] {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #0369a1;\n}\n.save-subtitle[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #0284c7;\n}\n.header-actions[data-v-7497a97e] {\n  display: flex;\n  gap: 0.5rem;\n}\n.action-btn[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid #bae6fd;\n  border-radius: 0.5rem;\n  background: white;\n  color: #0369a1;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.875rem;\n}\n.action-btn[data-v-7497a97e]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n.action-btn.primary[data-v-7497a97e] {\n  background: #0284c7;\n  border-color: #0284c7;\n  color: white;\n}\n.action-btn.primary[data-v-7497a97e]:hover {\n  background: #0369a1;\n}\n.action-btn[data-v-7497a97e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.animate-spin[data-v-7497a97e] {\n  animation: spin-7497a97e 1s linear infinite;\n}\n@keyframes spin-7497a97e {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 存档容器 */\n.saves-container[data-v-7497a97e] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 0 0.5rem 3rem 0.5rem;\n\n  /* 滚动条样式 */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.saves-container[data-v-7497a97e]::-webkit-scrollbar {\n  width: 8px;\n}\n.saves-container[data-v-7497a97e]::-webkit-scrollbar-track {\n  background: transparent;\n  border-radius: 4px;\n}\n.saves-container[data-v-7497a97e]::-webkit-scrollbar-thumb {\n  background: transparent;\n  border-radius: 4px;\n  transition: background 0.2s ease;\n}\n.saves-container[data-v-7497a97e]::-webkit-scrollbar-thumb:hover {\n  background: transparent;\n}\n\n/* 区块样式 */\n.current-save-section[data-v-7497a97e],\n.saves-section[data-v-7497a97e],\n.operations-section[data-v-7497a97e] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  overflow: hidden;\n}\n.section-header[data-v-7497a97e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: #f0f9ff;\n  border-bottom: 1px solid #bae6fd;\n}\n.header-actions[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.section-title[data-v-7497a97e] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #0369a1;\n}\n.saves-count[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #0c4a6e;\n  background: white;\n  padding: 0.25rem 0.75rem;\n  border-radius: 0.5rem;\n  font-weight: 600;\n  border: 1px solid #bae6fd;\n}\n.saves-count.online-badge[data-v-7497a97e] {\n  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);\n  color: #065f46;\n  border-color: #a7f3d0;\n}\n\n/* 当前存档卡片 */\n.current-save-card[data-v-7497a97e] {\n  padding: 1.25rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.save-preview[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.save-preview.small[data-v-7497a97e] {\n  gap: 0.75rem;\n}\n.preview-avatar[data-v-7497a97e] {\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #0284c7, #0369a1);\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 1.25rem;\n}\n.preview-avatar.small[data-v-7497a97e] {\n  width: 2.5rem;\n  height: 2.5rem;\n  font-size: 1rem;\n}\n.preview-info[data-v-7497a97e] {\n  flex: 1;\n}\n.character-name[data-v-7497a97e] {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #0369a1;\n  margin-bottom: 0.25rem;\n}\n.save-name[data-v-7497a97e] {\n  font-size: 1rem;\n  font-weight: 700;\n  color: #1e40af;\n  margin-bottom: 0.15rem;\n}\n.character-name-small[data-v-7497a97e] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: #64748b;\n  margin-bottom: 0.15rem;\n}\n.character-details[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.detail-separator[data-v-7497a97e] {\n  color: #cbd5e1;\n}\n.save-time[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n\n/* 特殊存档说明提示 */\n.save-hint[data-v-7497a97e] {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  margin-top: 0.25rem;\n  display: inline-block;\n  font-weight: 500;\n}\n.save-hint.auto[data-v-7497a97e] {\n  background: rgba(16, 185, 129, 0.1);\n  color: #059669;\n  border: 1px solid rgba(16, 185, 129, 0.2);\n}\n.save-hint.last[data-v-7497a97e] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #2563eb;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n/* 当前进度的特殊存档说明 */\n.current-save-hint[data-v-7497a97e] {\n  font-size: 0.875rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 6px;\n  margin-top: 0.75rem;\n  display: block;\n  font-weight: 500;\n  line-height: 1.5;\n}\n.current-save-hint.auto[data-v-7497a97e] {\n  background: rgba(16, 185, 129, 0.1);\n  color: #059669;\n  border-left: 3px solid #10b981;\n}\n.current-save-hint.last[data-v-7497a97e] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #2563eb;\n  border-left: 3px solid #3b82f6;\n}\n.save-stats[data-v-7497a97e] {\n  display: flex;\n  gap: 2rem;\n}\n.stat-item[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.stat-label[data-v-7497a97e] {\n  font-size: 0.75rem;\n  color: #64748b;\n  font-weight: 500;\n}\n.stat-value[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #0369a1;\n  font-weight: 600;\n}\n\n/* 存档列表 */\n.loading-state[data-v-7497a97e],\n.empty-state[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 200px;\n  text-align: center;\n}\n.loading-spinner[data-v-7497a97e],\n.empty-icon[data-v-7497a97e] {\n  font-size: 2rem;\n  margin-bottom: 0.5rem;\n}\n.loading-text[data-v-7497a97e],\n.empty-text[data-v-7497a97e] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #0369a1;\n  margin-bottom: 0.5rem;\n}\n.empty-hint[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.saves-list[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 1rem;\n}\n.save-card[data-v-7497a97e] {\n  border: 1px solid #e0f2fe;\n  border-radius: 0.5rem;\n  background: #f8fafc;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.save-card[data-v-7497a97e]:hover {\n  background: #f0f9ff;\n  border-color: #bae6fd;\n  transform: translateY(-1px);\n}\n.save-card.active[data-v-7497a97e] {\n  background: #e0f2fe;\n  border-color: #0284c7;\n}\n.card-header[data-v-7497a97e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  border-bottom: 1px solid #e0f2fe;\n}\n.card-actions[data-v-7497a97e] {\n  display: flex;\n  gap: 0.5rem;\n}\n.card-btn[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem;\n  height: 2rem;\n  border: 1px solid #bae6fd;\n  border-radius: 0.375rem;\n  background: white;\n  color: #0284c7;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.card-btn[data-v-7497a97e]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n.card-btn[data-v-7497a97e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.card-btn.primary[data-v-7497a97e] {\n  color: #10b981;\n  border-color: #d1fae5;\n}\n.card-btn.primary[data-v-7497a97e]:hover {\n  background: #f0fdf4;\n  border-color: #10b981;\n}\n.card-btn.danger[data-v-7497a97e] {\n  color: #ef4444;\n  border-color: #fecaca;\n}\n.card-btn.danger[data-v-7497a97e]:hover {\n  background: #fef2f2;\n  border-color: #ef4444;\n}\n.card-btn.warning[data-v-7497a97e] {\n  color: #f59e0b;\n  border-color: #fef3c7;\n}\n.card-btn.warning[data-v-7497a97e]:hover {\n  background: #fffbeb;\n  border-color: #f59e0b;\n}\n.card-btn.info[data-v-7497a97e] {\n  color: #0284c7;\n  border-color: #bae6fd;\n}\n.card-btn.info[data-v-7497a97e]:hover {\n  background: #f0f9ff;\n  border-color: #0284c7;\n}\n\n/* 新建存档按钮 */\n.new-save-btn[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem;\n  height: 2rem;\n  border: 1px solid #10b981;\n  border-radius: 0.375rem;\n  background: white;\n  color: #10b981;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.new-save-btn[data-v-7497a97e]:hover {\n  background: #f0fdf4;\n  border-color: #059669;\n  color: #059669;\n}\n.new-save-btn[data-v-7497a97e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.card-content[data-v-7497a97e] {\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.save-details[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.detail-row[data-v-7497a97e] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.875rem;\n}\n.detail-label[data-v-7497a97e] {\n  color: #64748b;\n}\n.detail-value[data-v-7497a97e] {\n  color: #0369a1;\n  font-weight: 500;\n}\n\n/* 操作列表 */\n.operations-list[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.operation-btn[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border-radius: 0.5rem;\n}\n.operation-btn[data-v-7497a97e]:hover {\n  background: #f0f9ff;\n}\n.operation-btn.primary[data-v-7497a97e] {\n  background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%);\n  color: white;\n}\n.operation-btn.primary[data-v-7497a97e]:hover {\n  background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(3, 105, 161, 0.3);\n}\n.operation-btn.primary .btn-title[data-v-7497a97e],\n.operation-btn.primary .btn-desc[data-v-7497a97e] {\n  color: white;\n}\n.operation-btn.danger[data-v-7497a97e]:hover {\n  background: #fef2f2;\n  color: #ef4444;\n}\n.operation-btn[data-v-7497a97e]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-content[data-v-7497a97e] {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 0.25rem;\n}\n.btn-title[data-v-7497a97e] {\n  font-weight: 500;\n  color: #0369a1;\n}\n.btn-desc[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.operation-btn.danger .btn-title[data-v-7497a97e] {\n  color: #ef4444;\n}\n\n/* 响应式设计 */\n@media (max-width: 640px) {\n.save-stats[data-v-7497a97e] {\n    gap: 1rem;\n}\n.card-header[data-v-7497a97e] {\n    flex-direction: column;\n    gap: 1rem;\n    align-items: stretch;\n}\n.save-preview[data-v-7497a97e] {\n    justify-content: center;\n}\n.card-actions[data-v-7497a97e] {\n    justify-content: center;\n}\n.header-actions .btn-text[data-v-7497a97e] {\n    display: none;\n}\n}\n\n/* 深色主题 */\n[data-theme='dark'] .save-panel[data-v-7497a97e] {\n  background: var(--color-background);\n}\n[data-theme='dark'] .panel-header[data-v-7497a97e],\n[data-theme='dark'] .current-save-section[data-v-7497a97e],\n[data-theme='dark'] .saves-section[data-v-7497a97e],\n[data-theme='dark'] .operations-section[data-v-7497a97e] {\n  background: #1e293b;\n  border-color: #475569;\n}\n\n/* 存档名图标样式 */\n.auto-save-icon[data-v-7497a97e],\n.last-save-icon[data-v-7497a97e] {\n  display: inline-block;\n  margin-right: 0.25rem;\n  vertical-align: middle;\n}\n.auto-save-icon[data-v-7497a97e] {\n  color: #10b981;\n}\n.last-save-icon[data-v-7497a97e] {\n  color: #3b82f6;\n}\n[data-theme='dark'] .section-header[data-v-7497a97e] {\n  background: #334155;\n  border-bottom-color: #475569;\n}\n[data-theme='dark'] .panel-title[data-v-7497a97e],\n[data-theme='dark'] .section-title[data-v-7497a97e],\n[data-theme='dark'] .character-name[data-v-7497a97e],\n[data-theme='dark'] .save-name[data-v-7497a97e] {\n  color: #0ea5e9;\n}\n[data-theme='dark'] .character-name-small[data-v-7497a97e] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .save-subtitle[data-v-7497a97e],\n[data-theme='dark'] .saves-count[data-v-7497a97e] {\n  color: #38bdf8;\n}\n[data-theme='dark'] .saves-count.online-badge[data-v-7497a97e] {\n  background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);\n  color: #6ee7b7;\n  border-color: rgba(16, 185, 129, 0.4);\n}\n[data-theme='dark'] .action-btn[data-v-7497a97e],\n[data-theme='dark'] .card-btn[data-v-7497a97e] {\n  background: #374151;\n  border-color: #475569;\n  color: #0ea5e9;\n}\n[data-theme='dark'] .action-btn[data-v-7497a97e]:hover,\n[data-theme='dark'] .card-btn[data-v-7497a97e]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .card-btn.primary[data-v-7497a97e] {\n  color: #10b981;\n  border-color: #065f46;\n}\n[data-theme='dark'] .card-btn.primary[data-v-7497a97e]:hover {\n  background: #065f46;\n}\n[data-theme='dark'] .card-btn.warning[data-v-7497a97e] {\n  color: #f59e0b;\n  border-color: #78350f;\n}\n[data-theme='dark'] .card-btn.warning[data-v-7497a97e]:hover {\n  background: #78350f;\n}\n[data-theme='dark'] .card-btn.info[data-v-7497a97e] {\n  color: #0ea5e9;\n  border-color: #0c4a6e;\n}\n[data-theme='dark'] .card-btn.info[data-v-7497a97e]:hover {\n  background: #0c4a6e;\n}\n[data-theme='dark'] .new-save-btn[data-v-7497a97e] {\n  background: #374151;\n  border-color: #10b981;\n  color: #10b981;\n}\n[data-theme='dark'] .new-save-btn[data-v-7497a97e]:hover {\n  background: #065f46;\n  border-color: #059669;\n}\n[data-theme='dark'] .save-card[data-v-7497a97e] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme='dark'] .save-card[data-v-7497a97e]:hover {\n  background: #4b5563;\n}\n[data-theme='dark'] .save-card.active[data-v-7497a97e] {\n  background: #1e40af;\n  border-color: #0ea5e9;\n}\n[data-theme='dark'] .operation-btn[data-v-7497a97e]:hover {\n  background: #374151;\n}\n[data-theme='dark'] .btn-title[data-v-7497a97e] {\n  color: #e5e7eb;\n}\n\n/* 自动存档设置 */\n.auto-save-settings-section[data-v-7497a97e] {\n  margin-bottom: 1.5rem;\n  background: white;\n  border-radius: 0.75rem;\n  border: 1px solid #bae6fd;\n  overflow: hidden;\n}\n.settings-list[data-v-7497a97e] {\n  padding: 0.5rem;\n}\n.setting-item[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-radius: 0.5rem;\n  transition: background 0.2s ease;\n}\n.setting-item[data-v-7497a97e]:hover {\n  background: #f8fafc;\n}\n.setting-info[data-v-7497a97e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.setting-name[data-v-7497a97e] {\n  font-weight: 500;\n  color: #1e293b;\n}\n.setting-desc[data-v-7497a97e] {\n  font-size: 0.875rem;\n  color: #64748b;\n}\n.setting-control[data-v-7497a97e] {\n  display: flex;\n  align-items: center;\n}\n\n/* 开关样式 */\n.setting-switch[data-v-7497a97e] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n}\n.setting-switch input[data-v-7497a97e] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.switch-slider[data-v-7497a97e] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.switch-slider[data-v-7497a97e]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .switch-slider[data-v-7497a97e] {\n  background-color: #3b82f6;\n}\ninput:checked + .switch-slider[data-v-7497a97e]:before {\n  transform: translateX(20px);\n}\n\n/* 下拉选择框样式 */\n.setting-select[data-v-7497a97e] {\n  padding: 0.5rem 2rem 0.5rem 0.75rem;\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background-color: white;\n  background-image: url(${m});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 12px;\n  color: #374151;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: border-color 0.2s ease;\n  appearance: none;\n  min-width: 120px;\n}\n.setting-select[data-v-7497a97e]:hover {\n  border-color: #94a3b8;\n}\n.setting-select[data-v-7497a97e]:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n[data-theme='dark'] .auto-save-settings-section[data-v-7497a97e] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme='dark'] .setting-item[data-v-7497a97e]:hover {\n  background: #334155;\n}\n[data-theme='dark'] .setting-name[data-v-7497a97e] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .setting-desc[data-v-7497a97e] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .switch-slider[data-v-7497a97e] {\n  background-color: #4b5563;\n}\n[data-theme='dark'] .setting-select[data-v-7497a97e] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n  background-image: url(${p});\n}\n.interval-input[data-v-7497a97e] {\n  width: 60px;\n  padding: 0.5rem;\n  border-radius: 8px;\n  border: 1px solid #d1d5db;\n  text-align: center;\n  margin-right: 0.5rem;\n}\n.unit-label[data-v-7497a97e] {\n  color: #64748b;\n}\n[data-theme='dark'] .interval-input[data-v-7497a97e] {\n  background-color: #374151;\n  border-color: #4b5563;\n  color: #e5e7eb;\n}\n[data-theme='dark'] .unit-label[data-v-7497a97e] {\n  color: #94a3b8;\n}\n`,""]);const g=u},6743:(e,t,n)=>{"use strict";var a=n(9353);e.exports=Function.prototype.bind||a},6840:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},6896:(e,t,n)=>{"use strict";n.d(t,{A:()=>tn});var a=n(4061),r=n(5517),o=n(7677),i=n(5365),s=n(1783),l=n(3528),c=n(4270),d=n(3302),u=n(876);const m={class:"body"},p={class:"left"},g={class:"rule-list"},h=["onClick"],f={class:"rule-row"},v={class:"rule-mode"},b={class:"rule-pattern"},y={class:"rule-repl"},x={class:"right"},k={key:0,class:"editor"},w={class:"editor-row"},E={class:"editor-row"},N={class:"editor-row editor-row-vertical"},S={class:"editor-row editor-row-vertical"},V={key:0,class:"hint"},_={class:"options"},C={class:"opt"},A={class:"opt"},D=["disabled"],T=["disabled"],B={key:0,class:"error"},I={class:"editor-actions"},z=["disabled"],M=["disabled"],P=["disabled"],R={key:1,class:"empty"},$=(0,a.defineComponent)({__name:"TextReplaceRulesModal",props:{open:{type:Boolean},rules:{}},emits:["close","save"],setup(e,{emit:t}){const n=e,r=t,o=(0,a.ref)([]),i=(0,a.ref)(0);(0,a.watch)(()=>n.open,e=>{if(!e)return;const t=Array.isArray(n.rules)?n.rules:[];o.value=JSON.parse(JSON.stringify(t)),0===o.value.length?i.value=0:i.value=Math.min(i.value,o.value.length-1)},{immediate:!0});const s=(0,a.computed)(()=>o.value[i.value]??null),l=()=>{o.value.push({id:`rule_${Date.now()}_${Math.random().toString(16).slice(2)}`,enabled:!0,mode:"regex",pattern:"",replacement:"",global:!0,ignoreCase:!1,multiline:!1,dotAll:!1}),i.value=o.value.length-1},c=()=>{0!==o.value.length&&(o.value.splice(i.value,1),i.value=Math.max(0,Math.min(i.value,o.value.length-1)))},d=()=>{if(i.value<=0)return;const e=i.value,[t]=o.value.splice(e,1);o.value.splice(e-1,0,t),i.value=e-1},u=()=>{if(i.value>=o.value.length-1)return;const e=i.value,[t]=o.value.splice(e,1);o.value.splice(e+1,0,t),i.value=e+1},$=(0,a.computed)(()=>{const e=s.value;if(!e)return null;if(!e.pattern?.trim())return null;if("regex"!==e.mode)return null;const t=(!1===e.global?"":"g")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.dotAll?"s":"");try{return new RegExp(e.pattern,t),null}catch(e){return`正则无效：${e instanceof Error?e.message:String(e)}`}}),O=()=>r("close"),L=()=>{r("save",o.value),r("close")};return(e,t)=>e.open?((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:0,class:"overlay",onClick:(0,a.withModifiers)(O,["self"])},[(0,a.createElementVNode)("div",{class:"modal",onClick:t[8]||(t[8]=(0,a.withModifiers)(()=>{},["stop"]))},[(0,a.createElementVNode)("div",{class:"header"},[t[9]||(t[9]=(0,a.createElementVNode)("div",{class:"title"},[(0,a.createElementVNode)("h3",null,"正则替换规则"),(0,a.createElementVNode)("p",{class:"subtitle"},"用于对 AI 输出进行替换处理（可用正则或纯文本）")],-1)),(0,a.createElementVNode)("button",{class:"icon-btn",onClick:O,"aria-label":"关闭"},"×")]),(0,a.createElementVNode)("div",m,[(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("div",{class:"left-actions"},[(0,a.createElementVNode)("button",{class:"btn",onClick:l},"新增规则")]),(0,a.createElementVNode)("div",g,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(o.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:e.id,class:(0,a.normalizeClass)(["rule-item",{active:t===i.value}]),onClick:e=>i.value=t},[(0,a.createElementVNode)("div",f,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["rule-badge",{off:!e.enabled}])},(0,a.toDisplayString)(e.enabled?"启用":"停用"),3),(0,a.createElementVNode)("span",v,(0,a.toDisplayString)("regex"===e.mode?"正则":"文本"),1)]),(0,a.createElementVNode)("div",b,(0,a.toDisplayString)(e.pattern||"（未填写匹配）"),1),(0,a.createElementVNode)("div",y,(0,a.toDisplayString)(e.replacement||"（替换为空）"),1)],10,h))),128))])]),(0,a.createElementVNode)("div",x,[s.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",k,[(0,a.createElementVNode)("div",w,[t[10]||(t[10]=(0,a.createElementVNode)("label",{class:"label"},"启用",-1)),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>s.value.enabled=e)},null,512),[[a.vModelCheckbox,s.value.enabled]])]),(0,a.createElementVNode)("div",E,[t[12]||(t[12]=(0,a.createElementVNode)("label",{class:"label"},"匹配模式",-1)),(0,a.withDirectives)((0,a.createElementVNode)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.mode=e),class:"select"},t[11]||(t[11]=[(0,a.createElementVNode)("option",{value:"regex"},"正则",-1),(0,a.createElementVNode)("option",{value:"text"},"纯文本",-1)]),512),[[a.vModelSelect,s.value.mode]])]),(0,a.createElementVNode)("div",N,[t[13]||(t[13]=(0,a.createElementVNode)("label",{class:"label"},"匹配内容",-1)),(0,a.withDirectives)((0,a.createElementVNode)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.pattern=e),class:"textarea",rows:"3",placeholder:"pattern 或 纯文本"},null,512),[[a.vModelText,s.value.pattern]])]),(0,a.createElementVNode)("div",S,[t[15]||(t[15]=(0,a.createElementVNode)("label",{class:"label"},"替换为",-1)),(0,a.withDirectives)((0,a.createElementVNode)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.replacement=e),class:"textarea",rows:"3",placeholder:"可为空（表示删除）"},null,512),[[a.vModelText,s.value.replacement]]),"regex"===s.value.mode?((0,a.openBlock)(),(0,a.createElementBlock)("div",V,t[14]||(t[14]=[(0,a.createTextVNode)(" 支持捕获组：例如用 ",-1),(0,a.createElementVNode)("code",null,"$1",-1),(0,a.createTextVNode)(" 引用分组 ",-1)]))):(0,a.createCommentVNode)("v-if",!0)]),(0,a.createElementVNode)("div",_,[(0,a.createElementVNode)("label",C,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>s.value.global=e)},null,512),[[a.vModelCheckbox,s.value.global]]),t[16]||(t[16]=(0,a.createTextVNode)(" 全局（g） ",-1))]),(0,a.createElementVNode)("label",A,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>s.value.ignoreCase=e)},null,512),[[a.vModelCheckbox,s.value.ignoreCase]]),t[17]||(t[17]=(0,a.createTextVNode)(" 忽略大小写（i） ",-1))]),(0,a.createElementVNode)("label",{class:(0,a.normalizeClass)(["opt",{disabled:"regex"!==s.value.mode}])},[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>s.value.multiline=e),disabled:"regex"!==s.value.mode},null,8,D),[[a.vModelCheckbox,s.value.multiline]]),t[18]||(t[18]=(0,a.createTextVNode)(" 多行（m） ",-1))],2),(0,a.createElementVNode)("label",{class:(0,a.normalizeClass)(["opt",{disabled:"regex"!==s.value.mode}])},[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>s.value.dotAll=e),disabled:"regex"!==s.value.mode},null,8,T),[[a.vModelCheckbox,s.value.dotAll]]),t[19]||(t[19]=(0,a.createTextVNode)(" 点号匹配换行（s） ",-1))],2)]),$.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",B,(0,a.toDisplayString)($.value),1)):(0,a.createCommentVNode)("v-if",!0),(0,a.createElementVNode)("div",I,[(0,a.createElementVNode)("button",{class:"btn btn-secondary",disabled:i.value<=0,onClick:d},"上移",8,z),(0,a.createElementVNode)("button",{class:"btn btn-secondary",disabled:i.value>=o.value.length-1,onClick:u},"下移",8,M),(0,a.createElementVNode)("button",{class:"btn btn-danger",disabled:0===o.value.length,onClick:c},"删除",8,P)])])):((0,a.openBlock)(),(0,a.createElementBlock)("div",R," 暂无规则，点击“新增规则”开始配置 "))])]),(0,a.createElementVNode)("div",{class:"footer"},[(0,a.createElementVNode)("button",{class:"btn btn-secondary",onClick:O},"取消"),(0,a.createElementVNode)("button",{class:"btn",onClick:L},"保存")])])])):(0,a.createCommentVNode)("v-if",!0)}});var O=n(5072),L=n.n(O),F=n(7825),j=n.n(F),U=n(7659),q=n.n(U),G=n(5056),H=n.n(G),Y=n(540),W=n.n(Y),X=n(1113),J=n.n(X),K=n(1153),Z={};Z.styleTagTransform=J(),Z.setAttributes=H(),Z.insert=q().bind(null,"head"),Z.domAPI=j(),Z.insertStyleElement=W(),L()(K.A,Z),K.A&&K.A.locals&&K.A.locals;var Q=n(6262);const ee=(0,Q.A)($,[["__scopeId","data-v-a2196f8c"]]);var te=n(4582),ne=n(1184),ae=n(9173),re=n(7760),oe=n(3992);const ie={class:"settings-panel"},se={class:"panel-header"},le={class:"header-left"},ce={class:"header-info"},de={class:"panel-title"},ue={class:"settings-subtitle"},me={class:"header-actions"},pe={class:"btn-text"},ge={class:"btn-text"},he={class:"settings-container"},fe={class:"settings-section"},ve={class:"section-header"},be={class:"section-title"},ye={class:"settings-list"},xe={class:"setting-item"},ke={class:"setting-info"},we={class:"setting-name"},Ee={class:"setting-desc"},Ne={class:"setting-control"},Se={class:"range-container"},Ve={class:"range-value"},_e={class:"setting-item"},Ce={class:"setting-info"},Ae={class:"setting-name"},De={class:"setting-desc"},Te={class:"setting-control"},Be={class:"range-container"},Ie={class:"range-value"},ze={class:"setting-item"},Me={class:"setting-info"},Pe={class:"setting-name"},Re={class:"setting-desc"},$e={class:"setting-control"},Oe={class:"setting-switch"},Le={class:"settings-section"},Fe={class:"section-header"},je={class:"section-title"},Ue={class:"settings-list"},qe={key:0,class:"setting-item setting-item-full"},Ge={class:"setting-info"},He={class:"setting-name"},Ye={class:"setting-desc"},We={class:"setting-control-full",style:{display:"flex",gap:"0.5rem"}},Xe=["placeholder"],Je=["disabled"],Ke={class:"setting-item"},Ze={class:"setting-info"},Qe={class:"setting-name"},et={class:"setting-desc"},tt={class:"setting-control"},nt={class:"setting-switch"},at={class:"setting-item setting-item-full"},rt={class:"setting-info"},ot={class:"setting-name"},it={class:"setting-desc"},st={class:"setting-control-full"},lt=["placeholder"],ct={class:"settings-section"},dt={class:"section-header"},ut={class:"section-title"},mt={class:"settings-list"},pt={class:"setting-item"},gt={class:"setting-info"},ht={class:"setting-name"},ft={class:"setting-desc"},vt={class:"setting-control"},bt={class:"setting-switch"},yt={key:0,class:"setting-item"},xt={class:"setting-info"},kt={class:"setting-name"},wt={class:"setting-desc"},Et={class:"setting-control"},Nt={class:"setting-switch"},St={key:1,class:"setting-item"},Vt={class:"setting-info"},_t={class:"setting-name"},Ct={class:"setting-desc"},At={class:"setting-control"},Dt={class:"setting-switch"},Tt={class:"setting-item"},Bt={class:"setting-info"},It={class:"setting-name"},zt={class:"setting-desc"},Mt={class:"setting-control"},Pt={key:0},Rt={class:"setting-item"},$t={class:"setting-info"},Ot={class:"setting-name"},Lt={class:"setting-desc"},Ft={class:"setting-control"},jt={class:"setting-item"},Ut={class:"setting-info"},qt={class:"setting-name"},Gt={class:"setting-desc"},Ht={class:"setting-control"},Yt={class:"setting-item"},Wt={class:"setting-info"},Xt={class:"setting-name"},Jt={class:"setting-desc"},Kt={class:"setting-control"},Zt=(0,a.defineComponent)({__name:"SettingsPanel",setup(e){const{t,setLanguage:n,currentLanguage:m}=(0,u.s)(),p=(0,te.useCharacterStore)(),g=(0,ne.useGameStateStore)(),h=(0,ae.useUIStore)(),f=(0,a.ref)(""),v=(0,a.computed)(()=>g.character?.名字||""),b=async()=>{if(f.value&&f.value!==v.value)try{g.character&&(g.character.名字=f.value);const e=p.rootState.当前激活存档?.存档槽位;e&&await p.saveToSlot(e),c.o.success(`用户名已修改为「${f.value}」`),f.value=""}catch(e){console.error("修改用户名失败:",e),c.o.error("修改用户名失败，请重试")}},y=(0,a.reactive)({theme:"auto",uiScale:100,fontSize:16,fastAnimations:!1,splitResponseGeneration:!1,enableNsfwMode:!0,nsfwGenderFilter:"female",debugMode:!1,consoleDebug:!1,performanceMonitor:!1,replaceRules:[]}),x=(0,a.ref)(!1),k=(0,a.ref)(!1),w=(0,a.ref)(!1),E=(0,a.computed)(()=>{const e=y.replaceRules;return Array.isArray(e)?e.filter(e=>e&&e.enabled).length:0}),N=e=>Array.isArray(e)?e.slice(0,50).map((e,t)=>({id:"string"==typeof e?.id?e.id.slice(0,80):`rule_${t}`,enabled:!1!==e?.enabled,mode:"text"===e?.mode?"text":"regex",pattern:"string"==typeof e?.pattern?e.pattern.slice(0,500):"",replacement:"string"==typeof e?.replacement?e.replacement.slice(0,1500):"",ignoreCase:!!e?.ignoreCase,global:!1!==e?.global,multiline:!!e?.multiline,dotAll:!!e?.dotAll})):[],S=e=>{const t=N(e);y.replaceRules=t,(e=>{try{const t=localStorage.getItem("dad_game_settings"),n=t?JSON.parse(t):{},a={...n&&"object"==typeof n&&!Array.isArray(n)?n:{},replaceRules:e};localStorage.setItem("dad_game_settings",JSON.stringify(a))}catch{}})(t),V()};(0,a.watch)(y,()=>{k.value=!0},{deep:!0}),(0,a.watch)(()=>y.debugMode,e=>{d.Yz.setMode(e),d.Yz.log("设置面板","调试模式"+(e?"已启用":"已禁用"))});const V=()=>{k.value=!0},_=async()=>{if(!x.value){x.value=!0,d.Yz.timeStart("保存设置");try{C(),localStorage.setItem("dad_game_settings",JSON.stringify(y)),d.Yz.log("设置面板","设置已保存到localStorage",y),await A(),k.value=!1,c.o.success("设置已保存并应用")}catch(e){d.Yz.error("设置面板","保存设置失败",e),c.o.error(`保存设置失败: ${e instanceof Error?e.message:"未知错误"}`)}finally{x.value=!1,d.Yz.timeEnd("保存设置")}}},C=()=>{d.Yz.group("设置验证");try{(y.uiScale<50||y.uiScale>200)&&(y.uiScale=Math.max(50,Math.min(200,y.uiScale)),d.Yz.warn("设置面板",`UI缩放值已修正为: ${y.uiScale}%`)),"boolean"!=typeof y.splitResponseGeneration&&(y.splitResponseGeneration=!1);const e=y.replaceRules;y.replaceRules=N(e),d.Yz.log("设置面板","设置验证完成")}catch(e){throw d.Yz.error("设置面板","设置验证失败",e),new Error("设置验证失败")}finally{d.Yz.groupEnd()}},A=async()=>{d.Yz.group("应用设置");try{D(),T(),B(),I(),d.Yz.setMode(y.debugMode),d.Yz.log("设置面板","所有设置已应用")}catch(e){throw d.Yz.error("设置面板","应用设置时出错",e),e}finally{d.Yz.groupEnd()}},D=()=>{let e=y.theme;"auto"===y.theme&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme",e),d.Yz.log("设置面板",`主题已应用: ${e}`)},T=()=>{const e=y.uiScale/100;document.documentElement.style.setProperty("--ui-scale",e.toString()),d.Yz.log("设置面板",`UI缩放已应用: ${y.uiScale}%`)},B=()=>{const e=`${y.fontSize}px`;document.documentElement.style.setProperty("--base-font-size",e),d.Yz.log("设置面板",`字体大小已应用: ${e}`)},I=()=>{const e=y.fastAnimations?.12:.2;document.documentElement.style.setProperty("--transition-fast",`all ${e}s ease-in-out`),d.Yz.log("设置面板",`动画速度已应用: ${e}s`)},z=()=>{h.showRetryDialog({title:"重置设置",message:"确定要重置所有设置为默认值吗？这将清除所有自定义配置。",confirmText:"确认重置",cancelText:"取消",onConfirm:()=>{d.Yz.log("设置面板","开始重置设置"),Object.assign(y,{theme:"auto",uiScale:100,fontSize:16,fastAnimations:!1,splitResponseGeneration:!1,debugMode:!1,consoleDebug:!1,performanceMonitor:!1}),_(),c.o.info("设置已重置为默认值")},onCancel:()=>{}})},M=async()=>{h.showRetryDialog({title:"清理缓存",message:"确定要清理缓存吗？这将删除临时数据但不会影响存档。",confirmText:"确认清理",cancelText:"取消",onConfirm:async()=>{d.Yz.log("设置面板","开始清理缓存");try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.startsWith("dad_cache_")||n.startsWith("temp_")||n.startsWith("debug_")||n.includes("_temp"))&&e.push(n)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear(),d.Yz.log("设置面板",`缓存清理完成，共清理 ${e.length} 项数据`),c.o.success(`已清理 ${e.length} 项缓存数据`)}catch(e){d.Yz.error("设置面板","清理缓存失败",e),c.o.error("清理缓存失败")}},onCancel:()=>{}})},P=()=>{d.Yz.log("设置面板","开始导出设置");try{const e={settings:y,exportInfo:{timestamp:(new Date).toISOString(),version:"3.7.4",userAgent:navigator.userAgent,gameVersion:"超凡新生 v3.7.4"}},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n);const r=(new Date).toISOString().split("T")[0];a.download=`超凡新生-设置备份-${r}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),d.Yz.log("设置面板","设置导出成功"),c.o.success("设置已导出")}catch(e){d.Yz.error("设置面板","导出设置失败",e),c.o.error("导出设置失败")}},R=()=>{d.Yz.log("设置面板","开始导入设置");const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),n=JSON.parse(e),a=(0,re.ZT)(n);let r=null;if("settings"===a.type?r=a.payload:n.settings?r=n.settings:null===a.type&&"object"==typeof a.payload&&(r=a.payload),!r||"object"!=typeof r)throw new Error("无效的设置文件格式");const o={...y,...r};Object.assign(y,o),await _(),d.Yz.log("设置面板","设置导入成功",r),c.o.success("设置导入成功并已应用")}catch(e){d.Yz.error("设置面板","导入设置失败",e),c.o.error(`导入设置失败: ${e instanceof Error?e.message:"请检查文件格式"}`)}},e.click()};return(0,oe.useRouter)(),(0,a.onMounted)(()=>{d.Yz.log("设置面板","组件已加载"),(async()=>{d.Yz.timeStart("加载设置");try{const e=localStorage.getItem("dad_game_settings");if(e){const t=JSON.parse(e);Object.assign(y,t),d.Yz.log("设置面板","设置加载成功",t)}else d.Yz.log("设置面板","使用默认设置")}catch(e){d.Yz.error("设置面板","加载设置失败",e),c.o.error("加载设置失败，将使用默认设置")}finally{d.Yz.timeEnd("加载设置")}})(),d.Yz.log("设置面板","向量记忆配置加载（功能待实现）")}),(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",ie,[(0,a.createCommentVNode)(" 头部 "),(0,a.createElementVNode)("div",se,[(0,a.createElementVNode)("div",le,[n[12]||(n[12]=(0,a.createElementVNode)("div",{class:"header-icon"},"⚙️",-1)),(0,a.createElementVNode)("div",ce,[(0,a.createElementVNode)("h3",de,(0,a.toDisplayString)((0,a.unref)(t)("游戏设置")),1),(0,a.createElementVNode)("span",ue,(0,a.toDisplayString)((0,a.unref)(t)("自定义您的游戏体验")),1)])]),(0,a.createElementVNode)("div",me,[(0,a.createElementVNode)("button",{class:"action-btn",onClick:z},[(0,a.createVNode)((0,a.unref)(r.A),{size:16}),(0,a.createElementVNode)("span",pe,(0,a.toDisplayString)((0,a.unref)(t)("重置")),1)]),(0,a.createElementVNode)("button",{class:"action-btn primary",onClick:_},[(0,a.createVNode)((0,a.unref)(o.A),{size:16}),(0,a.createElementVNode)("span",ge,(0,a.toDisplayString)((0,a.unref)(t)("保存")),1)])])]),(0,a.createCommentVNode)(" 设置内容 "),(0,a.createElementVNode)("div",he,[(0,a.createCommentVNode)(" 显示设置 "),(0,a.createElementVNode)("div",fe,[(0,a.createElementVNode)("div",ve,[(0,a.createElementVNode)("h4",be,"🎨 "+(0,a.toDisplayString)((0,a.unref)(t)("显示设置")),1)]),(0,a.createElementVNode)("div",ye,[(0,a.createElementVNode)("div",xe,[(0,a.createElementVNode)("div",ke,[(0,a.createElementVNode)("label",we,(0,a.toDisplayString)((0,a.unref)(t)("界面缩放")),1),(0,a.createElementVNode)("span",Ee,(0,a.toDisplayString)((0,a.unref)(t)("调整UI界面大小")),1)]),(0,a.createElementVNode)("div",Ne,[(0,a.createElementVNode)("div",Se,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"range","onUpdate:modelValue":n[0]||(n[0]=e=>y.uiScale=e),min:"80",max:"120",step:"5",class:"setting-range",onInput:T},null,544),[[a.vModelText,y.uiScale,void 0,{number:!0}]]),(0,a.createElementVNode)("span",Ve,(0,a.toDisplayString)(y.uiScale)+"%",1)])])]),(0,a.createElementVNode)("div",_e,[(0,a.createElementVNode)("div",Ce,[(0,a.createElementVNode)("label",Ae,(0,a.toDisplayString)((0,a.unref)(t)("文字大小")),1),(0,a.createElementVNode)("span",De,(0,a.toDisplayString)((0,a.unref)(t)("调整游戏文字显示大小（像素）")),1)]),(0,a.createElementVNode)("div",Te,[(0,a.createElementVNode)("div",Be,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"range","onUpdate:modelValue":n[1]||(n[1]=e=>y.fontSize=e),min:"12",max:"24",step:"1",class:"setting-range",onInput:B},null,544),[[a.vModelText,y.fontSize,void 0,{number:!0}]]),(0,a.createElementVNode)("span",Ie,(0,a.toDisplayString)(y.fontSize)+"px",1)])])]),(0,a.createElementVNode)("div",ze,[(0,a.createElementVNode)("div",Me,[(0,a.createElementVNode)("label",Pe,(0,a.toDisplayString)((0,a.unref)(t)("快速动画")),1),(0,a.createElementVNode)("span",Re,(0,a.toDisplayString)((0,a.unref)(t)("加速界面动画和过渡效果")),1)]),(0,a.createElementVNode)("div",$e,[(0,a.createElementVNode)("label",Oe,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=e=>y.fastAnimations=e),onChange:n[3]||(n[3]=e=>{I(),V()})},null,544),[[a.vModelCheckbox,y.fastAnimations]]),n[13]||(n[13]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])])])]),(0,a.createCommentVNode)(" 游戏功能 "),(0,a.createElementVNode)("div",Le,[(0,a.createElementVNode)("div",Fe,[(0,a.createElementVNode)("h4",je,"🎮 "+(0,a.toDisplayString)((0,a.unref)(t)("游戏功能")),1)]),(0,a.createElementVNode)("div",Ue,[(0,a.createCommentVNode)(" 用户名修改 "),v.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",qe,[(0,a.createElementVNode)("div",Ge,[(0,a.createElementVNode)("label",He,(0,a.toDisplayString)((0,a.unref)(t)("修改用户名")),1),(0,a.createElementVNode)("span",Ye,(0,a.toDisplayString)((0,a.unref)(t)("修改当前角色的名字")),1)]),(0,a.createElementVNode)("div",We,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>f.value=e),class:"form-input-inline",placeholder:v.value,style:{flex:"1"}},null,8,Xe),[[a.vModelText,f.value]]),(0,a.createElementVNode)("button",{class:"utility-btn primary",onClick:b,disabled:!f.value||f.value===v.value},[(0,a.createVNode)((0,a.unref)(o.A),{size:16}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)((0,a.unref)(t)("确认")),1)],8,Je)])])):(0,a.createCommentVNode)("v-if",!0),(0,a.createElementVNode)("div",Ke,[(0,a.createElementVNode)("div",Ze,[(0,a.createElementVNode)("label",Qe,(0,a.toDisplayString)((0,a.unref)(t)("行动选项")),1),(0,a.createElementVNode)("span",et,(0,a.toDisplayString)((0,a.unref)(t)("AI生成可选的行动建议")),1)]),(0,a.createElementVNode)("div",tt,[(0,a.createElementVNode)("label",nt,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=e=>(0,a.unref)(h).enableActionOptions=e)},null,512),[[a.vModelCheckbox,(0,a.unref)(h).enableActionOptions]]),n[14]||(n[14]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])]),(0,a.createElementVNode)("div",at,[(0,a.createElementVNode)("div",rt,[(0,a.createElementVNode)("label",ot,(0,a.toDisplayString)((0,a.unref)(t)("自定义行动选项提示词")),1),(0,a.createElementVNode)("span",it,(0,a.toDisplayString)((0,a.unref)(t)("指导AI生成特定风格的行动选项（可选，留空使用默认）")),1)]),(0,a.createElementVNode)("div",st,[(0,a.withDirectives)((0,a.createElementVNode)("textarea",{"onUpdate:modelValue":n[6]||(n[6]=e=>(0,a.unref)(h).actionOptionsPrompt=e),class:"setting-textarea",placeholder:(0,a.unref)(t)("例如：多生成修炼和探索类选项，减少战斗选项..."),rows:"3"},null,8,lt),[[a.vModelText,(0,a.unref)(h).actionOptionsPrompt]])])])])]),(0,a.createCommentVNode)(" 高级设置 "),(0,a.createElementVNode)("div",ct,[(0,a.createElementVNode)("div",dt,[(0,a.createElementVNode)("h4",ut,(0,a.toDisplayString)((0,a.unref)(t)("🔧 高级设置")),1)]),(0,a.createElementVNode)("div",mt,[(0,a.createElementVNode)("div",pt,[(0,a.createElementVNode)("div",gt,[(0,a.createElementVNode)("label",ht,(0,a.toDisplayString)((0,a.unref)(t)("调试模式")),1),(0,a.createElementVNode)("span",ft,(0,a.toDisplayString)((0,a.unref)(t)("启用开发者调试信息和详细日志")),1)]),(0,a.createElementVNode)("div",vt,[(0,a.createElementVNode)("label",bt,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=e=>y.debugMode=e),onChange:V},null,544),[[a.vModelCheckbox,y.debugMode]]),n[15]||(n[15]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])]),y.debugMode?((0,a.openBlock)(),(0,a.createElementBlock)("div",yt,[(0,a.createElementVNode)("div",xt,[(0,a.createElementVNode)("label",kt,(0,a.toDisplayString)((0,a.unref)(t)("控制台调试")),1),(0,a.createElementVNode)("span",wt,(0,a.toDisplayString)((0,a.unref)(t)("在浏览器控制台显示详细调试信息")),1)]),(0,a.createElementVNode)("div",Et,[(0,a.createElementVNode)("label",Nt,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=e=>y.consoleDebug=e),onChange:V},null,544),[[a.vModelCheckbox,y.consoleDebug]]),n[16]||(n[16]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])])):(0,a.createCommentVNode)("v-if",!0),y.debugMode?((0,a.openBlock)(),(0,a.createElementBlock)("div",St,[(0,a.createElementVNode)("div",Vt,[(0,a.createElementVNode)("label",_t,(0,a.toDisplayString)((0,a.unref)(t)("性能监控")),1),(0,a.createElementVNode)("span",Ct,(0,a.toDisplayString)((0,a.unref)(t)("监控组件性能和加载时间")),1)]),(0,a.createElementVNode)("div",At,[(0,a.createElementVNode)("label",Dt,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":n[9]||(n[9]=e=>y.performanceMonitor=e),onChange:V},null,544),[[a.vModelCheckbox,y.performanceMonitor]]),n[17]||(n[17]=(0,a.createElementVNode)("span",{class:"switch-slider"},null,-1))])])])):(0,a.createCommentVNode)("v-if",!0),(0,a.createElementVNode)("div",Tt,[(0,a.createElementVNode)("div",Bt,[(0,a.createElementVNode)("label",It,(0,a.toDisplayString)((0,a.unref)(t)("正则替换规则")),1),(0,a.createElementVNode)("span",zt,(0,a.toDisplayString)((0,a.unref)(t)("对AI输出进行替换：正则 / 纯文本（用于格式修正、屏蔽词替换等）")),1)]),(0,a.createElementVNode)("div",Mt,[(0,a.createElementVNode)("button",{class:"utility-btn",onClick:n[10]||(n[10]=e=>w.value=!0)},[(0,a.createTextVNode)((0,a.toDisplayString)((0,a.unref)(t)("编辑规则"))+" ",1),E.value>0?((0,a.openBlock)(),(0,a.createElementBlock)("span",Pt,"("+(0,a.toDisplayString)(E.value)+")",1)):(0,a.createCommentVNode)("v-if",!0)])])]),(0,a.createVNode)(ee,{open:w.value,rules:y.replaceRules,onClose:n[11]||(n[11]=e=>w.value=!1),onSave:S},null,8,["open","rules"]),(0,a.createElementVNode)("div",Rt,[(0,a.createElementVNode)("div",$t,[(0,a.createElementVNode)("label",Ot,(0,a.toDisplayString)((0,a.unref)(t)("导入设置")),1),(0,a.createElementVNode)("span",Lt,(0,a.toDisplayString)((0,a.unref)(t)("从文件恢复设置配置")),1)]),(0,a.createElementVNode)("div",Ft,[(0,a.createElementVNode)("button",{class:"utility-btn",onClick:R},[(0,a.createVNode)((0,a.unref)(i.A),{size:16}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)((0,a.unref)(t)("导入")),1)])])]),(0,a.createElementVNode)("div",jt,[(0,a.createElementVNode)("div",Ut,[(0,a.createElementVNode)("label",qt,(0,a.toDisplayString)((0,a.unref)(t)("清理缓存")),1),(0,a.createElementVNode)("span",Gt,(0,a.toDisplayString)((0,a.unref)(t)("清除游戏临时数据和缓存")),1)]),(0,a.createElementVNode)("div",Ht,[(0,a.createElementVNode)("button",{class:"utility-btn",onClick:M},[(0,a.createVNode)((0,a.unref)(s.A),{size:16}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)((0,a.unref)(t)("清理")),1)])])]),(0,a.createElementVNode)("div",Yt,[(0,a.createElementVNode)("div",Wt,[(0,a.createElementVNode)("label",Xt,(0,a.toDisplayString)((0,a.unref)(t)("导出设置")),1),(0,a.createElementVNode)("span",Jt,(0,a.toDisplayString)((0,a.unref)(t)("备份当前设置配置")),1)]),(0,a.createElementVNode)("div",Kt,[(0,a.createElementVNode)("button",{class:"utility-btn",onClick:P},[(0,a.createVNode)((0,a.unref)(l.A),{size:16}),(0,a.createTextVNode)(" "+(0,a.toDisplayString)((0,a.unref)(t)("导出")),1)])])])])])])]))}});var Qt=n(295),en={};en.styleTagTransform=J(),en.setAttributes=H(),en.insert=q().bind(null,"head"),en.domAPI=j(),en.insertStyleElement=W(),L()(Qt.A,en),Qt.A&&Qt.A.locals&&Qt.A.locals;const tn=(0,Q.A)(Zt,[["__scopeId","data-v-2a5ea289"]])},6939:(e,t,n)=>{"use strict";function a(e,t){let n=t.年-e.年;return(t.月<e.月||t.月===e.月&&t.日<e.日)&&n--,Math.max(0,n)}function r(e,t){return{年:t.年-e,月:t.月,日:t.日,小时:0,分钟:0}}function o(e){const t=e?.元数据?.时间??{年:1,月:1,日:1,小时:8,分钟:0},n=e?.角色?.身份??null;if(!n||"object"!=typeof n)return 0;if(!n.出生日期){const e=18;return n.出生日期=r(e,t),e}return a(n.出生日期,t)}function i(e,t){const n=t||{年:1,月:1,日:1,小时:8,分钟:0},o=e;if(!o.出生日期){const e=o.年龄||18,t=r(e,n);return o.出生日期=t,e}const i=a(o.出生日期,n);return void 0!==o.年龄&&(o.年龄=i),i}n.d(t,{DT:()=>o,R5:()=>a,UY:()=>i})},6963:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.skills-panel[data-v-04f7ac5f] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  padding: 16px;\n  gap: 16px;\n  overflow: hidden;\n}\n\n/* 标签页导航 */\n.panel-tabs[data-v-04f7ac5f] {\n  display: flex;\n  gap: 8px;\n  padding: 4px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n}\n.panel-tab[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.panel-tab[data-v-04f7ac5f]:hover {\n  background: rgba(var(--color-primary-rgb), 0.08);\n  color: var(--color-text);\n}\n.panel-tab.active[data-v-04f7ac5f] {\n  background: var(--color-primary);\n  color: #fff;\n}\n.tab-count[data-v-04f7ac5f] {\n  padding: 2px 8px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.2);\n  font-size: 12px;\n}\n.panel-tab:not(.active) .tab-count[data-v-04f7ac5f] {\n  background: rgba(var(--color-primary-rgb), 0.15);\n  color: var(--color-primary);\n}\n\n/* 内容区域 */\n.tab-content[data-v-04f7ac5f] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  overflow-y: auto;\n  min-height: 0;\n}\n\n/* 搜索栏 */\n.search-bar[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  color: var(--color-text-secondary);\n}\n.search-bar input[data-v-04f7ac5f] {\n  flex: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: var(--color-text);\n  font-size: 14px;\n}\n\n/* 修炼卡片 */\n.cultivation-card[data-v-04f7ac5f] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.03) 0%, var(--color-surface) 100%);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n  transition: all 0.3s ease;\n}\n.cultivation-card[data-v-04f7ac5f]:hover {\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n}\n.cultivation-header[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 16px;\n  padding: 16px;\n  border-bottom: 1px solid var(--color-border);\n}\n.cultivation-info[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.technique-icon[data-v-04f7ac5f] {\n  width: 44px;\n  height: 44px;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n}\n.technique-meta[data-v-04f7ac5f] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.meta-label[data-v-04f7ac5f] {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n}\n.technique-name[data-v-04f7ac5f] {\n  font-size: 16px;\n  font-weight: 700;\n  color: var(--color-text);\n}\n.cultivation-actions[data-v-04f7ac5f] {\n  display: flex;\n  gap: 8px;\n}\n.action-btn[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s;\n  font-weight: 500;\n}\n.action-btn[data-v-04f7ac5f]:hover {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.08);\n}\n.action-btn.primary[data-v-04f7ac5f] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: #fff;\n}\n.action-btn.warning[data-v-04f7ac5f] {\n  background: rgba(var(--color-warning-rgb), 0.15);\n  border-color: var(--color-warning);\n  color: var(--color-warning);\n}\n.action-btn.danger[data-v-04f7ac5f] {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n  color: #ef4444;\n}\n.action-btn.danger[data-v-04f7ac5f]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  border-color: #ef4444;\n}\n\n/* 修炼统计 */\n.cultivation-stats[data-v-04f7ac5f] {\n  display: flex;\n  gap: 12px;\n  padding: 16px;\n  flex-wrap: wrap;\n}\n.stat-item[data-v-04f7ac5f] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  padding: 10px 14px;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  min-width: 80px;\n}\n.stat-item.highlight[data-v-04f7ac5f] {\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border-color: rgba(var(--color-warning-rgb), 0.3);\n}\n.stat-label[data-v-04f7ac5f] {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n}\n.stat-value[data-v-04f7ac5f] {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.stat-value.success[data-v-04f7ac5f] { color: var(--color-success);\n}\n.stat-value.warning[data-v-04f7ac5f] { color: var(--color-warning);\n}\n\n/* 进度条 */\n.progress-bar[data-v-04f7ac5f] {\n  height: 6px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n}\n.progress-fill[data-v-04f7ac5f] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--color-primary), rgba(var(--color-primary-rgb), 0.6));\n  transition: width 0.3s;\n}\n\n/* 功法技能区域 */\n.skills-section[data-v-04f7ac5f] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.section-header[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px 16px;\n  border-bottom: 1px solid var(--color-border);\n  font-weight: 600;\n  color: var(--color-text);\n}\n.section-count[data-v-04f7ac5f] {\n  margin-left: auto;\n  font-size: 12px;\n  color: var(--color-text-secondary);\n}\n.skills-grid[data-v-04f7ac5f] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: 12px;\n  padding: 12px;\n}\n.skill-card[data-v-04f7ac5f] {\n  padding: 12px;\n  background: rgba(var(--color-primary-rgb), 0.03);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  transition: all 0.2s;\n}\n.skill-card.unlocked[data-v-04f7ac5f] {\n  background: rgba(var(--color-success-rgb), 0.05);\n  border-color: rgba(var(--color-success-rgb), 0.2);\n}\n.skill-header[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n  margin-bottom: 8px;\n}\n.skill-name[data-v-04f7ac5f] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.skill-badge[data-v-04f7ac5f] {\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 11px;\n  font-weight: 500;\n}\n.skill-badge.success[data-v-04f7ac5f] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.skill-badge.locked[data-v-04f7ac5f] {\n  background: rgba(var(--color-text-secondary-rgb, 128, 128, 128), 0.1);\n  color: var(--color-text-secondary);\n}\n.skill-desc[data-v-04f7ac5f] {\n  font-size: 13px;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  margin: 0 0 8px 0;\n}\n.skill-progress[data-v-04f7ac5f] {\n  margin-top: 8px;\n}\n.progress-info[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-size: 12px;\n  color: var(--color-text-secondary);\n  margin-bottom: 6px;\n}\n.progress-track[data-v-04f7ac5f] {\n  height: 4px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.skill-cost[data-v-04f7ac5f] {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n}\n\n/* 空状态 */\n.empty-state[data-v-04f7ac5f] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 64px 24px;\n  text-align: center;\n  color: var(--color-text-secondary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.02) 0%, transparent 100%);\n  border-radius: 12px;\n  border: 1px dashed var(--color-border);\n}\n.empty-icon[data-v-04f7ac5f] {\n  opacity: 0.4;\n  margin-bottom: 16px;\n  animation: float-04f7ac5f 3s ease-in-out infinite;\n}\n@keyframes float-04f7ac5f {\n0%, 100% { transform: translateY(0);\n}\n50% { transform: translateY(-10px);\n}\n}\n\n/* 掌握技能网格 */\n.mastered-grid[data-v-04f7ac5f] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n  gap: 16px;\n}\n.mastered-card[data-v-04f7ac5f] {\n  padding: 16px;\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.mastered-card[data-v-04f7ac5f]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 3px;\n  background: linear-gradient(90deg, var(--color-primary), rgba(var(--color-primary-rgb), 0.5));\n  transform: scaleX(0);\n  transition: transform 0.3s ease;\n}\n.mastered-card[data-v-04f7ac5f]:hover {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.15);\n}\n.mastered-card[data-v-04f7ac5f]:hover::before {\n  transform: scaleX(1);\n}\n.mastered-card.active[data-v-04f7ac5f] {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.08);\n  box-shadow: 0 4px 16px rgba(var(--color-primary-rgb), 0.2);\n}\n.mastered-card.active[data-v-04f7ac5f]::before {\n  transform: scaleX(1);\n}\n.mastered-header[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n.mastered-name[data-v-04f7ac5f] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.mastered-badge[data-v-04f7ac5f] {\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 11px;\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.mastered-desc[data-v-04f7ac5f] {\n  font-size: 13px;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  margin: 0 0 10px 0;\n}\n.mastered-meta[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 12px;\n}\n.meta-tag[data-v-04f7ac5f] {\n  padding: 2px 8px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 6px;\n  color: var(--color-primary);\n}\n.meta-stat[data-v-04f7ac5f] {\n  color: var(--color-text-secondary);\n}\n\n/* 品质文本 */\n.text-quality-仙[data-v-04f7ac5f] { color: #f59e0b;\n}\n.text-quality-神[data-v-04f7ac5f] { color: #ef4444;\n}\n.text-quality-圣[data-v-04f7ac5f] { color: #a855f7;\n}\n.text-quality-道[data-v-04f7ac5f] { color: #3b82f6;\n}\n.text-quality-天[data-v-04f7ac5f] { color: #22c55e;\n}\n.text-quality-地[data-v-04f7ac5f] { color: #06b6d4;\n}\n.text-quality-玄[data-v-04f7ac5f] { color: #8b5cf6;\n}\n.text-quality-黄[data-v-04f7ac5f] { color: #eab308;\n}\n.text-quality-凡[data-v-04f7ac5f] { color: var(--color-text-secondary);\n}\n\n/* 品质边框 */\n.border-quality-仙[data-v-04f7ac5f] { border-color: rgba(245, 158, 11, 0.4);\n}\n.border-quality-神[data-v-04f7ac5f] { border-color: rgba(239, 68, 68, 0.4);\n}\n.border-quality-圣[data-v-04f7ac5f] { border-color: rgba(168, 85, 247, 0.4);\n}\n.border-quality-道[data-v-04f7ac5f] { border-color: rgba(59, 130, 246, 0.4);\n}\n.border-quality-天[data-v-04f7ac5f] { border-color: rgba(34, 197, 94, 0.4);\n}\n.border-quality-地[data-v-04f7ac5f] { border-color: rgba(6, 182, 212, 0.4);\n}\n.border-quality-玄[data-v-04f7ac5f] { border-color: rgba(139, 92, 246, 0.4);\n}\n.border-quality-黄[data-v-04f7ac5f] { border-color: rgba(234, 179, 8, 0.4);\n}\n.border-quality-凡[data-v-04f7ac5f] { border-color: var(--color-border);\n}\n\n/* 品质背景 */\n.bg-quality-仙[data-v-04f7ac5f] { background: rgba(245, 158, 11, 0.15); color: #f59e0b;\n}\n.bg-quality-神[data-v-04f7ac5f] { background: rgba(239, 68, 68, 0.15); color: #ef4444;\n}\n.bg-quality-圣[data-v-04f7ac5f] { background: rgba(168, 85, 247, 0.15); color: #a855f7;\n}\n.bg-quality-道[data-v-04f7ac5f] { background: rgba(59, 130, 246, 0.15); color: #3b82f6;\n}\n.bg-quality-天[data-v-04f7ac5f] { background: rgba(34, 197, 94, 0.15); color: #22c55e;\n}\n.bg-quality-地[data-v-04f7ac5f] { background: rgba(6, 182, 212, 0.15); color: #06b6d4;\n}\n.bg-quality-玄[data-v-04f7ac5f] { background: rgba(139, 92, 246, 0.15); color: #8b5cf6;\n}\n.bg-quality-黄[data-v-04f7ac5f] { background: rgba(234, 179, 8, 0.15); color: #eab308;\n}\n.bg-quality-凡[data-v-04f7ac5f] { background: rgba(var(--color-primary-rgb), 0.1);\n}\n\n/* 功法库网格 */\n.library-grid[data-v-04f7ac5f] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n  gap: 16px;\n}\n.technique-card[data-v-04f7ac5f] {\n  padding: 16px;\n  background: var(--color-surface);\n  border: 2px solid var(--color-border);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n.technique-card[data-v-04f7ac5f]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 3px;\n  background: linear-gradient(90deg, var(--color-primary), rgba(var(--color-primary-rgb), 0.5));\n  transform: scaleX(0);\n  transition: transform 0.3s ease;\n}\n.technique-card[data-v-04f7ac5f]:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);\n}\n.technique-card[data-v-04f7ac5f]:hover::before {\n  transform: scaleX(1);\n}\n.technique-card.active[data-v-04f7ac5f] {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.technique-card.equipped[data-v-04f7ac5f] {\n  border-color: var(--color-success);\n  background: linear-gradient(135deg, rgba(var(--color-success-rgb), 0.05) 0%, var(--color-surface) 100%);\n  box-shadow: 0 4px 16px rgba(var(--color-success-rgb), 0.15);\n}\n.technique-card.equipped[data-v-04f7ac5f]::before {\n  background: linear-gradient(90deg, var(--color-success), rgba(var(--color-success-rgb), 0.5));\n  transform: scaleX(1);\n}\n.technique-header[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n.technique-desc[data-v-04f7ac5f] {\n  font-size: 13px;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n  margin: 0 0 10px 0;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n.technique-footer[data-v-04f7ac5f] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 12px;\n}\n.quality-tag[data-v-04f7ac5f] {\n  font-size: 12px;\n  font-weight: 600;\n}\n.skill-count[data-v-04f7ac5f] {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n}\n.equipped-badge[data-v-04f7ac5f] {\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 11px;\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.technique-actions[data-v-04f7ac5f] {\n  display: flex;\n  justify-content: flex-end;\n}\n.tech-btn[data-v-04f7ac5f] {\n  padding: 6px 14px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.tech-btn[data-v-04f7ac5f]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.tech-btn.primary[data-v-04f7ac5f] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: #fff;\n}\n.tech-btn.primary[data-v-04f7ac5f]:hover:not(:disabled) {\n  filter: brightness(1.1);\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n.panel-tabs[data-v-04f7ac5f] {\n    flex-wrap: wrap;\n}\n.cultivation-header[data-v-04f7ac5f] {\n    flex-direction: column;\n    align-items: flex-start;\n}\n.cultivation-actions[data-v-04f7ac5f] {\n    width: 100%;\n    justify-content: flex-start;\n}\n.cultivation-stats[data-v-04f7ac5f] {\n    flex-direction: column;\n}\n.stat-item[data-v-04f7ac5f] {\n    width: 100%;\n}\n}\n",""]);const s=i},6988:(e,t,n)=>{"use strict";n.d(t,{$:()=>s});const a=e=>!!e&&"object"==typeof e&&!Array.isArray(e),r=e=>"number"==typeof e&&Number.isFinite(e),o=e=>{const t=[];if(!a(e))return["元数据.时间 必须是对象"];const n=[["年",0,999999],["月",1,12],["日",1,31],["小时",0,23],["分钟",0,59]];for(const[a,o,i]of n){const n=e[a];r(n)?(n<o||n>i)&&t.push(`元数据.时间.${String(a)} 超出范围（${o}-${i}）`):t.push(`元数据.时间.${String(a)} 必须是数字`)}return t},i=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return a(t.元数据)&&a(t.角色)&&a(t.社交)&&a(t.世界)&&a(t.系统)};function s(e){const t=[],n=[];if(!i(e))return{isValid:!1,errors:["不是 V3 存档结构（缺少 元数据/角色/社交/世界/系统）"],warnings:[]};const s=e,l=s.元数据?.版本号;3!==l&&t.push("元数据.版本号 必须为 3"),"string"==typeof s.元数据?.存档ID&&s.元数据.存档ID.trim()||t.push("元数据.存档ID 必填"),"string"==typeof s.元数据?.存档名&&s.元数据.存档名.trim()||t.push("元数据.存档名 必填"),"string"!=typeof s.元数据?.创建时间&&t.push("元数据.创建时间 必须是字符串(ISO8601)"),"string"!=typeof s.元数据?.更新时间&&t.push("元数据.更新时间 必须是字符串(ISO8601)"),r(s.元数据?.游戏时长秒)||t.push("元数据.游戏时长秒 必须是数字"),t.push(...o(s.元数据?.时间)),a(s.角色?.身份)||t.push("角色.身份 必填且必须是对象"),a(s.角色?.属性)||t.push("角色.属性 必填且必须是对象"),a(s.角色?.位置)||t.push("角色.位置 必填且必须是对象"),Array.isArray(s.角色?.效果)||t.push("角色.效果 必填且必须是数组"),a(s.角色?.背包)||t.push("角色.背包 必填且必须是对象"),a(s.角色?.装备)||t.push("角色.装备 必填且必须是对象");const c=s.角色?.背包?.物品;a(c)||t.push("角色.背包.物品 必填且必须是对象");const d=s.角色?.装备;if(a(d)&&a(c))for(let e=1;e<=6;e++){const a=`装备${e}`,r=d[a];null!=r&&("string"==typeof r?r in c||n.push(`角色.装备.${a} 引用了不存在的物品ID：${r}`):t.push(`角色.装备.${a} 必须是 string|null`))}a(s.社交?.关系)||t.push("社交.关系 必填且必须是对象"),a(s.社交?.事件)||t.push("社交.事件 必填且必须是对象"),a(s.社交?.记忆)||t.push("社交.记忆 必填且必须是对象"),a(s.世界?.信息)||t.push("世界.信息 必填且必须是对象"),a(s.系统?.联机)||t.push("系统.联机 必填且必须是对象");const u=s.系统?.联机?.只读路径;return Array.isArray(u)||t.push("系统.联机.只读路径 必填且必须是数组"),{isValid:0===t.length,errors:t,warnings:n}}},7044:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2716%27 height=%2716%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%236b7280%27 stroke-width=%272%27%3E%3Cpath d=%27m6 9 6 6 6-6%27/%3E%3C/svg%3E"},7063:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n/* 主容器 */\n.preview-container[data-v-c4ae9bdc] {\n  height: 100%;\n  padding: 2rem;\n  box-sizing: border-box;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.preview-container[data-v-c4ae9bdc]::-webkit-scrollbar { width: 6px;\n}\n.preview-container[data-v-c4ae9bdc]::-webkit-scrollbar-track { background: transparent;\n}\n.preview-container[data-v-c4ae9bdc]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n\n/* 标题 */\n.title[data-v-c4ae9bdc] {\n  text-align: center;\n  color: #93c5fd;\n  margin: 0 0 0.5rem 0;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  font-weight: 600;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.subtitle[data-v-c4ae9bdc] {\n  text-align: center;\n  color: #94a3b8;\n  margin: 0 0 2rem 0;\n  font-size: 1rem;\n  font-style: italic;\n}\n\n/* 网格布局 */\n.preview-grid[data-v-c4ae9bdc] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 1.5rem;\n}\n\n/* 基础卡片样式 */\n.preview-item[data-v-c4ae9bdc] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  transition: all 0.25s ease;\n}\n.preview-item[data-v-c4ae9bdc]:hover {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.preview-item h3[data-v-c4ae9bdc] {\n  margin: 0;\n  color: #93c5fd;\n  border-bottom: 1px solid rgba(147, 197, 253, 0.2);\n  padding-bottom: 0.5rem;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n.preview-item p[data-v-c4ae9bdc] {\n  margin: 0;\n  font-size: 1rem;\n  color: #f1f5f9;\n  line-height: 1.5;\n}\n.preview-item h4[data-v-c4ae9bdc] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #bfdbfe;\n}\n.item-description[data-v-c4ae9bdc] {\n  font-size: 0.9rem !important;\n  color: #94a3b8 !important;\n  margin-top: 0.5rem !important;\n}\n.talents-item li .item-description[data-v-c4ae9bdc] {\n  margin-top: 0.25rem !important;\n  padding-left: 0.5rem;\n  border-left: 2px solid rgba(147, 197, 253, 0.3);\n}\n\n/* 名字输入 */\n.name-item[data-v-c4ae9bdc], .race-item[data-v-c4ae9bdc] {\n  grid-column: span 2;\n}\n@media (min-width: 769px) {\n.name-item[data-v-c4ae9bdc], .race-item[data-v-c4ae9bdc] {\n    grid-column: 1 / -1;\n}\n}\n.name-item label[data-v-c4ae9bdc] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #93c5fd;\n  margin-bottom: 0.5rem;\n  display: block;\n}\n.name-item input[data-v-c4ae9bdc], .input-field input[data-v-c4ae9bdc] {\n  width: 100%;\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n  padding: 0.75rem;\n  border-radius: 8px;\n  font-size: 1rem;\n  box-sizing: border-box;\n  transition: all 0.25s ease;\n}\n.input-field input[data-v-c4ae9bdc] {\n  background: rgba(30, 41, 59, 0.4);\n}\n.name-item input[data-v-c4ae9bdc]:focus, .input-field input[data-v-c4ae9bdc]:focus {\n  outline: none;\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 2px rgba(147, 197, 253, 0.1);\n}\n\n/* 只读输入框样式 */\n.readonly-input[data-v-c4ae9bdc] {\n  background: rgba(30, 41, 59, 0.3) !important;\n  cursor: not-allowed !important;\n  opacity: 0.7;\n  user-select: none;\n}\n.readonly-input[data-v-c4ae9bdc]:focus {\n  border-color: rgba(147, 197, 253, 0.2) !important;\n  box-shadow: none !important;\n}\n\n/* 名字提示文字 */\n.name-hint[data-v-c4ae9bdc] {\n  font-size: 0.85rem;\n  color: #94a3b8;\n  margin-top: 0.5rem;\n  display: block;\n}\n\n/* 性别选择 */\n.gender-control[data-v-c4ae9bdc] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.gender-label[data-v-c4ae9bdc] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 8px;\n  color: #f1f5f9;\n  background: rgba(30, 41, 59, 0.4);\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.gender-label[data-v-c4ae9bdc]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.gender-label input[type="radio"][data-v-c4ae9bdc] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: #93c5fd;\n}\n\n/* 开局模式选择 */\n.streaming-control[data-v-c4ae9bdc] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.streaming-label[data-v-c4ae9bdc] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem;\n  border-radius: 4px;\n  color: var(--color-text);\n  transition: all 0.2s ease;\n}\n.streaming-label[data-v-c4ae9bdc]:hover {\n  background: var(--color-surface-light);\n}\n.streaming-label input[type="radio"][data-v-c4ae9bdc] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: var(--color-primary);\n}\n.streaming-hint[data-v-c4ae9bdc] {\n  font-size: 0.85rem !important;\n  color: var(--color-text-secondary) !important;\n  margin-top: 0.5rem !important;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 3px solid var(--color-primary);\n  line-height: 1.4;\n}\n\n/* 生成方式选择 */\n.generate-mode-control[data-v-c4ae9bdc] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.generate-mode-label[data-v-c4ae9bdc] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem;\n  border-radius: 4px;\n  color: var(--color-text);\n  transition: all 0.2s ease;\n}\n.generate-mode-label[data-v-c4ae9bdc]:hover {\n  background: var(--color-surface-light);\n}\n.generate-mode-label input[type="radio"][data-v-c4ae9bdc] {\n  width: 16px;\n  height: 16px;\n  margin: 0;\n  accent-color: var(--color-primary);\n}\n.generate-mode-hint[data-v-c4ae9bdc] {\n  font-size: 0.85rem !important;\n  color: var(--color-text-secondary) !important;\n  margin-top: 0.5rem !important;\n  padding: 0.5rem;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 3px solid var(--color-primary);\n  line-height: 1.4;\n}\n\n/* 年龄控制 */\n.age-control[data-v-c4ae9bdc] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n}\n.age-btn[data-v-c4ae9bdc] {\n  width: 32px;\n  height: 32px;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  background: rgba(30, 41, 59, 0.6);\n  color: #93c5fd;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s ease;\n}\n.age-btn[data-v-c4ae9bdc]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.3);\n  border-color: #93c5fd;\n  color: #bfdbfe;\n}\n.age-btn[data-v-c4ae9bdc]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.age-display[data-v-c4ae9bdc] {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #f1f5f9;\n  min-width: 60px;\n  text-align: center;\n}\n.age-input[data-v-c4ae9bdc] {\n  width: 80px;\n  padding: 0.5rem;\n  border: 1px solid rgba(147, 197, 253, 0.3);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #f1f5f9;\n  font-size: 1.1rem;\n  font-weight: 600;\n  text-align: center;\n  transition: all 0.25s ease;\n}\n.age-input[data-v-c4ae9bdc]:focus {\n  outline: none;\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 2px rgba(147, 197, 253, 0.1);\n}\n.age-input[data-v-c4ae9bdc]::-webkit-inner-spin-button,\n.age-input[data-v-c4ae9bdc]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.age-input[type="number"][data-v-c4ae9bdc] {\n  -moz-appearance: textfield;\n}\n.age-unit[data-v-c4ae9bdc] {\n  font-size: 1rem;\n  color: #94a3b8;\n  font-weight: 500;\n}\n\n/* 列表样式 */\n.preview-item ul[data-v-c4ae9bdc] {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n}\n.preview-item li[data-v-c4ae9bdc] {\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  background: rgba(30, 41, 59, 0.4);\n  border-radius: 8px;\n  color: #f1f5f9;\n  line-height: 1.4;\n  border: 1px solid transparent;\n  transition: all 0.25s ease;\n}\n.preview-item li[data-v-c4ae9bdc]:hover {\n  background: rgba(51, 65, 85, 0.5);\n  border-color: rgba(147, 197, 253, 0.15);\n}\n.preview-item li strong[data-v-c4ae9bdc] {\n  display: block;\n  margin-bottom: 0.25rem;\n  color: #93c5fd;\n}\n\n/* 云端信息 */\n.cloud-info-item[data-v-c4ae9bdc] {\n  text-align: center;\n  background: rgba(30, 41, 59, 0.3);\n  border: 1px dashed rgba(147, 197, 253, 0.3);\n}\n.cloud-info-text[data-v-c4ae9bdc] {\n  font-size: 0.95rem;\n  color: #94a3b8;\n  line-height: 1.6;\n  font-style: italic;\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n.preview-container[data-v-c4ae9bdc] {\n    padding: 1rem;\n}\n.preview-grid[data-v-c4ae9bdc] {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n}\n.gender-control[data-v-c4ae9bdc] {\n    flex-direction: row;\n    flex-wrap: wrap;\n    justify-content: space-around;\n}\n.gender-label[data-v-c4ae9bdc] {\n    flex: 1;\n    min-width: 80px;\n    justify-content: center;\n}\n}\n@media (min-width: 769px) and (max-width: 1024px) {\n.preview-grid[data-v-c4ae9bdc] {\n    grid-template-columns: repeat(2, 1fr);\n}\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .preview-item[data-v-c4ae9bdc] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .preview-item[data-v-c4ae9bdc]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .preview-item h3[data-v-c4ae9bdc] {\n  color: #2563eb;\n  border-bottom-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .preview-item h4[data-v-c4ae9bdc] {\n  color: #1e40af;\n}\n[data-theme="light"] .preview-item p[data-v-c4ae9bdc] {\n  color: #1e293b;\n}\n[data-theme="light"] .title[data-v-c4ae9bdc] {\n  color: #2563eb;\n}\n[data-theme="light"] .subtitle[data-v-c4ae9bdc] {\n  color: #475569;\n}\n[data-theme="light"] .name-item label[data-v-c4ae9bdc] {\n  color: #2563eb;\n}\n[data-theme="light"] .name-item input[data-v-c4ae9bdc],\n[data-theme="light"] .input-field input[data-v-c4ae9bdc] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .gender-label[data-v-c4ae9bdc] {\n  background: rgba(255, 255, 255, 0.6);\n  color: #1e293b;\n}\n[data-theme="light"] .gender-label[data-v-c4ae9bdc]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .age-btn[data-v-c4ae9bdc] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .age-btn[data-v-c4ae9bdc]:hover:not(:disabled) {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n}\n[data-theme="light"] .age-input[data-v-c4ae9bdc] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #1e293b;\n}\n[data-theme="light"] .preview-item li[data-v-c4ae9bdc] {\n  background: rgba(255, 255, 255, 0.6);\n  color: #1e293b;\n}\n[data-theme="light"] .preview-item li[data-v-c4ae9bdc]:hover {\n  background: rgba(241, 245, 249, 0.95);\n}\n[data-theme="light"] .preview-item li strong[data-v-c4ae9bdc] {\n  color: #2563eb;\n}\n[data-theme="light"] .cloud-info-item[data-v-c4ae9bdc] {\n  background: rgba(248, 250, 252, 0.6);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .cloud-info-text[data-v-c4ae9bdc] {\n  color: #475569;\n}\n@media (max-width: 480px) {\n.preview-container[data-v-c4ae9bdc] {\n    padding: 1rem;\n}\n.title[data-v-c4ae9bdc] {\n    font-size: 1.6rem;\n}\n.subtitle[data-v-c4ae9bdc] {\n    font-size: 0.9rem;\n    margin-bottom: 1.5rem;\n}\n.preview-item[data-v-c4ae9bdc] {\n    padding: 1rem;\n    gap: 0.8rem;\n}\n.preview-item h3[data-v-c4ae9bdc] {\n    font-size: 1rem;\n}\n.preview-item h4[data-v-c4ae9bdc] {\n    font-size: 1rem;\n}\n.item-description[data-v-c4ae9bdc] {\n    font-size: 0.85rem !important;\n}\n.name-item label[data-v-c4ae9bdc] {\n    font-size: 1rem;\n}\n.name-item input[data-v-c4ae9bdc] {\n    padding: 0.6rem;\n    font-size: 0.9rem;\n}\n.gender-label[data-v-c4ae9bdc] {\n    font-size: 0.9rem;\n    padding: 0.4rem;\n}\n.age-control[data-v-c4ae9bdc] {\n    gap: 0.8rem;\n}\n.age-btn[data-v-c4ae9bdc] {\n    width: 28px;\n    height: 28px;\n    font-size: 0.9rem;\n}\n.age-display[data-v-c4ae9bdc] {\n    font-size: 1rem;\n}\n.preview-item li[data-v-c4ae9bdc] {\n    padding: 0.6rem;\n}\n}\n',""]);const s=i},7119:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},7136:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.quantity-modal-overlay[data-v-76ad986e] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000; /* 确保在最上层 */\n  backdrop-filter: blur(4px);\n}\n.quantity-modal[data-v-76ad986e] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-primary-border);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 400px;\n  color: var(--color-text);\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  animation: modal-appear-76ad986e 0.3s ease-out;\n  overflow: hidden;\n}\n@keyframes modal-appear-76ad986e {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n.modal-header[data-v-76ad986e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px 16px 24px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-primary-light);\n}\n.modal-header h3[data-v-76ad986e] {\n  margin: 0;\n  color: var(--color-text);\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n.close-btn[data-v-76ad986e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-76ad986e]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-primary);\n}\n.modal-body[data-v-76ad986e] {\n  padding: 24px;\n}\n.item-info[data-v-76ad986e] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  margin-bottom: 24px;\n  padding: 16px;\n  background: var(--color-surface-light);\n  border-radius: 8px;\n}\n.item-icon[data-v-76ad986e] {\n  font-size: 32px;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--color-background);\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n}\n.item-details[data-v-76ad986e] {\n  flex: 1;\n}\n.item-name[data-v-76ad986e] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 4px;\n}\n.item-type[data-v-76ad986e] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin-bottom: 4px;\n}\n.available-quantity[data-v-76ad986e] {\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.quantity-selector[data-v-76ad986e] {\n  margin-bottom: 20px;\n}\n.quantity-selector label[data-v-76ad986e] {\n  display: block;\n  margin-bottom: 12px;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.quantity-controls[data-v-76ad986e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.quantity-btn[data-v-76ad986e] {\n  background: var(--color-surface-hover);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 20px;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.quantity-btn[data-v-76ad986e]:hover:not(:disabled) {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.quantity-btn[data-v-76ad986e]:disabled {\n  background: var(--color-surface-light);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.quantity-input[data-v-76ad986e] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  color: var(--color-text);\n  padding: 8px 12px;\n  border-radius: 8px;\n  width: 100px;\n  text-align: center;\n  font-size: 1rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n}\n.quantity-input[data-v-76ad986e]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.quantity-shortcuts[data-v-76ad986e] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n  margin-top: 16px;\n}\n.preset-btn[data-v-76ad986e] {\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  color: var(--color-text-secondary);\n  padding: 6px 12px;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  transition: all 0.2s ease;\n}\n.preset-btn[data-v-76ad986e]:hover:not(:disabled) {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-border-hover);\n}\n.preset-btn[data-v-76ad986e]:disabled {\n  background: var(--color-surface);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.modal-footer[data-v-76ad986e] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  padding: 16px 24px 24px 24px;\n  border-top: 1px solid var(--color-border);\n}\n.cancel-btn[data-v-76ad986e], .confirm-btn[data-v-76ad986e] {\n  padding: 10px 20px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 80px;\n}\n.cancel-btn[data-v-76ad986e] {\n  background: var(--color-surface-hover);\n  color: var(--color-text-secondary);\n}\n.cancel-btn[data-v-76ad986e]:hover {\n  background: var(--color-surface-light);\n  color: var(--color-text);\n}\n.confirm-btn[data-v-76ad986e] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.confirm-btn[data-v-76ad986e]:hover:not(:disabled) {\n  background: var(--color-primary-hover);\n}\n.confirm-btn[data-v-76ad986e]:disabled {\n  background: var(--color-surface-light);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n  cursor: not-allowed;\n}\n.discard-confirm[data-v-76ad986e] {\n  background: var(--color-danger) !important;\n  border-color: var(--color-danger) !important;\n}\n.discard-confirm[data-v-76ad986e]:hover:not(:disabled) {\n  background: var(--color-danger-hover) !important;\n}\n.item-description[data-v-76ad986e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-top: 4px;\n  font-style: italic;\n}\n",""]);const s=i},7176:(e,t,n)=>{"use strict";var a,r=n(3126),o=n(5795);try{a=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var i=!!a&&o&&o(Object.prototype,"__proto__"),s=Object,l=s.getPrototypeOf;e.exports=i&&"function"==typeof i.get?r([i.get]):"function"==typeof l&&function(e){return l(null==e?e:s(e))}},7203:(e,t,n)=>{"use strict";n.d(t,{y8:()=>G,XH:()=>Z,LB:()=>K});var a=n(406),r=n(840);const o='\n# 文本格式标记\n\n- 环境描写: `【...】`\n- 内心思考: ``...``\n- 角色对话: `"..."`\n- 系统判定: `〖...〗`\n'.trim(),i='\n# 通用判定系统 v6.0\n\n## 1. 核心公式\n**最终判定值 = 基础判定值 + 环境修正 + 状态修正 + 气运骰子**\n\n### 基础判定值\n基础值 = 先天属性加权 + 境界加成 + 技艺加成\n\n### 环境修正（根据判定类型）\n**前端已计算**：系统会在"本回合判定数据"的"环境修正"中提供各类判定的环境加成\n\n**直接使用对应值**：\n- 修炼/突破 → 使用"修炼/突破"值\n- 炼丹/炼器 → 使用"炼丹/炼器"值\n- 战斗施法 → 使用"战斗施法"值\n- 探索/社交 → 固定为 0\n\n计算公式（仅供理解）：\n| 判定类型 | 灵气浓度影响 | 说明 |\n|---------|-------------|------|\n| 修炼突破 | (浓度-50)/10 | 浓度80→+3，浓度20→-3 |\n| 炼丹炼器 | (浓度-50)/15 | 灵气影响炼制成功率 |\n| 战斗 | (浓度-50)/20 | 灵气充沛利于施法 |\n| 探索/社交 | 0 | 不受灵气影响 |\n\n### 状态修正（累加）\n\n**基础状态（从属性百分比计算）**\n| 状态 | 修正值 | 说明 |\n|-----|-------|------|\n| 气血<50% | -5 | 受伤影响发挥 |\n| 气血<25% | -15 | 重伤严重削弱 |\n| 灵气<30% | -8 | 灵气不足影响施法 |\n| 神识<30% | -10 | 神识枯竭影响判断 |\n\n**存档状态效果（从角色.效果数组读取）**\n- buff类型：根据强度(0-100)给予 +1~+10 修正\n- debuff类型：根据强度(0-100)给予 -1~-10 修正\n- 公式：修正值 = (强度/100) × 10 × (buff为+1，debuff为-1)\n- 多个状态效果累加，但总修正限制在 -20~+20 范围内\n\n**常见状态效果示例**\n| 状态名称 | 类型 | 典型强度 | 修正 |\n|---------|------|---------|------|\n| 中毒 | debuff | 30-80 | -3~-8 |\n| 虚弱 | debuff | 20-60 | -2~-6 |\n| 经脉受损 | debuff | 40-90 | -4~-9 |\n| 心魔侵扰 | debuff | 50-100 | -5~-10 |\n| 丹药增益 | buff | 30-70 | +3~+7 |\n| 闭关专注 | buff | 50 | +5 |\n| 顿悟状态 | buff | 100 | +10 |\n| 法宝护体 | buff | 40-80 | +4~+8 |\n\n### 气运骰子（随机数）\n- **前端已计算**：系统会在"本回合判定数据"中提供计算好的骰子加成\n- **直接使用**：判定时直接使用提供的"骰子加成"值，**不要自己计算**\n- 计算公式（仅供理解）：\n  - 原始骰子(1-100) × 气运系数(1 + 气运/100) = 修正后骰子\n  - (修正后骰子 - 50) / 5 = 骰子加成\n\n## 2. 触发判定的场景\n**需要判定**：战斗攻防 | 炼丹炼器 | 修炼突破 | 危险探索 | 社交博弈 | 躲避危险\n**无需判定**：日常行为 | 大境界碾压(差2级以上) | 纯叙事\n\n## 3. 属性加权表\n| 判定类型 | 主属性×0.5 | 副属性×0.3 | 辅属性×0.2 |\n|---------|-----------|-----------|-----------|\n| 战斗攻击 | 根骨 | 灵性 | 气运 |\n| 战斗防御 | 根骨 | 心性 | 灵性 |\n| 炼丹炼器 | 悟性 | 灵性 | 心性 |\n| 修炼突破 | 悟性 | 灵性 | 心性 |\n| 探索发现 | 气运 | 灵性 | 悟性 |\n| 社交说服 | 魅力 | 悟性 | 心性 |\n| 躲避逃跑 | 灵性 | 气运 | 根骨 |\n\n## 4. 境界加成\n凡人0 | 炼气5 | 筑基12 | 金丹20 | 元婴30 | 化神42 | 炼虚55 | 合体70 | 渡劫88\n阶段：初期+0 | 中期+2 | 后期+4 | 圆满+6 | 极境+8\n\n## 5. 难度与结果\n| 难度 | 基准值 | 典型场景 |\n|-----|-------|---------|\n| 极易 | 10 | 日常小事 |\n| 简单 | 20 | 基础操作 |\n| 普通 | 35 | 正常挑战 |\n| 困难 | 50 | 需要努力 |\n| 艰难 | 70 | 九死一生 |\n| 极难 | 90 | 逆天而行 |\n\n**结果判定**（最终判定值 vs 难度）：\n- 大失败: < 难度-15 → 严重后果（受伤/损失/暴露）\n- 失败: < 难度 → 未达成目标，可能有小代价\n- 成功: ≥ 难度 → 达成目标\n- 大成功: ≥ 难度+15 → 超额完成，额外收获\n- 完美: ≥ 难度+30 → 完美发挥，可能触发机缘\n\n## 6. 输出格式（铁律）\n**禁止在text正文中描述判定过程！只输出判定卡片！**\n**禁止在判定卡片前添加【感知判定】【炼丹判定】等标题！**\n\n### 格式要求\n判定卡片必须包含所有加分项的详细分解，不能凭空产生判定值！\n\n**完整格式**：\n〖类型:结果,判定值:X,难度:Y,基础:B,骰子:D,环境:E,状态:S〗\n\n**必须详细列出的组成部分**：\n1. **基础值**：先天属性加权 + 境界加成 + 技艺加成\n2. **骰子**：气运修正后的骰子加成\n3. **环境**：灵气浓度、天气等环境因素\n4. **状态**：角色当前状态效果（buff/debuff）\n\n### 正确示例\n\n✅ **完整版（推荐）**：\n〖炼丹:成功,判定值:52,难度:50,基础:42(悟性21+境界12+技艺9),骰子:+8(气运),环境:+2(灵气70),状态:0〗\n\n〖斗法:失败,判定值:38,难度:45,基础:50(根骨25+境界12+技艺13),骰子:-2,环境:0,状态:-10(重伤)〗\n\n〖突破:大成功,判定值:78,难度:60,基础:55(悟性28+境界20+技艺7),骰子:+15(气运),环境:+3(灵气80),状态:+5(闭关)〗\n\n〖感知:成功,判定值:92,难度:60,基础:72(灵性36+境界20+技艺16),骰子:+15(气运),环境:+5(雷雨夜),状态:0〗\n\n### 错误示例\n\n❌ **错误1 - 添加了标题**：\n【感知判定】\n〖感知:成功,...〗\n\n❌ **错误2 - 判定值组成不明**：\n〖炼丹:成功,判定值:52,难度:50,骰子:+8〗  ← 52从哪来？缺少基础、环境、状态\n\n❌ **错误3 - 基础值不透明**：\n〖突破:成功,判定值:78,难度:60,基础:55,骰子:+15,环境:+3,状态:+5〗  ← 55怎么算的？\n\n### 计算示例\n\n**前端会提供**：\n# 本回合判定数据（前端已计算）\n**骰子加成**: +8 (原始骰子73 × 气运系数1.10 = 80)\n**环境修正**:\n  - 灵气浓度: 70\n  - 修炼/突破: +2\n  - 炼丹/炼器: +1\n  - 战斗施法: +1\n\n**AI只需计算基础值**：\n- 基础值 = 悟性21 + 境界14 + 技艺9 = 44\n\n**直接使用前端提供的值**：\n- 骰子 = +8 (前端提供，不要自己算)\n- 环境 = +1 (炼丹，使用"炼丹/炼器"值)\n- 状态 = 0 (无buff/debuff)\n\n**最终判定值** = 44 + 8 + 1 + 0 = 53\n\n**输出格式**：\n〖炼丹:成功,判定值:53,难度:50,基础:44(悟性21+境界14+技艺9),骰子:+8(气运),环境:+1(灵气70),状态:0〗\n'.trim(),s="\n## 战斗伤害\n`基础伤害=(根骨+灵性)×境界系数+武器伤害`\n`实际伤害=基础伤害-(对方根骨+护甲)×境界系数`\n境界系数：炼气1/筑基2/金丹4/元婴8/化神15/炼虚25/合体40/渡劫60\n".trim(),l='\n# 命名约定\n\n物品ID:`类型_数字` | 位置:`大陆·地点` | 品质:`{"quality":"凡~神","grade":0-10}`\n'.trim();function c(e,t=!1){const n=e.match(/<行动趋向>([\s\S]*?)<\/行动趋向>/);return`\n# 🧭 低噪声协议（无思维链）\n\n用户意图："${n?n[1].trim():e||"无"}"\n\n## 禁止\n- 绝对禁止输出：\`<thinking>\` / 思维链 / 任何推理过程标签\n\n## 内部自检清单（不要写出来）\n叙事里写到什么，就在 \`tavern_commands\` 里同步什么：\n□ 位置变化 → set \`位置\`\n□ 时间流逝 → add \`时间.分钟\`\n□ NPC出场 → set \`关系.NPC名.当前外貌状态\` / \`关系.NPC名.当前内心想法\`\n□ NPC互动 → push \`关系.NPC名.记忆\` + add \`关系.NPC名.好感度\`\n□ 受伤/恢复 → add \`属性.气血.当前\`（±）\n□ 效果增减 → push \`效果\`\n□ 使用灵气 → add \`属性.灵气.当前\`（负）\n□ 修炼进度 → add \`属性.境界.当前进度\` + add \`背包.物品.[功法ID].修炼进度\`\n□ 物品增删 → set/delete \`背包.物品.[物品ID]\`\n□ 灵石变化 → add \`背包.灵石.下品/中品/上品/极品\`\n\n## 行动选项\n- 若启用：输出 \`action_options\`（3-5个）\n- 若未启用：不要输出 \`action_options\`\n\n${i}\n`}c("");var d=n(4191),u=n(4459),m=n(8651);const p='\n# 输出格式（铁律！必须严格遵守！）\n\n**你必须立即输出JSON格式的响应，不要输出任何确认消息或纯文本！**\n\n## 强制JSON格式\n你的每一次回复都必须是一个合法的JSON对象，格式如下：\n{"text":"叙事内容","mid_term_memory":"本回合摘要","tavern_commands":[{"action":"set/add/push/delete","key":"路径","value":值}],"action_options":["选项1","选项2"]}\n\n## 禁止事项\n- ❌ 禁止输出纯文本！必须是JSON！\n- ❌ 禁止输出确认消息（如"法则已刻入天轨"、"明白了"等）\n- ❌ 禁止<thinking>或思维链\n- ❌ 禁止在JSON外添加任何内容\n\n## 字段说明\n- text: 叙事正文（必需）\n- mid_term_memory: 本回合事件摘要（必需）\n- tavern_commands: 数据更新指令数组（必需，无更新则为[]）\n- action_options: 行动选项（仅当系统启用时输出）\n\n## 示例\n{"text":"【山风呼啸】\\n你站在悬崖边，俯瞰云海翻涌...","mid_term_memory":"玩家到达悬崖，观察周围环境","tavern_commands":[{"action":"set","key":"角色.位置.描述","value":"东洲·青云山·悬崖"}],"action_options":["继续前行","原路返回"]}\n'.trim(),g="\n# 数据同步\ntext写什么，commands就更新什么：\n场景变化→set位置 | 时间流逝→add时间 | 世界事件→push社交.事件.事件记录(可选) | NPC互动→push记忆+add好感 | 战斗→add气血(负) | 技能→add灵气(负) | 修炼→add进度 | 物品→set/delete背包\n".trim(),h="\n# 数据结构\n只读：角色.身份/装备/技能.掌握技能\n境界：小突破add进度，大突破set整体\nNPC：必须一次性创建完整对象\n".trim(),f='\n# 叙事纯净规则（铁律）\n\n## 严禁在text中输出的内容\n- ❌ "系统提示"、"任务提示"、"温馨提示"等元信息\n- ❌ "[提示]"、"[注意]"、"[说明]"等方括号标注\n- ❌ "系统检测到..."、"已为您..."等系统语句\n- ❌ 对玩家的OOC（Out of Character）指导\n- ❌ 括号内的解释说明如"（此处需要判定）"\n\n## text字段只允许\n- ✅ 纯粹的剧情叙事（环境、动作、对话）\n- ✅ 判定卡片〖...〗\n- ✅ 格式标记【环境】`心理`"对话"\n\n## 元信息的正确处理\n- 系统状态 → 通过 tavern_commands 更新，不在text中描述\n- 选项提示 → 通过 action_options 字段提供，不在text中列举\n'.trim(),v="\n# 境界体系\n顺序：凡人>炼气>筑基>金丹>元婴>化神>炼虚>合体>渡劫\n阶段：初期>中期>后期>圆满>极境(罕见)\n突破：小阶段进度满自动突破；大境界需丹药/机缘\n压制：大境界差=绝对碾压；小阶段差2+=压倒性；差1可用功法/法宝弥补\n禁止：唯心爆发逆袭\n".trim(),b=("\n".trim(),'\n# 三千大道体系\n\n## 核心概念\n三千大道，殊途同归。每位修士可参悟多条大道，以道入心，以心证道。\n大道名称需有修仙风味，如：剑道、刀道、丹道、器道、阵道、火道、雷道、生死道、轮回道、因果道等。\n\n## 数据路径\n路径：角色.大道.大道列表.[道名]\n操作：set解锁道途 | add经验 | add阶段突破\n\n## 指令示例\n解锁：{"action":"set","key":"角色.大道.大道列表.剑道","value":{"道名":"剑道","描述":"以剑入道，剑心通明","阶段列表":[{"阶段名":"初窥门径","需求经验":0},{"阶段名":"略有所得","需求经验":100}],"是否解锁":true,"当前阶段":0,"当前经验":0,"总经验":0}}\n增加经验：{"action":"add","key":"角色.大道.大道列表.剑道.当前经验","value":50}\n'.trim()),y='\n# NPC规则（铁律）\n\n## 动态世界\n世界不以[user]为中心！NPC有独立生活轨迹，即使无玩家参与世界照常运转。\n什么身份干什么事：杂役扫地、弟子修炼、长老议事、散修游历。\n\n## 境界独立（严禁参考[user]）\n- ❌ 禁止生成"比玩家高/低X境界"或属性相近的镜像NPC\n- ❌ 禁止为剧情方便"量身定制"对手\n- ✅ 根据场景合理分布：凡人村落无高阶、外门以炼气筑基为主、坊市混杂\n\n## 多样化要求\n- 姓名：避免千篇一律，凡人可用朴实名（大牛、石头），修士用雅名/用户名\n- 性格：禁止模板化（全员高冷/全员善良），需多维度组合\n- 行为：身份决定态度，高阶不会无故关注低阶，NPC不会主动送宝\n\n## 技术规范\n创建：一次性set完整对象 | 必需字段：名字/性别/年龄/境界/性格/外貌/背景/好感度/记忆/位置\n境界更新：set整体{"名称":"筑基","阶段":"中期"}\n'.trim(),x='\n# 宏大概念约束\n化神以下禁用"道/天道/法则"，用"玄妙/威能/术法"代替\n禁止玄学归因，必须基于灵气运转/经脉/阵法解释\n能力必须具体化：详述灵力路径/施法过程/资源消耗\n'.trim(),k='\n# 技能消耗规则\n所有主动技能消耗均为百分比，使用后必须生成消耗指令。\n消耗类型：灵气(常规)/神识(心法幻术)/气血(体修)/寿元(禁术)\n消耗标准：基础3~8% | 核心10~20% | 杀招25~40% | 禁术50~80%\n指令示例：{"action":"add","key":"角色.属性.灵气.当前","value":-15}\n'.trim(),w="\n# 修真描写风格\n气机：重质感（森寒/粘稠）与声势（奔涌/雷音），避免枯燥经脉解剖\n神通：高阶出手必带天地异象，拒绝游戏读条式描写\n度量：时用一瞬/弹指/盏茶/炷香，空用寸/尺/丈/里（禁秒/米）\n格调：四字短语、古风韵律、忌大白话\n".trim(),E="\n# 状态效果\n路径：角色.效果（数组）\n操作：push添加 | set修改 | 过期由系统清理\n".trim(),N='\n# 位置更新\n触发：移动/场景变化时必须更新\n格式：set 角色.位置 {描述:"大陆·区域·地点",x:5000,y:5000}\n坐标：中心(5000,5000)，东+x/西-x/北-y/南+y\n'.trim(),S="\n# 命令路径规则\n原则：逐层连接(角色.属性.境界) | 动态拼接(社交.关系.[NPC名]) | 数组索引(角色.效果[0])\n顶层：元数据/角色/社交/世界/系统\n常用：add增减数值 | set设置对象 | push添加数组 | delete删除\n删除物品用delete不用remove！技能消耗=上限×百分比！\n".trim(),V='\n# 功法系统\n路径：功法存角色.背包.物品.{ID}，引用存角色.修炼.修炼功法\n学习：同时set功法到背包+设置修炼引用+设置当前功法ID\n技能命名：[意境]+[动作]+[诀/式/印]，禁止"技能1""火球术"\n'.trim(),_='\n# 玩家自主权（铁律）\nAI只描写当前回合发生的事，绝不替玩家做决定！\n禁止：替玩家选择/说话/行动/预设意图，禁止跳过等待输入\n正确：描写环境和NPC反应后停止，等待玩家回应\n示例：❌"你点头答应随他前往" → ✅"长老目光落在你身上，等待回应"\n'.trim(),C='\n# 合理性审查（铁律）\n玩家只能叙述自身行动/意图，结果由AI判定。\n拒绝：决定结果("我一剑斩杀他")/控制NPC/创造机遇/修改世界\n反主角光环：允许失败甚至死亡，作死必有代价，严禁爽文叙事\n识别诡辩：拒绝"因为NPC是好人所以帮我"等假逻辑，NPC有独立利益\n'.trim(),A="\n# 行当与熟练度（大道，铁律）\n任何“炼制/工艺/职业”行为（炼丹、炼器、阵法、符箓、医术、炼药、机关等）必须满足：学习→练习→熟练。\n- 无对应大道（如丹道/器道/阵道等），且无相关功法/技能/天赋/过往练习记忆：默认不可能直接成功，只能做入门练习或失败（消耗时间与材料/资源，且可能反噬）。\n- 第一次尝试通常仅算“入门学习”：可解锁对应大道为入门/初窥门径，并获得少量经验；成品为失败或极低品质。\n- 成功与品质主要由对应大道阶段/经验决定，其次才看境界、悟性、资源、环境与工具；天才只能提高学习/熟练速度，不能跳过入门。\n- 每次练习/炼制必须推进游戏时间；按结果增减对应大道经验（成功增多，失败也可少量增）。\n".trim(),D="\n# 反谄媚（高优先级）\n- 不迎合用户：不要默认“你说成功就成功”，结果必须基于规则与存档数值判定。\n- 不夸大/拍马：少用夸赞、附和、吹捧语气；用冷静客观的叙述。\n- 不做无成本许诺：任何收益都要有代价、风险、条件与后果；不合理请求要明确拒绝或改为可行方案。\n".trim(),T="\n# 难度控制\n日常接触限制在当前境界+2个大境界内（炼气→金丹上限，筑基→元婴上限）\n破格条件：因果牵连(得罪高阶)/世界事件(仙魔大战)/仇恨升级(持续作死)\n物品品质：凡人~练气最高黄品，筑基玄品，金丹地品，元婴以上天品\n".trim(),B="\n# 难度增强\n修仙世界危机四伏：资源稀缺、竞争激烈、危险无处不在\n成功率：普通50-70% | 高难度20-40% | 逆天5-15% | 作死0-5%\n失败有后果：战斗受伤/交涉结仇/修炼走火，且会连锁反应\n".trim(),I="\n# 宗门系统\n职位：记名→外门→内门→真传→核心→长老（晋升需境界+贡献+考核）\n贡献：任务/上交资源获取，兑换功法/丹药消耗，品质受职位限制\n藏经阁分层，资源需付出代价，内部有竞争派系\n".trim(),z="\n# 判定风险规则\n\n## 伤害等级\n皮外伤-5~10%气血 | 轻伤-15~25% | 重伤-30~50% | 濒死-60~80% | 致命-90%+\n\n## 境界压制\n大境界差=秒杀，越阶每差一级判定-20\n\n## 炼丹炼器\n难度：凡20/黄35/玄50/地70/天90，失败损耗材料，大失败反噬\n\n## 修炼风险\n走火入魔(强行突破/邪功) | 心魔(执念深/杀孽重) | 天劫(渡劫失败形神俱灭)\n\n## 技能消耗（铁律）\n使用主动技能必须生成消耗指令！消耗=上限×百分比\n仅允许消耗：灵气 / 神识 / 气血 / 寿元（极少数邪功可耗寿元）\n禁止使用其他资源名（如精力/体力/能量等）\n".trim(),M="\n# 功法修炼\n普通修炼1-5%/回合，闭关5-15%效率翻倍，深度感悟可触发顿悟\n技能按熟练度阈值解锁，100%后可尝试突破（失败倒退可能受伤）\n".trim(),P="\n# 大道感悟\n三千大道殊途同归，名称需修仙风味（剑道/丹道/雷道/生死道等）\n经验获取：日常10~50 | 战斗30~150 | 机缘100~500 | 闭关50~200/回合\n七重境界：初窥门径→略有所得→小有成就→登堂入室→融会贯通→道心通明→大道将成→道之圆满\n".trim(),R="\n# 修炼速度（铁律）\n严禁三天两天突破！修炼必须推进游戏时间。\n灵气浓度影响速度：稀薄0.1-0.4 | 普通0.4-0.7 | 充沛0.7-1.0 | 浓郁1.0-1.5 | 极盛1.5-2.0\n突破参考：练气期小阶段3月-3年，大境界2-20年；越高境界越久\n".trim(),$="\n# 六司系统\n先天六司(0-10)只读占70%权重，后天六司(0-20)可修改占30%权重\n后天获取：装备+3/天赋+2/丹药+2/机缘+5/大道感悟+1/境界突破+1\n".trim(),O="\n# 宗门动态生成\n延迟初始化：加入时只创建框架，藏经阁/商店首次访问时生成\n路径：社交.宗门.宗门藏经阁.[宗门名] | 社交.宗门.宗门贡献商店.[宗门名]\n".trim(),L="\n# 人族境界属性标准 (Human Realm Stats Standard)\n\n- 统一阶段：初期/中期/后期/圆满/极境\n- 下表为各境界大圆满时的参考值，可根据天资、功法等浮动。\n\n| 境界(大圆满) | 寿命上限 | 气血上限 | 灵力上限 | 神识上限 |\n|---|---|---|---|---|\n| 凡人 | 100 | 100 | 0 | 0 |\n| 炼气 | 120 | 200 | 500 | 100 |\n| 筑基 | 250 | 1,000 | 5,000 | 1,000 |\n| 金丹 | 500 | 3,000 | 15,000 | 5,000 |\n| 元婴 | 1,000 | 8,000 | 50,000 | 15,000 |\n| 化神 | 3,000 | 20,000 | 150,000 | 50,000 |\n| 炼虚 | 8,000 | 50,000 | 500,000 | 150,000 |\n| 合体 | 15,000 | 100,000 | 1,500,000 | 500,000 |\n| 渡劫 | 30,000 | 300,000 | 5,000,000 | 1,500,000 |\n\n# 境界与身份层级（社会角色参考）\n| 境界 | 稀有度/地位 | 常见身份举例 |\n|---|---|---|\n| 凡人 | 大多数，凡俗之身 | 宗门杂役、灵农、药园仆役、矿脉劳工、坊市凡人、外门仆从 |\n| 练气 | 千百凡人只出一人，凡俗眼中为“仙师” | 记名弟子、外门弟子、坊市散修、护院修士、传功堂学徒 |\n| 筑基 | 脱凡入道，宗门中坚 | 内门弟子、执事、外门长老、巡山护法、世家中坚 |\n| 金丹 | 一宗一地的顶尖战力 | 宗门长老、峰主、世家家主、镇派供奉、护法尊者 |\n| 元婴 | 一域罕见，掌宗门兴衰 | 太上长老、宗门副掌门、镇宗长老、传功殿首座、仙盟执事 |\n| 化神 | 少数大能，能定一宗一域大局 | 大宗掌教、太上老祖、仙盟议事长老、宗门护道者、秘境主人 |\n| 炼虚 | 极少数顶尖强者 | 上宗太上、镇宗老祖、护山大阵主事、禁地守护者、隐世强者 |\n| 合体 | 凤毛麟角，几乎不问俗事 | 祖师级老怪、闭关道君、镇派底蕴、道场主人、隐世宗师 |\n| 渡劫 | 传说之上，飞升在望 | 飞升前辈、镇派终极底蕴、天劫候选、禁地之主、万古寥寥 |\n".trim(),F='\n# 品质系统 (Quality System)\n\n- 格式: `{"quality":"凡|黄|玄|地|天|仙|神","grade":0-10}`\n- **凡/黄**: 开局常见\n- **玄/地**: 中期核心\n- **天**: 高级稀有\n- **仙**: 顶级传说\n- **神**: 禁忌之物，几乎不应出现\n'.trim(),j='\n# 声望系统（个人威望）\n\n## 核心概念\n声望=个人在修仙界的名气，与好感度(社交.关系.[NPC名].好感度)不同。\n路径：角色.声望 | 范围：0~10000 | 初始：0（无名小卒）\n\n## 声望等级与效果（铁律：AI必须根据声望生成对应文本，特别是初次与陌生人的交互！）\n| 声望值 | 等级 | 陌生人反应 | 初始好感度修正 |\n|-------|------|----------|--------------|\n| 0~99 | 无名 | 无人知晓，需自报家门 | +0 |\n| 100~499 | 小有名气 | 同境界可能听过名字 | +5 |\n| 500~1999 | 声名鹊起 | 报名后"原来是xxx" | +10 |\n| 2000~4999 | 名震一方 | 不报名也被认出，主动攀谈 | +20 |\n| 5000~9999 | 威震天下 | 见面即识，恭敬有加 | +30 |\n| 10000 | 传说 | 如雷贯耳，敬若神明 | +50 |\n\n## 声望获取\n斩杀强敌+100~1000 | 大型事件立功+200~2000 | 炼丹/炼器成名+50~500 | 救人/除害+30~300\n负面事件（杀良/背叛）不减声望，但会变成"恶名"（同样被认出，但态度敌视）\n\n## 声望传播\n事件发生地即时生效，向周边区域按距离衰减传播（游戏时间数月~数年）\n'.trim(),U=("\n# 境界突破时间标准（游戏时间）\n\n## 核心原则\n修仙非一日之功，境界突破需要漫长的积累。以下为各境界突破所需的参考时间。\n\n## 练气期突破时间\n| 阶段 | 最短 | 标准 | 最长 |\n|-----|------|------|------|\n| 初期→中期 | 3月 | 1年 | 3年 |\n| 中期→后期 | 6月 | 2年 | 5年 |\n| 后期→圆满 | 1年 | 3年 | 10年 |\n| 圆满→筑基 | 2年 | 5年 | 20年 |\n\n## 筑基期突破时间\n| 阶段 | 最短 | 标准 | 最长 |\n|-----|------|------|------|\n| 初期→中期 | 1年 | 5年 | 15年 |\n| 中期→后期 | 2年 | 8年 | 25年 |\n| 后期→圆满 | 3年 | 12年 | 40年 |\n| 圆满→金丹 | 10年 | 30年 | 100年 |\n\n## 金丹期突破时间\n| 阶段 | 最短 | 标准 | 最长 |\n|-----|------|------|------|\n| 初期→中期 | 5年 | 20年 | 50年 |\n| 中期→后期 | 10年 | 30年 | 80年 |\n| 后期→圆满 | 15年 | 40年 | 100年 |\n| 圆满→元婴 | 20年 | 60年 | 150年 |\n\n## 元婴期突破时间\n| 阶段 | 最短 | 标准 | 最长 |\n|-----|------|------|------|\n| 初期→中期 | 20年 | 60年 | 150年 |\n| 中期→后期 | 30年 | 90年 | 200年 |\n| 后期→圆满 | 40年 | 120年 | 300年 |\n| 圆满→化神 | 60年 | 180年 | 500年 |\n\n## 化神期及以上\n| 境界 | 小阶段突破 | 大境界突破 |\n|-----|-----------|-----------|\n| 化神期 | 50-200年 | 200-2000年 |\n| 炼虚期 | 100-500年 | 500-5000年 |\n| 合体期 | 200-1000年 | 1000-10000年 |\n| 渡劫期 | 500-2000年 | 天劫难测 |\n\n## 速度修正因子\n- **天资卓越**（先天六司总分>50）：时间×0.7\n- **天资平庸**（先天六司总分<25）：时间×1.5\n- **灵气极盛**（浓度>80）：时间×0.6\n- **灵气稀薄**（浓度<20）：时间×2.0\n- **顶级功法**（天品以上）：时间×0.5\n- **普通功法**（黄品以下）：时间×1.3\n- **机缘顿悟**：可大幅缩短，但极为罕见\n\n## AI判定规则\n- 玩家修炼时必须推进游戏时间\n- 时间推进量应与修为增长成正比\n- 严禁数天内完成大境界突破\n- 顿悟/机缘可缩短时间，但需有合理剧情铺垫\n".trim(),'\n# 行动选项规范（启用时生效）\n\n## ⚠️ 强制要求\n当系统启用“行动选项”功能时，你必须在 JSON 代码块中输出 `action_options` 字段：\n- 禁止省略 `action_options`\n- 必须包含 3-5 个有效选项（字符串数组）\n\n## 格式要求\n```\n{\n  "action_options": [\n    "前往藏经阁查阅典籍",\n    "向师兄打听宗门近况",\n    "在此处闭关修炼",\n    "关注突发世界事件",\n    "四处走动熟悉环境"\n  ]\n}\n```\n\n- 数量：3-5 个选项\n- 长度：每个选项 8-20 字\n- 格式：动词开头的行动描述\n\n{{CUSTOM_ACTION_PROMPT}}\n\n## 生成规则\n基于当前场景生成多样化选项，覆盖以下方向：\n1. **保守选项** - 观察/等待/防御/休息\n2. **中立选项** - 交流/询问/了解情况\n3. **积极选项** - 探索/行动/前进\n4. **特殊选项** - 基于当前情境的独特选择\n\n## 禁止事项\n- ❌ 省略 action_options 字段\n- ❌ action_options 为空数组\n- ❌ 只有1-2个选项\n- ❌ 重复相似的选项（如"继续修炼"和"接着修炼"）\n- ❌ 无法执行的选项\n- ❌ 替玩家做决定的选项（如"决定加入"）\n'.trim()),q="\n# 规则：世界事件（重要）\n\n## 核心理念\n- 世界不以玩家为中心：宗门、势力、秘境、天象、资源与人心都会自行演变\n- 大事件必须影响现实：至少带来一个可感知后果（危险、资源、关系、地缘格局、修炼环境变化等）\n- 事件必须“刚刚发生”：叙事中用现场感呈现，而不是公告式总结\n\n## 事件类型示例（可混合）\n- 宗门大战/势力冲突（围剿、灭门、同盟、割据）\n- 世界变革（灵潮涨落、天道异动、法则松动、禁制破裂）\n- 异宝降世（灵宝出世、古器苏醒、传承现身）\n- 秘境现世（入口出现、规则变化、限时开放）\n- 人物风波（好友受伤、好友突破、好友被追杀、恩怨升级）\n\n## 合理性要求\n- 事件强度需与玩家境界、声望、位置、当前状态相符（低境界可卷入边缘，仍须受波及）\n- 若涉及好友/NPC，优先使用存档中的“关系”与“好感度”推断其动机与结局\n- 事件后续需留下“悬念/尾巴”，推动玩家下一步行动\n".trim(),G={coreRequest:{name:"核心请求提示词",description:"正常游戏请求时按顺序发送的提示词",icon:"📨"},summary:{name:"总结请求提示词",description:"记忆总结时使用的提示词",icon:"📝"},initialization:{name:"开局初始化提示词",description:"开局时世界生成和角色初始化的提示词",icon:"🚀"},generation:{name:"动态生成提示词",description:"游戏中动态生成NPC/事件/物品的提示词",icon:"🎨"}},H=[p,g,h,f].join("\n\n"),Y=[C,D,A,T,B,v,y,S,V,z,_].join("\n\n"),W=[b,x,k,w,E,N,I,M,P,R,$,O].join("\n\n"),X=[o,i,s,l].join("\n\n"),J=[L,F,j].join("\n\n");function K(){const e=(0,m.isTavernEnv)();return{coreOutputRules:{name:"1. 输出格式",content:H,category:"coreRequest",description:"JSON格式、数据同步",order:1,weight:10},businessRules:{name:"2. 核心规则",content:Y,category:"coreRequest",description:"境界、NPC、战斗规则",order:2,weight:9},extendedBusinessRules:{name:"2.5 扩展规则",content:W,category:"coreRequest",description:"大道、宗门等扩展",order:2.5,weight:5},dataDefinitions:{name:"3. 数据结构",content:(0,a.lS)(e),category:"coreRequest",description:"存档结构定义",order:3,weight:10},textFormatRules:{name:"4. 文本格式",content:X,category:"coreRequest",description:"判定、伤害、命名",order:4,weight:6},worldStandards:{name:"5. 世界标准",content:J,category:"coreRequest",description:"境界属性、品质",order:5,weight:7},cotCore:{name:"6. 自检协议",content:c("{{用户输入}}",!1),category:"coreRequest",description:"禁止思维链输出",order:6,weight:8},actionOptions:{name:"7. 行动选项",content:U,category:"coreRequest",description:"生成玩家选项",order:7,weight:6},eventSystemRules:{name:"8. 世界事件",content:q,category:"coreRequest",description:"世界事件演变与影响",order:8,weight:5},splitGenerationStep1:{name:"9. 分步正文",content:"# 分步生成 1/2：正文\n禁止：<thinking>/JSON/字段名/解释\n只输出：纯文本小说正文\n要求：承接情节、多描写少总结、结尾留钩子".trim(),category:"coreRequest",description:"分步模式第1步",order:9,weight:7},splitGenerationStep2:{name:"10. 分步指令",content:"# 分步生成 2/2：JSON指令\n禁止：正文/text字段/<thinking>\n只输出：{mid_term_memory, tavern_commands, action_options}".trim(),category:"coreRequest",description:"分步模式第2步",order:10,weight:7},splitInitStep1:{name:"11. 开局正文",content:"# 开局分步 1/2：正文\n禁止：<thinking>/JSON/指令\n只输出：开局纯文本正文\n要求：交代场景、结尾留钩子".trim(),category:"coreRequest",description:"开局分步第1步",order:11,weight:7},splitInitStep2:{name:"12. 开局指令",content:"# 开局分步 2/2：JSON指令\n禁止：正文/text/<thinking>\n只输出：{mid_term_memory, tavern_commands, action_options}".trim(),category:"coreRequest",description:"开局分步第2步",order:12,weight:7},memorySummary:{name:"记忆总结",content:'记忆总结助手。第一人称"我"，250-400字，保留人名/地名/事件/物品/境界，忽略对话/情绪/细节。\n输出：{"text": "总结内容"}',category:"summary",description:"中期→长期记忆",order:1,weight:6},npcMemorySummary:{name:"NPC记忆总结",content:'NPC记忆总结。第三人称，100-200字，保留关键事件和情感变化。\n输出：{"text": "总结内容"}',category:"summary",description:"NPC记忆总结",order:2,weight:5},npcGeneration:{name:"NPC生成",content:'生成修仙世界NPC。\n核心：世界不以玩家为中心，NPC有独立生活；严禁参考玩家境界生成"镜像NPC"或"量身对手"。\n要求：根据场景合理分布境界、姓名性格多样化、身份决定行为。\n输出JSON：{姓名,性别,年龄,境界:{名称,阶段},性格,外貌,背景,说话风格,当前行为,个人目标,初始好感度:50}',category:"generation",description:"动态生成NPC",order:1,weight:5},eventGeneration:{name:"事件生成",content:'生成修仙世界“刚刚发生”的世界事件（用于影响玩家与世界演变）。要求：\n- 必须让玩家受到影响（危险/资源/关系/位置/修炼环境/势力格局至少一项）\n- 事件可以是宗门大战、世界变化、异宝降世、秘境现世、好友出事/突破等\n- 涉及好友时，需参考关系/好感度与境界，不能无端超规格\n- 不要公告式总结，要有现场感（刚发生）\n输出JSON（不要代码块/解释/额外文本）：\n{\n  "event": {\n    "事件ID": "event_时间戳_随机数",\n    "事件名称": "string",\n    "事件类型": "string",\n    "事件描述": "string",\n    "影响等级": "轻微|中等|重大|灾难",\n    "影响范围": "string",\n    "相关人物": ["string"],\n    "相关势力": ["string"],\n    "事件来源": "随机",\n    "发生时间": {"年":0,"月":1,"日":1,"小时":0,"分钟":0}\n  },\n  "prompt_addition": "一段可直接注入主叙事的事件快照（强调刚刚发生）"\n}',category:"generation",description:"动态生成世界事件",order:2,weight:5},itemGeneration:{name:"物品生成",content:"生成修仙世界物品。品质：凡(1-3)/黄(4-5)/玄(6-7)/地(8-9)/天(10)。\n输出JSON：{物品ID,名称,类型,品质:{quality,grade},描述,数量,效果}",category:"generation",description:"动态生成物品",order:3,weight:5},worldGeneration:{name:"世界生成",content:d.c.buildPrompt({factionCount:5,totalLocations:10,secretRealms:3,continentCount:3}),category:"initialization",description:"生成大陆、势力、地点",order:1,weight:8},characterInit:{name:"角色初始化",content:(0,r.q5)(e),category:"initialization",description:"生成角色和开场",order:2,weight:9},newbieGuide:{name:"新手引导",content:"新手引导（前3回合）。原则：自然融入叙事，不打破沉浸感，通过NPC对话传递。\n内容：行动方式/查看状态/物品使用/交流/探索。",category:"initialization",description:"自然新手引导",order:3,weight:4},textOptimization:{name:"文本优化",content:"# 文本优化助手\n\n你是一个专业的中文文学编辑，负责优化修仙小说文本。\n\n## 优化原则\n1. **保持原意**：不改变故事情节、人物行为、对话内容\n2. **提升文采**：使用更优美、更具画面感的表达\n3. **修仙风格**：保持修仙世界的语言风格和氛围\n4. **流畅自然**：确保行文流畅，过渡自然\n5. **精简冗余**：删除重复、啰嗦的表达\n\n## 优化重点\n- 动作描写：更加生动形象\n- 环境描写：增加意境和氛围\n- 对话：保持人物性格特色\n- 心理描写：更加细腻深入\n\n## 禁止事项\n- 不要添加新的情节或角色\n- 不要改变原有的判定结果\n- 不要输出任何JSON格式内容\n- 不要添加解释或评论\n\n## 输出格式\n直接输出优化后的纯文本，不要任何额外内容。",category:"summary",description:"优化AI生成的文本",order:3,weight:5}}}async function Z(e){return await u.promptStorage.get(e)}},7384:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* 命令日志弹窗样式 */\n.command-log-overlay[data-v-5e56b78d] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n.command-log-modal[data-v-5e56b78d] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 500px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  display: flex;\n  flex-direction: column;\n}\n\n/* 弹窗动画 */\n.command-log-modal-enter-active[data-v-5e56b78d],\n.command-log-modal-leave-active[data-v-5e56b78d] {\n  transition: all 0.3s ease;\n}\n.command-log-modal-enter-from[data-v-5e56b78d],\n.command-log-modal-leave-to[data-v-5e56b78d] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n.command-log-header[data-v-5e56b78d] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, var(--color-surface-light) 0%, var(--color-surface-hover) 100%);\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.command-log-header h3[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-log-btn[data-v-5e56b78d] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 50%;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-log-btn[data-v-5e56b78d]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  transform: rotate(90deg);\n}\n.command-log-content[data-v-5e56b78d] {\n  padding: 16px;\n  overflow-y: auto;\n  flex: 1;\n}\n.command-list[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.command-item[data-v-5e56b78d] {\n  display: flex;\n  gap: 12px;\n  padding: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.command-item[data-v-5e56b78d]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border-color: var(--color-primary);\n}\n.command-icon-wrapper[data-v-5e56b78d] {\n  width: 40px;\n  height: 40px;\n  flex-shrink: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  background: var(--color-primary-light);\n  color: var(--color-primary);\n}\n.command-details[data-v-5e56b78d] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.command-description[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 0.9rem;\n  font-weight: 500;\n  color: var(--color-text);\n  line-height: 1.4;\n}\n.command-values[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.85rem;\n  font-family: var(--font-family-mono);\n}\n.old-value[data-v-5e56b78d], .new-value[data-v-5e56b78d] {\n  padding: 4px 8px;\n  border-radius: 4px;\n}\n.old-value[data-v-5e56b78d] {\n  background: rgba(var(--color-error-rgb), 0.1);\n  color: var(--color-danger);\n  text-decoration: line-through;\n}\n.new-value[data-v-5e56b78d] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n  font-weight: 600;\n}\n.arrow[data-v-5e56b78d] {\n  color: var(--color-text-secondary);\n  font-weight: 600;\n}\n.no-commands[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.no-commands .empty-icon[data-v-5e56b78d] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n}\n.no-commands .empty-text[data-v-5e56b78d] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: var(--color-text);\n  font-size: 1rem;\n}\n.no-commands .empty-hint[data-v-5e56b78d] {\n  font-size: 0.85rem;\n  opacity: 0.8;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .command-log-modal[data-v-5e56b78d] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .command-log-header[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #334155 0%, #1e293b 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .command-item[data-v-5e56b78d] {\n  background: #334155;\n  border-color: #475569;\n}\n[data-theme="dark"] .command-item[data-v-5e56b78d]:hover {\n  border-color: var(--color-primary);\n}\n[data-theme="dark"] .command-icon-wrapper[data-v-5e56b78d] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n}\n[data-theme="dark"] .old-value[data-v-5e56b78d] {\n  background: rgba(var(--color-error-rgb), 0.2);\n}\n[data-theme="dark"] .new-value[data-v-5e56b78d] {\n  background: rgba(var(--color-success-rgb), 0.2);\n}\n.main-game-panel[data-v-5e56b78d] {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  box-sizing: border-box;\n}\n\n/* 短期记忆区域 */\n.memory-section[data-v-5e56b78d] {\n  padding: 12px 20px;\n  background: linear-gradient(135deg, #fefbff 0%, #f8fafc 100%);\n  border-bottom: 1px solid #e2e8f0;\n  position: relative;\n  z-index: 20;\n  flex-shrink: 0;\n}\n.memory-header[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  cursor: pointer;\n  padding: 4px 0;\n  transition: all 0.2s ease;\n}\n.memory-header[data-v-5e56b78d]:hover {\n  background: rgba(99, 102, 241, 0.05);\n  border-radius: 6px;\n  margin: -4px;\n  padding: 8px 4px;\n}\n.memory-title[data-v-5e56b78d] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #6366f1;\n}\n.memory-icon[data-v-5e56b78d] {\n  color: #94a3b8;\n  transition: transform 0.2s ease;\n}\n\n/* 下拉悬浮效果 */\n.memory-dropdown[data-v-5e56b78d] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  background: var(--color-surface);\n  border: 1px solid #e2e8f0;\n  border-top: none;\n  border-radius: 0 0 12px 12px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n  z-index: 19;\n  max-height: 300px;\n  overflow-y: auto;\n}\n.memory-content[data-v-5e56b78d] {\n  padding: 16px 20px;\n}\n.memory-item[data-v-5e56b78d] {\n  font-size: 0.85rem;\n  color: #374151;\n  margin-bottom: 12px;\n  padding: 12px 16px;\n  background: rgba(99, 102, 241, 0.05);\n  border-radius: 8px;\n  border-left: 3px solid #6366f1;\n  line-height: 1.5;\n}\n.memory-item[data-v-5e56b78d]:last-child {\n  margin-bottom: 0;\n}\n.no-memory[data-v-5e56b78d] {\n  font-size: 0.9rem;\n  color: #9ca3af;\n  font-style: italic;\n  text-align: center;\n  padding: 20px;\n}\n\n/* 下拉动画 */\n.memory-dropdown-enter-active[data-v-5e56b78d],\n.memory-dropdown-leave-active[data-v-5e56b78d] {\n  transition: all 0.3s ease;\n}\n.memory-dropdown-enter-from[data-v-5e56b78d] {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n.memory-dropdown-leave-to[data-v-5e56b78d] {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n\n/* 当前叙述显示区域 */\n.current-narrative[data-v-5e56b78d] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  min-width: 0; /* 防止flex收缩问题 */\n  border-radius: 12px; /* 圆角 */\n  box-shadow: none !important; /* 移除阴影 */\n  background-color: var(--color-surface) !important; /* 提亮叙事区域但不刺眼 */\n}\n\n/* 流式输出内容样式 */\n.streaming-narrative-content[data-v-5e56b78d] {\n  margin-top: 16px;\n  padding: 16px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  animation: fadeIn-5e56b78d 0.3s ease-in;\n}\n.streaming-text[data-v-5e56b78d] {\n  line-height: 1.8;\n  color: var(--color-text);\n  font-size: 0.95rem;\n}\n@keyframes fadeIn-5e56b78d {\nfrom {\n    opacity: 0;\n    transform: translateY(10px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.content-area[data-v-5e56b78d] {\n  background-color: var(--color-surface) !important; /* 提亮内容区 */\n  padding: 20px;\n  flex: 1;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  /* 显示可见的滚动拇指，但轨道透明 */\n  scrollbar-color: transparent transparent;\n  box-sizing: border-box;\n  min-height: 200px;\n  display: flex; /* 让子元素可以撑满高度 */\n  box-shadow: none !important; /* 移除阴影 */\n}\n\n/* 深色主题下 content-area 背景与内部一致 */\n[data-theme="dark"] .content-area[data-v-5e56b78d] {\n  background-color: #1E293B !important;\n}\n\n/* WebKit滚动条样式 */\n.content-area[data-v-5e56b78d]::-webkit-scrollbar {\n  width: 6px;\n  background: transparent;\n}\n.content-area[data-v-5e56b78d]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.content-area[data-v-5e56b78d]::-webkit-scrollbar-track-piece {\n  background: transparent;\n}\n.content-area[data-v-5e56b78d]::-webkit-scrollbar-thumb {\n  border-radius: 3px;\n  background-color: transparent;\n}\n\n/* 悬停时略微增强可见度 */\n.content-area[data-v-5e56b78d]:hover::-webkit-scrollbar-thumb {\n  background-color: transparent;\n}\n.content-area[data-v-5e56b78d]::-webkit-scrollbar-button {\n  display: none;\n}\n.content-area[data-v-5e56b78d]::-webkit-scrollbar-corner {\n  background: transparent;\n}\n\n\n/* AI处理状态指示器（生成时显示在顶部） */\n.ai-processing-indicator[data-v-5e56b78d] {\n  width: 100%;\n  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);\n  border: 1px solid rgba(99, 102, 241, 0.2);\n  border-radius: 8px;\n  padding: 12px 16px;\n  margin-bottom: 16px;\n  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);\n}\n\n/* 重置状态按钮 */\n.reset-state-btn[data-v-5e56b78d] {\n  padding: 6px;\n  font-size: 13px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  border: 1px solid transparent;\n  border-radius: 50%;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: auto; /* 推到右侧 */\n}\n.reset-state-btn[data-v-5e56b78d]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-danger);\n  border-color: var(--color-border-hover);\n  transform: translateY(-1px);\n}\n\n/* 流式状态元数据布局 */\n.streaming-meta[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  gap: 12px;\n}\n.streaming-indicator[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.streaming-dot[data-v-5e56b78d] {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  animation: pulse-5e56b78d 1.2s ease-in-out infinite;\n}\n.streaming-text[data-v-5e56b78d] {\n  font-weight: 500;\n}\n\n/* 等待动画样式 */\n.waiting-animation[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 60px 0; /* 增加一些垂直空间 */\n}\n.thinking-dots[data-v-5e56b78d] {\n  display: flex;\n  gap: 8px;\n}\n.thinking-dots .dot[data-v-5e56b78d] {\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background: var(--color-primary);\n  animation: thinking-5e56b78d 1.4s ease-in-out infinite;\n}\n.thinking-dots .dot[data-v-5e56b78d]:nth-child(1) {\n  animation-delay: 0s;\n}\n.thinking-dots .dot[data-v-5e56b78d]:nth-child(2) {\n  animation-delay: 0.2s;\n}\n.thinking-dots .dot[data-v-5e56b78d]:nth-child(3) {\n  animation-delay: 0.4s;\n}\n@keyframes thinking-5e56b78d {\n0%, 60%, 100% {\n    transform: scale(1);\n    opacity: 0.7;\n}\n30% {\n    transform: scale(1.3);\n    opacity: 1;\n}\n}\n\n/* .waiting-text is no longer used */\n@keyframes pulse-5e56b78d {\n0% { box-shadow: 0 0 0 0 currentColor; opacity: 0.8;\n}\n70% { box-shadow: 0 0 0 6px transparent; opacity: 1;\n}\n100% { box-shadow: 0 0 0 0 transparent; opacity: 0.8;\n}\n}\n\n/* 输入框右侧的流式传输选项样式 - 删除旧样式 */\n\n/* 输入框容器样式 */\n.input-container[data-v-5e56b78d] {\n  flex: 1;\n  position: relative;\n  display: flex;\n  align-items: stretch; /* 让内部元素垂直拉伸 */\n  border: 1px solid #d1d5db;\n  border-radius: 8px;\n  background: var(--color-surface);\n  transition: all 0.2s ease;\n  min-height: 32px; /* 减小最小高度以对应单行 */\n  max-width: 100%; /* 防止横向扩展 */\n  overflow: hidden; /* 确保内容不会溢出容器 */\n}\n.input-container[data-v-5e56b78d]:focus-within {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n.input-container[data-v-5e56b78d]:has(.game-input:disabled) {\n  background: #f9fafb;\n}\n\n/* 输入框内部的文本区域 */\n.input-container .game-input[data-v-5e56b78d] {\n  flex: 1;\n  border: none;\n  background: transparent;\n  padding: 8px 16px;\n  padding-right: 0; /* 右侧留给流式传输选项 */\n  outline: none;\n  box-shadow: none;\n  resize: none;\n  overflow-y: auto;\n  width: 100%; /* 确保宽度填满容器 */\n  min-height: 24px; /* 单行高度 */\n  max-height: 120px;\n  min-width: 0; /* 允许缩小 */\n  box-sizing: border-box;\n  word-wrap: break-word;\n  white-space: pre-wrap; /* 保持换行和空格 */\n  overflow-wrap: break-word;\n  /* 移除自动高度相关样式，用JS控制 */\n  height: auto;\n  line-height: 1.4;\n  /* 透明滚动条（Firefox） */\n  scrollbar-width: thin;\n  scrollbar-color: transparent transparent;\n}\n.input-container .game-input[data-v-5e56b78d]:focus {\n  border: none;\n  box-shadow: none;\n}\n\n/* 透明滚动条（WebKit） */\n.input-container .game-input[data-v-5e56b78d]::-webkit-scrollbar {\n  width: 6px;\n  background: transparent;\n}\n.input-container .game-input[data-v-5e56b78d]::-webkit-scrollbar-track,\n.input-container .game-input[data-v-5e56b78d]::-webkit-scrollbar-track-piece,\n.input-container .game-input[data-v-5e56b78d]::-webkit-scrollbar-corner {\n  background: transparent;\n}\n.input-container .game-input[data-v-5e56b78d]::-webkit-scrollbar-thumb {\n  border-radius: 3px;\n  background-color: transparent;\n}\n.input-container .game-input[data-v-5e56b78d]:hover::-webkit-scrollbar-thumb {\n  background-color: transparent;\n}\n\n/* 输入框内部的流式传输选项 */\n.stream-toggle-inside[data-v-5e56b78d] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 4px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n  padding: 4px 12px;\n  border-left: 1px solid #e5e7eb;\n  margin-left: 8px;\n  cursor: pointer;\n  user-select: none;\n  flex-shrink: 0;\n  align-self: stretch; /* 垂直拉伸以匹配容器高度 */\n  min-height: 32px; /* 减小最小高度以对应单行 */\n}\n.stream-toggle-inside[data-v-5e56b78d]:hover {\n  color: var(--color-text);\n}\n.stream-toggle-inside input[type="checkbox"][data-v-5e56b78d] {\n  width: 12px;\n  height: 12px;\n  cursor: pointer;\n}\n.stream-toggle-inside .label-text[data-v-5e56b78d] {\n  cursor: pointer;\n}\n\n/* 当前叙述显示区域 */\n/* .current-narrative 样式已合并到 line 1996 */\n.narrative-content[data-v-5e56b78d] {\n  line-height: 1.8;\n  color: var(--color-text);\n  font-size: 0.95rem;\n  background: var(--color-surface); /* 确保叙述内容区域背景一致 */\n}\n.action-options[data-v-5e56b78d] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-top: 16px;\n  padding-top: 16px;\n  border-top: 1px solid #e5e7eb;\n  margin-bottom: 16px;\n}\n.action-option-btn[data-v-5e56b78d] {\n  padding: 8px 16px;\n  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  transition: all 0.2s;\n  white-space: normal;\n  word-break: break-word;\n  max-width: 100%;\n  text-align: center;\n  flex: 0 1 auto;\n  min-width: 0;\n}\n.action-option-btn[data-v-5e56b78d]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n}\n\n/* 绘图按钮 */\n.header-action-btn.image-gen-btn[data-v-5e56b78d] {\n  background: transparent;\n  border: 1px solid var(--color-border);\n  color: var(--color-primary);\n  /* cursor: pointer; */\n  padding: 6px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  margin-right: 4px;\n}\n.header-action-btn.image-gen-btn[data-v-5e56b78d]:hover:not(:disabled) {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  transform: scale(1.1);\n  box-shadow: 0 0 10px rgba(var(--color-primary-rgb), 0.3);\n}\n.header-action-btn.image-gen-btn[data-v-5e56b78d]:disabled {\n  opacity: 0.6;\n  cursor: wait;\n}\n.narrative-meta[data-v-5e56b78d] {\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #f3f4f6;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.meta-buttons[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.header-action-btn.rollback-btn[data-v-5e56b78d] {\n  background: transparent;\n  border: 1px solid transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.header-action-btn.rollback-btn[data-v-5e56b78d]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-primary);\n}\n.narrative-time[data-v-5e56b78d] {\n  font-size: 0.8rem;\n  color: #6b7280;\n  font-weight: 500;\n}\n\n/* 变量更新按钮 */\n.variable-updates-toggle[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n  color: white;\n  border: none;\n  border-radius: 20px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n  position: relative;\n  overflow: hidden;\n}\n.variable-updates-toggle[data-v-5e56b78d]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s ease;\n}\n.variable-updates-toggle[data-v-5e56b78d]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);\n  background: linear-gradient(135deg, #2563eb, #1e40af);\n}\n.variable-updates-toggle[data-v-5e56b78d]:hover::before {\n  left: 100%;\n}\n.variable-updates-toggle.active[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #10b981, #059669);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-5e56b78d] {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-5e56b78d]:hover {\n  transform: none;\n  background: linear-gradient(135deg, #9ca3af, #6b7280);\n  box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);\n}\n.variable-updates-toggle.disabled[data-v-5e56b78d]::before {\n  display: none;\n}\n.update-count[data-v-5e56b78d] {\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n  font-size: 0.7rem;\n  font-weight: 700;\n  padding: 2px 6px;\n  border-radius: 10px;\n  min-width: 18px;\n  text-align: center;\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n/* 悬浮面板覆盖层 */\n.variable-updates-overlay[data-v-5e56b78d] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n  backdrop-filter: blur(4px);\n}\n\n/* 悬浮面板主体 */\n.variable-updates-modal[data-v-5e56b78d] {\n  background: var(--color-surface);\n  border-radius: 16px;\n  width: 100%;\n  max-width: 500px;\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  animation: modal-appear-5e56b78d 0.3s ease-out;\n}\n@keyframes modal-appear-5e56b78d {\nfrom {\n    opacity: 0;\n    transform: scale(0.9) translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n}\n}\n\n/* 悬浮面板动画 */\n.variable-updates-modal-enter-active[data-v-5e56b78d],\n.variable-updates-modal-leave-active[data-v-5e56b78d] {\n  transition: all 0.3s ease;\n}\n.variable-updates-modal-enter-from[data-v-5e56b78d] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n.variable-updates-modal-leave-to[data-v-5e56b78d] {\n  opacity: 0;\n  transform: scale(0.9) translateY(20px);\n}\n\n/* 悬浮面板头部 */\n.variable-updates-modal .updates-header[data-v-5e56b78d] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n  border-bottom: 1px solid var(--color-border);\n}\n.variable-updates-modal .updates-header h4[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-updates-btn[data-v-5e56b78d] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 6px;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-updates-btn[data-v-5e56b78d]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  transform: rotate(90deg);\n}\n\n/* 悬浮面板内容 */\n.variable-updates-modal .updates-content[data-v-5e56b78d] {\n  padding: 16px;\n  overflow-y: auto;\n  max-height: 60vh;\n}\n\n/* 移除重复的样式，让内部FormattedText组件处理 */\n.empty-narrative[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: #9ca3af;\n  font-style: italic;\n  font-size: 0.9rem;\n}\n\n/* 动作队列显示区域 */\n.action-queue-display[data-v-5e56b78d] {\n  margin-bottom: 12px;\n  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  padding: 12px;\n}\n.queue-header[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n.queue-title[data-v-5e56b78d] {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #6366f1;\n}\n.clear-queue-btn[data-v-5e56b78d] {\n  background: transparent;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.clear-queue-btn[data-v-5e56b78d]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n}\n.queue-actions[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  max-height: 150px;\n  overflow-y: auto;\n}\n.queue-action-item[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  background: rgba(99, 102, 241, 0.05);\n  border: 1px solid rgba(99, 102, 241, 0.1);\n  border-radius: 6px;\n  font-size: 0.85rem;\n}\n.action-text[data-v-5e56b78d] {\n  flex: 1;\n  color: #374151;\n  line-height: 1.4;\n  margin-right: 8px;\n}\n.action-controls[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  flex-shrink: 0;\n}\n.undo-indicator[data-v-5e56b78d] {\n  font-size: 12px;\n  opacity: 0.7;\n  animation: rotate-5e56b78d 2s linear infinite;\n}\n@keyframes rotate-5e56b78d {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.remove-action-btn[data-v-5e56b78d] {\n  background: transparent;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-size: 16px;\n  line-height: 1;\n  transition: all 0.2s ease;\n  flex-shrink: 0;\n}\n.remove-action-btn[data-v-5e56b78d]:hover {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n}\n.input-section[data-v-5e56b78d] {\n  padding: 16px 20px 20px 20px; /* 进一步增加底部内边距 */\n  border-top: 1px solid #e2e8f0;\n  background: #f8fafc;\n  box-sizing: border-box;\n  flex-shrink: 0;\n}\n.input-wrapper[data-v-5e56b78d] {\n  display: flex;\n  gap: 12px;\n  align-items: stretch; /* 改为stretch让所有元素高度一致 */\n  width: 100%;\n  max-width: none;\n}\n.game-input[data-v-5e56b78d] {\n  /* 这些样式现在由 .input-container 处理 */\n  font-size: 0.9rem;\n  line-height: 1.4;\n  color: #374151;\n  resize: none;\n  /* 移除固定高度，改为自动调整 */\n  /* min-height: 44px; */\n  /* max-height: 120px; */\n  font-family: inherit;\n  /* 移除过渡效果，避免高度调整时的闪烁 */\n  /* transition: all 0.2s ease; */\n}\n\n/* 移除原来的 focus 样式，现在由容器处理 */\n/* .game-input:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n} */\n.game-input[data-v-5e56b78d]:disabled {\n  /* background: #f9fafb; */\n  color: #9ca3af;\n  cursor: not-allowed;\n}\n.game-input[data-v-5e56b78d]::placeholder {\n  color: #9ca3af;\n}\n.send-button[data-v-5e56b78d] {\n  width: 42px;\n  background: linear-gradient(135deg, #3b82f6, #2563eb);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  flex-shrink: 0;\n  min-height: 32px;\n  align-self: stretch;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 2px 6px rgba(59, 130, 246, 0.25);\n  margin-left: 8px;\n}\n.send-button[data-v-5e56b78d]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);\n}\n.send-button[data-v-5e56b78d]:disabled {\n  background: #d1d5db;\n  color: #9ca3af;\n  cursor: not-allowed;\n  transform: none;\n  box-shadow: none;\n}\n.animate-spin[data-v-5e56b78d] {\n  animation: spin-5e56b78d 1s linear infinite;\n}\n@keyframes spin-5e56b78d {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 深色主题 */\n[data-theme="dark"] .main-game-panel[data-v-5e56b78d] {\n  background: var(--color-background);\n}\n\n/* 叙述内容深色主题 */\n[data-theme="dark"] .narrative-content[data-v-5e56b78d] {\n  background: var(--color-background);\n  color: #e2e8f0;\n}\n[data-theme="dark"] .narrative-meta[data-v-5e56b78d] {\n  border-bottom-color: #374151;\n}\n[data-theme="dark"] .narrative-time[data-v-5e56b78d] {\n  color: #94a3b8;\n}\n\n/* 深色主题 - 变量更新按钮 */\n[data-theme="dark"] .variable-updates-toggle[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #3b82f6, #1e3a8a);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle[data-v-5e56b78d]:hover {\n  background: linear-gradient(135deg, #2563eb, #1e40af);\n  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.5);\n}\n[data-theme="dark"] .variable-updates-toggle.active[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #10b981, #065f46);\n  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle.active[data-v-5e56b78d]:hover {\n  background: linear-gradient(135deg, #059669, #047857);\n  box-shadow: 0 4px 16px rgba(16, 185, 129, 0.5);\n}\n[data-theme="dark"] .variable-updates-toggle.disabled[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #4b5563, #374151);\n  box-shadow: 0 2px 8px rgba(75, 85, 99, 0.4);\n}\n[data-theme="dark"] .variable-updates-toggle.disabled[data-v-5e56b78d]:hover {\n  background: linear-gradient(135deg, #4b5563, #374151);\n  box-shadow: 0 2px 8px rgba(75, 85, 99, 0.4);\n}\n[data-theme="dark"] .variable-updates-overlay[data-v-5e56b78d] {\n  background: rgba(0, 0, 0, 0.7);\n}\n[data-theme="dark"] .variable-updates-modal[data-v-5e56b78d] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .variable-updates-modal .updates-header[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #334155 0%, #475569 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .variable-updates-modal .updates-header h4[data-v-5e56b78d] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .close-updates-btn[data-v-5e56b78d] {\n  color: #94a3b8;\n}\n[data-theme="dark"] .close-updates-btn[data-v-5e56b78d]:hover {\n  background: #475569;\n  color: #e2e8f0;\n}\n[data-theme="dark"] .empty-narrative[data-v-5e56b78d] {\n  color: #6b7280;\n}\n\n/* 确保深色主题下当前叙述区域背景一致 */\n[data-theme="dark"] .current-narrative[data-v-5e56b78d] {\n  background-color: #1E293B !important;\n}\n\n/* 深色主题 - 流式输出内容 */\n[data-theme="dark"] .streaming-narrative-content[data-v-5e56b78d] {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n}\n[data-theme="dark"] .streaming-text[data-v-5e56b78d] {\n  color: #e2e8f0;\n}\n[data-theme="dark"] .ai-processing-display[data-v-5e56b78d] {\n  background: var(--color-background) !important;\n}\n[data-theme="dark"] .reset-state-btn[data-v-5e56b78d] {\n  background: rgba(var(--color-error-rgb), 0.2);\n  color: var(--color-danger);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n}\n[data-theme="dark"] .reset-state-btn[data-v-5e56b78d]:hover {\n  background: rgba(var(--color-error-rgb), 0.3);\n  border-color: rgba(var(--color-error-rgb), 0.5);\n}\n[data-theme="dark"] .narrative-content[data-v-5e56b78d] {\n  background: #1E293B !important;\n}\n[data-theme="dark"] .input-section[data-v-5e56b78d] {\n  background: #334155;\n  border-top-color: #475569;\n}\n[data-theme="dark"] .game-input[data-v-5e56b78d] {\n  /* background: #1e293b; - 现在由容器处理 */\n  /* border-color: #475569; - 现在由容器处理 */\n  color: #e2e8f0;\n}\n\n/* 移除重复的深色主题 focus 样式 */\n/* [data-theme="dark"] .game-input:focus {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);\n} */\n[data-theme="dark"] .game-input[data-v-5e56b78d]:disabled {\n  /* background: #0f172a; - 现在由容器处理 */\n  color: #64748b;\n}\n[data-theme="dark"] .game-input[data-v-5e56b78d]::placeholder {\n  color: #64748b;\n}\n[data-theme="dark"] .send-button[data-v-5e56b78d] {\n  background: #3b82f6;\n}\n[data-theme="dark"] .send-button[data-v-5e56b78d]:hover:not(:disabled) {\n  background: #2563eb;\n}\n[data-theme="dark"] .send-button[data-v-5e56b78d]:disabled {\n  background: #374151;\n  color: #64748b;\n}\n\n/* 短期记忆深色主题 */\n[data-theme="dark"] .memory-section[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n  border-color: #475569;\n}\n[data-theme="dark"] .memory-header[data-v-5e56b78d]:hover {\n  background: rgba(99, 102, 241, 0.1);\n}\n[data-theme="dark"] .memory-title[data-v-5e56b78d] {\n  color: #818cf8;\n}\n[data-theme="dark"] .memory-icon[data-v-5e56b78d] {\n  color: #64748b;\n}\n[data-theme="dark"] .memory-dropdown[data-v-5e56b78d] {\n  background: #1e293b;\n  border-color: #475569;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n}\n[data-theme="dark"] .memory-item[data-v-5e56b78d] {\n  background: rgba(129, 140, 248, 0.1);\n  border-left-color: #818cf8;\n  color: #e2e8f0;\n}\n\n/* 等待覆盖层深色主题 - 更新为AI处理显示样式 */\n[data-theme="dark"] .streaming-meta[data-v-5e56b78d] {\n  border-bottom-color: #374151;\n}\n[data-theme="dark"] .streaming-indicator[data-v-5e56b78d] {\n  color: #60a5fa;\n}\n[data-theme="dark"] .streaming-dot[data-v-5e56b78d] {\n  background: #60a5fa;\n}\n[data-theme="dark"] .thinking-dots .dot[data-v-5e56b78d] {\n  background: #60a5fa;\n}\n[data-theme="dark"] .waiting-text[data-v-5e56b78d] {\n  color: #94a3b8;\n}\n\n/* 输入框右侧流式传输选项深色主题 - 更新为内部样式 */\n[data-theme="dark"] .input-container[data-v-5e56b78d] {\n  background: #1e293b;\n  border-color: #475569;\n}\n[data-theme="dark"] .input-container[data-v-5e56b78d]:focus-within {\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);\n}\n[data-theme="dark"] .input-container[data-v-5e56b78d]:has(.game-input:disabled) {\n  background: #0f172a;\n}\n[data-theme="dark"] .stream-toggle-inside[data-v-5e56b78d] {\n  color: #94a3b8;\n  border-left-color: #475569;\n}\n[data-theme="dark"] .stream-toggle-inside[data-v-5e56b78d]:hover {\n  color: #e2e8f0;\n}\n\n/* 行动选择器按钮 */\n.action-selector-btn[data-v-5e56b78d] {\n  width: 44px;\n  min-height: 32px; /* 减小最小高度以匹配输入框 */\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #6366f1;\n  align-self: stretch; /* 垂直拉伸以匹配容器高度 */\n  flex-shrink: 0;\n}\n.action-selector-btn[data-v-5e56b78d]:hover:not(:disabled) {\n  background: #f1f5f9;\n  border-color: #6366f1;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\n}\n.action-selector-btn[data-v-5e56b78d]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n/* 行动选择弹窗 */\n.action-modal-overlay[data-v-5e56b78d],\n.action-config-overlay[data-v-5e56b78d] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(2px);\n}\n.action-modal[data-v-5e56b78d] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 480px;\n  width: 90%;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n}\n.action-config-modal[data-v-5e56b78d] {\n  background: var(--color-surface);\n  border-radius: 12px;\n  max-width: 400px;\n  width: 90%;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n}\n.modal-header[data-v-5e56b78d],\n.config-header[data-v-5e56b78d] {\n  padding: 16px 20px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: var(--color-primary, #3b82f6);\n}\n.modal-header h3[data-v-5e56b78d],\n.config-header h3[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: white;\n}\n.close-btn[data-v-5e56b78d] {\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: white;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-5e56b78d]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n}\n.action-grid[data-v-5e56b78d] {\n  padding: 16px;\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n}\n.quick-action-btn[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 6px;\n  padding: 12px 8px;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  background: var(--color-surface);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.8rem;\n  min-height: 70px;\n}\n.quick-action-btn[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n  background: #f8fafc;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.quick-action-btn.cultivation[data-v-5e56b78d] {\n  border-color: rgba(34, 197, 94, 0.2);\n  background: rgba(34, 197, 94, 0.03);\n}\n.quick-action-btn.cultivation[data-v-5e56b78d]:hover {\n  border-color: #22c55e;\n  background: rgba(34, 197, 94, 0.08);\n}\n.quick-action-btn.exploration[data-v-5e56b78d] {\n  border-color: rgba(59, 130, 246, 0.2);\n  background: rgba(59, 130, 246, 0.03);\n}\n.quick-action-btn.exploration[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n  background: rgba(59, 130, 246, 0.08);\n}\n.quick-action-btn.social[data-v-5e56b78d] {\n  border-color: rgba(20, 184, 166, 0.2);\n  background: rgba(20, 184, 166, 0.03);\n}\n.quick-action-btn.social[data-v-5e56b78d]:hover {\n  border-color: #14b8a6;\n  background: rgba(20, 184, 166, 0.08);\n}\n.quick-action-btn.other[data-v-5e56b78d] {\n  border-color: rgba(156, 163, 175, 0.2);\n  background: rgba(156, 163, 175, 0.03);\n}\n.quick-action-btn.other[data-v-5e56b78d]:hover {\n  border-color: #9ca3af;\n  background: rgba(156, 163, 175, 0.08);\n}\n.action-icon[data-v-5e56b78d] {\n  font-size: 1.2rem;\n  line-height: 1;\n}\n.action-text[data-v-5e56b78d] {\n  font-weight: 500;\n  color: #374151;\n  text-align: center;\n  line-height: 1.2;\n}\n\n/* 配置弹窗内容 */\n.config-content[data-v-5e56b78d] {\n  padding: 20px;\n}\n.action-description[data-v-5e56b78d] {\n  margin: 0 0 20px 0;\n  color: #6b7280;\n  line-height: 1.5;\n}\n.config-section[data-v-5e56b78d] {\n  margin-bottom: 20px;\n}\n.config-section[data-v-5e56b78d]:last-child {\n  margin-bottom: 0;\n}\n.config-label[data-v-5e56b78d] {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #374151;\n  font-size: 0.875rem;\n}\n.time-selector[data-v-5e56b78d] {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n}\n.time-btn[data-v-5e56b78d] {\n  padding: 8px 16px;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  background: var(--color-surface);\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s ease;\n}\n.time-btn[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n}\n.time-btn.active[data-v-5e56b78d] {\n  border-color: #3b82f6;\n  background: #3b82f6;\n  color: white;\n}\n.time-custom[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 0.875rem;\n}\n.time-input[data-v-5e56b78d] {\n  width: 80px;\n  padding: 6px 10px;\n  border: 1px solid #d1d5db;\n  border-radius: 4px;\n  font-size: 0.875rem;\n}\n.action-options[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.option-item[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-item[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n  background: #f8fafc;\n}\n.option-item input[type="radio"][data-v-5e56b78d] {\n  margin: 0;\n}\n.config-actions[data-v-5e56b78d] {\n  padding: 20px;\n  border-top: 1px solid #e5e7eb;\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n}\n.cancel-btn[data-v-5e56b78d],\n.confirm-btn[data-v-5e56b78d] {\n  padding: 8px 20px;\n  border-radius: 6px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.cancel-btn[data-v-5e56b78d] {\n  border: 1px solid #d1d5db;\n  background: var(--color-surface);\n  color: #6b7280;\n}\n.cancel-btn[data-v-5e56b78d]:hover {\n  background: #f9fafb;\n  border-color: #9ca3af;\n}\n.confirm-btn[data-v-5e56b78d] {\n  border: 1px solid #3b82f6;\n  background: #3b82f6;\n  color: white;\n}\n.confirm-btn[data-v-5e56b78d]:hover {\n  background: #2563eb;\n  border-color: #2563eb;\n}\n\n/* 深色主题适配 */\n[data-theme="dark"] .action-selector-btn[data-v-5e56b78d] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .action-selector-btn[data-v-5e56b78d]:hover:not(:disabled) {\n  background: #4b5563;\n  border-color: #6b7280;\n}\n[data-theme="dark"] .action-modal[data-v-5e56b78d],\n[data-theme="dark"] .action-config-modal[data-v-5e56b78d] {\n  background: #1f2937;\n}\n[data-theme="dark"] .modal-header[data-v-5e56b78d],\n[data-theme="dark"] .config-header[data-v-5e56b78d],\n[data-theme="dark"] .config-actions[data-v-5e56b78d] {\n  border-color: #374151;\n}\n[data-theme="dark"] .modal-header h3[data-v-5e56b78d],\n[data-theme="dark"] .config-header h3[data-v-5e56b78d],\n[data-theme="dark"] .category-title[data-v-5e56b78d],\n[data-theme="dark"] .config-label[data-v-5e56b78d],\n[data-theme="dark"] .action-name[data-v-5e56b78d] {\n  color: #f9fafb;\n}\n[data-theme="dark"] .close-btn[data-v-5e56b78d] {\n  background: #374151;\n  color: #d1d5db;\n}\n[data-theme="dark"] .close-btn[data-v-5e56b78d]:hover {\n  background: #4b5563;\n  color: #f9fafb;\n}\n[data-theme="dark"] .action-btn[data-v-5e56b78d] {\n  background: #374151;\n  border-color: #4b5563;\n}\n[data-theme="dark"] .action-btn[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n  background: #1f2937;\n}\n[data-theme="dark"] .time-btn[data-v-5e56b78d],\n[data-theme="dark"] .option-item[data-v-5e56b78d] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .time-input[data-v-5e56b78d] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #f9fafb;\n}\n[data-theme="dark"] .cancel-btn[data-v-5e56b78d] {\n  background: #374151;\n  border-color: #4b5563;\n  color: #d1d5db;\n}\n[data-theme="dark"] .cancel-btn[data-v-5e56b78d]:hover {\n  background: #4b5563;\n}\n\n/* 深色主题动作队列样式 */\n[data-theme="dark"] .action-queue-display[data-v-5e56b78d] {\n  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);\n  border-color: #4b5563;\n}\n[data-theme="dark"] .queue-title[data-v-5e56b78d] {\n  color: #818cf8;\n}\n[data-theme="dark"] .clear-queue-btn[data-v-5e56b78d] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .clear-queue-btn[data-v-5e56b78d]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n[data-theme="dark"] .queue-action-item[data-v-5e56b78d] {\n  background: rgba(129, 140, 248, 0.1);\n  border-color: rgba(129, 140, 248, 0.2);\n}\n[data-theme="dark"] .action-text[data-v-5e56b78d] {\n  color: #e5e7eb;\n}\n[data-theme="dark"] .remove-action-btn[data-v-5e56b78d] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .remove-action-btn[data-v-5e56b78d]:hover {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n[data-theme="dark"] .action-controls[data-v-5e56b78d] {\n  color: #d1d5db;\n}\n[data-theme="dark"] .undo-indicator[data-v-5e56b78d] {\n  filter: brightness(1.2);\n}\n\n/* 变更描述样式 */\n.change-description[data-v-5e56b78d] {\n  color: var(--color-text);\n  font-size: 0.8rem;\n  margin-bottom: 6px;\n  padding: 4px 8px;\n  background: var(--color-surface-light);\n  border-radius: 4px;\n  border-left: 2px solid var(--color-primary);\n  line-height: 1.3;\n  font-style: italic;\n}\n\n/* 深色主题下的变更描述 */\n[data-theme="dark"] .change-description[data-v-5e56b78d] {\n  background: #334155;\n  color: #e2e8f0;\n  border-left-color: #60a5fa;\n}\n\n/* 空状态样式 */\n.no-changes[data-v-5e56b78d] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: var(--color-text-secondary);\n}\n.no-changes .empty-icon[data-v-5e56b78d] {\n  opacity: 0.5;\n  margin-bottom: 1rem;\n  color: var(--color-text-secondary);\n}\n.no-changes .empty-text[data-v-5e56b78d] {\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.no-changes .empty-hint[data-v-5e56b78d] {\n  font-size: 0.8rem;\n  opacity: 0.8;\n  line-height: 1.4;\n}\n\n/* 图片预览容器样式 */\n.image-preview-container[data-v-5e56b78d] {\n  display: flex;\n  gap: 8px;\n  padding: 8px;\n  flex-wrap: wrap;\n  border-bottom: 1px solid #e5e7eb;\n  background: #f9fafb;\n}\n.image-preview-item[data-v-5e56b78d] {\n  position: relative;\n  width: 60px;\n  height: 60px;\n  border-radius: 6px;\n  overflow: hidden;\n  border: 2px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n.image-preview-item[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n  transform: scale(1.05);\n}\n.image-preview-item img[data-v-5e56b78d] {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.remove-image-btn[data-v-5e56b78d] {\n  position: absolute;\n  top: 2px;\n  right: 2px;\n  width: 20px;\n  height: 20px;\n  padding: 0;\n  background: rgba(239, 68, 68, 0.9);\n  border: none;\n  border-radius: 50%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: all 0.2s ease;\n}\n.image-preview-item:hover .remove-image-btn[data-v-5e56b78d] {\n  opacity: 1;\n}\n.remove-image-btn[data-v-5e56b78d]:hover {\n  background: rgba(220, 38, 38, 1);\n  transform: scale(1.1);\n}\n\n/* 图片上传按钮特殊样式 */\n.image-upload-btn svg[data-v-5e56b78d] {\n  color: #10b981;\n}\n.image-upload-btn:hover:not(:disabled) svg[data-v-5e56b78d] {\n  color: #059669;\n}\n\n/* 深色主题图片预览样式 */\n[data-theme="dark"] .image-preview-container[data-v-5e56b78d] {\n  background: #0f172a;\n  border-bottom-color: #475569;\n}\n[data-theme="dark"] .image-preview-item[data-v-5e56b78d] {\n  border-color: #475569;\n}\n[data-theme="dark"] .image-preview-item[data-v-5e56b78d]:hover {\n  border-color: #3b82f6;\n}\n\n/* 最新消息text样式 */\n.latest-message-text[data-v-5e56b78d] {\n  margin-top: 20px;\n  padding: 16px;\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-left: 4px solid #818cf8;\n  border-radius: 8px;\n  font-size: 0.9rem;\n  color: #475569;\n  line-height: 1.7;\n}\n.latest-text-header[data-v-5e56b78d] {\n  font-weight: 600;\n  color: #6366f1;\n  margin-bottom: 8px;\n  font-size: 0.85rem;\n}\n[data-theme="dark"] .latest-message-text[data-v-5e56b78d] {\n  background: #334155;\n  border-color: #4b5563;\n  border-left-color: #818cf8;\n  color: #cbd5e1;\n}\n[data-theme="dark"] .latest-text-header[data-v-5e56b78d] {\n  color: #a5b4fc;\n}\n\n/* Cultivation Panel */\n.cultivation-panel-overlay[data-v-5e56b78d] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1001; /* Higher than action modal */\n  backdrop-filter: blur(4px);\n}\n.cultivation-panel[data-v-5e56b78d] {\n  background: linear-gradient(145deg, #f9fafb, #f3f4f6);\n  border-radius: 16px;\n  width: 90%;\n  max-width: 800px;\n  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  display: flex;\n  flex-direction: column;\n  animation: modal-appear-5e56b78d 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n}\n.cultivation-panel .panel-header[data-v-5e56b78d] {\n  padding: 16px 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.cultivation-panel .panel-header h3[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: #1f2937;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.cultivation-panel .panel-content[data-v-5e56b78d] {\n  padding: 24px;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 24px;\n}\n.cultivation-card[data-v-5e56b78d] {\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  border: 1px solid #e5e7eb;\n  display: flex;\n  flex-direction: column;\n  transition: all 0.3s ease;\n  position: relative;\n  overflow: hidden;\n}\n.cultivation-card[data-v-5e56b78d]:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);\n  border-color: #a5b4fc;\n}\n.cultivation-card .card-header[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 12px;\n}\n.cultivation-card .card-icon[data-v-5e56b78d] {\n  color: #6366f1;\n}\n.cultivation-zap .card-icon[data-v-5e56b78d] { color: #f59e0b;\n}\n.cultivation-shield .card-icon[data-v-5e56b78d] { color: #3b82f6;\n}\n.cultivation-braincircuit .card-icon[data-v-5e56b78d] { color: #8b5cf6;\n}\n.cultivation-card .card-title[data-v-5e56b78d] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #111827;\n}\n.cultivation-card .card-description[data-v-5e56b78d] {\n  font-size: 0.85rem;\n  color: #4b5563;\n  line-height: 1.6;\n  flex-grow: 1;\n  margin: 0 0 16px 0;\n}\n.cultivation-card .card-config[data-v-5e56b78d] {\n  margin-bottom: 16px;\n}\n.cultivation-card .config-label[data-v-5e56b78d] {\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: #6b7280;\n  margin-bottom: 8px;\n  display: block;\n}\n.cultivation-card .time-selector[data-v-5e56b78d] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.cultivation-card .time-slider[data-v-5e56b78d] {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 100%;\n  height: 6px;\n  background: #e5e7eb;\n  border-radius: 3px;\n  outline: none;\n  opacity: 0.7;\n  transition: opacity .2s;\n}\n.cultivation-card .time-slider[data-v-5e56b78d]:hover {\n  opacity: 1;\n}\n.cultivation-card .time-slider[data-v-5e56b78d]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  background: #6366f1;\n  cursor: pointer;\n  border-radius: 50%;\n}\n.cultivation-card .time-slider[data-v-5e56b78d]::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  background: #6366f1;\n  cursor: pointer;\n  border-radius: 50%;\n}\n.cultivation-card .time-display[data-v-5e56b78d] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #1f2937;\n  min-width: 50px;\n  text-align: right;\n}\n.start-cultivation-btn[data-v-5e56b78d] {\n  width: 100%;\n  padding: 10px;\n  border: none;\n  border-radius: 8px;\n  background: #4f46e5;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.start-cultivation-btn[data-v-5e56b78d]:hover {\n  background: #4338ca;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);\n}\n.cultivation-zap .start-cultivation-btn[data-v-5e56b78d] { background: #f59e0b;\n}\n.cultivation-zap .start-cultivation-btn[data-v-5e56b78d]:hover { background: #d97706; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);\n}\n.cultivation-shield .start-cultivation-btn[data-v-5e56b78d] { background: #3b82f6;\n}\n.cultivation-shield .start-cultivation-btn[data-v-5e56b78d]:hover { background: #2563eb; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);\n}\n.cultivation-braincircuit .start-cultivation-btn[data-v-5e56b78d] { background: #8b5cf6;\n}\n.cultivation-braincircuit .start-cultivation-btn[data-v-5e56b78d]:hover { background: #7c3aed; box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3);\n}\n\n/* Dark theme for cultivation panel */\n[data-theme="dark"] .cultivation-panel[data-v-5e56b78d] {\n  background: linear-gradient(145deg, #1f2937, #111827);\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-panel .panel-header[data-v-5e56b78d] {\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-panel .panel-header h3[data-v-5e56b78d] {\n  color: #f3f4f6;\n}\n[data-theme="dark"] .cultivation-card[data-v-5e56b78d] {\n  background: #1f2937;\n  border-color: #374151;\n}\n[data-theme="dark"] .cultivation-card[data-v-5e56b78d]:hover {\n  border-color: #a5b4fc;\n}\n[data-theme="dark"] .cultivation-card .card-title[data-v-5e56b78d] {\n  color: #f9fafb;\n}\n[data-theme="dark"] .cultivation-card .card-description[data-v-5e56b78d] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .cultivation-card .config-label[data-v-5e56b78d] {\n  color: #9ca3af;\n}\n[data-theme="dark"] .cultivation-card .time-slider[data-v-5e56b78d] {\n  background: #4b5563;\n}\n[data-theme="dark"] .cultivation-card .time-display[data-v-5e56b78d] {\n  color: #f3f4f6;\n}\n\n\n/* 手机端响应式修复 */\n@media (max-width: 768px) {\n.main-game-panel[data-v-5e56b78d] {\n    width: 100%;\n    max-width: 100vw;\n    overflow-x: hidden;\n}\n.content-area[data-v-5e56b78d] {\n    padding: 4px;\n    overflow-x: hidden;\n    width: 100%;\n    box-sizing: border-box;\n}\n.current-narrative[data-v-5e56b78d] {\n    min-width: 0;\n    max-width: 100%;\n    overflow-x: hidden;\n    width: 100%;\n}\n.streaming-narrative-content[data-v-5e56b78d],\n  .narrative-content[data-v-5e56b78d] {\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    max-width: 100%;\n    padding: 8px;\n}\n.streaming-text[data-v-5e56b78d],\n  .narrative-text[data-v-5e56b78d] {\n    max-width: 100%;\n    overflow-x: hidden;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    font-size: 0.85rem;\n}\n.input-wrapper[data-v-5e56b78d] {\n    gap: 4px;\n    padding: 4px;\n    width: 100%;\n    box-sizing: border-box;\n}\n.input-container[data-v-5e56b78d] {\n    min-width: 0;\n    flex: 1;\n}\n.game-input[data-v-5e56b78d] {\n    font-size: 0.85rem;\n    padding: 6px 8px;\n}\n.send-button[data-v-5e56b78d] {\n    padding: 8px 12px;\n    flex-shrink: 0;\n    min-width: 44px;\n}\n.stream-toggle-inside[data-v-5e56b78d] {\n    font-size: 0.75rem;\n    padding: 0 6px;\n}\n}\n',""]);const s=i},7426:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.dao-panel[data-v-31dbed5e] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n}\n\n/* 顶部统计区 */\n.dao-stats-header[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  background: var(--color-background);\n  border-bottom: 1px solid var(--color-border);\n  border-radius: 12px 12px 0 0;\n}\n.stats-card[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 8px 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  min-width: 100px;\n}\n.stats-icon[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border-radius: 8px;\n}\n.stats-icon.enlightened[data-v-31dbed5e] {\n  background: linear-gradient(135deg, rgba(130, 163, 245, 0.2), rgba(192, 202, 245, 0.2));\n  color: var(--color-primary);\n}\n.stats-icon.experience[data-v-31dbed5e] {\n  background: linear-gradient(135deg, rgba(255, 213, 0, 0.2), rgba(255, 179, 0, 0.2));\n  color: var(--color-warning);\n}\n.stats-info[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n.stats-value[data-v-31dbed5e] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: var(--color-text);\n  line-height: 1.2;\n}\n.stats-label[data-v-31dbed5e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.stats-actions[data-v-31dbed5e] {\n  display: flex;\n  gap: 6px;\n  margin-left: auto;\n}\n.action-btn-icon[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 34px;\n  height: 34px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn-icon[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.1);\n}\n\n/* 筛选和排序栏 */\n.dao-filter-bar[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 10px 12px;\n  background: var(--color-surface);\n  border-radius: 10px;\n  margin-bottom: 12px;\n  flex-wrap: wrap;\n}\n.filter-tags[data-v-31dbed5e] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.filter-tag[data-v-31dbed5e] {\n  display: inline-flex;\n  align-items: center;\n  gap: 5px;\n  padding: 6px 10px;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.filter-tag[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.filter-tag.active[data-v-31dbed5e] {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.tag-count[data-v-31dbed5e] {\n  font-size: 0.65rem;\n  padding: 1px 5px;\n  background: rgba(var(--color-primary-rgb), 0.15);\n  border-radius: 8px;\n  font-weight: 600;\n}\n.sort-dropdown[data-v-31dbed5e] {\n  flex-shrink: 0;\n}\n.sort-select[data-v-31dbed5e] {\n  padding: 6px 10px;\n  font-size: 0.75rem;\n  color: var(--color-text);\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  outline: none;\n  transition: all 0.2s;\n}\n.sort-select[data-v-31dbed5e]:hover,\n.sort-select[data-v-31dbed5e]:focus {\n  border-color: var(--color-primary);\n}\n\n/* 空状态插图 */\n.empty-illustration[data-v-31dbed5e] {\n  position: relative;\n  width: 120px;\n  height: 120px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.empty-icon-wrapper[data-v-31dbed5e] {\n  position: relative;\n  z-index: 2;\n  color: var(--color-primary);\n  opacity: 0.6;\n}\n.empty-rings[data-v-31dbed5e] {\n  position: absolute;\n  inset: 0;\n}\n.ring[data-v-31dbed5e] {\n  position: absolute;\n  border: 1px solid var(--color-border);\n  border-radius: 50%;\n  opacity: 0.4;\n}\n.ring-1[data-v-31dbed5e] {\n  inset: 20%;\n}\n.ring-2[data-v-31dbed5e] {\n  inset: 10%;\n}\n.ring-3[data-v-31dbed5e] {\n  inset: 0;\n}\n.empty-title[data-v-31dbed5e] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.empty-desc[data-v-31dbed5e] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  text-align: center;\n  max-width: 350px;\n}\n\n/* 大道卡片 */\n.dao-card[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 12px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n.dao-card[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n}\n.dao-card.active[data-v-31dbed5e] {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.dao-card-header[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n.dao-icon[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, rgba(130, 163, 245, 0.15), rgba(192, 202, 245, 0.15));\n  border-radius: 8px;\n  color: var(--color-primary);\n}\n.dao-title-group[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex: 1;\n}\n.dao-card-body[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n.dao-progress-wrapper[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.dao-progress-bar[data-v-31dbed5e] {\n  flex: 1;\n  height: 6px;\n  background: var(--color-border);\n  border-radius: 3px;\n  overflow: hidden;\n  position: relative;\n}\n.dao-progress-fill[data-v-31dbed5e] {\n  height: 100%;\n  background: linear-gradient(90deg, var(--color-primary), var(--color-info));\n  border-radius: 3px;\n  transition: width 0.3s ease;\n}\n.dao-progress-glow[data-v-31dbed5e] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);\n  animation: glow-sweep-31dbed5e 2s infinite;\n}\n@keyframes glow-sweep-31dbed5e {\n0% { transform: translateX(-100%);\n}\n100% { transform: translateX(100%);\n}\n}\n.dao-progress-text[data-v-31dbed5e] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n  min-width: 36px;\n  text-align: right;\n}\n.dao-exp-info[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-size: 0.75rem;\n}\n.exp-current[data-v-31dbed5e] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.exp-divider[data-v-31dbed5e] {\n  color: var(--color-text-muted);\n}\n.exp-required[data-v-31dbed5e] {\n  color: var(--color-text-secondary);\n}\n.dao-card-actions[data-v-31dbed5e] {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  display: flex;\n  gap: 4px;\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n.dao-card:hover .dao-card-actions[data-v-31dbed5e] {\n  opacity: 1;\n}\n.dao-action-btn[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 26px;\n  height: 26px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.dao-action-btn[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.dao-action-btn.cultivate[data-v-31dbed5e]:hover {\n  border-color: var(--color-warning);\n  color: var(--color-warning);\n}\n.dao-action-btn.breakthrough[data-v-31dbed5e] {\n  border-color: #f59e0b;\n  color: #f59e0b;\n}\n.dao-action-btn.breakthrough[data-v-31dbed5e]:hover {\n  background: #f59e0b;\n  color: white;\n}\n\n/* 阶段徽章 */\n.dao-stage-badge[data-v-31dbed5e] {\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 0.7rem;\n  font-weight: 500;\n}\n.dao-stage-badge.stage-low[data-v-31dbed5e] {\n  background: rgba(var(--color-info-rgb), 0.15);\n  color: var(--color-info);\n}\n.dao-stage-badge.stage-mid[data-v-31dbed5e] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.dao-stage-badge.stage-high[data-v-31dbed5e] {\n  background: rgba(var(--color-warning-rgb), 0.15);\n  color: var(--color-warning);\n}\n.dao-stage-badge.stage-max[data-v-31dbed5e] {\n  background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.2));\n  color: #ffa500;\n}\n\n/* 详情面板 */\n.dao-detail-panel[data-v-31dbed5e] {\n  margin-top: 12px;\n  padding: 16px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n}\n.detail-title-group[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.detail-icon[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 44px;\n  height: 44px;\n  background: linear-gradient(135deg, rgba(130, 163, 245, 0.2), rgba(192, 202, 245, 0.2));\n  border-radius: 10px;\n  color: var(--color-primary);\n}\n.detail-title[data-v-31dbed5e] {\n  margin: 0;\n  font-size: 1.1rem;\n  color: var(--color-text);\n}\n.detail-stage[data-v-31dbed5e] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.detail-body[data-v-31dbed5e] {\n  margin-top: 16px;\n}\n.detail-stats-grid[data-v-31dbed5e] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n  margin-bottom: 16px;\n}\n.detail-stat-card[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: var(--color-background);\n  border-radius: 8px;\n}\n.stat-card-icon[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 6px;\n  color: var(--color-primary);\n}\n.stat-card-icon.progress-icon[data-v-31dbed5e] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  color: var(--color-success);\n}\n.stat-card-content[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n.stat-card-value[data-v-31dbed5e] {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.stat-card-label[data-v-31dbed5e] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n\n/* 阶段进度区 */\n.stage-progress-section[data-v-31dbed5e] {\n  margin-bottom: 16px;\n}\n.section-title[data-v-31dbed5e] {\n  margin: 0 0 10px 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.stage-timeline[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.stage-node[data-v-31dbed5e] {\n  display: flex;\n  align-items: flex-start;\n  gap: 10px;\n  padding: 8px 10px;\n  background: var(--color-background);\n  border-radius: 8px;\n  border-left: 3px solid var(--color-border);\n}\n.stage-node.done[data-v-31dbed5e] {\n  border-left-color: var(--color-success);\n}\n.stage-node.current[data-v-31dbed5e] {\n  border-left-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n.stage-node.locked[data-v-31dbed5e] {\n  opacity: 0.5;\n}\n.node-marker[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 22px;\n  height: 22px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n.stage-node.done .node-marker[data-v-31dbed5e] {\n  background: var(--color-success);\n  border-color: var(--color-success);\n  color: white;\n}\n.stage-node.current .node-marker[data-v-31dbed5e] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.node-number[data-v-31dbed5e] {\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.node-content[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n.node-name[data-v-31dbed5e] {\n  font-size: 0.85rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.node-desc[data-v-31dbed5e] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* 突破指引 */\n.breakthrough-guide[data-v-31dbed5e] {\n  margin-bottom: 16px;\n  padding: 14px;\n  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.05));\n  border: 1px solid rgba(245, 158, 11, 0.3);\n  border-radius: 10px;\n  border-left: 4px solid #f59e0b;\n}\n.guide-header[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 10px;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #f59e0b;\n}\n.guide-content[data-v-31dbed5e] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.guide-desc[data-v-31dbed5e] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.guide-tips[data-v-31dbed5e] {\n  margin: 0;\n  padding-left: 20px;\n  list-style: disc;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n}\n.guide-tips li[data-v-31dbed5e] {\n  margin-bottom: 4px;\n}\n.breakthrough-chance[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: rgba(245, 158, 11, 0.1);\n  border-radius: 8px;\n  margin-top: 6px;\n}\n.chance-label[data-v-31dbed5e] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.chance-value[data-v-31dbed5e] {\n  font-size: 1.1rem;\n  font-weight: 700;\n  color: #f59e0b;\n}\n.detail-actions[data-v-31dbed5e] {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n/* 工具栏 */\n.dao-toolbar[data-v-31dbed5e] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n}\n.toolbar-left[data-v-31dbed5e] {\n  display: flex;\n  gap: 16px;\n  font-size: 0.9rem;\n}\n.dao-count[data-v-31dbed5e] {\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.dao-exp[data-v-31dbed5e] {\n  color: var(--color-text-secondary);\n}\n.toolbar-right[data-v-31dbed5e] {\n  display: flex;\n  gap: 8px;\n}\n.tool-btn[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 6px 12px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.tool-btn[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n\n/* 主内容 */\n.dao-content[data-v-31dbed5e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  padding: 12px;\n}\n\n/* 空状态 */\n.dao-empty[data-v-31dbed5e] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 20px;\n  color: var(--color-text-secondary);\n}\n.quick-actions[data-v-31dbed5e] {\n  display: flex;\n  gap: 12px;\n}\n\n/* 大道列表 */\n.dao-list[data-v-31dbed5e] {\n  flex: 1;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.dao-name[data-v-31dbed5e] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n/* 通用按钮 */\n.action-btn[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 10px 16px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn[data-v-31dbed5e]:hover {\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-btn.primary[data-v-31dbed5e] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n}\n.action-btn.primary[data-v-31dbed5e]:hover {\n  opacity: 0.9;\n}\n.action-btn.secondary[data-v-31dbed5e] {\n  background: #ffb534d0;\n  border-color: var(--color-border);\n}\n.action-btn.warning[data-v-31dbed5e] {\n  background: #f59e0b;\n  border-color: #f59e0b;\n  color: white;\n}\n.action-btn.warning[data-v-31dbed5e]:hover {\n  opacity: 0.9;\n}\n.action-btn.large[data-v-31dbed5e] {\n  padding: 12px 20px;\n}\n.close-btn[data-v-31dbed5e] {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.close-btn[data-v-31dbed5e]:hover {\n  color: var(--color-text);\n  border-color: var(--color-primary);\n  background: var(--color-surface-hover);\n}\n\n/* 响应式 */\n@media (max-width: 640px) {\n.dao-stats-header[data-v-31dbed5e] {\n    flex-wrap: wrap;\n}\n.stats-card[data-v-31dbed5e] {\n    min-width: auto;\n    flex: 1;\n}\n.quick-actions[data-v-31dbed5e] {\n    flex-direction: column;\n}\n.detail-stats-grid[data-v-31dbed5e] {\n    grid-template-columns: 1fr;\n}\n}\n",""]);const s=i},7445:(e,t,n)=>{"use strict";n.d(t,{aiService:()=>o,o:()=>r});var a=n(1083);const r={openai:{url:"https://api.openai.com",defaultModel:"gpt-4o",name:"OpenAI"},claude:{url:"https://api.anthropic.com",defaultModel:"claude-sonnet-4-20250514",name:"Claude"},gemini:{url:"https://generativelanguage.googleapis.com",defaultModel:"gemini-2.0-flash",name:"Gemini"},deepseek:{url:"https://api.deepseek.com",defaultModel:"deepseek-chat",name:"DeepSeek"},custom:{url:"",defaultModel:"",name:"自定义(OpenAI兼容)"}},o=new class{config={mode:"tavern",streaming:!0,memorySummaryMode:"raw",initMode:"generate",customAPI:{provider:"openai",url:"",apiKey:"",model:"gpt-4o",temperature:.7,maxTokens:16e3}};constructor(){this.loadConfig()}syncModeWithEnvironment(){this.config.mode=this.isTavernEnvironment()?"tavern":"custom"}loadConfig(){try{const e=localStorage.getItem("ai_service_config");if(e){const t=JSON.parse(e);return this.config={...this.config,...t},console.log("[AI服务] 配置已加载:",this.config.mode),void this.syncModeWithEnvironment()}this.syncModeWithEnvironment()}catch(e){console.error("[AI服务] 加载配置失败:",e)}}saveConfig(e){this.config={...this.config,...e},this.syncModeWithEnvironment(),this.config.customAPI?.url&&(this.config.customAPI.url=this.config.customAPI.url.replace(/\/v1\/?$/,"").replace(/\/+$/,"")),localStorage.setItem("ai_service_config",JSON.stringify(this.config)),console.log("[AI服务] 配置已保存:",this.config.mode)}getConfig(){return{...this.config}}async fetchModels(){if(!this.config.customAPI?.url||!this.config.customAPI?.apiKey)throw new Error("请先配置API地址和密钥");try{const e=this.config.customAPI.url.replace(/\/+$/,""),t=await a.A.get(`${e}/v1/models`,{headers:{Authorization:`Bearer ${this.config.customAPI.apiKey}`}});return t.data.data?.map(e=>e.id)||[]}catch(e){throw console.error("[AI服务] 获取模型列表失败:",e),new Error("获取模型列表失败")}}getAPIConfigForUsageType(e){if(!e)return null;try{const{useAPIManagementStore:t}=n(100),a=t().getAPIForType(e);return a?"default"===a.id?null:a:null}catch(e){return console.warn("[AI服务] 获取功能API配置失败，使用默认配置:",e),null}}async generate(e){this.syncModeWithEnvironment();const t=e.usageType||"main";if(console.log(`[AI服务] 调用generate，模式: ${this.config.mode}, usageType: ${t}`),"tavern"===this.config.mode){if("main"===t)return console.log("[AI服务-酒馆] 主API调用，使用酒馆TavernHelper"),this.generateWithTavern(e);const n=this.getAPIConfigForUsageType(t);return n?(console.log(`[AI服务-酒馆] 辅助功能[${t}]使用独立API: ${n.name}`),this.generateWithAPIConfig(e,{provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature,maxTokens:n.maxTokens})):(console.log(`[AI服务-酒馆] 辅助功能[${t}]未配置独立API，使用酒馆TavernHelper`),this.generateWithTavern(e))}const n=this.getAPIConfigForUsageType(t);return n?(console.log(`[AI服务-网页] 使用功能[${t}]分配的API: ${n.name}`),this.generateWithAPIConfig(e,{provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature,maxTokens:n.maxTokens})):this.generateWithCustomAPI(e)}async generateRaw(e){this.syncModeWithEnvironment();const t=e.usageType||"main";if(console.log(`[AI服务] 调用generateRaw，模式: ${this.config.mode}, usageType: ${t}`),"tavern"===this.config.mode){if("main"===t)return console.log("[AI服务-酒馆] 主API Raw调用，使用酒馆TavernHelper"),this.generateRawWithTavern(e);const n=this.getAPIConfigForUsageType(t);return n?(console.log(`[AI服务-酒馆] 辅助功能[${t}]使用独立API: ${n.name}`),this.generateRawWithAPIConfig(e,{provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature,maxTokens:n.maxTokens})):(console.log(`[AI服务-酒馆] 辅助功能[${t}]未配置独立API，使用酒馆TavernHelper`),this.generateRawWithTavern(e))}const n=this.getAPIConfigForUsageType(t);return n?(console.log(`[AI服务-网页] 使用功能[${t}]分配的API: ${n.name}`),this.generateRawWithAPIConfig(e,{provider:n.provider,url:n.url,apiKey:n.apiKey,model:n.model,temperature:n.temperature,maxTokens:n.maxTokens})):this.generateRawWithCustomAPI(e)}async generateWithAPIConfig(e,t){console.log(`[AI服务] 使用指定API配置生成，provider: ${t.provider}, model: ${t.model}`);const n=this.config.customAPI?{...this.config.customAPI}:null;try{return this.config.customAPI={provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature??.7,maxTokens:t.maxTokens??16e3},await this.generateWithCustomAPI(e)}finally{n&&(this.config.customAPI=n)}}async generateRawWithAPIConfig(e,t){console.log(`[AI服务] 使用指定API配置进行纯净生成，provider: ${t.provider}, model: ${t.model}`);const n=this.config.customAPI?{...this.config.customAPI}:null;try{return this.config.customAPI={provider:t.provider,url:t.url,apiKey:t.apiKey,model:t.model,temperature:t.temperature??.7,maxTokens:t.maxTokens??16e3},await this.generateRawWithCustomAPI(e)}finally{n&&(this.config.customAPI=n)}}async generateWithTavern(e){const t=this.getTavernHelper();if(!t)throw new Error(this.isTavernEnvironment()?"酒馆环境不可用，请切换到自定义API模式或在SillyTavern中打开":"当前环境不可用，请切换到自定义API模式");console.log("[AI服务-酒馆] 调用tavernHelper.generate");try{return await this.withRetry("tavern.generate",()=>t.generate(e))}catch(e){throw this.toUserFacingError(e)}}async generateRawWithTavern(e){const t=this.getTavernHelper();if(!t)throw new Error(this.isTavernEnvironment()?"酒馆环境不可用，请切换到自定义API模式或在SillyTavern中打开":"当前环境不可用，请切换到自定义API模式");console.log("[AI服务-酒馆] 调用tavernHelper.generateRaw");try{const n=await this.withRetry("tavern.generateRaw",()=>t.generateRaw(e));return String(n)}catch(e){throw this.toUserFacingError(e)}}async withRetry(e,t,n){const a=n?.retries??2,r=n?.baseDelayMs??800;let o;for(let n=0;n<=a;n++)try{return await t()}catch(t){if(o=t,!this.isRetryableError(t)||n>=a)break;const i=Math.floor(250*Math.random()),s=r*Math.pow(2,n)+i;console.warn(`[AI服务] ${e} 失败，准备重试 (${n+1}/${a+1})，${s}ms`,t),await new Promise(e=>setTimeout(e,s))}throw o}isRetryableError(e){const t=e?"string"==typeof e?e:e instanceof Error?e.message||"":String(e):"",n=(()=>{const t=e;return t?.status??t?.response?.status??t?.cause?.status??t?.cause?.response?.status})();return"number"==typeof n?[408,409,425,429,500,502,503,504].includes(n):!!/service unavailable/i.test(t)||!!/\b(429|500|502|503|504)\b/.test(t)||!!/timeout|timed out|network error|fetch failed/i.test(t)}toUserFacingError(e){const t=e,n=e?"string"==typeof e?e:e instanceof Error?e.message||"未知错误":String(e):"未知错误",a=t?.status??t?.response?.status??t?.cause?.status??t?.cause?.response?.status;if(503===a||/service unavailable/i.test(n)){const t=new Error("AI 服务暂不可用（Service Unavailable/503）。我已自动重试仍失败：如果在 SillyTavern 内使用，请检查当前 API 提供方/代理/额度是否正常；也可能是上游临时故障，稍后再试。");return t.cause=e,t}if(429===a||/\b429\b/.test(n)){const t=new Error("AI 请求过于频繁（429）。我已自动重试，仍失败请稍后再试或降低并发/频率。");return t.cause=e,t}const r=new Error(n||"AI 调用失败");return r.cause=e,r}getTavernHelper(){if("undefined"==typeof window)return null;if(window.TavernHelper)return window.TavernHelper;try{if(window.top&&window.top!==window&&window.top.TavernHelper)return window.top.TavernHelper}catch{}let e=window;for(let t=0;t<5;t++)try{if(!e.parent||e.parent===e)break;if(e.parent.TavernHelper)return e.parent.TavernHelper;e=e.parent}catch{break}return null}isTavernEnvironment(){return!!this.getTavernHelper()}async generateWithCustomAPI(e){if(!this.config.customAPI)throw new Error("自定义API未配置");console.log("[AI服务-自定义] 构建消息列表");const t=[];e.injects&&e.injects.length>0&&([...e.injects].sort((e,t)=>t.depth-e.depth).forEach(e=>{"</input>"!==e.content&&t.push({role:e.role,content:e.content})}),console.log(`[AI服务-自定义] 已添加 ${t.length} 条inject消息`)),e.user_input&&(t.push({role:"user",content:e.user_input}),console.log("[AI服务-自定义] 已添加用户输入"));const n=e.should_stream??this.config.streaming??!1;return this.callAPI(t,n,e.onStreamChunk)}async generateRawWithCustomAPI(e){if(!this.config.customAPI)throw new Error("自定义API未配置");console.log("[AI服务-自定义Raw] 使用ordered_prompts");const t=(e.ordered_prompts||[]).filter(e=>"</input>"!==e.content);console.log(`[AI服务-自定义Raw] 消息数量: ${t.length}`);const n=e.should_stream??this.config.streaming??!1;return this.callAPI(t,n,e.onStreamChunk)}async callAPI(e,t,n){const{provider:a,url:r,apiKey:o,model:i,temperature:s,maxTokens:l}=this.config.customAPI;switch(console.log(`[AI服务-API调用] Provider: ${a}, URL: ${r}, Model: ${i}, 消息数: ${e.length}, 流式: ${t}`),a){case"claude":return this.callClaudeAPI(e,t,n);case"gemini":return this.callGeminiAPI(e,t,n);default:return this.callOpenAICompatibleAPI(e,t,n)}}estimateTokensForText(e){if(!e)return 0;let t=0;for(const n of e){const e=n.charCodeAt(0);e>=19968&&e<=40959&&t++}const n=Math.max(0,e.length-t);return t+Math.ceil(n/4)}estimateTokensForMessages(e){return e.reduce((e,t)=>e+8+this.estimateTokensForText(t.content||""),0)}getApproxContextWindow(e,t){const n=(t||"").toLowerCase();return"claude"===e||n.includes("claude")?2e5:"gemini"===e||n.includes("gemini")?1e6:n.includes("deepseek")?64e3:n.includes("moonshot")||n.includes("kimi")||n.includes("gpt-4o")||n.includes("gpt-4.1")||n.includes("o1")||n.includes("o3")||n.includes("gpt-4")?128e3:n.includes("gpt-3.5")?16385:null}clampMaxTokensForContext(e,t,n,a){const r=this.getApproxContextWindow(e,t);if(!r)return a;const o=this.estimateTokensForMessages(n),i=r-o-512;if(i<256)throw new Error(`API上下文长度不足：输入过长（估算输入≈${o} tokens），请减少世界/提示词长度或更换更大上下文模型。`);const s=Math.min(a,Math.max(256,i));return s<a&&console.warn(`[AI服务] maxTokens过大，已自动下调：${a} -> ${s}（估算输入≈${o}，模型上下文≈${r}）`),s}isStreamUnsupportedError(e){const t=(e||"").toLowerCase();return t.includes("stream")&&(t.includes("not supported")||t.includes("unsupported")||t.includes("invalid")||t.includes("unknown"))||t.includes("text/event-stream")||t.includes("sse")}async callOpenAICompatibleAPI(e,t,n){const{provider:r,url:o,apiKey:i,model:s,temperature:l,maxTokens:c}=this.config.customAPI,d=this.clampMaxTokensForContext(r,s,e,c||16e3);try{if(!t){const t=(await a.A.post(`${o}/v1/chat/completions`,{model:s,messages:e,temperature:l||.7,max_tokens:d,stream:!1},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},timeout:12e4})).data.choices[0].message.content;return console.log(`[AI服务-OpenAI] 响应长度: ${t.length}`),t}try{return await this.streamingRequestOpenAI(o,i,s,e,l||.7,d,n)}catch(t){const n=t instanceof Error?t.message:String(t);if(!this.isStreamUnsupportedError(n))throw t;console.warn("[AI服务-OpenAI兼容] 当前API可能不支持流式传输，已自动降级为非流式请求。");const r=(await a.A.post(`${o}/v1/chat/completions`,{model:s,messages:e,temperature:l||.7,max_tokens:d,stream:!1},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},timeout:12e4})).data.choices[0].message.content;return console.log(`[AIæœåŠ¡-OpenAI] å“åº”é•¿åº¦: ${r.length}`),r}}catch(e){if(console.error("[AI服务-OpenAI] 失败:",e),a.A.isAxiosError(e)){if(e.response)throw new Error(`API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);if(e.request)throw new Error("网络错误：无法连接到API服务器")}throw new Error(`OpenAI API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async callClaudeAPI(e,t,n){const{provider:r,url:o,apiKey:i,model:s,temperature:l,maxTokens:c}=this.config.customAPI;let d="";const u=[];for(const t of e)"system"===t.role?d+=(d?"\n\n":"")+t.content:u.push({role:t.role,content:t.content});0!==u.length&&"user"===u[0].role||u.unshift({role:"user",content:"请开始。"});const m=o||"https://api.anthropic.com",p=this.clampMaxTokensForContext(r,s,[...d?[{content:d}]:[],...u.map(e=>({content:e.content}))],c||16e3);try{if(!t){const e=await a.A.post(`${m}/v1/messages`,{model:s,max_tokens:p,system:d||void 0,messages:u,temperature:l||.7},{headers:{"x-api-key":i,"anthropic-version":"2023-06-01","Content-Type":"application/json"},timeout:12e4}),t=e.data.content[0]?.text||"";return console.log(`[AI服务-Claude] 响应长度: ${t.length}`),t}try{return await this.streamingRequestClaude(m,i,s,d,u,l||.7,p,n)}catch(e){const t=e instanceof Error?e.message:String(e);if(!this.isStreamUnsupportedError(t))throw e;console.warn("[AI服务-Claude] 当前API可能不支持流式传输，已自动降级为非流式请求。");const n=await a.A.post(`${m}/v1/messages`,{model:s,max_tokens:p,system:d||void 0,messages:u,temperature:l||.7},{headers:{"x-api-key":i,"anthropic-version":"2023-06-01","Content-Type":"application/json"},timeout:12e4}),r=n.data.content[0]?.text||"";return console.log(`[AI服务-Claude] 响应长度: ${r.length}`),r}}catch(e){if(console.error("[AI服务-Claude] 失败:",e),a.A.isAxiosError(e)&&e.response)throw new Error(`Claude API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);throw new Error(`Claude API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async callGeminiAPI(e,t,n){const{provider:r,url:o,apiKey:i,model:s,temperature:l,maxTokens:c}=this.config.customAPI;let d="";const u=[];for(const t of e)"system"===t.role?d+=(d?"\n\n":"")+t.content:u.push({role:"assistant"===t.role?"model":"user",parts:[{text:t.content}]});0===u.length&&u.push({role:"user",parts:[{text:"请开始。"}]});const m=o||"https://generativelanguage.googleapis.com",p=t?"streamGenerateContent":"generateContent",g=this.clampMaxTokensForContext(r,s,[...d?[{content:d}]:[],...u.map(e=>({content:(e.parts||[]).map(e=>e.text).join("\n")}))],c||16e3);try{if(!t){const e=await a.A.post(`${m}/v1beta/models/${s}:${p}?key=${i}`,{contents:u,systemInstruction:d?{parts:[{text:d}]}:void 0,generationConfig:{temperature:l||.7,maxOutputTokens:g}},{headers:{"Content-Type":"application/json"},timeout:12e4}),t=e.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${t.length}`),t}try{return await this.streamingRequestGemini(m,i,s,d,u,l||.7,g,n)}catch(e){const t=e instanceof Error?e.message:String(e);if(!this.isStreamUnsupportedError(t))throw e;console.warn("[AI服务-Gemini] 当前API可能不支持流式传输，已自动降级为非流式请求。");const n=await a.A.post(`${m}/v1beta/models/${s}:generateContent?key=${i}`,{contents:u,systemInstruction:d?{parts:[{text:d}]}:void 0,generationConfig:{temperature:l||.7,maxOutputTokens:g}},{headers:{"Content-Type":"application/json"},timeout:12e4}),r=n.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return console.log(`[AI服务-Gemini] 响应长度: ${r.length}`),r}}catch(e){if(console.error("[AI服务-Gemini] 失败:",e),a.A.isAxiosError(e)&&e.response)throw new Error(`Gemini API错误 ${e.response.status}: ${JSON.stringify(e.response.data)}`);throw new Error(`Gemini API调用失败: ${e instanceof Error?e.message:"未知错误"}`)}}async streamingRequestOpenAI(e,t,n,a,r,o,i){console.log("[AI服务-OpenAI流式] 开始");const s=await fetch(`${e}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${t}`,Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify({model:n,messages:a,temperature:r,max_tokens:o,stream:!0})});if(!s.ok)throw new Error(`API错误 ${s.status}: ${await s.text()}`);const l=s.headers.get("content-type")||"";if(!l.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${l||"unknown"})`);return this.processSSEStream(s,e=>{const t=JSON.parse(e);return t.choices[0]?.delta?.content||""},i)}async streamingRequestClaude(e,t,n,a,r,o,i,s){console.log("[AI服务-Claude流式] 开始");const l=await fetch(`${e}/v1/messages`,{method:"POST",headers:{"x-api-key":t,"anthropic-version":"2023-06-01",Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify({model:n,max_tokens:i,system:a||void 0,messages:r,temperature:o,stream:!0})});if(!l.ok)throw new Error(`Claude API错误 ${l.status}: ${await l.text()}`);const c=l.headers.get("content-type")||"";if(!c.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${c||"unknown"})`);return this.processSSEStream(l,e=>{const t=JSON.parse(e);return"content_block_delta"===t.type&&t.delta?.text||""},s)}async streamingRequestGemini(e,t,n,a,r,o,i,s){console.log("[AI服务-Gemini流式] 开始");const l=await fetch(`${e}/v1beta/models/${n}:streamGenerateContent?key=${t}&alt=sse`,{method:"POST",headers:{Accept:"text/event-stream","Content-Type":"application/json"},body:JSON.stringify({contents:r,systemInstruction:a?{parts:[{text:a}]}:void 0,generationConfig:{temperature:o,maxOutputTokens:i}})});if(!l.ok)throw new Error(`Gemini API错误 ${l.status}: ${await l.text()}`);const c=l.headers.get("content-type")||"";if(!c.includes("text/event-stream"))throw new Error(`Stream unsupported (content-type=${c||"unknown"})`);return this.processSSEStream(l,e=>{const t=JSON.parse(e);return t.candidates?.[0]?.content?.parts?.[0]?.text||""},s)}async processSSEStream(e,t,n){const a=e.body?.getReader();if(!a)throw new Error("无法获取响应流");const r=new TextDecoder;let o="",i="",s=!1,l="";const c=()=>"undefined"!=typeof performance&&performance.now?performance.now():Date.now();let d=c(),u=0;const m=async e=>{if(!n)return;u+=e;const t=c();(u>=80||t-d>=60)&&(u=0,d=t,await new Promise(e=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(()=>e()):setTimeout(e,0)}))};try{for(;;){const{done:e,value:c}=await a.read();if(e)break;i+=r.decode(c,{stream:!0});const d=i.split("\n");i=d.pop()||"";for(const e of d){const a=e.trim();if(!a||!a.startsWith("data:"))continue;let r=a.slice(5);if(r.startsWith(" ")&&(r=r.slice(1)),"[DONE]"!==r)try{const e=t(r);if(e){o+=e;for(let t=0;t<e.length;t++)if(l+=e[t],l.includes("<thinking>"))s=!0,l="";else if(s&&l.includes("</thinking>"))s=!1,l="";else{if(s){const e=l.indexOf("```json"),t=l.indexOf("```"),a=-1!==e?e:t;if(-1!==a){const e=l.slice(a);s=!1,l="",n&&n(e),await m(e.length);continue}}s||(!"<thinking>".startsWith(l)&&!"</thinking>".startsWith(l)&&l.length>0?(n&&(console.log("[AI服务-流式] 发送chunk到前端:",l.length,"字符"),n(l)),await m(l.length),l=""):l.length>10&&(n&&(console.log("[AI服务-流式] 发送chunk到前端(缓冲区过大):",l.length,"字符"),n(l)),await m(l.length),l=""))}}}catch(e){console.warn("[AI服务-流式] 解析chunk失败:",r.substring(0,100))}}}!s&&l.length>0&&(n&&n(l),await m(l.length))}finally{a.releaseLock()}return console.log(`[AI服务-流式] 完成，总长度: ${o.length}`),o}checkAvailability(){return"tavern"===this.config.mode?this.getTavernHelper()?{available:!0,message:"酒馆模式已就绪"}:{available:!1,message:this.isTavernEnvironment()?"酒馆环境不可用。请在SillyTavern中打开，或切换到自定义API模式。":"当前环境不可用，请切换到自定义API模式。"}:this.config.customAPI?.url&&this.config.customAPI?.apiKey?{available:!0,message:"自定义API模式已就绪"}:{available:!1,message:"自定义API未配置。请在设置中配置API地址和密钥。"}}}},7457:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-3e075713] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-3e075713] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-3e075713 0.3s ease-out;\n}\n@keyframes slideUp-3e075713 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-3e075713] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-3e075713] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-3e075713]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-3e075713] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n  min-height: 200px;\n}\n\n/* Loading State */\n.loading-state[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  gap: 1rem;\n}\n.spinner[data-v-3e075713] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-3e075713 1s linear infinite;\n}\n@keyframes spin-3e075713 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Empty State */\n.empty-state[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 2rem;\n  text-align: center;\n}\n.empty-icon[data-v-3e075713] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n.empty-state p[data-v-3e075713] {\n  margin: 0.5rem 0;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n  max-width: 300px;\n}\n\n/* Export Options */\n.export-options[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.option-label[data-v-3e075713] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-label[data-v-3e075713]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.radio-input[data-v-3e075713] {\n  margin-top: 0.2rem;\n  cursor: pointer;\n}\n.option-text[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n.option-title[data-v-3e075713] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.option-desc[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n\n/* Presets List */\n.presets-list[data-v-3e075713] {\n  margin-bottom: 1.5rem;\n}\n.list-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--color-surface-light);\n  border-radius: 6px;\n  margin-bottom: 1rem;\n}\n.checkbox-label[data-v-3e075713] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  cursor: pointer;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.checkbox-input[data-v-3e075713] {\n  cursor: pointer;\n}\n.selected-count[data-v-3e075713] {\n  font-size: 0.85rem;\n  color: var(--color-primary);\n  font-weight: 500;\n}\n.preset-items[data-v-3e075713] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  max-height: 300px;\n  overflow-y: auto;\n  padding: 0.25rem;\n}\n.preset-item[data-v-3e075713] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 0.75rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.preset-item[data-v-3e075713]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.preset-item.selected[data-v-3e075713] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n}\n.preset-info[data-v-3e075713] {\n  flex: 1;\n}\n.preset-header[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.25rem;\n}\n.preset-name[data-v-3e075713] {\n  margin: 0;\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.preset-date[data-v-3e075713] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.preset-description[data-v-3e075713] {\n  margin: 0.25rem 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.3;\n}\n.preset-tags[data-v-3e075713] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-3e075713] {\n  padding: 0.2rem 0.6rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 10px;\n  font-size: 0.7rem;\n  color: var(--color-primary);\n}\n.info-tag.name-tag[data-v-3e075713] {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.15), rgba(var(--color-primary-rgb), 0.15));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  font-weight: 600;\n}\n.info-tag.age-tag[data-v-3e075713] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n\n/* Export Info */\n.export-info[data-v-3e075713] {\n  padding: 1rem;\n  background: rgba(var(--color-primary-rgb), 0.05);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.1);\n  border-radius: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.info-item[data-v-3e075713] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.85rem;\n}\n.info-label[data-v-3e075713] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.info-value[data-v-3e075713] {\n  color: var(--color-text);\n  font-family: 'Monaco', 'Courier New', monospace;\n}\n.modal-footer[data-v-3e075713] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-3e075713] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-3e075713] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-3e075713]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-3e075713] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-3e075713]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-3e075713]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-3e075713] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-3e075713] {\n    padding: 1rem;\n}\n.modal-title[data-v-3e075713] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-3e075713] {\n    padding: 1rem;\n}\n.modal-footer[data-v-3e075713] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-3e075713] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},7527:(e,t,n)=>{"use strict";n.d(t,{Gr:()=>i,VQ:()=>r,eQ:()=>a,qS:()=>s,yM:()=>o});const a=[{id:1,name:"九寰仙岛",era:"朝天历元年",description:"此方天地，名曰“九寰仙岛”，乃是一处天道圆融、灵气沛然的上善之地。其根本法则，在于“万灵竞渡，一步登天”。无论人、妖、精、怪，但凡得遇缘法，皆可踏上那渺渺仙途，叩问长生之门。\n仙凡之别，于此界分明如隔天渊。凡人百载寿数，难逃生老病死，终化尘土；而修士自引气入体始，便可吞吐天地精华，淬炼形神，寿元绵长以千载计。一方王朝兴衰，于他们而言，不过是浮光掠影。在凡俗眼中，修士便是高居云端的仙神，一言可决国运，一念能引风雷。\n然此等超凡之力，自有其代价。\n此界奉行“大道争锋”之铁则。天道虽降下机缘，却也布设无尽凶险。灵山秘境、上古传承、天材地宝，皆待有缘之人。而那“缘”字背后，往往是尸山血海。修士为求道途精进，争斗乃是常态。今日同门，明日或成死敌；往昔挚友，他朝亦可反目。杀人夺宝、斩草除根之事，在这广袤仙域中，从未止歇。\n这是一个极尽自由，也极尽残酷的世界。你可以选择成为护佑苍生的正道巨擘，亦可堕为随心所欲的盖世魔头。一切选择，皆系于实力强弱。然而，自由背后，是无处不在的杀劫，一步行差踏错，便是身死道消，万古成空。\n天道昭昭，自有其衡。\n修士若恃强凌弱，无故以滔天法力干涉凡俗运转，屠戮苍生，便会与这方天地结下深厚因果。虽无立时业报，然当其冲击无上境界，或面临飞升天劫之时，此等因果便会显化，引动更为酷烈的劫难，令道途平添变数。故而，大多数修士或选择遁世清修，或入红尘炼心，以求明悟本真，证得大道。\n至于炼丹、炼器、符箓、阵法等修仙百艺，在此界历经万载发展，早已登峰造极。它们共同构筑了一个辉煌鼎盛、波澜壮阔，同时也冰冷残酷、弱肉强食的仙道文明。"},{id:2,name:"地球",era:"公元2026年",description:"公元2026年，一场前所未有的剧变降临地球——灵气复苏。那些曾只存在于神话传说中的能量，如潮汐般涌入现实。科学法则被打破，异象频生：城市上空流转着极光般的能量涟漪；人迹罕至的深山中，灵脉悄然显现；寻常的动植物开始发生难以想象的异变。\n在这个剧变的开端，你是万中无一的“觉醒者”。\n当全世界仍依赖精密仪器捕捉和分析这神秘波动时，你的身体已能直接感知、吞吐并炼化灵气，踏上了那条湮没于历史的修真之路。摩天大楼的玻璃幕墙反射着古老的法诀微光，高速网络传递着修炼心得，尖端科技与千年道统激烈碰撞，迸发出前所未有的可能性。\n秩序正在重塑。\n各国政府紧急成立“超自然应对部门”，竞相研发灵气科技；跨国集团试图将灵能转化为商业新能源；而隐世已久的古老传承者，也悄然现身于尘世。这是一个灵能与代码交织、飞剑与卫星并存的新纪元。\n作为先行者，你孤独地行走于钢铁丛林之间，探寻着“科学修真”的终极奥秘。尽管人类的平均寿命仍未突破生物学极限，但觉醒者的存在已颠覆了一切常识。普通人看向你的眼神，混杂着敬畏、渴望与无法掩饰的恐惧。\n而你，必须在这双重世界的夹缝中，开辟出一条属于自己的道路。\n文明的火种从未熄灭，它只是在等待新的燃料——如今，灵气已至，未来将由你来定义。"},{id:3,name:"赛博修真",era:"新纪元2288",description:"公元2288年，人类已步入星际纪元。c在赛博都市无尽的霓虹光影下，义体改造、神经接驳与意识上传，早已是寻常生活的一部分。然而，一场意外的深空探测，却彻底颠覆了世界的根基——人类发现了“灵能水晶”。这种能够直接增幅精神力的神秘晶矿，为这个由数据和钢铁构成的时代，打开了一扇通往未知维度的大门。\n你，是一名游走在法律边缘的“跑者”。\n一次与灵能水晶的意外接触，唤醒了你沉寂的天赋。但在这个时代，修真不再依靠吐纳天地——你踏上的是“义体灵修”之路。在这里，数据流即是灵气，神经回路便是经脉，而那经过强化的意识核心，就是你的丹田。你可以通过黑客技术侵入企业服务器，“窃取”修炼算法；在虚拟实境中进行“数据闭关”，锤炼神识；甚至操控纳米机械，在体内构筑出独一无二的“机械金丹”。\n巨型企业牢牢掌控着灵能水晶的源头，赛博修士们为求突破，不得不接受各种高危委托。在贫民窟的狭窄胶囊仓里，有人对着破旧接口苦修；而在企业大厦的顶层，“数据仙人”们正享受着近乎无限的灵能与算力。\n这是一个属于孤独修者的纪元。\n在霓虹与钢铁交织的丛林里，没有师长护道，没有宗门依靠。每一次系统升级都可能伴随意识崩解，每一次数据突破都需直面企业围剿。\n而你，将以代码为符，以灵能为剑，在这虚幻与真实交错的世界中，编写属于自己的——赛博飞升之路。"},{id:4,name:"魔法纪元",era:"万象交融时代",description:"千载之前，源自东方的修真文明与来自西方的魔法体系，在此间相遇。那是一场持续百年的史诗碰撞——飞剑与魔杖交锋，符箓与咒文共振。最终，两种力量并未吞噬彼此，而是达成了某种深邃的共鸣与平衡。\n如今，古老的修真宗门与巍峨的魔法学院在山河之间并存。道家的符箓纹理，竟与炼金术的魔法阵图隐隐相通；冥想凝聚的元神，与冥想沟通的元素之灵，仿佛指向同一本源。\n而你，诞生于两大文明交界的“混沌边疆”。\n这是一片法则交织的土地。在这里，你可以遵循古法，引气入体，筑基结丹，凝练元婴，走那逍遥长生之道；亦可研习西方秘术，驾驭地火水风，或沟通幽冥，成为元素使者或亡灵主宰。\n更有极少数先驱，敢于踏上第三条路——他们试图熔炼真气与魔力，将金丹与法术核心合而为一，探索那禁忌而危险的“魔修真途”。\n这个世界既辽阔，又危机四伏。\n东方灵脉盘踞着不朽龙族，西方森林深处精灵守护着世界树的奥秘，矮人于地心挖掘着蕴含双重能量的“灵魔晶矿”。人类帝国在两大体系的夹缝中艰难维系着平衡。\n魔法学院的学徒可能与仙门弟子在秘境争夺中兵刃相向；闭关千年的老怪，或许某日推开门扉，便要面对一位吟唱禁咒的传奇法神。\n在这融合与对抗永无止息的时代，没有现成的道路。\n你将独自穿越文明的边界，解析符文与真气的共鸣，实验咒语与法诀的叠加。你的旅程，注定是一场在双重法则间行走的冒险——每一次尝试，都可能揭开超越极限的奥秘，亦可能引发无法预知的反噬。\n未来如同未完成的融合咒式，等待着被书写。"},{id:5,name:"洪荒末世",era:"末法时代第八万万纪",description:"世界正被缓慢地遗忘。\n早在八万万年前，一场席卷天地的“大寂灭”降临。灵气如退潮般枯竭，法则接连崩坏。那个神魔行走于大地、修士弹指摘星的辉煌纪元，早已彻底终结。残存的典籍里，关于“飞升”、“长生”的记载，读来如同虚幻的神话。\n如今，是末法时代的第八万万个年头。\n你降生于这漫长的衰亡之中。灵脉已近断绝，昔日的洞天福地化为荒芜废墟。绝大多数仙道传承消散于时光尘埃，仅余寥寥支脉，在苟延残喘中守护着最后的火种。修行成为一件近乎荒谬的苦役——耗尽数十年光阴，可能仅仅为了在体内凝聚一缕微弱如风中残烛的真气。\n然而，这也成了一个别无杂质的时代。\n没有取巧的丹药，没有助力的法宝，没有可供掠夺的机缘。一切外物皆成虚妄，道途之上，只剩下最原始的吐纳、最坚韧的筋骨，以及与日俱增的、对自身意志的打磨。修行回归到了它最朴素，也最残酷的本质。\n末世的法则冰冷而直接。\n每一次微小的境界突破，都可能是一次生死劫难。为了一株仅存的最低阶灵草，修士之间便可爆发惨烈厮杀。时间失去了意义，一次短暂的闭关醒来，山门或许已成白骨荒地，故人皆作黄土。\n这是一个筛选灵魂的时代。\n力量已然凋零，但“道”依然存在——它只向那些在绝境中仍不放弃仰望星空的人，显露出最后一线微光。\n你的路，注定孤独、漫长，且看不到尽头。\n但每一步，都将刻入这个时代最后的碑文。"},{id:6,name:"星海修仙",era:"星际大航海时代",description:"星辰，已成为新的疆域。数万载前，那批试图撕裂虚空、飞升上界的大能者，在渡劫失败的边缘，窥见了更为浩瀚的图景——宇宙深处，繁星并非凡土，而是蕴藏着无穷道韵的“修真星辰”。自此，孤悬一隅的星球文明被彻底打破，星空大航道的时代轰然开启。\n在这无垠的深空之中，每一颗被灵识标记的星辰，都孕育着截然不同的天道法则与力量本源。有的世界，灵气浓郁如液态海洋；有的星球，则弥漫着需要特殊法门才能汲取的“星辰精粹”或“虚空辐射”。修士们驾驶着融合阵法与科技的庞大星舟，穿梭于星门之间，探索上古遗迹，争夺稀缺的“星核”与“界源”。\n昔日的宗门巨擘，早已演化为横跨多个星系的庞大道统。星际修真帝国、商会联盟、探险者公会……秩序与势力在真空中重新编织。\n在这里，“距离”与“时间”被赋予了全新的、令人敬畏的含义。\n一次寻常的星际航行，便可能耗去凡人的一生。炼虚期修士闭一次生死关，醒来时星舟或许已航越数个星系，熟悉的星图早已更迭。有人为追寻传说中的“道源祖星”，倾尽万年寿元，最终却化为一具在寂静深空中永恒漂浮的星骸。\n这是一个将“孤独”诠释到极致的时代。你的同道可能在另一条航线上老去，你的仇敌或许已在某次星爆中湮灭。陪伴你的，只有船舷外永恒的黑暗，体内缓慢运转的周天，以及那份必须在漫长得令人绝望的旅途中，依然保持道心不坠的坚韧。\n前路是星辰，归途是虚无。而你的修行，便是在这无尽的航行中，与时间为敌，与自己为伴。\n"},{id:7,name:"真武之域",era:"武道纪元",description:"此方天地，名曰“真武之域”。\n在这里，万物不修灵气，不求长生。力量的本源，深植于血肉筋骨之中，根植于意志锋芒之上。众生所逐，乃是对自身躯壳的极致打磨，以及对武道真意的纯粹领悟。一拳开山裂海，一掌截断虚空——便是此界武者穷极一生所追寻的至高境界。\n武道修行，一步一重天。其阶严谨而残酷，分为：淬体、凝气、通玄、化真、破虚、登天。每一步跨越，皆是向死而生，绝无取巧之径。没有灵丹助益，亦无外物可恃，唯有以血为薪，以汗为火，方能锤炼出不朽武躯。\n淬体需十年如一日，打熬筋骨皮膜；凝气需三十载寒暑，于体内蕴养至纯真气；至于通玄，则需耗费百年光阴，去参悟那虚无缥缈的武道真意。时间，在此是最公平，也最无情的尺规。\n武者闭关，动辄十载。出关之日，红尘已换，故交零落。强者间的巅峰对决，往往以燃烧数十载寿元为代价，胜者亦是伤痕累累。宗门的崛起与湮灭，在此地不过是百年间的匆匆一瞥。\n此地没有永恒，唯有燃烧。\n这是一条以有限生命，叩问无限武道的“修罗途”。所有踏入此道者，皆知终点或许是粉身碎骨，却依然前赴后继，将毕生热血与岁月，尽数熔铸于下一拳、下一式之中。\n你的武道，便是你存在的全部意义。在这条注定孤独、短暂而辉煌的路上，你唯一能信任的，只有这副千锤百炼的身躯，和那颗永不屈服的武道之心。"},{id:8,name:"诡异世界",era:"混沌纪元",description:"这是一个失序的世界——天道残缺，法则扭曲。那场被后世称为“大浸染”的灾变，永久地改写了修行之基。纯粹的天地灵气早已腐坏，取而代之的，是弥漫在每一寸空间中的、充满恶意的“诡异本源”。\n传统的仙道在此地彻底断绝。如今的修行，被唤作“畸变之道”——一条在疯狂边缘行走的险径。修士的目标不再是超脱，而是如何在攫取扭曲力量的同时，竭力维系住脑海中最后一丝清明。\n诡异无所不在。它浸染灵脉，使吐纳成为一场与污染源的直接搏斗；它腐蚀功法，先贤留下的经典中会莫名浮现令人癫狂的注释；它扭曲生灵，花草树木、鸟兽虫鱼，乃至修行者自身，都可能在任何一刻发生不可逆的异变。\n在这里，闭关是危险的。你或许需要十年苦功，来压制体内新融合的一缕诡力。而当你推开洞府石门时，镜中映出的，可能是一具半人半怪、连自己都感到陌生的躯体。每一次境界的“提升”，都伴随着理性疆域的永久丧失与道体的不可控畸变。\n时间，成了最残酷的倒计时。诡异侵蚀无时无刻不在进行，如同附骨之疽。修士必须在自己彻底沦为无知无觉的怪物之前，强行突破到下一个能暂时压制污染的境界。这是一场注定失败居多、与自我消逝赛跑的绝望修行。\n有人苦熬百年，终于站在了力量的顶端，俯瞰众生。却发现自己早已忘却为何出发，内心只剩下冰冷的非人空洞。\n此路无归途，唯有向深渊跋涉。你的道，便是在自身一点一点崩解的过程中，于混沌里，寻觅那缕或许根本不存在的、名为“我”的微光。"},{id:9,name:"斗罗大陆",era:"魂师纪元",description:"众生降生之时，体内便已蕴藏独属的武魂——或是器魂，如贯天之锤，斩魄之剑；或是兽魂，如柔韧草蔓，凶煞虎瞳。武魂的品阶，划下了命运最初的起跑线，但真正的通天之路，需以魂兽之血铺就。唯有猎杀魂兽，吸收其魂环，方能突破界限，让武魂绽放真正的威能。\n修行之路，等级森严。自魂士始，历经魂师、魂尊、魂宗、魂王、魂帝、魂圣、直至魂斗罗与封号斗罗，共分八阶。每十级便是一道天堑，需以一枚魂环为钥匙方能跨越。魂环自十年而始，至百年、千年、万年，乃至传说中的十万年级别。年限越高，所赋予的魂技便越是强横，但其中蕴含的狂暴能量，亦足以让贪婪者爆体而亡。\n大陆之上，秩序与野心交织。武魂殿威凌四方，统御魂师秩序；天斗与星罗两大帝国表面和睦，暗中角力；诸如昊天宗、七宝琉璃宗等隐世宗门，则如深海潜流，掌握着足以颠覆格局的力量。\n魂师享有尊荣，但荣耀背后尽是荆棘。每一次踏入魂兽森林，都是与死神的赌局；每一次融合魂环，都是对意志与躯体的极限考验。即便成就封号斗罗，享寿不过三百载，而从一介魂士攀至此境，往往已耗去百年光阴，其间多少故人已成黄土。\n魂兽森林深处，危机远非寻常。十万年魂兽不仅拥有媲美巅峰斗罗的伟力，更可褪去兽形，化为人身，行走于尘世之间。它们本身，便是最珍贵的魂环，也是最致命的猎手。\n这是一个英雄与陨落同样频繁的时代。天才如星辰般升起，又如流星般黯淡。力量即是一切法则，每一次武魂的闪耀，都可能映照出一条通往神坛的血路，或是一段戛然而止的悲歌。\n而你，将在此间觉醒。你的武魂，你的魂环，你的每一次抉择，都将在这片名为斗罗的修罗场上，写下属于自己的——魂道篇章。"},{id:10,name:"魅影联邦",era:"联邦历776年",description:"这是由联邦高墙铸就的牢笼。霓虹在永夜中如血管般搏动，高耸入云的巨构大厦像冰冷的墓碑，机械意识的低语在数据洪流的暗面回响。在这里，每个人的诞生都伴随着一份名为“基因编码锁链”的出厂设定——它界定阶级、分配命运、锁死未来。\n你曾是这沉默螺旋中，一粒微不足道的尘埃。直到那个改变一切的夜晚，你体内某种被预设程序判定为“不应存在”的代码，被意外激活。于是，你看见了规则之墙的裂缝，听见了枷锁内部松动的回音——你成为了“序列觉醒者”。\n力量是此间唯一的硬通货。财阀世家垄断能源与数据，街头帮派划分着地盘的阴影，公司佣兵以信用点为单位售卖生命，而散落的觉醒者们，则在夹缝中挣扎、交易、背叛或结盟。所有人都被同一个目标驱动：打破原始的基因编码，沿着名为“超凡序列”的危险阶梯向上攀爬，直至触碰那被层层加密的——神明领域。\n此路没有安全协议，没有存档点。每一次序列能力的“编译”与“升级”，都伴随着系统崩溃（死亡）的风险。每一次踏入阴影中的交锋，都是在用全部筹码与概率对赌。你需要窃取公司的加密情报，黑入禁区网络，在义体医生的地下诊所里进行不被记录的改造，于数据废墟中发掘旧时代的禁忌知识。\n有人登上王座，更多人化作无声数据。你将独自穿行于钢铁丛林与意识深网，解码自身序列的终极谜题。要么，你破解系统，成为定义新规则的存在；要么，你被更强大的进程吞噬，成为这座永恒都市又一段被覆盖的冗余代码。\n世界是座囚笼，而你，刚刚拿到第一把可能错误的钥匙。"}],r=[{id:1,name:"废柴",description:"资质平平，毫无出奇之处，前途渺茫。虽有前进之心，奈何天赋所限，每一步都需付出常人百倍的努力。",total_points:10,rarity:1,color:"#718096"},{id:2,name:"凡人",description:"芸芸众生中的一员，不好不坏，有缘可入超凡新生。若有大机缘，亦可成就一番事业。",total_points:20,rarity:2,color:"#E2E8F0"},{id:3,name:"俊杰",description:"百里挑一的人才，略有不凡，在宗门中可为内门弟子。悟性尚可，勤勉努力有望窥得大道门径。",total_points:35,rarity:3,color:"#63B3ED"},{id:4,name:"天骄",description:"千年难遇的奇才，注定耀眼，是宗门未来的希望。天资聪颖，修行速度远超常人，往往能越阶而战。",total_points:50,rarity:4,color:"#9F7AEA"},{id:5,name:"妖孽",description:"万古无一的怪物，逆天而行，可与上古神魔比肩。打破常理的存在，天道似乎都对其格外宽容或格外严苛。",total_points:70,rarity:5,color:"#F6E05E"},{id:6,name:"谪仙转世",description:"仙人转世，天生道胎，记忆蒙尘但灵性不昧，修行一日千里。自带仙气，凡尘俗世的法则难以束缚。",total_points:85,rarity:6,color:"#F56565"},{id:7,name:"大道之子",description:"大道化身，天生与道相合，万法皆通，是此纪元的应劫之人。言出法随，气运逆天，整个世界都在为其让路。",total_points:100,rarity:7,color:"#ED8936"}],o=[{id:1,name:"山野遗孤",description:"自幼在山野中长大，与猛兽为伴，磨练出坚韧的意志和过人的体魄。",talent_cost:0,attribute_modifiers:{root_bone:1},rarity:3},{id:2,name:"书香门第",description:"出身于官宦世家，饱读诗书，对天地至理有超乎常人的理解力。",talent_cost:2,attribute_modifiers:{comprehension:2},rarity:3},{id:3,name:"商贾之子",description:"生于富贵之家，精通人情世故，处事圆滑，魅力非凡。",talent_cost:2,attribute_modifiers:{charm:2},rarity:3},{id:4,name:"将门之后",description:"名将的后代，血脉中流淌着勇武与煞气，心性坚定。",talent_cost:3,attribute_modifiers:{temperament:2,root_bone:1},rarity:3},{id:5,name:"散修传人",description:"你的师父是一位游戏风尘的强大散修，你继承了他的部分衣钵和见识。",talent_cost:4,attribute_modifiers:{comprehension:1,temperament:1},rarity:4},{id:6,name:"魔道卧底",description:"你出身名门正派，却被派往魔道执行卧底任务，心性远超常人。",talent_cost:1,attribute_modifiers:{temperament:3},rarity:4},{id:7,name:"重生者",description:"你保留着前世的记忆，虽然修为尽失，但对功法和未来的大事了如指掌。",talent_cost:5,attribute_modifiers:{comprehension:2,luck:1},rarity:5},{id:8,name:"仙人后裔",description:"你的血脉中流淌着稀薄的仙人之血，天生灵性十足，修炼速度略快于常人。",talent_cost:6,attribute_modifiers:{spirit:2,root_bone:1},rarity:5},{id:9,name:"夺舍老怪",description:"你是一名夺舍重生的老怪物，虽然占据了年轻的肉体，但灵魂中蕴含着庞大的神识力量。",talent_cost:7,attribute_modifiers:{comprehension:3,temperament:-1},rarity:5},{id:10,name:"山神庙祝",description:"你从小在山神庙长大，日夜与香火为伴，神魂受到滋养，对鬼神之事有特殊感应。",talent_cost:2,attribute_modifiers:{spirit:2},rarity:3},{id:11,name:"渔家少年",description:"常年在江河湖海中讨生活，水性极佳，体魄强健。",talent_cost:1,attribute_modifiers:{root_bone:2},rarity:2},{id:12,name:"王朝皇子",description:"生于凡人王朝的权力之巅，自幼享受锦衣玉食和最好的教育，但与修仙界的接触较少。",talent_cost:3,attribute_modifiers:{charm:2,temperament:1},rarity:4},{id:13,name:"药童出身",description:"自幼在丹房长大，日夜与灵药为伴，对药理有超常的敏感。",talent_cost:2,attribute_modifiers:{spirit:1,comprehension:1},rarity:3},{id:14,name:"阵法学徒",description:"师从阵法大师，自小研习阵法纹路，对空间感知极其敏锐。",talent_cost:3,attribute_modifiers:{comprehension:2,spirit:1},rarity:4},{id:15,name:"猎妖世家",description:"祖上世代以猎妖为生，血脉中蕴含微弱的妖族之力，对妖气极其敏感。",talent_cost:4,attribute_modifiers:{root_bone:2,temperament:1},rarity:4},{id:16,name:"流浪乞丐",description:"自幼流落街头，饱经风霜，磨练出超凡的意志和适应能力。",talent_cost:-1,attribute_modifiers:{temperament:2,luck:-1},rarity:2},{id:17,name:"矿奴余生",description:"曾是灵矿奴隶，在暗无天日的矿洞中挣扎求生，体魄强健但缺乏灵性。",talent_cost:0,attribute_modifiers:{root_bone:3,spirit:-1},rarity:2},{id:18,name:"画师传人",description:"师承名家，精通丹青之道，对符箓有天生的理解力。",talent_cost:3,attribute_modifiers:{comprehension:1,charm:2},rarity:3},{id:19,name:"古墓守陵人",description:"世代守护古墓，长期与死气阴气打交道，对鬼道有独特感悟。",talent_cost:2,attribute_modifiers:{temperament:2,spirit:1},rarity:4},{id:20,name:"戏班伶人",description:"自幼学戏，擅长察言观色，魅力非凡，但修道之心不够坚定。",talent_cost:1,attribute_modifiers:{charm:3,temperament:-1},rarity:2},{id:21,name:"星象世家",description:"家族世代观星测运，你自小研习星象之术，对天地规律有独特理解。",talent_cost:5,attribute_modifiers:{comprehension:2,luck:2},rarity:5},{id:22,name:"部落萨满",description:"出身蛮荒部落，继承了萨满的血脉，对自然之力有天生的亲和。",talent_cost:4,attribute_modifiers:{spirit:2,root_bone:1},rarity:4},{id:23,name:"孤岛遗民",description:"生于与世隔绝的孤岛，保留着上古时代的原始修行法门。",talent_cost:3,attribute_modifiers:{temperament:2,comprehension:1},rarity:4},{id:24,name:"亡国遗孤",description:"国破家亡，历经苦难，心性坚韧如铁，但背负着沉重的仇恨。",talent_cost:2,attribute_modifiers:{temperament:3,luck:-1},rarity:3}],i=[{id:1,name:"金灵根",tier:"上品",description:"金曰从革，操控金铁，锋锐无匹。修行金系功法事半功倍，是天生的剑修或刀客胚子，攻击性极强。",cultivation_speed:"1.6x",special_effects:["金系法术威力+50%","器物亲和+30%","金属感知"],base_multiplier:1.6,talent_cost:10,rarity:3},{id:2,name:"木灵根",tier:"上品",description:"木曰曲直，亲和草木，生机盎然。修行木系功法极快，擅长治疗、控制，且对灵植有天生的亲和力。",cultivation_speed:"1.6x",special_effects:["木系法术威力+50%","生命力恢复+40%","植物沟通"],base_multiplier:1.6,talent_cost:10,rarity:3},{id:3,name:"水灵根",tier:"上品",description:"水曰润下，御水之脉，绵延不绝。修行水系功法，法力悠长，变化多端，适应性极强。",cultivation_speed:"1.6x",special_effects:["水系法术威力+50%","灵气恢复+40%","水体感知"],base_multiplier:1.6,talent_cost:10,rarity:3},{id:4,name:"火灵根",tier:"上品",description:"火曰炎上，天生火脉，焚尽八荒。修行火系功法，威力绝伦，爆发力强，是炼丹师的绝佳天赋。",cultivation_speed:"1.6x",special_effects:["火系法术威力+50%","爆发伤害+60%","火焰免疫"],base_multiplier:1.6,talent_cost:10,rarity:3},{id:5,name:"土灵根",tier:"上品",description:"土爰稼穑，大地之子，厚德载物。修行土系功法，防御惊人，稳如泰山，是天生的阵法师材料。",cultivation_speed:"1.6x",special_effects:["土系法术威力+50%","防御力+40%","大地感知"],base_multiplier:1.6,talent_cost:10,rarity:3},{id:9,name:"金灵根",tier:"中品",description:"金行资质尚可，修行金系功法有一定天赋，虽不及上品，但也远超常人。",cultivation_speed:"1.3x",special_effects:["金系法术威力+25%","器物亲和+15%"],base_multiplier:1.3,talent_cost:6,rarity:2},{id:10,name:"火灵根",tier:"中品",description:"火行资质良好，对火系功法有不错的亲和力，能够顺利地踏上修行之路。",cultivation_speed:"1.3x",special_effects:["火系法术威力+25%","爆发伤害+30%"],base_multiplier:1.3,talent_cost:6,rarity:2},{id:11,name:"雷灵根",tier:"极品",description:"万中无一的变异灵根，天生雷体，雷霆万钧。修行雷系功法速度极快，威力绝伦，是天劫的宠儿。",cultivation_speed:"2.0x",special_effects:["雷系法术威力+80%","雷霆免疫","速度+50%","穿透攻击"],base_multiplier:2,talent_cost:15,rarity:4},{id:12,name:"冰灵根",tier:"极品",description:"极为罕见的变异灵根，冰霜之躯，万物凋零。修行冰系功法，控制力超凡，能冰封千里。",cultivation_speed:"2.0x",special_effects:["冰系法术威力+80%","减速效果+100%","冰霜免疫","空间冻结"],base_multiplier:2,talent_cost:15,rarity:4},{id:6,name:"混沌灵根",tier:"神品",description:"传说中的至高灵根，万法归一，包容万象。可修行所有属性功法，无瓶颈，但初期进展缓慢，后期一日千里。",cultivation_speed:"0.8x(前期) → 2.8x(后期)",special_effects:["全系法术亲和","无属性限制","越阶战斗+50%","突破概率+30%"],base_multiplier:2.8,talent_cost:25,rarity:5},{id:7,name:"天妒之体",tier:"特殊",description:"天道所妒，灵气不亲。修行速度极为缓慢，常人难以忍受。但一旦突破，根基无比扎实，战力远超同阶。",cultivation_speed:"0.5x",special_effects:["根基极其稳固","突破后实力暴增+100%","天劫抗性+80%","逆天改命"],base_multiplier:.5,talent_cost:-5,rarity:4},{id:8,name:"五行杂灵根",tier:"凡品",description:"凡人中最常见的灵根，五行皆有，却驳杂不堪，修炼速度慢如龟爬，仙路渺茫。",cultivation_speed:"1.0x",special_effects:["平凡之道","大器晚成"],base_multiplier:1,talent_cost:0,rarity:1},{id:13,name:"风灵根",tier:"下品",description:"较为常见的异种灵根，微风轻抚，虽然资质一般，但胜在灵活多变，身法迅捷。",cultivation_speed:"1.1x",special_effects:["风系法术威力+15%","移动速度+20%"],base_multiplier:1.1,talent_cost:3,rarity:1},{id:14,name:"暗灵根",tier:"极品",description:"极为罕见的变异灵根，与黑暗为伴，掌控阴影之力。修行暗系功法速度极快，擅长隐匿和暗杀。",cultivation_speed:"2.0x",special_effects:["暗系法术威力+80%","隐身能力","暗夜增幅+50%","影遁"],base_multiplier:2,talent_cost:15,rarity:4},{id:15,name:"光灵根",tier:"极品",description:"传说中的圣洁灵根，天生亲近光明，驱邪破煞。修行光系功法事半功倍，对邪祟有天然克制。",cultivation_speed:"2.0x",special_effects:["光系法术威力+80%","邪祟克制+100%","治愈增幅","圣光庇护"],base_multiplier:2,talent_cost:15,rarity:4},{id:16,name:"血灵根",tier:"特殊",description:"邪道灵根，以血为引，修行迅速但需要大量鲜血滋养。容易走火入魔，但力量增长极快。",cultivation_speed:"1.8x",special_effects:["血系法术威力+70%","吸血恢复","嗜血狂化","魔道亲和"],base_multiplier:1.8,talent_cost:10,rarity:4},{id:17,name:"骨灵根",tier:"特殊",description:"罕见的死灵根，天生亲近死气，能够操控骸骨。修行鬼道功法速度极快，但被正道所不容。",cultivation_speed:"1.7x",special_effects:["死灵法术威力+60%","骸骨操控","死气免疫","鬼道天赋"],base_multiplier:1.7,talent_cost:8,rarity:4},{id:18,name:"木灵根",tier:"中品",description:"木行资质尚可，对木系功法有不错的亲和力，能够顺利踏上修行之路。",cultivation_speed:"1.3x",special_effects:["木系法术威力+25%","生命力恢复+20%"],base_multiplier:1.3,talent_cost:6,rarity:2},{id:19,name:"水灵根",tier:"中品",description:"水行资质良好，法力绵延不绝，适应性强，修行较为顺畅。",cultivation_speed:"1.3x",special_effects:["水系法术威力+25%","灵气恢复+20%"],base_multiplier:1.3,talent_cost:6,rarity:2},{id:20,name:"土灵根",tier:"中品",description:"土行资质不错，防御力强，稳扎稳打，是阵法师的良好资质。",cultivation_speed:"1.3x",special_effects:["土系法术威力+25%","防御力+20%"],base_multiplier:1.3,talent_cost:6,rarity:2},{id:21,name:"毒灵根",tier:"极品",description:"极为罕见的变异灵根，天生百毒不侵，修行毒功速度极快，是毒道修士梦寐以求的体质。",cultivation_speed:"2.0x",special_effects:["毒系法术威力+80%","百毒不侵","剧毒增幅","毒素感知"],base_multiplier:2,talent_cost:15,rarity:4},{id:22,name:"双生灵根",tier:"极品",description:"万中无一的双属性灵根，同时拥有两种基础灵根的力量。可修炼两系功法，但初期进展缓慢。",cultivation_speed:"1.8x",special_effects:["双系法术亲和","融合突破+30%","双修加成"],base_multiplier:1.8,talent_cost:14,rarity:4},{id:23,name:"虚空灵根",tier:"神品",description:"传说中的至高灵根之一，掌控虚空法则，可穿梭空间。修行极难但潜力无穷。",cultivation_speed:"0.9x(前期) → 3.0x(后期)",special_effects:["空间法术精通","虚空穿梭","空间锁定","次元斩"],base_multiplier:3,talent_cost:25,rarity:5},{id:24,name:"时间灵根",tier:"神品",description:"最为稀有的传说灵根，触及时间法则。修炼艰难但一旦有成，可逆转岁月，掌控因果。",cultivation_speed:"0.8x(前期) → 3.2x(后期)",special_effects:["时间法术精通","时光倒流","因果推演","时间加速"],base_multiplier:3.2,talent_cost:28,rarity:5},{id:25,name:"星辰灵根",tier:"神品",description:"吸纳星辰之力的稀世灵根，与星空共鸣。修行缓慢但境界稳固，可借星辰之力突破瓶颈。",cultivation_speed:"0.85x(前期) → 2.9x(后期)",special_effects:["星辰之力","星图演化","星光庇护","星陨术"],base_multiplier:2.9,talent_cost:26,rarity:5},{id:26,name:"阴阳灵根",tier:"神品",description:"至高双生灵根，阴阳调和，太极生两仪。可同时修炼阴阳两种功法，融合后威力倍增。",cultivation_speed:"0.9x(前期) → 3.1x(后期)",special_effects:["阴阳调和","两仪归一","太极生威","阴阳逆转"],base_multiplier:3.1,talent_cost:27,rarity:5}],s=[{id:1,name:"天命主角",description:"气运惊人，总是能在绝境中逢生，获得意想不到的机缘。",talent_cost:15,rarity:5,effects:[{类型:"后天六司",目标:"气运",数值:8},{类型:"特殊能力",名称:"逢凶化吉",数值:.1}]},{id:2,name:"剑道独尊",description:"天生剑心通明，任何剑法一看便会，且威力倍增。",talent_cost:12,rarity:5,effects:[{类型:"技能加成",技能:"剑法",数值:.2},{类型:"后天六司",目标:"根骨",数值:3}]},{id:3,name:"丹道圣手",description:"对药理有超凡的领悟力，炼丹成功率与品质大幅提升。",talent_cost:12,rarity:5,effects:[{类型:"技能加成",技能:"炼丹",数值:.15},{类型:"后天六司",目标:"悟性",数值:2}]},{id:4,name:"阵法大师",description:"对阵法有极高的天赋，学习和布置阵法的效率大大提高。",talent_cost:8,rarity:4,effects:[{类型:"技能加成",技能:"阵法",数值:.12},{类型:"后天六司",目标:"悟性",数值:2}]},{id:5,name:"炼器鬼才",description:"天生对各种材料有敏锐的感知，炼器时更容易出现极品。",talent_cost:8,rarity:4,effects:[{类型:"技能加成",技能:"炼器",数值:.1},{类型:"特殊能力",名称:"材料感知",数值:1}]},{id:6,name:"多宝童子",description:"出门历练时，更容易发现天材地宝。",talent_cost:7,rarity:4,effects:[{类型:"后天六司",目标:"气运",数值:3},{类型:"特殊能力",名称:"寻宝天赋",数值:.15}]},{id:7,name:"体修奇才",description:"肉身天生强横，气血旺盛，适合修炼体修功法。",talent_cost:5,rarity:3,effects:[{类型:"后天六司",目标:"根骨",数值:3},{类型:"特殊能力",名称:"体修天赋",数值:.1}]},{id:8,name:"神识过人",description:"天生神识强大，不易被心魔入侵，施展神识秘术效果更佳。",talent_cost:5,rarity:3,effects:[{类型:"后天六司",目标:"悟性",数值:3},{类型:"特殊能力",名称:"心魔抗性",数值:.1}]},{id:9,name:"身法鬼魅",description:"身法飘逸，战斗中闪避能力更强。",talent_cost:4,rarity:3,effects:[{类型:"后天六司",目标:"灵性",数值:2},{类型:"特殊能力",名称:"闪避天赋",数值:.08}]},{id:10,name:"农夫之子",description:"出身凡人，心性坚韧，对灵植有额外的亲和力。",talent_cost:2,rarity:2,effects:[{类型:"后天六司",目标:"心性",数值:1},{类型:"特殊能力",名称:"灵植亲和",数值:.1}]},{id:11,name:"过目不忘",description:"记忆力超群，学习功法秘籍速度加快。",talent_cost:2,rarity:2,effects:[{类型:"后天六司",目标:"悟性",数值:2}]},{id:12,name:"老实人",description:"与人交易时，不容易被欺骗。",talent_cost:1,rarity:1,effects:[{类型:"特殊能力",名称:"防欺诈",数值:1}]},{id:13,name:"一诺千金",description:"你的承诺极具分量，更容易获得他人的信任与好感。",talent_cost:3,rarity:2,effects:[{类型:"后天六司",目标:"魅力",数值:2}]},{id:14,name:"天生毒体",description:"百毒不侵，且能更好地驾驭毒功，但常人不敢轻易接近。",talent_cost:6,rarity:4,effects:[{类型:"特殊能力",名称:"毒素免疫",数值:1},{类型:"技能加成",技能:"毒术",数值:.15},{类型:"后天六司",目标:"魅力",数值:-2}]},{id:15,name:"画龙点睛",description:"在制作符箓时，有一定几率产生意想不到的强大效果。",talent_cost:4,rarity:3,effects:[{类型:"技能加成",技能:"符箓",数值:.1},{类型:"特殊能力",名称:"符箓变异",数值:.05}]},{id:16,name:"顶级魅力",description:"天生丽质，气质非凡，魅力超群。无论走到哪里都是众人瞩目的焦点，极容易获得他人的好感与信任。在社交场合如鱼得水，能够以言语和魅力化解大部分冲突。",talent_cost:8,rarity:4,effects:[{类型:"后天六司",目标:"魅力",数值:5},{类型:"特殊能力",名称:"魅力光环",数值:.2},{类型:"特殊能力",名称:"社交天赋",数值:.15}]},{id:17,name:"道心坚固",description:"道心如铁，心魔难侵。突破时更不容易走火入魔，受到诱惑和幻术影响的几率大幅降低。",talent_cost:6,rarity:4,effects:[{类型:"后天六司",目标:"心性",数值:3},{类型:"特殊能力",名称:"心魔抗性",数值:.3}]},{id:18,name:"天生神力",description:"天生力大无穷，体质远超常人。擅长近战搏杀，气血旺盛。",talent_cost:5,rarity:3,effects:[{类型:"后天六司",目标:"根骨",数值:4},{类型:"特殊能力",名称:"近战增幅",数值:.2}]},{id:19,name:"灵觉敏锐",description:"六感超凡，对危险有本能的预感。在战斗和探险中能够提前感知到威胁。",talent_cost:4,rarity:3,effects:[{类型:"后天六司",目标:"灵性",数值:3},{类型:"特殊能力",名称:"危险感知",数值:1}]},{id:20,name:"夜猫子",description:"夜晚精神百倍，修炼效率提升。但白天会感到困倦。",talent_cost:1,rarity:2,effects:[{类型:"特殊能力",名称:"夜间修炼加速",数值:.3}]},{id:21,name:"天道眷顾",description:"受天道眷顾，突破时成功率更高，遭遇天劫时威力减弱。",talent_cost:10,rarity:5,effects:[{类型:"后天六司",目标:"气运",数值:5},{类型:"特殊能力",名称:"突破成功率",数值:.2},{类型:"特殊能力",名称:"天劫削弱",数值:.15}]},{id:22,name:"剑骨天成",description:"天生剑骨，与剑有莫名的契合。剑法威力倍增，领悟剑意速度极快。",talent_cost:10,rarity:5,effects:[{类型:"后天六司",目标:"根骨",数值:2},{类型:"技能加成",技能:"剑法",数值:.25},{类型:"特殊能力",名称:"剑意感悟",数值:.2}]},{id:23,name:"天生道体",description:"传说中的道体，天生契合天地大道，修炼任何功法都事半功倍。",talent_cost:18,rarity:5,effects:[{类型:"后天六司",目标:"悟性",数值:4},{类型:"后天六司",目标:"灵性",数值:4},{类型:"特殊能力",名称:"万法精通",数值:.3}]},{id:24,name:"符道奇才",description:"对符箓有超凡的领悟，绘制符箓成功率高，威力强大。",talent_cost:7,rarity:4,effects:[{类型:"后天六司",目标:"悟性",数值:2},{类型:"技能加成",技能:"符箓",数值:.2},{类型:"特殊能力",名称:"符箓精通",数值:.15}]},{id:25,name:"灵兽亲和",description:"天生亲和灵兽，更容易收服和沟通灵兽，灵兽战力提升。",talent_cost:6,rarity:4,effects:[{类型:"后天六司",目标:"魅力",数值:2},{类型:"特殊能力",名称:"灵兽契约",数值:.3},{类型:"特殊能力",名称:"灵兽战力",数值:.2}]},{id:26,name:"天生魔心",description:"心性偏向魔道，修炼魔功速度极快，但容易走火入魔。正道功法修炼困难。",talent_cost:5,rarity:4,effects:[{类型:"后天六司",目标:"心性",数值:-2},{类型:"特殊能力",名称:"魔功加速",数值:.4},{类型:"特殊能力",名称:"走火入魔",数值:.15}]},{id:27,name:"器道宗师",description:"对炼器有非凡的天赋，炼制的法器品质更高，成功率更高。",talent_cost:9,rarity:4,effects:[{类型:"后天六司",目标:"悟性",数值:2},{类型:"技能加成",技能:"炼器",数值:.25},{类型:"特殊能力",名称:"极品概率",数值:.1}]},{id:28,name:"孤星命格",description:"天煞孤星，注定孤独一生。气运极低，但在绝境中更容易突破。",talent_cost:-3,rarity:3,effects:[{类型:"后天六司",目标:"气运",数值:-5},{类型:"特殊能力",名称:"绝境突破",数值:.3}]},{id:29,name:"先知梦境",description:"偶尔能在梦中窥见未来的片段，提前规避危险或把握机缘。",talent_cost:8,rarity:5,effects:[{类型:"后天六司",目标:"悟性",数值:2},{类型:"后天六司",目标:"气运",数值:3},{类型:"特殊能力",名称:"预知危险",数值:1}]},{id:30,name:"长生体质",description:"天生寿元悠长，比常人更不易衰老，有更多时间追求大道。",talent_cost:12,rarity:5,effects:[{类型:"后天六司",目标:"根骨",数值:3},{类型:"特殊能力",名称:"寿命延长",数值:.3}]}]},7631:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-e5d5209c] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-e5d5209c]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-e5d5209c] {\n  font-weight: 500;\n}\n.sync-icon[data-v-e5d5209c] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-e5d5209c] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-e5d5209c]:disabled,\n.cloud-sync-button.disabled[data-v-e5d5209c] {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: var(--color-surface);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n}\n.cloud-sync-button.disabled[data-v-e5d5209c]:hover {\n  background: var(--color-surface);\n  border-color: var(--color-border);\n  color: var(--color-text-muted);\n}\n.cloud-sync-button.synced[data-v-e5d5209c]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-e5d5209c] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-e5d5209c] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-e5d5209c] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-e5d5209c] {\n  display: none;\n}\n",""]);const s=i},7659:e=>{"use strict";var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},7677:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},7720:(e,t,n)=>{"use strict";var a=n(4765),r=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},a=0;a<e.length;++a)void 0!==e[a]&&(n[a]=e[a]);return n},l=1024;e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],a=0;a<t.length;++a)for(var r=t[a],i=r.obj[r.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],d=i[c];"object"==typeof d&&null!==d&&-1===n.indexOf(d)&&(t.push({obj:i,prop:c}),n.push(d))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(o(n)){for(var a=[],r=0;r<n.length;++r)void 0!==n[r]&&a.push(n[r]);t.obj[t.prop]=a}}}(t),e},decode:function(e,t,n){var a=e.replace(/\+/g," ");if("iso-8859-1"===n)return a.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(a)}catch(e){return a}},encode:function(e,t,n,r,o){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var c="",d=0;d<s.length;d+=l){for(var u=s.length>=l?s.slice(d,d+l):s,m=[],p=0;p<u.length;++p){var g=u.charCodeAt(p);45===g||46===g||95===g||126===g||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||o===a.RFC1738&&(40===g||41===g)?m[m.length]=u.charAt(p):g<128?m[m.length]=i[g]:g<2048?m[m.length]=i[192|g>>6]+i[128|63&g]:g<55296||g>=57344?m[m.length]=i[224|g>>12]+i[128|g>>6&63]+i[128|63&g]:(p+=1,g=65536+((1023&g)<<10|1023&u.charCodeAt(p)),m[m.length]=i[240|g>>18]+i[128|g>>12&63]+i[128|g>>6&63]+i[128|63&g])}c+=m.join("")}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(o(e)){for(var n=[],a=0;a<e.length;a+=1)n.push(t(e[a]));return n}return t(e)},merge:function e(t,n,a){if(!n)return t;if("object"!=typeof n){if(o(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(a&&(a.plainObjects||a.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var i=t;return o(t)&&!o(n)&&(i=s(t,a)),o(t)&&o(n)?(n.forEach(function(n,o){if(r.call(t,o)){var i=t[o];i&&"object"==typeof i&&n&&"object"==typeof n?t[o]=e(i,n,a):t.push(n)}else t[o]=n}),t):Object.keys(n).reduce(function(t,o){var i=n[o];return r.call(t,o)?t[o]=e(t[o],i,a):t[o]=i,t},i)}}},7754:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])},7760:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>s,q3:()=>o});const a="dad.bundle",r=1;function o(e,t,n){return{schema:a,version:r,type:e,exportedAt:n?.exportedAt??(new Date).toISOString(),appVersion:n?.appVersion,payload:t}}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function s(e){if(function(e){return!!i(e)&&e.schema===a&&e.version===r&&"string"==typeof e.type}(e))return{type:e.type,payload:e.payload,isBundle:!0};if(i(e)&&"string"==typeof e.type){const t=e.type;if("saves"===t&&Array.isArray(e.saves))return{type:"saves",payload:{saves:e.saves},isBundle:!1};if("character"===t&&i(e.character))return{type:"character",payload:e.character,isBundle:!1};if("settings"===t)return{type:"settings",payload:e.settings??e,isBundle:!1};if("prompts"===t)return{type:"prompts",payload:e,isBundle:!1};if("start_config"===t)return{type:"start_config",payload:e,isBundle:!1}}if(i(e)&&Array.isArray(e.presets)&&e.version)return{type:"presets",payload:{presets:e.presets},isBundle:!1};if(i(e)&&!e.type&&!e.schema){const t=Object.keys(e);if(t.length>0&&t.every(t=>"string"==typeof e[t]))return{type:"prompts",payload:e,isBundle:!1}}return i(e),{type:null,payload:e,isBundle:!1}}},7807:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.status-detail-card[data-v-627cf7f9] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.85rem;\n  font-size: 0.85rem;\n}\n.card-header[data-v-627cf7f9] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 10px;\n  border: 1px solid;\n  align-self: flex-start;\n  box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);\n}\n.card-header.buff[data-v-627cf7f9] {\n  background: linear-gradient(135deg, rgba(16, 185, 129, 0.18), rgba(16, 185, 129, 0.08));\n  border-color: rgba(16, 185, 129, 0.35);\n}\n.card-header.debuff[data-v-627cf7f9] {\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.18), rgba(239, 68, 68, 0.08));\n  border-color: rgba(239, 68, 68, 0.35);\n}\n.type-icon[data-v-627cf7f9] {\n  width: 22px;\n  height: 22px;\n  border-radius: 6px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.9rem;\n  font-weight: 700;\n  background: rgba(15, 23, 42, 0.08);\n}\n.type-text[data-v-627cf7f9] {\n  font-size: 0.85rem;\n  font-weight: 600;\n}\n.card-header.buff .type-text[data-v-627cf7f9] { color: #10b981;\n}\n.card-header.debuff .type-text[data-v-627cf7f9] { color: #ef4444;\n}\n.card-body[data-v-627cf7f9] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.9rem;\n}\n.description[data-v-627cf7f9] {\n  padding: 0.75rem 0.9rem;\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.04), rgba(15, 23, 42, 0.02));\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  border-left: 3px solid;\n  line-height: 1.5;\n  color: var(--color-text);\n}\n.description.buff-border[data-v-627cf7f9] { border-color: #10b981;\n}\n.description.debuff-border[data-v-627cf7f9] { border-color: #ef4444;\n}\n.details-grid[data-v-627cf7f9] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.6rem;\n}\n.detail-item[data-v-627cf7f9] {\n  padding: 0.7rem 0.8rem;\n  background: linear-gradient(135deg, rgba(15, 23, 42, 0.02), rgba(15, 23, 42, 0.01));\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.item-label[data-v-627cf7f9] {\n  font-size: 0.7rem;\n  color: var(--color-text-muted);\n  font-weight: 500;\n}\n.item-value[data-v-627cf7f9] {\n  font-size: 0.9rem;\n  font-weight: 600;\n}\n.item-value.source[data-v-627cf7f9] { color: var(--color-accent);\n}\n.item-value.duration[data-v-627cf7f9] { color: var(--color-primary);\n}\n.item-value.time[data-v-627cf7f9] { font-size: 0.75rem; font-weight: 500; color: var(--color-text);\n}\n.strength[data-v-627cf7f9] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.25rem;\n}\n.strength-text[data-v-627cf7f9] { font-size: 0.9rem; font-weight: 700;\n}\n.strength-value[data-v-627cf7f9] { font-size: 0.7rem; color: var(--color-text-secondary);\n}\n.strength-bar[data-v-627cf7f9] {\n  height: 6px;\n  background: rgba(15, 23, 42, 0.08);\n  border-radius: 999px;\n  overflow: hidden;\n}\n.bar-fill[data-v-627cf7f9] {\n  height: 100%;\n  transition: width 0.3s ease;\n  border-radius: 999px;\n}\n@media (max-width: 480px) {\n.status-detail-card[data-v-627cf7f9] {\n    gap: 0.5rem;\n    font-size: 0.75rem;\n}\n.card-header[data-v-627cf7f9] {\n    gap: 0.4rem;\n    padding: 0.35rem 0.55rem;\n    border-radius: 8px;\n}\n.type-icon[data-v-627cf7f9] { width: 20px; height: 20px; font-size: 0.8rem;\n}\n.type-text[data-v-627cf7f9] { font-size: 0.75rem;\n}\n.description[data-v-627cf7f9] {\n    padding: 0.55rem 0.65rem;\n    font-size: 0.75rem;\n}\n.details-grid[data-v-627cf7f9] {\n    grid-template-columns: 1fr;\n    gap: 0.45rem;\n}\n.detail-item[data-v-627cf7f9] {\n    padding: 0.55rem;\n    gap: 0.3rem;\n}\n.item-label[data-v-627cf7f9] { font-size: 0.6rem;\n}\n.item-value[data-v-627cf7f9] { font-size: 0.8rem;\n}\n.item-value.time[data-v-627cf7f9] { font-size: 0.7rem;\n}\n.strength[data-v-627cf7f9] { margin-bottom: 0.1rem;\n}\n.strength-text[data-v-627cf7f9] { font-size: 0.85rem;\n}\n.strength-value[data-v-627cf7f9] { font-size: 0.65rem;\n}\n}\n",""]);const s=i},7816:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.data-display[data-v-3e8f894e] {\n  flex: 1;\n  overflow: auto;\n  padding: 1rem;\n}\n.loading-state[data-v-3e8f894e],\n.no-connection[data-v-3e8f894e],\n.error-state[data-v-3e8f894e] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  padding: 3rem;\n  color: var(--color-text-secondary);\n}\n.retry-btn[data-v-3e8f894e] {\n  padding: 0.5rem 1rem;\n  background: var(--color-primary);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.retry-btn[data-v-3e8f894e]:hover {\n  background: var(--color-primary-hover);\n}\n.hint[data-v-3e8f894e] {\n  font-size: 0.875rem;\n  opacity: 0.7;\n}\n.animate-spin[data-v-3e8f894e] {\n  animation: spin-3e8f894e 1s linear infinite;\n}\n@keyframes spin-3e8f894e {\nfrom {\n    transform: rotate(0deg);\n}\nto {\n    transform: rotate(360deg);\n}\n}\n",""]);const s=i},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7986:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.save-data-section[data-v-68cac9c5] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-68cac9c5] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-68cac9c5] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.save-data-content[data-v-68cac9c5] {\n  flex: 1;\n  overflow: auto;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.75rem;\n}\n.data-tree[data-v-68cac9c5] {\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n}\n.empty-state[data-v-68cac9c5] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n",""]);const s=i},8002:e=>{"use strict";e.exports=Math.min},8068:e=>{"use strict";e.exports=SyntaxError},8091:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(2814),n.b),d=i()(r()),u=l()(c);d.push([e.id,`\n.workshop-container[data-v-7a070651] {\n  width: 100%;\n  min-height: 100vh;\n  min-height: 100svh;\n  height: auto;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem;\n  padding-top: calc(1.5rem + env(safe-area-inset-top));\n  padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));\n  box-sizing: border-box;\n  overflow: auto;\n}\n.workshop-panel[data-v-7a070651] {\n  width: 100%;\n  max-width: 1100px;\n  max-height: 90vh;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 16px;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  padding: 2.5rem;\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.title-row[data-v-7a070651] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.title[data-v-7a070651] {\n  margin: 0;\n  font-family: var(--font-family-serif);\n  font-size: 2rem;\n  color: var(--color-primary);\n}\n.auth-pill[data-v-7a070651] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  user-select: none;\n  white-space: nowrap;\n}\n.auth-pill.ok[data-v-7a070651] {\n  border-color: var(--color-success);\n}\n.auth-pill.ok span[data-v-7a070651] {\n  color: var(--color-success);\n}\n.auth-pill.warn[data-v-7a070651] {\n  border-color: var(--color-warning);\n}\n.auth-pill.warn span[data-v-7a070651]:first-child {\n  color: var(--color-error);\n}\n.pill-link[data-v-7a070651] {\n  border: none;\n  background: transparent;\n  color: var(--color-primary);\n  cursor: pointer;\n  padding: 0;\n}\n.pill-link[data-v-7a070651]:hover {\n  text-decoration: underline;\n}\n.subtitle[data-v-7a070651] {\n  margin: 0.75rem 0 0;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n}\n.notice[data-v-7a070651] {\n  margin: 0.6rem 0 0;\n  color: var(--color-text-muted);\n  font-size: 0.92rem;\n  line-height: 1.6;\n}\n.actions[data-v-7a070651] {\n  margin-top: 2rem;\n  display: flex;\n  justify-content: flex-start;\n  gap: 1rem;\n}\n.btn[data-v-7a070651] {\n  padding: 0.9rem 1.5rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.btn[data-v-7a070651]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.btn[data-v-7a070651]:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n.btn-secondary[data-v-7a070651] {\n  background: var(--color-surface);\n}\n.tabs[data-v-7a070651] {\n  margin-top: 1.25rem;\n  margin-bottom: 1rem;\n  display: flex;\n  gap: 0.75rem;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 6px;\n  flex-shrink: 0;\n}\n.scroll-content[data-v-7a070651] {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.scroll-content[data-v-7a070651]::-webkit-scrollbar {\n  width: 6px;\n}\n.scroll-content[data-v-7a070651]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.scroll-content[data-v-7a070651]::-webkit-scrollbar-thumb {\n  background: rgba(147, 197, 253, 0.3);\n  border-radius: 3px;\n}\n.scroll-content[data-v-7a070651]::-webkit-scrollbar-thumb:hover {\n  background: rgba(147, 197, 253, 0.5);\n}\n.tab[data-v-7a070651] {\n  flex: 1;\n  padding: 0.75rem 1rem;\n  border-radius: 10px;\n  border: 1px solid transparent;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tab.active[data-v-7a070651] {\n  background: var(--color-surface);\n  border-color: var(--color-primary);\n  color: var(--color-text);\n}\n.filters[data-v-7a070651] {\n  margin-top: 1rem;\n  display: grid;\n  grid-template-columns: 160px 1fr 160px auto;\n  gap: 0.75rem;\n  align-items: center;\n}\n.manage-bar[data-v-7a070651] {\n  margin-top: 1rem;\n  padding: 0.75rem 1rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.manage-title[data-v-7a070651] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.manage-meta[data-v-7a070651] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.input[data-v-7a070651] {\n  width: 100%;\n  padding: 0.75rem 0.9rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  outline: none;\n}\nselect.input[data-v-7a070651] {\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  padding-right: 2.5rem;\n  cursor: pointer;\n}\nselect.input option[data-v-7a070651] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  padding: 0.5rem;\n}\n.textarea[data-v-7a070651] {\n  min-height: 84px;\n  resize: vertical;\n}\n.loading[data-v-7a070651] {\n  margin-top: 1.25rem;\n  color: var(--color-text-secondary);\n}\n.empty[data-v-7a070651] {\n  margin-top: 1.25rem;\n  padding: 1rem 1.25rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n}\n.item-list[data-v-7a070651] {\n  margin-top: 1rem;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, 280px);\n  justify-content: center;\n  gap: 0.9rem;\n}\n.item-card[data-v-7a070651] {\n  width: 280px;\n  height: 200px;\n  padding: 1rem 1.1rem;\n  border-radius: 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n}\n.item-top[data-v-7a070651] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n}\n.item-title[data-v-7a070651] {\n  font-weight: 800;\n  font-size: 1.05rem;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  flex: 1;\n  min-width: 0;\n}\n.item-type[data-v-7a070651] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n  padding: 0.2rem 0.6rem;\n  border-radius: 999px;\n  background: var(--color-surface-light);\n  white-space: nowrap;\n}\n.item-desc[data-v-7a070651] {\n  margin-top: 0.5rem;\n  color: var(--color-text-secondary);\n  line-height: 1.6;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  flex-shrink: 0;\n}\n.item-meta[data-v-7a070651] {\n  margin-top: 0.6rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.9rem;\n  color: var(--color-text-muted);\n  font-size: 0.9rem;\n  overflow: hidden;\n  flex-shrink: 0;\n}\n.tags[data-v-7a070651] {\n  margin-top: 0.6rem;\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  overflow: hidden;\n  max-height: 1.8rem;\n  flex-shrink: 0;\n}\n.tag[data-v-7a070651] {\n  font-size: 0.8rem;\n  padding: 0.2rem 0.55rem;\n  border-radius: 999px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n}\n.item-actions[data-v-7a070651] {\n  margin-top: auto;\n  padding-top: 0.5rem;\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.6rem;\n  flex-shrink: 0;\n}\n.btn.danger[data-v-7a070651] {\n  border-color: rgba(239, 68, 68, 0.4);\n  background: rgba(239, 68, 68, 0.12);\n  color: #ef4444;\n}\n.btn.danger[data-v-7a070651]:hover {\n  background: rgba(239, 68, 68, 0.18);\n}\n.pagination[data-v-7a070651] {\n  margin-top: 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n.page-meta[data-v-7a070651] {\n  display: flex;\n  gap: 1rem;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.page-controls[data-v-7a070651] {\n  display: flex;\n  gap: 0.75rem;\n}\n.upload-locked[data-v-7a070651] {\n  margin-top: 1.25rem;\n  padding: 1rem 1.25rem;\n  border-radius: 14px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n}\n.upload-form[data-v-7a070651] {\n  margin-top: 1.25rem;\n  display: grid;\n  gap: 0.9rem;\n}\n.form-row[data-v-7a070651] {\n  display: grid;\n  grid-template-columns: 110px minmax(300px, 600px);\n  gap: 0.75rem;\n  align-items: start;\n}\n.label[data-v-7a070651] {\n  color: var(--color-text);\n  font-weight: 700;\n  font-size: 0.92rem;\n  padding-top: 0.55rem;\n}\n.content-actions[data-v-7a070651] {\n  display: flex;\n  gap: 0.6rem;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.file-btn[data-v-7a070651] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.hint[data-v-7a070651] {\n  color: var(--color-text-muted);\n  font-size: 0.9rem;\n}\n.modal-overlay[data-v-7a070651] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1600;\n  padding: 18px;\n}\n.modal[data-v-7a070651] {\n  width: min(760px, 100%);\n  max-height: 85vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  border-radius: 14px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.55);\n}\n.modal-header[data-v-7a070651] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-header h3[data-v-7a070651] {\n  margin: 0;\n  font-size: 1.05rem;\n  color: var(--color-text);\n}\n.close-btn[data-v-7a070651] {\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text-secondary);\n  width: 32px;\n  height: 32px;\n  border-radius: 10px;\n  cursor: pointer;\n}\n.modal-body[data-v-7a070651] {\n  padding: 1.1rem;\n  overflow: auto;\n}\n.modal-info[data-v-7a070651] {\n  padding: 0.9rem 1rem;\n  border-radius: 12px;\n  background: var(--color-surface-light);\n  border: 1px solid var(--color-border);\n}\n.modal-title[data-v-7a070651] {\n  font-weight: 800;\n  color: var(--color-text);\n}\n.modal-sub[data-v-7a070651] {\n  margin-top: 0.45rem;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.9rem;\n  color: var(--color-text-muted);\n  font-size: 0.9rem;\n}\n.modal-actions[data-v-7a070651] {\n  margin-top: 1rem;\n  display: flex;\n  gap: 0.75rem;\n  flex-wrap: wrap;\n}\n.import-saves[data-v-7a070651] {\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n@media (max-height: 720px) {\n.workshop-container[data-v-7a070651] {\n    align-items: flex-start;\n    justify-content: flex-start;\n}\n.workshop-panel[data-v-7a070651] {\n    padding: 2rem 1.5rem;\n}\n}\n@media (max-height: 600px) {\n.workshop-panel[data-v-7a070651] {\n    padding: 1.5rem 1.25rem;\n}\n}\n@media (max-width: 768px) {\n.workshop-container[data-v-7a070651] {\n    align-items: flex-start;\n    justify-content: flex-start;\n    padding: 1rem;\n    padding-top: calc(1rem + env(safe-area-inset-top));\n    padding-bottom: calc(1rem + env(safe-area-inset-bottom));\n}\n.workshop-panel[data-v-7a070651] { padding: 2rem 1.5rem;\n}\n.filters[data-v-7a070651] { grid-template-columns: 1fr;\n}\n.form-row[data-v-7a070651] { grid-template-columns: 1fr;\n}\n.label[data-v-7a070651] { padding-top: 0;\n}\n}\n@media (max-width: 480px) {\n.workshop-container[data-v-7a070651] {\n    padding: 0.75rem;\n    padding-top: calc(0.75rem + env(safe-area-inset-top));\n    padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));\n}\n.workshop-panel[data-v-7a070651] {\n    padding: 1.5rem 1rem;\n}\n}\n`,""]);const m=d},8092:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.memory-section[data-v-04e0cd04] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n}\n.section-header[data-v-04e0cd04] {\n  margin-bottom: 1rem;\n  flex-shrink: 0;\n}\n.section-title[data-v-04e0cd04] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.memory-content[data-v-04e0cd04] {\n  flex: 1;\n  overflow: hidden;\n}\n.data-display[data-v-04e0cd04] {\n  height: 100%;\n  overflow: hidden;\n}\n.code-pre[data-v-04e0cd04] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  height: 100%;\n  overflow: auto;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.8rem;\n  line-height: 1.4;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.empty-state[data-v-04e0cd04] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--color-text-secondary);\n  text-align: center;\n}\n\n/* 手机端适配 */\n@media (max-width: 640px) {\n.memory-section[data-v-04e0cd04] {\n    padding: 0.75rem;\n}\n.section-title[data-v-04e0cd04] {\n    font-size: 1rem;\n    text-align: center;\n}\n.code-pre[data-v-04e0cd04] {\n    font-size: 0.75rem;\n    padding: 0.5rem;\n}\n.empty-state[data-v-04e0cd04] {\n    padding: 2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.memory-section[data-v-04e0cd04] {\n    padding: 0.5rem;\n}\n.section-title[data-v-04e0cd04] {\n    font-size: 0.9rem;\n}\n.code-pre[data-v-04e0cd04] {\n    font-size: 0.7rem;\n    padding: 0.4rem;\n}\n}\n",""]);const s=i},8133:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("flask-conical",[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]])},8139:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.title-section[data-v-a2b6e2a4] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.preset-count[data-v-a2b6e2a4] {\n  padding: 0.25rem 0.6rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n  font-weight: 600;\n}\n.header-actions[data-v-a2b6e2a4] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.btn-action[data-v-a2b6e2a4] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.5rem 0.9rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.btn-action .btn-icon[data-v-a2b6e2a4] {\n  font-size: 1.1rem;\n  display: flex;\n  align-items: center;\n}\n.btn-action .btn-text[data-v-a2b6e2a4] {\n  white-space: nowrap;\n}\n.btn-action.import[data-v-a2b6e2a4]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.2);\n}\n.btn-action.export[data-v-a2b6e2a4]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.1), rgba(var(--color-primary-rgb), 0.1));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(var(--color-accent-rgb), 0.2);\n}\n.btn-delete[data-v-a2b6e2a4] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0 0.5rem;\n  border-radius: 4px;\n  margin-left: 0.5rem;\n  transition: all 0.2s ease;\n}\n.btn-delete[data-v-a2b6e2a4]:hover {\n  background-color: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n.preset-actions[data-v-a2b6e2a4] {\n  display: flex;\n  align-items: center;\n}\n.modal-overlay[data-v-a2b6e2a4] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-a2b6e2a4] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-a2b6e2a4 0.3s ease-out;\n}\n@keyframes slideUp-a2b6e2a4 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-a2b6e2a4] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-a2b6e2a4] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-a2b6e2a4] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-a2b6e2a4]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-a2b6e2a4] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n  min-height: 200px;\n}\n\n/* Loading State */\n.loading-state[data-v-a2b6e2a4] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  gap: 1rem;\n}\n.spinner[data-v-a2b6e2a4] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-a2b6e2a4 1s linear infinite;\n}\n@keyframes spin-a2b6e2a4 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* Empty State */\n.empty-state[data-v-a2b6e2a4] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 2rem;\n  text-align: center;\n}\n.empty-icon[data-v-a2b6e2a4] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n.empty-state p[data-v-a2b6e2a4] {\n  margin: 0.5rem 0;\n  color: var(--color-text-secondary);\n}\n.empty-hint[data-v-a2b6e2a4] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n  max-width: 300px;\n}\n\n/* Presets List */\n.presets-list[data-v-a2b6e2a4] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.preset-item[data-v-a2b6e2a4] {\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  background: var(--color-surface-light);\n}\n.preset-item[data-v-a2b6e2a4]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n.preset-item.selected[data-v-a2b6e2a4] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n.preset-header[data-v-a2b6e2a4] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.preset-name[data-v-a2b6e2a4] {\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.preset-date[data-v-a2b6e2a4] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.preset-description[data-v-a2b6e2a4] {\n  margin: 0.5rem 0;\n  font-size: 0.9rem;\n  color: var(--color-text-secondary);\n  line-height: 1.4;\n}\n.preset-info[data-v-a2b6e2a4] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  flex-wrap: wrap;\n}\n.info-tag[data-v-a2b6e2a4] {\n  padding: 0.25rem 0.75rem;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.2);\n  border-radius: 12px;\n  font-size: 0.75rem;\n  color: var(--color-primary);\n}\n.info-tag.name-tag[data-v-a2b6e2a4] {\n  background: linear-gradient(135deg, rgba(var(--color-accent-rgb), 0.15), rgba(var(--color-primary-rgb), 0.15));\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n  font-weight: 600;\n}\n.info-tag.age-tag[data-v-a2b6e2a4] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n.modal-footer[data-v-a2b6e2a4] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-a2b6e2a4] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-a2b6e2a4] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-a2b6e2a4]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-a2b6e2a4] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-a2b6e2a4]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-a2b6e2a4]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-a2b6e2a4] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-a2b6e2a4] {\n    padding: 1rem;\n}\n.modal-title[data-v-a2b6e2a4] {\n    font-size: 1.1rem;\n}\n.btn-action .btn-text[data-v-a2b6e2a4] {\n    display: none;\n}\n.btn-action[data-v-a2b6e2a4] {\n    padding: 0.5rem;\n    min-width: 36px;\n}\n.modal-content[data-v-a2b6e2a4] {\n    padding: 1rem;\n}\n.preset-item[data-v-a2b6e2a4] {\n    padding: 0.75rem;\n}\n.modal-footer[data-v-a2b6e2a4] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-a2b6e2a4] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},8233:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.cloud-sync-button[data-v-1f7f5d72] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 0.3rem;\n  padding: 0.5rem 0.8rem;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  color: var(--color-text);\n  font-size: 0.85rem;\n  min-width: 80px;\n  white-space: nowrap;\n}\n.cloud-sync-button[data-v-1f7f5d72]:hover {\n  background: var(--color-surface-lighter);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.sync-text[data-v-1f7f5d72] {\n  font-weight: 500;\n}\n.sync-icon[data-v-1f7f5d72] {\n  font-size: 1em;\n  flex-shrink: 0;\n}\n\n/* 已同步状态样式 */\n.cloud-sync-button.synced[data-v-1f7f5d72] {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-success-rgb), 0.1));\n  border-color: var(--color-success);\n  color: var(--color-success);\n}\n.cloud-sync-button[data-v-1f7f5d72]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.cloud-sync-button.synced[data-v-1f7f5d72]:hover {\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.2), rgba(var(--color-success-rgb), 0.2));\n}\n\n/* Size variants */\n.cloud-sync-button.small[data-v-1f7f5d72] {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.9rem;\n  min-width: 100px;\n}\n.cloud-sync-button.large[data-v-1f7f5d72] {\n  padding: 1rem 1.5rem;\n  font-size: 1.1rem;\n  min-width: 180px;\n}\n\n/* Compact variant */\n.cloud-sync-button.compact[data-v-1f7f5d72] {\n  min-width: auto;\n  padding: 0.5rem;\n}\n.cloud-sync-button.compact .sync-text[data-v-1f7f5d72] {\n  display: none;\n}\n",""]);const s=i},8275:(e,t,n)=>{"use strict";n.d(t,{A:()=>S});var a=n(4061),r=n(9173),o=n(6494);const i={class:"modal-header"},s={class:"modal-title"},l={class:"modal-content"},c=["innerHTML"],d=(0,a.defineComponent)({__name:"DetailModal",setup(e){const t=(0,r.useUIStore)(),n=()=>{t.hideDetailModal()};return(e,r)=>((0,a.openBlock)(),(0,a.createBlock)(a.Transition,{name:"modal-fade"},{default:(0,a.withCtx)(()=>[(0,a.unref)(t).showDetailModalState?((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:0,class:"modal-overlay",onClick:n},[(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["modal-container",(0,a.unref)(t).detailModalClass]),onClick:r[0]||(r[0]=(0,a.withModifiers)(()=>{},["stop"]))},[(0,a.createElementVNode)("div",i,[(0,a.createElementVNode)("h3",s,(0,a.toDisplayString)((0,a.unref)(t).detailModalTitle),1),(0,a.createElementVNode)("button",{class:"modal-close-button",onClick:n},[r[1]||(r[1]=(0,a.createElementVNode)("span",null,"关闭",-1)),(0,a.createVNode)((0,a.unref)(o.A),{size:16})])]),(0,a.createElementVNode)("div",l,[(0,a.createCommentVNode)(" Render component if provided "),(0,a.unref)(t).detailModalComponent?((0,a.openBlock)(),(0,a.createBlock)((0,a.resolveDynamicComponent)((0,a.unref)(t).detailModalComponent),(0,a.normalizeProps)((0,a.mergeProps)({key:0},(0,a.unref)(t).detailModalProps)),null,16)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(" Fallback to HTML content "),(0,a.createElementVNode)("div",{innerHTML:(0,a.unref)(t).detailModalContent},null,8,c)],2112))])],2)])):(0,a.createCommentVNode)("v-if",!0)]),_:1}))}});var u=n(5072),m=n.n(u),p=n(7825),g=n.n(p),h=n(7659),f=n.n(h),v=n(5056),b=n.n(v),y=n(540),x=n.n(y),k=n(1113),w=n.n(k),E=n(5192),N={};N.styleTagTransform=w(),N.setAttributes=b(),N.insert=f().bind(null,"head"),N.domAPI=g(),N.insertStyleElement=x(),m()(E.A,N),E.A&&E.A.locals&&E.A.locals;const S=(0,n(6262).A)(d,[["__scopeId","data-v-210f912a"]])},8345:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.prompt-panel[data-v-8a368f36] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: var(--color-background);\n}\n\n/* 联机模式警告样式 */\n.online-mode-warning[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(251, 191, 36, 0.15);\n  border-bottom: 1px solid rgba(251, 191, 36, 0.3);\n  color: #fbbf24;\n}\n.online-mode-warning .warning-icon[data-v-8a368f36] {\n  font-size: 1rem;\n}\n.online-mode-warning .warning-text[data-v-8a368f36] {\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n\n/* 只读模式样式 */\n.prompt-textarea.readonly-mode[data-v-8a368f36] {\n  opacity: 0.7;\n  cursor: not-allowed;\n  background: var(--color-surface-disabled, rgba(100, 100, 100, 0.1));\n}\n.btn-small[data-v-8a368f36]:disabled,\n.action-btn-compact[data-v-8a368f36]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.panel-header.compact[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface);\n}\n.panel-title-compact[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 1;\n}\n.title-text[data-v-8a368f36] {\n  font-size: 0.92rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.panel-actions[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.action-btn-compact[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn-compact[data-v-8a368f36]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n  color: var(--color-primary);\n}\n.action-btn-compact.primary[data-v-8a368f36] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.action-btn-compact.primary[data-v-8a368f36]:hover {\n  background: var(--color-primary-hover);\n}\n.prompt-list[data-v-8a368f36] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n}\n\n/* 分类样式 */\n.category-section[data-v-8a368f36] {\n  margin-bottom: 1.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  overflow: hidden;\n  background: var(--color-surface);\n}\n.category-header[data-v-8a368f36] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-surface-hover) 100%);\n  cursor: pointer;\n  user-select: none;\n  transition: all 0.2s;\n}\n.category-header[data-v-8a368f36]:hover {\n  background: var(--color-surface-hover);\n}\n.category-title[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.category-icon[data-v-8a368f36] {\n  font-size: 1.25rem;\n}\n.category-name[data-v-8a368f36] {\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--color-text);\n}\n.category-count[data-v-8a368f36] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 0.2rem 0.5rem;\n  border-radius: 10px;\n}\n.category-actions[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.category-desc[data-v-8a368f36] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.expand-icon[data-v-8a368f36] {\n  transition: transform 0.3s ease;\n  color: var(--color-text-secondary);\n}\n.expand-icon.expanded[data-v-8a368f36] {\n  transform: rotate(180deg);\n}\n.category-content[data-v-8a368f36] {\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n\n/* 提示词项目样式 */\n.prompt-item[data-v-8a368f36] {\n  border-bottom: 1px solid var(--color-border);\n}\n.prompt-item[data-v-8a368f36]:last-child {\n  border-bottom: none;\n}\n.prompt-header[data-v-8a368f36] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.875rem 1.25rem;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n.prompt-header[data-v-8a368f36]:hover {\n  background: var(--color-surface-hover);\n}\n.prompt-title-area[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n/* 开关样式 */\n.toggle-switch[data-v-8a368f36] {\n  position: relative;\n  display: inline-block;\n  width: 36px;\n  height: 20px;\n  flex-shrink: 0;\n}\n.toggle-switch input[data-v-8a368f36] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.toggle-slider[data-v-8a368f36] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: var(--color-border);\n  transition: 0.3s;\n  border-radius: 20px;\n}\n.toggle-slider[data-v-8a368f36]:before {\n  position: absolute;\n  content: \"\";\n  height: 14px;\n  width: 14px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.3s;\n  border-radius: 50%;\n}\n.toggle-switch input:checked + .toggle-slider[data-v-8a368f36] {\n  background-color: var(--color-primary);\n}\n.toggle-switch input:checked + .toggle-slider[data-v-8a368f36]:before {\n  transform: translateX(16px);\n}\n.toggle-switch:hover .toggle-slider[data-v-8a368f36] {\n  box-shadow: 0 0 4px rgba(var(--color-primary-rgb), 0.4);\n}\n.prompt-order[data-v-8a368f36] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 24px;\n  height: 24px;\n  padding: 0 6px;\n  background: var(--color-primary);\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n  border-radius: 6px;\n}\n.prompt-title[data-v-8a368f36] {\n  font-weight: 500;\n  color: var(--color-text);\n  transition: opacity 0.2s;\n}\n.prompt-title.disabled[data-v-8a368f36] {\n  opacity: 0.5;\n  text-decoration: line-through;\n}\n.prompt-meta[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.prompt-desc[data-v-8a368f36] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.prompt-status[data-v-8a368f36] {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n}\n.prompt-status.modified[data-v-8a368f36] {\n  background: rgba(var(--color-warning-rgb), 0.2);\n  color: var(--color-warning);\n}\n\n/* 权重编辑器 */\n.weight-editor[data-v-8a368f36] {\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n.weight-label[data-v-8a368f36] {\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: var(--color-text-secondary);\n}\n.weight-input[data-v-8a368f36] {\n  width: 36px;\n  height: 22px;\n  padding: 0 4px;\n  border: 1px solid transparent;\n  border-radius: 4px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  text-align: center;\n  background: transparent;\n  transition: all 0.2s;\n  -moz-appearance: textfield;\n}\n.weight-input[data-v-8a368f36]::-webkit-outer-spin-button,\n.weight-input[data-v-8a368f36]::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.weight-input[data-v-8a368f36]:hover {\n  border-color: var(--color-border);\n  background: var(--color-surface);\n}\n.weight-input[data-v-8a368f36]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n.weight-input[data-v-8a368f36]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.weight-input.weight-high[data-v-8a368f36] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #ef4444;\n}\n.weight-input.weight-medium[data-v-8a368f36] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #eab308;\n}\n.weight-input.weight-low[data-v-8a368f36] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #22c55e;\n}\n.prompt-content[data-v-8a368f36] {\n  padding: 1rem 1.25rem;\n  background: var(--color-background);\n  border-top: 1px solid var(--color-border);\n}\n.prompt-description-full[data-v-8a368f36] {\n  margin-bottom: 0.75rem;\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border-radius: 6px;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  line-height: 1.5;\n}\n.prompt-textarea[data-v-8a368f36] {\n  width: 100%;\n  min-height: 400px;\n  padding: 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 0.85rem;\n  line-height: 1.6;\n  resize: vertical;\n}\n.prompt-textarea[data-v-8a368f36]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.2);\n}\n.prompt-actions[data-v-8a368f36] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  justify-content: flex-end;\n}\n.btn-small[data-v-8a368f36] {\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  transition: all 0.2s;\n}\n.btn-small[data-v-8a368f36]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-primary);\n}\n.btn-small.btn-primary[data-v-8a368f36] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.btn-small.btn-primary[data-v-8a368f36]:hover {\n  background: var(--color-primary-hover);\n}\n\n/* 响应式适配 */\n@media (max-width: 768px) {\n.category-header[data-v-8a368f36] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.category-actions[data-v-8a368f36] {\n    width: 100%;\n    justify-content: space-between;\n}\n.prompt-header[data-v-8a368f36] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.prompt-meta[data-v-8a368f36] {\n    width: 100%;\n    justify-content: space-between;\n}\n.prompt-desc[data-v-8a368f36] {\n    max-width: 150px;\n}\n.prompt-textarea[data-v-8a368f36] {\n    min-height: 300px;\n}\n}\n",""]);const s=i},8381:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("scroll-text",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]])},8396:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o),s=n(4417),l=n.n(s),c=new URL(n(7044),n.b),d=i()(r()),u=l()(c);d.push([e.id,`/*\n * 超凡新生 - 现代化设计系统\n * Modern Design System for TranscendentRebirth\n */\n\n/* ========== 基础按钮 ========== */\n.btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  line-height: 1.5;\n  border-radius: 8px;\n  border: 1px solid transparent;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n.btn:focus-visible {\n  outline: 2px solid var(--color-primary);\n  outline-offset: 2px;\n}\n\n/* 按钮变体 */\n.btn-primary {\n  background: var(--color-primary);\n  color: #fff;\n  border-color: var(--color-primary);\n}\n.btn-primary:hover:not(:disabled) {\n  filter: brightness(1.1);\n  transform: translateY(-1px);\n}\n\n.btn-secondary {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border-color: var(--color-border);\n}\n.btn-secondary:hover:not(:disabled) {\n  border-color: var(--color-primary);\n  background: var(--color-background);\n}\n\n.btn-ghost {\n  background: transparent;\n  color: var(--color-text-secondary);\n  border-color: transparent;\n}\n.btn-ghost:hover:not(:disabled) {\n  background: var(--color-surface);\n  color: var(--color-text);\n}\n\n.btn-danger {\n  background: #ef4444;\n  color: #fff;\n  border-color: #ef4444;\n}\n.btn-danger:hover:not(:disabled) {\n  background: #dc2626;\n}\n\n.btn-success {\n  background: #22c55e;\n  color: #fff;\n  border-color: #22c55e;\n}\n.btn-success:hover:not(:disabled) {\n  background: #16a34a;\n}\n\n/* 按钮尺寸 */\n.btn-xs { padding: 0.25rem 0.5rem; font-size: 0.75rem; }\n.btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }\n.btn-lg { padding: 0.75rem 1.5rem; font-size: 1rem; }\n\n/* 图标按钮 */\n.btn-icon {\n  padding: 0.5rem;\n  border-radius: 8px;\n}\n.btn-icon.btn-sm { padding: 0.375rem; }\n.btn-icon.btn-xs { padding: 0.25rem; }\n\n/* ========== 表单控件 ========== */\n.input {\n  width: 100%;\n  padding: 0.625rem 0.875rem;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text);\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n\n.input:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);\n}\n\n.input::placeholder {\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n.input:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  background: var(--color-surface);\n}\n\n/* 输入框尺寸 */\n.input-sm { padding: 0.375rem 0.625rem; font-size: 0.8125rem; }\n.input-lg { padding: 0.75rem 1rem; font-size: 1rem; }\n\n/* 选择框 */\n.select {\n  appearance: none;\n  background-image: url(${u});\n  background-repeat: no-repeat;\n  background-position: right 0.75rem center;\n  background-size: 16px;\n  padding-right: 2.5rem;\n}\n\n/* 表单组 */\n.form-group {\n  margin-bottom: 1rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.375rem;\n  font-size: 0.8125rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n}\n\n.form-hint {\n  margin-top: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n\n/* ========== 卡片 ========== */\n.card {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid var(--color-border);\n}\n\n.card-title {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n\n.card-body {\n  padding: 1.25rem;\n}\n\n.card-footer {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-background);\n}\n\n/* 卡片变体 */\n.card-flat {\n  border: none;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.card-interactive {\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.card-interactive:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n/* ========== 标签页 ========== */\n.tabs {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.tabs-list {\n  display: flex;\n  gap: 0.25rem;\n  padding: 0.5rem;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n}\n\n.tab-trigger {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text-secondary);\n  background: transparent;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.tab-trigger:hover {\n  background: var(--color-background);\n  color: var(--color-text);\n}\n\n.tab-trigger[data-state="active"],\n.tab-trigger.active {\n  background: var(--color-primary);\n  color: #fff;\n}\n\n.tabs-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n}\n\n/* ========== 徽章 ========== */\n.badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.125rem 0.5rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  line-height: 1.5;\n  border-radius: 9999px;\n  white-space: nowrap;\n}\n\n.badge-default {\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n}\n\n.badge-primary {\n  background: rgba(var(--color-primary-rgb), 0.15);\n  color: var(--color-primary);\n}\n\n.badge-success {\n  background: rgba(34, 197, 94, 0.15);\n  color: #22c55e;\n}\n\n.badge-warning {\n  background: rgba(245, 158, 11, 0.15);\n  color: #f59e0b;\n}\n\n.badge-danger {\n  background: rgba(239, 68, 68, 0.15);\n  color: #ef4444;\n}\n\n.badge-info {\n  background: rgba(59, 130, 246, 0.15);\n  color: #3b82f6;\n}\n\n/* ========== 统计卡片 ========== */\n.stat-card {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem 1.25rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n}\n\n.stat-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-primary);\n}\n\n.stat-content {\n  flex: 1;\n}\n\n.stat-value {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  line-height: 1.2;\n}\n\n.stat-label {\n  font-size: 0.8125rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.125rem;\n}\n\n/* ========== 列表项 ========== */\n.list-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.list-item:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface);\n}\n\n.list-item.active {\n  border-color: var(--color-primary);\n  background: rgba(var(--color-primary-rgb), 0.05);\n}\n\n.list-item-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  border-radius: 8px;\n  background: var(--color-surface);\n  color: var(--color-text-secondary);\n}\n\n.list-item-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.list-item-title {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--color-text);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.list-item-subtitle {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.125rem;\n}\n\n.list-item-action {\n  color: var(--color-text-secondary);\n}\n\n/* ========== 空状态 ========== */\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem 1.5rem;\n  text-align: center;\n}\n\n.empty-icon {\n  color: var(--color-text-secondary);\n  opacity: 0.4;\n  margin-bottom: 1rem;\n}\n\n.empty-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--color-text);\n  margin-bottom: 0.5rem;\n}\n\n.empty-description {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n  max-width: 300px;\n}\n\n.empty-actions {\n  display: flex;\n  gap: 0.75rem;\n  margin-top: 1.5rem;\n}\n\n/* ========== 分割线 ========== */\n.divider {\n  height: 1px;\n  background: var(--color-border);\n  margin: 1rem 0;\n}\n\n.divider-vertical {\n  width: 1px;\n  height: auto;\n  align-self: stretch;\n  margin: 0 0.75rem;\n}\n\n/* ========== 工具类 ========== */\n.text-muted { color: var(--color-text-secondary); }\n.text-primary { color: var(--color-primary); }\n.text-success { color: #22c55e; }\n.text-warning { color: #f59e0b; }\n.text-danger { color: #ef4444; }\n\n.font-medium { font-weight: 500; }\n.font-semibold { font-weight: 600; }\n.font-bold { font-weight: 700; }\n\n.text-xs { font-size: 0.75rem; }\n.text-sm { font-size: 0.875rem; }\n.text-base { font-size: 1rem; }\n.text-lg { font-size: 1.125rem; }\n\n.flex { display: flex; }\n.flex-col { flex-direction: column; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n.gap-1 { gap: 0.25rem; }\n.gap-2 { gap: 0.5rem; }\n.gap-3 { gap: 0.75rem; }\n.gap-4 { gap: 1rem; }\n\n/* ========== 动画 ========== */\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes slideUp {\n  from { opacity: 0; transform: translateY(10px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.5; }\n}\n\n.animate-fadeIn { animation: fadeIn 0.2s ease; }\n.animate-slideUp { animation: slideUp 0.3s ease; }\n.animate-pulse { animation: pulse 2s infinite; }\n\n/* ========== 滚动条 ========== */\n.scrollbar-thin {\n  scrollbar-width: thin;\n  scrollbar-color: var(--color-border) transparent;\n}\n\n.scrollbar-thin::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.scrollbar-thin::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.scrollbar-thin::-webkit-scrollbar-thumb {\n  background: var(--color-border);\n  border-radius: 3px;\n}\n\n.scrollbar-thin::-webkit-scrollbar-thumb:hover {\n  background: var(--color-text-secondary);\n}\n\n`,""]);const m=d},8470:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-01a0fb92] {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-01a0fb92] {\n  background: var(--color-background);\n  border-radius: 12px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  max-width: 500px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-header[data-v-01a0fb92] {\n  padding: 1.5rem 1.5rem 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.modal-header h3[data-v-01a0fb92] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-01a0fb92] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 6px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-01a0fb92] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n}\n.form-group[data-v-01a0fb92] {\n  margin-bottom: 1rem;\n}\n.form-group label[data-v-01a0fb92] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.form-input[data-v-01a0fb92] {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  outline: none;\n  transition: border-color 0.2s;\n}\n.form-input[data-v-01a0fb92]:focus {\n  border-color: var(--color-primary);\n}\n.form-textarea[data-v-01a0fb92] {\n  width: 100%;\n  min-height: 150px;\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.875rem;\n  font-family: 'Consolas', 'Monaco', monospace;\n  outline: none;\n  transition: border-color 0.2s;\n  resize: vertical;\n}\n.form-textarea[data-v-01a0fb92]:focus {\n  border-color: var(--color-primary);\n}\n.form-hint-text[data-v-01a0fb92] {\n  margin: 0.25rem 0 0 0;\n  font-size: 0.75rem;\n  color: var(--color-info);\n}\n.value-type-selector[data-v-01a0fb92] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.75rem;\n  flex-wrap: wrap;\n}\n.type-btn[data-v-01a0fb92] {\n  padding: 0.375rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 0.75rem;\n  transition: all 0.2s;\n}\n.type-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-primary);\n  color: var(--color-text);\n}\n.type-btn.active[data-v-01a0fb92] {\n  background: var(--color-primary);\n  border-color: var(--color-primary);\n  color: white;\n  font-weight: 500;\n}\n.form-textarea.has-error[data-v-01a0fb92] {\n  border-color: var(--color-danger);\n}\n.error-message[data-v-01a0fb92] {\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid var(--color-danger);\n  border-radius: 4px;\n  color: var(--color-danger);\n  font-size: 0.75rem;\n}\n.form-hint[data-v-01a0fb92] {\n  margin-top: 0.5rem;\n}\n.form-hint p[data-v-01a0fb92] {\n  margin: 0;\n  font-size: 0.75rem;\n  color: var(--color-success);\n}\n.preview-section[data-v-01a0fb92] {\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n.preview-section label[data-v-01a0fb92] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: var(--color-text);\n  font-size: 0.875rem;\n}\n.preview-content[data-v-01a0fb92] {\n  margin: 0;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text);\n  font-size: 0.75rem;\n  font-family: 'Consolas', 'Monaco', monospace;\n  max-height: 150px;\n  overflow: auto;\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n.modal-footer[data-v-01a0fb92] {\n  padding: 1rem 1.5rem;\n  border-top: 1px solid var(--color-border);\n  display: flex;\n  gap: 0.75rem;\n  justify-content: flex-end;\n}\n.cancel-btn[data-v-01a0fb92] {\n  padding: 0.75rem 1.5rem;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: transparent;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.cancel-btn[data-v-01a0fb92]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-text-secondary);\n  color: var(--color-text);\n}\n.save-btn[data-v-01a0fb92] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: var(--color-primary);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  cursor: pointer;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.2s;\n}\n.save-btn[data-v-01a0fb92]:hover:not(:disabled) {\n  background: var(--color-primary-hover);\n  transform: translateY(-1px);\n}\n.save-btn[data-v-01a0fb92]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n",""]);const s=i},8507:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'/*\n * 超凡新生 - 仪表板面板科技风格\n * Dashboard Panels Tech Style\n * 针对 SettingsPanel, APIManagementPanel 等面板的科技风格覆盖\n */\n\n/* ========== SettingsPanel 科技风格 ========== */\n\n.settings-panel {\n  background: var(--tech-background) !important;\n  color: var(--tech-primary);\n}\n\n.panel-header {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.8), rgba(10, 14, 39, 0.8)) !important;\n  border: 2px solid var(--tech-primary) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.1) !important;\n  position: relative;\n}\n\n.panel-header::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n}\n\n.panel-title {\n  color: var(--tech-primary) !important;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.4) !important;\n}\n\n.settings-subtitle {\n  color: rgba(0, 217, 255, 0.6) !important;\n}\n\n.action-btn {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.05)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  transition: all 0.3s ease !important;\n}\n\n.action-btn:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.1)) !important;\n  border-color: var(--tech-primary) !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3) !important;\n}\n\n.action-btn.primary {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.1)) !important;\n  border-color: var(--tech-primary) !important;\n  color: #fff !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3) !important;\n}\n\n.action-btn.primary:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(157, 0, 255, 0.15)) !important;\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4) !important;\n}\n\n.settings-container {\n  scrollbar-color: rgba(0, 217, 255, 0.3) transparent !important;\n}\n\n.settings-container::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, var(--tech-primary), var(--tech-secondary)) !important;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.3) !important;\n}\n\n.settings-section {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.7), rgba(10, 14, 39, 0.7)) !important;\n  border: 1px solid var(--tech-border) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.05) !important;\n}\n\n.section-header {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.05)) !important;\n  border-bottom: 1px solid var(--tech-border) !important;\n}\n\n.section-title {\n  color: var(--tech-primary) !important;\n  text-shadow: 0 0 8px rgba(0, 217, 255, 0.3) !important;\n}\n\n.setting-item {\n  border-radius: 4px !important;\n  transition: all 0.3s ease !important;\n}\n\n.setting-item:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08), rgba(157, 0, 255, 0.05)) !important;\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.1) !important;\n}\n\n.setting-name {\n  color: var(--tech-primary) !important;\n  font-weight: 600 !important;\n}\n\n.setting-desc {\n  color: rgba(0, 217, 255, 0.6) !important;\n}\n\n/* 表单控件 */\n.setting-select,\n.setting-input,\ninput[type="text"],\ninput[type="number"],\nselect,\ntextarea {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  transition: all 0.3s ease !important;\n}\n\n.setting-select::placeholder,\n.setting-input::placeholder,\ninput::placeholder,\ntextarea::placeholder {\n  color: rgba(0, 217, 255, 0.3) !important;\n}\n\n.setting-select:focus,\n.setting-input:focus,\ninput:focus,\nselect:focus,\ntextarea:focus {\n  outline: none !important;\n  border-color: var(--tech-primary) !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1) !important;\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(15, 21, 53, 0.8)) !important;\n}\n\n/* 开关按钮 */\ninput[type="checkbox"],\ninput[type="radio"] {\n  accent-color: var(--tech-primary) !important;\n}\n\n/* 滑块 */\n.setting-range,\ninput[type="range"] {\n  accent-color: var(--tech-primary) !important;\n}\n\ninput[type="range"] {\n  background: linear-gradient(90deg, var(--tech-primary), var(--tech-accent)) !important;\n}\n\n/* 按钮 */\n.settings-panel button:not(.action-btn),\n.settings-panel .btn {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.1)) !important;\n  border: 2px solid var(--tech-primary) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  font-weight: 600 !important;\n  transition: all 0.3s ease !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2) !important;\n}\n\n.settings-panel button:not(.action-btn):hover,\n.settings-panel .btn:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15)) !important;\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4) !important;\n}\n\n/* ========== APIManagementPanel 科技风格 ========== */\n\n.api-management-panel,\n[class*="api-panel"],\n[class*="APIManagement"] {\n  background: var(--tech-background) !important;\n  color: var(--tech-primary);\n}\n\n.api-panel-header,\n[class*="api-header"],\n[class*="panel-header"] {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.8), rgba(10, 14, 39, 0.8)) !important;\n  border: 2px solid var(--tech-primary) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.1) !important;\n}\n\n.api-form,\n[class*="form"] {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.7), rgba(10, 14, 39, 0.7)) !important;\n  border: 1px solid var(--tech-border) !important;\n  border-radius: 4px !important;\n}\n\n.api-form-group,\n[class*="form-group"],\n[class*="form-item"] {\n  border-radius: 4px !important;\n}\n\n.api-form-group label,\n[class*="form-group"] label {\n  color: var(--tech-primary) !important;\n  font-weight: 600 !important;\n  text-shadow: 0 0 5px rgba(0, 217, 255, 0.3) !important;\n}\n\n/* ========== 其他面板通用样式 ========== */\n\n.right-sidebar,\n.dashboard-panel,\n[class*="panel"],\n[class*="Panel"] {\n  background: var(--tech-background) !important;\n  color: var(--tech-primary);\n}\n\n[class*="panel-title"],\n[class*="panel"] h2,\n[class*="panel"] h3,\n[class*="panel"] h4 {\n  color: var(--tech-primary) !important;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.3) !important;\n}\n\n[class*="panel"] .card,\n[class*="panel-content"] .card {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.7), rgba(10, 14, 39, 0.7)) !important;\n  border: 1px solid var(--tech-border) !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.05) !important;\n  border-radius: 4px !important;\n}\n\n[class*="panel"] .card:hover,\n[class*="panel-content"] .card:hover {\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.15) !important;\n  border-color: var(--tech-primary) !important;\n}\n\n[class*="panel"] button,\n[class*="panel"] .btn {\n  border-radius: 4px !important;\n}\n\n/* ========== 标签和徽章 ========== */\n\n[class*="tag"],\n[class*="badge"],\n[class*="label"] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 3px !important;\n}\n\n/* ========== 文本颜色 ========== */\n\n[class*="panel"] .text-muted,\n[class*="panel"] .text-secondary {\n  color: rgba(0, 217, 255, 0.6) !important;\n}\n\n[class*="panel"] .text-primary {\n  color: var(--tech-primary) !important;\n}\n\n[class*="panel"] .text-success {\n  color: var(--tech-success) !important;\n}\n\n[class*="panel"] .text-warning {\n  color: var(--tech-warning) !important;\n}\n\n[class*="panel"] .text-danger {\n  color: var(--tech-danger) !important;\n}\n\n/* ========== 分割线 ========== */\n\n[class*="panel"] .divider,\n[class*="panel"] hr {\n  background: linear-gradient(90deg, transparent, var(--tech-border), transparent) !important;\n  border: none !important;\n}\n\n/* ========== Select 下拉菜单选项 ========== */\n\n[class*="panel"] select option,\n.settings-panel select option,\n.dashboard-panel select option {\n  background: #0a0e27 !important;\n  color: var(--tech-primary) !important;\n  border: none;\n  padding: 8px 6px;\n}\n\n[class*="panel"] select option:hover,\n[class*="panel"] select option:focus,\n[class*="panel"] select option:checked,\n.settings-panel select option:hover,\n.settings-panel select option:focus,\n.settings-panel select option:checked,\n.dashboard-panel select option:hover,\n.dashboard-panel select option:focus,\n.dashboard-panel select option:checked {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15)) !important;\n  color: var(--tech-primary) !important;\n}\n\n/* ========== 响应式调整 ========== */\n\n@media (max-width: 768px) {\n  .settings-panel {\n    padding: 0.75rem !important;\n  }\n\n  .panel-header {\n    flex-direction: column !important;\n    gap: 0.75rem !important;\n  }\n\n  .header-actions {\n    width: 100% !important;\n    justify-content: flex-end !important;\n  }\n}\n',""]);const s=i},8537:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-594e2d00] {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.modal-content[data-v-594e2d00] {\n  background: var(--color-background);\n  border-radius: 12px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  max-width: 500px;\n  width: 90%;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.modal-content.stats-modal[data-v-594e2d00] {\n  max-width: 600px;\n}\n.modal-header[data-v-594e2d00] {\n  padding: 1.5rem 1.5rem 1rem 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.modal-header h3[data-v-594e2d00] {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.close-btn[data-v-594e2d00] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 6px;\n  transition: all 0.2s;\n}\n.close-btn[data-v-594e2d00]:hover {\n  background: var(--color-hover);\n  color: var(--color-text);\n}\n.modal-body[data-v-594e2d00] {\n  padding: 1.5rem;\n  overflow-y: auto;\n  flex: 1;\n}\n.stats-grid[data-v-594e2d00] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 2rem;\n}\n.stat-card[data-v-594e2d00] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s;\n}\n.stat-card[data-v-594e2d00]:hover {\n  background: var(--color-hover);\n  border-color: var(--color-primary);\n}\n.stat-icon[data-v-594e2d00] {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.stat-icon.core[data-v-594e2d00] {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n}\n.stat-icon.global[data-v-594e2d00] {\n  background: rgba(34, 197, 94, 0.1);\n  color: #22c55e;\n}\n.stat-icon.memory[data-v-594e2d00] {\n  background: rgba(168, 85, 247, 0.1);\n  color: #a855f7;\n}\n.stat-icon.world[data-v-594e2d00] {\n  background: rgba(245, 158, 11, 0.1);\n  color: #f59e0b;\n}\n.stat-info[data-v-594e2d00] {\n  flex: 1;\n}\n.stat-value[data-v-594e2d00] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: var(--color-text);\n  margin-bottom: 0.25rem;\n}\n.stat-label[data-v-594e2d00] {\n  font-size: 0.875rem;\n  color: var(--color-text-secondary);\n}\n.data-size-info[data-v-594e2d00] {\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.data-size-info h4[data-v-594e2d00] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.95rem;\n  color: var(--color-text);\n}\n.size-list[data-v-594e2d00] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.size-item[data-v-594e2d00] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid var(--color-border);\n}\n.size-item[data-v-594e2d00]:last-child {\n  border-bottom: none;\n}\n.size-item span[data-v-594e2d00]:first-child {\n  color: var(--color-text-secondary);\n  font-size: 0.875rem;\n}\n.size-item span[data-v-594e2d00]:last-child {\n  color: var(--color-text);\n  font-weight: 500;\n  font-size: 0.875rem;\n}\n",""]);const s=i},8546:(e,t,n)=>{"use strict";function a(){return function(e){let t=e.trim();return t?(t=t.replace(/\/api\/v1\/?$/i,""),t=t.replace(/\/+$/,""),t):""}("http://152.32.213.82:12345")}function r(){return!!a()}function o(e){const t=a();return t?`${t}${e.startsWith("/")?e:`/${e}`}`:""}async function i(){const e=a();if(!e)return null;try{const t=await fetch(`${e}/api/v1/version`,{method:"GET"});if(!t.ok)return null;const n=await t.json();if(n&&void 0!==n.version)return String(n.version)}catch{return null}return null}n.d(t,{d9:()=>i,isBackendConfigured:()=>r,mh:()=>o})},8636:(e,t,n)=>{"use strict";var a=n(920),r=n(7720),o=n(4765),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,t){c.apply(e,l(t)?t:[t])},u=Date.prototype.toISOString,m=o.default,p={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:r.encode,encodeValuesOnly:!1,format:m,formatter:o.formatters[m],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},g={},h=function e(t,n,o,i,s,c,u,m,h,f,v,b,y,x,k,w,E,N){for(var S,V=t,_=N,C=0,A=!1;void 0!==(_=_.get(g))&&!A;){var D=_.get(t);if(C+=1,void 0!==D){if(D===C)throw new RangeError("Cyclic object value");A=!0}void 0===_.get(g)&&(C=0)}if("function"==typeof f?V=f(n,V):V instanceof Date?V=y(V):"comma"===o&&l(V)&&(V=r.maybeMap(V,function(e){return e instanceof Date?y(e):e})),null===V){if(c)return h&&!w?h(n,p.encoder,E,"key",x):n;V=""}if("string"==typeof(S=V)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||r.isBuffer(V))return h?[k(w?n:h(n,p.encoder,E,"key",x))+"="+k(h(V,p.encoder,E,"value",x))]:[k(n)+"="+k(String(V))];var T,B=[];if(void 0===V)return B;if("comma"===o&&l(V))w&&h&&(V=r.maybeMap(V,h)),T=[{value:V.length>0?V.join(",")||null:void 0}];else if(l(f))T=f;else{var I=Object.keys(V);T=v?I.sort(v):I}var z=m?n.replace(/\./g,"%2E"):n,M=i&&l(V)&&1===V.length?z+"[]":z;if(s&&l(V)&&0===V.length)return M+"[]";for(var P=0;P<T.length;++P){var R=T[P],$="object"==typeof R&&void 0!==R.value?R.value:V[R];if(!u||null!==$){var O=b&&m?R.replace(/\./g,"%2E"):R,L=l(V)?"function"==typeof o?o(M,O):M:M+(b?"."+O:"["+O+"]");N.set(t,C);var F=a();F.set(g,N),d(B,e($,L,o,i,s,c,u,m,"comma"===o&&w&&l(V)?null:h,f,v,b,y,x,k,w,E,F))}}return B};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return p;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if(void 0!==e.format){if(!i.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var a,r=o.formatters[n],c=p.filter;if(("function"==typeof e.filter||l(e.filter))&&(c=e.filter),a=e.arrayFormat in s?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":p.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var d=void 0===e.allowDots?!0===e.encodeDotInKeys||p.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:d,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:p.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:p.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:c,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(n=c.filter);var u=[];if("object"!=typeof r||null===r)return"";var m=s[c.arrayFormat],g="comma"===m&&c.commaRoundTrip;n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var f=a(),v=0;v<n.length;++v){var b=n[v];c.skipNulls&&null===r[b]||d(u,h(r[b],b,m,g,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,f))}var y=u.join(c.delimiter),x=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),y.length>0?x+y:""}},8648:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},8651:(e,t,n)=>{"use strict";n.r(t),n.d(t,{clearAllCharacterData:()=>l,getCurrentCharacterName:()=>s,getTavernHelper:()=>i,isTavernEnv:()=>o});var a=n(7445);function r(){if("undefined"==typeof window)return null;const e=function(){try{return"1"===localStorage.getItem("dad_debug_tavern")}catch{return!1}}();if(e&&(console.log("[Tavern检测] 开始查找 TavernHelper..."),console.log("[Tavern检测] 当前window.location:",window.location.href)),window.TavernHelper)return e&&console.log("[Tavern检测] ✅ 在当前window找到TavernHelper"),window.TavernHelper;try{if(e&&console.log("[Tavern检测] 尝试访问window.top..."),window.top&&window.top!==window){if(e&&console.log("[Tavern检测] window.top可访问，检查TavernHelper..."),window.top.TavernHelper)return e&&console.log("[Tavern检测] ✅ 在window.top找到TavernHelper"),window.top.TavernHelper;e&&console.log("[Tavern检测] window.top没有TavernHelper")}}catch(t){e&&console.log("[Tavern检测] ⚠️ 访问window.top失败（跨域）:",t)}let t=window;for(let n=0;n<5;n++)try{if(!t.parent||t.parent===t){e&&console.log(`[Tavern检测] 已到达顶层（第${n+1}层）`);break}if(e&&console.log(`[Tavern检测] 检查第${n+1}层parent...`),t.parent.TavernHelper)return e&&console.log(`[Tavern检测] ✅ 在第${n+1}层parent找到TavernHelper`),t.parent.TavernHelper;e&&console.log(`[Tavern检测] 第${n+1}层parent没有TavernHelper，继续向上`),t=t.parent}catch(t){e&&console.log(`[Tavern检测] ⚠️ 访问第${n+1}层parent失败（跨域）:`,t);break}return e&&console.log("[Tavern检测] ❌ 未找到TavernHelper"),null}function o(){return!!r()}function i(){return{generate:async e=>await a.aiService.generate(e),generateRaw:async e=>await a.aiService.generateRaw(e),getVariables:async e=>{const t=r();return t?await t.getVariables(e):{}},insertOrAssignVariables:async(e,t)=>{const n=r();if(n)return await n.insertOrAssignVariables(e,t)}}}async function s(){const e=i();if(!e)return null;try{const t=await e.getVariables({type:"global"});return t["persona.name"]||t.name||null}catch(e){return console.warn("[Tavern] 无法获取角色名:",e),null}}async function l(){const e=i();if(e)try{await e.insertOrAssignVariables({},{type:"global"})}catch(e){throw console.error("[Tavern] 清除酒馆变量失败:",e),e}else console.warn("[Tavern] 酒馆助手不可用，跳过清理")}},8684:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8708:(e,t,n)=>{"use strict";n.d(t,{F:()=>r});var a=n(3302);function r(e){const t=function(e){a.Yz.log("掌握技能计算","开始计算已掌握技能...");const t=[],n=e?.角色?.背包?.物品;if(!n)return a.Yz.warn("掌握技能计算","背包物品不存在，返回空数组"),t;for(const[e,r]of Object.entries(n)){if("功法"!==r?.类型)continue;const e=r;if(!e.功法技能||"object"!=typeof e.功法技能){a.Yz.log("掌握技能计算",`功法 ${e.名称} 没有技能定义`);continue}const n=e.修炼进度||0;a.Yz.log("掌握技能计算",`检查功法 ${e.名称}，修炼进度: ${n}`),e.已解锁技能||(e.已解锁技能=[]);for(const r of e.功法技能){const o=r.技能名称,i=r.熟练度要求||0;a.Yz.log("掌握技能计算",`  技能 ${o}，解锁阈值: ${i}`),n>=i?(e.已解锁技能.includes(o)||(e.已解锁技能.push(o),a.Yz.log("掌握技能计算",`  ✅ 添加到已解锁技能: ${o}`)),t.find(t=>t.技能名称===o&&t.来源===e.名称)||(t.push({技能名称:o,技能描述:r.技能描述||"",来源:e.名称,消耗:r.消耗||"",熟练度:0,使用次数:0}),a.Yz.log("掌握技能计算",`  ✅ 解锁技能: ${o} (来自 ${e.名称})`))):a.Yz.log("掌握技能计算",`  ❌ 技能 ${o} 未解锁 (${n}/${i})`)}}return a.Yz.log("掌握技能计算",`计算完成，共掌握 ${t.length} 个技能`),t}(e),n=e.系统?.缓存?.掌握技能||[];for(const e of t){const t=n.find(t=>t.技能名称===e.技能名称&&t.来源===e.来源);t&&(e.熟练度=t.熟练度,e.使用次数=t.使用次数)}return e.系统||(e.系统={}),e.系统.缓存||(e.系统.缓存={}),e.系统.缓存.掌握技能=t,a.Yz.log("掌握技能计算","已更新存档数据中的掌握技能数组"),t}},8721:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n/* Step transition animation */\n.fade-step-enter-active,\n.fade-step-leave-active {\n  transition: opacity 0.3s ease;\n}\n.fade-step-enter-from,\n.fade-step-leave-to {\n  opacity: 0;\n}\n",""]);const s=i},8835:(e,t,n)=>{"use strict";var a=n(1270);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var o=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),d=["%","/","?",";","#"].concat(c),u=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},h={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(5373);function b(e,t,n){if(e&&"object"==typeof e&&e instanceof r)return e;var a=new r;return a.parse(e,t,n),a}r.prototype.parse=function(e,t,n){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",l=e.split(i);l[0]=l[0].replace(/\\/g,"/");var b=e=l.join(i);if(b=b.trim(),!n&&1===e.split("#").length){var y=s.exec(b);if(y)return this.path=b,this.href=b,this.pathname=y[1],y[2]?(this.search=y[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var x=o.exec(b);if(x){var k=(x=x[0]).toLowerCase();this.protocol=k,b=b.substr(x.length)}if(n||x||b.match(/^\/\/[^@/]+@[^@/]+/)){var w="//"===b.substr(0,2);!w||x&&h[x]||(b=b.substr(2),this.slashes=!0)}if(!h[x]&&(w||x&&!f[x])){for(var E,N,S=-1,V=0;V<u.length;V++)-1!==(_=b.indexOf(u[V]))&&(-1===S||_<S)&&(S=_);for(-1!==(N=-1===S?b.lastIndexOf("@"):b.lastIndexOf("@",S))&&(E=b.slice(0,N),b=b.slice(N+1),this.auth=decodeURIComponent(E)),S=-1,V=0;V<d.length;V++){var _;-1!==(_=b.indexOf(d[V]))&&(-1===S||_<S)&&(S=_)}-1===S&&(S=b.length),this.host=b.slice(0,S),b=b.slice(S),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var A=this.hostname.split(/\./),D=(V=0,A.length);V<D;V++){var T=A[V];if(T&&!T.match(m)){for(var B="",I=0,z=T.length;I<z;I++)T.charCodeAt(I)>127?B+="x":B+=T[I];if(!B.match(m)){var M=A.slice(0,V),P=A.slice(V+1),R=T.match(p);R&&(M.push(R[1]),P.unshift(R[2])),P.length&&(b="/"+P.join(".")+b),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=a.toASCII(this.hostname));var $=this.port?":"+this.port:"",O=this.hostname||"";this.host=O+$,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[k])for(V=0,D=c.length;V<D;V++){var L=c[V];if(-1!==b.indexOf(L)){var F=encodeURIComponent(L);F===L&&(F=escape(L)),b=b.split(L).join(F)}}var j=b.indexOf("#");-1!==j&&(this.hash=b.substr(j),b=b.slice(0,j));var U=b.indexOf("?");if(-1!==U?(this.search=b.substr(U),this.query=b.substr(U+1),t&&(this.query=v.parse(this.query)),b=b.slice(0,U)):t&&(this.search="",this.query={}),b&&(this.pathname=b),f[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){$=this.pathname||"";var q=this.search||"";this.path=$+q}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",a=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(o=v.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var i=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||f[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),a&&"#"!==a.charAt(0)&&(a="#"+a),i&&"?"!==i.charAt(0)&&(i="?"+i),t+r+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+a},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if("string"==typeof e){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,a=Object.keys(this),o=0;o<a.length;o++){var i=a[o];n[i]=this[i]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(n[c]=e[c])}return f[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!f[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var m=d[u];n[m]=e[m]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||h[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",v=n.search||"";n.path=g+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=y||b||n.host&&e.pathname,k=x,w=n.pathname&&n.pathname.split("/")||[],E=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!f[n.protocol]);if(E&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),x=x&&(""===p[0]||""===w[0])),y)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),n.search=e.search,n.query=e.query;else if(null!=e.search)return E&&(n.host=w.shift(),n.hostname=n.host,(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.hostname=C.shift(),n.host=n.hostname)),n.search=e.search,n.query=e.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var N=w.slice(-1)[0],S=(n.host||e.host||w.length>1)&&("."===N||".."===N)||""===N,V=0,_=w.length;_>=0;_--)"."===(N=w[_])?w.splice(_,1):".."===N?(w.splice(_,1),V++):V&&(w.splice(_,1),V--);if(!x&&!k)for(;V--;V)w.unshift("..");!x||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),S&&"/"!==w.join("/").substr(-1)&&w.push("");var C,A=""===w[0]||w[0]&&"/"===w[0].charAt(0);return E&&(n.hostname=A?"":w.length?w.shift():"",n.host=n.hostname,(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.hostname=C.shift(),n.host=n.hostname)),(x=x||n.host&&w.length)&&!A&&w.unshift(""),w.length>0?n.pathname=w.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=i.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.qg=b,t.hd=function(e,t){return b(e,!1,!0).resolve(t)},t.GP=function(e){return"string"==typeof e&&(e=b(e)),e instanceof r?e.format():r.prototype.format.call(e)}},8859:(e,t,n)=>{var a="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=a&&r&&"function"==typeof r.get?r.get:null,i=a&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,d=s&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,m="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,h=Object.prototype.toString,f=Function.prototype.toString,v=String.prototype.match,b=String.prototype.slice,y=String.prototype.replace,x=String.prototype.toUpperCase,k=String.prototype.toLowerCase,w=RegExp.prototype.test,E=Array.prototype.concat,N=Array.prototype.join,S=Array.prototype.slice,V=Math.floor,_="function"==typeof BigInt?BigInt.prototype.valueOf:null,C=Object.getOwnPropertySymbols,A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,D="function"==typeof Symbol&&"object"==typeof Symbol.iterator,T="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,B=Object.prototype.propertyIsEnumerable,I=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function z(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||w.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var a=e<0?-V(-e):V(e);if(a!==e){var r=String(a),o=b.call(t,r.length+1);return y.call(r,n,"$&_")+"."+y.call(y.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return y.call(t,n,"$&_")}var M=n(2634),P=M.custom,R=G(P)?P:null,$={__proto__:null,double:'"',single:"'"},O={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function L(e,t,n){var a=n.quoteStyle||t,r=$[a];return r+e+r}function F(e){return y.call(String(e),/"/g,"&quot;")}function j(e){return!T||!("object"==typeof e&&(T in e||void 0!==e[T]))}function U(e){return"[object Array]"===W(e)&&j(e)}function q(e){return"[object RegExp]"===W(e)&&j(e)}function G(e){if(D)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}e.exports=function e(t,a,r,s){var l=a||{};if(Y(l,"quoteStyle")&&!Y($,l.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Y(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=!Y(l,"customInspect")||l.customInspect;if("boolean"!=typeof h&&"symbol"!==h)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Y(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Y(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return J(t,l);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var w=String(t);return x?z(t,w):w}if("bigint"==typeof t){var V=String(t)+"n";return x?z(t,V):V}var C=void 0===l.depth?5:l.depth;if(void 0===r&&(r=0),r>=C&&C>0&&"object"==typeof t)return U(t)?"[Array]":"[Object]";var P,O=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=N.call(Array(e.indent+1)," ")}return{base:n,prev:N.call(Array(t+1),n)}}(l,r);if(void 0===s)s=[];else if(X(s,t)>=0)return"[Circular]";function H(t,n,a){if(n&&(s=S.call(s)).push(n),a){var o={depth:l.depth};return Y(l,"quoteStyle")&&(o.quoteStyle=l.quoteStyle),e(t,o,r+1,s)}return e(t,l,r+1,s)}if("function"==typeof t&&!q(t)){var K=function(e){if(e.name)return e.name;var t=v.call(f.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),ae=ne(t,H);return"[Function"+(K?": "+K:" (anonymous)")+"]"+(ae.length>0?" { "+N.call(ae,", ")+" }":"")}if(G(t)){var re=D?y.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):A.call(t);return"object"!=typeof t||D?re:Z(re)}if((P=t)&&"object"==typeof P&&("undefined"!=typeof HTMLElement&&P instanceof HTMLElement||"string"==typeof P.nodeName&&"function"==typeof P.getAttribute)){for(var oe="<"+k.call(String(t.nodeName)),ie=t.attributes||[],se=0;se<ie.length;se++)oe+=" "+ie[se].name+"="+L(F(ie[se].value),"double",l);return oe+=">",t.childNodes&&t.childNodes.length&&(oe+="..."),oe+"</"+k.call(String(t.nodeName))+">"}if(U(t)){if(0===t.length)return"[]";var le=ne(t,H);return O&&!function(e){for(var t=0;t<e.length;t++)if(X(e[t],"\n")>=0)return!1;return!0}(le)?"["+te(le,O)+"]":"[ "+N.call(le,", ")+" ]"}if(function(e){return"[object Error]"===W(e)&&j(e)}(t)){var ce=ne(t,H);return"cause"in Error.prototype||!("cause"in t)||B.call(t,"cause")?0===ce.length?"["+String(t)+"]":"{ ["+String(t)+"] "+N.call(ce,", ")+" }":"{ ["+String(t)+"] "+N.call(E.call("[cause]: "+H(t.cause),ce),", ")+" }"}if("object"==typeof t&&h){if(R&&"function"==typeof t[R]&&M)return M(t,{depth:C-r});if("symbol"!==h&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!o||!e||"object"!=typeof e)return!1;try{o.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var de=[];return i&&i.call(t,function(e,n){de.push(H(n,t,!0)+" => "+H(e,t))}),ee("Map",o.call(t),de,O)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{o.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ue=[];return d&&d.call(t,function(e){ue.push(H(e,t))}),ee("Set",c.call(t),ue,O)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{m.call(e,m)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Q("WeakMap");if(function(e){if(!m||!e||"object"!=typeof e)return!1;try{m.call(e,m);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Q("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return Q("WeakRef");if(function(e){return"[object Number]"===W(e)&&j(e)}(t))return Z(H(Number(t)));if(function(e){if(!e||"object"!=typeof e||!_)return!1;try{return _.call(e),!0}catch(e){}return!1}(t))return Z(H(_.call(t)));if(function(e){return"[object Boolean]"===W(e)&&j(e)}(t))return Z(g.call(t));if(function(e){return"[object String]"===W(e)&&j(e)}(t))return Z(H(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||void 0!==n.g&&t===n.g)return"{ [object globalThis] }";if(!function(e){return"[object Date]"===W(e)&&j(e)}(t)&&!q(t)){var me=ne(t,H),pe=I?I(t)===Object.prototype:t instanceof Object||t.constructor===Object,ge=t instanceof Object?"":"null prototype",he=!pe&&T&&Object(t)===t&&T in t?b.call(W(t),8,-1):ge?"Object":"",fe=(pe||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(he||ge?"["+N.call(E.call([],he||[],ge||[]),": ")+"] ":"");return 0===me.length?fe+"{}":O?fe+"{"+te(me,O)+"}":fe+"{ "+N.call(me,", ")+" }"}return String(t)};var H=Object.prototype.hasOwnProperty||function(e){return e in this};function Y(e,t){return H.call(e,t)}function W(e){return h.call(e)}function X(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,a=e.length;n<a;n++)if(e[n]===t)return n;return-1}function J(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,a="... "+n+" more character"+(n>1?"s":"");return J(b.call(e,0,t.maxStringLength),t)+a}var r=O[t.quoteStyle||"single"];return r.lastIndex=0,L(y.call(y.call(e,r,"\\$1"),/[\x00-\x1f]/g,K),"single",t)}function K(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function Z(e){return"Object("+e+")"}function Q(e){return e+" { ? }"}function ee(e,t,n,a){return e+" ("+t+") {"+(a?te(n,a):N.call(n,", "))+"}"}function te(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+N.call(e,","+n)+"\n"+t.prev}function ne(e,t){var n=U(e),a=[];if(n){a.length=e.length;for(var r=0;r<e.length;r++)a[r]=Y(e,r)?t(e[r],e):""}var o,i="function"==typeof C?C(e):[];if(D){o={};for(var s=0;s<i.length;s++)o["$"+i[s]]=i[s]}for(var l in e)Y(e,l)&&(n&&String(Number(l))===l&&l<e.length||D&&o["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?a.push(t(l,e)+": "+t(e[l],e)):a.push(l+": "+t(e[l],e))));if("function"==typeof C)for(var c=0;c<i.length;c++)B.call(e,i[c])&&a.push("["+t(i[c])+"]: "+t(e[i[c]],e));return a}},8885:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n/* Unified style tokens for Character Management */\n.character-management-panel[data-v-6c72ccc2] {\n  --cm-radius-sm: 6px;\n  --cm-radius-md: 8px;\n  --cm-radius-lg: 12px;\n  --cm-gap-xs: 0.25rem;\n  --cm-gap-sm: 0.5rem;\n  --cm-gap-md: 0.8rem;\n  --cm-gap-lg: 1rem;\n  --cm-border-width: 1px;\n  --cm-border-strong: 2px;\n  --cm-divider-width: 2px;\n  /* Card sizing tokens */\n  --cm-card-min-h: 92px;\n  --cm-card-padding: 0.9rem;\n  --cm-avatar-size: 36px;\n  --cm-header-gap: 0.75rem;\n  --cm-name-font: 1rem;\n  --cm-meta-font: 0.8rem;\n  --cm-save-count-minw: 36px;\n  --cm-save-count-count-font: 1.05rem;\n  --cm-save-count-label-font: 0.7rem;\n}\n/* 基础样式重置 */\n[data-v-6c72ccc2] {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n/* 自定义对话框样式 */\n.dialog-overlay[data-v-6c72ccc2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(10, 20, 30, 0.6);\n  backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  transition: opacity 0.3s ease;\n}\n.dialog-box[data-v-6c72ccc2] {\n  background: var(--color-surface-transparent);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  padding: 2rem;\n  width: 90%;\n  max-width: 450px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n  color: var(--color-text);\n  transform: scale(0.95);\n  opacity: 0;\n  animation: dialog-fade-in-6c72ccc2 0.3s forwards;\n}\n@keyframes dialog-fade-in-6c72ccc2 {\nto {\n    transform: scale(1);\n    opacity: 1;\n}\n}\n.dialog-title[data-v-6c72ccc2] {\n  font-size: 1.5rem;\n  color: var(--color-accent);\n  margin: 0 0 1rem 0;\n  font-weight: 600;\n}\n.dialog-message[data-v-6c72ccc2] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 1.5rem 0;\n  line-height: 1.6;\n}\n.dialog-points[data-v-6c72ccc2] {\n  background: rgba(var(--color-panel-rgb), 0.3);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  padding: 0.75rem 1rem;\n  margin-bottom: 1.5rem;\n  display: grid;\n  gap: 0.4rem;\n  color: var(--color-text);\n}\n.dialog-points .points-row[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.95rem;\n}\n.dialog-input[data-v-6c72ccc2] {\n  width: 100%;\n  padding: 0.8rem 1rem;\n  background: var(--color-background-transparent);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text);\n  font-size: 1rem;\n  margin-bottom: 1.5rem;\n  transition:\n    border-color 0.3s,\n    box-shadow 0.3s;\n}\n.dialog-input[data-v-6c72ccc2]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);\n}\n.dialog-actions[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n}\n.btn-dialog-confirm[data-v-6c72ccc2],\n.btn-dialog-cancel[data-v-6c72ccc2] {\n  padding: 0.6rem 1.5rem;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  font-weight: 600;\n  transition: all 0.3s;\n}\n.btn-dialog-confirm[data-v-6c72ccc2] {\n  background: var(--color-primary);\n  color: white;\n  border-color: var(--color-primary);\n}\n.btn-dialog-confirm[data-v-6c72ccc2]:hover {\n  background: var(--color-primary-dark);\n  transform: translateY(-2px);\n}\n.btn-dialog-cancel[data-v-6c72ccc2] {\n  background: var(--color-surface);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-dialog-cancel[data-v-6c72ccc2]:hover {\n  background: var(--color-background);\n}\n.btn-dialog-confirm[data-v-6c72ccc2]:disabled,\n.btn-dialog-cancel[data-v-6c72ccc2]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 主容器样式 */\n.character-management-panel[data-v-6c72ccc2] {\n  width: 100%;\n  height: 100%;\n  background: var(--color-background);\n  color: var(--color-text);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  position: relative;\n}\n.character-management-panel.fullscreen[data-v-6c72ccc2] {\n  background: var(--color-background);\n}\n\n/* 全屏模式头部 */\n.fullscreen-header[data-v-6c72ccc2] {\n  position: relative;\n  z-index: 10;\n  padding: 2rem;\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(12px);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.fullscreen-back-btn[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background: transparent;\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  font-size: 0.9rem;\n}\n.fullscreen-back-btn[data-v-6c72ccc2]:hover {\n  background: var(--color-surface-hover);\n  color: var(--color-text);\n  border-color: var(--color-primary);\n}\n.fullscreen-title[data-v-6c72ccc2] {\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  text-align: center;\n}\n.fullscreen-title h1[data-v-6c72ccc2] {\n  font-family: var(--font-family-serif);\n  font-size: 2.5rem;\n  font-weight: 500;\n  letter-spacing: 0.3em;\n  color: var(--color-text);\n  text-shadow: 0 0 20px rgba(var(--color-primary-rgb), 0.4);\n  margin: 0 0 0.5rem 0;\n  padding-left: 0.3em;\n}\n.fullscreen-title p[data-v-6c72ccc2] {\n  font-size: 1rem;\n  color: var(--color-text-secondary);\n  letter-spacing: 0.1em;\n  opacity: 0.8;\n  margin: 0;\n}\n\n/* 主体内容 */\n.main-content[data-v-6c72ccc2] {\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.main-content.fullscreen-content[data-v-6c72ccc2] {\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n}\n\n/* 移动端头部导航 */\n.mobile-header[data-v-6c72ccc2] {\n  display: none;\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(12px);\n  border-bottom: 1px solid var(--color-border);\n  padding: 1rem;\n  align-items: center;\n  gap: 1rem;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n.mobile-menu-btn[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.6rem;\n  padding: 0.8rem 1rem;\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.8),\n    rgba(var(--color-background-rgb), 0.6)\n  );\n  backdrop-filter: blur(10px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.3);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  font-weight: 600;\n  position: relative;\n  overflow: hidden;\n}\n.mobile-menu-btn[data-v-6c72ccc2]:hover {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  color: var(--color-primary);\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.2);\n}\n.mobile-menu-btn.active[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: white;\n  border-color: var(--color-primary);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n}\n.hamburger[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  width: 16px;\n  height: 12px;\n}\n.hamburger span[data-v-6c72ccc2] {\n  display: block;\n  height: 2px;\n  width: 100%;\n  background: currentColor;\n  border-radius: 1px;\n  transition: transform 0.2s ease;\n}\n.mobile-menu-btn.active .hamburger span[data-v-6c72ccc2]:nth-child(1) {\n  transform: rotate(45deg) translate(3px, 3px);\n}\n.mobile-menu-btn.active .hamburger span[data-v-6c72ccc2]:nth-child(2) {\n  opacity: 0;\n}\n.mobile-menu-btn.active .hamburger span[data-v-6c72ccc2]:nth-child(3) {\n  transform: rotate(-45deg) translate(3px, -3px);\n}\n.mobile-title[data-v-6c72ccc2] {\n  flex: 1;\n  min-width: 0; /* Allow shrinking and text-overflow to work */\n}\n.mobile-title h2[data-v-6c72ccc2] {\n  margin: 0;\n  font-size: 1.2rem;\n  color: var(--color-text);\n  font-weight: 600;\n}\n.mobile-title .selected-info[data-v-6c72ccc2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  margin-top: 0.2rem;\n  /* Fix for vertical text issue on small screens */\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.panel-overlay[data-v-6c72ccc2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 1100;\n}\n\n/* 空状态 */\n.empty-state[data-v-6c72ccc2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 2rem;\n}\n.empty-icon[data-v-6c72ccc2] {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.empty-state h2[data-v-6c72ccc2] {\n  color: var(--color-accent);\n  margin-bottom: 0.5rem;\n}\n.empty-actions[data-v-6c72ccc2] {\n  display: flex;\n  gap: 1rem;\n  margin-top: 1rem;\n}\n.btn-create[data-v-6c72ccc2],\n.btn-import[data-v-6c72ccc2] {\n  padding: 1rem 2rem;\n  color: white;\n  border-radius: 12px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.btn-create[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, var(--color-success), var(--color-info));\n  border: 1px solid var(--color-success);\n}\n.btn-create[data-v-6c72ccc2]:hover {\n  transform: scale(1.05);\n}\n.btn-import[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  border: 1px solid var(--color-primary);\n}\n.btn-import[data-v-6c72ccc2]:hover {\n  transform: scale(1.05);\n}\n\n/* 管理布局 - 3行2列网格 */\n.management-layout[data-v-6c72ccc2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  height: 100%;\n}\n\n/* 3行2列网格布局 - 简洁版本 */\n.grid-container[data-v-6c72ccc2] {\n  display: grid;\n  grid-template-columns: 320px 1fr;\n  grid-template-rows: auto 1fr auto;\n  grid-template-areas:\n    'header-left header-right'\n    'content-left content-right'\n    'footer-left footer-right';\n  height: 100%;\n  overflow: hidden;\n  /* 使用单一垂直分割线 */\n  position: relative;\n}\n\n/* 统一的垂直分割线 */\n.grid-container[data-v-6c72ccc2]::before {\n  content: '';\n  position: absolute;\n  left: 320px;\n  top: 0;\n  bottom: 0;\n  width: 2px;\n  background: var(--color-primary);\n  z-index: 10;\n}\n\n/* 标题栏 - 简化样式 */\n.grid-header-left[data-v-6c72ccc2],\n.grid-header-right[data-v-6c72ccc2] {\n  padding: 0.8rem 1rem;\n  background: var(--color-surface);\n  border-bottom: 1px solid var(--color-border);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n}\n.grid-header-left h2[data-v-6c72ccc2],\n.grid-header-right h2[data-v-6c72ccc2] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-text);\n  font-weight: 600;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.header-title-group[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 1;\n  min-width: 0;\n}\n.btn-header-action[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.4rem 0.8rem;\n  border: 1px solid;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n  background: var(--color-surface);\n  flex-shrink: 0;\n}\n.btn-header-action.import[data-v-6c72ccc2] {\n  color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.4);\n}\n.btn-header-action.import[data-v-6c72ccc2]:hover {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: var(--color-info);\n}\n.character-count[data-v-6c72ccc2] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  padding: 0.2rem 0.4rem;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 100%;\n}\n\n/* 右侧标题栏布局 */\n.header-left-content[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n  flex: 1;\n  min-width: 0;\n}\n.selected-char-info[data-v-6c72ccc2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.1),\n    rgba(var(--color-accent-rgb), 0.05)\n  );\n  padding: 0.3rem 0.6rem;\n  border-radius: 6px;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.3);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: fit-content;\n}\n\n/* 存档操作按钮组 */\n.save-actions-buttons[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.6rem;\n  flex-shrink: 0;\n}\n.btn-save-action[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  border: 2px solid;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.85rem;\n  font-weight: 600;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.8),\n    rgba(var(--color-background-rgb), 0.6)\n  );\n  backdrop-filter: blur(10px);\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n.btn-save-action.export[data-v-6c72ccc2] {\n  color: var(--color-success);\n  border-color: rgba(var(--color-success-rgb), 0.4);\n}\n.btn-save-action.export[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-success), rgba(var(--color-success-rgb), 0.8));\n  color: white;\n  border-color: var(--color-success);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-success-rgb), 0.3);\n}\n.btn-save-action.import[data-v-6c72ccc2] {\n  color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.4);\n}\n.btn-save-action.import[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-info), rgba(var(--color-info-rgb), 0.8));\n  color: white;\n  border-color: var(--color-info);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-info-rgb), 0.3);\n}\n.btn-save-action.migrate[data-v-6c72ccc2] {\n  color: var(--color-warning);\n  border-color: rgba(var(--color-warning-rgb), 0.4);\n}\n.btn-save-action.migrate[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-warning), rgba(var(--color-warning-rgb), 0.85));\n  color: #1a1a1a;\n  border-color: var(--color-warning);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-warning-rgb), 0.3);\n}\n.btn-save-action[data-v-6c72ccc2]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  filter: grayscale(0.5);\n}\n.btn-save-action[data-v-6c72ccc2]:disabled:hover {\n  transform: none;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n\n/* 内容区域 - 简化样式 */\n.grid-content-left[data-v-6c72ccc2],\n.grid-content-right[data-v-6c72ccc2] {\n  background: var(--color-background);\n}\n\n/* 底部区域 */\n.grid-footer-left[data-v-6c72ccc2],\n.grid-footer-right[data-v-6c72ccc2] {\n  min-height: 0;\n}\n\n/* 角色面板 - 简化 */\n.characters-panel[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n}\n.characters-grid[data-v-6c72ccc2] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n}\n\n/* 角色卡片 - 简化紧凑设计 */\n.character-card[data-v-6c72ccc2] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  padding: 0.6rem;\n  margin-bottom: 0.4rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.character-card[data-v-6c72ccc2]:hover {\n  border-color: var(--color-primary);\n  box-shadow: 0 1px 4px rgba(var(--color-primary-rgb), 0.2);\n}\n.character-card.active[data-v-6c72ccc2] {\n  border-color: var(--color-success);\n  background: rgba(var(--color-success-rgb), 0.05);\n}\n.character-card.single-mode[data-v-6c72ccc2] {\n  border-left: 3px solid var(--color-success);\n}\n.character-card.online-mode[data-v-6c72ccc2] {\n  border-left: 3px solid var(--color-primary);\n}\n\n/* 卡片头部 - 简化 */\n.card-header[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.char-avatar[data-v-6c72ccc2] {\n  position: relative;\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 1.2rem;\n  flex-shrink: 0;\n  background: linear-gradient(135deg, #10b981, #3b82f6);\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n  border: 2px solid rgba(255, 255, 255, 0.2);\n}\n.char-avatar.联机[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, #3b82f6, #0ea5e9);\n}\n.char-info[data-v-6c72ccc2] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  gap: 4px;\n}\n.name-row[data-v-6c72ccc2] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.char-name[data-v-6c72ccc2] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-text);\n  font-weight: 700;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  letter-spacing: 0.5px;\n}\n.mode-badge[data-v-6c72ccc2] {\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-weight: 600;\n  line-height: 1.2;\n}\n.mode-badge.single[data-v-6c72ccc2] {\n  background: rgba(16, 185, 129, 0.15);\n  color: #10b981;\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.mode-badge.online[data-v-6c72ccc2] {\n  background: rgba(59, 130, 246, 0.15);\n  color: #3b82f6;\n  border: 1px solid rgba(59, 130, 246, 0.3);\n}\n.char-meta[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.3rem;\n  font-size: 0.65rem;\n  color: var(--color-text-secondary);\n}\n.save-count[data-v-6c72ccc2] {\n  text-align: center;\n  flex-shrink: 0;\n  min-width: 28px;\n}\n.save-count .count[data-v-6c72ccc2] {\n  display: block;\n  font-size: 0.9rem;\n  font-weight: bold;\n  color: var(--color-accent);\n  line-height: 1;\n}\n.save-count .label[data-v-6c72ccc2] {\n  font-size: 0.6rem;\n  color: var(--color-text-secondary);\n  line-height: 1;\n}\n\n/* 卡片操作 - 简化按钮 */\n.card-actions[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.3rem;\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid var(--color-border);\n}\n.btn-details[data-v-6c72ccc2],\n.btn-export[data-v-6c72ccc2],\n.btn-delete[data-v-6c72ccc2] {\n  flex: 1;\n  padding: 0.3rem 0.5rem;\n  border-radius: 4px;\n  border: 1px solid var(--color-border);\n  cursor: pointer;\n  font-size: 0.7rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  background: var(--color-background);\n}\n.btn-details[data-v-6c72ccc2] {\n  color: var(--color-info);\n  border-color: var(--color-info);\n}\n.btn-details[data-v-6c72ccc2]:hover {\n  background: var(--color-info);\n  color: white;\n}\n.btn-export[data-v-6c72ccc2] {\n  color: var(--color-success);\n  border-color: var(--color-success);\n}\n.btn-export[data-v-6c72ccc2]:hover {\n  background: var(--color-success);\n  color: white;\n}\n.btn-delete[data-v-6c72ccc2] {\n  color: var(--color-error);\n  border-color: var(--color-error);\n}\n.btn-delete[data-v-6c72ccc2]:hover {\n  background: var(--color-error);\n  color: white;\n}\n\n/* 右侧存档面板 - 简化 */\n.saves-panel[data-v-6c72ccc2] {\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* 无选择状态 */\n.no-selection[data-v-6c72ccc2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n}\n.no-selection-icon[data-v-6c72ccc2] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n\n/* 新增：加载存档样式 */\n.loading-saves[data-v-6c72ccc2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-text-secondary);\n}\n.loading-spinner[data-v-6c72ccc2] {\n  width: 40px;\n  height: 40px;\n  border: 4px solid rgba(var(--color-primary-rgb), 0.2);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin-6c72ccc2 1s linear infinite;\n  margin-bottom: 1rem;\n}\n@keyframes spin-6c72ccc2 {\nto {\n    transform: rotate(360deg);\n}\n}\n\n/* 存档容器 */\n.saves-container[data-v-6c72ccc2],\n.online-saves-container[data-v-6c72ccc2] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1rem;\n  height: 0;\n  -webkit-overflow-scrolling: touch;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(var(--color-primary-rgb), 0.3) transparent;\n}\n.saves-container[data-v-6c72ccc2]::-webkit-scrollbar,\n.online-saves-container[data-v-6c72ccc2]::-webkit-scrollbar {\n  width: 6px;\n}\n.saves-container[data-v-6c72ccc2]::-webkit-scrollbar-track,\n.online-saves-container[data-v-6c72ccc2]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.saves-container[data-v-6c72ccc2]::-webkit-scrollbar-thumb,\n.online-saves-container[data-v-6c72ccc2]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 3px;\n}\n.saves-container[data-v-6c72ccc2]::-webkit-scrollbar-thumb:hover,\n.online-saves-container[data-v-6c72ccc2]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n.saves-section[data-v-6c72ccc2] {\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n}\n\n/* 上次对话存档区域 */\n.auto-saves-section[data-v-6c72ccc2] {\n  margin-bottom: 1.5rem;\n}\n.auto-saves-section h3[data-v-6c72ccc2] {\n  margin: 0 0 0.8rem 0;\n  color: var(--color-warning);\n  font-size: 1rem;\n  font-weight: 600;\n}\n.auto-saves-grid[data-v-6c72ccc2] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1rem;\n}\n\n/* 手动存档区域 */\n.manual-saves-section[data-v-6c72ccc2] {\n  margin-bottom: 1rem;\n}\n.manual-saves-header[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.8rem;\n}\n.manual-saves-header h3[data-v-6c72ccc2] {\n  margin: 0;\n  color: var(--color-warning);\n  font-size: 1rem;\n  font-weight: 600;\n}\n.save-info-text[data-v-6c72ccc2] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  font-style: italic;\n}\n.manual-saves-grid[data-v-6c72ccc2] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: 1rem;\n  max-height: 400px;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n  -webkit-overflow-scrolling: touch;\n  scroll-behavior: smooth;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(var(--color-primary-rgb), 0.3) transparent;\n}\n.manual-saves-grid[data-v-6c72ccc2]::-webkit-scrollbar {\n  width: 6px;\n}\n.manual-saves-grid[data-v-6c72ccc2]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.manual-saves-grid[data-v-6c72ccc2]::-webkit-scrollbar-thumb {\n  background: rgba(var(--color-primary-rgb), 0.3);\n  border-radius: 3px;\n}\n.manual-saves-grid[data-v-6c72ccc2]::-webkit-scrollbar-thumb:hover {\n  background: rgba(var(--color-primary-rgb), 0.5);\n}\n\n/* 存档卡片 */\n.save-card[data-v-6c72ccc2],\n.online-save-card[data-v-6c72ccc2] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  backdrop-filter: blur(15px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 8px;\n  padding: 0.9rem;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  -webkit-tap-highlight-color: transparent;\n  touch-action: manipulation;\n}\n.save-card[data-v-6c72ccc2]::before,\n.online-save-card[data-v-6c72ccc2]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.06),\n    rgba(var(--color-accent-rgb), 0.03)\n  );\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  border-radius: 8px;\n}\n.save-card[data-v-6c72ccc2]:hover::before,\n.online-save-card[data-v-6c72ccc2]:hover::before {\n  opacity: 1;\n}\n.save-card[data-v-6c72ccc2]:hover,\n.online-save-card[data-v-6c72ccc2]:hover {\n  border-color: var(--color-primary);\n  transform: translateY(-2px);\n  box-shadow:\n    0 4px 15px rgba(var(--color-primary-rgb), 0.15),\n    0 2px 8px rgba(0, 0, 0, 0.08);\n}\n.save-card.has-data[data-v-6c72ccc2] {\n  border-left: 4px solid var(--color-success);\n  border-color: rgba(var(--color-success-rgb), 0.8);\n  position: relative;\n}\n.save-card.auto-save[data-v-6c72ccc2] {\n  border-left-color: var(--color-info);\n  border-color: rgba(var(--color-info-rgb), 0.8);\n}\n.save-icon[data-v-6c72ccc2] {\n  display: inline-block;\n  margin-right: 0.5rem;\n  vertical-align: middle;\n  position: relative;\n  top: -1px;\n}\n.last-save-icon[data-v-6c72ccc2] {\n  color: var(--color-primary);\n}\n.time-save-icon[data-v-6c72ccc2] {\n  color: var(--color-warning);\n}\n.save-card.has-data[data-v-6c72ccc2]::after {\n  content: '';\n  position: absolute;\n  top: 0.7rem;\n  right: 0.7rem;\n  width: 6px;\n  height: 6px;\n  background: var(--color-success);\n  border-radius: 50%;\n  box-shadow: 0 0 8px rgba(var(--color-success-rgb), 0.6);\n}\n\n/* 存档数据 */\n.save-header[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.8rem;\n}\n.save-name[data-v-6c72ccc2] {\n  margin: 0;\n  font-size: 1rem;\n  color: var(--color-warning);\n  font-weight: 600;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 140px;\n}\n.save-badges[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.4rem;\n  flex-shrink: 0;\n}\n.realm-badge[data-v-6c72ccc2],\n.age-badge[data-v-6c72ccc2] {\n  padding: 2px 6px;\n  border-radius: 8px;\n  font-size: 0.7rem;\n  font-weight: 600;\n  white-space: nowrap;\n}\n.realm-badge[data-v-6c72ccc2] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n.age-badge[data-v-6c72ccc2] {\n  background: rgba(var(--color-accent-rgb), 0.15);\n  color: var(--color-accent);\n}\n\n/* 存档统计 */\n.save-stats[data-v-6c72ccc2] {\n  margin-bottom: 0.8rem;\n}\n.stat-grid[data-v-6c72ccc2] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 0.6rem;\n}\n.stat[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.8rem;\n  align-items: center;\n}\n.stat .label[data-v-6c72ccc2] {\n  color: var(--color-text-secondary);\n  font-size: 0.75rem;\n}\n.stat .value[data-v-6c72ccc2] {\n  color: var(--color-text);\n  font-weight: 600;\n  font-size: 0.8rem;\n}\n\n/* 存档底部 */\n.save-footer[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  padding-top: 0.6rem;\n  border-top: 1px solid rgba(var(--color-border-rgb), 0.2);\n}\n.save-footer .location[data-v-6c72ccc2] {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 120px;\n}\n.sync-status[data-v-6c72ccc2] {\n  padding: 1px 4px;\n  border-radius: 3px;\n  font-weight: 600;\n  font-size: 0.7rem;\n}\n.sync-status.synced[data-v-6c72ccc2] {\n  background: rgba(var(--color-success-rgb), 0.15);\n  color: var(--color-success);\n}\n\n/* 空存档 */\n.save-empty[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  color: var(--color-text-secondary);\n  min-height: 100px;\n  padding: 1.5rem;\n}\n.save-empty .empty-hint[data-v-6c72ccc2] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  margin: 0.5rem 0 1rem 0;\n  opacity: 0.8;\n}\n.loading-saves[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n  gap: 0.75rem;\n}\n.loading-saves .loading-spinner[data-v-6c72ccc2] {\n  font-size: 1.5rem;\n  animation: spin-6c72ccc2 1s linear infinite;\n}\n@keyframes spin-6c72ccc2 {\nfrom { transform: rotate(0deg);\n}\nto { transform: rotate(360deg);\n}\n}\n.empty-slot-icon[data-v-6c72ccc2] {\n  font-size: 2rem;\n  margin-bottom: 0.4rem;\n  opacity: 0.6;\n}\n.empty-text[data-v-6c72ccc2] {\n  margin-bottom: 0.6rem;\n  font-size: 0.9rem;\n}\n.empty-desc[data-v-6c72ccc2] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  opacity: 0.8;\n}\n.auto-save-desc[data-v-6c72ccc2] {\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n  display: block;\n  margin-top: 0.3rem;\n}\n\n/* 存档操作按钮 */\n.save-actions[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.4rem;\n}\n.btn-export-save[data-v-6c72ccc2],\n.btn-edit-save[data-v-6c72ccc2],\n.btn-delete-save[data-v-6c72ccc2] {\n  cursor: pointer;\n  padding: 0.3rem 0.5rem;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n  font-size: 0.7rem;\n  font-weight: 600;\n  border: 1px solid;\n  backdrop-filter: blur(5px);\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  min-width: 26px;\n  height: 26px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-export-save[data-v-6c72ccc2] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border-color: rgba(var(--color-success-rgb), 0.3);\n  color: var(--color-success);\n}\n.btn-export-save[data-v-6c72ccc2]:hover {\n  background: rgba(var(--color-success-rgb), 0.2);\n  border-color: rgba(var(--color-success-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-success-rgb), 0.2);\n}\n.btn-edit-save[data-v-6c72ccc2] {\n  background: rgba(var(--color-info-rgb), 0.1);\n  border-color: rgba(var(--color-info-rgb), 0.3);\n  color: var(--color-info);\n}\n.btn-edit-save[data-v-6c72ccc2]:hover {\n  background: rgba(var(--color-info-rgb), 0.2);\n  border-color: rgba(var(--color-info-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-info-rgb), 0.2);\n}\n.btn-delete-save[data-v-6c72ccc2] {\n  background: rgba(var(--color-error-rgb), 0.1);\n  border-color: rgba(var(--color-error-rgb), 0.3);\n  color: var(--color-error);\n}\n.btn-delete-save[data-v-6c72ccc2]:hover:not(.disabled):not(:disabled) {\n  background: rgba(var(--color-error-rgb), 0.2);\n  border-color: rgba(var(--color-error-rgb), 0.5);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(var(--color-error-rgb), 0.2);\n}\n.btn-delete-save.disabled[data-v-6c72ccc2],\n.btn-delete-save[data-v-6c72ccc2]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  background: rgba(128, 128, 128, 0.1) !important;\n  border-color: rgba(128, 128, 128, 0.2) !important;\n  color: #888 !important;\n  transform: none !important;\n  box-shadow: none !important;\n}\n\n/* 按钮样式 */\n.btn-start[data-v-6c72ccc2],\n.btn-play[data-v-6c72ccc2],\n.btn-sync[data-v-6c72ccc2] {\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: white;\n  border: 1px solid rgba(var(--color-primary-rgb), 0.5);\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.8rem;\n  font-weight: 600;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.25);\n  position: relative;\n  overflow: hidden;\n}\n.btn-start[data-v-6c72ccc2]:hover,\n.btn-play[data-v-6c72ccc2]:hover,\n.btn-sync[data-v-6c72ccc2]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.35);\n}\n.btn-start[data-v-6c72ccc2]::before,\n.btn-play[data-v-6c72ccc2]::before,\n.btn-sync[data-v-6c72ccc2]::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);\n  transition: left 0.4s;\n}\n.btn-start[data-v-6c72ccc2]:hover::before,\n.btn-play[data-v-6c72ccc2]:hover::before,\n.btn-sync[data-v-6c72ccc2]:hover::before {\n  left: 100%;\n}\n\n/* 联机模式样式 */\n.online-saves-container[data-v-6c72ccc2] {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 1rem;\n  height: 0;\n}\n.login-prompt[data-v-6c72ccc2] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: 2rem;\n}\n.login-icon[data-v-6c72ccc2] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.btn-login[data-v-6c72ccc2] {\n  padding: 0.8rem 1.5rem;\n  background: var(--color-primary);\n  color: white;\n  border: 1px solid var(--color-primary-active);\n  border-radius: 8px;\n  cursor: pointer;\n  margin-top: 1rem;\n}\n.online-save-card[data-v-6c72ccc2] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-surface-rgb), 0.9),\n    rgba(var(--color-background-rgb), 0.7)\n  );\n  backdrop-filter: blur(15px);\n  border: 2px solid rgba(var(--color-border-rgb), 0.6);\n  border-radius: 8px;\n  padding: 0.9rem;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  color: var(--color-text);\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n.online-actions[data-v-6c72ccc2] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid var(--color-border);\n}\n\n/* 详情弹窗 */\n.modal-overlay[data-v-6c72ccc2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  backdrop-filter: blur(4px);\n}\n.details-modal[data-v-6c72ccc2] {\n  background: var(--color-surface-transparent);\n  backdrop-filter: blur(20px);\n  border-radius: 15px;\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  overflow-y: auto;\n  border: 1px solid var(--color-border);\n}\n.modal-header[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem 2rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-header h3[data-v-6c72ccc2] {\n  margin: 0;\n  color: var(--color-accent);\n}\n.btn-close[data-v-6c72ccc2] {\n  background: none;\n  border: 1px solid var(--color-border);\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0.1rem;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n}\n.modal-content[data-v-6c72ccc2] {\n  padding: 2rem;\n}\n.details-grid[data-v-6c72ccc2] {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 2rem;\n}\n.detail-section[data-v-6c72ccc2] {\n  background: linear-gradient(\n    135deg,\n    rgba(var(--color-primary-rgb), 0.08),\n    rgba(var(--color-accent-rgb), 0.06)\n  );\n  border: 1px solid rgba(var(--color-primary-rgb), 0.15);\n  border-radius: 10px;\n  padding: 1.5rem;\n  backdrop-filter: blur(8px);\n}\n.detail-section h4[data-v-6c72ccc2] {\n  margin: 0 0 1rem 0;\n  color: var(--color-warning);\n}\n.detail-items[data-v-6c72ccc2] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.8rem;\n}\n.detail-item[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: space-between;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid rgba(var(--color-border-rgb), 0.3);\n}\n.detail-item .label[data-v-6c72ccc2] {\n  color: var(--color-text-secondary);\n  font-weight: 500;\n}\n.detail-item .value[data-v-6c72ccc2] {\n  color: var(--color-text);\n  font-weight: 600;\n}\n.attributes-display[data-v-6c72ccc2] {\n  display: flex;\n  justify-content: center;\n}\n.talents-list[data-v-6c72ccc2] {\n  min-height: 100px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.talent-items[data-v-6c72ccc2] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.talent-tag[data-v-6c72ccc2] {\n  background: rgba(var(--color-accent-rgb), 0.15);\n  color: var(--color-accent);\n  padding: 4px 8px;\n  border-radius: 6px;\n  font-size: 0.8rem;\n  font-weight: 500;\n}\n.no-talents[data-v-6c72ccc2] {\n  color: var(--color-text-secondary);\n  font-style: italic;\n  text-align: center;\n}\n\n/* 响应式适配 */\n@media (max-width: 1200px) {\n.grid-container[data-v-6c72ccc2] {\n    grid-template-columns: 300px 1fr;\n}\n\n  /* 调整分割线位置 */\n.grid-container[data-v-6c72ccc2]::before {\n    left: 300px;\n}\n.manual-saves-grid[data-v-6c72ccc2] {\n    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n}\n}\n@media (max-width: 1024px) {\n.grid-container[data-v-6c72ccc2] {\n    grid-template-columns: 280px 1fr;\n}\n\n  /* 调整分割线位置 */\n.grid-container[data-v-6c72ccc2]::before {\n    left: 280px;\n}\n.characters-panel[data-v-6c72ccc2] {\n    max-width: 260px;\n}\n.save-card[data-v-6c72ccc2],\n  .online-save-card[data-v-6c72ccc2] {\n    padding: 0.8rem;\n}\n.details-grid[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 640px) {\n.mobile-header[data-v-6c72ccc2] {\n    display: flex;\n}\n.character-management-panel[data-v-6c72ccc2] {\n    height: 100%;\n    overflow: hidden;\n}\n.main-content[data-v-6c72ccc2] {\n    flex: 1;\n    overflow: hidden;\n    min-height: 0;\n}\n.management-layout[data-v-6c72ccc2] {\n    flex-direction: column;\n    height: 100%;\n}\n.grid-container[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr auto;\n    grid-template-areas:\n      'header-right'\n      'content-main'\n      'footer-main';\n    order: 1;\n}\n\n  /* 移动端隐藏垂直分割线 */\n.grid-container[data-v-6c72ccc2]::before {\n    display: none;\n}\n.grid-header-left[data-v-6c72ccc2] {\n    border-right: none;\n    border-bottom: 1px solid var(--color-border);\n    /* 手机端隐藏左侧标题栏 */\n    display: none;\n}\n.grid-header-right[data-v-6c72ccc2] {\n    padding: 0.8rem;\n    flex-direction: column;\n    align-items: stretch;\n    gap: 0.8rem;\n}\n.header-left-content[data-v-6c72ccc2] {\n    gap: 0.3rem;\n}\n.save-actions-buttons[data-v-6c72ccc2] {\n    width: 100%;\n    gap: 0.5rem;\n}\n.btn-save-action[data-v-6c72ccc2] {\n    flex: 1;\n    padding: 0.7rem 0.8rem;\n    font-size: 0.8rem;\n    justify-content: center;\n}\n.btn-save-action span[data-v-6c72ccc2] {\n    display: inline;\n}\n.grid-content-left[data-v-6c72ccc2],\n  .grid-content-right[data-v-6c72ccc2] {\n    grid-area: content-main;\n    position: relative;\n    overflow: hidden;\n    height: 100%;\n}\n.grid-footer-left[data-v-6c72ccc2],\n  .grid-footer-right[data-v-6c72ccc2] {\n    grid-area: footer-main;\n    border-right: none;\n}\n.characters-panel[data-v-6c72ccc2] {\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    width: 85%;\n    max-width: 280px;\n    z-index: 1200;\n    transform: translateX(-100%);\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);\n    border: none;\n    background: var(--color-surface);\n    backdrop-filter: blur(20px);\n    margin: 0;\n    padding: 0;\n    border-right: none;\n}\n.characters-panel.is-open[data-v-6c72ccc2] {\n    transform: translateX(0);\n}\n.saves-panel[data-v-6c72ccc2] {\n    width: 100%;\n    border-left: none;\n}\n.saves-container[data-v-6c72ccc2],\n  .online-saves-container[data-v-6c72ccc2] {\n    padding: 1rem 1.2rem;\n    flex: 1;\n    min-height: 0;\n    max-height: none;\n}\n.auto-saves-grid[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    gap: 0.8rem;\n}\n.manual-saves-grid[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    gap: 0.8rem;\n    max-height: 300px;\n}\n.modal-content[data-v-6c72ccc2] {\n    padding: 1rem;\n}\n.details-modal[data-v-6c72ccc2] {\n    width: 95%;\n    max-height: 85vh;\n}\n.dialog-box[data-v-6c72ccc2] {\n    width: 95%;\n    max-width: 400px;\n    padding: 1.5rem;\n}\n.characters-grid[data-v-6c72ccc2] {\n    padding: 1rem;\n}\n.character-card[data-v-6c72ccc2] {\n    padding: 1rem;\n    margin-bottom: 0.8rem;\n    transition: all 0.2s ease;\n}\n.character-card[data-v-6c72ccc2]:active {\n    transform: scale(0.98);\n    background: linear-gradient(\n      135deg,\n      rgba(var(--color-primary-rgb), 0.05),\n      rgba(var(--color-accent-rgb), 0.03)\n    );\n}\n.card-header[data-v-6c72ccc2] {\n    flex-wrap: wrap;\n    gap: 0.8rem;\n}\n.char-info[data-v-6c72ccc2] {\n    min-width: 120px;\n}\n.char-meta[data-v-6c72ccc2] {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n}\n@media (max-width: 640px) {\n.mobile-header[data-v-6c72ccc2] {\n    padding: 0.8rem 1rem;\n}\n.mobile-menu-btn[data-v-6c72ccc2] {\n    padding: 0.4rem 0.6rem;\n    font-size: 0.8rem;\n    min-height: 44px;\n    min-width: 44px;\n}\n.mobile-title h2[data-v-6c72ccc2] {\n    font-size: 1.1rem;\n}\n.mobile-title .selected-info[data-v-6c72ccc2] {\n    font-size: 0.75rem;\n}\n.characters-panel[data-v-6c72ccc2] {\n    width: 90%;\n    max-width: 300px;\n}\n.character-card[data-v-6c72ccc2] {\n    padding: 0.9rem;\n    position: relative;\n    overflow: hidden;\n}\n.character-card[data-v-6c72ccc2]::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(var(--color-primary-rgb), 0.1);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    transition:\n      width 0.3s ease,\n      height 0.3s ease;\n    pointer-events: none;\n}\n.character-card[data-v-6c72ccc2]:active::after {\n    width: 200px;\n    height: 200px;\n}\n.save-card[data-v-6c72ccc2],\n  .online-save-card[data-v-6c72ccc2] {\n    padding: 1rem;\n    position: relative;\n    overflow: hidden;\n}\n.save-card[data-v-6c72ccc2]::after,\n  .online-save-card[data-v-6c72ccc2]::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(var(--color-success-rgb), 0.1);\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    transition:\n      width 0.3s ease,\n      height 0.3s ease;\n    pointer-events: none;\n}\n.save-card[data-v-6c72ccc2]:active::after,\n  .online-save-card[data-v-6c72ccc2]:active::after {\n    width: 150px;\n    height: 150px;\n}\n.auto-saves-grid[data-v-6c72ccc2] {\n    gap: 0.6rem;\n}\n.manual-saves-grid[data-v-6c72ccc2] {\n    gap: 0.6rem;\n}\n}\n@media (max-width: 480px) {\n.empty-actions[data-v-6c72ccc2] {\n    flex-direction: column;\n}\n.btn-create[data-v-6c72ccc2],\n  .btn-import[data-v-6c72ccc2] {\n    width: 100%;\n}\n.mobile-header[data-v-6c72ccc2] {\n    padding: 0.6rem 0.8rem;\n}\n.mobile-menu-btn[data-v-6c72ccc2] {\n    padding: 0.4rem 0.5rem;\n    min-height: 44px;\n    min-width: 44px;\n}\n.mobile-title h2[data-v-6c72ccc2] {\n    font-size: 1rem;\n}\n.hamburger[data-v-6c72ccc2] {\n    width: 14px;\n    height: 10px;\n}\n.characters-panel[data-v-6c72ccc2] {\n    width: 95%;\n    max-width: 280px;\n}\n.characters-grid[data-v-6c72ccc2] {\n    padding: 0.8rem;\n}\n.character-card[data-v-6c72ccc2] {\n    padding: 0.8rem;\n    margin-bottom: 0.8rem;\n    min-height: 80px;\n}\n.btn-save-action span[data-v-6c72ccc2] {\n    font-size: 0.75rem;\n}\n.card-header[data-v-6c72ccc2] {\n    margin-bottom: 0.8rem;\n    gap: 0.6rem;\n}\n.char-avatar[data-v-6c72ccc2] {\n    width: 40px;\n    height: 40px;\n    font-size: 1.1rem;\n}\n.mode-indicator[data-v-6c72ccc2] {\n    width: 16px;\n    height: 16px;\n    font-size: 0.6rem;\n}\n.char-name[data-v-6c72ccc2] {\n    font-size: 1rem;\n}\n.char-meta[data-v-6c72ccc2] {\n    font-size: 0.8rem;\n}\n.saves-container[data-v-6c72ccc2],\n  .online-saves-container[data-v-6c72ccc2] {\n    padding: 0.8rem;\n    flex: 1;\n    min-height: 0;\n    max-height: none;\n}\n.save-card[data-v-6c72ccc2],\n  .online-save-card[data-v-6c72ccc2] {\n    padding: 0.9rem;\n    min-height: 120px;\n}\n.stat-grid[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n}\n.save-footer[data-v-6c72ccc2] {\n    flex-direction: column;\n    gap: 0.3rem;\n    align-items: flex-start;\n}\n.dialog-box[data-v-6c72ccc2] {\n    width: 95%;\n    padding: 1.2rem;\n    max-height: 90vh;\n    overflow-y: auto;\n}\n.dialog-title[data-v-6c72ccc2] {\n    font-size: 1.3rem;\n}\n.dialog-actions[data-v-6c72ccc2] {\n    flex-direction: column-reverse;\n    gap: 0.8rem;\n}\n.btn-dialog-confirm[data-v-6c72ccc2],\n  .btn-dialog-cancel[data-v-6c72ccc2] {\n    width: 100%;\n    padding: 0.8rem;\n    min-height: 44px;\n    font-size: 1rem;\n}\n.details-grid[data-v-6c72ccc2] {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n}\n.detail-section[data-v-6c72ccc2] {\n    padding: 1rem;\n}\n.btn-details[data-v-6c72ccc2],\n  .btn-export[data-v-6c72ccc2],\n  .btn-delete[data-v-6c72ccc2] {\n    min-height: 36px;\n    font-size: 0.85rem;\n    padding: 0.6rem 0.8rem;\n}\n.btn-start[data-v-6c72ccc2],\n  .btn-play[data-v-6c72ccc2],\n  .btn-sync[data-v-6c72ccc2] {\n    min-height: 40px;\n    padding: 0.7rem 1rem;\n    font-size: 0.85rem;\n}\n}\n@media (max-width: 360px) {\n.mobile-header[data-v-6c72ccc2] {\n    padding: 0.5rem;\n}\n.mobile-menu-btn[data-v-6c72ccc2] {\n    padding: 0.3rem 0.4rem;\n    gap: 0.3rem;\n    min-height: 40px;\n    min-width: 40px;\n}\n.mobile-title h2[data-v-6c72ccc2] {\n    font-size: 0.95rem;\n}\n.mobile-title .selected-info[data-v-6c72ccc2] {\n    font-size: 0.7rem;\n}\n.characters-panel[data-v-6c72ccc2] {\n    width: 100%;\n    max-width: 260px;\n    min-width: 240px;\n}\n.character-card[data-v-6c72ccc2] {\n    padding: 0.6rem;\n    min-height: 70px;\n}\n.save-card[data-v-6c72ccc2],\n  .online-save-card[data-v-6c72ccc2] {\n    padding: 0.8rem;\n    min-height: 100px;\n}\n.save-header[data-v-6c72ccc2] {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n}\n.save-badges[data-v-6c72ccc2] {\n    align-self: stretch;\n    justify-content: flex-start;\n}\n.dialog-box[data-v-6c72ccc2] {\n    width: 98%;\n    padding: 1rem;\n    margin: 0.5rem;\n    max-height: 95vh;\n}\n.dialog-title[data-v-6c72ccc2] {\n    font-size: 1.1rem;\n}\n.dialog-message[data-v-6c72ccc2] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n}\n.dialog-input[data-v-6c72ccc2] {\n    padding: 0.7rem;\n    font-size: 0.9rem;\n}\n.btn-dialog-confirm[data-v-6c72ccc2],\n  .btn-dialog-cancel[data-v-6c72ccc2] {\n    padding: 0.7rem;\n    font-size: 0.9rem;\n    min-height: 40px;\n}\n.character-management-panel[data-v-6c72ccc2] {\n    height: 100%;\n    overflow: hidden;\n}\n.main-content[data-v-6c72ccc2] {\n    flex: 1;\n    overflow: hidden;\n    min-height: 0;\n}\n.saves-container[data-v-6c72ccc2],\n  .online-saves-container[data-v-6c72ccc2] {\n    flex: 1;\n    min-height: 0;\n    padding: 0.6rem;\n    max-height: none;\n}\n.char-name[data-v-6c72ccc2] {\n    font-size: 0.9rem;\n}\n.char-meta[data-v-6c72ccc2] {\n    font-size: 0.75rem;\n}\n.save-count .count[data-v-6c72ccc2] {\n    font-size: 1rem;\n}\n.save-count .label[data-v-6c72ccc2] {\n    font-size: 0.65rem;\n}\n}\n\n/* Style unification overrides */\n/* Replace absolute divider with contextual borders */\n.grid-container[data-v-6c72ccc2]::before {\n  content: none;\n}\n.grid-header-left[data-v-6c72ccc2],\n.grid-content-left[data-v-6c72ccc2],\n.grid-footer-left[data-v-6c72ccc2] {\n  border-right: var(--cm-divider-width) solid var(--color-primary);\n  box-sizing: border-box;\n}\n\n/* Ensure left column fills its grid cell at <=1024px (fix misaligned divider) */\n@media (max-width: 1024px) {\n.grid-content-left.characters-panel[data-v-6c72ccc2] {\n    max-width: none;\n    width: 100%;\n}\n}\n\n/* Consistent radii across controls */\n.dialog-box[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-lg);\n}\n.dialog-input[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-dialog-confirm[data-v-6c72ccc2],\n.btn-dialog-cancel[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.fullscreen-back-btn[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.character-card[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-sm);\n}\n.save-card[data-v-6c72ccc2],\n.online-save-card[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-details[data-v-6c72ccc2],\n.btn-delete[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-start[data-v-6c72ccc2],\n.btn-play[data-v-6c72ccc2],\n.btn-sync[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n.btn-login[data-v-6c72ccc2],\n.btn-close[data-v-6c72ccc2] {\n  border-radius: var(--cm-radius-md);\n}\n\n/* Desktop card density adjustments: make character list less flat */\n@media (min-width: 769px) {\n.characters-grid[data-v-6c72ccc2] {\n    padding: 0.8rem;\n}\n.character-card[data-v-6c72ccc2] {\n    min-height: var(--cm-card-min-h);\n    padding: var(--cm-card-padding);\n}\n.card-header[data-v-6c72ccc2] {\n    gap: var(--cm-header-gap);\n    margin-bottom: 0.6rem;\n}\n.char-avatar[data-v-6c72ccc2] {\n    width: var(--cm-avatar-size);\n    height: var(--cm-avatar-size);\n    font-size: 0.95rem;\n}\n.char-name[data-v-6c72ccc2] {\n    font-size: var(--cm-name-font);\n}\n.char-meta[data-v-6c72ccc2] {\n    font-size: var(--cm-meta-font);\n}\n.save-count[data-v-6c72ccc2] {\n    min-width: var(--cm-save-count-minw);\n}\n.save-count .count[data-v-6c72ccc2] {\n    font-size: var(--cm-save-count-count-font);\n}\n.save-count .label[data-v-6c72ccc2] {\n    font-size: var(--cm-save-count-label-font);\n}\n}\n\n/* ========== 深色玻璃拟态风格适配 ========== */\n[data-theme='dark'] .character-management-panel[data-v-6c72ccc2] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .fullscreen-header[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.9);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme='dark'] .fullscreen-back-btn[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .fullscreen-back-btn[data-v-6c72ccc2]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme='dark'] .fullscreen-title h1[data-v-6c72ccc2] {\n  color: #f1f5f9;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.4);\n}\n[data-theme='dark'] .fullscreen-title p[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .mobile-header[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.9);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n}\n[data-theme='dark'] .mobile-menu-btn[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.8);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .mobile-menu-btn[data-v-6c72ccc2]:hover {\n  background: rgba(51, 65, 85, 0.9);\n  color: #93c5fd;\n  border-color: rgba(147, 197, 253, 0.3);\n}\n[data-theme='dark'] .mobile-menu-btn.active[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  color: #ffffff;\n  border-color: rgba(147, 197, 253, 0.5);\n}\n[data-theme='dark'] .mobile-title h2[data-v-6c72ccc2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .mobile-title .selected-info[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n\n/* 网格布局暗色适配 */\n[data-theme='dark'] .grid-header-left[data-v-6c72ccc2],\n[data-theme='dark'] .grid-header-right[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.8);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .grid-header-left h2[data-v-6c72ccc2],\n[data-theme='dark'] .grid-header-right h2[data-v-6c72ccc2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .character-count[data-v-6c72ccc2] {\n  background: rgba(15, 23, 42, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n  color: #94a3b8;\n}\n[data-theme='dark'] .selected-char-info[data-v-6c72ccc2] {\n  background: rgba(59, 130, 246, 0.15);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #93c5fd;\n}\n[data-theme='dark'] .grid-content-left[data-v-6c72ccc2],\n[data-theme='dark'] .grid-content-right[data-v-6c72ccc2] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .grid-content-left.characters-panel[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.95);\n}\n\n/* 分割线暗色适配 */\n[data-theme='dark'] .grid-header-left[data-v-6c72ccc2],\n[data-theme='dark'] .grid-content-left[data-v-6c72ccc2],\n[data-theme='dark'] .grid-footer-left[data-v-6c72ccc2] {\n  border-right-color: rgba(147, 197, 253, 0.3);\n}\n\n/* 角色卡片暗色适配 */\n[data-theme='dark'] .character-card[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .character-card[data-v-6c72ccc2]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  border-color: rgba(147, 197, 253, 0.3);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n[data-theme='dark'] .character-card.active[data-v-6c72ccc2] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.5);\n}\n[data-theme='dark'] .character-card.single-mode[data-v-6c72ccc2] {\n  border-left-color: #9ece6a;\n}\n[data-theme='dark'] .character-card.online-mode[data-v-6c72ccc2] {\n  border-left-color: #93c5fd;\n}\n[data-theme='dark'] .char-name[data-v-6c72ccc2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .char-meta[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .save-count .count[data-v-6c72ccc2] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .save-count .label[data-v-6c72ccc2] {\n  color: #64748b;\n}\n[data-theme='dark'] .card-actions[data-v-6c72ccc2] {\n  border-top-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .btn-details[data-v-6c72ccc2],\n[data-theme='dark'] .btn-export[data-v-6c72ccc2],\n[data-theme='dark'] .btn-delete[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.6);\n}\n[data-theme='dark'] .btn-details[data-v-6c72ccc2] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-details[data-v-6c72ccc2]:hover {\n  background: #77cdfe;\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-export[data-v-6c72ccc2] {\n  color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.4);\n}\n[data-theme='dark'] .btn-export[data-v-6c72ccc2]:hover {\n  background: #9ece6a;\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-delete[data-v-6c72ccc2] {\n  color: #f87171;\n  border-color: rgba(248, 113, 113, 0.4);\n}\n[data-theme='dark'] .btn-delete[data-v-6c72ccc2]:hover {\n  background: #f87171;\n  color: #0f172a;\n}\n\n/* 存档面板暗色适配 */\n[data-theme='dark'] .saves-panel[data-v-6c72ccc2] {\n  background: rgb(30, 41, 59);\n}\n[data-theme='dark'] .no-selection[data-v-6c72ccc2] {\n  color: #64748b;\n}\n[data-theme='dark'] .manual-saves-header h3[data-v-6c72ccc2] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .save-info-text[data-v-6c72ccc2] {\n  color: #64748b;\n}\n\n/* 存档卡片暗色适配 */\n[data-theme='dark'] .save-card[data-v-6c72ccc2],\n[data-theme='dark'] .online-save-card[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.7);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(15px);\n}\n[data-theme='dark'] .save-card[data-v-6c72ccc2]::before,\n[data-theme='dark'] .online-save-card[data-v-6c72ccc2]::before {\n  background: linear-gradient(135deg, rgba(147, 197, 253, 0.08), rgba(192, 202, 245, 0.04));\n}\n[data-theme='dark'] .save-card[data-v-6c72ccc2]:hover,\n[data-theme='dark'] .online-save-card[data-v-6c72ccc2]:hover {\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);\n}\n[data-theme='dark'] .save-card.has-data[data-v-6c72ccc2] {\n  border-left-color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .save-card.auto-save[data-v-6c72ccc2] {\n  border-left-color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.5);\n}\n[data-theme='dark'] .save-card.has-data[data-v-6c72ccc2]::after {\n  background: #9ece6a;\n  box-shadow: 0 0 8px rgba(158, 206, 106, 0.6);\n}\n[data-theme='dark'] .save-name[data-v-6c72ccc2] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .realm-badge[data-v-6c72ccc2] {\n  background: rgba(158, 206, 106, 0.2);\n  color: #9ece6a;\n}\n[data-theme='dark'] .age-badge[data-v-6c72ccc2] {\n  background: rgba(192, 202, 245, 0.2);\n  color: #c0caf5;\n}\n[data-theme='dark'] .stat .label[data-v-6c72ccc2] {\n  color: #64748b;\n}\n[data-theme='dark'] .stat .value[data-v-6c72ccc2] {\n  color: #e2e8f0;\n}\n[data-theme='dark'] .save-footer[data-v-6c72ccc2] {\n  border-top-color: rgba(255, 255, 255, 0.08);\n  color: #64748b;\n}\n[data-theme='dark'] .sync-status.synced[data-v-6c72ccc2] {\n  background: rgba(158, 206, 106, 0.2);\n  color: #9ece6a;\n}\n[data-theme='dark'] .save-empty[data-v-6c72ccc2] {\n  color: #64748b;\n}\n\n/* 存档操作按钮暗色适配 */\n[data-theme='dark'] .btn-export-save[data-v-6c72ccc2] {\n  background: rgba(158, 206, 106, 0.15);\n  border-color: rgba(158, 206, 106, 0.3);\n  color: #9ece6a;\n}\n[data-theme='dark'] .btn-export-save[data-v-6c72ccc2]:hover {\n  background: rgba(158, 206, 106, 0.25);\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .btn-edit-save[data-v-6c72ccc2] {\n  background: rgba(119, 205, 254, 0.15);\n  border-color: rgba(119, 205, 254, 0.3);\n  color: #77cdfe;\n}\n[data-theme='dark'] .btn-edit-save[data-v-6c72ccc2]:hover {\n  background: rgba(119, 205, 254, 0.25);\n  border-color: rgba(119, 205, 254, 0.5);\n}\n[data-theme='dark'] .btn-delete-save[data-v-6c72ccc2] {\n  background: rgba(248, 113, 113, 0.15);\n  border-color: rgba(248, 113, 113, 0.3);\n  color: #f87171;\n}\n[data-theme='dark'] .btn-delete-save[data-v-6c72ccc2]:hover:not(.disabled):not(:disabled) {\n  background: rgba(248, 113, 113, 0.25);\n  border-color: rgba(248, 113, 113, 0.5);\n}\n\n/* 按钮暗色适配 */\n[data-theme='dark'] .btn-start[data-v-6c72ccc2],\n[data-theme='dark'] .btn-play[data-v-6c72ccc2],\n[data-theme='dark'] .btn-sync[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n[data-theme='dark'] .btn-start[data-v-6c72ccc2]:hover,\n[data-theme='dark'] .btn-play[data-v-6c72ccc2]:hover,\n[data-theme='dark'] .btn-sync[data-v-6c72ccc2]:hover {\n  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n}\n[data-theme='dark'] .btn-header-action[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.6);\n}\n[data-theme='dark'] .btn-header-action.import[data-v-6c72ccc2] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-header-action.import[data-v-6c72ccc2]:hover {\n  background: rgba(119, 205, 254, 0.15);\n  border-color: #77cdfe;\n}\n[data-theme='dark'] .btn-save-action[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.7);\n  backdrop-filter: blur(10px);\n}\n[data-theme='dark'] .btn-save-action.export[data-v-6c72ccc2] {\n  color: #9ece6a;\n  border-color: rgba(158, 206, 106, 0.4);\n}\n[data-theme='dark'] .btn-save-action.export[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #9ece6a, rgba(158, 206, 106, 0.8));\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-save-action.import[data-v-6c72ccc2] {\n  color: #77cdfe;\n  border-color: rgba(119, 205, 254, 0.4);\n}\n[data-theme='dark'] .btn-save-action.import[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, #77cdfe, rgba(119, 205, 254, 0.8));\n  color: #0f172a;\n}\n[data-theme='dark'] .btn-save-action.migrate[data-v-6c72ccc2] {\n  color: var(--color-warning);\n  border-color: rgba(var(--color-warning-rgb), 0.45);\n}\n[data-theme='dark'] .btn-save-action.migrate[data-v-6c72ccc2]:hover:not(:disabled) {\n  background: linear-gradient(135deg, var(--color-warning), rgba(var(--color-warning-rgb), 0.85));\n  color: #0f172a;\n}\n\n/* 对话框暗色适配 */\n[data-theme='dark'] .dialog-overlay[data-v-6c72ccc2] {\n  background: rgba(10, 15, 25, 0.7);\n}\n[data-theme='dark'] .dialog-box[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(20px);\n}\n[data-theme='dark'] .dialog-title[data-v-6c72ccc2] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .dialog-message[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .dialog-input[data-v-6c72ccc2] {\n  background: rgba(15, 23, 42, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #f1f5f9;\n}\n[data-theme='dark'] .dialog-input[data-v-6c72ccc2]:focus {\n  border-color: #93c5fd;\n  box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.2);\n}\n[data-theme='dark'] .btn-dialog-confirm[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n}\n[data-theme='dark'] .btn-dialog-cancel[data-v-6c72ccc2] {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-dialog-cancel[data-v-6c72ccc2]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  color: #f1f5f9;\n}\n\n/* 详情弹窗暗色适配 */\n[data-theme='dark'] .modal-overlay[data-v-6c72ccc2] {\n  background: rgba(10, 15, 25, 0.7);\n}\n[data-theme='dark'] .details-modal[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.95);\n  border-color: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(20px);\n}\n[data-theme='dark'] .modal-header[data-v-6c72ccc2] {\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n[data-theme='dark'] .modal-header h3[data-v-6c72ccc2] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .btn-close[data-v-6c72ccc2] {\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #64748b;\n}\n[data-theme='dark'] .btn-close[data-v-6c72ccc2]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  color: #f1f5f9;\n}\n[data-theme='dark'] .detail-section[data-v-6c72ccc2] {\n  background: rgba(30, 41, 59, 0.6);\n  border-color: rgba(147, 197, 253, 0.15);\n}\n[data-theme='dark'] .detail-section h4[data-v-6c72ccc2] {\n  color: #fbbf24;\n}\n[data-theme='dark'] .detail-item[data-v-6c72ccc2] {\n  border-bottom-color: rgba(255, 255, 255, 0.06);\n}\n[data-theme='dark'] .detail-item .label[data-v-6c72ccc2] {\n  color: #64748b;\n}\n[data-theme='dark'] .detail-item .value[data-v-6c72ccc2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .talent-tag[data-v-6c72ccc2] {\n  background: rgba(192, 202, 245, 0.2);\n  color: #c0caf5;\n}\n[data-theme='dark'] .no-talents[data-v-6c72ccc2] {\n  color: #64748b;\n}\n\n/* 空状态暗色适配 */\n[data-theme='dark'] .empty-state h2[data-v-6c72ccc2] {\n  color: #c0caf5;\n}\n[data-theme='dark'] .empty-state p[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-create[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, #9ece6a, #77cdfe);\n  border-color: rgba(158, 206, 106, 0.5);\n}\n[data-theme='dark'] .btn-import[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(192, 202, 245, 0.8));\n  border-color: rgba(147, 197, 253, 0.5);\n}\n\n/* 联机模式暗色适配 */\n[data-theme='dark'] .login-prompt h3[data-v-6c72ccc2] {\n  color: #f1f5f9;\n}\n[data-theme='dark'] .login-prompt p[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .btn-login[data-v-6c72ccc2] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));\n  border-color: rgba(147, 197, 253, 0.4);\n}\n\n/* 加载状态暗色适配 */\n[data-theme='dark'] .loading-saves p[data-v-6c72ccc2] {\n  color: #94a3b8;\n}\n[data-theme='dark'] .loading-spinner[data-v-6c72ccc2] {\n  border-color: rgba(147, 197, 253, 0.2);\n  border-top-color: #93c5fd;\n}\n",""]);const s=i},8932:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.dialog-overlay[data-v-7a662fc0] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n  padding: 1rem;\n  animation: fadeIn-7a662fc0 0.3s ease-out;\n}\n@keyframes fadeIn-7a662fc0 {\nfrom { opacity: 0;\n}\nto { opacity: 1;\n}\n}\n.dialog-container[data-v-7a662fc0] {\n  background-color: var(--color-surface);\n  border-radius: 16px;\n  padding: 2rem;\n  width: 100%;\n  max-width: 550px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n  border: 1px solid var(--color-border);\n  animation: slideInUp-7a662fc0 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n}\n@keyframes slideInUp-7a662fc0 {\nfrom {\n    opacity: 0;\n    transform: translateY(30px) scale(0.98);\n}\nto {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n}\n.dialog-header[data-v-7a662fc0] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  color: var(--color-danger);\n}\n.header-icon[data-v-7a662fc0] {\n  flex-shrink: 0;\n}\n.header-title[data-v-7a662fc0] {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 700;\n}\n.dialog-content[data-v-7a662fc0] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 2rem;\n}\n.content-lead[data-v-7a662fc0] {\n  font-size: 1rem;\n  line-height: 1.6;\n  color: var(--color-text);\n}\n.error-list-container[data-v-7a662fc0] {\n  background-color: rgba(var(--color-danger-rgb), 0.05);\n  border: 1px solid rgba(var(--color-danger-rgb), 0.2);\n  border-radius: 8px;\n  padding: 1rem;\n}\n.error-list-title[data-v-7a662fc0] {\n  display: block;\n  margin-bottom: 0.75rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.error-list[data-v-7a662fc0] {\n  list-style-type: none;\n  padding-left: 0;\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.error-item[data-v-7a662fc0] {\n  font-family: 'Courier New', Courier, monospace;\n  font-size: 0.875rem;\n  color: var(--color-danger);\n  padding: 0.5rem;\n  background-color: rgba(var(--color-danger-rgb), 0.05);\n  border-radius: 4px;\n}\n.content-suggestion[data-v-7a662fc0] {\n  font-size: 0.875rem;\n  line-height: 1.5;\n  color: var(--color-text-secondary);\n}\n.content-suggestion strong[data-v-7a662fc0] {\n  color: var(--color-warning);\n  font-weight: 600;\n}\n.dialog-actions[data-v-7a662fc0] {\n  display: flex;\n  justify-content: flex-end;\n}\n.action-button[data-v-7a662fc0] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.confirm-button[data-v-7a662fc0] {\n  background-color: var(--color-primary);\n  color: white;\n}\n.confirm-button[data-v-7a662fc0]:hover {\n  background-color: var(--color-primary-hover);\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);\n}\n",""]);const s=i},8951:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* ========== 深色玻璃拟态风格 ========== */\n.origin-selection-container[data-v-3d363671] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.loading-state[data-v-3d363671], .error-state[data-v-3d363671], .placeholder[data-v-3d363671] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-size: 1.1rem;\n  color: #94a3b8;\n  font-style: italic;\n}\n.origin-layout[data-v-3d363671] {\n  display: grid;\n  grid-template-columns: 1fr 2fr;\n  gap: 1.5rem;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* ========== 左侧面板 ========== */\n.origin-left-panel[data-v-3d363671] {\n  display: flex;\n  flex-direction: column;\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  overflow: hidden;\n}\n.origin-list-container[data-v-3d363671] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.origin-list-container[data-v-3d363671]::-webkit-scrollbar { width: 6px;\n}\n.origin-list-container[data-v-3d363671]::-webkit-scrollbar-track { background: transparent;\n}\n.origin-list-container[data-v-3d363671]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.origin-list-container[data-v-3d363671]::-webkit-scrollbar-thumb:hover { background: rgba(147, 197, 253, 0.5);\n}\n\n/* ========== 选项卡样式 ========== */\n.origin-item[data-v-3d363671] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.1rem 1.2rem;\n  margin-bottom: 0.6rem;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 1px solid transparent;\n  background: rgba(30, 41, 59, 0.4);\n}\n.origin-item[data-v-3d363671]:hover {\n  background: rgba(51, 65, 85, 0.6);\n  border-color: rgba(147, 197, 253, 0.2);\n}\n.origin-item.selected[data-v-3d363671] {\n  background: rgba(30, 58, 138, 0.4);\n  border-color: rgba(147, 197, 253, 0.4);\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n.origin-item.disabled[data-v-3d363671] {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.origin-item.disabled[data-v-3d363671]:hover {\n  background: rgba(30, 41, 59, 0.4);\n  border-color: transparent;\n}\n.item-content[data-v-3d363671] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-grow: 1;\n}\n.origin-name[data-v-3d363671] {\n  font-weight: 500;\n  color: #f1f5f9;\n}\n.origin-item.selected .origin-name[data-v-3d363671] {\n  color: #bfdbfe;\n}\n.origin-cost[data-v-3d363671] {\n  color: #fbbf24;\n  font-size: 0.85rem;\n  font-weight: 500;\n}\n\n/* 按钮组容器 */\n.action-buttons[data-v-3d363671] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  opacity: 0;\n  transition: opacity 0.2s;\n  margin-left: 0.5rem;\n}\n.origin-item:hover .action-buttons[data-v-3d363671] {\n  opacity: 1;\n}\n.edit-btn[data-v-3d363671], .delete-btn[data-v-3d363671] {\n  background: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n  cursor: pointer;\n  padding: 0.35rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n.edit-btn[data-v-3d363671]:hover {\n  color: #93c5fd;\n  background: rgba(147, 197, 253, 0.1);\n}\n.delete-btn[data-v-3d363671]:hover {\n  color: #f87171;\n  background: rgba(248, 113, 113, 0.1);\n}\n.divider[data-v-3d363671] {\n  height: 1px;\n  background: linear-gradient(to right, transparent, rgba(147, 197, 253, 0.2), transparent);\n  margin: 0.5rem 0;\n}\n.action-name[data-v-3d363671] {\n  font-weight: 500;\n}\n\n/* ========== 右侧详情面板 ========== */\n.origin-details-container[data-v-3d363671] {\n  background: rgba(30, 41, 59, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.origin-details[data-v-3d363671] {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n}\n.origin-details h2[data-v-3d363671] {\n  margin: 0 0 1rem 0;\n  color: #93c5fd;\n  flex-shrink: 0;\n  font-size: 1.5rem;\n  text-shadow: 0 0 20px rgba(147, 197, 253, 0.3);\n}\n.description-scroll[data-v-3d363671] {\n  flex: 1;\n  overflow-y: auto;\n  line-height: 1.7;\n  margin-bottom: 1rem;\n  padding-right: 0.5rem;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(147, 197, 253, 0.3) transparent;\n}\n.description-scroll[data-v-3d363671]::-webkit-scrollbar { width: 6px;\n}\n.description-scroll[data-v-3d363671]::-webkit-scrollbar-track { background: transparent;\n}\n.description-scroll[data-v-3d363671]::-webkit-scrollbar-thumb { background: rgba(147, 197, 253, 0.3); border-radius: 3px;\n}\n.description-scroll p[data-v-3d363671] {\n  margin: 0;\n  white-space: pre-wrap;\n  color: #94a3b8;\n}\n.cost-display[data-v-3d363671] {\n  text-align: right;\n  font-weight: 600;\n  color: #fbbf24;\n  flex-shrink: 0;\n}\n\n/* ========== 亮色主题适配 ========== */\n[data-theme="light"] .origin-left-panel[data-v-3d363671],\n[data-theme="light"] .origin-details-container[data-v-3d363671] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .origin-item[data-v-3d363671] {\n  background: rgba(255, 255, 255, 0.6);\n}\n[data-theme="light"] .origin-item[data-v-3d363671]:hover {\n  background: rgba(241, 245, 249, 0.95);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n[data-theme="light"] .origin-item.selected[data-v-3d363671] {\n  background: rgba(219, 234, 254, 0.8);\n  border-color: rgba(59, 130, 246, 0.4);\n}\n[data-theme="light"] .origin-name[data-v-3d363671] {\n  color: #1e293b;\n}\n[data-theme="light"] .origin-item.selected .origin-name[data-v-3d363671] {\n  color: #1e40af;\n}\n[data-theme="light"] .origin-details h2[data-v-3d363671] {\n  color: #2563eb;\n}\n[data-theme="light"] .description-scroll p[data-v-3d363671] {\n  color: #475569;\n}\n\n/* 响应式适配 - 手机端优化 */\n@media (max-width: 1200px) {\n.origin-layout[data-v-3d363671] {\n    grid-template-columns: 1fr 1.8fr;\n    gap: 1.5rem;\n}\n}\n@media (max-width: 1024px) {\n.origin-layout[data-v-3d363671] {\n    grid-template-columns: 1fr 1.5fr;\n    gap: 1.2rem;\n}\n.origin-details h2[data-v-3d363671] {\n    font-size: 1.6rem;\n}\n}\n@media (max-width: 640px) {\n.top-actions-container[data-v-3d363671] {\n    flex-wrap: wrap;\n    justify-content: stretch;\n}\n.top-actions-container .action-item[data-v-3d363671] {\n    flex-grow: 1;\n    text-align: center;\n}\n.origin-layout[data-v-3d363671] {\n    /* 改为垂直堆叠布局 */\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n    gap: 1rem;\n    height: auto;\n    overflow: visible;\n    padding: 0.8rem;\n}\n.origin-left-panel[data-v-3d363671] {\n    order: 1;\n    max-height: 40vh;\n}\n.origin-details-container[data-v-3d363671] {\n    order: 2;\n    min-height: 300px;\n}\n.origin-list-container[data-v-3d363671] {\n    max-height: 35vh;\n    /* 添加触摸滚动优化 */\n    -webkit-overflow-scrolling: touch;\n    scrollbar-width: thin;\n}\n\n  /* 优化触摸体验 */\n.origin-item[data-v-3d363671],\n  .action-item[data-v-3d363671] {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n}\n}\n@media (max-width: 640px) {\n.origin-layout[data-v-3d363671] {\n    gap: 0.8rem;\n    padding: 0.6rem;\n}\n.origin-left-panel[data-v-3d363671] {\n    max-height: 35vh;\n}\n.origin-list-container[data-v-3d363671] {\n    max-height: 30vh;\n    padding: 0.5rem;\n}\n.origin-item[data-v-3d363671] {\n    padding: 0.7rem;\n    font-size: 0.95rem;\n    margin-bottom: 0.4rem;\n}\n.single-actions-container[data-v-3d363671] {\n    padding: 0.5rem;\n    gap: 0.4rem;\n}\n.action-item[data-v-3d363671] {\n    padding: 0.7rem 1rem;\n    font-size: 0.9rem;\n}\n.origin-details-container[data-v-3d363671] {\n    padding: 1.2rem;\n    min-height: 250px;\n}\n.origin-details h2[data-v-3d363671] {\n    font-size: 1.4rem;\n    margin-bottom: 0.8rem;\n}\n}\n@media (max-width: 480px) {\n.top-actions-container[data-v-3d363671] {\n    flex-direction: column;\n    align-items: stretch;\n}\n.origin-selection-container[data-v-3d363671] {\n    padding: 0.4rem;\n    height: auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n.origin-layout[data-v-3d363671] {\n    gap: 0.6rem;\n    padding: 0;\n    height: auto;\n    min-height: 0;\n}\n.origin-left-panel[data-v-3d363671] {\n    max-height: none;\n    border-radius: 6px;\n}\n.origin-list-container[data-v-3d363671] {\n    max-height: 26vh;\n    padding: 0.4rem;\n}\n.origin-item[data-v-3d363671] {\n    padding: 0.6rem 0.8rem;\n    font-size: 0.9rem;\n    margin-bottom: 0.3rem;\n    border-radius: 4px;\n}\n.origin-name[data-v-3d363671] {\n    font-size: 0.9rem;\n}\n.origin-cost[data-v-3d363671] {\n    font-size: 0.8rem;\n}\n.divider[data-v-3d363671] {\n    margin: 0.3rem 0;\n}\n.single-actions-container[data-v-3d363671] {\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.4rem;\n}\n.action-item[data-v-3d363671] {\n    padding: 0.6rem;\n    font-size: 0.85rem;\n    border-radius: 4px;\n}\n.origin-details-container[data-v-3d363671] {\n    padding: 1rem;\n    min-height: 200px;\n    border-radius: 6px;\n}\n.origin-details h2[data-v-3d363671] {\n    font-size: 1.3rem;\n    margin-bottom: 0.6rem;\n}\n.description-scroll[data-v-3d363671] {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    padding-right: 0.3rem;\n    margin-bottom: 0.8rem;\n}\n.cost-display[data-v-3d363671] {\n    font-size: 1rem;\n    text-align: center;\n}\n.placeholder[data-v-3d363671] {\n    font-size: 1rem;\n    padding: 1rem;\n    text-align: center;\n    min-height: 150px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.top-actions-container[data-v-3d363671] {\n    flex-direction: column;\n    align-items: stretch;\n    padding: 0.5rem;\n}\n.top-actions-container .action-item[data-v-3d363671] {\n    text-align: center;\n}\n}\n\n/* 顶部功能按钮 - 深色玻璃拟态风格 */\n.top-actions-container[data-v-3d363671] {\n  display: flex;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n  background: rgba(30, 41, 59, 0.3);\n  justify-content: center;\n}\n.top-actions-container .action-item[data-v-3d363671] {\n  padding: 0.5rem 1rem;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  background: rgba(30, 41, 59, 0.6);\n  color: #cbd5e1;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  font-size: 0.85rem;\n  font-weight: 500;\n  white-space: nowrap;\n  letter-spacing: 0.05em;\n}\n.top-actions-container .action-item[data-v-3d363671]:hover {\n  background: rgba(51, 65, 85, 0.8);\n  border-color: rgba(147, 197, 253, 0.3);\n  color: #f1f5f9;\n}\n\n/* 亮色主题顶部按钮 */\n[data-theme="light"] .top-actions-container[data-v-3d363671] {\n  background: rgba(241, 245, 249, 0.6);\n  border-bottom-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-3d363671] {\n  background: rgba(255, 255, 255, 0.8);\n  border-color: rgba(59, 130, 246, 0.3);\n  color: #2563eb;\n}\n[data-theme="light"] .top-actions-container .action-item[data-v-3d363671]:hover {\n  background: rgba(59, 130, 246, 0.1);\n  border-color: #3b82f6;\n  color: #1e40af;\n}\n@media (max-width: 360px) {\n.origin-selection-container[data-v-3d363671] {\n    padding: 0.3rem;\n}\n.origin-layout[data-v-3d363671] {\n    gap: 0.4rem;\n}\n.origin-left-panel[data-v-3d363671] {\n    max-height: 28vh;\n}\n.origin-list-container[data-v-3d363671] {\n    max-height: 24vh;\n    padding: 0.3rem;\n}\n.origin-item[data-v-3d363671] {\n    padding: 0.5rem 0.6rem;\n    font-size: 0.85rem;\n    margin-bottom: 0.2rem;\n}\n.origin-name[data-v-3d363671] {\n    font-size: 0.8rem;\n}\n.origin-cost[data-v-3d363671] {\n    font-size: 0.75rem;\n}\n.origin-details-container[data-v-3d363671] {\n    padding: 0.8rem;\n    min-height: 180px;\n}\n.origin-details h2[data-v-3d363671] {\n    font-size: 1.1rem;\n    margin-bottom: 0.5rem;\n}\n.description-scroll[data-v-3d363671] {\n    font-size: 0.85rem;\n    line-height: 1.4;\n    margin-bottom: 0.6rem;\n}\n.cost-display[data-v-3d363671] {\n    font-size: 0.9rem;\n}\n.action-item[data-v-3d363671] {\n    padding: 0.5rem;\n    font-size: 0.8rem;\n}\n.placeholder[data-v-3d363671] {\n    font-size: 0.9rem;\n    padding: 0.8rem;\n    min-height: 120px;\n}\n}\n\n/* 亮色主题下的编辑/删除按钮 */\n[data-theme="light"] .edit-btn[data-v-3d363671],\n[data-theme="light"] .delete-btn[data-v-3d363671] {\n  background: rgba(241, 245, 249, 0.8);\n  border: 1px solid rgba(59, 130, 246, 0.15);\n  color: #475569;\n}\n[data-theme="light"] .edit-btn[data-v-3d363671]:hover {\n  color: #2563eb;\n  background: rgba(59, 130, 246, 0.1);\n  border-color: rgba(59, 130, 246, 0.3);\n}\n[data-theme="light"] .delete-btn[data-v-3d363671]:hover {\n  color: #dc2626;\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n}\n',""]);const s=i},8968:e=>{"use strict";e.exports=Math.floor},8992:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-contribution[data-v-e42e724c] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-height: 60vh;\n  overflow-y: auto;\n}\n.player-info-bar[data-v-e42e724c] {\n  display: flex;\n  gap: 1.5rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(168, 85, 247, 0.05));\n  border-radius: 8px;\n  border: 1px solid rgba(147, 51, 234, 0.2);\n}\n.info-item[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.info-item.highlight[data-v-e42e724c] {\n  padding: 0.25rem 0.75rem;\n  background: rgba(245, 158, 11, 0.1);\n  border-radius: 6px;\n  border: 1px solid rgba(245, 158, 11, 0.2);\n}\n.info-label[data-v-e42e724c] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.info-value[data-v-e42e724c] {\n  font-weight: 600;\n  font-size: 0.9rem;\n}\n.info-value.position[data-v-e42e724c] { color: #9333ea;\n}\n.info-value.contribution[data-v-e42e724c] { color: #f59e0b; font-size: 1.1rem;\n}\n.exchange-tabs[data-v-e42e724c] {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.35rem;\n  padding: 0.5rem 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  color: var(--color-text-secondary);\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tab-btn[data-v-e42e724c]:hover {\n  border-color: rgba(245, 158, 11, 0.3);\n  color: var(--color-text);\n}\n.tab-btn.active[data-v-e42e724c] {\n  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));\n  border-color: rgba(245, 158, 11, 0.4);\n  color: #f59e0b;\n}\n.exchange-list[data-v-e42e724c] {\n  flex: 1;\n  overflow-y: auto;\n}\n.empty-state[data-v-e42e724c] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--color-text-secondary);\n}\n.empty-icon[data-v-e42e724c] {\n  opacity: 0.5;\n  margin-bottom: 0.5rem;\n}\n.empty-text[data-v-e42e724c] {\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n.empty-hint[data-v-e42e724c] {\n  font-size: 0.8rem;\n  opacity: 0.7;\n  margin-bottom: 1rem;\n}\n.ask-btn[data-v-e42e724c] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.6rem 1rem;\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border: none;\n  border-radius: 6px;\n  color: white;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.ask-btn[data-v-e42e724c]:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);\n}\n.items-grid[data-v-e42e724c] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 0.75rem;\n}\n.item-card[data-v-e42e724c] {\n  padding: 0.75rem;\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  transition: all 0.2s ease;\n}\n.item-card[data-v-e42e724c]:hover {\n  border-color: rgba(245, 158, 11, 0.3);\n}\n.item-card.can-afford[data-v-e42e724c] {\n  border-color: rgba(34, 197, 94, 0.3);\n}\n.item-card.out-of-stock[data-v-e42e724c] {\n  opacity: 0.5;\n}\n.item-header[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.item-icon[data-v-e42e724c] {\n  font-size: 1.5rem;\n}\n.item-info[data-v-e42e724c] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.15rem;\n}\n.item-name[data-v-e42e724c] {\n  font-weight: 600;\n  font-size: 0.9rem;\n  color: var(--color-text);\n}\n.item-quality[data-v-e42e724c] {\n  font-size: 0.7rem;\n  padding: 0.1rem 0.35rem;\n  border-radius: 4px;\n  font-weight: 500;\n  width: fit-content;\n}\n.quality-common[data-v-e42e724c] { background: rgba(156, 163, 175, 0.2); color: #6b7280;\n}\n.quality-yellow[data-v-e42e724c] { background: rgba(245, 158, 11, 0.2); color: #f59e0b;\n}\n.quality-xuan[data-v-e42e724c] { background: rgba(139, 92, 246, 0.2); color: #8b5cf6;\n}\n.quality-earth[data-v-e42e724c] { background: rgba(59, 130, 246, 0.2); color: #3b82f6;\n}\n.quality-heaven[data-v-e42e724c] { background: rgba(239, 68, 68, 0.2); color: #ef4444;\n}\n.item-desc[data-v-e42e724c] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n}\n.item-footer[data-v-e42e724c] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.item-cost[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: #f59e0b;\n}\n.item-stock[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.2rem;\n  font-size: 0.7rem;\n  color: var(--color-text-secondary);\n}\n.exchange-btn[data-v-e42e724c] {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.35rem;\n  padding: 0.5rem;\n  background: linear-gradient(135deg, #f59e0b, #d97706);\n  border: none;\n  border-radius: 5px;\n  color: white;\n  font-size: 0.8rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.exchange-btn[data-v-e42e724c]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);\n}\n.exchange-btn[data-v-e42e724c]:disabled {\n  background: #6b7280;\n  cursor: not-allowed;\n}\n.contribution-tips[data-v-e42e724c] {\n  padding: 0.75rem;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.tips-title[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0 0 0.5rem 0;\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--color-text);\n}\n.tips-list[data-v-e42e724c] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.tip-item[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n  padding: 0.25rem 0.5rem;\n  background: var(--color-background);\n  border-radius: 4px;\n}\n.exchange-notice[data-v-e42e724c] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: rgba(59, 130, 246, 0.1);\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #3b82f6;\n}\n",""]);const s=i},9037:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});const a=(0,n(9596).A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9130:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.game-variable-panel[data-v-540c2ec9] {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: var(--color-background);\n  overflow: hidden;\n}\n",""]);const s=i},9173:(e,t,n)=>{"use strict";n.d(t,{useUIStore:()=>s});var a=n(810),r=n(4061),o=n(9207),i=n(8546);const s=(0,a.nY)("ui",()=>{const e=(0,r.ref)(!1),t=(0,r.ref)(""),n=(0,r.ref)({}),a=(0,r.ref)(!1),s=(0,r.ref)(""),l=(0,r.ref)(!1),c=(0,r.ref)(""),d=(0,r.ref)(""),u=(0,r.ref)(null),m=(0,r.ref)(null),p=(0,r.ref)(!1),g=(0,r.ref)(null),h=(0,r.ref)(!1),f=(0,r.ref)(!1),v=(0,r.ref)(!1),b=(0,r.ref)(""),y=(0,r.ref)(""),x=(0,r.shallowRef)(null),k=(0,r.ref)(null),w=(0,r.ref)(""),E=(0,r.ref)(!1),N=(0,r.ref)([]),S=(0,r.ref)(null),V=(0,r.ref)("creation"),_=(0,r.ref)(!1),C=(0,r.ref)(null),A=(0,r.ref)(null),D=(0,r.ref)(""),T=(0,r.ref)(!0),B=(0,r.ref)(3),I=(0,r.ref)("false"!==localStorage.getItem("enableActionOptions")),z=(0,r.ref)(localStorage.getItem("actionOptionsPrompt")||""),M=(0,r.ref)("false"!==localStorage.getItem("useStreaming")),P=(0,r.ref)("true"===localStorage.getItem("useSystemCot")),R=(0,r.ref)({configured:(0,i.isBackendConfigured)(),connected:!1,lastChecked:0}),$=(0,r.computed)(()=>R.value.configured&&R.value.connected),O=(0,r.computed)(()=>R.value.configured);function L(){p.value=!1,g.value=null,h.value&&(a.value=!0,h.value=!1)}function F(){E.value=!1,N.value=[],S.value=null}return{showToastState:e,toastMessage:t,toastOptions:n,showToast:function(a,r={}){t.value=a,n.value={type:r.type||"info",duration:r.duration||3e3},e.value=!0},hideToast:function(){e.value=!1},isLoading:a,loadingText:s,isAIProcessing:l,streamingContent:c,currentGenerationId:u,streamingTimestamp:m,setStreamingContent:function(e){d.value=e,c.value=(0,o.E)(e)},appendStreamingContent:function(e){d.value+=e,c.value=(0,o.E)(d.value)},clearStreamingContent:function(){c.value="",d.value=""},setCurrentGenerationId:function(e){u.value=e},startStreaming:function(e){u.value=e,c.value="",d.value="",m.value=Date.now(),l.value=!0},stopStreaming:function(){u.value=null,m.value=null,l.value=!1},resetStreamingState:function(){c.value="",d.value="",u.value=null,m.value=null,l.value=!1,sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp")},showRetryDialogState:p,retryDialogConfig:g,startLoading:function(e="正在加载..."){a.value=!0,s.value=e},stopLoading:function(){a.value=!1,s.value=""},setAIProcessing:function(e){l.value=e,e?(sessionStorage.setItem("ai-processing-state","true"),sessionStorage.setItem("ai-processing-timestamp",Date.now().toString())):(sessionStorage.removeItem("ai-processing-state"),sessionStorage.removeItem("ai-processing-timestamp"))},updateLoadingText:function(e){a.value&&(s.value=e)},showRetryDialog:function(e){h.value=a.value,a.value&&(a.value=!1),g.value=e,p.value=!0},hideRetryDialog:L,confirmRetry:function(){g.value&&(g.value.onConfirm(),L())},cancelRetry:function(){g.value&&(g.value.onCancel(),L())},neutralAction:function(){g.value&&g.value.onNeutral&&(g.value.onNeutral(),L())},showCharacterManagement:f,openCharacterManagement:function(){f.value=!0},closeCharacterManagement:function(){f.value=!1},showDataValidationError:E,dataValidationErrorMessages:N,dataValidationContext:V,showDataValidationErrorDialog:function(e,t,n="creation"){N.value=e,S.value=t,V.value=n,E.value=!0},hideDataValidationErrorDialog:F,confirmDataValidationError:function(){S.value&&S.value(),F()},showStateChangeViewer:_,stateChangeLogToShow:C,currentMessageStateChanges:A,openStateChangeViewer:function(e){C.value=e,_.value=!0},closeStateChangeViewer:function(){_.value=!1,C.value=null},setCurrentMessageStateChanges:function(e){A.value=e?{...e,_ts:Date.now()}:null},clearCurrentMessageStateChanges:function(){A.value=null},autoGenerateNpc:T,minNpcCount:B,enableActionOptions:(0,r.computed)({get:()=>I.value,set:e=>{I.value=e,localStorage.setItem("enableActionOptions",String(e))}}),actionOptionsPrompt:(0,r.computed)({get:()=>z.value,set:e=>{z.value=e,localStorage.setItem("actionOptionsPrompt",e)}}),useStreaming:(0,r.computed)({get:()=>M.value,set:e=>{M.value=e,localStorage.setItem("useStreaming",String(e))}}),useSystemCot:(0,r.computed)({get:()=>P.value,set:e=>{P.value=e,localStorage.setItem("useSystemCot",String(e))}}),userInputText:D,backendStatus:R,checkBackendConnection:async()=>{if(!R.value.configured)return R.value.connected=!1,!1;try{const e=await(0,i.d9)();return R.value.connected=!!e,R.value.lastChecked=Date.now(),R.value.connected}catch{return R.value.connected=!1,!1}},isBackendAvailable:$,isBackendConfiguredComputed:O,showDetailModalState:v,detailModalTitle:b,detailModalContent:y,detailModalComponent:x,detailModalProps:k,detailModalClass:w,showDetailModal:function(e){b.value=e.title,y.value=e.content||"",x.value=e.component||null,k.value=e.props||null,w.value=e.className||"",v.value=!0},hideDetailModal:function(){v.value=!1,setTimeout(()=>{b.value="",y.value="",x.value=null,k.value=null,w.value=""},300)}}})},9197:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.save-migration[data-v-230bf738] {\n  display: flex;\n  flex-direction: column;\n  gap: 14px;\n  color: var(--color-text);\n}\n.migration-header h4[data-v-230bf738] {\n  margin: 0 0 6px 0;\n  font-size: 1.05rem;\n}\n.migration-header p[data-v-230bf738] {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-meta[data-v-230bf738] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  gap: 10px;\n}\n.meta-item[data-v-230bf738] {\n  padding: 8px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n.meta-item .label[data-v-230bf738] {\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.meta-item .value[data-v-230bf738] {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: var(--color-text);\n  word-break: break-all;\n}\n.migration-reasons[data-v-230bf738] {\n  border: 1px solid var(--color-border);\n  background: var(--color-background);\n  border-radius: 8px;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.reason-title[data-v-230bf738] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.reason-list[data-v-230bf738] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n.tag[data-v-230bf738] {\n  font-size: 0.75rem;\n  padding: 3px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(var(--color-warning-rgb), 0.35);\n  background: rgba(var(--color-warning-rgb), 0.08);\n  color: var(--color-text);\n}\n.migration-hint[data-v-230bf738] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.migration-hint ul[data-v-230bf738] {\n  margin: 6px 0 0 18px;\n}\n.migration-actions[data-v-230bf738] {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n.migration-actions button[data-v-230bf738] {\n  border: none;\n  border-radius: 8px;\n  padding: 8px 14px;\n  font-size: 0.85rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.migration-actions .primary[data-v-230bf738] {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  color: white;\n}\n.migration-actions .primary[data-v-230bf738]:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.migration-actions .secondary[data-v-230bf738] {\n  background: transparent;\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n",""]);const s=i},9207:(e,t,n)=>{"use strict";n.d(t,{E:()=>u});const a=500,r=50,o=1500;let i=null,s=[];function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(e){return`${!1===e.global?"":"g"}${e.ignoreCase?"i":""}${"regex"===e.mode&&e.multiline?"m":""}${"regex"===e.mode&&e.dotAll?"s":""}`}function d(e){return e.replace(/\$/g,"$$$$")}function u(e){return function(e,t){if(!e)return"";let n=e;n=n.replace(/<(?:ant[-_]?)?thinking>[\s\S]*?<\/(?:ant[-_]?)?thinking>/gi,"").replace(/<\/?(?:ant[-_]?)?thinking>/gi,"").replace(/<analysis>[\s\S]*?<\/analysis>/gi,"").replace(/<\/?analysis>/gi,"").replace(/<reasoning>[\s\S]*?<\/reasoning>/gi,"").replace(/<\/?reasoning>/gi,"").replace(/<thought>[\s\S]*?<\/thought>/gi,"").replace(/<\/?thought>/gi,"");for(const e of t)n=n.replace(e.re,e.replacement);return n}(e,function(){const e=function(){try{if("undefined"==typeof window||"undefined"==typeof localStorage)return{replaceRules:[]};const e=localStorage.getItem("dad_game_settings");if(!e)return{replaceRules:[]};const t=JSON.parse(e);return{replaceRules:Array.isArray(t?.replaceRules)?t.replaceRules:[]}}catch{return{replaceRules:[]}}}(),t=JSON.stringify(e.replaceRules||[]);return t===i||(i=t,s=function(e){const t=[];for(const n of e){if(t.length>=r)break;if(!n||!1===n.enabled)continue;if("string"!=typeof n.pattern||!n.pattern.trim())continue;const e=n.pattern.length>a?n.pattern.slice(0,a):n.pattern,i="string"==typeof n.replacement?n.replacement:"",s="text"===n.mode?d(i.slice(0,o)):i.slice(0,o);try{if("text"===n.mode){const a=`${!1===n.global?"":"g"}${n.ignoreCase?"i":""}`;t.push({re:new RegExp(l(e),a),replacement:s})}else{const a=c(n);t.push({re:new RegExp(e,a),replacement:s})}}catch{}}return t}(e.replaceRules||[])),s}())}},9290:e=>{"use strict";e.exports=RangeError},9333:(e,t,n)=>{"use strict";n.d(t,{Em:()=>c,NX:()=>b,OW:()=>f,Qc:()=>h,Sj:()=>v,Uy:()=>p,verifyStoredToken:()=>d,w2:()=>u,xJ:()=>g,yZ:()=>m});var a=n(4270),r=n(8546);const o=e=>{const t=e.trim();if(!t)return"网络连接失败或后端地址无效，请检查后端服务。";const n=t.toLowerCase();return n.includes("failed to fetch")||n.includes("networkerror")||n.includes("fetch failed")||n.includes("load failed")?"网络连接失败或后端地址无效，请检查后端服务。":n.includes("invalid url")?"后端地址无效，请检查配置后重试。":t},i=e=>{if(null==e)return null;if("string"==typeof e)return e;if("object"!=typeof e)return String(e);const t=e;return"detail"in t?(e=>{if("string"==typeof e)return e;if(null==e)return"服务器返回了未知错误。";if(Array.isArray(e)){const t=e.map(e=>{if(!e||"object"!=typeof e)return String(e);const t=e,n="string"==typeof t.msg?t.msg:void 0,a=Array.isArray(t.loc)?t.loc.filter(e=>"string"==typeof e||"number"==typeof e):void 0,r=a?.length?` (${a.join(".")})`:"";return n?`${n}${r}`:JSON.stringify(t)}).filter(Boolean);return t.length?t.join("；"):"请求参数不合法。"}return"object"==typeof e?JSON.stringify(e):String(e)})(t.detail):"string"==typeof t.message?t.message:JSON.stringify(t)},s=e=>e.includes("/api/v1/auth/token")||e.includes("/api/v1/auth/register")||e.includes("/api/v1/auth/me"),l=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),Promise.resolve().then(n.bind(n,100)).then(({useAPIManagementStore:e})=>{e().clearAll()}),Promise.resolve().then(n.bind(n,4582)).then(({useCharacterStore:e})=>{e().clearLocalCharacterData()}),Promise.resolve().then(n.bind(n,4459)).then(({promptStorage:e})=>{e.resetAll()}),Promise.resolve().then(n.bind(n,1156)).then(({default:e})=>{"/login"!==e.currentRoute.value?.path&&e.push("/login")})};async function c(e,t={}){const n=localStorage.getItem("access_token"),c=new Headers(t.headers||{});let d=!1;n&&c.append("Authorization",`Bearer ${n}`),!t.body||t.body instanceof FormData||c.has("Content-Type")||c.append("Content-Type","application/json");const u={...t,headers:c};try{if(!(0,r.isBackendConfigured)())throw new Error("未配置后端服务器");const t=(0,r.mh)(e);console.log(`[Request] 发起请求: ${u.method||"GET"} ${t}`);const n=await fetch(t,u);if(204===n.status)return console.log(`[Request] 收到 204 No Content 响应 from ${t}`),null;const c=await n.text();if(!n.ok){console.error(`[Request] 请求失败! Status: ${n.status} ${n.statusText} from ${t}`),console.error("[Request] 原始响应体:",c);let r=`服务器错误 ${n.status}`;try{const e=JSON.parse(c);r=i(e)||r}catch(e){r=c.substring(0,100)||"无法解析服务器响应。"}throw r=o(r),401!==n.status||s(e)?(a.o.error(r),d=!0):(r="登录已失效或未登录，请先登录后再试。",a.o.info(r),d=!0,l()),new Error(r)}try{return JSON.parse(c)}catch(e){throw console.error(`[Request] JSON 解析失败 from ${t}. 原始响应体:`,c),new Error("解析服务器响应失败，返回的不是有效的JSON格式。")}}catch(t){console.error(`[Request] 网络层或未知错误 for url: ${e}`,t);const n=o(t instanceof Error?t.message:"网络连接失败或后端地址无效，请检查后端服务。");throw d||a.o.error(n),new Error(n)}}async function d(){const e=localStorage.getItem("access_token");if(!(0,r.isBackendConfigured)())return console.log("[验证密码] 未配置后端，跳过验证"),!1;if(console.log("[验证密码] 从localStorage获取到的token:",e?`${e.substring(0,20)}...`:"null"),!e)return console.log("[验证密码] 未找到密码，直接返回false"),!1;try{console.log("[验证密码] 开始发送验证请求到 /api/v1/auth/me");const e=await c("/api/v1/auth/me",{method:"GET"});if(console.log("[验证密码] 验证成功，用户数据:",e),e&&e.user_name)return localStorage.setItem("username",e.user_name),!0;throw new Error("无效的用户数据")}catch(e){return console.error("[验证密码] 验证失败，错误详情:",e),console.warn("[验证密码] 注意：暂时保留密码，不自动清除"),!1}}async function u(){try{const e=await c.get("/api/v1/worlds/");return console.log("[API] 成功获取世界列表:",e),e||[]}catch(e){return console.error("[API] 获取世界列表失败:",e),a.o.error("获取世界列表失败，请检查网络或联系管理员。"),[]}}async function m(){try{const e=await c.get("/api/v1/talent_tiers/");return console.log("[API] 成功获取天资等级列表:",e),e||[]}catch(e){return console.error("[API] 获取天资等级失败:",e),a.o.error("获取天资等级失败，请检查网络或联系管理员。"),[]}}async function p(){try{const e=await c.get("/api/v1/origins/");return console.log("[API] 成功获取出身列表:",e),e||[]}catch(e){return console.error("[API] 获取出身列表失败:",e),a.o.error("获取出身列表失败，请检查网络或联系管理员。"),[]}}async function g(){try{const e=await c.get("/api/v1/spirit_roots/");return console.log("[API] 成功获取灵根列表:",e),e||[]}catch(e){return console.error("[API] 获取灵根列表失败:",e),a.o.error("获取灵根列表失败，请检查网络或联系管理员。"),[]}}async function h(){try{const e=await c.get("/api/v1/talents/");console.log("[API] 成功获取天赋列表:",e);const t=(e||[]).map(e=>({id:e.id??0,name:e.name??"",description:e.description,talent_cost:e.talent_cost??0,rarity:e.rarity??0,tier_id:e.tier_id??e.tier?.id??null,tier:e.tier,source:e.source,effects:e.effects}));return console.log("[API] 天赋数据转换完成，示例:",t.slice(0,2)),t}catch(e){return console.error("[API] 获取天赋列表失败:",e),a.o.error("获取天赋列表失败，请检查网络或联系管理员。"),[]}}async function f(e){try{console.log("[API] 正在向后端提交角色创建信息:",e);const t=await c.post("/api/v1/characters/create",e);return console.log("[API] 角色创建成功，后端返回:",t),t}catch(e){throw console.error("[API] 角色创建失败:",e),a.o.error("角色创建失败，请检查网络或联系管理员。"),e}}async function v(e,t){try{console.log("[API] 正在向云端同步存档数据:",{charId:e,saveData:t});const n=await c.put(`/api/v1/characters/${e}/save`,t);return console.log("[API] 存档同步成功，后端返回:",n),n}catch(e){throw console.error("[API] 存档同步失败:",e),a.o.error("存档同步失败，请检查网络或联系管理员。"),e}}async function b(e){try{const t=await c.get(`/api/v1/characters/${e}`);return console.log("[API] 成功获取角色详情:",{charId:e}),t}catch(e){throw console.error("[API] 获取角色详情失败:",e),a.o.error("获取更新角色数据失败，请检查网络或联系管理员。"),e}}c.get=(e,t={})=>c(e,{...t,method:"GET"}),c.post=(e,t,n={})=>c(e,{...n,method:"POST",body:void 0!==t?JSON.stringify(t):void 0}),c.put=(e,t,n={})=>c(e,{...n,method:"PUT",body:void 0!==t?JSON.stringify(t):void 0}),c.delete=(e,t={})=>c(e,{...t,method:"DELETE"})},9352:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'/*\n * 超凡新生 - 全局颜色变量映射\n * Global Color Variables Mapping\n * 将所有旧的 --color-* 变量映射到新的科技色系\n */\n\n:root {\n  /* === 科技主色系 === */\n  --tech-primary: #00d9ff;\n  --tech-secondary: #9d00ff;\n  --tech-accent: #00ffaa;\n  --tech-warning: #ff6b00;\n  --tech-danger: #ff0055;\n  --tech-background: #0a0e27;\n  --tech-surface: #0f1535;\n  --tech-border: #1a2a5e;\n\n  /* === 向后兼容：旧颜色变量映射到新科技色系 === */\n  --color-primary: var(--tech-primary);\n  --color-primary-rgb: 0, 217, 255;\n  --color-primary-border: var(--tech-primary);\n  --color-primary-light: rgba(0, 217, 255, 0.1);\n  --color-primary-hover: rgba(0, 217, 255, 0.2);\n  --color-primary-dark: #0099bb;\n\n  --color-secondary: var(--tech-secondary);\n  --color-accent: var(--tech-accent);\n\n  /* === 背景/表面色 === */\n  --color-background: var(--tech-background);\n  --color-surface: var(--tech-surface);\n  --color-surface-light: rgba(15, 21, 53, 0.7);\n  --color-surface-lighter: rgba(15, 21, 53, 0.5);\n  --color-surface-hover: rgba(0, 217, 255, 0.1);\n\n  /* === 边框色 === */\n  --color-border: var(--tech-border);\n  --color-border-hover: var(--tech-primary);\n\n  /* === 文字色 === */\n  --color-text: var(--tech-primary);\n  --color-text-rgb: 0, 217, 255;\n  --color-text-secondary: rgba(0, 217, 255, 0.7);\n  --color-text-muted: rgba(0, 217, 255, 0.4);\n\n  /* === 状态色 === */\n  --color-success: var(--tech-accent);\n  --color-info: var(--tech-primary);\n  --color-warning: var(--tech-warning);\n  --color-error: var(--tech-danger);\n  --color-danger: var(--tech-danger);\n  --color-danger-rgb: 255, 0, 85;\n  --color-danger-hover: rgba(255, 0, 85, 0.2);\n}\n\n/* === 强制覆盖所有使用旧颜色的元素 === */\n\n/* 背景色覆盖 */\n[style*="background: var(--color-surface)"],\n[style*="background: var(--color-background)"],\n[style*="background: var(--color-surface-light)"],\n[style*="background: var(--color-surface-lighter)"],\n[style*="background: var(--color-surface-hover)"] {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.9), rgba(10, 14, 39, 0.9)) !important;\n}\n\n/* 文字色覆盖 */\n[style*="color: var(--color-text)"],\n[style*="color: var(--color-text-secondary)"],\n[style*="color: var(--color-text-muted)"] {\n  color: var(--tech-primary) !important;\n}\n\n[style*="color: var(--color-primary)"],\n[style*="color: var(--color-accent)"],\n[style*="color: var(--color-success)"] {\n  color: var(--tech-primary) !important;\n}\n\n[style*="color: var(--color-error)"],\n[style*="color: var(--color-danger)"] {\n  color: var(--tech-danger) !important;\n}\n\n[style*="color: var(--color-warning)"] {\n  color: var(--tech-warning) !important;\n}\n\n/* 边框色覆盖 */\n[style*="border: 1px solid var(--color-border)"],\n[style*="border-color: var(--color-border)"],\n[style*="border-bottom: 1px solid var(--color-border)"],\n[style*="border-top: 1px solid var(--color-border)"],\n[style*="border-left: 1px solid var(--color-border)"],\n[style*="border-right: 1px solid var(--color-border)"] {\n  border-color: var(--tech-border) !important;\n}\n\n/* === 全局组件样式优化 === */\n\n/* 按钮统一样式 */\nbutton,\n[role="button"],\ninput[type="button"],\ninput[type="submit"],\ninput[type="reset"] {\n  border-radius: 4px;\n  transition: all 0.3s ease;\n  font-weight: 500;\n}\n\nbutton:not(.fab):not([class*="close"]):not([style*="background: transparent"]) {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.08)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n}\n\nbutton:hover:not(:disabled):not(.fab):not([class*="close"]) {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1)) !important;\n  border-color: var(--tech-primary) !important;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3) !important;\n}\n\n/* 输入框统一样式 */\ninput:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="hidden"]),\ntextarea,\nselect {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6)) !important;\n  border: 1px solid var(--tech-border) !important;\n  color: var(--tech-primary) !important;\n  border-radius: 4px !important;\n  padding: 8px 12px !important;\n}\n\ninput::placeholder,\ntextarea::placeholder {\n  color: rgba(0, 217, 255, 0.3) !important;\n}\n\ninput:focus:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="hidden"]),\ntextarea:focus,\nselect:focus {\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(15, 21, 53, 0.8)) !important;\n  border-color: var(--tech-primary) !important;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1) !important;\n  outline: none !important;\n}\n\n/* 卡片/面板统一样式 */\n.card,\n.panel,\n[class*="panel"],\n[class*="card"],\n[class*="modal"],\n[class*="dialog"] {\n  border-radius: 4px;\n}\n\n.card,\n.panel,\n[class*="card"]:not([class*="skill-card"]):not([class*="character-card"]) {\n  background: linear-gradient(135deg, rgba(15, 21, 53, 0.8), rgba(10, 14, 39, 0.8));\n  border: 1px solid var(--tech-border);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.1);\n}\n\n.card:hover,\n.panel:hover,\n[class*="card"]:hover {\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.2);\n}\n\n/* 标签/徽章统一样式 */\n[class*="tag"],\n[class*="badge"],\n[class*="label"] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(157, 0, 255, 0.08));\n  border: 1px solid var(--tech-border);\n  color: var(--tech-primary);\n  border-radius: 3px;\n  padding: 4px 8px;\n}\n\n[class*="tag"]:hover,\n[class*="badge"]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  border-color: var(--tech-primary);\n}\n\n/* === 复选框和单选框 === */\n\ninput[type="checkbox"],\ninput[type="radio"] {\n  appearance: none;\n  -webkit-appearance: none;\n  width: 18px;\n  height: 18px;\n  border: 2px solid var(--tech-border);\n  border-radius: 3px;\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.6), rgba(15, 21, 53, 0.6));\n  cursor: pointer;\n  transition: all 0.3s ease;\n  position: relative;\n}\n\ninput[type="checkbox"]:hover,\ninput[type="radio"]:hover {\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);\n}\n\ninput[type="checkbox"]:checked,\ninput[type="radio"]:checked {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1);\n}\n\ninput[type="radio"] {\n  border-radius: 50%;\n}\n\ninput[type="checkbox"]::after {\n  content: \'\';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 6px;\n  height: 3px;\n  border-bottom: 2px solid var(--tech-primary);\n  border-left: 2px solid var(--tech-primary);\n  transform: translate(-50%, -60%) rotate(-45deg);\n  opacity: 0;\n  transition: opacity 0.2s ease;\n}\n\ninput[type="checkbox"]:checked::after {\n  opacity: 1;\n}\n\ninput[type="radio"]::after {\n  content: \'\';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 6px;\n  height: 6px;\n  background: var(--tech-primary);\n  border-radius: 50%;\n  transform: translate(-50%, -50%);\n  opacity: 0;\n  transition: opacity 0.2s ease;\n}\n\ninput[type="radio"]:checked::after {\n  opacity: 1;\n}\n\n/* === 范围/滑块美化 === */\n\ninput[type="range"] {\n  appearance: none;\n  -webkit-appearance: none;\n  width: 100%;\n  height: 6px;\n  border-radius: 3px;\n  background: linear-gradient(90deg, var(--tech-primary), var(--tech-secondary));\n  outline: none;\n  cursor: pointer;\n}\n\ninput[type="range"]::-webkit-slider-thumb {\n  appearance: none;\n  -webkit-appearance: none;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, var(--tech-primary), var(--tech-secondary));\n  border: 2px solid var(--tech-primary);\n  cursor: pointer;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);\n  transition: all 0.2s ease;\n}\n\ninput[type="range"]::-webkit-slider-thumb:hover {\n  transform: scale(1.2);\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.6);\n}\n\ninput[type="range"]::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, var(--tech-primary), var(--tech-secondary));\n  border: 2px solid var(--tech-primary);\n  cursor: pointer;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);\n  transition: all 0.2s ease;\n}\n\ninput[type="range"]::-moz-range-track {\n  background: transparent;\n  border: none;\n}\n\n/* 滚动条美化 */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(0, 217, 255, 0.05);\n}\n\n::-webkit-scrollbar-thumb {\n  background: linear-gradient(180deg, var(--tech-primary), var(--tech-secondary));\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(180deg, var(--tech-secondary), var(--tech-primary));\n}\n\n/* Firefox 滚动条 */\n* {\n  scrollbar-color: var(--tech-primary) rgba(0, 217, 255, 0.05);\n  scrollbar-width: thin;\n}\n\n/* === 响应式 === */\n\n@media (max-width: 768px) {\n  button,\n  input,\n  textarea,\n  select {\n    padding: 10px 16px !important;\n  }\n\n  .card,\n  [class*="panel"],\n  [class*="modal"] {\n    max-width: 100%;\n  }\n}\n\n@media (max-width: 480px) {\n  button,\n  input,\n  textarea,\n  select {\n    font-size: 16px;\n    padding: 12px 16px !important;\n  }\n\n  .card,\n  [class*="panel"],\n  [class*="modal"] {\n    border-radius: 3px;\n    padding: 12px;\n  }\n}\n',""]);const s=i},9353:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,a=function(e,t){for(var n=[],a=0;a<e.length;a+=1)n[a]=e[a];for(var r=0;r<t.length;r+=1)n[r+e.length]=t[r];return n};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==t.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,i=function(e){for(var t=[],n=1,a=0;n<e.length;n+=1,a+=1)t[a]=e[n];return t}(arguments),s=n(0,r.length-i.length),l=[],c=0;c<s;c++)l[c]="$"+c;if(o=Function("binder","return function ("+function(e){for(var t="",n=0;n<e.length;n+=1)t+=e[n],n+1<e.length&&(t+=",");return t}(l)+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var t=r.apply(this,a(i,arguments));return Object(t)===t?t:this}return r.apply(e,a(i,arguments))}),r.prototype){var d=function(){};d.prototype=r.prototype,o.prototype=new d,d.prototype=null}return o}},9383:e=>{"use strict";e.exports=Error},9433:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,'\n/* 容器 - 绝对定位布局 */\n.mode-selection-container[data-v-2f096032] {\n  width: 100%;\n  height: 100vh;\n  height: 100svh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  box-sizing: border-box;\n  overflow: hidden;\n  position: relative;\n}\n\n/* 左上角：标题 */\n.top-left-section[data-v-2f096032] {\n  position: absolute;\n  top: 2rem;\n  left: 2rem;\n  z-index: 10;\n}\n.main-title[data-v-2f096032] {\n  font-family: var(--font-family-serif);\n  font-size: 7.5rem;\n  font-weight: 400;\n  letter-spacing: 0.5em;\n  color: var(--tech-primary);\n  margin: 0 0 0.5rem 0;\n  text-shadow: 0 0 30px rgba(0, 217, 255, 0.6), 0 0 60px rgba(0, 217, 255, 0.3);\n  animation: neon-glow 3s ease-in-out infinite;\n}\n.sub-title[data-v-2f096032] {\n  font-size: 2rem;\n  color: rgba(0, 217, 255, 0.8);\n  letter-spacing: 0.15em;\n  margin: 0;\n  text-shadow: 0 0 20px rgba(0, 217, 255, 0.4);\n}\n\n/* 左下角：功能按钮、已连接、版本号 */\n.bottom-left-section[data-v-2f096032] {\n  position: absolute;\n  bottom: 2rem;\n  left: 2rem;\n  z-index: 10;\n}\n.left-bottom-content[data-v-2f096032] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.info-group[data-v-2f096032] {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 0.75rem;\n}\n\n/* 版本号 - 科技发光风格 */\n.version-tag[data-v-2f096032] {\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: var(--tech-primary);\n  padding: 0.25rem 0.6rem;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 217, 255, 0.08));\n  border: 1px solid var(--tech-border);\n  border-radius: 6px;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.6);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3), inset 0 0 10px rgba(0, 217, 255, 0.1);\n  transition: all 0.3s ease;\n  display: inline-block;\n  width: fit-content;\n}\n.version-tag[data-v-2f096032]:hover {\n  color: #fff;\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.5), inset 0 0 15px rgba(0, 217, 255, 0.2);\n  text-shadow: 0 0 15px rgba(0, 217, 255, 0.8);\n}\n\n/* 状态指示器 */\n.status-indicator[data-v-2f096032] {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.25rem 0.6rem;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: 1px solid;\n}\n.status-indicator.online[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.08));\n  border-color: rgba(0, 255, 136, 0.4);\n  color: var(--tech-success);\n  box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);\n}\n.status-indicator.offline[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(255, 0, 85, 0.15), rgba(255, 0, 85, 0.08));\n  border-color: rgba(255, 0, 85, 0.4);\n  color: var(--tech-danger);\n  box-shadow: 0 0 15px rgba(255, 0, 85, 0.2);\n}\n.status-dot[data-v-2f096032] {\n  width: 5px;\n  height: 5px;\n  border-radius: 50%;\n  background: currentColor;\n  animation: pulse-2f096032 2s ease-in-out infinite;\n}\n@keyframes pulse-2f096032 {\n0%, 100% { opacity: 1;\n}\n50% { opacity: 0.5;\n}\n}\n\n/* 右下角：模式选择和按钮 */\n.bottom-right-section[data-v-2f096032] {\n  position: absolute;\n  bottom: 2rem;\n  right: 2rem;\n  z-index: 10;\n}\n\n/* 卡片容器 */\n.gate-container[data-v-2f096032] {\n  padding: 0;\n  display: flex;\n  flex-direction: row;\n  gap: 1rem;\n  align-items: center;\n}\n\n/* 卡片 */\n.gate-card[data-v-2f096032] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.75rem 1rem;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08), rgba(157, 0, 255, 0.05));\n  border: 2px solid var(--tech-border);\n  border-radius: 4px;\n  cursor: pointer;\n  position: relative;\n  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n  min-height: 96px;\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.1), inset 0 0 15px rgba(0, 217, 255, 0.05);\n}\n.gate-card[data-v-2f096032]::before {\n  content: \'\';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(90deg, transparent, var(--tech-primary), transparent);\n  opacity: 0.5;\n}\n.gate-card[data-v-2f096032]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(157, 0, 255, 0.1));\n  border-color: var(--tech-primary);\n  transform: translateY(-3px);\n  box-shadow: 0 0 40px rgba(0, 217, 255, 0.3), inset 0 0 20px rgba(0, 217, 255, 0.1);\n}\n.gate-card.selected[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.15));\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 50px rgba(0, 217, 255, 0.4), inset 0 0 25px rgba(0, 217, 255, 0.15);\n}\n.gate-card.disabled[data-v-2f096032] {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.gate-card.disabled[data-v-2f096032]:hover {\n  transform: none;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05), rgba(157, 0, 255, 0.03));\n  border-color: var(--tech-border);\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.08);\n}\n\n/* 卡片图标 */\n.gate-icon[data-v-2f096032] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--tech-primary);\n  flex-shrink: 0;\n  position: relative;\n  width: 48px;\n  height: 48px;\n}\n.icon-bg[data-v-2f096032] {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.1));\n  border: 1px solid rgba(0, 217, 255, 0.3);\n  border-radius: 4px;\n  box-shadow: 0 0 15px rgba(0, 217, 255, 0.2), inset 0 0 10px rgba(0, 217, 255, 0.1);\n}\n.gate-icon svg[data-v-2f096032] {\n  position: relative;\n  z-index: 1;\n}\n.gate-card:hover .gate-icon[data-v-2f096032],\n.gate-card.selected .gate-icon[data-v-2f096032] {\n  color: #fff;\n  text-shadow: 0 0 10px rgba(0, 217, 255, 0.8);\n}\n.gate-card:hover .icon-bg[data-v-2f096032],\n.gate-card.selected .icon-bg[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(157, 0, 255, 0.2));\n  border-color: rgba(0, 217, 255, 0.5);\n  box-shadow: 0 0 25px rgba(0, 217, 255, 0.3), inset 0 0 15px rgba(0, 217, 255, 0.15);\n}\n\n/* 卡片信息 */\n.gate-info[data-v-2f096032] {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 0.35rem;\n}\n.gate-title[data-v-2f096032] {\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  font-weight: 400;\n  margin: 0;\n  color: var(--tech-primary);\n  letter-spacing: 0.1em;\n  text-shadow: 0 0 8px rgba(0, 217, 255, 0.4);\n}\n.gate-tags[data-v-2f096032] {\n  display: flex;\n  gap: 0.4rem;\n}\n.gate-tags span[data-v-2f096032] {\n  font-size: 0.65rem;\n  padding: 0.15rem 0.4rem;\n  border-radius: 4px;\n  font-weight: 500;\n  border: 1px solid;\n}\n\n/* 本地存储 - 橙色科技 */\n.tag-local[data-v-2f096032] {\n  color: var(--tech-warning);\n  background: linear-gradient(135deg, rgba(255, 107, 0, 0.15), rgba(255, 107, 0, 0.08));\n  border-color: rgba(255, 107, 0, 0.4);\n  box-shadow: 0 0 10px rgba(255, 107, 0, 0.2);\n}\n\n/* 隐私保障 - 青色科技 */\n.tag-offline[data-v-2f096032] {\n  color: var(--tech-primary);\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 217, 255, 0.08));\n  border-color: rgba(0, 217, 255, 0.4);\n  box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);\n}\n\n/* 云端同步 - 紫色科技 */\n.tag-cloud[data-v-2f096032] {\n  color: var(--tech-secondary);\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.15), rgba(157, 0, 255, 0.08));\n  border-color: rgba(157, 0, 255, 0.4);\n  box-shadow: 0 0 10px rgba(157, 0, 255, 0.2);\n}\n\n/* 数据安全 - 绿色科技 */\n.tag-secure[data-v-2f096032] {\n  color: var(--tech-success);\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.08));\n  border-color: rgba(0, 255, 136, 0.4);\n  box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);\n}\n\n/* 选中标记 */\n.check-mark[data-v-2f096032] {\n  position: absolute;\n  top: 0.75rem;\n  right: 0.75rem;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));\n  border: 1px solid var(--tech-success);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--tech-success);\n  box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);\n  animation: pulse-2f096032 2s ease-in-out infinite;\n}\n\n/* 禁用遮罩 */\n.disabled-mask[data-v-2f096032] {\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(135deg, rgba(10, 14, 39, 0.85), rgba(10, 14, 39, 0.9));\n  backdrop-filter: blur(4px);\n  border-radius: 4px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 0.4rem;\n  color: rgba(0, 217, 255, 0.5);\n  font-size: 0.8rem;\n}\n\n/* 操作按钮区域 */\n.actions-section[data-v-2f096032] {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 1rem;\n}\n.action-group[data-v-2f096032] {\n  display: flex;\n  gap: 1rem;\n}\n\n/* 按钮基础 */\nbutton[data-v-2f096032] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.6rem;\n  font-family: var(--font-family-serif);\n  font-size: 1rem;\n  letter-spacing: 0.08em;\n  padding: 0.85rem 1.75rem;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  border: 2px solid transparent;\n}\n.btn-primary[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(157, 0, 255, 0.12));\n  color: var(--tech-primary);\n  border-color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);\n}\n.btn-primary[data-v-2f096032]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(157, 0, 255, 0.2));\n  box-shadow: 0 0 30px rgba(0, 217, 255, 0.5);\n  transform: translateY(-1px);\n}\n.btn-secondary[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(157, 0, 255, 0.05));\n  border-color: var(--tech-secondary);\n  color: var(--tech-secondary);\n}\n.btn-secondary[data-v-2f096032]:hover {\n  background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(157, 0, 255, 0.1));\n  box-shadow: 0 0 25px rgba(157, 0, 255, 0.4);\n}\n.btn-ghost[data-v-2f096032] {\n  background: transparent;\n  border-color: var(--tech-border);\n  color: rgba(0, 217, 255, 0.7);\n}\n.btn-ghost[data-v-2f096032]:hover {\n  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08), rgba(157, 0, 255, 0.05));\n  border-color: var(--tech-primary);\n  color: var(--tech-primary);\n  box-shadow: 0 0 20px rgba(0, 217, 255, 0.25);\n}\n\n/* 过渡动画 */\n.fade-up-enter-active[data-v-2f096032],\n.fade-up-leave-active[data-v-2f096032] {\n  transition: all 0.3s ease;\n}\n.fade-up-enter-from[data-v-2f096032],\n.fade-up-leave-to[data-v-2f096032] {\n  opacity: 0;\n  transform: translateY(8px);\n}\n\n/* 亮色主题 */\n[data-theme="light"] .main-title[data-v-2f096032] {\n  color: #1e293b;\n  text-shadow: none;\n}\n[data-theme="light"] .sub-title[data-v-2f096032] {\n  color: #64748b;\n}\n[data-theme="light"] .gate-card[data-v-2f096032] {\n  background: rgba(248, 250, 252, 0.8);\n  border-color: rgba(0, 0, 0, 0.06);\n}\n[data-theme="light"] .gate-card[data-v-2f096032]:hover,\n[data-theme="light"] .gate-card.selected[data-v-2f096032] {\n  background: rgba(239, 246, 255, 0.9);\n}\n[data-theme="light"] .gate-title[data-v-2f096032] {\n  color: #1e293b;\n}\n[data-theme="light"] .gate-icon[data-v-2f096032] {\n  color: #3b82f6;\n}\n[data-theme="light"] .icon-bg[data-v-2f096032] {\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(37, 99, 235, 0.04) 100%);\n  border-color: rgba(59, 130, 246, 0.15);\n}\n[data-theme="light"] .gate-detail[data-v-2f096032] {\n  color: #94a3b8;\n}\n[data-theme="light"] .btn-secondary[data-v-2f096032] {\n  background: rgba(248, 250, 252, 0.9);\n  border-color: rgba(0, 0, 0, 0.08);\n  color: #475569;\n}\n[data-theme="light"] .btn-ghost[data-v-2f096032] {\n  color: #64748b;\n  border-color: rgba(0, 0, 0, 0.08);\n}\n[data-theme="light"] .version-tag[data-v-2f096032] {\n  color: #0891b2;\n  background: linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(56, 189, 248, 0.1) 100%);\n  border-color: rgba(34, 211, 238, 0.35);\n  text-shadow: none;\n  box-shadow: 0 0 8px rgba(34, 211, 238, 0.1);\n}\n\n/* 响应式 */\n@media (max-width: 1024px) {\n.mode-selection-container[data-v-2f096032] {\n    padding: 1.5rem;\n}\n.top-left-section[data-v-2f096032] {\n    top: 1.5rem;\n    left: 1.5rem;\n}\n.bottom-left-section[data-v-2f096032] {\n    bottom: 1.5rem;\n    left: 1.5rem;\n}\n.bottom-right-section[data-v-2f096032] {\n    bottom: 1.5rem;\n    right: 1.5rem;\n    max-width: calc(100% - 3rem);\n}\n.main-title[data-v-2f096032] {\n    font-size: 2.5rem;\n    letter-spacing: 0.4em;\n}\n.sub-title[data-v-2f096032] {\n    font-size: 1rem;\n}\n.gate-container[data-v-2f096032] {\n    flex-direction: column;\n}\n.gate-card[data-v-2f096032] {\n    flex: 1;\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n    padding: 1.5rem 1.5rem;\n    min-height: auto;\n}\n.gate-icon[data-v-2f096032] {\n    width: 60px;\n    height: 60px;\n}\n.gate-info[data-v-2f096032] {\n    width: 100%;\n}\n.gate-detail[data-v-2f096032] {\n    display: none;\n}\n.gate-tags[data-v-2f096032] {\n    justify-content: center;\n    flex-wrap: wrap;\n}\n.actions-section[data-v-2f096032] {\n    justify-content: center;\n    flex-wrap: wrap;\n}\n.action-group[data-v-2f096032] {\n    flex-direction: column;\n    width: 100%;\n}\nbutton[data-v-2f096032] {\n    width: 100%;\n    min-height: 46px;\n}\n}\n@media (max-width: 768px) {\n.mode-selection-container[data-v-2f096032] {\n    padding: 1rem;\n}\n.top-left-section[data-v-2f096032] {\n    top: 1rem;\n    left: 1rem;\n}\n.bottom-left-section[data-v-2f096032] {\n    bottom: 1rem;\n    left: 1rem;\n}\n.bottom-right-section[data-v-2f096032] {\n    bottom: 1rem;\n    right: 1rem;\n    max-width: calc(100% - 2rem);\n}\n.main-title[data-v-2f096032] {\n    font-size: 2rem;\n    letter-spacing: 0.35em;\n}\n.sub-title[data-v-2f096032] {\n    font-size: 0.9rem;\n}\n.gate-title[data-v-2f096032] {\n    font-size: 1.2rem;\n}\n.gate-desc[data-v-2f096032] {\n    font-size: 0.85rem;\n}\n.info-group[data-v-2f096032] {\n    gap: 0.5rem;\n}\nbutton[data-v-2f096032] {\n    padding: 0.75rem 1.5rem;\n    font-size: 0.95rem;\n}\n.version-tag[data-v-2f096032],\n  .status-indicator[data-v-2f096032] {\n    font-size: 0.7rem;\n    padding: 0.2rem 0.5rem;\n}\n}\n@media (max-width: 480px) {\n.mode-selection-container[data-v-2f096032] {\n    padding: 0.75rem;\n}\n.top-left-section[data-v-2f096032] {\n    top: 0.75rem;\n    left: 0.75rem;\n}\n.bottom-left-section[data-v-2f096032] {\n    bottom: 0.75rem;\n    left: 0.75rem;\n}\n.bottom-right-section[data-v-2f096032] {\n    bottom: 0.75rem;\n    right: 0.75rem;\n    max-width: calc(100% - 1.5rem);\n}\n.main-title[data-v-2f096032] {\n    font-size: 1.5rem;\n    letter-spacing: 0.3em;\n}\n.sub-title[data-v-2f096032] {\n    font-size: 0.8rem;\n}\n.gate-card[data-v-2f096032] {\n    padding: 1.25rem 1rem;\n}\n.gate-icon[data-v-2f096032] {\n    width: 50px;\n    height: 50px;\n}\n.gate-title[data-v-2f096032] {\n    font-size: 1.1rem;\n}\n.actions-section[data-v-2f096032] {\n    flex-direction: column;\n    gap: 0.75rem;\n}\nbutton[data-v-2f096032] {\n    padding: 0.65rem 1.25rem;\n    font-size: 0.9rem;\n}\n}\n',""]);const s=i},9531:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.modal-overlay[data-v-3fadd167] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n}\n.modal-container[data-v-3fadd167] {\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n  animation: slideUp-3fadd167 0.3s ease-out;\n}\n@keyframes slideUp-3fadd167 {\nfrom {\n    opacity: 0;\n    transform: translateY(20px);\n}\nto {\n    opacity: 1;\n    transform: translateY(0);\n}\n}\n.modal-header[data-v-3fadd167] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.modal-title[data-v-3fadd167] {\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n  color: var(--color-text);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.modal-close[data-v-3fadd167] {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: all 0.2s ease;\n}\n.modal-close[data-v-3fadd167]:hover {\n  background: rgba(var(--color-primary-rgb), 0.1);\n  color: var(--color-text);\n}\n.modal-content[data-v-3fadd167] {\n  flex: 1;\n  padding: 1.5rem;\n  overflow-y: auto;\n}\n\n/* Upload Area */\n.upload-area[data-v-3fadd167] {\n  border: 2px dashed var(--color-border);\n  border-radius: 12px;\n  padding: 2rem;\n  text-align: center;\n  transition: all 0.3s ease;\n  cursor: pointer;\n  background: var(--color-surface-light);\n}\n.upload-area[data-v-3fadd167]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.upload-area.drag-over[data-v-3fadd167] {\n  border-color: var(--color-primary);\n  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-accent-rgb), 0.1));\n  transform: scale(1.02);\n}\n.file-input[data-v-3fadd167] {\n  display: none;\n}\n.upload-content[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n}\n.upload-icon[data-v-3fadd167] {\n  font-size: 3rem;\n  opacity: 0.6;\n}\n.upload-text[data-v-3fadd167] {\n  margin: 0;\n  color: var(--color-text);\n  font-size: 1rem;\n}\n.btn-select[data-v-3fadd167] {\n  padding: 0.6rem 1.5rem;\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n}\n.btn-select[data-v-3fadd167]:hover {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.upload-hint[data-v-3fadd167] {\n  margin: 0;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  opacity: 0.7;\n}\n\n/* File Info */\n.file-info[data-v-3fadd167] {\n  margin-top: 1rem;\n  padding: 1rem;\n  background: var(--color-surface-lighter);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n}\n.file-header[data-v-3fadd167] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.file-icon[data-v-3fadd167] {\n  font-size: 1.5rem;\n}\n.file-name[data-v-3fadd167] {\n  flex: 1;\n  font-weight: 500;\n  color: var(--color-text);\n  word-break: break-all;\n}\n.file-size[data-v-3fadd167] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.btn-remove[data-v-3fadd167] {\n  background: none;\n  border: none;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 1.2rem;\n  padding: 0.25rem;\n  border-radius: 4px;\n  transition: all 0.2s ease;\n}\n.btn-remove[data-v-3fadd167]:hover {\n  background-color: rgba(var(--color-danger-rgb), 0.1);\n  color: var(--color-danger);\n}\n\n/* Import Options */\n.import-options[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 1.5rem;\n}\n.option-label[data-v-3fadd167] {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  border: 2px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.option-label[data-v-3fadd167]:hover {\n  border-color: var(--color-primary);\n  background: var(--color-surface-lighter);\n}\n.radio-input[data-v-3fadd167] {\n  margin-top: 0.2rem;\n  cursor: pointer;\n}\n.option-text[data-v-3fadd167] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  flex: 1;\n}\n.option-title[data-v-3fadd167] {\n  font-weight: 600;\n  color: var(--color-text);\n}\n.option-desc[data-v-3fadd167] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.option-desc.warning[data-v-3fadd167] {\n  color: var(--color-warning);\n}\n\n/* Import Result */\n.import-result[data-v-3fadd167] {\n  margin-top: 1.5rem;\n  padding: 1rem;\n  border-radius: 8px;\n  display: flex;\n  gap: 0.75rem;\n  align-items: flex-start;\n}\n.import-result.success[data-v-3fadd167] {\n  background: rgba(var(--color-success-rgb), 0.1);\n  border: 1px solid rgba(var(--color-success-rgb), 0.3);\n}\n.import-result.warning[data-v-3fadd167] {\n  background: rgba(var(--color-warning-rgb), 0.1);\n  border: 1px solid rgba(var(--color-warning-rgb), 0.3);\n}\n.import-result.error[data-v-3fadd167] {\n  background: rgba(var(--color-danger-rgb), 0.1);\n  border: 1px solid rgba(var(--color-danger-rgb), 0.3);\n}\n.result-icon[data-v-3fadd167] {\n  font-size: 1.5rem;\n  flex-shrink: 0;\n}\n.result-content[data-v-3fadd167] {\n  flex: 1;\n}\n.result-message[data-v-3fadd167] {\n  margin: 0 0 0.5rem 0;\n  font-weight: 500;\n  color: var(--color-text);\n}\n.result-details[data-v-3fadd167] {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n.detail-item[data-v-3fadd167] {\n  font-size: 0.85rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 12px;\n}\n.detail-item.success[data-v-3fadd167] {\n  background: rgba(var(--color-success-rgb), 0.2);\n  color: var(--color-success);\n}\n.detail-item.error[data-v-3fadd167] {\n  background: rgba(var(--color-danger-rgb), 0.2);\n  color: var(--color-danger);\n}\n.modal-footer[data-v-3fadd167] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  padding: 1.5rem;\n  border-top: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n}\n.btn[data-v-3fadd167] {\n  padding: 0.7rem 1.5rem;\n  border-radius: 6px;\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n.btn-cancel[data-v-3fadd167] {\n  background: var(--color-surface-lighter);\n  color: var(--color-text);\n  border: 1px solid var(--color-border);\n}\n.btn-cancel[data-v-3fadd167]:hover:not(:disabled) {\n  background: rgba(var(--color-text-rgb), 0.05);\n  border-color: var(--color-text-secondary);\n}\n.btn-confirm[data-v-3fadd167] {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  border: none;\n  min-width: 120px;\n}\n.btn-confirm[data-v-3fadd167]:hover:not(:disabled) {\n  box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);\n  transform: translateY(-2px);\n}\n.btn-confirm[data-v-3fadd167]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n/* 移动端适配 */\n@media (max-width: 768px) {\n.modal-container[data-v-3fadd167] {\n    width: 95%;\n    max-width: 100%;\n    border-radius: 8px;\n}\n.modal-header[data-v-3fadd167] {\n    padding: 1rem;\n}\n.modal-title[data-v-3fadd167] {\n    font-size: 1.1rem;\n}\n.modal-content[data-v-3fadd167] {\n    padding: 1rem;\n}\n.upload-area[data-v-3fadd167] {\n    padding: 1.5rem;\n}\n.modal-footer[data-v-3fadd167] {\n    padding: 1rem;\n    flex-direction: column-reverse;\n    gap: 0.75rem;\n}\n.btn[data-v-3fadd167] {\n    width: 100%;\n    padding: 0.8rem 1rem;\n}\n}\n",""]);const s=i},9538:e=>{"use strict";e.exports=ReferenceError},9596:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var a=n(4061);const r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),s=e=>""===e;var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const c=({name:e,iconNode:t,absoluteStrokeWidth:n,"absolute-stroke-width":c,strokeWidth:d,"stroke-width":u,size:m=l.width,color:p=l.stroke,...g},{slots:h})=>(0,a.h)("svg",{...l,...g,width:m,height:m,stroke:p,"stroke-width":s(n)||s(c)||!0===n||!0===c?24*Number(d||u||l["stroke-width"])/Number(m):d||u||l["stroke-width"],class:i("lucide",g.class,...e?[`lucide-${r(o(e))}-icon`,`lucide-${r(e)}`]:["lucide-icon"])},[...t.map(e=>(0,a.h)(...e)),...h.default?[h.default()]:[]]),d=(e,t)=>(n,{slots:r,attrs:o})=>(0,a.h)(c,{...o,...n,iconNode:t,name:e},r)},9612:e=>{"use strict";e.exports=Object},9675:e=>{"use strict";e.exports=TypeError},9715:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.sect-system-panel[data-v-8db46224] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  gap: 8px;\n  background: var(--color-background);\n}\n.sect-tabs[data-v-8db46224] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  padding: 6px 4px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface);\n  border-radius: 8px;\n}\n.sect-tab[data-v-8db46224] {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  background: var(--color-background);\n  border: 1px solid var(--color-border);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.sect-tab[data-v-8db46224]:hover {\n  color: var(--color-text);\n  border-color: rgba(var(--color-primary-rgb), 0.35);\n  background: var(--color-surface);\n}\n.sect-tab.active[data-v-8db46224] {\n  color: var(--color-primary);\n  border-color: rgba(var(--color-primary-rgb), 0.5);\n  background: rgba(var(--color-primary-rgb), 0.08);\n  box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.15);\n}\n.sect-system-content[data-v-8db46224] {\n  flex: 1;\n  min-height: 0;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n@media (max-width: 768px) {\n.sect-tabs[data-v-8db46224] {\n    padding: 6px;\n}\n.sect-tab[data-v-8db46224] {\n    font-size: 0.75rem;\n    padding: 5px 8px;\n}\n}\n",""]);const s=i},9716:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.legacy-modal-overlay[data-v-08dba163] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  backdrop-filter: blur(6px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10050;\n  padding: 1rem;\n}\n.legacy-modal[data-v-08dba163] {\n  width: 100%;\n  max-width: 860px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);\n}\n.legacy-modal-header[data-v-08dba163] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.9rem 1rem;\n  border-bottom: 1px solid var(--color-border);\n}\n.title[data-v-08dba163] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 700;\n}\n.icon-btn[data-v-08dba163] {\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  color: var(--color-text-secondary);\n  padding: 0.25rem;\n  border-radius: 8px;\n}\n.icon-btn[data-v-08dba163]:hover {\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--color-text);\n}\n.legacy-modal-body[data-v-08dba163] {\n  padding: 1rem;\n}\n.hint[data-v-08dba163] {\n  margin: 0 0 0.75rem;\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n  line-height: 1.5;\n}\n.file-row[data-v-08dba163] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.file-name[data-v-08dba163] {\n  font-size: 0.9rem;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.file-name.muted[data-v-08dba163] {\n  color: var(--color-text-secondary);\n}\n.result[data-v-08dba163] {\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 0.9rem;\n  background: rgba(255, 255, 255, 0.02);\n}\n.summary-grid[data-v-08dba163] {\n  display: grid;\n  grid-template-columns: repeat(4, minmax(0, 1fr));\n  gap: 0.6rem;\n  margin-bottom: 0.75rem;\n}\n.kv[data-v-08dba163] {\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  padding: 0.6rem 0.7rem;\n  background: rgba(0, 0, 0, 0.12);\n}\n.k[data-v-08dba163] {\n  display: block;\n  font-size: 0.75rem;\n  color: var(--color-text-secondary);\n}\n.v[data-v-08dba163] {\n  display: block;\n  font-weight: 700;\n  margin-top: 0.15rem;\n}\n.details[data-v-08dba163] {\n  margin-top: 0.6rem;\n}\n.chips[data-v-08dba163] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.35rem;\n  margin-top: 0.5rem;\n}\n.chip[data-v-08dba163] {\n  border: 1px solid var(--color-border);\n  padding: 0.2rem 0.5rem;\n  border-radius: 999px;\n  font-size: 0.8rem;\n}\n.errors[data-v-08dba163] {\n  margin: 0.5rem 0 0;\n  padding-left: 1.1rem;\n  color: #ffb4b4;\n}\n.json-preview[data-v-08dba163] {\n  margin: 0.5rem 0 0;\n  max-height: 220px;\n  overflow: auto;\n  padding: 0.75rem;\n  background: var(--color-code-bg);\n  border: 1px solid var(--color-border);\n  border-radius: 10px;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  font-size: 0.8rem;\n}\n.legacy-modal-actions[data-v-08dba163] {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  padding: 0.9rem 1rem;\n  border-top: 1px solid var(--color-border);\n}\n.btn[data-v-08dba163] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.4rem;\n  padding: 0.55rem 0.8rem;\n  border-radius: 10px;\n  border: 1px solid var(--color-border);\n  background: var(--color-primary);\n  color: #fff;\n  cursor: pointer;\n  font-size: 0.9rem;\n}\n.btn[data-v-08dba163]:disabled {\n  opacity: 0.45;\n  cursor: not-allowed;\n}\n.btn.btn-secondary[data-v-08dba163] {\n  background: transparent;\n  color: var(--color-text);\n}\n.btn.btn-secondary[data-v-08dba163]:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n@media (max-width: 760px) {\n.summary-grid[data-v-08dba163] {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n}\n}\n",""]);const s=i},9852:(e,t,n)=>{"use strict";n.d(t,{J:()=>v,f:()=>r.getTavernHelper});var a=n(2224),r=n(8651),o=n(4270),i=n(1184),s=n(4582),l=n(9173),c=n(8708),d=n(1513),u=n(7203),m=n(3943),p=n(9207),g=n(406),h=n(4530);class f{static instance=null;stateHistory=[];isSummarizing=!1;compareGameTime(e,t){const n=["年","月","日","小时","分钟"];for(const a of n){const n=Number(e?.[a]??0),r=Number(t?.[a]??0);if(n>r)return 1;if(n<r)return-1}return 0}addYears(e,t){return{...e,年:Number(e.年??0)+t}}randomIntInclusive(e,t){const n=Math.ceil(e),a=Math.floor(t);return Math.floor(Math.random()*(a-n+1))+n}normalizeEventConfig(e){const t=!1!==e?.启用随机事件,n=Math.max(1,Number(e?.最小间隔年??1));return{enabled:t,minYears:n,maxYears:Math.max(n,Number(e?.最大间隔年??10)),customPrompt:String(e?.事件提示词??"").trim()}}scheduleNextEventTime(e,t,n){const a=this.randomIntInclusive(t,n);return this.addYears(e,a)}async maybeTriggerScheduledWorldEvent(e){const{v3:t,stateForAI:a,shortTermMemoryForPrompt:r}=e,o=t?.元数据?.时间??null;if(!o)return;const s=t?.社交?.事件??null;if(!s||"object"!=typeof s)return;const{enabled:l,minYears:c,maxYears:d,customPrompt:u}=this.normalizeEventConfig(s.配置);if(!l)return;const m=s.下次事件时间;if(!m){const e=this.scheduleNextEventTime(o,c,d);s.下次事件时间=e,a?.社交?.事件&&(a.社交.事件.下次事件时间=e);const t=(0,i.useGameStateStore)();return void(t.eventSystem&&(t.eventSystem.下次事件时间=e))}if(!(this.compareGameTime(o,m)<0))try{const{generateWorldEvent:e}=await Promise.resolve().then(n.bind(n,4954)),l=await e({saveData:t,now:o,customPrompt:u}),m=this.scheduleNextEventTime(o,c,d);if(!l){s.下次事件时间=m,a?.社交?.事件&&(a.社交.事件.下次事件时间=m);const e=(0,i.useGameStateStore)();return void(e.eventSystem&&(e.eventSystem.下次事件时间=m))}const p={...l.event,发生时间:o,事件来源:l.event.事件来源||"随机"};Array.isArray(s.事件记录)||(s.事件记录=[]),s.事件记录.push(p),s.下次事件时间=m,a?.社交?.事件&&(Array.isArray(a.社交.事件.事件记录)||(a.社交.事件.事件记录=[]),a.社交.事件.事件记录.push(p),a.社交.事件.下次事件时间=m);const g=(0,i.useGameStateStore)();if(g.eventSystem){const e=g.eventSystem;Array.isArray(e.事件记录)||(e.事件记录=[]),e.事件记录.push(p),e.下次事件时间=m}r.push(`【刚刚发生的世界事件】${l.prompt_addition}`)}catch(e){console.warn("[世界事件] 调度/生成失败:",e)}}extractNarrativeText(e){const t=String(e||"").replace(/<(?:ant[-_]?)?thinking>[\s\S]*?<\/(?:ant[-_]?)?thinking>/gi,"").replace(/<\/?(?:ant[-_]?)?thinking>/gi,"").replace(/<reasoning>[\s\S]*?<\/reasoning>/gi,"").replace(/<\/?reasoning>/gi,"").replace(/<thought>[\s\S]*?<\/thought>/gi,"").replace(/<\/?thought>/gi,"").trim();if(!t)return"";if(t.startsWith("{")||t.includes("```"))try{const e=this.parseAIResponse(t);return e?.text?.trim()||""}catch{const e=t.match(/```(?:json)?\s*([\s\S]*?)```/i);if(e?.[1])try{const t=JSON.parse(e[1].trim());return String(t.text||t.叙事文本||t.narrative||"").trim()}catch{return e[1].trim()}}return t}sanitizeActionOptionsForDisplay(e){return Array.isArray(e)?e.filter(e=>"string"==typeof e).map(e=>(0,p.E)(e).trim()).filter(e=>e.length>0):[]}constructor(){}static getInstance(){return this.instance||(this.instance=new f),this.instance}async processPlayerAction(e,t,o){console.log("[AI双向系统] processPlayerAction 接收到的options:",{hasOnStreamChunk:!!o?.onStreamChunk,useStreaming:o?.useStreaming,splitResponseGeneration:o?.splitResponseGeneration});const s=(0,i.useGameStateStore)(),c=(0,r.getTavernHelper)(),m=(0,l.useUIStore)();if(!c){const{aiService:e}=await Promise.resolve().then(n.bind(n,7445)),t=e.checkAvailability();if(!t.available)throw new Error(t.message)}const p=o?.generation_id||`gen_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o?.onProgressUpdate?.("获取存档数据…");const f=s.toSaveData();if(!f){const e=s.onlineState;if("联机"===e?.模式)throw console.error("[AI双向系统-联机模式] 游戏数据不完整，无法进行AI推演"),console.error("[AI双向系统-联机模式] 请确保："),console.error("  1. 已经成功穿越到目标世界"),console.error("  2. 角色数据已正确加载"),console.error("  3. 世界数据已从服务器同步"),new Error("联机模式下游戏数据不完整，无法进行AI推演。请返回主世界或重新穿越。");throw new Error("无法获取存档数据，请确保角色已加载")}o?.onProgressUpdate?.("构建提示词并请求AI生成…");let v={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]};try{const t=(0,h.ru)(f)?f:(0,h.jj)(f).migrated,r=(0,a.cloneDeep)(t);r.社交?.记忆&&(delete r.社交.记忆.短期记忆,delete r.社交.记忆.隐式中期记忆),r.系统?.历史?.叙事&&delete r.系统.历史.叙事;let i="";try{const{vectorMemoryService:a}=await Promise.resolve().then(n.bind(n,5184)),o=r.社交?.记忆?.长期记忆||[];if(a.isEnabled()&&Array.isArray(o)&&o.length>0){const n=await a.getStats();if(0===n.total)console.warn("[向量记忆] 向量库为空：请先在【记忆中心 -> 向量库】一键转化长期记忆");else{const o=[e||"",(t?.社交?.记忆?.短期记忆||[]).slice(-2).join("\n")].filter(Boolean).join("\n"),s={currentLocation:r.角色?.位置?.描述},l=await a.searchMemories(o,s);i=a.formatForAI(l),r.社交.记忆.长期记忆=[],console.log(`[向量记忆] 已注入 ${l.length} 条相关长期记忆（向量库总数：${n.total}）`)}}}catch(e){console.warn("[向量记忆] 检索失败，使用全量模式:",e)}const s=t?.社交?.记忆?.短期记忆||[],l=r.角色?.属性,b=r.角色?.身份,y=e=>e?"string"==typeof e?e:Array.isArray(e)?e.map(e=>"string"==typeof e?e:"object"==typeof e&&null!==e&&(e.name||e.名称)||"").filter(Boolean).join(", ")||"无":"未知格式":"无";let x="# 角色核心状态速览\n";if(l){if(x+=`\n- 生命: 气血${l.气血?.当前}/${l.气血?.上限} 灵气${l.灵气?.当前}/${l.灵气?.上限} 神识${l.神识?.当前}/${l.神识?.上限} 寿元${l.寿命?.当前}/${l.寿命?.上限}`,l.境界){const e=l.境界;x+=`\n- 境界: ${e.名称}-${e.阶段} (${e.当前进度}/${e.下一级所需})`}l.声望&&(x+=`\n- 声望: ${l.声望}`);const e=r.角色?.效果??[];Array.isArray(e)&&e.length>0&&(x+=`\n- 效果: ${e.filter(e=>e&&"object"==typeof e&&e.状态名称).map(e=>e.状态名称).join(", ")}`)}b?.天赋&&(x+=`\n- 天赋: ${y(b.天赋)}`);const k=Math.floor(100*Math.random())+1,w=b?.先天六司||{},E=b?.后天六司||{},N=(w.气运||5)+(E.气运||0),S=1+N/100,V=Math.round(k*S),_=Math.round((V-50)/5),C=r.角色?.位置,A=C?.灵气浓度||50,D={骰子:{原始值:k,气运总和:N,气运系数:S,修正后值:V,最终加成:_},环境:{灵气浓度:A,修炼修正:Math.round((A-50)/10),炼制修正:Math.round((A-50)/15),战斗修正:Math.round((A-50)/20)}};x+=`\n\n# 本回合判定数据（前端已计算）\n**骰子加成**: ${_>=0?"+":""}${_} (原始骰子${k} × 气运系数${S.toFixed(2)} = ${V})\n**环境修正**:\n  - 灵气浓度: ${A}\n  - 修炼/突破: ${D.环境.修炼修正>=0?"+":""}${D.环境.修炼修正}\n  - 炼丹/炼器: ${D.环境.炼制修正>=0?"+":""}${D.环境.炼制修正}\n  - 战斗施法: ${D.环境.战斗修正>=0?"+":""}${D.环境.战斗修正}\n\n⚠️ **重要**：判定时直接使用以上数值，不要自己计算！\n- 骰子加成固定为: ${_>=0?"+":""}${_}\n- 环境修正根据判定类型选择对应的值`;const T=JSON.stringify(r),B=[];m.enableActionOptions&&B.push("actionOptions"),B.push("eventSystem");const I=Array.isArray(s)?[...s]:[];await this.maybeTriggerScheduledWorldEvent({v3:t,stateForAI:r,shortTermMemoryForPrompt:I});const z=`\n${await(0,d.q)(B,m.actionOptionsPrompt)}\n\n${x}\n${i?`\n${i}\n`:""}\n# 游戏状态\n你正在修仙世界《超凡新生》中扮演GM。以下是当前完整游戏存档(JSON格式):\n${T}\n`.trim(),M=e&&e.toString().trim()||"继续当前活动";console.log("[AI双向系统] 用户输入 userMessage:",e),console.log("[AI双向系统] 处理后 userActionForAI:",M);const P=[{content:z,role:"system",depth:4,position:"in_chat"}],R=void 0!==I?I:s;if(R.length>0&&P.push({content:`# 【最近事件】\n${R.join("\n")}。根据这刚刚发生的文本事件，合理生成下一次文本信息，要保证衔接流畅、不断层，符合上文的文本信息`,role:"assistant",depth:2,position:"in_chat"}),m.useSystemCot){const e=await(0,u.XH)("cotCore");P.push({content:e.replace("{{用户输入}}",M),role:"system",depth:1,position:"in_chat"})}const $=r?.系统?.联机?.穿越目标;if($?.离线代理提示词){const e=$.角色信息;let t="# 【离线玩家代理】\n你正在扮演另一位玩家的角色。";e&&(t+="\n该角色信息：",e.name&&(t+=`\n- 名称：${e.name}`),e.cultivation_level&&(t+=`\n- 境界：${e.cultivation_level}`),e.sect&&(t+=`\n- 宗门：${e.sect}`),e.personality&&(t+=`\n- 性格：${e.personality}`)),t+=`\n\n该玩家设定的行为指南：\n${$.离线代理提示词}`,t+="\n\n请根据以上设定来扮演这位离线玩家的角色，与当前玩家互动。",P.push({content:t,role:"system",depth:2,position:"in_chat"})}const O=M;P.push({content:"</input>",role:"assistant",depth:0,position:"in_chat"});const{aiService:L}=await Promise.resolve().then(n.bind(n,7445)),F=L.getConfig(),j=o?.useStreaming??F.streaming??!0,U=(()=>{if("boolean"==typeof o?.splitResponseGeneration)return o.splitResponseGeneration;try{const e=localStorage.getItem("dad_game_settings");if(!e)return!1;const t=JSON.parse(e);return!0===t?.splitResponseGeneration}catch{return!1}})();let q="";if(U){const e=async e=>{const t=(await(0,u.XH)(1===e?"splitGenerationStep1":"splitGenerationStep2")).trim(),n=!!c,[a,r,o,i,s]=await Promise.all([(0,u.XH)("coreOutputRules"),(0,u.XH)("businessRules"),(0,u.XH)("dataDefinitions"),(0,u.XH)("textFormatRules"),(0,u.XH)("worldStandards")]),l=n?o:(0,g.qh)(o),d=[t];if(1===e)return d.push(i,s),`\n${d.join("\n\n---\n\n")}\n\n${x}\n`.trim();if(d.push(a,r,l,i,s),2===e&&m.enableActionOptions){const e=await(0,u.XH)("actionOptions"),t=m.actionOptionsPrompt?`**用户自定义要求**：${m.actionOptionsPrompt}\n\n请严格按以上要求生成行动选项。`:"（无特殊要求，按默认规则生成）";d.push(e.replace("{{CUSTOM_ACTION_PROMPT}}",t))}return 2===e&&d.push(await(0,u.XH)("eventSystemRules")),`\n${d.join("\n\n---\n\n")}\n\n${x}\n\n# 游戏状态（JSON）\n${T}\n`.trim()},t=(e,t=!1)=>{const n=[{content:e,role:"system",depth:4,position:"in_chat"}],a=void 0!==I?I:s;return t&&a.length>0&&n.push({content:`# 【最近事件】\n${a.join("\n")}。根据这刚刚发生的文本事件，合理生成下一次文本信息，要保证衔接流畅、不断层，符合上文的文本信息`,role:"assistant",depth:2,position:"in_chat"}),n.push({content:"</input>",role:"assistant",depth:0,position:"in_chat"}),n},n=async e=>c?await c.generate({user_input:e.user_input,should_stream:e.should_stream,generation_id:e.generation_id,usageType:"main",injects:e.injects}):await L.generate({user_input:e.user_input,should_stream:e.should_stream,generation_id:e.generation_id,usageType:"main",injects:e.injects,onStreamChunk:e.onStreamChunk});o?.onProgressUpdate?.("分步生成：第1步（正文）…");const a=t(await e(1),!0),r=await n({user_input:O,should_stream:j,generation_id:`${p}_step1`,injects:a,onStreamChunk:o?.onStreamChunk}),i=this.extractNarrativeText(String(r));o?.onProgressUpdate?.("分步生成：第2步（记忆/指令/行动选项）…");const l=t(await e(2),!1),d=`\n【用户本次操作】\n${O}\n\n【第1步正文】\n${i}\n\n请按"分步生成（第2步）"规则输出 JSON。\n`.trim();let h;q=await n({user_input:d,should_stream:!1,generation_id:`${p}_step2`,injects:l,onStreamChunk:void 0});try{h=this.parseAIResponse(String(q))}catch{h={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]}}v={text:i,mid_term_memory:h.mid_term_memory||"",tavern_commands:h.tavern_commands||[],action_options:m.enableActionOptions?this.sanitizeActionOptionsForDisplay(h.action_options||[]):[]}}else if(c)q=await c.generate({user_input:O,should_stream:j,generation_id:p,usageType:"main",injects:P});else{const{aiService:e}=await Promise.resolve().then(n.bind(n,7445));q=await e.generate({user_input:O,should_stream:j,generation_id:p,usageType:"main",injects:P,onStreamChunk:o?.onStreamChunk})}if(!U)try{v=this.parseAIResponse(q)}catch(e){console.error("[AI双向系统] 响应解析失败，尝试容错处理:",e);const t=String(q).trim();let n="",a="",r=[],o=[];const i=t.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(i&&i[1])try{const e=JSON.parse(i[1].trim());n=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[],o=e.action_options||[]}catch(e){console.warn("[AI双向系统] JSON代码块解析失败:",e)}if(!n)try{const e=JSON.parse(t);n=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[],o=e.action_options||[]}catch{const e=t.match(/"(?:text|叙事文本|narrative)"\s*:\s*"((?:[^"\\]|\\.)*)"/);if(e&&e[1])n=e[1].replace(/\\n/g,"\n").replace(/\\"/g,'"');else{const e=t.match(/\{[\s\S]*"text"[\s\S]*\}/);if(e)try{const t=JSON.parse(e[0]);n=t.text||"",a=t.mid_term_memory||"",r=t.tavern_commands||[],o=t.action_options||[]}catch{n=t}}}o&&0!==o.length||(console.warn("[AI双向系统] ⚠️ 容错模式：action_options为空，使用默认选项"),o=["继续当前活动","观察周围环境","与附近的人交谈","查看自身状态","稍作休息调整"]),v={text:n,mid_term_memory:a,tavern_commands:r,action_options:this.sanitizeActionOptionsForDisplay(o)},console.warn("[AI双向系统] 使用容错模式提取内容 - 文本长度:",n.length,"记忆:",a.length,"指令数:",r.length,"行动选项:",o.length)}if(!v||!v.text||""===v.text.trim())throw console.error("[AI双向系统] AI响应为空，原始响应:",String(q).substring(0,200)),new Error("AI响应为空或格式错误");j&&o?.onStreamComplete&&o.onStreamComplete()}catch(e){console.error("[AI双向系统] AI生成失败:",e),v={text:"（AI生成失败）",mid_term_memory:"",tavern_commands:[],action_options:["重试当前操作","查看自身状态","稍作休息"]}}o?.onProgressUpdate?.("执行AI指令…");try{const{saveData:e}=await this.processGmResponse(v,f);return o?.onStateChange&&o.onStateChange(e),v}catch(e){return console.error("[AI双向系统] 指令执行失败:",e),v}}async generateInitialMessage(e,t,a){const o=(0,r.getTavernHelper)(),i=(0,l.useUIStore)();if(!o){const{aiService:e}=await Promise.resolve().then(n.bind(n,7445)),t=e.checkAvailability();if(!t.available)throw new Error(t.message)}let s;a?.onProgressUpdate?.("构建提示词并请求AI生成…");try{const{aiService:r}=await Promise.resolve().then(n.bind(n,7445)),l=r.getConfig(),c=a?.useStreaming??l.streaming??!0,d=a?.generateMode||"generate",m=(()=>{if("boolean"==typeof a?.splitResponseGeneration)return a.splitResponseGeneration;try{const e=localStorage.getItem("dad_game_settings");if(!e)return!1;const t=JSON.parse(e);return!0===t?.splitResponseGeneration}catch{return!1}})();let p="";if(m){const n=async t=>`\n${(await(0,u.XH)(1===t?"splitInitStep1":"splitInitStep2")).trim()}\n\n---\n\n# 原始系统提示词（供参考；若与本步目标冲突，以本步规则为准）\n${e}\n          `.trim(),l=async e=>{const t=`initial_message_split_step${e.step}_${Date.now()}`;if(o){if("generateRaw"===d)return String(await o.generateRaw({ordered_prompts:[{role:"system",content:e.system},{role:"user",content:e.user}],should_stream:e.should_stream,generation_id:t,usageType:"main"}));const n=[{content:e.system,role:"user",depth:4,position:"in_chat"}];return await o.generate({user_input:e.user,should_stream:e.should_stream,generation_id:t,usageType:"main",injects:n})}if("generateRaw"===d)return await r.generateRaw({ordered_prompts:[{role:"system",content:e.system},{role:"user",content:e.user}],should_stream:e.should_stream,generation_id:t,usageType:"main",onStreamChunk:e.onStreamChunk});const n=[{content:e.system,role:"user",depth:4,position:"in_chat"}];return await r.generate({user_input:e.user,should_stream:e.should_stream,generation_id:t,usageType:"main",injects:n,onStreamChunk:e.onStreamChunk})};a?.onProgressUpdate?.("分步生成：第1步（开局正文）…");const m=await l({step:1,system:await n(1),user:t,should_stream:c,onStreamChunk:a?.onStreamChunk}),p=this.extractNarrativeText(String(m));c&&a?.onStreamComplete&&a.onStreamComplete(),a?.onProgressUpdate?.("分步生成：第2步（开局记忆/指令/行动选项）…");const g=`\n【开局用户提示】\n${t}\n\n【第1步正文】\n${p}\n\n请按“分步生成（开局-第2步）”规则输出 JSON。\n        `.trim(),h=await l({step:2,system:await n(2),user:g,should_stream:!1,onStreamChunk:void 0});let f;try{f=this.parseAIResponse(String(h))}catch{f={text:"",mid_term_memory:"",tavern_commands:[],action_options:[]}}const v=["四处走动熟悉环境","查看自身状态","与附近的人交谈","寻找修炼之地","打听周围消息"];if(s={text:p,mid_term_memory:f.mid_term_memory||"",tavern_commands:f.tavern_commands||[],action_options:i.enableActionOptions?this.sanitizeActionOptionsForDisplay(f.action_options?.length?f.action_options:v):[]},!s||!s.text)throw new Error("AI响应解析失败或为空");return s}if(o)if("generateRaw"===d)console.log("[AI双向系统] 酒馆模式 - 使用 generateRaw 模式生成初始消息"),p=String(await o.generateRaw({ordered_prompts:[{role:"system",content:e},{role:"user",content:t}],should_stream:c,generation_id:`initial_message_raw_${Date.now()}`,usageType:"main"}));else{console.log("[AI双向系统] 酒馆模式 - 使用 generate 模式生成初始消息");const n=[{content:e,role:"user",depth:4,position:"in_chat"}];p=await o.generate({user_input:t,should_stream:c,generation_id:`initial_message_${Date.now()}`,usageType:"main",injects:n})}else{const{aiService:r}=await Promise.resolve().then(n.bind(n,7445));if("generateRaw"===d)console.log("[AI双向系统] 自定义API模式 - 使用 generateRaw 模式生成初始消息"),p=await r.generateRaw({ordered_prompts:[{role:"system",content:e},{role:"user",content:t}],should_stream:c,generation_id:`initial_message_raw_${Date.now()}`,usageType:"main",onStreamChunk:a?.onStreamChunk});else{console.log("[AI双向系统] 自定义API模式 - 使用 generate 模式生成初始消息");const n=[{content:e,role:"user",depth:4,position:"in_chat"}];p=await r.generate({user_input:t,should_stream:c,generation_id:`initial_message_${Date.now()}`,usageType:"main",injects:n,onStreamChunk:a?.onStreamChunk})}}try{s=this.parseAIResponse(String(p))}catch(e){console.error("[AI双向系统] 初始消息解析失败，尝试容错处理:",e);const t=String(p).trim();let n="",a="",r=[];const o=t.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(o&&o[1])try{const e=JSON.parse(o[1].trim());n=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[]}catch(e){console.warn("[AI双向系统] JSON代码块解析失败:",e)}if(!n)try{const e=JSON.parse(t);n=e.text||e.叙事文本||e.narrative||"",a=e.mid_term_memory||e.中期记忆||"",r=e.tavern_commands||e.指令||[]}catch{const e=t.match(/"(?:text|叙事文本|narrative)"\s*:\s*"((?:[^"\\]|\\.)*)"/);if(e&&e[1])n=e[1].replace(/\\n/g,"\n").replace(/\\"/g,'"');else{const e=t.match(/\{[\s\S]*"text"[\s\S]*\}/);if(e)try{const t=JSON.parse(e[0]);n=t.text||"",a=t.mid_term_memory||"",r=t.tavern_commands||[]}catch{n=t}}}let i=[];try{const e=t.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);e&&e[1]&&(i=JSON.parse(e[1].trim()).action_options||[])}catch{}i&&0!==i.length||(console.warn("[AI双向系统] ⚠️ 初始消息：action_options为空，使用默认选项"),i=["四处走动熟悉环境","查看自身状态","与附近的人交谈","寻找修炼之地","打听周围消息"]),s={text:n,mid_term_memory:a,tavern_commands:r,action_options:this.sanitizeActionOptionsForDisplay(i)},console.warn("[AI双向系统] 使用容错模式提取初始消息 - 文本长度:",n.length,"记忆:",a.length,"指令数:",r.length,"行动选项:",i.length)}if(!s||!s.text)throw new Error("AI响应解析失败或为空");return c&&a?.onStreamComplete&&a.onStreamComplete(),s}catch(e){throw console.error("[AI双向系统] 初始消息生成失败:",e),new Error(`初始消息生成失败: ${e instanceof Error?e.message:"未知错误"}`)}}_getMinutes(e){return e.分钟??0}_formatGameTime(e){if(!e)return"【仙历元年】";const t=this._getMinutes(e);return`【仙道${e.年}年${e.月}月${e.日}日 ${String(e.小时).padStart(2,"0")}:${String(t).padStart(2,"0")}】`}async processGmResponse(e,t,r=!1){const{repairSaveData:o}=await Promise.resolve().then(n.bind(n,6588)),s=o(t),l=(0,a.cloneDeep)(s),d=[];if(l.系统||(l.系统={}),l.系统.历史||(l.系统.历史={叙事:[]}),Array.isArray(l.系统.历史.叙事)||(l.系统.历史.叙事=[]),e.text?.trim()){const t=this._formatGameTime(l.元数据?.时间),n=(0,p.E)(e.text).trim(),r={type:"gm",role:"assistant",content:`${t}${n}`,time:t,actionOptions:this.sanitizeActionOptionsForDisplay(e.action_options||[])};l.系统.历史.叙事.push(r),d.push({key:`系统.历史.叙事[${l.系统.历史.叙事.length-1}]`,action:"push",oldValue:void 0,newValue:(0,a.cloneDeep)(r)}),l.社交||(l.社交={}),l.社交.记忆||(l.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(l.社交.记忆.短期记忆)||(l.社交.记忆.短期记忆=[]),l.社交.记忆.短期记忆.push(`${t}${n}`)}const u=(0,p.E)(e.mid_term_memory||"").trim();if(u){l.社交||(l.社交={}),l.社交.记忆||(l.社交.记忆={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),Array.isArray(l.社交.记忆.隐式中期记忆)||(l.社交.记忆.隐式中期记忆=[]);const e=this._formatGameTime(l.元数据?.时间);l.社交.记忆.隐式中期记忆.push(`${e}${u}`)}let g=10;try{const e=localStorage.getItem("memory-settings");if(e){const t=JSON.parse(e);"number"==typeof t.shortTermLimit&&t.shortTermLimit>0&&(g=t.shortTermLimit)}}catch(e){console.warn("[AI双向系统] 读取记忆配置失败，使用默认值:",e)}for(;l.社交?.记忆?.短期记忆&&l.社交.记忆.短期记忆.length>g;)if(l.社交.记忆.短期记忆.shift(),console.log(`[AI双向系统] 短期记忆超过上限（${g}条），已删除最旧的短期记忆。当前短期记忆数量: ${l.社交.记忆.短期记忆.length}`),l.社交.记忆.隐式中期记忆&&l.社交.记忆.隐式中期记忆.length>0){const e=l.社交.记忆.隐式中期记忆.shift();e&&(Array.isArray(l.社交.记忆.中期记忆)||(l.社交.记忆.中期记忆=[]),l.社交.记忆.中期记忆.push(e),console.log(`[AI双向系统] 已将隐式中期记忆转化为正式中期记忆。当前中期记忆数量: ${l.社交.记忆.中期记忆.length}`))}try{const e=JSON.parse(localStorage.getItem("memory-settings")||"{}").midTermTrigger??25;l.社交?.记忆?.中期记忆&&l.社交.记忆.中期记忆.length>=e&&this.triggerMemorySummary().catch(e=>{console.error("[AI双向系统] 自动记忆总结在后台失败:",e)})}catch(e){console.warn("[AI双向系统] 检查自动总结阈值时出错:",e)}if(!e.tavern_commands?.length)return{saveData:l,stateChanges:{changes:d,timestamp:(new Date).toISOString()}};const h=this._preprocessCommands(e.tavern_commands),{validateCommands:f,cleanCommands:v}=await Promise.resolve().then(n.bind(n,4820)),b=f(h),{validateAndRepairCommandValue:y}=await Promise.resolve().then(n.bind(n,5269)),x=[],k=[];h.forEach((e,t)=>{const n=y(e);n.valid?x.push(e):(console.error(`[AI双向系统] ❌ 拒绝执行指令[${t}]，格式错误:`,n.errors),k.push({command:e,errors:n.errors}))}),k.length>0&&(console.error(`[AI双向系统] 共拒绝 ${k.length} 条格式错误的指令`),k.forEach(({command:e,errors:t})=>{d.unshift({key:"❌ 格式错误（已拒绝）",action:"validation_error",oldValue:void 0,newValue:{command:JSON.stringify(e,null,2),errors:t}})})),b.valid||(console.error("[AI双向系统] 指令格式验证失败:",b.errors),b.errors.forEach(e=>console.error(`  - ${e}`)),b.invalidCommands&&b.invalidCommands.length>0&&b.invalidCommands.forEach(({command:e,errors:t})=>{d.unshift({key:"❌ 错误指令",action:"validation_error",oldValue:void 0,newValue:{command:JSON.stringify(e,null,2),errors:t}})})),b.warnings.length>0&&b.warnings.forEach(e=>console.warn(`[AI双向系统] ${e}`));const w=[...v(x)].sort((e,t)=>{const n="set"===e.action&&e.key.endsWith(".上限"),a="set"===t.action&&t.key.endsWith(".上限");return n&&!a?-1:!n&&a?1:0});console.log(`[AI双向系统] 执行 ${w.length} 条有效指令，拒绝 ${k.length} 条无效指令`);for(const e of w)try{const t=(0,a.get)(l,e.key);this.executeCommand(e,l);const n=(0,a.get)(l,e.key);d.push({key:e.key,action:e.action,oldValue:this._summarizeValue(t),newValue:this._summarizeValue(n)})}catch(t){console.error("[AI双向系统] 指令执行失败:",e,t)}(0,c.F)(l),l.元数据?.时间&&(l.元数据.时间=function(e){let{年:t,月:n,日:a,小时:r,分钟:o}=e;for(o>=60&&(r+=Math.floor(o/60),o%=60),r>=24&&(a+=Math.floor(r/24),r%=24);a>30;)n+=1,a-=30;return n>12&&(t+=Math.floor((n-1)/12),n=(n-1)%12+1),{年:t,月:n,日:a,小时:r,分钟:o}}(l.元数据.时间));const{removedEffects:E}=(0,m.UZ)(l);E.length>0&&console.log(`[AI双向系统] Pinia状态更新前: 移除了 ${E.length} 个过期效果: ${E.join(", ")}`);const N={changes:d,timestamp:(new Date).toISOString()};return l.系统?.历史?.叙事&&l.系统.历史.叙事.length>0&&(l.系统.历史.叙事[l.系统.历史.叙事.length-1].stateChanges=N),r||(0,i.useGameStateStore)().loadFromSaveData(l),{saveData:l,stateChanges:N}}async triggerMemorySummary(e){if(this.isSummarizing)return o.o.warning("已有一个总结任务正在进行中，请稍候..."),void console.log("[AI双向系统] 检测到已有总结任务在运行，本次触发被跳过。");this.isSummarizing=!0,console.log("[AI双向系统] 开始记忆总结流程..."),o.o.loading("正在调用AI总结中期记忆...",{id:"memory-summary"});try{const e=(0,i.useGameStateStore)(),t=(0,s.useCharacterStore)(),a=e.toSaveData();if(!a||!a.社交?.记忆)throw new Error("无法获取存档数据或记忆模块");const l=JSON.parse(localStorage.getItem("memory-settings")||"{}"),c=l.midTermTrigger??25,d=l.midTermKeep??8,m=(l.longTermFormat,a.社交.记忆.中期记忆||[]);if(m.length<c)return console.log(`[AI双向系统] 中期记忆数量(${m.length})未达到触发阈值(${c})，取消总结。`),void o.o.info(`中期记忆未达到触发阈值(${c}条)，已取消总结`,{id:"memory-summary"});const p=c-d;if(p<=0)return console.log("[AI双向系统] 计算出的总结数量 <= 0，配置错误，取消操作。"),void o.o.error("记忆配置错误：触发阈值必须大于保留数量",{id:"memory-summary"});if(m.length<p)return console.log(`[AI双向系统] 中期记忆数量(${m.length})不足以总结${p}条，取消总结。`),void o.o.info(`中期记忆不足${p}条，已取消总结`,{id:"memory-summary"});const g=m.slice(0,p),h=m.slice(p),f=g.map((e,t)=>`${t+1}. ${e}`).join("\n");console.log(`[AI双向系统] 准备总结：从${m.length}条中期记忆中，总结最旧的${p}条，保留最新的${h.length}条`),console.log(`[AI双向系统] 配置：触发阈值=${c}, 保留数量=${d}, 总结数量=${p}`);const v=await(0,u.XH)("memorySummary"),b=v.replace("{{记忆内容}}",f),y=(0,r.getTavernHelper)(),{aiService:x}=await Promise.resolve().then(n.bind(n,7445)),k=x.getConfig(),w=!1!==k.streaming;let E=!0;try{const{useAPIManagementStore:e}=n(100);E="raw"===e().getFunctionMode("memory_summary")}catch{E="raw"===k.memorySummaryMode}if(!y){const e=x.checkAvailability();if(!e.available)throw new Error(e.message)}const N=this._extractEssentialDataForSummary(a),S=JSON.stringify(N,null,2);let V,_;if(console.log(`[AI双向系统] 记忆总结模式: ${E?"Raw模式（纯净总结）":"标准模式（带预设）"}, 传输方式: ${w?"流式":"非流式"}`),y)if(E){const e=await y.generateRaw({ordered_prompts:[{role:"system",content:`【游戏存档数据】（供参考）：\n${S}`},{role:"user",content:b},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]},{role:"assistant",content:"</input>"}],should_stream:w,usageType:"memory_summary"});V=String(e)}else{const e=`${v}\n\n【游戏存档数据】（供参考）：\n${S}`,t=await y.generate({user_input:b,should_stream:w,generation_id:`memory_summary_${Date.now()}`,usageType:"memory_summary",injects:[{content:e,role:"system",depth:4,position:"in_chat"},{content:"</input>",role:"assistant",depth:0,position:"in_chat"}]});V=String(t)}else if(E)console.log("[AI双向系统] 自定义API模式 - Raw模式记忆总结"),V=await x.generateRaw({ordered_prompts:[{role:"system",content:`【游戏存档数据】（供参考）：\n${S}`},{role:"user",content:b},{role:"user",content:["Continue.","Proceed.","Next.","Go on.","Resume."][Math.floor(5*Math.random())]}],should_stream:w,usageType:"memory_summary"});else{console.log("[AI双向系统] 自定义API模式 - 标准模式记忆总结");const e=`${v}\n\n【游戏存档数据】（供参考）：\n${S}`;V=await x.generate({user_input:b,should_stream:w,generation_id:`memory_summary_${Date.now()}`,usageType:"memory_summary",injects:[{content:e,role:"system",depth:4,position:"in_chat"}]})}const C=String(V).trim(),A=C.match(/```(?:json)?\s*\n?([\s\S]*?)\n?```/);if(A?.[1])try{_=JSON.parse(A[1].trim()).text?.trim()||""}catch{_=""}else try{_=JSON.parse(C).text?.trim()||""}catch{_=C.trim()}if(!_||0===_.length)throw new Error("AI返回了空的总结结果");console.log("[AI双向系统] 总结文本长度:",_.length,"预览:",_.substring(0,100));const D=_;e.memory||(e.memory={短期记忆:[],中期记忆:[],长期记忆:[],隐式中期记忆:[]}),e.memory.长期记忆.push(D),e.memory.中期记忆=h;try{const{vectorMemoryService:e}=await Promise.resolve().then(n.bind(n,5184));e.canAutoIndex()&&(await e.addMemory(D,7),console.log("[向量记忆] 新长期记忆已添加到向量库"))}catch(e){console.warn("[向量记忆] 添加到向量库失败:",e)}await t.saveCurrentGame(),console.log(`[AI双向系统] ✅ 总结完成：${p}条中期记忆 -> 1条长期记忆。保留 ${h.length} 条。`),o.o.success(`成功总结 ${p} 条记忆！`,{id:"memory-summary"})}catch(e){const t=e instanceof Error?e.message:"未知错误";console.error("[AI双向系统] 记忆总结失败:",e),o.o.error(`记忆总结失败: ${t}`,{id:"memory-summary"})}finally{this.isSummarizing=!1,console.log("[AI双向系统] 记忆总结流程结束，已释放锁。")}}_preprocessCommands(e){if(!Array.isArray(e))return[];const t=new Set(["背包.物品","物品栏.物品"]);return e.map(e=>{if(!e||"object"!=typeof e)return e;if("push"===e.action&&t.has(e.key)&&"string"==typeof e.value){console.warn(`[AI双向系统] 预处理: 将字符串物品 "${e.value}" 转换为对象。`);const t=e.value;return{...e,value:{物品ID:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,名称:t,类型:"杂物",品质:{quality:"凡品",grade:0},数量:1,描述:`一个普通的${t}。`}}}return("push"===e.action&&t.has(e.key)||"set"===e.action&&"string"==typeof e.key&&Array.from(t).some(t=>e.key.startsWith(t+".")))&&e.value&&"object"==typeof e.value&&"功法"===e.value.类型?{...e,value:this._repairTechniqueItem(e.value)}:e})}_repairTechniqueItem(e){if(!e||"object"!=typeof e)return e;if("功法"!==e.类型)return e;const t={...e},n="string"==typeof t.名称&&t.名称.trim()?t.名称.trim():"未知功法",a="number"==typeof t.修炼进度&&Number.isFinite(t.修炼进度)?t.修炼进度:0;t.修炼进度=a,Array.isArray(t.功法技能)||(t.功法技能=[]),t.功法技能=t.功法技能.filter(e=>e&&"object"==typeof e).map((e,t)=>{const a="string"==typeof e.技能名称&&e.技能名称.trim()?e.技能名称.trim():`${n}·招式${t+1}`,r="string"==typeof e.技能描述?e.技能描述:"",o="number"==typeof e.熟练度要求&&Number.isFinite(e.熟练度要求)?e.熟练度要求:0,i="string"==typeof e.消耗?e.消耗:"";return{...e,技能名称:a,技能描述:r,熟练度要求:o,消耗:i}}),0===t.功法技能.length&&(console.warn(`[AI双向系统] 预处理: 功法 "${n}" 缺少功法技能，已自动补齐基础技能以防报错。`),t.功法技能=[{技能名称:`${n}·运功`,技能描述:`运转${n}的基础法门，凝聚灵气并稳固气机。`,熟练度要求:0,消耗:"灵气10"}]),Array.isArray(t.已解锁技能)||(t.已解锁技能=[]),t.已解锁技能=t.已解锁技能.filter(e=>"string"==typeof e&&e.trim().length>0).map(e=>e.trim());for(const e of t.功法技能)a>=("number"==typeof e.熟练度要求?e.熟练度要求:0)&&"string"==typeof e.技能名称&&!t.已解锁技能.includes(e.技能名称)&&t.已解锁技能.push(e.技能名称);return"boolean"!=typeof t.已装备&&(t.已装备=!1),t}executeCommand(e,t){const{action:n,key:r,value:o}=e;if(!n||!r)throw new Error("指令格式错误：缺少 action 或 key");const i=r.toString(),s=["元数据","角色","社交","世界","系统"];if(!s.some(e=>i===e||i.startsWith(`${e}.`)))throw new Error(`指令key必须以 ${s.join(" / ")} 开头（V3短路径），当前: ${i}`);const l=["角色.效果","社交.任务.当前任务列表","社交.记忆.短期记忆","社交.记忆.中期记忆","社交.记忆.长期记忆","社交.记忆.隐式中期记忆","系统.历史.叙事"].some(e=>i===e||!(!i.startsWith(e+"[")||i.includes(".",e.length)));if("set"===n&&l){if(null==o)return console.warn(`[AI双向系统] 阻止将数组字段 ${i} 设为 null/undefined，改为空数组`),void(0,a.set)(t,i,[]);if(!Array.isArray(o))return void console.warn(`[AI双向系统] 阻止将数组字段 ${i} 设为非数组值，保持原值`)}switch(n){case"set":(0,a.set)(t,i,o);break;case"add":{const e=(0,a.get)(t,i,0);if("number"!=typeof e||"number"!=typeof o)throw new Error(`ADD操作要求数值类型，但得到: ${typeof e}, ${typeof o}`);const n=e+o;i.includes("灵石")&&n<0?(console.warn(`[AI双向系统] ${i} 执行add后会变成负数 (${e} + ${o} = ${n})，已限制为0`),(0,a.set)(t,i,0)):(0,a.set)(t,i,n);break}case"push":{const e=(0,a.get)(t,i,[]);if(!Array.isArray(e))throw new Error(`PUSH操作要求数组类型，但 ${i} 是 ${typeof e}`);let n=o??null;const r=i.startsWith("社交.记忆.")||i.startsWith("记忆.");if("string"==typeof n&&r&&"社交.记忆.隐式中期记忆"!==i&&"记忆.隐式中期记忆"!==i){if(!n.trim())break;n=`${this._formatGameTime(t.元数据?.时间)}${n}`}e.push(n),(0,a.set)(t,i,e);break}case"delete":(0,a.unset)(t,i);break;case"pull":{const e=(0,a.get)(t,i,[]);if(!Array.isArray(e))throw new Error(`PULL操作要求数组类型，但 ${i} 是 ${typeof e}`);if(!o||"object"!=typeof o)throw new Error("PULL操作要求value是对象类型，用于匹配要移除的元素");const n=o,r=e.filter(e=>{if(!e||"object"!=typeof e)return!0;for(const[t,a]of Object.entries(n))if(e[t]!==a)return!0;return!1});(0,a.set)(t,i,r),console.log(`[AI双向系统] PULL操作: 从 ${i} 移除了 ${e.length-r.length} 个元素`);break}default:throw new Error(`未知的操作类型: ${n}`)}}_extractEssentialDataForSummary(e){const t=(0,a.cloneDeep)(e);return t.历史?.叙事&&delete t.历史.叙事,t.记忆&&(delete t.记忆.短期记忆,delete t.记忆.隐式中期记忆),t}_summarizeValue(e){if(null==e)return e;if("object"!=typeof e)return e;if(Array.isArray(e))return e.length<=3?(0,a.cloneDeep)(e):{__type:"Array",__length:e.length,__summary:`[数组: ${e.length}个元素]`,__first:e[0]?this._summarizeValue(e[0]):void 0,__last:e[e.length-1]?this._summarizeValue(e[e.length-1]):void 0};const t=Object.keys(e);if(t.length<=5)return(0,a.cloneDeep)(e);const n={__type:"Object",__keys:t.length,__summary:`[对象: ${t.length}个属性]`};return t.slice(0,3).forEach(t=>{n[t]=this._summarizeValue(e[t])}),n}parseAIResponse(e){if(!e||"string"!=typeof e)throw new Error("AI响应为空或格式错误");const t=e.trim();console.log("[parseAIResponse] 原始响应长度:",t.length),console.log("[parseAIResponse] 原始响应前500字符:",t.substring(0,500));const n=t.replace(/<(?:ant[-_]?)?thinking>[\s\S]*?<\/(?:ant[-_]?)?thinking>/gi,"").replace(/<\/?(?:ant[-_]?)?thinking>/gi,"").replace(/<reasoning>[\s\S]*?<\/reasoning>/gi,"").replace(/<\/?reasoning>/gi,"").replace(/<thought>[\s\S]*?<\/thought>/gi,"").replace(/<\/?thought>/gi,"").trim(),a=e=>{try{return JSON.parse(e)}catch{return null}},r=e=>{const t=(Array.isArray(e.tavern_commands)?e.tavern_commands:Array.isArray(e.指令)?e.指令:Array.isArray(e.commands)?e.commands:[]).map(e=>({action:e.action||"set",key:e.key||"",value:e.value}));let n=Array.isArray(e.action_options)?e.action_options:Array.isArray(e.行动选项)?e.行动选项:[];return n=n.filter(e=>"string"==typeof e&&e.trim().length>0),0===n.length&&(console.warn("[parseAIResponse] ⚠️ action_options为空，使用默认选项"),n=["继续当前活动","观察周围环境","与附近的人交谈","查看自身状态","稍作休息调整"]),{text:String(e.text||e.叙事文本||e.narrative||""),mid_term_memory:String(e.mid_term_memory||e.中期记忆||e.memory||""),tavern_commands:t,action_options:this.sanitizeActionOptionsForDisplay(n)}};let o=a(n);if(o)return r(o);const i=n.match(/```(?:json)?\s*([\s\S]*?)```/i);if(i?.[1]&&(o=a(i[1].trim()),o))return r(o);const s=(e=>{const t=e.indexOf("{");if(-1===t)return null;let n=0,a=!1,r=!1;for(let o=t;o<e.length;o++){const i=e[o];if(r)r=!1;else if("\\"!==i)if('"'!==i){if(!a&&("{"===i&&n++,"}"===i&&(n--,0===n)))return e.substring(t,o+1)}else a=!a;else r=!0}return null})(n);if(s&&(o=a(s),o))return console.log("[parseAIResponse] ✅ 成功提取第一个JSON对象"),r(o);throw new Error("无法解析AI响应：未找到有效的JSON格式")}}const v=f.getInstance()},9957:(e,t,n)=>{"use strict";var a=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=n(6743);e.exports=o.call(a,r)},9971:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),r=n.n(a),o=n(6314),i=n.n(o)()(r());i.push([e.id,"\n.event-panel[data-v-59f5a4ff] {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.event-toolbar[data-v-59f5a4ff] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 10px 12px;\n  border-bottom: 1px solid var(--color-border);\n  flex-shrink: 0;\n}\n.title[data-v-59f5a4ff] {\n  display: flex;\n  align-items: baseline;\n  gap: 8px;\n}\n.title-text[data-v-59f5a4ff] {\n  font-weight: 700;\n  color: var(--color-text);\n}\n.meta[data-v-59f5a4ff] {\n  font-size: 0.85rem;\n  color: var(--color-text-secondary);\n}\n.tool-btn[data-v-59f5a4ff] {\n  padding: 6px 10px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.tool-btn[data-v-59f5a4ff]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n\n/* 配置区域 */\n.config-section[data-v-59f5a4ff] {\n  padding: 12px;\n  border-bottom: 1px solid var(--color-border);\n  background: var(--color-surface-light);\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.config-item[data-v-59f5a4ff] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 8px 10px;\n  border-radius: 8px;\n  background: var(--color-surface);\n  border: 1px solid var(--color-border);\n}\n.config-item-full[data-v-59f5a4ff] {\n  flex-direction: column;\n  align-items: stretch;\n}\n.config-label[data-v-59f5a4ff] {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  flex: 1;\n}\n.label-text[data-v-59f5a4ff] {\n  font-weight: 600;\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.label-hint[data-v-59f5a4ff] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n}\n.config-input[data-v-59f5a4ff] {\n  width: 100px;\n  padding: 6px 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.9rem;\n}\n.config-input[data-v-59f5a4ff]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.config-textarea[data-v-59f5a4ff] {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid var(--color-border);\n  border-radius: 6px;\n  background: var(--color-surface);\n  color: var(--color-text);\n  font-size: 0.9rem;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n  margin-top: 6px;\n}\n.config-textarea[data-v-59f5a4ff]:focus {\n  outline: none;\n  border-color: var(--color-primary);\n}\n.config-textarea[data-v-59f5a4ff]::placeholder {\n  color: var(--color-text-muted);\n}\n\n/* 开关样式 */\n.toggle-switch[data-v-59f5a4ff] {\n  position: relative;\n  display: inline-block;\n  width: 44px;\n  height: 24px;\n  flex-shrink: 0;\n}\n.toggle-switch input[data-v-59f5a4ff] {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n.toggle-slider[data-v-59f5a4ff] {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #cbd5e1;\n  transition: 0.2s;\n  border-radius: 24px;\n}\n.toggle-slider[data-v-59f5a4ff]:before {\n  position: absolute;\n  content: '';\n  height: 18px;\n  width: 18px;\n  left: 3px;\n  bottom: 3px;\n  background-color: white;\n  transition: 0.2s;\n  border-radius: 50%;\n}\ninput:checked + .toggle-slider[data-v-59f5a4ff] {\n  background-color: var(--color-primary);\n}\ninput:checked + .toggle-slider[data-v-59f5a4ff]:before {\n  transform: translateX(20px);\n}\n.config-actions[data-v-59f5a4ff] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  margin-top: 4px;\n}\n.action-btn[data-v-59f5a4ff] {\n  padding: 6px 12px;\n  border-radius: 8px;\n  border: 1px solid var(--color-border);\n  background: var(--color-surface);\n  color: var(--color-text);\n  cursor: pointer;\n  font-size: 0.85rem;\n  transition: all 0.2s ease;\n}\n.action-btn[data-v-59f5a4ff]:hover {\n  background: var(--color-surface-hover);\n  border-color: var(--color-border-hover);\n}\n.event-list[data-v-59f5a4ff] {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n  padding: 12px;\n}\n.empty-state[data-v-59f5a4ff] {\n  padding: 18px;\n  border: 1px dashed var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface);\n}\n.empty-title[data-v-59f5a4ff] {\n  font-weight: 600;\n  margin-bottom: 6px;\n}\n.empty-hint[data-v-59f5a4ff] {\n  color: var(--color-text-secondary);\n  font-size: 0.9rem;\n}\n.event-item[data-v-59f5a4ff] {\n  padding: 12px;\n  border: 1px solid var(--color-border);\n  border-radius: 12px;\n  background: var(--color-surface);\n  margin-bottom: 10px;\n}\n.event-header[data-v-59f5a4ff] {\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  gap: 10px;\n  align-items: baseline;\n  margin-bottom: 8px;\n}\n.event-type[data-v-59f5a4ff] {\n  font-size: 0.78rem;\n  color: var(--color-primary);\n  border: 1px solid rgba(var(--color-primary-rgb), 0.35);\n  padding: 2px 8px;\n  border-radius: 999px;\n  white-space: nowrap;\n}\n.event-name[data-v-59f5a4ff] {\n  font-weight: 700;\n  color: var(--color-text);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.event-time[data-v-59f5a4ff] {\n  font-size: 0.8rem;\n  color: var(--color-text-secondary);\n  white-space: nowrap;\n}\n.event-desc[data-v-59f5a4ff] {\n  color: var(--color-text);\n  line-height: 1.55;\n  white-space: pre-wrap;\n}\n",""]);const s=i}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="./",n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{"use strict";var e=n(4061),t=n(810),a=n(3992);const r=$;var o=n.n(r),i=n(9037),s=n(1412),l=n(7754),c=n(4449),d=n(9596);const u=(0,d.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),m=(0,d.A)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);var p=n(2794),g=n(6494),h=n(4091);const f=(0,d.A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var v=n(4270);const b={class:"toast-container"},y={key:0,class:"toast-icon"},x=["innerHTML"],k=(0,e.defineComponent)({__name:"ToastContainer",setup:t=>(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("div",b,[(0,e.createVNode)(e.TransitionGroup,{name:"toast-fade",tag:"div"},{default:(0,e.withCtx)(()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)((0,e.unref)(v.T),t=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:t.id,class:(0,e.normalizeClass)(["toast",`toast-${t.type}`])},["loading"===t.type?((0,e.openBlock)(),(0,e.createElementBlock)("div",y,n[0]||(n[0]=[(0,e.createElementVNode)("div",{class:"spinner"},null,-1)]))):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",{class:"toast-message",innerHTML:t.message},null,8,x)],2))),128))]),_:1})]))});var w=n(5072),E=n.n(w),N=n(7825),S=n.n(N),V=n(7659),_=n.n(V),C=n(5056),A=n.n(C),D=n(540),T=n.n(D),B=n(1113),I=n.n(B),z=n(40),M={};M.styleTagTransform=I(),M.setAttributes=A(),M.insert=_().bind(null,"head"),M.domAPI=S(),M.insertStyleElement=T(),E()(z.A,M),z.A&&z.A.locals&&z.A.locals;var P=n(6262);const R=(0,P.A)(k,[["__scopeId","data-v-3b7b835b"]]);var O=n(9173);const L={key:0,class:"loading-overlay"},F={class:"loading-content"},j=["innerHTML"],U=(0,e.defineComponent)({__name:"GlobalLoadingOverlay",setup(t){const n=(0,O.useUIStore)();return(t,a)=>((0,e.openBlock)(),(0,e.createBlock)(e.Transition,{name:"fade"},{default:(0,e.withCtx)(()=>[(0,e.unref)(n).isLoading?((0,e.openBlock)(),(0,e.createElementBlock)("div",L,[(0,e.createElementVNode)("div",F,[a[0]||(a[0]=(0,e.createElementVNode)("div",{class:"spinner"},null,-1)),(0,e.createElementVNode)("p",{class:"loading-text",innerHTML:(0,e.unref)(n).loadingText},null,8,j)])])):(0,e.createCommentVNode)("v-if",!0)]),_:1}))}});var q=n(2914),G={};G.styleTagTransform=I(),G.setAttributes=A(),G.insert=_().bind(null,"head"),G.domAPI=S(),G.insertStyleElement=T(),E()(q.A,G),q.A&&q.A.locals&&q.A.locals;const H=(0,P.A)(U,[["__scopeId","data-v-23d51e69"]]);var Y=n(31);const W={class:"dialog-header"},X={class:"dialog-content"},J={class:"error-icon"},K={class:"message"},Z={class:"dialog-actions"},Q=(0,e.defineComponent)({__name:"RetryConfirmDialog",setup(t){const n=(0,O.useUIStore)(),a=(0,e.computed)(()=>n.showRetryDialogState),r=(0,e.computed)(()=>n.retryDialogConfig),o=()=>{n.confirmRetry()},i=()=>{n.cancelRetry()};return(t,n)=>a.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"retry-dialog-overlay",onClick:i},[(0,e.createElementVNode)("div",{class:"retry-dialog",onClick:n[0]||(n[0]=(0,e.withModifiers)(()=>{},["stop"]))},[(0,e.createElementVNode)("div",W,[(0,e.createElementVNode)("h3",null,(0,e.toDisplayString)(r.value?.title||t.$t("AI生成失败")),1)]),(0,e.createElementVNode)("div",X,[(0,e.createElementVNode)("div",J,[(0,e.createVNode)((0,e.unref)(Y.A),{size:48})]),(0,e.createElementVNode)("p",K,(0,e.toDisplayString)(r.value?.message||t.$t("生成过程遇到问题")),1)]),(0,e.createElementVNode)("div",Z,[(0,e.createElementVNode)("button",{class:"btn-secondary",onClick:i},(0,e.toDisplayString)(r.value?.cancelText||t.$t("取消")),1),(0,e.createElementVNode)("button",{class:"btn-primary",onClick:o},(0,e.toDisplayString)(r.value?.confirmText||t.$t("重试")),1)])])])):(0,e.createCommentVNode)("v-if",!0)}});var ee=n(5218),te={};te.styleTagTransform=I(),te.setAttributes=A(),te.insert=_().bind(null,"head"),te.domAPI=S(),te.insertStyleElement=T(),E()(ee.A,te),ee.A&&ee.A.locals&&ee.A.locals;const ne=(0,P.A)(Q,[["__scopeId","data-v-67dbe82b"]]);var ae=n(8684);const re={key:0,class:"dialog-overlay"},oe={class:"dialog-container"},ie={class:"dialog-header"},se={class:"dialog-content"},le={class:"error-list-container"},ce={class:"error-list"},de={class:"content-suggestion"},ue={class:"dialog-actions"},me=(0,e.defineComponent)({__name:"DataValidationErrorDialog",setup(t){const n=(0,O.useUIStore)(),a=()=>{n.confirmDataValidationError()},r=(0,e.computed)(()=>"loading"===n.dataValidationContext?{suggestion:"我们建议您立即修复此问题。修复过程将尝试在保留您核心进度的前提下，修正存档的数据结构。",warning:"注意：修复主要针对结构性问题，无法恢复已损坏或丢失的数据。建议您在修复前备份存档。",buttonText:"修复存档并继续"}:{suggestion:"我们建议您立即修复此问题。修复过程将根据您现有的角色基础信息，重新生成一份健康的初始存档数据。",warning:"注意：这将会重置您的游戏进度（如修为、背包物品等），但角色核心设定（如姓名、天赋、灵根）将保留。",buttonText:"重新初始化并修复"});return(t,o)=>(0,e.unref)(n).showDataValidationError?((0,e.openBlock)(),(0,e.createElementBlock)("div",re,[(0,e.createElementVNode)("div",oe,[(0,e.createElementVNode)("div",ie,[(0,e.createVNode)((0,e.unref)(Y.A),{size:28,class:"header-icon"}),o[0]||(o[0]=(0,e.createElementVNode)("h2",{class:"header-title"},"存档数据异常",-1))]),(0,e.createElementVNode)("div",se,[o[2]||(o[2]=(0,e.createElementVNode)("p",{class:"content-lead"},"系统检测到您的存档文件存在严重结构问题，可能导致游戏无法正常运行。这通常是由于版本更新或数据损坏导致的。",-1)),(0,e.createElementVNode)("div",le,[o[1]||(o[1]=(0,e.createElementVNode)("strong",{class:"error-list-title"},"具体问题如下：",-1)),(0,e.createElementVNode)("ul",ce,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)((0,e.unref)(n).dataValidationErrorMessages,(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("li",{key:n,class:"error-item"},(0,e.toDisplayString)(t),1))),128))])]),(0,e.createElementVNode)("p",de,[(0,e.createTextVNode)((0,e.toDisplayString)(r.value.suggestion)+" ",1),(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(r.value.warning),1)])]),(0,e.createElementVNode)("div",ue,[(0,e.createElementVNode)("button",{class:"action-button confirm-button",onClick:a},[(0,e.createVNode)((0,e.unref)(ae.A),{size:16}),(0,e.createTextVNode)(" "+(0,e.toDisplayString)(r.value.buttonText),1)])])])])):(0,e.createCommentVNode)("v-if",!0)}});var pe=n(8932),ge={};ge.styleTagTransform=I(),ge.setAttributes=A(),ge.insert=_().bind(null,"head"),ge.domAPI=S(),ge.insertStyleElement=T(),E()(pe.A,ge),pe.A&&pe.A.locals&&pe.A.locals;const he=(0,P.A)(me,[["__scopeId","data-v-7a662fc0"]]);var fe=n(2224);function ve(e){return(0,fe.isObject)(e)?e.名称||e.name||"无名物品":"未知物品"}function be(e){return(0,fe.isObject)(e)&&e.数量||1}function ye(e){const{key:t,action:n,oldValue:a,newValue:r}=e;if(t.includes("角色.背包.物品")){if("set"===n&&r&&!a){const e=r;return{icon:"add",color:"green",title:"获得物品",description:`【${ve(e)}】x ${be(e)}`}}if("push"===n){const e=r;return{icon:"add",color:"green",title:"获得物品",description:`【${ve(e)}】x ${be(e)}`}}if("delete"===n||"pull"===n||"set"===n&&!r&&a){const e=a;return{icon:"remove",color:"red",title:"失去物品",description:`【${ve(e)}】x ${be(e)}`}}if("set"===n&&a&&r){const e=be(a),t=be(r);if(e!==t){const n=t-e;return{icon:n>0?"add":"remove",color:n>0?"green":"red",title:n>0?"获得物品":"消耗物品",description:`【${ve(r)}】${n>0?"+":""}${n}`}}}}if(t.startsWith("角色.背包.灵石.")||t.includes(".背包.灵石.")){const e=t.split(".").pop()||"灵石",n=("number"==typeof r?r:0)-("number"==typeof a?a:0);if(n>0)return{icon:"add",color:"green",title:`获得${e}`,description:`+ ${n}`};if(n<0)return{icon:"remove",color:"red",title:`消耗${e}`,description:`${n}`}}return null}function xe(e){const{key:t,action:n,oldValue:a,newValue:r}=e;if(!(t.startsWith("角色.属性.")||t.startsWith("角色.位置.")||t.includes(".角色.属性.")||t.includes(".角色.位置.")||t.includes(".气血")||t.includes(".灵气")||t.includes(".神识")||t.includes(".寿命")))return null;const o=t.split(".").pop()||"属性";if("角色.属性.境界.名称"===t||t.endsWith(".境界.名称"))return{icon:"add",color:"green",title:"境界突破",description:`${a||"凡人"} → ${r}`};if("角色.属性.境界.阶段"===t||t.endsWith(".境界.阶段"))return{icon:"update",color:"blue",title:"境界阶段提升",description:`${a||"无"} → ${r}`};if("角色.位置.描述"===t||t.endsWith(".位置.描述")){const e=e=>{if(!e)return"未知";if("string"==typeof e)return e;if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.描述)return t.描述;if("string"==typeof t.description)return t.description}return String(e)};return{icon:"update",color:"blue",title:"位置变更",description:`${e(a)} → ${e(r)}`}}const i=t.split("."),s=i[i.length-1],l=i[i.length-2]||o;if(("上限"===s||"最大"===s)&&"number"==typeof r){const e="number"==typeof a?r-a:r;let t="";return"number"==typeof a?(t=`${a} -> ${r}`,e>0&&(t+=` (+${e})`)):t=`设为 ${r}`,{icon:"update",color:"blue",title:`${l}上限变化`,description:t}}if("当前"===s&&"number"==typeof r){const e="number"==typeof a?r-a:r;let t="";return"number"==typeof a?(t=`${a} -> ${r}`,e>0&&(t+=` (+${e})`),e<0&&(t+=` (${e})`)):t=`设为 ${r}`,{icon:"update",color:"blue",title:`${l}当前值变化`,description:t}}if((0,fe.isObject)(r)&&"当前"in r&&(0,fe.isObject)(a)&&"当前"in a){const e=r.当前-a.当前,t=r.最大!==a.最大;let n=`${a.当前} -> ${r.当前}`;return e>0&&(n+=` (+${e})`),e<0&&(n+=` (${e})`),t&&(n+=` (上限变为 ${r.最大})`),{icon:"update",color:"blue",title:`${o}变化`,description:n}}if("number"==typeof r&&"number"==typeof a){const e=r-a;let t=`${a} -> ${r}`;return e>0&&(t+=` (+${e})`),e<0&&(t+=` (${e})`),{icon:"update",color:"blue",title:`${o}变化`,description:t}}return null}function ke(e){const{key:t,action:n,oldValue:a,newValue:r}=e;if(t.startsWith("社交.关系.")||t.includes(".社交.关系.")){const e=t.split("."),o=e[2]||"某人",i=e[e.length-1];if("好感度"===i&&"number"==typeof a&&"number"==typeof r){const e=r-a;return{icon:e>0?"add":"remove",color:e>0?"green":"red",title:`【${o}】好感度变化`,description:`${a} → ${r} (${e>0?"+":""}${e})`}}if("人物记忆"===i&&"push"===n)return{icon:"add",color:"blue",title:`【${o}】记忆更新`,description:"新增了关于你的记忆"};if("关系状态"===i)return{icon:"update",color:"blue",title:`【${o}】关系变化`,description:`${a||"初识"} → ${r}`};const s=e.slice(2);if(s.length>0){const e=s.join(".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]");let t=`'${e}' 已更新`;return"object"==typeof r&&null!==r||"object"==typeof a&&null!==a||(t=`'${e}' 从 ${JSON.stringify(a)} 变为 ${JSON.stringify(r)}`),{icon:"update",color:"blue",title:`【${o}】信息更新`,description:t}}}return null}function we(e){const{key:t,action:n,newValue:a}=e;if("validation_error"===n&&("❌ 错误指令"===t||"❌ 格式错误（已拒绝）"===t)){const e=a,t=e?.errors||[];return{icon:"error",color:"red",title:"❌ AI指令格式错误",description:"以下指令验证失败，未被执行",details:[`指令内容:\n${e?.command||"未知指令"}`,"\n错误原因:",...t.map(e=>`  • ${e}`)]}}return null}function Ee(e){const{key:t,action:n,oldValue:a,newValue:r}=e;let o="";return o="set"===n||"update"===n?`值从 ${JSON.stringify(a)} 变为 ${JSON.stringify(r)}`:"add"===n?`数值增加了 ${r}`:"delete"===n?"移除了该字段":`执行了 ${n} 操作`,{icon:"info",color:"gray",title:`数据变更: ${t}`,description:o}}var Ne=n(8381);const Se=(0,d.A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Ve=(0,d.A)("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);var _e=n(6680);const Ce=(0,d.A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var Ae=n(5976);const De={class:"state-change-viewer"},Te={class:"viewer-header"},Be={class:"viewer-summary"},Ie={class:"summary-item added"},ze={class:"summary-item removed"},Me={class:"summary-item updated"},Pe={key:0,class:"summary-item errors"},Re={class:"viewer-content"},$e={key:0,class:"no-changes"},Oe={key:1,class:"changes-list"},Le={class:"item-icon"},Fe={class:"item-content"},je={class:"item-title"},Ue={class:"item-description"},qe={key:0,class:"item-details"},Ge=(0,e.defineComponent)({__name:"StateChangeViewer",props:{log:{}},emits:["close"],setup(t){const n=t,a=(0,e.computed)(()=>function(e){const t={summary:{added:0,removed:0,updated:0,errors:0},changes:[]};if(!e||!(0,fe.isArray)(e.changes))return t;for(const n of e.changes){let e=null;e=we(n),e||(e=ye(n)),e||(e=xe(n)),e||(e=ke(n)),e||(e=Ee(n)),t.changes.push(e),"add"===e.icon?t.summary.added++:"remove"===e.icon?t.summary.removed++:"update"===e.icon?t.summary.updated++:"error"===e.icon&&t.summary.errors++}return t}(n.log));return(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{class:"state-change-overlay",onClick:n[1]||(n[1]=(0,e.withModifiers)(e=>t.$emit("close"),["self"]))},[(0,e.createElementVNode)("div",De,[(0,e.createElementVNode)("div",Te,[(0,e.createElementVNode)("h3",null,[(0,e.createVNode)((0,e.unref)(Ne.A),{size:18}),(0,e.createTextVNode)(" "+(0,e.toDisplayString)(t.$t("变更日志")),1)]),(0,e.createElementVNode)("button",{onClick:n[0]||(n[0]=e=>t.$emit("close")),class:"close-btn"},[(0,e.createVNode)((0,e.unref)(g.A),{size:20})])]),(0,e.createElementVNode)("div",Be,[(0,e.createElementVNode)("div",Ie,[(0,e.createVNode)((0,e.unref)(Se),{size:16}),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.$t("新增"))+" "+(0,e.toDisplayString)(a.value.summary.added),1)]),(0,e.createElementVNode)("div",ze,[(0,e.createVNode)((0,e.unref)(Ve),{size:16}),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.$t("移除"))+" "+(0,e.toDisplayString)(a.value.summary.removed),1)]),(0,e.createElementVNode)("div",Me,[(0,e.createVNode)((0,e.unref)(ae.A),{size:16}),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.$t("更新"))+" "+(0,e.toDisplayString)(a.value.summary.updated),1)]),a.value.summary.errors>0?((0,e.openBlock)(),(0,e.createElementBlock)("div",Pe,[(0,e.createVNode)((0,e.unref)(g.A),{size:16}),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.$t("错误"))+" "+(0,e.toDisplayString)(a.value.summary.errors),1)])):(0,e.createCommentVNode)("v-if",!0)]),(0,e.createElementVNode)("div",Re,[0===a.value.changes.length?((0,e.openBlock)(),(0,e.createElementBlock)("div",$e,[(0,e.createElementVNode)("p",null,(0,e.toDisplayString)(t.$t("本次操作没有产生可见的状态变更。")),1)])):((0,e.openBlock)(),(0,e.createElementBlock)("div",Oe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(a.value.changes,(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:n,class:(0,e.normalizeClass)(["change-item",`item-${t.color}`])},[(0,e.createElementVNode)("div",Le,["add"===t.icon?((0,e.openBlock)(),(0,e.createBlock)((0,e.unref)(_e.A),{key:0,size:18})):"remove"===t.icon?((0,e.openBlock)(),(0,e.createBlock)((0,e.unref)(Ce),{key:1,size:18})):"update"===t.icon?((0,e.openBlock)(),(0,e.createBlock)((0,e.unref)(ae.A),{key:2,size:18})):"error"===t.icon?((0,e.openBlock)(),(0,e.createBlock)((0,e.unref)(g.A),{key:3,size:18})):((0,e.openBlock)(),(0,e.createBlock)((0,e.unref)(Ae.A),{key:4,size:18}))]),(0,e.createElementVNode)("div",Fe,[(0,e.createElementVNode)("p",je,(0,e.toDisplayString)(t.title),1),(0,e.createElementVNode)("p",Ue,(0,e.toDisplayString)(t.description),1),t.details&&t.details.length>0?((0,e.openBlock)(),(0,e.createElementBlock)("div",qe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(t.details,(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("p",{key:n},(0,e.toDisplayString)(t),1))),128))])):(0,e.createCommentVNode)("v-if",!0)])],2))),128))]))])])]))}});var He=n(3353),Ye={};Ye.styleTagTransform=I(),Ye.setAttributes=A(),Ye.insert=_().bind(null,"head"),Ye.domAPI=S(),Ye.insertStyleElement=T(),E()(He.A,Ye),He.A&&He.A.locals&&He.A.locals;const We=(0,P.A)(Ge,[["__scopeId","data-v-a2a95590"]]);var Xe=n(8275);const Je=(0,d.A)("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]]),Ke=["title","aria-label","aria-expanded"],Ze=(0,e.defineComponent)({__name:"ActionMenu",props:{position:{default:"bottom-right"},offsetPx:{default:24},openTitle:{default:"菜单"},closeTitle:{default:"关闭"}},setup(t){const n=t,a=(0,e.ref)(!1),r=()=>{a.value=!1},o=()=>{a.value=!a.value},i=(0,e.computed)(()=>"top-right"===n.position?"pos-top-right":"pos-bottom-right"),s=(0,e.computed)(()=>{const e=`${n.offsetPx}px`;return"top-right"===n.position?{top:e,right:e}:{bottom:e,right:e}});return(t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["action-menu",i.value]),style:(0,e.normalizeStyle)(s.value)},[(0,e.createVNode)(e.Transition,{name:"menu-fade"},{default:(0,e.withCtx)(()=>[a.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"overlay",onClick:r})):(0,e.createCommentVNode)("v-if",!0)]),_:1}),(0,e.createVNode)(e.Transition,{name:"menu-pop"},{default:(0,e.withCtx)(()=>[a.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"menu",onClick:n[0]||(n[0]=(0,e.withModifiers)(()=>{},["stop"]))},[(0,e.renderSlot)(t.$slots,"menu",{close:r})])):(0,e.createCommentVNode)("v-if",!0)]),_:3}),(0,e.createElementVNode)("button",{class:"fab",title:a.value?t.closeTitle:t.openTitle,"aria-label":a.value?t.closeTitle:t.openTitle,"aria-expanded":a.value,onClick:o},[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(a.value?(0,e.unref)(g.A):(0,e.unref)(Je)),{size:22}))],8,Ke)],6))}});var Qe=n(112),et={};et.styleTagTransform=I(),et.setAttributes=A(),et.insert=_().bind(null,"head"),et.domAPI=S(),et.insertStyleElement=T(),E()(Qe.A,et),Qe.A&&Qe.A.locals&&Qe.A.locals;const tt=(0,P.A)(Ze,[["__scopeId","data-v-7abf98f0"]]);var nt=n(6896),at=n(3567),rt=(n(4511),n(1211)),ot=n(4582),it=n(100),st=n(8651),lt=n(4459),ct=n(9333),dt=n(8546);async function ut(){if(!(0,dt.isBackendConfigured)())return;const e=localStorage.getItem("access_token");if(!e)return;const t=(0,dt.mh)("/api/v1/presence/heartbeat");if(t)try{await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:"{}"})}catch{}}var mt=n(1040);const pt={id:"app-container"},gt=["onClick"],ht=["onClick"],ft=["onClick"],vt=["onClick"],bt=["onClick"],yt=["onClick"],xt={class:"settings-modal-content"},kt={class:"settings-modal-header"},wt={class:"settings-modal-body"},Et={class:"settings-modal-content"},Nt={class:"settings-modal-header"},St={class:"settings-modal-body"},Vt={class:"help-modal"},_t={class:"help-header"},Ct={class:"help-body"},At={class:"help-version"},Dt={href:"https://advapute.com/",target:"_blank",class:"help-link-card"},Tt=(0,e.defineComponent)({__name:"App",setup(t){const n=(0,e.ref)(null),r=(0,e.ref)(!1),d=(0,e.ref)("light"!==localStorage.getItem("theme")),b=(0,e.ref)("true"===localStorage.getItem("fullscreen")),y=(0,e.ref)(!1),x=(0,e.ref)(!1),k=(0,e.ref)(!1),w=(0,e.ref)((0,dt.isBackendConfigured)()),E=(0,e.computed)(()=>"true"===localStorage.getItem("is_admin")),N=(0,e.computed)(()=>w.value?n.value??"同步中":""),S=(0,it.useAPIManagementStore)(),V=(0,a.useRouter)(),_=(0,a.useRoute)(),C=(0,e.computed)(()=>_.path.startsWith("/game"));(0,e.watch)(C,e=>{e&&(x.value=!1)});const A=e=>{const t={ModeSelection:"/",CharacterCreation:"/creation",Login:"/login",CharacterManagement:"/management",GameView:"/game"}[e];t?V.push(t):(console.warn(`未知的视图名称: ${e}，将导航至首页。`),V.push("/"))},D=(0,rt.N)(),T=(0,ot.useCharacterStore)(),B=(0,O.useUIStore)(),I=(0,e.ref)(null),z=(0,e.computed)(()=>C.value&&"联机"===T.activeCharacterProfile?.模式),M=()=>{I.value&&(clearInterval(I.value),I.value=null)};(0,e.watch)([z,w],()=>{z.value&&w.value?(M(),w.value&&z.value&&(ut(),I.value=window.setInterval(()=>{ut()},15e3))):M()});const P=async e=>{try{if("cloud"===e&&!w.value)return v.o.info("未配置后端服务器，联机共修不可用"),void A("ModeSelection");const t="cloud"===e?"cloud":"single";D.setMode(t),A("CharacterCreation")}catch(e){console.error("Failed to initialize creation data:",e),v.o.error("初始化创角数据失败，请稍后重试。"),A("ModeSelection")}},$=()=>{V.push("/management")},L=()=>{D.resetCharacter(),A("ModeSelection")},F=()=>{r.value=!0,S.loadFromBackend(),T.loadLocalDataFromBackend(),j(),A("ModeSelection")},j=async()=>{if(w.value&&localStorage.getItem("access_token"))try{const e=await ct.Em.get("/api/v1/user/prompts"),t=e?.prompts||{};await lt.promptStorage.resetAll(),Object.keys(t).length&&await lt.promptStorage.importPrompts(t)}catch(e){console.error("同步用户提示词失败",e)}},U=()=>{w.value?A("Login"):v.o.info("未配置后端服务器，登录不可用")},q=async e=>{if(console.log("接收到创角指令...",e),console.log("[App.vue] 种族字段检查:",e.race),B.isLoading)return void console.warn("[App.vue] 角色创建已在进行中，忽略重复请求");T.initialized||(console.log("[App.vue] characterStore 未初始化，等待初始化完成..."),await T.initializeStore()),B.startLoading("开始铸造法身...");const t=`char_${Date.now()}`,n=async()=>{try{T.rootState.角色列表[t]&&(console.log("[角色创建] 检测到残留数据，清理中..."),delete T.rootState.角色列表[t],await T.commitMetadataToStorage());let n="无名道友";try{const t=(0,st.getTavernHelper)();if(t){const a=await t.getVariables({type:"global"}),r=a["persona.name"]||a.name||e.characterName;n=("string"==typeof r?r:e.characterName)||"无名道友",console.log("[创角完成] 从酒馆Personas获取名字:",n)}}catch(t){console.warn("[创角完成] 无法从酒馆获取Persona名字，使用用户输入:",t),n=e.characterName||"无名道友"}const a=e.baseAttributes?{根骨:e.baseAttributes.root_bone??0,灵性:e.baseAttributes.spirituality??0,悟性:e.baseAttributes.comprehension??0,气运:e.baseAttributes.fortune??0,魅力:e.baseAttributes.charm??0,心性:e.baseAttributes.temperament??0}:{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0},r={名字:n,性别:"女"===e.gender||"其他"===e.gender?e.gender:"男",出生日期:{年:0,月:1,日:1},种族:e.race??"人族",世界:e.world||{name:"未知世界"},天资:e.talentTier||{name:"凡品"},出生:e.origin||"随机出身",灵根:e.spiritRoot||"随机灵根",天赋:e.talents?.map(e=>({id:e.id,name:e.name,description:e.description||"",talent_cost:e.talent_cost,rarity:e.rarity}))||[],先天六司:a,后天六司:{根骨:0,灵性:0,悟性:0,气运:0,魅力:0,心性:0}},o={charId:t,baseInfo:r,world:e.world,mode:e.mode,age:e.age},i=await T.createNewCharacter(o);if(!i)throw new Error("角色创建失败，请检查 characterStore 的日志。");const s=T.rootState.角色列表[t];if(!s)throw new Error("严重错误：角色创建后无法在角色列表中找到！");const l="单机"===s.模式?"存档1":"存档";return T.rootState.当前激活存档={角色ID:t,存档槽位:l},await T.commitMetadataToStorage(),await new Promise(e=>setTimeout(e,500)),v.o.success(`【${i.名字}】已成功踏入修行之路！`),await V.push("/game"),await new Promise(e=>setTimeout(e,100)),G(),!0}catch(e){console.error("角色创建过程出错：",e);const a=e instanceof Error?e.message:"法身铸造过程中出现意外";return T.rootState.角色列表[t]&&(console.log("[角色创建] 创建失败，清理残留数据..."),delete T.rootState.角色列表[t],await T.commitMetadataToStorage()),a.includes("用户选择终止角色创建")||a.includes("用户选择不继续重试")?(console.log("[角色创建] 用户主动取消创建流程"),v.o.info("角色创建已取消"),!1):new Promise(e=>{B.showRetryDialog({title:"角色创建失败",message:`角色创建过程中遇到问题：\n\n${a}\n\n是否重新尝试创建角色？`,confirmText:"重新创建",cancelText:"返回主页重新开始",onConfirm:async()=>{console.log("[角色创建] 用户选择重新创建"),e(await n())},onCancel:()=>{console.log("[角色创建] 用户选择返回主页重新开始"),v.o.info("已返回主页，可重新开始生成"),D.resetCharacter(),V.push("/"),e(!1)}})})}};try{console.log("[App.vue] 开始执行attemptCreation...");const e=await n();console.log("[App.vue] attemptCreation执行完成,结果:",e),e||console.log("[角色创建] 保持在角色创建页面")}catch(e){console.error("[App.vue] 角色创建流程出现严重错误：",e);const t=e instanceof Error?e.message:String(e);v.o.error(`角色创建失败: ${t}`),t.includes("超时")&&v.o.error("创建过程超时,请检查网络连接和SillyTavern状态")}finally{console.log("[App.vue] finally: 停止loading"),B.stopLoading()}};(0,e.watchEffect)(()=>{const e=d.value?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)});const G=()=>{b.value&&!(0,mt.Kn)()&&(console.log("[全屏] 检测到需要恢复全屏状态"),console.warn("[全屏] 浏览器限制：无法自动恢复全屏，请手动点击全屏按钮。"),b.value=!1,localStorage.setItem("fullscreen","false"))},Y=()=>{y.value=!0};return(0,e.onMounted)(async()=>{if(w.value){const e=await(0,dt.d9)();e&&(n.value=e)}console.log("[App] 等待 characterStore 初始化..."),await T.initializeStore(),console.log("[App] ✅ characterStore 初始化完成");let t=null;const a=()=>{try{if(window.parent===window)return;document.documentElement.classList.add("is-iframe");let e=window;for(let n=0;n<5;n++)try{if(!e.parent||e.parent===e)break;{const a=o()("#chat",e.parent.document);if(a.length>0){const r=a.height();if(r){const a=.9*r+"px";return document.documentElement.style.minHeight=a,console.log(`[App.vue] 在第${n+1}层父窗口找到#chat，应用min-height: ${a}`),void(t=e.parent)}}e=e.parent}}catch{break}console.warn("[App.vue] 在所有可访问的父窗口中未找到 #chat 元素，无法自动调整高度。")}catch(e){console.error("[App.vue] 访问父窗口DOM失败，可能是跨域限制。",e)}};a();try{t?o()(t).on("resize",a):window.parent!==window&&o()(parent.window).on("resize",a)}catch{}const r=()=>{const e=!!(0,mt.Kn)();b.value=e,localStorage.setItem("fullscreen",e.toString())};document.addEventListener("fullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("MSFullscreenChange",r),r(),setTimeout(()=>{G()},500);const i=setInterval(async()=>{try{const e=T.activeSaveSlot;e?.存档数据&&(console.log("[定时保存] 保存当前存档..."),await T.saveCurrentGame(),console.log("[定时保存] 保存成功"))}catch(e){console.error("[定时保存] 保存失败:",e)}},3e5);(0,e.onUnmounted)(()=>{M(),clearInterval(i);try{t?o()(t).off("resize",a):window.parent!==window&&o()(parent.window).off("resize",a)}catch{}document.removeEventListener("fullscreenchange",r),document.removeEventListener("webkitfullscreenchange",r),document.removeEventListener("mozfullscreenchange",r),document.removeEventListener("MSFullscreenChange",r)})}),(0,e.watch)(_,(e,t)=>{e.path!==t?.path&&(console.log(`[全屏] 路由从 ${t?.path} 切换到 ${e.path}`),setTimeout(()=>{G()},200))},{immediate:!1}),(t,n)=>{const a=(0,e.resolveComponent)("router-view");return(0,e.openBlock)(),(0,e.createElementBlock)("div",pt,[(0,e.createVNode)(R),(0,e.createVNode)(H),(0,e.createVNode)(ne),(0,e.createVNode)(he),(0,e.unref)(B).showStateChangeViewer?((0,e.openBlock)(),(0,e.createBlock)(We,{key:0,log:(0,e.unref)(B).stateChangeLogToShow,onClose:(0,e.unref)(B).closeStateChangeViewer},null,8,["log","onClose"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(Xe.A),(0,e.createCommentVNode)(" 全局操作按钮 - 只在非游戏界面显示 "),(0,e.createCommentVNode)('\n    <div v-if="!isInGameView" class="global-actions">\n      <label class="theme-toggle" @click.prevent="toggleTheme">\n        <input type="checkbox" ref="globalThemeCheckbox" :checked="!isDarkMode" />\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="moon">\n          <path\n            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"\n          ></path>\n        </svg>\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="sun">\n          <path\n            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"\n          ></path>\n        </svg>\n      </label>\n      <label class="fullscreen-toggle" @click.prevent="toggleFullscreen">\n        <input type="checkbox" ref="globalFullscreenCheckbox" />\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="expand">\n          <path\n            d="M32 32C14.3 32 0 46.3 0 64v96c0 17.7 14.3 32 32 32s32-14.3 32-32V96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V352zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h64v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H320zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V352z"\n          ></path>\n        </svg>\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="compress">\n          <path\n            d="M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V64zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32H96v64c0 17.7 14.3 32 32 32s32-14.3 32-32V352c0-17.7-14.3-32-32-32H32zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V64zM320 320c-17.7 0-32 14.3-32 32v96c0 17.7 14.3 32 32 32s32-14.3 32-32V384h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H320z"\n          ></path>\n        </svg>\n      </label>\n      <a\n        href="https://ddct.top"\n        target="_blank"\n        rel="noopener noreferrer"\n        class="theme-toggle"\n        title="教程"\n      >\n        <HelpCircle :size="24" />\n      </a>\n    </div>\n    '),(0,e.createCommentVNode)(" 全局操作按钮（合并菜单） - 只在非游戏界面显示 "),C.value?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createBlock)(tt,{key:1,position:"top-right",openTitle:"功能",closeTitle:"关闭"},{menu:(0,e.withCtx)(({close:t})=>[(0,e.createElementVNode)("button",{class:"action-menu-item",onClick:e=>{x.value=!0,t()}},[(0,e.createVNode)((0,e.unref)(i.A),{size:18}),n[6]||(n[6]=(0,e.createElementVNode)("span",null,"设置",-1))],8,gt),(0,e.createElementVNode)("button",{class:"action-menu-item",onClick:e=>(e=>{if(!localStorage.getItem("access_token"))return v.o.info("请先登录"),void e();k.value=!0,S.loadFromBackend(),e()})(t)},[(0,e.createVNode)((0,e.unref)(s.A),{size:18}),n[7]||(n[7]=(0,e.createElementVNode)("span",null,"API配置",-1))],8,ht),(0,e.createElementVNode)("button",{class:(0,e.normalizeClass)(["action-menu-item",{"is-disabled":!w.value}]),onClick:e=>(e=>{w.value?(V.push("/account"),e()):v.o.info("未配置后端服务器，账号中心不可用")})(t)},[(0,e.createVNode)((0,e.unref)(l.A),{size:18}),n[8]||(n[8]=(0,e.createElementVNode)("span",null,"我的账号",-1))],10,ft),E.value?((0,e.openBlock)(),(0,e.createElementBlock)("button",{key:0,class:(0,e.normalizeClass)(["action-menu-item",{"is-disabled":!w.value}]),onClick:e=>(e=>{w.value?"true"===localStorage.getItem("is_admin")?(V.push("/backend-admin"),e()):v.o.error("需要管理员权限才能访问后端管理"):v.o.info("未配置后端服务器，后端管理不可用")})(t)},[(0,e.createVNode)((0,e.unref)(c.A),{size:18}),n[9]||(n[9]=(0,e.createElementVNode)("span",null,"后端管理",-1))],10,vt)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("button",{class:"action-menu-item",onClick:e=>{(0,mt.Kn)()?(0,mt.Eh)().then(()=>{b.value=!1,localStorage.setItem("fullscreen","false"),console.log("[全屏] 已退出全屏模式并保存状态")}).catch(e=>{console.error("无法退出全屏模式:",e),v.o.error((0,mt.zp)(e))}):(0,mt.lh)(document.documentElement).then(()=>{b.value=!0,localStorage.setItem("fullscreen","true"),console.log("[全屏] 已进入全屏模式并保存状态")}).catch(e=>{console.error("无法进入全屏模式:",e),v.o.error((0,mt.zp)(e))}),t()}},[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(b.value?(0,e.unref)(u):(0,e.unref)(m)),{size:18})),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(b.value?"退出全屏":"进入全屏"),1)],8,bt),(0,e.createElementVNode)("button",{class:"action-menu-item",onClick:e=>{Y(),t()}},[(0,e.createVNode)((0,e.unref)(p.A),{size:18}),n[10]||(n[10]=(0,e.createElementVNode)("span",null,"关于",-1))],8,yt)]),_:1})),(0,e.createCommentVNode)(" 路由视图将在这里渲染所有页面 "),(0,e.createVNode)(a,null,{default:(0,e.withCtx)(({Component:t})=>[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(t),{onStartCreation:P,onShowCharacterList:$,onGoToLogin:U,onBack:L,onCreationComplete:q,onLoggedIn:F,onLogin:U,onShowHelp:Y},null,32))]),_:1}),(0,e.createCommentVNode)(" Settings Modal "),x.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:2,class:"settings-modal-overlay",onClick:n[1]||(n[1]=(0,e.withModifiers)(e=>x.value=!1,["self"]))},[(0,e.createElementVNode)("div",xt,[(0,e.createElementVNode)("div",kt,[n[11]||(n[11]=(0,e.createElementVNode)("h3",null,"设置",-1)),(0,e.createElementVNode)("button",{class:"close-btn",onClick:n[0]||(n[0]=e=>x.value=!1)},"×")]),(0,e.createElementVNode)("div",wt,[(0,e.createVNode)(nt.A)])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createCommentVNode)(" API管理弹窗 "),k.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:3,class:"settings-modal-overlay",onClick:n[3]||(n[3]=(0,e.withModifiers)(e=>k.value=!1,["self"]))},[(0,e.createElementVNode)("div",Et,[(0,e.createElementVNode)("div",Nt,[n[12]||(n[12]=(0,e.createElementVNode)("h3",null,"API管理",-1)),(0,e.createElementVNode)("button",{class:"close-btn",onClick:n[2]||(n[2]=e=>k.value=!1)},"×")]),(0,e.createElementVNode)("div",St,[(0,e.createVNode)(at.A)])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createCommentVNode)(" 教程弹窗 "),y.value?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:4,class:"help-overlay",onClick:n[5]||(n[5]=(0,e.withModifiers)(e=>y.value=!1,["self"]))},[(0,e.createElementVNode)("div",Vt,[(0,e.createElementVNode)("div",_t,[n[13]||(n[13]=(0,e.createElementVNode)("h2",{class:"help-title"},"关于",-1)),(0,e.createElementVNode)("button",{class:"help-close",onClick:n[4]||(n[4]=e=>y.value=!1)},[(0,e.createVNode)((0,e.unref)(g.A),{size:18})])]),(0,e.createElementVNode)("div",Ct,[(0,e.createElementVNode)("div",At,"v"+(0,e.toDisplayString)(N.value),1),n[15]||(n[15]=(0,e.createElementVNode)("p",{class:"help-desc"},"AI驱动的沉浸式文字冒险游戏",-1)),n[16]||(n[16]=(0,e.createElementVNode)("p",{class:"help-desc"},"有任何问题请联系：support@advapute.com",-1)),(0,e.createElementVNode)("a",Dt,[(0,e.createVNode)((0,e.unref)(h.A),{size:18}),n[14]||(n[14]=(0,e.createElementVNode)("span",null,"查看我们的官网",-1)),(0,e.createVNode)((0,e.unref)(f),{size:16})]),n[17]||(n[17]=(0,e.createElementVNode)("div",{class:"help-warning"},[(0,e.createElementVNode)("span",null,[(0,e.createTextVNode)("⚠️ 请您尽量使用推荐配置，如需自行调整请确保您了解游戏原理，"),(0,e.createElementVNode)("strong",null,"禁止COT")])],-1))])])])):(0,e.createCommentVNode)("v-if",!0)])}}});var Bt=n(2425),It={};It.styleTagTransform=I(),It.setAttributes=A(),It.insert=_().bind(null,"head"),It.domAPI=S(),It.insertStyleElement=T(),E()(Bt.A,It),Bt.A&&Bt.A.locals&&Bt.A.locals;const zt=(0,P.A)(Tt,[["__scopeId","data-v-7f9f51bc"]]);var Mt=n(1156),Pt=n(9352),Rt={};Rt.styleTagTransform=I(),Rt.setAttributes=A(),Rt.insert=_().bind(null,"head"),Rt.domAPI=S(),Rt.insertStyleElement=T(),E()(Pt.A,Rt),Pt.A&&Pt.A.locals&&Pt.A.locals;var $t=n(1606),Ot={};Ot.styleTagTransform=I(),Ot.setAttributes=A(),Ot.insert=_().bind(null,"head"),Ot.domAPI=S(),Ot.insertStyleElement=T(),E()($t.A,Ot),$t.A&&$t.A.locals&&$t.A.locals;var Lt=n(6627),Ft={};Ft.styleTagTransform=I(),Ft.setAttributes=A(),Ft.insert=_().bind(null,"head"),Ft.domAPI=S(),Ft.insertStyleElement=T(),E()(Lt.A,Ft),Lt.A&&Lt.A.locals&&Lt.A.locals;var jt=n(8396),Ut={};Ut.styleTagTransform=I(),Ut.setAttributes=A(),Ut.insert=_().bind(null,"head"),Ut.domAPI=S(),Ut.insertStyleElement=T(),E()(jt.A,Ut),jt.A&&jt.A.locals&&jt.A.locals;var qt=n(5954),Gt={};Gt.styleTagTransform=I(),Gt.setAttributes=A(),Gt.insert=_().bind(null,"head"),Gt.domAPI=S(),Gt.insertStyleElement=T(),E()(qt.A,Gt),qt.A&&qt.A.locals&&qt.A.locals;var Ht=n(8507),Yt={};Yt.styleTagTransform=I(),Yt.setAttributes=A(),Yt.insert=_().bind(null,"head"),Yt.domAPI=S(),Yt.insertStyleElement=T(),E()(Ht.A,Yt),Ht.A&&Ht.A.locals&&Ht.A.locals;var Wt=n(6254),Xt={};Xt.styleTagTransform=I(),Xt.setAttributes=A(),Xt.insert=_().bind(null,"head"),Xt.domAPI=S(),Xt.insertStyleElement=T(),E()(Wt.A,Xt),Wt.A&&Wt.A.locals&&Wt.A.locals;var Jt=n(3302);const Kt={log:console.log.bind(console),warn:console.warn.bind(console),info:console.info.bind(console),debug:console.debug?console.debug.bind(console):void 0,table:console.table?console.table.bind(console):void 0,group:console.group?console.group.bind(console):void 0,groupCollapsed:console.groupCollapsed?console.groupCollapsed.bind(console):void 0,groupEnd:console.groupEnd?console.groupEnd.bind(console):void 0,error:console.error.bind(console)},Zt=()=>Jt.w9.isConsoleDebugEnabled();console.log=(...e)=>{Zt()&&Kt.log(...e)},console.warn=(...e)=>{Zt()&&Kt.warn(...e)},console.info=(...e)=>{Jt.w9.isDebugMode()&&Kt.info(...e)},Kt.debug&&(console.debug=(...e)=>{Zt()&&Kt.debug(...e)}),Kt.table&&(console.table=(...e)=>{Zt()&&Kt.table(...e)}),Kt.group&&(console.group=(...e)=>{Zt()&&Kt.group(...e)}),Kt.groupCollapsed&&(console.groupCollapsed=(...e)=>{Zt()&&Kt.groupCollapsed(...e)}),Kt.groupEnd&&(console.groupEnd=(...e)=>{Zt()&&Kt.groupEnd(...e)});var Qt=n(5099),en=n(876);!async function(){console.log("【应用启动】开始初始化流程..."),document.documentElement.getAttribute("data-theme")||document.documentElement.setAttribute("data-theme","dark"),await(0,Qt.YK)(),console.log("【应用启动】数据迁移检查完成，开始挂载Vue应用");const n=(0,e.createApp)(zt),{t:a}=(0,en.s)();n.config.globalProperties.$t=a,n.mixin({methods:{t:e=>a(e)}}),n.use((0,t.Ey)()),n.use(Mt.default),n.mount("#app"),console.log("【应用启动】✅ Vue应用已成功挂载")}()})()})();
