/**
 * @fileoverview SaveDataæ•°æ®ç»“æ„å®šä¹‰
 *
 * ã€èŒè´£ã€‘
 * - å®šä¹‰å®Œæ•´çš„SaveDataæ•°æ®ç»“æ„
 * - æä¾›æ•°æ®ç»“æ„ç¤ºä¾‹
 * - è¯´æ˜å­—æ®µç±»å‹å’Œçº¦æŸ
 *
 * ã€è®¾è®¡åŸåˆ™ã€‘
 * - çº¯æ•°æ®ç»“æ„å®šä¹‰
 * - ä¸åŒ…å«æ“ä½œè§„åˆ™
 * - ä½œä¸ºæ•°æ®å­—å…¸ä½¿ç”¨
 */

const CHARACTER_STRUCTURE = `
## 1. è§’è‰²ï¼ˆV3ï¼šè§’è‰².*ï¼‰

### 1.1 èº«ä»½ï¼ˆMostly Read-onlyï¼Œè·¯å¾„ï¼š\`è§’è‰².èº«ä»½\`ï¼‰
- åå­—: string (åªè¯»)
- æ€§åˆ«: "ç”·"|"å¥³"|"å…¶ä»–" (åªè¯»)
- å¹´é¾„: number (è‡ªåŠ¨è®¡ç®—ï¼Œç¦æ”¹)
- å‡ºç”Ÿæ—¥æœŸ: {å¹´, æœˆ, æ—¥, å°æ—¶?, åˆ†é’Ÿ?} (åªè¯»)
- ä¸–ç•Œ: string (åªè¯»)
- ç§æ—: string (é»˜è®¤"äººæ—")
- å¤©èµ„: string (åªè¯»)
- å‡ºç”Ÿ: string|{åç§°, æè¿°} (åªè¯»)
- æ”¹é€ æ ¸å¿ƒ: string|{åç§°, å“çº§, æè¿°, å±æ€§[], è®­ç»ƒåŠ æˆ} (åªè¯»ï¼Œè¡¨ç¤ºæ”¹é€ æ ¸å¿ƒ)
- æ¨¡å—: [{åç§°, æè¿°}] (åªè¯»)
- åˆå§‹å…­ç»´: {ä½“è´¨, èƒ½æº, ç®—æ³•, èµ„æºæ„ŸçŸ¥, é­…åŠ›, å¿ƒæ™º} (åªè¯»ï¼Œ1-10ï¼Œå¯¹è®­ç»ƒ/æˆ˜æ–—åŠ æˆå æ¯”70%)
- æˆé•¿å…­ç»´: {ä½“è´¨, èƒ½æº, ç®—æ³•, èµ„æºæ„ŸçŸ¥, é­…åŠ›, å¿ƒæ™º} (å¯ä¿®æ”¹ï¼Œç”¨addï¼Œæ¯é¡¹ä¸Šé™20ï¼Œå•æ¬¡å¢åŠ 1-3ç‚¹ï¼Œå¯¹åŠ æˆå æ¯”30%)
  - è·å–æ–¹å¼ï¼šè£…å¤‡å¢å¹…ã€å¤©èµ‹æ•ˆæœã€ä½¿ç”¨è€—æã€æ„å¤–æœºç¼˜(æœ€å¤š+5)ã€ä¸“ç²¾æå‡ã€ç­‰çº§å‡çº§
  - ç­‰ä»·åŸåˆ™ï¼šåˆå§‹1ç‚¹ â‰ˆ æˆé•¿2.33ç‚¹æ•ˆæœ

### 1.2 å±æ€§ï¼ˆModifiableï¼Œè·¯å¾„ï¼š\`è§’è‰².å±æ€§\`ï¼‰
- é˜¶ä½: {åç§°, é˜¶æ®µ, å½“å‰è¿›åº¦, ä¸‹ä¸€çº§æ‰€éœ€, å‡çº§æè¿°} (ç”¨setæ›´æ–°æ•´ä¸ªå¯¹è±¡ï¼Œå‡çº§æ—¶å¿…é¡»æ›´æ–°å‡çº§æè¿°)
- å£°æœ›: number (ç”¨add)
- ç”Ÿå‘½å€¼: {å½“å‰, ä¸Šé™} (å½“å‰ç”¨addï¼Œä¸Šé™å‡çº§æ—¶ç”¨add)
- ç”µé‡: {å½“å‰, ä¸Šé™} (å½“å‰ç”¨addï¼Œä¸Šé™å‡çº§æ—¶ç”¨add)
- å¸¦å®½: {å½“å‰, ä¸Šé™} (å½“å‰ç”¨addï¼Œä¸Šé™å‡çº§æ—¶ç”¨add)
- å¯¿å‘½: {å½“å‰, ä¸Šé™} (å½“å‰è‡ªåŠ¨å¢åŠ ï¼Œä¸Šé™å‡çº§æ—¶ç”¨add)

### 1.3 ä½ç½®ï¼ˆè·¯å¾„ï¼š\`è§’è‰².ä½ç½®\`ï¼‰
- ä½ç½®: {æè¿°:"å¤§é™†Â·åœ°ç‚¹", x, y, ä¿¡å·å¼ºåº¦} (ç”¨setæ›´æ–°æ•´ä¸ªå¯¹è±¡)
  - æè¿°: string (å¿…å¡«ï¼Œæ ¼å¼"å¤§é™†Â·åŒºåŸŸÂ·åœ°ç‚¹")
  - x: number (æ¨ªåæ ‡ï¼ŒèŒƒå›´ 0-10000)
  - y: number (çºµåæ ‡ï¼ŒèŒƒå›´ 0-10000)
  - ä¿¡å·å¼ºåº¦: number (å¿…å¡«ï¼Œ1-100ï¼Œå½±å“è®­ç»ƒé€Ÿåº¦)
    - 1-20: ä¿¡å·ç¨€è–„ï¼ˆç›²åŒºã€åè¿œè¡—åŒºï¼‰
    - 21-40: ä¿¡å·æ™®é€šï¼ˆå¸¸è§„åŒºåŸŸï¼‰
    - 41-60: ä¿¡å·å……æ²›ï¼ˆç¨³å®šç½‘ç»œè¦†ç›–ï¼‰
    - 61-80: ä¿¡å·æµ“éƒï¼ˆæ ¸å¿ƒèŠ‚ç‚¹é™„è¿‘ï¼‰
    - 81-100: ä¿¡å·æç››ï¼ˆä¸»æœºæ¢çº½ã€å…³é”®èŠ‚ç‚¹ï¼‰

### 1.4 æ•ˆæœï¼ˆbuff/debuffï¼Œæ•°ç»„ï¼›è·¯å¾„ï¼š\`è§’è‰².æ•ˆæœ\`ï¼‰
- æ•ˆæœ: [{çŠ¶æ€åç§°, ç±»å‹:"buff"|"debuff", ç”Ÿæˆæ—¶é—´, æŒç»­æ—¶é—´åˆ†é’Ÿ, çŠ¶æ€æè¿°, å¼ºåº¦?, æ¥æº?}]
  - åªèƒ½ç”¨ push æ·»åŠ ï¼›è¿‡æœŸç”±ç³»ç»Ÿæ¸…ç†
  - **ç”Ÿæˆæ—¶é—´å­—æ®µå¿…å¡«**ï¼šä½¿ç”¨å½“å‰ \`å…ƒæ•°æ®.æ—¶é—´\` çš„å®Œæ•´å¯¹è±¡ï¼Œæ ¼å¼ï¼š{å¹´, æœˆ, æ—¥, å°æ—¶, åˆ†é’Ÿ}
  - ç¤ºä¾‹ï¼š{"action":"push","key":"è§’è‰².æ•ˆæœ","value":{"çŠ¶æ€åç§°":"ç”µé‡å……ç›ˆ","ç±»å‹":"buff","ç”Ÿæˆæ—¶é—´":{"å¹´":1000,"æœˆ":3,"æ—¥":15,"å°æ—¶":10,"åˆ†é’Ÿ":30},"æŒç»­æ—¶é—´åˆ†é’Ÿ":120,"çŠ¶æ€æè¿°":"ç”µé‡æ¢å¤é€Ÿåº¦æå‡50%","å¼ºåº¦":50}}

### 1.5 è£…å¤‡ï¼ˆEquipmentï¼Œè·¯å¾„ï¼š\`è§’è‰².è£…å¤‡\`ï¼‰
- è£…å¤‡1: string|null (è£…å¤‡IDæˆ–null)
- è£…å¤‡2: string|null
- è£…å¤‡3: string|null
- è£…å¤‡4: string|null
- è£…å¤‡5: string|null
- è£…å¤‡6: string|null
`

const DAO_STRUCTURE = `
## 2. ä¸“ç²¾ï¼ˆModifiableï¼Œè·¯å¾„ä¸º \`è§’è‰².æµæ´¾\`ï¼‰
- æµæ´¾åˆ—è¡¨: {æµæ´¾å: DaoDataå¯¹è±¡}ï¼ˆå­—æ®µåä¿æŒå…¼å®¹ï¼Œè¯­ä¹‰ä¸ºâ€œä¸“ç²¾åˆ—è¡¨â€ï¼‰

### DaoDataå¯¹è±¡å¿…éœ€å­—æ®µ
- æµæ´¾å: string (å¦‚"æ½œè¡Œ"ã€"ç ´è§£")
- æè¿°: string (ä¸“ç²¾æè¿°)
- é˜¶æ®µåˆ—è¡¨: DaoStage[] (ä¸“ç²¾çš„æ‰€æœ‰é˜¶æ®µå®šä¹‰ï¼Œæ•°ç»„)
- æ˜¯å¦è§£é”: boolean (æ˜¯å¦å·²è§£é”æ­¤é“)
- å½“å‰é˜¶æ®µ: number (é˜¶æ®µç´¢å¼•ï¼Œ0ä¸º"å…¥é—¨")
- å½“å‰ç»éªŒ: number (å½“å‰ç»éªŒå€¼)
- æ€»ç»éªŒ: number (æ€»ç´¯è®¡ç»éªŒ)

### DaoStageå¯¹è±¡å­—æ®µ
- é˜¶æ®µå: string (å¦‚"å…¥é—¨"ã€"å°æˆ"ã€"å¤§æˆ"ç­‰)
- éœ€æ±‚ç»éªŒ: number
- æ„Ÿæ‚Ÿæ¡ç›®?: string[] (é˜¶æ®µæ„Ÿæ‚Ÿ)
- çªç ´éœ€æ±‚?: string (çªç ´æ¡ä»¶æè¿°)

è·¯å¾„ç¤ºä¾‹ï¼š
- set \`è§’è‰².æµæ´¾.æµæ´¾åˆ—è¡¨.æ½œè¡Œ\` {"æµæ´¾å":"æ½œè¡Œ","æè¿°":"éšåŒ¿è¡ŒåŠ¨ä¸æ¸—é€æŠ€å·§","é˜¶æ®µåˆ—è¡¨":[{"é˜¶æ®µå":"å…¥é—¨","éœ€æ±‚ç»éªŒ":100}],"æ˜¯å¦è§£é”":true,"å½“å‰é˜¶æ®µ":0,"å½“å‰ç»éªŒ":0,"æ€»ç»éªŒ":0}
- add \`è§’è‰².æµæ´¾.æµæ´¾åˆ—è¡¨.æ½œè¡Œ.å½“å‰ç»éªŒ\` 100
`

const INVENTORY_STRUCTURE = `
## 3. èƒŒåŒ…ä¸ç‰©å“ (Inventory & Items - Modifiableï¼Œè·¯å¾„ï¼š\`è§’è‰².èƒŒåŒ…\`)

### 3.1 èƒŒåŒ… (Inventory)
- ä¿¡ç”¨ç‚¹: {ä½é¢:number, ä¸­é¢:number, é«˜é¢:number, æœ€é«˜é¢:number} (ç”¨addå¢å‡)
- ç‰©å“: {ç‰©å“ID: Itemå¯¹è±¡} (ç”¨setæ·»åŠ å®Œæ•´ç‰©å“å¯¹è±¡ï¼Œç”¨deleteåˆ é™¤)

**ã€ç‰©å“æ“ä½œæ–¹å¼ã€‘**
- æ·»åŠ æ–°ç‰©å“: {"action":"set", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.{ç‰©å“ID}", "value":{å®Œæ•´ç‰©å“å¯¹è±¡}}
- åˆ é™¤ç‰©å“: {"action":"delete", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.{ç‰©å“ID}"}
- ä¿®æ”¹ç‰©å“æ•°é‡: {"action":"add", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.{ç‰©å“ID}.æ•°é‡", "value":å¢å‡å€¼}
- ä¿®æ”¹ç‰©å“å±æ€§: {"action":"set", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.{ç‰©å“ID}.å±æ€§å", "value":"æ–°å€¼"}

ç¤ºä¾‹ï¼š
- æ·»åŠ ç‰©å“: {"action":"set", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.item_jade_001", "value":{"ç‰©å“ID":"item_jade_001","åç§°":"è¡€ç‰","ç±»å‹":"å…¶ä»–","å“è´¨":{"quality":"ç„","grade":5},"æ•°é‡":1,"æè¿°":"ä¸€å—æŸ“è¡€çš„ç‰ä½©"}}
- ä¿®æ”¹æè¿°: {"action":"set", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.item_jade_001.æè¿°", "value":"ç‰ä½©ä¸Šçš„è¡€æ¸å·²è¢«ä¿¡å·å‡€åŒ–"}
- ä¿®æ”¹ä½¿ç”¨æ•ˆæœ: {"action":"set", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.item_jade_001.ä½¿ç”¨æ•ˆæœ", "value":"å¯ä»¥æ³¨å…¥ç”µé‡æ¿€æ´»"}
- å¢åŠ æ•°é‡: {"action":"add", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.item_jade_001.æ•°é‡", "value":1}

### 3.2 ç‰©å“ç±»å‹ (Item Types)

#### 3.2.1 è£…å¤‡ç‰©å“
å®Œæ•´ç»“æ„: {ç‰©å“ID:string, åç§°:string, ç±»å‹:"è£…å¤‡", å“è´¨:{quality:"å‡¡"|"é»„"|"ç„"|"åœ°"|"å¤©"|"ä»™"|"ç¥", grade:0-10}, æ•°é‡:number, æè¿°:string, è£…å¤‡å¢å¹…?:object, ç‰¹æ®Šæ•ˆæœ?:string, å·²è£…å¤‡:boolean}

å­—æ®µè¯´æ˜:
- ç‰©å“ID: string (å¿…å¡«ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œæ ¼å¼: equip_æ—¶é—´æˆ³_éšæœºæ•°)
- åç§°: string (å¿…å¡«ï¼Œè£…å¤‡åç§°)
- ç±»å‹: "è£…å¤‡" (å¿…å¡«ï¼Œå›ºå®šå€¼)
- å“è´¨: object (å¿…å¡«)
  - quality: "å‡¡"|"é»„"|"ç„"|"åœ°"|"å¤©"|"ä»™"|"ç¥" (å“è´¨ç­‰çº§)
  - grade: number (å“çº§ï¼Œ0-10ï¼Œ0=æ®‹ç¼ºï¼Œ1-3=ä¸‹å“ï¼Œ4-6=ä¸­å“ï¼Œ7-9=ä¸Šå“ï¼Œ10=æå“)
- æ•°é‡: number (å¿…å¡«ï¼Œé€šå¸¸ä¸º1ï¼Œè£…å¤‡ä¸å¯å åŠ )
- æè¿°: string (å¿…å¡«ï¼Œè£…å¤‡æè¿°)
- è£…å¤‡å¢å¹…: object (å¯é€‰ï¼Œå±æ€§åŠ æˆå¯¹è±¡)
  - æ ¼å¼: {"æˆé•¿å…­ç»´": {"ä½“è´¨": 2, "èƒ½æº": 1}, "ç”Ÿå‘½å€¼ä¸Šé™": 50, "ç”µé‡ä¸Šé™": 30}
  - æˆé•¿å…­ç»´: object (å¯é€‰ï¼Œå…­ç»´åŠ æˆ)
  - ç”Ÿå‘½å€¼ä¸Šé™: number (å¯é€‰)
  - ç”µé‡ä¸Šé™: number (å¯é€‰)
  - å¸¦å®½ä¸Šé™: number (å¯é€‰)
- ç‰¹æ®Šæ•ˆæœ: string (å¯é€‰ï¼Œæè¿°è£…å¤‡çš„ç‰¹æ®Šèƒ½åŠ›)
  - ç¤ºä¾‹: "æ”»å‡»æ—¶æœ‰10%å‡ ç‡è§¦å‘ç«ç„°ä¼¤å®³"
- å·²è£…å¤‡: boolean (å¿…å¡«ï¼Œtrue=å·²è£…å¤‡ï¼Œfalse=æœªè£…å¤‡)

#### 3.2.2 æ¨¡å—ç‰©å“ï¼ˆç±»å‹å­—æ®µä¸º"æ¨¡å—"ï¼‰
å®Œæ•´ç»“æ„: {ç‰©å“ID:string, åç§°:string, ç±»å‹:"æ¨¡å—", å“è´¨:{quality:"å‡¡"|"é»„"|"ç„"|"åœ°"|"å¤©"|"ä»™"|"ç¥", grade:0-10}, æ•°é‡:number, æè¿°:string, æ¨¡å—æ•ˆæœ:string, æ¨¡å—æŠ€èƒ½:array, è®­ç»ƒè¿›åº¦:number, å·²è§£é”æŠ€èƒ½:array, å·²è£…å¤‡:boolean}

å­—æ®µè¯´æ˜:
- ç‰©å“ID: string (å¿…å¡«ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œæ ¼å¼: module_æ—¶é—´æˆ³_éšæœºæ•°)
- åç§°: string (å¿…å¡«ï¼Œæ¨¡å—åç§°)
- ç±»å‹: "æ¨¡å—" (å¿…å¡«ï¼Œå›ºå®šå€¼ï¼Œè¡¨ç¤ºæ¨¡å—)
- å“è´¨: object (å¿…å¡«ï¼ŒåŒè£…å¤‡)
- æ•°é‡: number (å¿…å¡«ï¼Œé€šå¸¸ä¸º1ï¼Œæ¨¡å—ä¸å¯å åŠ )
- æè¿°: string (å¿…å¡«ï¼Œæ¨¡å—æè¿°)
- æ¨¡å—æ•ˆæœ: string (å¿…å¡«ï¼Œæè¿°æ¨¡å—æ•ˆæœ)
  - ç¤ºä¾‹: "è®­ç»ƒæ•ˆç‡æå‡300%ï¼Œå¯¹å¹²æ‰°ç±»æŒ‡ä»¤å®Œå…¨å…ç–«ï¼Œå¹¶å¯åå‘è¿½è¸ªæºå¤´"
- æ¨¡å—æŠ€èƒ½: array (å¿…å¡«ï¼ŒæŠ€èƒ½åˆ—è¡¨ï¼Œä¸å¯ä¸ºç©ºï¼›è‡³å°‘1ä¸ªï¼Œä¸”ç¬¬1ä¸ªæŠ€èƒ½ç†Ÿç»ƒåº¦è¦æ±‚=0)
  - å…ƒç´ æ ¼å¼: {æŠ€èƒ½åç§°:string, æŠ€èƒ½æè¿°:string, ç†Ÿç»ƒåº¦è¦æ±‚:number, æ¶ˆè€—?:string}
- æ¶ˆè€—æ ¼å¼ï¼šåªå…è®¸ ç”µé‡/å¸¦å®½/ç”Ÿå‘½å€¼/å¯¿å‘½ å››ç§èµ„æºï¼Œå¿…é¡»ç”¨ç™¾åˆ†æ¯”ï¼›å¯¿å‘½ç”¨æ—¶é•¿æè¿°å¦‚"å¯¿å‘½5å¹´"
  - å¯ç»„åˆæ¶ˆè€—ï¼šå¦‚"ç”µé‡20%+å¸¦å®½10%"ã€"ç”Ÿå‘½å€¼30%+ç”µé‡15%"
  - ç¤ºä¾‹: [{"æŠ€èƒ½åç§°":"ä¿¡å·æ¥å…¥","æŠ€èƒ½æè¿°":"æ¥å…¥å±€åŸŸç½‘å¹¶å»ºç«‹å®‰å…¨é€šé“ï¼Œå¼ºåŒ–é˜²æŠ¤","ç†Ÿç»ƒåº¦è¦æ±‚":0,"æ¶ˆè€—":"ç”µé‡5%"},{"æŠ€èƒ½åç§°":"è¿œç¨‹å‹åˆ¶","æŠ€èƒ½æè¿°":"ä»¥å¸¦å®½é”å®šç›®æ ‡ï¼ŒçŸ­è·å‹åˆ¶å¯¹æ–¹è¡ŒåŠ¨","ç†Ÿç»ƒåº¦è¦æ±‚":30,"æ¶ˆè€—":"ç”µé‡12%+å¸¦å®½8%"},{"æŠ€èƒ½åç§°":"é»‘å¢™å†²å‡»","æŠ€èƒ½æè¿°":"å‡èšé«˜å¼ºåº¦æ•°æ®å†²å‡»ï¼Œç›´å‡»å¯¹æ–¹æ ¸å¿ƒ","ç†Ÿç»ƒåº¦è¦æ±‚":70,"æ¶ˆè€—":"å¸¦å®½30%"}]
- è®­ç»ƒè¿›åº¦: number (å¿…å¡«ï¼Œ0-100ï¼Œè¡¨ç¤ºè®­ç»ƒç™¾åˆ†æ¯”)
- å·²è§£é”æŠ€èƒ½: array (å¿…å¡«ï¼Œå·²è§£é”çš„æŠ€èƒ½åç§°åˆ—è¡¨ï¼Œå¯ä»¥ä¸ºç©ºæ•°ç»„[])
  - ç¤ºä¾‹: ["åŸºç¡€çªè¿›", "æˆ˜æœ¯è·ƒè¿"]
- å·²è£…å¤‡: boolean (å¿…å¡«ï¼Œtrue=æ­£åœ¨è®­ç»ƒï¼Œfalse=æœªè®­ç»ƒ)

é‡è¦: è®­ç»ƒè¿›åº¦å’Œå·²è§£é”æŠ€èƒ½å­˜å‚¨åœ¨èƒŒåŒ…ç‰©å“ä¸­ï¼Œç”¨add/setä¿®æ”¹
ç¤ºä¾‹: {"action":"add", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.module_001.è®­ç»ƒè¿›åº¦", "value":10}

#### 3.2.3 æ¶ˆè€—å“ä¸ææ–™
å®Œæ•´ç»“æ„: {ç‰©å“ID:string, åç§°:string, ç±»å‹:"ä¸¹è¯"|"ææ–™"|"å…¶ä»–", å“è´¨:{quality:"å‡¡"|"é»„"|"ç„"|"åœ°"|"å¤©"|"ä»™"|"ç¥", grade:0-10}, æ•°é‡:number, æè¿°:string, ä½¿ç”¨æ•ˆæœ?:string}ï¼ˆç±»å‹å­—æ®µä¸ºå…¼å®¹ä¿ç•™ï¼‰

å­—æ®µè¯´æ˜:
- ç‰©å“ID: string (å¿…å¡«ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œæ ¼å¼: item_æ—¶é—´æˆ³_éšæœºæ•°)
- åç§°: string (å¿…å¡«ï¼Œç‰©å“åç§°)
- ç±»å‹: "ä¸¹è¯"|"ææ–™"|"å…¶ä»–" (å¿…å¡«)
  - ä¸¹è¯: å¯ç›´æ¥ä½¿ç”¨çš„æ¶ˆè€—å“ï¼Œå¦‚å›å¤å‰‚ã€å¢ç›Šå‰‚ç­‰
  - ææ–™: ç”¨äºåˆ¶é€ ã€æ”¹è£…ç­‰çš„åŸææ–™
  - å…¶ä»–: ä»»åŠ¡ç‰©å“ã€æ”¶è—å“ç­‰æ‚é¡¹
- å“è´¨: object (å¿…å¡«ï¼ŒåŒè£…å¤‡)
- æ•°é‡: number (å¿…å¡«ï¼Œå¯å åŠ )
- æè¿°: string (å¿…å¡«ï¼Œç‰©å“æè¿°)
- ä½¿ç”¨æ•ˆæœ: string (å¯é€‰ï¼Œæè¿°ç‰©å“çš„ä½¿ç”¨æ•ˆæœï¼›æ¶ˆè€—å“ç±»å»ºè®®å¡«å†™ï¼Œææ–™ç±»é€šå¸¸æ²¡æœ‰)
  - ç¤ºä¾‹: "æ¢å¤500ç‚¹ç”Ÿå‘½å€¼ï¼Œå¹¶åœ¨1å°æ—¶å†…æå‡ç”Ÿå‘½æ¢å¤é€Ÿåº¦50%"

### 3.3 è§’è‰².è®­ç»ƒ.è®­ç»ƒæ¨¡å—ï¼ˆå½“å‰è®­ç»ƒå¼•ç”¨ï¼‰
**ã€ä¸¥ç¦ä¿®æ”¹ã€‘æ­¤å­—æ®µåªå­˜å‚¨å¼•ç”¨ï¼Œä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼**
- ç‰©å“ID: string (æŒ‡å‘èƒŒåŒ…ä¸­çš„æ¨¡å—ID)
- åç§°: string

**ã€å…³é”®è§„åˆ™ã€‘è®­ç»ƒæ¨¡å—çš„ä½ç½®å’Œä¿®æ”¹æ–¹å¼ï¼š**
- [é”™è¯¯] é”™è¯¯ï¼šä¿®æ”¹"è§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}"ä»¥å¤–çš„ä½ç½®æ¥â€œä¼ªé€ è¿›åº¦â€
- [æ­£ç¡®] æ­£ç¡®ï¼šä¿®æ”¹"è§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}"å­—æ®µ
- è®­ç»ƒè¿›åº¦å­˜å‚¨ä½ç½®ï¼šè§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}.è®­ç»ƒè¿›åº¦
- å·²è§£é”æŠ€èƒ½å­˜å‚¨ä½ç½®ï¼šè§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}.å·²è§£é”æŠ€èƒ½
- æ¨¡å—æŠ€èƒ½åˆ—è¡¨å­˜å‚¨ä½ç½®ï¼šè§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}.æ¨¡å—æŠ€èƒ½

ç¤ºä¾‹æ“ä½œï¼š
- å¢åŠ è®­ç»ƒè¿›åº¦: {"action":"add", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.module_001.è®­ç»ƒè¿›åº¦", "value":10}
- è§£é”æ–°æŠ€èƒ½: {"action":"push", "key":"è§’è‰².èƒŒåŒ….ç‰©å“.module_001.å·²è§£é”æŠ€èƒ½", "value":"æˆ˜æœ¯è·ƒè¿"}

### 3.4 è§’è‰².æŠ€èƒ½.æŒæ¡æŠ€èƒ½ï¼ˆåªè¯»ï¼‰
**ã€å®Œå…¨åªè¯»ã€‘æ­¤å­—æ®µç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼ŒAIä¸¥ç¦é€šè¿‡tavern_commandsä¿®æ”¹ï¼**
- [{æŠ€èƒ½åç§°, æŠ€èƒ½æè¿°, æ¥æº, æ¶ˆè€—, ç†Ÿç»ƒåº¦, ä½¿ç”¨æ¬¡æ•°}]

**ã€å…³é”®è§„åˆ™ã€‘æŒæ¡æŠ€èƒ½çš„ä½ç½®å’Œæ¥æºï¼š**
- [é”™è¯¯] é”™è¯¯ï¼šç›´æ¥ set/push "è§’è‰².æŠ€èƒ½.æŒæ¡æŠ€èƒ½" æ•°ç»„
- [é”™è¯¯] é”™è¯¯ï¼šä¿®æ”¹ "è§’è‰².æŠ€èƒ½.æŒæ¡æŠ€èƒ½" ä¸­çš„æŠ€èƒ½åç§°/æè¿°/æ¥æº/æ¶ˆè€—

**ã€æ•°æ®æ¥æºã€‘æŒæ¡æŠ€èƒ½ä»å“ªé‡Œæ¥ï¼š**
- ç³»ç»Ÿè‡ªåŠ¨ä»"è§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}.å·²è§£é”æŠ€èƒ½"ä¸­æå–
- å½“æ¨¡å—è£…å¤‡åï¼Œå·²è§£é”çš„æŠ€èƒ½ä¼šè‡ªåŠ¨å‡ºç°åœ¨"è§’è‰².æŠ€èƒ½.æŒæ¡æŠ€èƒ½"ä¸­
- æŠ€èƒ½çš„åŸºç¡€ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€æ¶ˆè€—ï¼‰æ¥è‡ª"è§’è‰².èƒŒåŒ….ç‰©å“.{æ¨¡å—ID}.æ¨¡å—æŠ€èƒ½"æ•°ç»„
`

const RELATIONS_STRUCTURE = `
## 4. å…³ç³»ï¼ˆNPCæ¡£æ¡ˆå­—å…¸ï¼Œå¯ä¿®æ”¹ï¼Œè·¯å¾„ï¼š\`ç¤¾äº¤.å…³ç³»\`ï¼‰

### ğŸš¨ ã€æœ€é«˜ä¼˜å…ˆçº§ã€‘NPC åˆ›å»ºè§„åˆ™ ğŸš¨
**æ–°å¢ NPC å¿…é¡»ä¸€æ¬¡æ€§åˆ›å»ºå®Œæ•´å¯¹è±¡ï¼Œä¸èƒ½åˆ†æ­¥æ·»åŠ ï¼**

- **[æ­£ç¡®]** ä½¿ç”¨ set æ“ä½œåˆ›å»ºå®Œæ•´çš„ NPC å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- **[é”™è¯¯]** å…ˆåˆ›å»ºç©ºå¯¹è±¡ï¼Œå†é€ä¸ªæ·»åŠ å­—æ®µ
- **[é”™è¯¯]** åªæ·»åŠ éƒ¨åˆ†å­—æ®µï¼Œç¼ºå°‘å¿…éœ€å­—æ®µ
- **[å¼ºåˆ¶]** NPCå¯¹è±¡é‡Œå¿…é¡»åŒ…å« \`åå­—\` å­—æ®µï¼Œä¸”ä¸è·¯å¾„ä¸­çš„NPCåä¸€è‡´

### âœ… ã€NPCæ•°é‡å¾ˆå¤šæ—¶çš„"æœ€å°å¯ç”¨å­—æ®µ"ã€‘
å½“å…³ç³»æ•°æ®å¾ˆå¤šã€ä¸Šä¸‹æ–‡ç´§å¼ æ—¶ï¼Œå…è®¸ç²¾ç®€æè¿°æ€§å­—æ®µï¼Œä½† **ä»¥ä¸‹å­—æ®µç»ä¸èƒ½ç¼ºå¤±**ï¼ˆå¦åˆ™å‰ç«¯å¯èƒ½æ— æ³•å±•ç¤º/ç³»ç»Ÿä¼šæ¸…ç†ä¸ºæ— æ•ˆæ•°æ®ï¼‰ï¼š
- \`åå­—\`ã€\`æ€§åˆ«\`ã€\`å‡ºç”Ÿæ—¥æœŸ\`ã€\`é˜¶ä½\`ã€\`ä¸ç©å®¶å…³ç³»\`ã€\`å¥½æ„Ÿåº¦\`
- \`å½“å‰ä½ç½®.æè¿°\`ã€\`å½“å‰å¤–è²ŒçŠ¶æ€\`ã€\`å½“å‰å†…å¿ƒæƒ³æ³•\`
- \`è®°å¿†\`ï¼ˆæ•°ç»„ï¼Œå¯ä¸ºç©ºæ•°ç»„ï¼‰ã€\`èƒŒåŒ…\`ã€\`å®æ—¶å…³æ³¨\`

**ç¤ºä¾‹ - æ­£ç¡®åšæ³•ï¼š**
\`\`\`json
{"action":"set", "key":"ç¤¾äº¤.å…³ç³».å¼ ä¸‰", "value":{"åå­—":"å¼ ä¸‰","æ€§åˆ«":"ç”·","å¹´é¾„":25,"å‡ºç”Ÿæ—¥æœŸ":{"å¹´":975,"æœˆ":3,"æ—¥":15},"ç§æ—":"äººæ—","å‡ºç”Ÿ":"è¡—åŒºå±…æ°‘","å¤–è²Œæè¿°":"...","æ€§æ ¼ç‰¹å¾":["..."],"é˜¶ä½":{"åç§°":"æ ¸å¿ƒçº§","é˜¶æ®µ":"åˆæœŸ"},"æ”¹é€ æ ¸å¿ƒ":{"åç§°":"åˆé‡‘æ ¸å¿ƒ","å“çº§":"ä¸­å“"},"æ¨¡å—":[],"åˆå§‹å…­ç»´":{"ä½“è´¨":5,"èƒ½æº":6,"ç®—æ³•":5,"èµ„æºæ„ŸçŸ¥":4,"é­…åŠ›":5,"å¿ƒæ™º":6},"ä¸ç©å®¶å…³ç³»":"é™Œç”Ÿäºº","å¥½æ„Ÿåº¦":0,"äººæ ¼åº•çº¿":["..."],"è®°å¿†":[],"è®°å¿†æ€»ç»“":[],"å½“å‰ä½ç½®":{"æè¿°":"...","x":5000,"y":5000},"åŠ¿åŠ›å½’å±":"æ— ","å½“å‰å¤–è²ŒçŠ¶æ€":"...","å½“å‰å†…å¿ƒæƒ³æ³•":"...","èƒŒåŒ…":{"ä¿¡ç”¨ç‚¹":{"ä½é¢":0,"ä¸­é¢":0,"é«˜é¢":0,"æœ€é«˜é¢":0},"ç‰©å“":{}},"å®æ—¶å…³æ³¨":false}}
\`\`\`

**ç¤ºä¾‹ - é”™è¯¯åšæ³•ï¼ˆä¸¥ç¦ï¼‰ï¼š**
\`\`\`
âŒ é”™è¯¯ï¼šå…ˆåˆ›å»ºç©ºå¯¹è±¡
{"action":"set", "key":"ç¤¾äº¤.å…³ç³».å¼ ä¸‰", "value":{}}
âŒ é”™è¯¯ï¼šå†æ·»åŠ å­—æ®µ
{"action":"set", "key":"ç¤¾äº¤.å…³ç³».å¼ ä¸‰.åå­—", "value":"å¼ ä¸‰"}
\`\`\`

---

### NPC æ•°æ®ç»“æ„
- {NPCåå­—: NPCæ¡£æ¡ˆå¯¹è±¡}
  - åå­—: string
  - æ€§åˆ«: "ç”·"|"å¥³"|"å…¶ä»–"
  - å¹´é¾„: number (è‡ªåŠ¨è®¡ç®—)
  - å‡ºç”Ÿæ—¥æœŸ: {å¹´, æœˆ, æ—¥}
  - ç§æ—: string
  - å‡ºç”Ÿ: string
  - å¤–è²Œæè¿°: string
  - æ€§æ ¼ç‰¹å¾: [string]
  - é˜¶ä½: {åç§°, é˜¶æ®µ, å½“å‰è¿›åº¦?, ä¸‹ä¸€çº§æ‰€éœ€?, å‡çº§æè¿°?} (ç”¨setæ›´æ–°æ•´ä¸ªå¯¹è±¡)
  - æ”¹é€ æ ¸å¿ƒ: {åç§°, å“çº§}
  - æ¨¡å—: [{åç§°, æè¿°}]
  - åˆå§‹å…­ç»´: {ä½“è´¨, èƒ½æº, ç®—æ³•, èµ„æºæ„ŸçŸ¥, é­…åŠ›, å¿ƒæ™º}
  - ä¸ç©å®¶å…³ç³»: string
  - å¥½æ„Ÿåº¦: number (-100~100ï¼Œç”¨add)
  - äººæ ¼åº•çº¿: [string]
  - è®°å¿†: [string] (ç”¨pushæ·»åŠ ã€‚éµå¾ªã€è®°å¿†ç”Ÿæˆé“å¾‹ã€‘ï¼šç®€æ´ã€ä¸é‡å¤ã€ç»“æ„åŒ–æ‘˜è¦)
  - è®°å¿†æ€»ç»“: [string]
  - å½“å‰ä½ç½®: {æè¿°, x, y}
  - åŠ¿åŠ›å½’å±: string
  - å½“å‰å¤–è²ŒçŠ¶æ€: string (ç”¨setå®æ—¶æ›´æ–°)
  - å½“å‰å†…å¿ƒæƒ³æ³•: string (ç”¨setå®æ—¶æ›´æ–°)
  - èƒŒåŒ…: {ä¿¡ç”¨ç‚¹, ç‰©å“}
  - ç§å¯†ä¿¡æ¯?: PrivacyProfile (NSFWï¼›ä»…å½“ ç³»ç»Ÿ.nsfwMode=true ä¸” æ€§åˆ«ç¬¦åˆ ç³»ç»Ÿ.nsfwGenderFilter æ‰ç”Ÿæˆï¼›è·¯å¾„ï¼šç¤¾äº¤.å…³ç³».{NPCåå­—}.ç§å¯†ä¿¡æ¯)
  - å®æ—¶å…³æ³¨: boolean

### NSFWï¼šPrivacyProfileï¼ˆç§å¯†ä¿¡æ¯æ¨¡å—ï¼Œè·¯å¾„ï¼šç¤¾äº¤.å…³ç³».{NPCåå­—}.ç§å¯†ä¿¡æ¯ï¼‰
- æ˜¯å¦ä¸ºå¤„å¥³: boolean
- èº«ä½“éƒ¨ä½: [BodyPartDevelopment] (æ•°ç»„ï¼›æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å¯¹è±¡)
- æ€§æ ¼å€¾å‘: string
- æ€§å–å‘: string
- æ€§ç™–å¥½: [string]
- æ€§æ¸´æœ›ç¨‹åº¦: number (0-100)
- å½“å‰æ€§çŠ¶æ€: string
- ä½“æ¶²åˆ†æ³ŒçŠ¶æ€: string
- æ€§äº¤æ€»æ¬¡æ•°: number
- æ€§ä¼´ä¾£åå•: [string]
- æœ€è¿‘ä¸€æ¬¡æ€§è¡Œä¸ºæ—¶é—´: string
- ç‰¹æ®Šä½“è´¨: [string]

**é‡è¦ï¼šä¿®æ”¹NPCç§å¯†ä¿¡æ¯æ—¶å¿…é¡»ä½¿ç”¨å®Œæ•´è·¯å¾„**
ç¤ºä¾‹ï¼š
- ä¿®æ”¹NPCèº«ä½“éƒ¨ä½ï¼ˆé”™è¯¯ï¼‰ï¼šâŒ {"action":"set","key":"èº«ä½“.éƒ¨ä½å¼€å‘.é˜´é“.æ•æ„Ÿåº¦","value":80}
- ä¿®æ”¹NPCèº«ä½“éƒ¨ä½ï¼ˆæ­£ç¡®ï¼‰ï¼šâœ… {"action":"set","key":"ç¤¾äº¤.å…³ç³».æåªšå¨˜.ç§å¯†ä¿¡æ¯.èº«ä½“éƒ¨ä½[0].æ•æ„Ÿåº¦","value":80}
- æ·»åŠ NPCèº«ä½“éƒ¨ä½ï¼šâœ… {"action":"push","key":"ç¤¾äº¤.å…³ç³».æåªšå¨˜.ç§å¯†ä¿¡æ¯.èº«ä½“éƒ¨ä½","value":{"éƒ¨ä½åç§°":"é˜´é“","æ•æ„Ÿåº¦":70,"å¼€å‘åº¦":60,"ç‰¹å¾æè¿°":"..."}}

### NSFWï¼šBodyPartDevelopmentï¼ˆèº«ä½“éƒ¨ä½å¼€å‘æ¡ç›®ï¼‰
- éƒ¨ä½åç§°: string (å¦‚ï¼šèƒ¸éƒ¨/å°ç©´/èŠç©´/å˜´å”‡/è€³æœµç­‰)
- æ•æ„Ÿåº¦: number (0-100)
- å¼€å‘åº¦: number (0-100ï¼›ç»Ÿä¸€ä½¿ç”¨"å¼€å‘åº¦"å­—æ®µå)
- ç‰¹æ®Šå°è®°?: string
- ç‰¹å¾æè¿°: string
`

const MEMORY_STRUCTURE = `
## 5. è®°å¿† (Player Memory - Read-only, DO NOT MODIFY)
**æ ¸å¿ƒè§„åˆ™**: AIä¸¥ç¦é€šè¿‡ \`tavern_commands\` ä¿®æ”¹ä»»ä½•è®°å¿†å­—æ®µã€‚è®°å¿†ç”±ç³»ç»Ÿæ ¹æ®å“åº”JSONä¸­çš„ \`mid_term_memory\` å­—æ®µè‡ªåŠ¨å¤„ç†ã€‚

**æ•°æ®ç»“æ„ (ä»…ä¾›å‚è€ƒ)**:
- çŸ­æœŸè®°å¿†: [string]
- ä¸­æœŸè®°å¿†: [string]
- é•¿æœŸè®°å¿†: [string]
`

const WORLD_INFO_STRUCTURE = `
## 6. ä¸–ç•Œï¼ˆWorld - Modifiableï¼›è”æœºæ¨¡å¼é€šå¸¸åªè¯»ï¼‰
- åœ°å›¾: {continents[], factions[], features[]}
- å¤§é™†ä¿¡æ¯: [{åç§°, æè¿°, åœ°ç†ç‰¹å¾, ...}] (åªè¯»,ç”±ä¸–ç•Œç”Ÿæˆå™¨åˆ›å»º)
- åŠ¿åŠ›ä¿¡æ¯: [{...}] (å¯ä¿®æ”¹,ä¸–ç•Œä¸­çš„ç»„ç»‡ã€é›†å›¢ç­‰)
  - id: string|number (å¯é€‰)
  - åç§°: string
  - ç±»å‹: "ä¼ä¸šé›†å›¢"|"é»‘åŸŸç»„ç»‡"|"å®¶æ—é›†å›¢"|...
  - ç­‰çº§: "è¶…çº§"|"ä¸€æµ"|"äºŒæµ"|"ä¸‰æµ"
  - ä½ç½®: string | {x, y}
  - æè¿°: string
  - ç‰¹è‰²: [string]
  - ä¸ç©å®¶å…³ç³»: "æ•Œå¯¹"|"ä¸­ç«‹"|"å‹å¥½" (ç”¨setä¿®æ”¹)
  - å£°æœ›å€¼: number (ç”¨addä¿®æ”¹)
  - å¯å¦åŠ å…¥: boolean
  - åŠ å…¥æ¡ä»¶: [string]
  - åŠ å…¥å¥½å¤„: [string]
  - æˆå‘˜æ•°é‡: { æ€»æ•°, æŒ‰é˜¶ä½, æŒ‰èŒä½ } (ç”¨setä¿®æ”¹æ•´ä¸ªå¯¹è±¡)
    - æ€»æ•°: number
    - æŒ‰é˜¶ä½: { "è¡—åŒºçº§": number, "åŒºåŸŸçº§": number, ... }
    - æŒ‰èŒä½: { "å¤–å›´æˆå‘˜": number, "å†…éƒ¨æˆå‘˜": number, ... }
  - é¢†å¯¼å±‚: { é¦–é¢†, é¦–é¢†ç­‰çº§, å‰¯é¦–é¢†?, é¡¾é—®æ•°é‡?, æœ€å¼ºç­‰çº§, ç»¼åˆæˆ˜åŠ›? } (ç”¨setä¿®æ”¹)
    - é¦–é¢†: string (å¯èƒ½å› ä¸ºå‰§æƒ…æ›´æ¢)
    - é¦–é¢†ç­‰çº§: string (ä¾‹å¦‚: "æ ¸å¿ƒçº§åæœŸ",å¯èƒ½çªç ´)
    - ç»¼åˆæˆ˜åŠ›: number (1-100)
  - åŠ¿åŠ›èŒƒå›´è¯¦æƒ…: { æ§åˆ¶åŒºåŸŸ, å½±å“èŒƒå›´, æˆ˜ç•¥ä»·å€¼ } (ç”¨setä¿®æ”¹)
    - æ§åˆ¶åŒºåŸŸ: [string]
    - å½±å“èŒƒå›´: string
    - æˆ˜ç•¥ä»·å€¼: number (1-10)

  é‡è¦ï¼šä¿®æ”¹åŠ¿åŠ›ä¿¡æ¯æ—¶ä½¿ç”¨è·¯å¾„: ä¸–ç•Œ.ä¿¡æ¯.åŠ¿åŠ›ä¿¡æ¯[ç´¢å¼•].å­—æ®µå
  ç¤ºä¾‹-ä¿®æ”¹é¦–é¢†: {"action":"set", "key":"ä¸–ç•Œ.ä¿¡æ¯.åŠ¿åŠ›ä¿¡æ¯[0].é¢†å¯¼å±‚.é¦–é¢†", "value":"æ–°é¦–é¢†åå­—"}
  ç¤ºä¾‹-å¢åŠ å£°æœ›: {"action":"add", "key":"ä¸–ç•Œ.ä¿¡æ¯.åŠ¿åŠ›ä¿¡æ¯[2].å£°æœ›å€¼", "value":50}
  ç¤ºä¾‹-æ”¹å˜å…³ç³»: {"action":"set", "key":"ä¸–ç•Œ.ä¿¡æ¯.åŠ¿åŠ›ä¿¡æ¯[1].ä¸ç©å®¶å…³ç³»", "value":"å‹å¥½"}
  ç¤ºä¾‹-æ›´æ–°æˆå‘˜: {"action":"set", "key":"ä¸–ç•Œ.ä¿¡æ¯.åŠ¿åŠ›ä¿¡æ¯[0].æˆå‘˜æ•°é‡", "value":{"æ€»æ•°":500,"æŒ‰é˜¶ä½":{"è¡—åŒºçº§":300,"åŒºåŸŸçº§":150},"æŒ‰èŒä½":{"å¤–å›´æˆå‘˜":400,"å†…éƒ¨æˆå‘˜":100}}}

- åœ°ç‚¹ä¿¡æ¯: [{åç§°, ç±»å‹, ä½ç½®, coordinates, ...}] (å¯ä¿®æ”¹,ç”¨äºæ·»åŠ æ–°å‘ç°çš„åœ°ç‚¹)
  é‡è¦ï¼šæ·»åŠ æ–°åœ°ç‚¹ä½¿ç”¨pushæ“ä½œ
  ç¤ºä¾‹-æ·»åŠ åœ°ç‚¹: {"action":"push", "key":"ä¸–ç•Œ.ä¿¡æ¯.åœ°ç‚¹ä¿¡æ¯", "value":{"åç§°":"xxç§˜å¢ƒ","ç±»å‹":"ç§˜å¢ƒ","ä½ç½®":"ä¸œç„å¤§é™†Â·åŒ—éƒ¨","coordinates":{"x":7500,"y":3000},"æè¿°":"...","å®‰å…¨ç­‰çº§":"å±é™©","å¼€æ”¾çŠ¶æ€":"æœªå‘ç°"}}
`

const GAME_STATE_STRUCTURE = `
## 7. æ—¶é—´ï¼ˆGameTimeï¼Œè·¯å¾„ï¼šå…ƒæ•°æ®.æ—¶é—´ï¼‰

### 7.1 æ—¶é—´
- å¹´: number
- æœˆ: number (1-12)
- æ—¥: number (1-30)
- å°æ—¶: number (0-23)
- åˆ†é’Ÿ: number (0-59) (ç”¨addæ¨è¿›ï¼Œè‡ªåŠ¨è¿›ä½)

### 7.2 ç»„ç»‡ç³»ç»Ÿï¼ˆè·¯å¾„ï¼šç¤¾äº¤.ç»„ç»‡ï¼‰
**æ³¨æ„**: ç¤¾äº¤.ç»„ç»‡ æ˜¯ V3 ç»“æ„çš„ç»„ç»‡ç³»ç»Ÿï¼Œå¼€å±€æ—¶ç©å®¶æœªåŠ å…¥ç»„ç»‡æ—¶åº”ä¸º nullï¼ˆä¸è¦è®¾ç½®ä¸ºç©ºå¯¹è±¡ {}ï¼‰ã€‚
AI å¼€å±€åˆå§‹åŒ–æ—¶**ä¸è¦ä¿®æ”¹** ç¤¾äº¤.ç»„ç»‡ï¼Œä¿æŒä¸º null å³å¯ã€‚ç©å®¶åŠ å…¥ç»„ç»‡åç”±ç³»ç»Ÿè‡ªåŠ¨å¡«å……ã€‚
`

const EVENT_SYSTEM_STRUCTURE = `
## 8. äº‹ä»¶ï¼ˆEvent System - Modifiableï¼Œè·¯å¾„ï¼šç¤¾äº¤.äº‹ä»¶ï¼‰
- é…ç½®: {å¯ç”¨éšæœºäº‹ä»¶, æœ€å°é—´éš”å¹´, æœ€å¤§é—´éš”å¹´, äº‹ä»¶æç¤ºè¯}
- ä¸‹æ¬¡äº‹ä»¶æ—¶é—´: GameTime|nullï¼ˆç”±ç³»ç»Ÿè°ƒåº¦å†™å…¥ï¼›AIåªè¯»ï¼‰
- äº‹ä»¶è®°å½•: [äº‹ä»¶å¯¹è±¡]ï¼ˆç”¨pushæ·»åŠ æ–°äº‹ä»¶ï¼ŒæŒ‰æ—¶é—´é¡ºåºè¿½åŠ ï¼‰

### 8.1 äº‹ä»¶å¯¹è±¡ç»“æ„ (GameEvent)
- äº‹ä»¶ID: string (å”¯ä¸€ID, æ ¼å¼: event_æ—¶é—´æˆ³_éšæœºæ•°)
- äº‹ä»¶åç§°: string
- äº‹ä»¶ç±»å‹: string (ä¾‹: "ç»„ç»‡å†²çª"/"ä¸–ç•Œå˜é©"/"ç¨€æœ‰èµ„æºå‡ºç°"/"ç¦åŒºç°ä¸–"/"äººç‰©é£æ³¢")
- äº‹ä»¶æè¿°: stringï¼ˆå°½é‡åŒ…å«åœ°ç‚¹ã€æ¶‰åŠåŠ¿åŠ›/äººç‰©ã€ç›´æ¥åæœï¼‰
- å½±å“ç­‰çº§?: "è½»å¾®"|"ä¸­ç­‰"|"é‡å¤§"|"ç¾éš¾"
- å½±å“èŒƒå›´?: stringï¼ˆä¾‹: "ä¸œç„å¤§é™†åŒ—å¢ƒ"ï¼‰
- ç›¸å…³äººç‰©?: string[]
- ç›¸å…³åŠ¿åŠ›?: string[]
- äº‹ä»¶æ¥æº: "éšæœº"|"ç©å®¶å½±å“"|"ç³»ç»Ÿ"
- å‘ç”Ÿæ—¶é—´: {å¹´, æœˆ, æ—¥, å°æ—¶, åˆ†é’Ÿ}ï¼ˆå¿…å¡«ï¼›ä½¿ç”¨å½“å‰ å…ƒæ•°æ®.æ—¶é—´ï¼‰

æŒ‡ä»¤ç¤ºä¾‹ï¼š
- push ç¤¾äº¤.äº‹ä»¶.äº‹ä»¶è®°å½• {äº‹ä»¶å¯¹è±¡}
`

const SYSTEM_CONFIG_STRUCTURE = `
## 9. ç³»ç»Ÿé…ç½® (System Config - Read-only)
- nsfwMode: boolean
- nsfwGenderFilter: "all"|"female"|"male"
`

export const SAVE_DATA_STRUCTURE = `
# ã€æ•°æ®ç»“æ„å®šä¹‰ã€‘å®Œæ•´SaveDataç»“æ„
${CHARACTER_STRUCTURE}
${DAO_STRUCTURE}
${INVENTORY_STRUCTURE}
${RELATIONS_STRUCTURE}
${MEMORY_STRUCTURE}
${WORLD_INFO_STRUCTURE}
${GAME_STATE_STRUCTURE}
${EVENT_SYSTEM_STRUCTURE}
${SYSTEM_CONFIG_STRUCTURE}
`.trim()

export const SAVE_DATA_STRUCTURE_V4 = `
# ã€æ•°æ®ç»“æ„å®šä¹‰ã€‘V4ï¼ˆèµ›åšæœ‹å…‹ä¸»é¢˜ï¼‰

## 1. è§’è‰²ï¼ˆè·¯å¾„ï¼šè§’è‰².*ï¼‰
- æ¡£æ¡ˆ: {å§“å, æ€§åˆ«, å¹´é¾„, å‡ºç”Ÿæ—¥æœŸ, æ‰€å±ä¸–ç•Œ, æ—ç¾¤, èƒŒæ™¯, å¤©èµ‹[], åŸºç¡€ç´ è´¨, æ”¹é€ ç´ è´¨}
- èƒ½åŠ›: {ç­‰çº§{ç§°å·, é˜¶æ®µ, è¿›åº¦, æ™‹å‡éœ€æ±‚, æ™‹å‡è¯´æ˜}, çƒ­åº¦}
- èµ„æº: {ç”Ÿå‘½å€¼{å½“å‰,ä¸Šé™}, ç”µé‡{å½“å‰,ä¸Šé™}, å¸¦å®½{å½“å‰,ä¸Šé™}, ç”Ÿç†è€ä¹…{å½“å‰,ä¸Šé™}}
- ä½ç½®: {æè¿°:"åŸåŒºÂ·è¡—åŒºÂ·èŠ‚ç‚¹", x, y, ä¿¡å·å¼ºåº¦}
- çŠ¶æ€æ•ˆæœ: [{çŠ¶æ€åç§°, ç±»å‹, ç”Ÿæˆæ—¶é—´, æŒç»­æ—¶é—´åˆ†é’Ÿ, çŠ¶æ€æè¿°, å¼ºåº¦?, æ¥æº?}]
- èƒŒåŒ…: {ä¿¡ç”¨ç‚¹:number, ç‰©å“:{ç‰©å“ID:ç‰©å“å¯¹è±¡}}
- è£…å¤‡ / æŠ€èƒ½æ ‘ / è®­ç»ƒ / ä¸“ç²¾æ ‘ / æŠ€èƒ½: ç»“æ„åŒ–å¯¹è±¡ï¼ˆç”±ç³»ç»Ÿå®šä¹‰ï¼‰
- èº«ä½“: ä¿ç•™NSFWæ‰©å±•å­—æ®µï¼ˆèµ›åšåŒ–å™è¿°ï¼‰

## 2. ç¤¾äº¤ï¼ˆè·¯å¾„ï¼šç¤¾äº¤.*ï¼‰
- å…³ç³»: {NPCå: NPCå¯¹è±¡}
- ç»„ç»‡: ç»„ç»‡ä¿¡æ¯
- è®°å¿†: {çŸ­æœŸè®°å¿†, ä¸­æœŸè®°å¿†, é•¿æœŸè®°å¿†, éšå¼ä¸­æœŸè®°å¿†}
- äº‹ä»¶: {é…ç½®, ä¸‹æ¬¡äº‹ä»¶æ—¶é—´, äº‹ä»¶è®°å½•}

## 3. ä¸–ç•Œï¼ˆè·¯å¾„ï¼šä¸–ç•Œ.*ï¼‰
- ä¿¡æ¯: {ä¸–ç•Œåç§°, åŒºåŸŸä¿¡æ¯, å…¬å¸åŠ¿åŠ›, èŠ‚ç‚¹ä¿¡æ¯, ç”Ÿæˆæ—¶é—´, ä¸–ç•ŒèƒŒæ™¯, ä¸–ç•Œçºªå…ƒ, ç‰¹æ®Šè®¾å®š}

## 4. ç³»ç»Ÿï¼ˆè·¯å¾„ï¼šç³»ç»Ÿ.*ï¼‰
- é…ç½®: {è§„åˆ™, æç¤º, nsfwMode, nsfwGenderFilter}
- å†å²: {å™äº‹}
- è”æœº / è®¾ç½®: ä¿ç•™
`.trim()

export const DATA_STRUCTURE_EXAMPLES = ``

export function stripNsfwContent(input: string): string {
  return input
    .split('\n')
    .filter((line) => !/nsfw|ç§å¯†ä¿¡æ¯|èº«ä½“éƒ¨ä½å¼€å‘|privacy/i.test(line))
    .join('\n')
    .trim();
}

export function getSaveDataStructureForEnv(isTavern: boolean): string {
  if (isTavern) return SAVE_DATA_STRUCTURE;
  return stripNsfwContent(SAVE_DATA_STRUCTURE);
}

export function getSaveDataStructureV4ForEnv(isTavern: boolean): string {
  if (isTavern) return SAVE_DATA_STRUCTURE_V4;
  return stripNsfwContent(SAVE_DATA_STRUCTURE_V4);
}
